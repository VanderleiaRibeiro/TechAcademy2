"use strict";function _get(target,property,receiver){if(typeof Reflect!=="undefined"&&Reflect.get){_get=Reflect.get;}else{_get=function _get(target,property,receiver){var base=_superPropBase(target,property);if(!base)return;var desc=Object.getOwnPropertyDescriptor(base,property);if(desc.get){return desc.get.call(receiver);}return desc.value;};}return _get(target,property,receiver||target);}function _superPropBase(object,property){while(!Object.prototype.hasOwnProperty.call(object,property)){object=_getPrototypeOf(object);if(object===null)break;}return object;}function _possibleConstructorReturn(self,call){if(call&&(_typeof(call)==="object"||typeof call==="function")){return call;}return _assertThisInitialized(self);}function _assertThisInitialized(self){if(self===void 0){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return self;}function _getPrototypeOf(o){_getPrototypeOf=Object.setPrototypeOf?Object.getPrototypeOf:function _getPrototypeOf(o){return o.__proto__||Object.getPrototypeOf(o);};return _getPrototypeOf(o);}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function");}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,writable:true,configurable:true}});if(superClass)_setPrototypeOf(subClass,superClass);}function isNativeReflectConstruct(){if(typeof Reflect==="undefined"||!Reflect.construct)return false;if(Reflect.construct.sham)return false;if(typeof Proxy==="function")return true;try{Date.prototype.toString.call(Reflect.construct(Date,[],function(){}));return true;}catch(e){return false;}}function _construct(Parent,args,Class){if(isNativeReflectConstruct()){_construct=Reflect.construct;}else{_construct=function _construct(Parent,args,Class){var a=[null];a.push.apply(a,args);var Constructor=Function.bind.apply(Parent,a);var instance=new Constructor();if(Class)_setPrototypeOf(instance,Class.prototype);return instance;};}return _construct.apply(null,arguments);}function _setPrototypeOf(o,p){_setPrototypeOf=Object.setPrototypeOf||function _setPrototypeOf(o,p){o.__proto__=p;return o;};return _setPrototypeOf(o,p);}function _toConsumableArray(arr){return _arrayWithoutHoles(arr)||_iterableToArray(arr)||_nonIterableSpread();}function _nonIterableSpread(){throw new TypeError("Invalid attempt to spread non-iterable instance");}function _iterableToArray(iter){if(Symbol.iterator in Object(iter)||Object.prototype.toString.call(iter)==="[object Arguments]")return Array.from(iter);}function _arrayWithoutHoles(arr){if(Array.isArray(arr)){for(var i=0,arr2=new Array(arr.length);i<arr.length;i++){arr2[i]=arr[i];}return arr2;}}function _slicedToArray(arr,i){return _arrayWithHoles(arr)||_iterableToArrayLimit(arr,i)||_nonIterableRest();}function _nonIterableRest(){throw new TypeError("Invalid attempt to destructure non-iterable instance");}function _iterableToArrayLimit(arr,i){if(!(Symbol.iterator in Object(arr)||Object.prototype.toString.call(arr)==="[object Arguments]")){return;}var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break;}}catch(err){_d=true;_e=err;}finally{try{if(!_n&&_i["return"]!=null)_i["return"]();}finally{if(_d)throw _e;}}return _arr;}function _arrayWithHoles(arr){if(Array.isArray(arr))return arr;}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);return Constructor;}function _typeof(obj){if(typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"){_typeof=function _typeof(obj){return typeof obj;};}else{_typeof=function _typeof(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};}return _typeof(obj);}// Generated by Construct, the game and app creator :: https://www.construct.net
// ../3rdparty/glmatrix.js
{/*
 @fileoverview gl-matrix - High performance matrix and vector operations
@author Brandon Jones
@author Colin MacKenzie IV
@version 3.4.1

Copyright (c) 2015-2021, Brandon Jones, Colin MacKenzie IV.

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
THE SOFTWARE.

*/'use strict';(function(global,factory){(typeof exports==="undefined"?"undefined":_typeof(exports))==="object"&&typeof module!=="undefined"?factory(exports):typeof define==="function"&&define.amd?define(["exports"],factory):(global=typeof globalThis!=="undefined"?globalThis:global||self,factory(global.glMatrix={}));})(void 0,function(exports){var EPSILON=1E-6;var ARRAY_TYPE=typeof Float32Array!=="undefined"?Float32Array:Array;var RANDOM=Math.random;var ANGLE_ORDER="zyx";function setMatrixArrayType(type){ARRAY_TYPE=type;}var degree=Math.PI/180;function toRadian(a){return a*degree;}function equals$9(a,b){return Math.abs(a-b)<=EPSILON*Math.max(1,Math.abs(a),Math.abs(b));}if(!Math.hypot)Math.hypot=function(){var y=0,i=arguments.length;while(i--){y+=arguments[i]*arguments[i];}return Math.sqrt(y);};var common=Object.freeze({__proto__:null,EPSILON:EPSILON,get ARRAY_TYPE(){return ARRAY_TYPE;},RANDOM:RANDOM,ANGLE_ORDER:ANGLE_ORDER,setMatrixArrayType:setMatrixArrayType,toRadian:toRadian,equals:equals$9});function create$8(){var out=new ARRAY_TYPE(4);if(ARRAY_TYPE!=Float32Array){out[1]=0;out[2]=0;}out[0]=1;out[3]=1;return out;}function clone$8(a){var out=new ARRAY_TYPE(4);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out;}function copy$8(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out;}function identity$5(out){out[0]=1;out[1]=0;out[2]=0;out[3]=1;return out;}function fromValues$8(m00,m01,m10,m11){var out=new ARRAY_TYPE(4);out[0]=m00;out[1]=m01;out[2]=m10;out[3]=m11;return out;}function set$8(out,m00,m01,m10,m11){out[0]=m00;out[1]=m01;out[2]=m10;out[3]=m11;return out;}function transpose$2(out,a){if(out===a){var a1=a[1];out[1]=a[2];out[2]=a1;}else{out[0]=a[0];out[1]=a[2];out[2]=a[1];out[3]=a[3];}return out;}function invert$5(out,a){var a0=a[0],a1=a[1],a2=a[2],a3=a[3];var det=a0*a3-a2*a1;if(!det)return null;det=1/det;out[0]=a3*det;out[1]=-a1*det;out[2]=-a2*det;out[3]=a0*det;return out;}function adjoint$2(out,a){var a0=a[0];out[0]=a[3];out[1]=-a[1];out[2]=-a[2];out[3]=a0;return out;}function determinant$3(a){return a[0]*a[3]-a[2]*a[1];}function multiply$8(out,a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];out[0]=a0*b0+a2*b1;out[1]=a1*b0+a3*b1;out[2]=a0*b2+a2*b3;out[3]=a1*b2+a3*b3;return out;}function rotate$4(out,a,rad){var a0=a[0],a1=a[1],a2=a[2],a3=a[3];var s=Math.sin(rad);var c=Math.cos(rad);out[0]=a0*c+a2*s;out[1]=a1*c+a3*s;out[2]=a0*-s+a2*c;out[3]=a1*-s+a3*c;return out;}function scale$8(out,a,v){var a0=a[0],a1=a[1],a2=a[2],a3=a[3];var v0=v[0],v1=v[1];out[0]=a0*v0;out[1]=a1*v0;out[2]=a2*v1;out[3]=a3*v1;return out;}function fromRotation$4(out,rad){var s=Math.sin(rad);var c=Math.cos(rad);out[0]=c;out[1]=s;out[2]=-s;out[3]=c;return out;}function fromScaling$3(out,v){out[0]=v[0];out[1]=0;out[2]=0;out[3]=v[1];return out;}function str$8(a){return"mat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")";}function frob$3(a){return Math.hypot(a[0],a[1],a[2],a[3]);}function LDU(L,D,U,a){L[2]=a[2]/a[0];U[0]=a[0];U[1]=a[1];U[3]=a[3]-L[2]*U[1];return[L,D,U];}function add$8(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];out[3]=a[3]+b[3];return out;}function subtract$6(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];out[3]=a[3]-b[3];return out;}function exactEquals$8(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3];}function equals$8(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3));}function multiplyScalar$3(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;return out;}function multiplyScalarAndAdd$3(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;out[3]=a[3]+b[3]*scale;return out;}var mul$8=multiply$8;var sub$6=subtract$6;var mat2=Object.freeze({__proto__:null,create:create$8,clone:clone$8,copy:copy$8,identity:identity$5,fromValues:fromValues$8,set:set$8,transpose:transpose$2,invert:invert$5,adjoint:adjoint$2,determinant:determinant$3,multiply:multiply$8,rotate:rotate$4,scale:scale$8,fromRotation:fromRotation$4,fromScaling:fromScaling$3,str:str$8,frob:frob$3,LDU:LDU,add:add$8,subtract:subtract$6,exactEquals:exactEquals$8,equals:equals$8,multiplyScalar:multiplyScalar$3,multiplyScalarAndAdd:multiplyScalarAndAdd$3,mul:mul$8,sub:sub$6});function create$7(){var out=new ARRAY_TYPE(6);if(ARRAY_TYPE!=Float32Array){out[1]=0;out[2]=0;out[4]=0;out[5]=0;}out[0]=1;out[3]=1;return out;}function clone$7(a){var out=new ARRAY_TYPE(6);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];return out;}function copy$7(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];return out;}function identity$4(out){out[0]=1;out[1]=0;out[2]=0;out[3]=1;out[4]=0;out[5]=0;return out;}function fromValues$7(a,b,c,d,tx,ty){var out=new ARRAY_TYPE(6);out[0]=a;out[1]=b;out[2]=c;out[3]=d;out[4]=tx;out[5]=ty;return out;}function set$7(out,a,b,c,d,tx,ty){out[0]=a;out[1]=b;out[2]=c;out[3]=d;out[4]=tx;out[5]=ty;return out;}function invert$4(out,a){var aa=a[0],ab=a[1],ac=a[2],ad=a[3];var atx=a[4],aty=a[5];var det=aa*ad-ab*ac;if(!det)return null;det=1/det;out[0]=ad*det;out[1]=-ab*det;out[2]=-ac*det;out[3]=aa*det;out[4]=(ac*aty-ad*atx)*det;out[5]=(ab*atx-aa*aty)*det;return out;}function determinant$2(a){return a[0]*a[3]-a[1]*a[2];}function multiply$7(out,a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5];var b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5];out[0]=a0*b0+a2*b1;out[1]=a1*b0+a3*b1;out[2]=a0*b2+a2*b3;out[3]=a1*b2+a3*b3;out[4]=a0*b4+a2*b5+a4;out[5]=a1*b4+a3*b5+a5;return out;}function rotate$3(out,a,rad){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5];var s=Math.sin(rad);var c=Math.cos(rad);out[0]=a0*c+a2*s;out[1]=a1*c+a3*s;out[2]=a0*-s+a2*c;out[3]=a1*-s+a3*c;out[4]=a4;out[5]=a5;return out;}function scale$7(out,a,v){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5];var v0=v[0],v1=v[1];out[0]=a0*v0;out[1]=a1*v0;out[2]=a2*v1;out[3]=a3*v1;out[4]=a4;out[5]=a5;return out;}function translate$3(out,a,v){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5];var v0=v[0],v1=v[1];out[0]=a0;out[1]=a1;out[2]=a2;out[3]=a3;out[4]=a0*v0+a2*v1+a4;out[5]=a1*v0+a3*v1+a5;return out;}function fromRotation$3(out,rad){var s=Math.sin(rad),c=Math.cos(rad);out[0]=c;out[1]=s;out[2]=-s;out[3]=c;out[4]=0;out[5]=0;return out;}function fromScaling$2(out,v){out[0]=v[0];out[1]=0;out[2]=0;out[3]=v[1];out[4]=0;out[5]=0;return out;}function fromTranslation$3(out,v){out[0]=1;out[1]=0;out[2]=0;out[3]=1;out[4]=v[0];out[5]=v[1];return out;}function str$7(a){return"mat2d("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+")";}function frob$2(a){return Math.hypot(a[0],a[1],a[2],a[3],a[4],a[5],1);}function add$7(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];out[3]=a[3]+b[3];out[4]=a[4]+b[4];out[5]=a[5]+b[5];return out;}function subtract$5(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];out[3]=a[3]-b[3];out[4]=a[4]-b[4];out[5]=a[5]-b[5];return out;}function multiplyScalar$2(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;out[4]=a[4]*b;out[5]=a[5]*b;return out;}function multiplyScalarAndAdd$2(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;out[3]=a[3]+b[3]*scale;out[4]=a[4]+b[4]*scale;out[5]=a[5]+b[5]*scale;return out;}function exactEquals$7(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5];}function equals$7(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5];var b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))&&Math.abs(a4-b4)<=EPSILON*Math.max(1,Math.abs(a4),Math.abs(b4))&&Math.abs(a5-b5)<=EPSILON*Math.max(1,Math.abs(a5),Math.abs(b5));}var mul$7=multiply$7;var sub$5=subtract$5;var mat2d=Object.freeze({__proto__:null,create:create$7,clone:clone$7,copy:copy$7,identity:identity$4,fromValues:fromValues$7,set:set$7,invert:invert$4,determinant:determinant$2,multiply:multiply$7,rotate:rotate$3,scale:scale$7,translate:translate$3,fromRotation:fromRotation$3,fromScaling:fromScaling$2,fromTranslation:fromTranslation$3,str:str$7,frob:frob$2,add:add$7,subtract:subtract$5,multiplyScalar:multiplyScalar$2,multiplyScalarAndAdd:multiplyScalarAndAdd$2,exactEquals:exactEquals$7,equals:equals$7,mul:mul$7,sub:sub$5});function create$6(){var out=new ARRAY_TYPE(9);if(ARRAY_TYPE!=Float32Array){out[1]=0;out[2]=0;out[3]=0;out[5]=0;out[6]=0;out[7]=0;}out[0]=1;out[4]=1;out[8]=1;return out;}function fromMat4$1(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[4];out[4]=a[5];out[5]=a[6];out[6]=a[8];out[7]=a[9];out[8]=a[10];return out;}function clone$6(a){var out=new ARRAY_TYPE(9);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];return out;}function copy$6(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];return out;}function fromValues$6(m00,m01,m02,m10,m11,m12,m20,m21,m22){var out=new ARRAY_TYPE(9);out[0]=m00;out[1]=m01;out[2]=m02;out[3]=m10;out[4]=m11;out[5]=m12;out[6]=m20;out[7]=m21;out[8]=m22;return out;}function set$6(out,m00,m01,m02,m10,m11,m12,m20,m21,m22){out[0]=m00;out[1]=m01;out[2]=m02;out[3]=m10;out[4]=m11;out[5]=m12;out[6]=m20;out[7]=m21;out[8]=m22;return out;}function identity$3(out){out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=1;out[5]=0;out[6]=0;out[7]=0;out[8]=1;return out;}function transpose$1(out,a){if(out===a){var a01=a[1],a02=a[2],a12=a[5];out[1]=a[3];out[2]=a[6];out[3]=a01;out[5]=a[7];out[6]=a02;out[7]=a12;}else{out[0]=a[0];out[1]=a[3];out[2]=a[6];out[3]=a[1];out[4]=a[4];out[5]=a[7];out[6]=a[2];out[7]=a[5];out[8]=a[8];}return out;}function invert$3(out,a){var a00=a[0],a01=a[1],a02=a[2];var a10=a[3],a11=a[4],a12=a[5];var a20=a[6],a21=a[7],a22=a[8];var b01=a22*a11-a12*a21;var b11=-a22*a10+a12*a20;var b21=a21*a10-a11*a20;var det=a00*b01+a01*b11+a02*b21;if(!det)return null;det=1/det;out[0]=b01*det;out[1]=(-a22*a01+a02*a21)*det;out[2]=(a12*a01-a02*a11)*det;out[3]=b11*det;out[4]=(a22*a00-a02*a20)*det;out[5]=(-a12*a00+a02*a10)*det;out[6]=b21*det;out[7]=(-a21*a00+a01*a20)*det;out[8]=(a11*a00-a01*a10)*det;return out;}function adjoint$1(out,a){var a00=a[0],a01=a[1],a02=a[2];var a10=a[3],a11=a[4],a12=a[5];var a20=a[6],a21=a[7],a22=a[8];out[0]=a11*a22-a12*a21;out[1]=a02*a21-a01*a22;out[2]=a01*a12-a02*a11;out[3]=a12*a20-a10*a22;out[4]=a00*a22-a02*a20;out[5]=a02*a10-a00*a12;out[6]=a10*a21-a11*a20;out[7]=a01*a20-a00*a21;out[8]=a00*a11-a01*a10;return out;}function determinant$1(a){var a00=a[0],a01=a[1],a02=a[2];var a10=a[3],a11=a[4],a12=a[5];var a20=a[6],a21=a[7],a22=a[8];return a00*(a22*a11-a12*a21)+a01*(-a22*a10+a12*a20)+a02*(a21*a10-a11*a20);}function multiply$6(out,a,b){var a00=a[0],a01=a[1],a02=a[2];var a10=a[3],a11=a[4],a12=a[5];var a20=a[6],a21=a[7],a22=a[8];var b00=b[0],b01=b[1],b02=b[2];var b10=b[3],b11=b[4],b12=b[5];var b20=b[6],b21=b[7],b22=b[8];out[0]=b00*a00+b01*a10+b02*a20;out[1]=b00*a01+b01*a11+b02*a21;out[2]=b00*a02+b01*a12+b02*a22;out[3]=b10*a00+b11*a10+b12*a20;out[4]=b10*a01+b11*a11+b12*a21;out[5]=b10*a02+b11*a12+b12*a22;out[6]=b20*a00+b21*a10+b22*a20;out[7]=b20*a01+b21*a11+b22*a21;out[8]=b20*a02+b21*a12+b22*a22;return out;}function translate$2(out,a,v){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],x=v[0],y=v[1];out[0]=a00;out[1]=a01;out[2]=a02;out[3]=a10;out[4]=a11;out[5]=a12;out[6]=x*a00+y*a10+a20;out[7]=x*a01+y*a11+a21;out[8]=x*a02+y*a12+a22;return out;}function rotate$2(out,a,rad){var a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],s=Math.sin(rad),c=Math.cos(rad);out[0]=c*a00+s*a10;out[1]=c*a01+s*a11;out[2]=c*a02+s*a12;out[3]=c*a10-s*a00;out[4]=c*a11-s*a01;out[5]=c*a12-s*a02;out[6]=a20;out[7]=a21;out[8]=a22;return out;}function scale$6(out,a,v){var x=v[0],y=v[1];out[0]=x*a[0];out[1]=x*a[1];out[2]=x*a[2];out[3]=y*a[3];out[4]=y*a[4];out[5]=y*a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];return out;}function fromTranslation$2(out,v){out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=1;out[5]=0;out[6]=v[0];out[7]=v[1];out[8]=1;return out;}function fromRotation$2(out,rad){var s=Math.sin(rad),c=Math.cos(rad);out[0]=c;out[1]=s;out[2]=0;out[3]=-s;out[4]=c;out[5]=0;out[6]=0;out[7]=0;out[8]=1;return out;}function fromScaling$1(out,v){out[0]=v[0];out[1]=0;out[2]=0;out[3]=0;out[4]=v[1];out[5]=0;out[6]=0;out[7]=0;out[8]=1;return out;}function fromMat2d(out,a){out[0]=a[0];out[1]=a[1];out[2]=0;out[3]=a[2];out[4]=a[3];out[5]=0;out[6]=a[4];out[7]=a[5];out[8]=1;return out;}function fromQuat$1(out,q){var x=q[0],y=q[1],z=q[2],w=q[3];var x2=x+x;var y2=y+y;var z2=z+z;var xx=x*x2;var yx=y*x2;var yy=y*y2;var zx=z*x2;var zy=z*y2;var zz=z*z2;var wx=w*x2;var wy=w*y2;var wz=w*z2;out[0]=1-yy-zz;out[3]=yx-wz;out[6]=zx+wy;out[1]=yx+wz;out[4]=1-xx-zz;out[7]=zy-wx;out[2]=zx-wy;out[5]=zy+wx;out[8]=1-xx-yy;return out;}function normalFromMat4(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3];var a10=a[4],a11=a[5],a12=a[6],a13=a[7];var a20=a[8],a21=a[9],a22=a[10],a23=a[11];var a30=a[12],a31=a[13],a32=a[14],a33=a[15];var b00=a00*a11-a01*a10;var b01=a00*a12-a02*a10;var b02=a00*a13-a03*a10;var b03=a01*a12-a02*a11;var b04=a01*a13-a03*a11;var b05=a02*a13-a03*a12;var b06=a20*a31-a21*a30;var b07=a20*a32-a22*a30;var b08=a20*a33-a23*a30;var b09=a21*a32-a22*a31;var b10=a21*a33-a23*a31;var b11=a22*a33-a23*a32;var det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;if(!det)return null;det=1/det;out[0]=(a11*b11-a12*b10+a13*b09)*det;out[1]=(a12*b08-a10*b11-a13*b07)*det;out[2]=(a10*b10-a11*b08+a13*b06)*det;out[3]=(a02*b10-a01*b11-a03*b09)*det;out[4]=(a00*b11-a02*b08+a03*b07)*det;out[5]=(a01*b08-a00*b10-a03*b06)*det;out[6]=(a31*b05-a32*b04+a33*b03)*det;out[7]=(a32*b02-a30*b05-a33*b01)*det;out[8]=(a30*b04-a31*b02+a33*b00)*det;return out;}function projection(out,width,height){out[0]=2/width;out[1]=0;out[2]=0;out[3]=0;out[4]=-2/height;out[5]=0;out[6]=-1;out[7]=1;out[8]=1;return out;}function str$6(a){return"mat3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")";}function frob$1(a){return Math.hypot(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8]);}function add$6(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];out[3]=a[3]+b[3];out[4]=a[4]+b[4];out[5]=a[5]+b[5];out[6]=a[6]+b[6];out[7]=a[7]+b[7];out[8]=a[8]+b[8];return out;}function subtract$4(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];out[3]=a[3]-b[3];out[4]=a[4]-b[4];out[5]=a[5]-b[5];out[6]=a[6]-b[6];out[7]=a[7]-b[7];out[8]=a[8]-b[8];return out;}function multiplyScalar$1(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;out[4]=a[4]*b;out[5]=a[5]*b;out[6]=a[6]*b;out[7]=a[7]*b;out[8]=a[8]*b;return out;}function multiplyScalarAndAdd$1(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;out[3]=a[3]+b[3]*scale;out[4]=a[4]+b[4]*scale;out[5]=a[5]+b[5]*scale;out[6]=a[6]+b[6]*scale;out[7]=a[7]+b[7]*scale;out[8]=a[8]+b[8]*scale;return out;}function exactEquals$6(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8];}function equals$6(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],a6=a[6],a7=a[7],a8=a[8];var b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5],b6=b[6],b7=b[7],b8=b[8];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))&&Math.abs(a4-b4)<=EPSILON*Math.max(1,Math.abs(a4),Math.abs(b4))&&Math.abs(a5-b5)<=EPSILON*Math.max(1,Math.abs(a5),Math.abs(b5))&&Math.abs(a6-b6)<=EPSILON*Math.max(1,Math.abs(a6),Math.abs(b6))&&Math.abs(a7-b7)<=EPSILON*Math.max(1,Math.abs(a7),Math.abs(b7))&&Math.abs(a8-b8)<=EPSILON*Math.max(1,Math.abs(a8),Math.abs(b8));}var mul$6=multiply$6;var sub$4=subtract$4;var mat3=Object.freeze({__proto__:null,create:create$6,fromMat4:fromMat4$1,clone:clone$6,copy:copy$6,fromValues:fromValues$6,set:set$6,identity:identity$3,transpose:transpose$1,invert:invert$3,adjoint:adjoint$1,determinant:determinant$1,multiply:multiply$6,translate:translate$2,rotate:rotate$2,scale:scale$6,fromTranslation:fromTranslation$2,fromRotation:fromRotation$2,fromScaling:fromScaling$1,fromMat2d:fromMat2d,fromQuat:fromQuat$1,normalFromMat4:normalFromMat4,projection:projection,str:str$6,frob:frob$1,add:add$6,subtract:subtract$4,multiplyScalar:multiplyScalar$1,multiplyScalarAndAdd:multiplyScalarAndAdd$1,exactEquals:exactEquals$6,equals:equals$6,mul:mul$6,sub:sub$4});function create$5(){var out=new ARRAY_TYPE(16);if(ARRAY_TYPE!=Float32Array){out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[11]=0;out[12]=0;out[13]=0;out[14]=0;}out[0]=1;out[5]=1;out[10]=1;out[15]=1;return out;}function clone$5(a){var out=new ARRAY_TYPE(16);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out;}function copy$5(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out;}function fromValues$5(m00,m01,m02,m03,m10,m11,m12,m13,m20,m21,m22,m23,m30,m31,m32,m33){var out=new ARRAY_TYPE(16);out[0]=m00;out[1]=m01;out[2]=m02;out[3]=m03;out[4]=m10;out[5]=m11;out[6]=m12;out[7]=m13;out[8]=m20;out[9]=m21;out[10]=m22;out[11]=m23;out[12]=m30;out[13]=m31;out[14]=m32;out[15]=m33;return out;}function set$5(out,m00,m01,m02,m03,m10,m11,m12,m13,m20,m21,m22,m23,m30,m31,m32,m33){out[0]=m00;out[1]=m01;out[2]=m02;out[3]=m03;out[4]=m10;out[5]=m11;out[6]=m12;out[7]=m13;out[8]=m20;out[9]=m21;out[10]=m22;out[11]=m23;out[12]=m30;out[13]=m31;out[14]=m32;out[15]=m33;return out;}function identity$2(out){out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out;}function transpose(out,a){if(out===a){var a01=a[1],a02=a[2],a03=a[3];var a12=a[6],a13=a[7];var a23=a[11];out[1]=a[4];out[2]=a[8];out[3]=a[12];out[4]=a01;out[6]=a[9];out[7]=a[13];out[8]=a02;out[9]=a12;out[11]=a[14];out[12]=a03;out[13]=a13;out[14]=a23;}else{out[0]=a[0];out[1]=a[4];out[2]=a[8];out[3]=a[12];out[4]=a[1];out[5]=a[5];out[6]=a[9];out[7]=a[13];out[8]=a[2];out[9]=a[6];out[10]=a[10];out[11]=a[14];out[12]=a[3];out[13]=a[7];out[14]=a[11];out[15]=a[15];}return out;}function invert$2(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3];var a10=a[4],a11=a[5],a12=a[6],a13=a[7];var a20=a[8],a21=a[9],a22=a[10],a23=a[11];var a30=a[12],a31=a[13],a32=a[14],a33=a[15];var b00=a00*a11-a01*a10;var b01=a00*a12-a02*a10;var b02=a00*a13-a03*a10;var b03=a01*a12-a02*a11;var b04=a01*a13-a03*a11;var b05=a02*a13-a03*a12;var b06=a20*a31-a21*a30;var b07=a20*a32-a22*a30;var b08=a20*a33-a23*a30;var b09=a21*a32-a22*a31;var b10=a21*a33-a23*a31;var b11=a22*a33-a23*a32;var det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;if(!det)return null;det=1/det;out[0]=(a11*b11-a12*b10+a13*b09)*det;out[1]=(a02*b10-a01*b11-a03*b09)*det;out[2]=(a31*b05-a32*b04+a33*b03)*det;out[3]=(a22*b04-a21*b05-a23*b03)*det;out[4]=(a12*b08-a10*b11-a13*b07)*det;out[5]=(a00*b11-a02*b08+a03*b07)*det;out[6]=(a32*b02-a30*b05-a33*b01)*det;out[7]=(a20*b05-a22*b02+a23*b01)*det;out[8]=(a10*b10-a11*b08+a13*b06)*det;out[9]=(a01*b08-a00*b10-a03*b06)*det;out[10]=(a30*b04-a31*b02+a33*b00)*det;out[11]=(a21*b02-a20*b04-a23*b00)*det;out[12]=(a11*b07-a10*b09-a12*b06)*det;out[13]=(a00*b09-a01*b07+a02*b06)*det;out[14]=(a31*b01-a30*b03-a32*b00)*det;out[15]=(a20*b03-a21*b01+a22*b00)*det;return out;}function adjoint(out,a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3];var a10=a[4],a11=a[5],a12=a[6],a13=a[7];var a20=a[8],a21=a[9],a22=a[10],a23=a[11];var a30=a[12],a31=a[13],a32=a[14],a33=a[15];var b00=a00*a11-a01*a10;var b01=a00*a12-a02*a10;var b02=a00*a13-a03*a10;var b03=a01*a12-a02*a11;var b04=a01*a13-a03*a11;var b05=a02*a13-a03*a12;var b06=a20*a31-a21*a30;var b07=a20*a32-a22*a30;var b08=a20*a33-a23*a30;var b09=a21*a32-a22*a31;var b10=a21*a33-a23*a31;var b11=a22*a33-a23*a32;out[0]=a11*b11-a12*b10+a13*b09;out[1]=a02*b10-a01*b11-a03*b09;out[2]=a31*b05-a32*b04+a33*b03;out[3]=a22*b04-a21*b05-a23*b03;out[4]=a12*b08-a10*b11-a13*b07;out[5]=a00*b11-a02*b08+a03*b07;out[6]=a32*b02-a30*b05-a33*b01;out[7]=a20*b05-a22*b02+a23*b01;out[8]=a10*b10-a11*b08+a13*b06;out[9]=a01*b08-a00*b10-a03*b06;out[10]=a30*b04-a31*b02+a33*b00;out[11]=a21*b02-a20*b04-a23*b00;out[12]=a11*b07-a10*b09-a12*b06;out[13]=a00*b09-a01*b07+a02*b06;out[14]=a31*b01-a30*b03-a32*b00;out[15]=a20*b03-a21*b01+a22*b00;return out;}function determinant(a){var a00=a[0],a01=a[1],a02=a[2],a03=a[3];var a10=a[4],a11=a[5],a12=a[6],a13=a[7];var a20=a[8],a21=a[9],a22=a[10],a23=a[11];var a30=a[12],a31=a[13],a32=a[14],a33=a[15];var b0=a00*a11-a01*a10;var b1=a00*a12-a02*a10;var b2=a01*a12-a02*a11;var b3=a20*a31-a21*a30;var b4=a20*a32-a22*a30;var b5=a21*a32-a22*a31;var b6=a00*b5-a01*b4+a02*b3;var b7=a10*b5-a11*b4+a12*b3;var b8=a20*b2-a21*b1+a22*b0;var b9=a30*b2-a31*b1+a32*b0;return a13*b6-a03*b7+a33*b8-a23*b9;}function multiply$5(out,a,b){var a00=a[0],a01=a[1],a02=a[2],a03=a[3];var a10=a[4],a11=a[5],a12=a[6],a13=a[7];var a20=a[8],a21=a[9],a22=a[10],a23=a[11];var a30=a[12],a31=a[13],a32=a[14],a33=a[15];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];out[0]=b0*a00+b1*a10+b2*a20+b3*a30;out[1]=b0*a01+b1*a11+b2*a21+b3*a31;out[2]=b0*a02+b1*a12+b2*a22+b3*a32;out[3]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[4];b1=b[5];b2=b[6];b3=b[7];out[4]=b0*a00+b1*a10+b2*a20+b3*a30;out[5]=b0*a01+b1*a11+b2*a21+b3*a31;out[6]=b0*a02+b1*a12+b2*a22+b3*a32;out[7]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[8];b1=b[9];b2=b[10];b3=b[11];out[8]=b0*a00+b1*a10+b2*a20+b3*a30;out[9]=b0*a01+b1*a11+b2*a21+b3*a31;out[10]=b0*a02+b1*a12+b2*a22+b3*a32;out[11]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[12];b1=b[13];b2=b[14];b3=b[15];out[12]=b0*a00+b1*a10+b2*a20+b3*a30;out[13]=b0*a01+b1*a11+b2*a21+b3*a31;out[14]=b0*a02+b1*a12+b2*a22+b3*a32;out[15]=b0*a03+b1*a13+b2*a23+b3*a33;return out;}function translate$1(out,a,v){var x=v[0],y=v[1],z=v[2];var a00,a01,a02,a03;var a10,a11,a12,a13;var a20,a21,a22,a23;if(a===out){out[12]=a[0]*x+a[4]*y+a[8]*z+a[12];out[13]=a[1]*x+a[5]*y+a[9]*z+a[13];out[14]=a[2]*x+a[6]*y+a[10]*z+a[14];out[15]=a[3]*x+a[7]*y+a[11]*z+a[15];}else{a00=a[0];a01=a[1];a02=a[2];a03=a[3];a10=a[4];a11=a[5];a12=a[6];a13=a[7];a20=a[8];a21=a[9];a22=a[10];a23=a[11];out[0]=a00;out[1]=a01;out[2]=a02;out[3]=a03;out[4]=a10;out[5]=a11;out[6]=a12;out[7]=a13;out[8]=a20;out[9]=a21;out[10]=a22;out[11]=a23;out[12]=a00*x+a10*y+a20*z+a[12];out[13]=a01*x+a11*y+a21*z+a[13];out[14]=a02*x+a12*y+a22*z+a[14];out[15]=a03*x+a13*y+a23*z+a[15];}return out;}function scale$5(out,a,v){var x=v[0],y=v[1],z=v[2];out[0]=a[0]*x;out[1]=a[1]*x;out[2]=a[2]*x;out[3]=a[3]*x;out[4]=a[4]*y;out[5]=a[5]*y;out[6]=a[6]*y;out[7]=a[7]*y;out[8]=a[8]*z;out[9]=a[9]*z;out[10]=a[10]*z;out[11]=a[11]*z;out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return out;}function rotate$1(out,a,rad,axis){var x=axis[0],y=axis[1],z=axis[2];var len=Math.hypot(x,y,z);var s,c,t;var a00,a01,a02,a03;var a10,a11,a12,a13;var a20,a21,a22,a23;var b00,b01,b02;var b10,b11,b12;var b20,b21,b22;if(len<EPSILON)return null;len=1/len;x*=len;y*=len;z*=len;s=Math.sin(rad);c=Math.cos(rad);t=1-c;a00=a[0];a01=a[1];a02=a[2];a03=a[3];a10=a[4];a11=a[5];a12=a[6];a13=a[7];a20=a[8];a21=a[9];a22=a[10];a23=a[11];b00=x*x*t+c;b01=y*x*t+z*s;b02=z*x*t-y*s;b10=x*y*t-z*s;b11=y*y*t+c;b12=z*y*t+x*s;b20=x*z*t+y*s;b21=y*z*t-x*s;b22=z*z*t+c;out[0]=a00*b00+a10*b01+a20*b02;out[1]=a01*b00+a11*b01+a21*b02;out[2]=a02*b00+a12*b01+a22*b02;out[3]=a03*b00+a13*b01+a23*b02;out[4]=a00*b10+a10*b11+a20*b12;out[5]=a01*b10+a11*b11+a21*b12;out[6]=a02*b10+a12*b11+a22*b12;out[7]=a03*b10+a13*b11+a23*b12;out[8]=a00*b20+a10*b21+a20*b22;out[9]=a01*b20+a11*b21+a21*b22;out[10]=a02*b20+a12*b21+a22*b22;out[11]=a03*b20+a13*b21+a23*b22;if(a!==out){out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];}return out;}function rotateX$3(out,a,rad){var s=Math.sin(rad);var c=Math.cos(rad);var a10=a[4];var a11=a[5];var a12=a[6];var a13=a[7];var a20=a[8];var a21=a[9];var a22=a[10];var a23=a[11];if(a!==out){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];}out[4]=a10*c+a20*s;out[5]=a11*c+a21*s;out[6]=a12*c+a22*s;out[7]=a13*c+a23*s;out[8]=a20*c-a10*s;out[9]=a21*c-a11*s;out[10]=a22*c-a12*s;out[11]=a23*c-a13*s;return out;}function rotateY$3(out,a,rad){var s=Math.sin(rad);var c=Math.cos(rad);var a00=a[0];var a01=a[1];var a02=a[2];var a03=a[3];var a20=a[8];var a21=a[9];var a22=a[10];var a23=a[11];if(a!==out){out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];}out[0]=a00*c-a20*s;out[1]=a01*c-a21*s;out[2]=a02*c-a22*s;out[3]=a03*c-a23*s;out[8]=a00*s+a20*c;out[9]=a01*s+a21*c;out[10]=a02*s+a22*c;out[11]=a03*s+a23*c;return out;}function rotateZ$3(out,a,rad){var s=Math.sin(rad);var c=Math.cos(rad);var a00=a[0];var a01=a[1];var a02=a[2];var a03=a[3];var a10=a[4];var a11=a[5];var a12=a[6];var a13=a[7];if(a!==out){out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];}out[0]=a00*c+a10*s;out[1]=a01*c+a11*s;out[2]=a02*c+a12*s;out[3]=a03*c+a13*s;out[4]=a10*c-a00*s;out[5]=a11*c-a01*s;out[6]=a12*c-a02*s;out[7]=a13*c-a03*s;return out;}function fromTranslation$1(out,v){out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=v[0];out[13]=v[1];out[14]=v[2];out[15]=1;return out;}function fromScaling(out,v){out[0]=v[0];out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=v[1];out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=v[2];out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out;}function fromRotation$1(out,rad,axis){var x=axis[0],y=axis[1],z=axis[2];var len=Math.hypot(x,y,z);var s,c,t;if(len<EPSILON)return null;len=1/len;x*=len;y*=len;z*=len;s=Math.sin(rad);c=Math.cos(rad);t=1-c;out[0]=x*x*t+c;out[1]=y*x*t+z*s;out[2]=z*x*t-y*s;out[3]=0;out[4]=x*y*t-z*s;out[5]=y*y*t+c;out[6]=z*y*t+x*s;out[7]=0;out[8]=x*z*t+y*s;out[9]=y*z*t-x*s;out[10]=z*z*t+c;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out;}function fromXRotation(out,rad){var s=Math.sin(rad);var c=Math.cos(rad);out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=c;out[6]=s;out[7]=0;out[8]=0;out[9]=-s;out[10]=c;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out;}function fromYRotation(out,rad){var s=Math.sin(rad);var c=Math.cos(rad);out[0]=c;out[1]=0;out[2]=-s;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=s;out[9]=0;out[10]=c;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out;}function fromZRotation(out,rad){var s=Math.sin(rad);var c=Math.cos(rad);out[0]=c;out[1]=s;out[2]=0;out[3]=0;out[4]=-s;out[5]=c;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out;}function fromRotationTranslation$1(out,q,v){var x=q[0],y=q[1],z=q[2],w=q[3];var x2=x+x;var y2=y+y;var z2=z+z;var xx=x*x2;var xy=x*y2;var xz=x*z2;var yy=y*y2;var yz=y*z2;var zz=z*z2;var wx=w*x2;var wy=w*y2;var wz=w*z2;out[0]=1-(yy+zz);out[1]=xy+wz;out[2]=xz-wy;out[3]=0;out[4]=xy-wz;out[5]=1-(xx+zz);out[6]=yz+wx;out[7]=0;out[8]=xz+wy;out[9]=yz-wx;out[10]=1-(xx+yy);out[11]=0;out[12]=v[0];out[13]=v[1];out[14]=v[2];out[15]=1;return out;}function fromQuat2(out,a){var translation=new ARRAY_TYPE(3);var bx=-a[0],by=-a[1],bz=-a[2],bw=a[3],ax=a[4],ay=a[5],az=a[6],aw=a[7];var magnitude=bx*bx+by*by+bz*bz+bw*bw;if(magnitude>0){translation[0]=(ax*bw+aw*bx+ay*bz-az*by)*2/magnitude;translation[1]=(ay*bw+aw*by+az*bx-ax*bz)*2/magnitude;translation[2]=(az*bw+aw*bz+ax*by-ay*bx)*2/magnitude;}else{translation[0]=(ax*bw+aw*bx+ay*bz-az*by)*2;translation[1]=(ay*bw+aw*by+az*bx-ax*bz)*2;translation[2]=(az*bw+aw*bz+ax*by-ay*bx)*2;}fromRotationTranslation$1(out,a,translation);return out;}function getTranslation$1(out,mat){out[0]=mat[12];out[1]=mat[13];out[2]=mat[14];return out;}function getScaling(out,mat){var m11=mat[0];var m12=mat[1];var m13=mat[2];var m21=mat[4];var m22=mat[5];var m23=mat[6];var m31=mat[8];var m32=mat[9];var m33=mat[10];out[0]=Math.hypot(m11,m12,m13);out[1]=Math.hypot(m21,m22,m23);out[2]=Math.hypot(m31,m32,m33);return out;}function getRotation(out,mat){var scaling=new ARRAY_TYPE(3);getScaling(scaling,mat);var is1=1/scaling[0];var is2=1/scaling[1];var is3=1/scaling[2];var sm11=mat[0]*is1;var sm12=mat[1]*is2;var sm13=mat[2]*is3;var sm21=mat[4]*is1;var sm22=mat[5]*is2;var sm23=mat[6]*is3;var sm31=mat[8]*is1;var sm32=mat[9]*is2;var sm33=mat[10]*is3;var trace=sm11+sm22+sm33;var S=0;if(trace>0){S=Math.sqrt(trace+1)*2;out[3]=.25*S;out[0]=(sm23-sm32)/S;out[1]=(sm31-sm13)/S;out[2]=(sm12-sm21)/S;}else if(sm11>sm22&&sm11>sm33){S=Math.sqrt(1+sm11-sm22-sm33)*2;out[3]=(sm23-sm32)/S;out[0]=.25*S;out[1]=(sm12+sm21)/S;out[2]=(sm31+sm13)/S;}else if(sm22>sm33){S=Math.sqrt(1+sm22-sm11-sm33)*2;out[3]=(sm31-sm13)/S;out[0]=(sm12+sm21)/S;out[1]=.25*S;out[2]=(sm23+sm32)/S;}else{S=Math.sqrt(1+sm33-sm11-sm22)*2;out[3]=(sm12-sm21)/S;out[0]=(sm31+sm13)/S;out[1]=(sm23+sm32)/S;out[2]=.25*S;}return out;}function decompose(out_r,out_t,out_s,mat){out_t[0]=mat[12];out_t[1]=mat[13];out_t[2]=mat[14];var m11=mat[0];var m12=mat[1];var m13=mat[2];var m21=mat[4];var m22=mat[5];var m23=mat[6];var m31=mat[8];var m32=mat[9];var m33=mat[10];out_s[0]=Math.hypot(m11,m12,m13);out_s[1]=Math.hypot(m21,m22,m23);out_s[2]=Math.hypot(m31,m32,m33);var is1=1/out_s[0];var is2=1/out_s[1];var is3=1/out_s[2];var sm11=m11*is1;var sm12=m12*is2;var sm13=m13*is3;var sm21=m21*is1;var sm22=m22*is2;var sm23=m23*is3;var sm31=m31*is1;var sm32=m32*is2;var sm33=m33*is3;var trace=sm11+sm22+sm33;var S=0;if(trace>0){S=Math.sqrt(trace+1)*2;out_r[3]=.25*S;out_r[0]=(sm23-sm32)/S;out_r[1]=(sm31-sm13)/S;out_r[2]=(sm12-sm21)/S;}else if(sm11>sm22&&sm11>sm33){S=Math.sqrt(1+sm11-sm22-sm33)*2;out_r[3]=(sm23-sm32)/S;out_r[0]=.25*S;out_r[1]=(sm12+sm21)/S;out_r[2]=(sm31+sm13)/S;}else if(sm22>sm33){S=Math.sqrt(1+sm22-sm11-sm33)*2;out_r[3]=(sm31-sm13)/S;out_r[0]=(sm12+sm21)/S;out_r[1]=.25*S;out_r[2]=(sm23+sm32)/S;}else{S=Math.sqrt(1+sm33-sm11-sm22)*2;out_r[3]=(sm12-sm21)/S;out_r[0]=(sm31+sm13)/S;out_r[1]=(sm23+sm32)/S;out_r[2]=.25*S;}return out_r;}function fromRotationTranslationScale(out,q,v,s){var x=q[0],y=q[1],z=q[2],w=q[3];var x2=x+x;var y2=y+y;var z2=z+z;var xx=x*x2;var xy=x*y2;var xz=x*z2;var yy=y*y2;var yz=y*z2;var zz=z*z2;var wx=w*x2;var wy=w*y2;var wz=w*z2;var sx=s[0];var sy=s[1];var sz=s[2];out[0]=(1-(yy+zz))*sx;out[1]=(xy+wz)*sx;out[2]=(xz-wy)*sx;out[3]=0;out[4]=(xy-wz)*sy;out[5]=(1-(xx+zz))*sy;out[6]=(yz+wx)*sy;out[7]=0;out[8]=(xz+wy)*sz;out[9]=(yz-wx)*sz;out[10]=(1-(xx+yy))*sz;out[11]=0;out[12]=v[0];out[13]=v[1];out[14]=v[2];out[15]=1;return out;}function fromRotationTranslationScaleOrigin(out,q,v,s,o){var x=q[0],y=q[1],z=q[2],w=q[3];var x2=x+x;var y2=y+y;var z2=z+z;var xx=x*x2;var xy=x*y2;var xz=x*z2;var yy=y*y2;var yz=y*z2;var zz=z*z2;var wx=w*x2;var wy=w*y2;var wz=w*z2;var sx=s[0];var sy=s[1];var sz=s[2];var ox=o[0];var oy=o[1];var oz=o[2];var out0=(1-(yy+zz))*sx;var out1=(xy+wz)*sx;var out2=(xz-wy)*sx;var out4=(xy-wz)*sy;var out5=(1-(xx+zz))*sy;var out6=(yz+wx)*sy;var out8=(xz+wy)*sz;var out9=(yz-wx)*sz;var out10=(1-(xx+yy))*sz;out[0]=out0;out[1]=out1;out[2]=out2;out[3]=0;out[4]=out4;out[5]=out5;out[6]=out6;out[7]=0;out[8]=out8;out[9]=out9;out[10]=out10;out[11]=0;out[12]=v[0]+ox-(out0*ox+out4*oy+out8*oz);out[13]=v[1]+oy-(out1*ox+out5*oy+out9*oz);out[14]=v[2]+oz-(out2*ox+out6*oy+out10*oz);out[15]=1;return out;}function fromQuat(out,q){var x=q[0],y=q[1],z=q[2],w=q[3];var x2=x+x;var y2=y+y;var z2=z+z;var xx=x*x2;var yx=y*x2;var yy=y*y2;var zx=z*x2;var zy=z*y2;var zz=z*z2;var wx=w*x2;var wy=w*y2;var wz=w*z2;out[0]=1-yy-zz;out[1]=yx+wz;out[2]=zx-wy;out[3]=0;out[4]=yx-wz;out[5]=1-xx-zz;out[6]=zy+wx;out[7]=0;out[8]=zx+wy;out[9]=zy-wx;out[10]=1-xx-yy;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return out;}function frustum(out,left,right,bottom,top,near,far){var rl=1/(right-left);var tb=1/(top-bottom);var nf=1/(near-far);out[0]=near*2*rl;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=near*2*tb;out[6]=0;out[7]=0;out[8]=(right+left)*rl;out[9]=(top+bottom)*tb;out[10]=(far+near)*nf;out[11]=-1;out[12]=0;out[13]=0;out[14]=far*near*2*nf;out[15]=0;return out;}function perspectiveNO(out,fovy,aspect,near,far){var f=1/Math.tan(fovy/2);out[0]=f/aspect;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=f;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[11]=-1;out[12]=0;out[13]=0;out[15]=0;if(far!=null&&far!==Infinity){var nf=1/(near-far);out[10]=(far+near)*nf;out[14]=2*far*near*nf;}else{out[10]=-1;out[14]=-2*near;}return out;}var perspective=perspectiveNO;function perspectiveZO(out,fovy,aspect,near,far){var f=1/Math.tan(fovy/2);out[0]=f/aspect;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=f;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[11]=-1;out[12]=0;out[13]=0;out[15]=0;if(far!=null&&far!==Infinity){var nf=1/(near-far);out[10]=far*nf;out[14]=far*near*nf;}else{out[10]=-1;out[14]=-near;}return out;}function perspectiveFromFieldOfView(out,fov,near,far){var upTan=Math.tan(fov.upDegrees*Math.PI/180);var downTan=Math.tan(fov.downDegrees*Math.PI/180);var leftTan=Math.tan(fov.leftDegrees*Math.PI/180);var rightTan=Math.tan(fov.rightDegrees*Math.PI/180);var xScale=2/(leftTan+rightTan);var yScale=2/(upTan+downTan);out[0]=xScale;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=yScale;out[6]=0;out[7]=0;out[8]=-((leftTan-rightTan)*xScale*.5);out[9]=(upTan-downTan)*yScale*.5;out[10]=far/(near-far);out[11]=-1;out[12]=0;out[13]=0;out[14]=far*near/(near-far);out[15]=0;return out;}function orthoNO(out,left,right,bottom,top,near,far){var lr=1/(left-right);var bt=1/(bottom-top);var nf=1/(near-far);out[0]=-2*lr;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=-2*bt;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=2*nf;out[11]=0;out[12]=(left+right)*lr;out[13]=(top+bottom)*bt;out[14]=(far+near)*nf;out[15]=1;return out;}var ortho=orthoNO;function orthoZO(out,left,right,bottom,top,near,far){var lr=1/(left-right);var bt=1/(bottom-top);var nf=1/(near-far);out[0]=-2*lr;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=-2*bt;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=nf;out[11]=0;out[12]=(left+right)*lr;out[13]=(top+bottom)*bt;out[14]=near*nf;out[15]=1;return out;}function lookAt(out,eye,center,up){var x0,x1,x2,y0,y1,y2,z0,z1,z2,len;var eyex=eye[0];var eyey=eye[1];var eyez=eye[2];var upx=up[0];var upy=up[1];var upz=up[2];var centerx=center[0];var centery=center[1];var centerz=center[2];if(Math.abs(eyex-centerx)<EPSILON&&Math.abs(eyey-centery)<EPSILON&&Math.abs(eyez-centerz)<EPSILON)return identity$2(out);z0=eyex-centerx;z1=eyey-centery;z2=eyez-centerz;len=1/Math.hypot(z0,z1,z2);z0*=len;z1*=len;z2*=len;x0=upy*z2-upz*z1;x1=upz*z0-upx*z2;x2=upx*z1-upy*z0;len=Math.hypot(x0,x1,x2);if(!len){x0=0;x1=0;x2=0;}else{len=1/len;x0*=len;x1*=len;x2*=len;}y0=z1*x2-z2*x1;y1=z2*x0-z0*x2;y2=z0*x1-z1*x0;len=Math.hypot(y0,y1,y2);if(!len){y0=0;y1=0;y2=0;}else{len=1/len;y0*=len;y1*=len;y2*=len;}out[0]=x0;out[1]=y0;out[2]=z0;out[3]=0;out[4]=x1;out[5]=y1;out[6]=z1;out[7]=0;out[8]=x2;out[9]=y2;out[10]=z2;out[11]=0;out[12]=-(x0*eyex+x1*eyey+x2*eyez);out[13]=-(y0*eyex+y1*eyey+y2*eyez);out[14]=-(z0*eyex+z1*eyey+z2*eyez);out[15]=1;return out;}function targetTo(out,eye,target,up){var eyex=eye[0],eyey=eye[1],eyez=eye[2],upx=up[0],upy=up[1],upz=up[2];var z0=eyex-target[0],z1=eyey-target[1],z2=eyez-target[2];var len=z0*z0+z1*z1+z2*z2;if(len>0){len=1/Math.sqrt(len);z0*=len;z1*=len;z2*=len;}var x0=upy*z2-upz*z1,x1=upz*z0-upx*z2,x2=upx*z1-upy*z0;len=x0*x0+x1*x1+x2*x2;if(len>0){len=1/Math.sqrt(len);x0*=len;x1*=len;x2*=len;}out[0]=x0;out[1]=x1;out[2]=x2;out[3]=0;out[4]=z1*x2-z2*x1;out[5]=z2*x0-z0*x2;out[6]=z0*x1-z1*x0;out[7]=0;out[8]=z0;out[9]=z1;out[10]=z2;out[11]=0;out[12]=eyex;out[13]=eyey;out[14]=eyez;out[15]=1;return out;}function str$5(a){return"mat4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")";}function frob(a){return Math.hypot(a[0],a[1],a[2],a[3],a[4],a[5],a[6],a[7],a[8],a[9],a[10],a[11],a[12],a[13],a[14],a[15]);}function add$5(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];out[3]=a[3]+b[3];out[4]=a[4]+b[4];out[5]=a[5]+b[5];out[6]=a[6]+b[6];out[7]=a[7]+b[7];out[8]=a[8]+b[8];out[9]=a[9]+b[9];out[10]=a[10]+b[10];out[11]=a[11]+b[11];out[12]=a[12]+b[12];out[13]=a[13]+b[13];out[14]=a[14]+b[14];out[15]=a[15]+b[15];return out;}function subtract$3(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];out[3]=a[3]-b[3];out[4]=a[4]-b[4];out[5]=a[5]-b[5];out[6]=a[6]-b[6];out[7]=a[7]-b[7];out[8]=a[8]-b[8];out[9]=a[9]-b[9];out[10]=a[10]-b[10];out[11]=a[11]-b[11];out[12]=a[12]-b[12];out[13]=a[13]-b[13];out[14]=a[14]-b[14];out[15]=a[15]-b[15];return out;}function multiplyScalar(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;out[4]=a[4]*b;out[5]=a[5]*b;out[6]=a[6]*b;out[7]=a[7]*b;out[8]=a[8]*b;out[9]=a[9]*b;out[10]=a[10]*b;out[11]=a[11]*b;out[12]=a[12]*b;out[13]=a[13]*b;out[14]=a[14]*b;out[15]=a[15]*b;return out;}function multiplyScalarAndAdd(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;out[3]=a[3]+b[3]*scale;out[4]=a[4]+b[4]*scale;out[5]=a[5]+b[5]*scale;out[6]=a[6]+b[6]*scale;out[7]=a[7]+b[7]*scale;out[8]=a[8]+b[8]*scale;out[9]=a[9]+b[9]*scale;out[10]=a[10]+b[10]*scale;out[11]=a[11]+b[11]*scale;out[12]=a[12]+b[12]*scale;out[13]=a[13]+b[13]*scale;out[14]=a[14]+b[14]*scale;out[15]=a[15]+b[15]*scale;return out;}function exactEquals$5(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7]&&a[8]===b[8]&&a[9]===b[9]&&a[10]===b[10]&&a[11]===b[11]&&a[12]===b[12]&&a[13]===b[13]&&a[14]===b[14]&&a[15]===b[15];}function equals$5(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3];var a4=a[4],a5=a[5],a6=a[6],a7=a[7];var a8=a[8],a9=a[9],a10=a[10],a11=a[11];var a12=a[12],a13=a[13],a14=a[14],a15=a[15];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];var b4=b[4],b5=b[5],b6=b[6],b7=b[7];var b8=b[8],b9=b[9],b10=b[10],b11=b[11];var b12=b[12],b13=b[13],b14=b[14],b15=b[15];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))&&Math.abs(a4-b4)<=EPSILON*Math.max(1,Math.abs(a4),Math.abs(b4))&&Math.abs(a5-b5)<=EPSILON*Math.max(1,Math.abs(a5),Math.abs(b5))&&Math.abs(a6-b6)<=EPSILON*Math.max(1,Math.abs(a6),Math.abs(b6))&&Math.abs(a7-b7)<=EPSILON*Math.max(1,Math.abs(a7),Math.abs(b7))&&Math.abs(a8-b8)<=EPSILON*Math.max(1,Math.abs(a8),Math.abs(b8))&&Math.abs(a9-b9)<=EPSILON*Math.max(1,Math.abs(a9),Math.abs(b9))&&Math.abs(a10-b10)<=EPSILON*Math.max(1,Math.abs(a10),Math.abs(b10))&&Math.abs(a11-b11)<=EPSILON*Math.max(1,Math.abs(a11),Math.abs(b11))&&Math.abs(a12-b12)<=EPSILON*Math.max(1,Math.abs(a12),Math.abs(b12))&&Math.abs(a13-b13)<=EPSILON*Math.max(1,Math.abs(a13),Math.abs(b13))&&Math.abs(a14-b14)<=EPSILON*Math.max(1,Math.abs(a14),Math.abs(b14))&&Math.abs(a15-b15)<=EPSILON*Math.max(1,Math.abs(a15),Math.abs(b15));}var mul$5=multiply$5;var sub$3=subtract$3;var mat4=Object.freeze({__proto__:null,create:create$5,clone:clone$5,copy:copy$5,fromValues:fromValues$5,set:set$5,identity:identity$2,transpose:transpose,invert:invert$2,adjoint:adjoint,determinant:determinant,multiply:multiply$5,translate:translate$1,scale:scale$5,rotate:rotate$1,rotateX:rotateX$3,rotateY:rotateY$3,rotateZ:rotateZ$3,fromTranslation:fromTranslation$1,fromScaling:fromScaling,fromRotation:fromRotation$1,fromXRotation:fromXRotation,fromYRotation:fromYRotation,fromZRotation:fromZRotation,fromRotationTranslation:fromRotationTranslation$1,fromQuat2:fromQuat2,getTranslation:getTranslation$1,getScaling:getScaling,getRotation:getRotation,decompose:decompose,fromRotationTranslationScale:fromRotationTranslationScale,fromRotationTranslationScaleOrigin:fromRotationTranslationScaleOrigin,fromQuat:fromQuat,frustum:frustum,perspectiveNO:perspectiveNO,perspective:perspective,perspectiveZO:perspectiveZO,perspectiveFromFieldOfView:perspectiveFromFieldOfView,orthoNO:orthoNO,ortho:ortho,orthoZO:orthoZO,lookAt:lookAt,targetTo:targetTo,str:str$5,frob:frob,add:add$5,subtract:subtract$3,multiplyScalar:multiplyScalar,multiplyScalarAndAdd:multiplyScalarAndAdd,exactEquals:exactEquals$5,equals:equals$5,mul:mul$5,sub:sub$3});function create$4(){var out=new ARRAY_TYPE(3);if(ARRAY_TYPE!=Float32Array){out[0]=0;out[1]=0;out[2]=0;}return out;}function clone$4(a){var out=new ARRAY_TYPE(3);out[0]=a[0];out[1]=a[1];out[2]=a[2];return out;}function length$4(a){var x=a[0];var y=a[1];var z=a[2];return Math.hypot(x,y,z);}function fromValues$4(x,y,z){var out=new ARRAY_TYPE(3);out[0]=x;out[1]=y;out[2]=z;return out;}function copy$4(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];return out;}function set$4(out,x,y,z){out[0]=x;out[1]=y;out[2]=z;return out;}function add$4(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];return out;}function subtract$2(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];return out;}function multiply$4(out,a,b){out[0]=a[0]*b[0];out[1]=a[1]*b[1];out[2]=a[2]*b[2];return out;}function divide$2(out,a,b){out[0]=a[0]/b[0];out[1]=a[1]/b[1];out[2]=a[2]/b[2];return out;}function ceil$2(out,a){out[0]=Math.ceil(a[0]);out[1]=Math.ceil(a[1]);out[2]=Math.ceil(a[2]);return out;}function floor$2(out,a){out[0]=Math.floor(a[0]);out[1]=Math.floor(a[1]);out[2]=Math.floor(a[2]);return out;}function min$2(out,a,b){out[0]=Math.min(a[0],b[0]);out[1]=Math.min(a[1],b[1]);out[2]=Math.min(a[2],b[2]);return out;}function max$2(out,a,b){out[0]=Math.max(a[0],b[0]);out[1]=Math.max(a[1],b[1]);out[2]=Math.max(a[2],b[2]);return out;}function round$2(out,a){out[0]=Math.round(a[0]);out[1]=Math.round(a[1]);out[2]=Math.round(a[2]);return out;}function scale$4(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;return out;}function scaleAndAdd$2(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;return out;}function distance$2(a,b){var x=b[0]-a[0];var y=b[1]-a[1];var z=b[2]-a[2];return Math.hypot(x,y,z);}function squaredDistance$2(a,b){var x=b[0]-a[0];var y=b[1]-a[1];var z=b[2]-a[2];return x*x+y*y+z*z;}function squaredLength$4(a){var x=a[0];var y=a[1];var z=a[2];return x*x+y*y+z*z;}function negate$2(out,a){out[0]=-a[0];out[1]=-a[1];out[2]=-a[2];return out;}function inverse$2(out,a){out[0]=1/a[0];out[1]=1/a[1];out[2]=1/a[2];return out;}function normalize$4(out,a){var x=a[0];var y=a[1];var z=a[2];var len=x*x+y*y+z*z;if(len>0)len=1/Math.sqrt(len);out[0]=a[0]*len;out[1]=a[1]*len;out[2]=a[2]*len;return out;}function dot$4(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2];}function cross$2(out,a,b){var ax=a[0],ay=a[1],az=a[2];var bx=b[0],by=b[1],bz=b[2];out[0]=ay*bz-az*by;out[1]=az*bx-ax*bz;out[2]=ax*by-ay*bx;return out;}function lerp$4(out,a,b,t){var ax=a[0];var ay=a[1];var az=a[2];out[0]=ax+t*(b[0]-ax);out[1]=ay+t*(b[1]-ay);out[2]=az+t*(b[2]-az);return out;}function slerp$1(out,a,b,t){var angle=Math.acos(Math.min(Math.max(dot$4(a,b),-1),1));var sinTotal=Math.sin(angle);var ratioA=Math.sin((1-t)*angle)/sinTotal;var ratioB=Math.sin(t*angle)/sinTotal;out[0]=ratioA*a[0]+ratioB*b[0];out[1]=ratioA*a[1]+ratioB*b[1];out[2]=ratioA*a[2]+ratioB*b[2];return out;}function hermite(out,a,b,c,d,t){var factorTimes2=t*t;var factor1=factorTimes2*(2*t-3)+1;var factor2=factorTimes2*(t-2)+t;var factor3=factorTimes2*(t-1);var factor4=factorTimes2*(3-2*t);out[0]=a[0]*factor1+b[0]*factor2+c[0]*factor3+d[0]*factor4;out[1]=a[1]*factor1+b[1]*factor2+c[1]*factor3+d[1]*factor4;out[2]=a[2]*factor1+b[2]*factor2+c[2]*factor3+d[2]*factor4;return out;}function bezier(out,a,b,c,d,t){var inverseFactor=1-t;var inverseFactorTimesTwo=inverseFactor*inverseFactor;var factorTimes2=t*t;var factor1=inverseFactorTimesTwo*inverseFactor;var factor2=3*t*inverseFactorTimesTwo;var factor3=3*factorTimes2*inverseFactor;var factor4=factorTimes2*t;out[0]=a[0]*factor1+b[0]*factor2+c[0]*factor3+d[0]*factor4;out[1]=a[1]*factor1+b[1]*factor2+c[1]*factor3+d[1]*factor4;out[2]=a[2]*factor1+b[2]*factor2+c[2]*factor3+d[2]*factor4;return out;}function random$3(out,scale){scale=scale||1;var r=RANDOM()*2*Math.PI;var z=RANDOM()*2-1;var zScale=Math.sqrt(1-z*z)*scale;out[0]=Math.cos(r)*zScale;out[1]=Math.sin(r)*zScale;out[2]=z*scale;return out;}function transformMat4$2(out,a,m){var x=a[0],y=a[1],z=a[2];var w=m[3]*x+m[7]*y+m[11]*z+m[15];w=w||1;out[0]=(m[0]*x+m[4]*y+m[8]*z+m[12])/w;out[1]=(m[1]*x+m[5]*y+m[9]*z+m[13])/w;out[2]=(m[2]*x+m[6]*y+m[10]*z+m[14])/w;return out;}function transformMat3$1(out,a,m){var x=a[0],y=a[1],z=a[2];out[0]=x*m[0]+y*m[3]+z*m[6];out[1]=x*m[1]+y*m[4]+z*m[7];out[2]=x*m[2]+y*m[5]+z*m[8];return out;}function transformQuat$1(out,a,q){var qx=q[0],qy=q[1],qz=q[2],qw=q[3];var x=a[0],y=a[1],z=a[2];var uvx=qy*z-qz*y,uvy=qz*x-qx*z,uvz=qx*y-qy*x;var uuvx=qy*uvz-qz*uvy,uuvy=qz*uvx-qx*uvz,uuvz=qx*uvy-qy*uvx;var w2=qw*2;uvx*=w2;uvy*=w2;uvz*=w2;uuvx*=2;uuvy*=2;uuvz*=2;out[0]=x+uvx+uuvx;out[1]=y+uvy+uuvy;out[2]=z+uvz+uuvz;return out;}function rotateX$2(out,a,b,rad){var p=[],r=[];p[0]=a[0]-b[0];p[1]=a[1]-b[1];p[2]=a[2]-b[2];r[0]=p[0];r[1]=p[1]*Math.cos(rad)-p[2]*Math.sin(rad);r[2]=p[1]*Math.sin(rad)+p[2]*Math.cos(rad);out[0]=r[0]+b[0];out[1]=r[1]+b[1];out[2]=r[2]+b[2];return out;}function rotateY$2(out,a,b,rad){var p=[],r=[];p[0]=a[0]-b[0];p[1]=a[1]-b[1];p[2]=a[2]-b[2];r[0]=p[2]*Math.sin(rad)+p[0]*Math.cos(rad);r[1]=p[1];r[2]=p[2]*Math.cos(rad)-p[0]*Math.sin(rad);out[0]=r[0]+b[0];out[1]=r[1]+b[1];out[2]=r[2]+b[2];return out;}function rotateZ$2(out,a,b,rad){var p=[],r=[];p[0]=a[0]-b[0];p[1]=a[1]-b[1];p[2]=a[2]-b[2];r[0]=p[0]*Math.cos(rad)-p[1]*Math.sin(rad);r[1]=p[0]*Math.sin(rad)+p[1]*Math.cos(rad);r[2]=p[2];out[0]=r[0]+b[0];out[1]=r[1]+b[1];out[2]=r[2]+b[2];return out;}function angle$1(a,b){var ax=a[0],ay=a[1],az=a[2],bx=b[0],by=b[1],bz=b[2],mag=Math.sqrt((ax*ax+ay*ay+az*az)*(bx*bx+by*by+bz*bz)),cosine=mag&&dot$4(a,b)/mag;return Math.acos(Math.min(Math.max(cosine,-1),1));}function zero$2(out){out[0]=0;out[1]=0;out[2]=0;return out;}function str$4(a){return"vec3("+a[0]+", "+a[1]+", "+a[2]+")";}function exactEquals$4(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2];}function equals$4(a,b){var a0=a[0],a1=a[1],a2=a[2];var b0=b[0],b1=b[1],b2=b[2];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2));}var sub$2=subtract$2;var mul$4=multiply$4;var div$2=divide$2;var dist$2=distance$2;var sqrDist$2=squaredDistance$2;var len$4=length$4;var sqrLen$4=squaredLength$4;var forEach$2=function(){var vec=create$4();return function(a,stride,offset,count,fn,arg){var i,l;if(!stride)stride=3;if(!offset)offset=0;if(count)l=Math.min(count*stride+offset,a.length);else l=a.length;for(i=offset;i<l;i+=stride){vec[0]=a[i];vec[1]=a[i+1];vec[2]=a[i+2];fn(vec,vec,arg);a[i]=vec[0];a[i+1]=vec[1];a[i+2]=vec[2];}return a;};}();var vec3=Object.freeze({__proto__:null,create:create$4,clone:clone$4,length:length$4,fromValues:fromValues$4,copy:copy$4,set:set$4,add:add$4,subtract:subtract$2,multiply:multiply$4,divide:divide$2,ceil:ceil$2,floor:floor$2,min:min$2,max:max$2,round:round$2,scale:scale$4,scaleAndAdd:scaleAndAdd$2,distance:distance$2,squaredDistance:squaredDistance$2,squaredLength:squaredLength$4,negate:negate$2,inverse:inverse$2,normalize:normalize$4,dot:dot$4,cross:cross$2,lerp:lerp$4,slerp:slerp$1,hermite:hermite,bezier:bezier,random:random$3,transformMat4:transformMat4$2,transformMat3:transformMat3$1,transformQuat:transformQuat$1,rotateX:rotateX$2,rotateY:rotateY$2,rotateZ:rotateZ$2,angle:angle$1,zero:zero$2,str:str$4,exactEquals:exactEquals$4,equals:equals$4,sub:sub$2,mul:mul$4,div:div$2,dist:dist$2,sqrDist:sqrDist$2,len:len$4,sqrLen:sqrLen$4,forEach:forEach$2});function create$3(){var out=new ARRAY_TYPE(4);if(ARRAY_TYPE!=Float32Array){out[0]=0;out[1]=0;out[2]=0;out[3]=0;}return out;}function clone$3(a){var out=new ARRAY_TYPE(4);out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out;}function fromValues$3(x,y,z,w){var out=new ARRAY_TYPE(4);out[0]=x;out[1]=y;out[2]=z;out[3]=w;return out;}function copy$3(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];return out;}function set$3(out,x,y,z,w){out[0]=x;out[1]=y;out[2]=z;out[3]=w;return out;}function add$3(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];out[3]=a[3]+b[3];return out;}function subtract$1(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];out[2]=a[2]-b[2];out[3]=a[3]-b[3];return out;}function multiply$3(out,a,b){out[0]=a[0]*b[0];out[1]=a[1]*b[1];out[2]=a[2]*b[2];out[3]=a[3]*b[3];return out;}function divide$1(out,a,b){out[0]=a[0]/b[0];out[1]=a[1]/b[1];out[2]=a[2]/b[2];out[3]=a[3]/b[3];return out;}function ceil$1(out,a){out[0]=Math.ceil(a[0]);out[1]=Math.ceil(a[1]);out[2]=Math.ceil(a[2]);out[3]=Math.ceil(a[3]);return out;}function floor$1(out,a){out[0]=Math.floor(a[0]);out[1]=Math.floor(a[1]);out[2]=Math.floor(a[2]);out[3]=Math.floor(a[3]);return out;}function min$1(out,a,b){out[0]=Math.min(a[0],b[0]);out[1]=Math.min(a[1],b[1]);out[2]=Math.min(a[2],b[2]);out[3]=Math.min(a[3],b[3]);return out;}function max$1(out,a,b){out[0]=Math.max(a[0],b[0]);out[1]=Math.max(a[1],b[1]);out[2]=Math.max(a[2],b[2]);out[3]=Math.max(a[3],b[3]);return out;}function round$1(out,a){out[0]=Math.round(a[0]);out[1]=Math.round(a[1]);out[2]=Math.round(a[2]);out[3]=Math.round(a[3]);return out;}function scale$3(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;return out;}function scaleAndAdd$1(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;out[2]=a[2]+b[2]*scale;out[3]=a[3]+b[3]*scale;return out;}function distance$1(a,b){var x=b[0]-a[0];var y=b[1]-a[1];var z=b[2]-a[2];var w=b[3]-a[3];return Math.hypot(x,y,z,w);}function squaredDistance$1(a,b){var x=b[0]-a[0];var y=b[1]-a[1];var z=b[2]-a[2];var w=b[3]-a[3];return x*x+y*y+z*z+w*w;}function length$3(a){var x=a[0];var y=a[1];var z=a[2];var w=a[3];return Math.hypot(x,y,z,w);}function squaredLength$3(a){var x=a[0];var y=a[1];var z=a[2];var w=a[3];return x*x+y*y+z*z+w*w;}function negate$1(out,a){out[0]=-a[0];out[1]=-a[1];out[2]=-a[2];out[3]=-a[3];return out;}function inverse$1(out,a){out[0]=1/a[0];out[1]=1/a[1];out[2]=1/a[2];out[3]=1/a[3];return out;}function normalize$3(out,a){var x=a[0];var y=a[1];var z=a[2];var w=a[3];var len=x*x+y*y+z*z+w*w;if(len>0)len=1/Math.sqrt(len);out[0]=x*len;out[1]=y*len;out[2]=z*len;out[3]=w*len;return out;}function dot$3(a,b){return a[0]*b[0]+a[1]*b[1]+a[2]*b[2]+a[3]*b[3];}function cross$1(out,u,v,w){var A=v[0]*w[1]-v[1]*w[0],B=v[0]*w[2]-v[2]*w[0],C=v[0]*w[3]-v[3]*w[0],D=v[1]*w[2]-v[2]*w[1],E=v[1]*w[3]-v[3]*w[1],F=v[2]*w[3]-v[3]*w[2];var G=u[0];var H=u[1];var I=u[2];var J=u[3];out[0]=H*F-I*E+J*D;out[1]=-(G*F)+I*C-J*B;out[2]=G*E-H*C+J*A;out[3]=-(G*D)+H*B-I*A;return out;}function lerp$3(out,a,b,t){var ax=a[0];var ay=a[1];var az=a[2];var aw=a[3];out[0]=ax+t*(b[0]-ax);out[1]=ay+t*(b[1]-ay);out[2]=az+t*(b[2]-az);out[3]=aw+t*(b[3]-aw);return out;}function random$2(out,scale){scale=scale||1;var v1,v2,v3,v4;var s1,s2;do{v1=RANDOM()*2-1;v2=RANDOM()*2-1;s1=v1*v1+v2*v2;}while(s1>=1);do{v3=RANDOM()*2-1;v4=RANDOM()*2-1;s2=v3*v3+v4*v4;}while(s2>=1);var d=Math.sqrt((1-s1)/s2);out[0]=scale*v1;out[1]=scale*v2;out[2]=scale*v3*d;out[3]=scale*v4*d;return out;}function transformMat4$1(out,a,m){var x=a[0],y=a[1],z=a[2],w=a[3];out[0]=m[0]*x+m[4]*y+m[8]*z+m[12]*w;out[1]=m[1]*x+m[5]*y+m[9]*z+m[13]*w;out[2]=m[2]*x+m[6]*y+m[10]*z+m[14]*w;out[3]=m[3]*x+m[7]*y+m[11]*z+m[15]*w;return out;}function transformQuat(out,a,q){var x=a[0],y=a[1],z=a[2];var qx=q[0],qy=q[1],qz=q[2],qw=q[3];var ix=qw*x+qy*z-qz*y;var iy=qw*y+qz*x-qx*z;var iz=qw*z+qx*y-qy*x;var iw=-qx*x-qy*y-qz*z;out[0]=ix*qw+iw*-qx+iy*-qz-iz*-qy;out[1]=iy*qw+iw*-qy+iz*-qx-ix*-qz;out[2]=iz*qw+iw*-qz+ix*-qy-iy*-qx;out[3]=a[3];return out;}function zero$1(out){out[0]=0;out[1]=0;out[2]=0;out[3]=0;return out;}function str$3(a){return"vec4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")";}function exactEquals$3(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3];}function equals$3(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3));}var sub$1=subtract$1;var mul$3=multiply$3;var div$1=divide$1;var dist$1=distance$1;var sqrDist$1=squaredDistance$1;var len$3=length$3;var sqrLen$3=squaredLength$3;var forEach$1=function(){var vec=create$3();return function(a,stride,offset,count,fn,arg){var i,l;if(!stride)stride=4;if(!offset)offset=0;if(count)l=Math.min(count*stride+offset,a.length);else l=a.length;for(i=offset;i<l;i+=stride){vec[0]=a[i];vec[1]=a[i+1];vec[2]=a[i+2];vec[3]=a[i+3];fn(vec,vec,arg);a[i]=vec[0];a[i+1]=vec[1];a[i+2]=vec[2];a[i+3]=vec[3];}return a;};}();var vec4=Object.freeze({__proto__:null,create:create$3,clone:clone$3,fromValues:fromValues$3,copy:copy$3,set:set$3,add:add$3,subtract:subtract$1,multiply:multiply$3,divide:divide$1,ceil:ceil$1,floor:floor$1,min:min$1,max:max$1,round:round$1,scale:scale$3,scaleAndAdd:scaleAndAdd$1,distance:distance$1,squaredDistance:squaredDistance$1,length:length$3,squaredLength:squaredLength$3,negate:negate$1,inverse:inverse$1,normalize:normalize$3,dot:dot$3,cross:cross$1,lerp:lerp$3,random:random$2,transformMat4:transformMat4$1,transformQuat:transformQuat,zero:zero$1,str:str$3,exactEquals:exactEquals$3,equals:equals$3,sub:sub$1,mul:mul$3,div:div$1,dist:dist$1,sqrDist:sqrDist$1,len:len$3,sqrLen:sqrLen$3,forEach:forEach$1});function create$2(){var out=new ARRAY_TYPE(4);if(ARRAY_TYPE!=Float32Array){out[0]=0;out[1]=0;out[2]=0;}out[3]=1;return out;}function identity$1(out){out[0]=0;out[1]=0;out[2]=0;out[3]=1;return out;}function setAxisAngle(out,axis,rad){rad=rad*.5;var s=Math.sin(rad);out[0]=s*axis[0];out[1]=s*axis[1];out[2]=s*axis[2];out[3]=Math.cos(rad);return out;}function getAxisAngle(out_axis,q){var rad=Math.acos(q[3])*2;var s=Math.sin(rad/2);if(s>EPSILON){out_axis[0]=q[0]/s;out_axis[1]=q[1]/s;out_axis[2]=q[2]/s;}else{out_axis[0]=1;out_axis[1]=0;out_axis[2]=0;}return rad;}function getAngle(a,b){var dotproduct=dot$2(a,b);return Math.acos(2*dotproduct*dotproduct-1);}function multiply$2(out,a,b){var ax=a[0],ay=a[1],az=a[2],aw=a[3];var bx=b[0],by=b[1],bz=b[2],bw=b[3];out[0]=ax*bw+aw*bx+ay*bz-az*by;out[1]=ay*bw+aw*by+az*bx-ax*bz;out[2]=az*bw+aw*bz+ax*by-ay*bx;out[3]=aw*bw-ax*bx-ay*by-az*bz;return out;}function rotateX$1(out,a,rad){rad*=.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3];var bx=Math.sin(rad),bw=Math.cos(rad);out[0]=ax*bw+aw*bx;out[1]=ay*bw+az*bx;out[2]=az*bw-ay*bx;out[3]=aw*bw-ax*bx;return out;}function rotateY$1(out,a,rad){rad*=.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3];var by=Math.sin(rad),bw=Math.cos(rad);out[0]=ax*bw-az*by;out[1]=ay*bw+aw*by;out[2]=az*bw+ax*by;out[3]=aw*bw-ay*by;return out;}function rotateZ$1(out,a,rad){rad*=.5;var ax=a[0],ay=a[1],az=a[2],aw=a[3];var bz=Math.sin(rad),bw=Math.cos(rad);out[0]=ax*bw+ay*bz;out[1]=ay*bw-ax*bz;out[2]=az*bw+aw*bz;out[3]=aw*bw-az*bz;return out;}function calculateW(out,a){var x=a[0],y=a[1],z=a[2];out[0]=x;out[1]=y;out[2]=z;out[3]=Math.sqrt(Math.abs(1-x*x-y*y-z*z));return out;}function exp(out,a){var x=a[0],y=a[1],z=a[2],w=a[3];var r=Math.sqrt(x*x+y*y+z*z);var et=Math.exp(w);var s=r>0?et*Math.sin(r)/r:0;out[0]=x*s;out[1]=y*s;out[2]=z*s;out[3]=et*Math.cos(r);return out;}function ln(out,a){var x=a[0],y=a[1],z=a[2],w=a[3];var r=Math.sqrt(x*x+y*y+z*z);var t=r>0?Math.atan2(r,w)/r:0;out[0]=x*t;out[1]=y*t;out[2]=z*t;out[3]=.5*Math.log(x*x+y*y+z*z+w*w);return out;}function pow(out,a,b){ln(out,a);scale$2(out,out,b);exp(out,out);return out;}function slerp(out,a,b,t){var ax=a[0],ay=a[1],az=a[2],aw=a[3];var bx=b[0],by=b[1],bz=b[2],bw=b[3];var omega,cosom,sinom,scale0,scale1;cosom=ax*bx+ay*by+az*bz+aw*bw;if(cosom<0){cosom=-cosom;bx=-bx;by=-by;bz=-bz;bw=-bw;}if(1-cosom>EPSILON){omega=Math.acos(cosom);sinom=Math.sin(omega);scale0=Math.sin((1-t)*omega)/sinom;scale1=Math.sin(t*omega)/sinom;}else{scale0=1-t;scale1=t;}out[0]=scale0*ax+scale1*bx;out[1]=scale0*ay+scale1*by;out[2]=scale0*az+scale1*bz;out[3]=scale0*aw+scale1*bw;return out;}function random$1(out){var u1=RANDOM();var u2=RANDOM();var u3=RANDOM();var sqrt1MinusU1=Math.sqrt(1-u1);var sqrtU1=Math.sqrt(u1);out[0]=sqrt1MinusU1*Math.sin(2*Math.PI*u2);out[1]=sqrt1MinusU1*Math.cos(2*Math.PI*u2);out[2]=sqrtU1*Math.sin(2*Math.PI*u3);out[3]=sqrtU1*Math.cos(2*Math.PI*u3);return out;}function invert$1(out,a){var a0=a[0],a1=a[1],a2=a[2],a3=a[3];var dot=a0*a0+a1*a1+a2*a2+a3*a3;var invDot=dot?1/dot:0;out[0]=-a0*invDot;out[1]=-a1*invDot;out[2]=-a2*invDot;out[3]=a3*invDot;return out;}function conjugate$1(out,a){out[0]=-a[0];out[1]=-a[1];out[2]=-a[2];out[3]=a[3];return out;}function fromMat3(out,m){var fTrace=m[0]+m[4]+m[8];var fRoot;if(fTrace>0){fRoot=Math.sqrt(fTrace+1);out[3]=.5*fRoot;fRoot=.5/fRoot;out[0]=(m[5]-m[7])*fRoot;out[1]=(m[6]-m[2])*fRoot;out[2]=(m[1]-m[3])*fRoot;}else{var i=0;if(m[4]>m[0])i=1;if(m[8]>m[i*3+i])i=2;var j=(i+1)%3;var k=(i+2)%3;fRoot=Math.sqrt(m[i*3+i]-m[j*3+j]-m[k*3+k]+1);out[i]=.5*fRoot;fRoot=.5/fRoot;out[3]=(m[j*3+k]-m[k*3+j])*fRoot;out[j]=(m[j*3+i]+m[i*3+j])*fRoot;out[k]=(m[k*3+i]+m[i*3+k])*fRoot;}return out;}function fromEuler(out,x,y,z){var order=arguments.length>4&&arguments[4]!==undefined?arguments[4]:ANGLE_ORDER;var halfToRad=Math.PI/360;x*=halfToRad;z*=halfToRad;y*=halfToRad;var sx=Math.sin(x);var cx=Math.cos(x);var sy=Math.sin(y);var cy=Math.cos(y);var sz=Math.sin(z);var cz=Math.cos(z);switch(order){case"xyz":out[0]=sx*cy*cz+cx*sy*sz;out[1]=cx*sy*cz-sx*cy*sz;out[2]=cx*cy*sz+sx*sy*cz;out[3]=cx*cy*cz-sx*sy*sz;break;case"xzy":out[0]=sx*cy*cz-cx*sy*sz;out[1]=cx*sy*cz-sx*cy*sz;out[2]=cx*cy*sz+sx*sy*cz;out[3]=cx*cy*cz+sx*sy*sz;break;case"yxz":out[0]=sx*cy*cz+cx*sy*sz;out[1]=cx*sy*cz-sx*cy*sz;out[2]=cx*cy*sz-sx*sy*cz;out[3]=cx*cy*cz+sx*sy*sz;break;case"yzx":out[0]=sx*cy*cz+cx*sy*sz;out[1]=cx*sy*cz+sx*cy*sz;out[2]=cx*cy*sz-sx*sy*cz;out[3]=cx*cy*cz-sx*sy*sz;break;case"zxy":out[0]=sx*cy*cz-cx*sy*sz;out[1]=cx*sy*cz+sx*cy*sz;out[2]=cx*cy*sz+sx*sy*cz;out[3]=cx*cy*cz-sx*sy*sz;break;case"zyx":out[0]=sx*cy*cz-cx*sy*sz;out[1]=cx*sy*cz+sx*cy*sz;out[2]=cx*cy*sz-sx*sy*cz;out[3]=cx*cy*cz+sx*sy*sz;break;default:throw new Error("Unknown angle order "+order);}return out;}function str$2(a){return"quat("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+")";}var clone$2=clone$3;var fromValues$2=fromValues$3;var copy$2=copy$3;var set$2=set$3;var add$2=add$3;var mul$2=multiply$2;var scale$2=scale$3;var dot$2=dot$3;var lerp$2=lerp$3;var length$2=length$3;var len$2=length$2;var squaredLength$2=squaredLength$3;var sqrLen$2=squaredLength$2;var normalize$2=normalize$3;var exactEquals$2=exactEquals$3;function equals$2(a,b){return Math.abs(dot$3(a,b))>=1-EPSILON;}var rotationTo=function(){var tmpvec3=create$4();var xUnitVec3=fromValues$4(1,0,0);var yUnitVec3=fromValues$4(0,1,0);return function(out,a,b){var dot=dot$4(a,b);if(dot<-.999999){cross$2(tmpvec3,xUnitVec3,a);if(len$4(tmpvec3)<1E-6)cross$2(tmpvec3,yUnitVec3,a);normalize$4(tmpvec3,tmpvec3);setAxisAngle(out,tmpvec3,Math.PI);return out;}else if(dot>.999999){out[0]=0;out[1]=0;out[2]=0;out[3]=1;return out;}else{cross$2(tmpvec3,a,b);out[0]=tmpvec3[0];out[1]=tmpvec3[1];out[2]=tmpvec3[2];out[3]=1+dot;return normalize$2(out,out);}};}();var sqlerp=function(){var temp1=create$2();var temp2=create$2();return function(out,a,b,c,d,t){slerp(temp1,a,d,t);slerp(temp2,b,c,t);slerp(out,temp1,temp2,2*t*(1-t));return out;};}();var setAxes=function(){var matr=create$6();return function(out,view,right,up){matr[0]=right[0];matr[3]=right[1];matr[6]=right[2];matr[1]=up[0];matr[4]=up[1];matr[7]=up[2];matr[2]=-view[0];matr[5]=-view[1];matr[8]=-view[2];return normalize$2(out,fromMat3(out,matr));};}();var quat=Object.freeze({__proto__:null,create:create$2,identity:identity$1,setAxisAngle:setAxisAngle,getAxisAngle:getAxisAngle,getAngle:getAngle,multiply:multiply$2,rotateX:rotateX$1,rotateY:rotateY$1,rotateZ:rotateZ$1,calculateW:calculateW,exp:exp,ln:ln,pow:pow,slerp:slerp,random:random$1,invert:invert$1,conjugate:conjugate$1,fromMat3:fromMat3,fromEuler:fromEuler,str:str$2,clone:clone$2,fromValues:fromValues$2,copy:copy$2,set:set$2,add:add$2,mul:mul$2,scale:scale$2,dot:dot$2,lerp:lerp$2,length:length$2,len:len$2,squaredLength:squaredLength$2,sqrLen:sqrLen$2,normalize:normalize$2,exactEquals:exactEquals$2,equals:equals$2,rotationTo:rotationTo,sqlerp:sqlerp,setAxes:setAxes});function create$1(){var dq=new ARRAY_TYPE(8);if(ARRAY_TYPE!=Float32Array){dq[0]=0;dq[1]=0;dq[2]=0;dq[4]=0;dq[5]=0;dq[6]=0;dq[7]=0;}dq[3]=1;return dq;}function clone$1(a){var dq=new ARRAY_TYPE(8);dq[0]=a[0];dq[1]=a[1];dq[2]=a[2];dq[3]=a[3];dq[4]=a[4];dq[5]=a[5];dq[6]=a[6];dq[7]=a[7];return dq;}function fromValues$1(x1,y1,z1,w1,x2,y2,z2,w2){var dq=new ARRAY_TYPE(8);dq[0]=x1;dq[1]=y1;dq[2]=z1;dq[3]=w1;dq[4]=x2;dq[5]=y2;dq[6]=z2;dq[7]=w2;return dq;}function fromRotationTranslationValues(x1,y1,z1,w1,x2,y2,z2){var dq=new ARRAY_TYPE(8);dq[0]=x1;dq[1]=y1;dq[2]=z1;dq[3]=w1;var ax=x2*.5,ay=y2*.5,az=z2*.5;dq[4]=ax*w1+ay*z1-az*y1;dq[5]=ay*w1+az*x1-ax*z1;dq[6]=az*w1+ax*y1-ay*x1;dq[7]=-ax*x1-ay*y1-az*z1;return dq;}function fromRotationTranslation(out,q,t){var ax=t[0]*.5,ay=t[1]*.5,az=t[2]*.5,bx=q[0],by=q[1],bz=q[2],bw=q[3];out[0]=bx;out[1]=by;out[2]=bz;out[3]=bw;out[4]=ax*bw+ay*bz-az*by;out[5]=ay*bw+az*bx-ax*bz;out[6]=az*bw+ax*by-ay*bx;out[7]=-ax*bx-ay*by-az*bz;return out;}function fromTranslation(out,t){out[0]=0;out[1]=0;out[2]=0;out[3]=1;out[4]=t[0]*.5;out[5]=t[1]*.5;out[6]=t[2]*.5;out[7]=0;return out;}function fromRotation(out,q){out[0]=q[0];out[1]=q[1];out[2]=q[2];out[3]=q[3];out[4]=0;out[5]=0;out[6]=0;out[7]=0;return out;}function fromMat4(out,a){var outer=create$2();getRotation(outer,a);var t=new ARRAY_TYPE(3);getTranslation$1(t,a);fromRotationTranslation(out,outer,t);return out;}function copy$1(out,a){out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];return out;}function identity(out){out[0]=0;out[1]=0;out[2]=0;out[3]=1;out[4]=0;out[5]=0;out[6]=0;out[7]=0;return out;}function set$1(out,x1,y1,z1,w1,x2,y2,z2,w2){out[0]=x1;out[1]=y1;out[2]=z1;out[3]=w1;out[4]=x2;out[5]=y2;out[6]=z2;out[7]=w2;return out;}var getReal=copy$2;function getDual(out,a){out[0]=a[4];out[1]=a[5];out[2]=a[6];out[3]=a[7];return out;}var setReal=copy$2;function setDual(out,q){out[4]=q[0];out[5]=q[1];out[6]=q[2];out[7]=q[3];return out;}function getTranslation(out,a){var ax=a[4],ay=a[5],az=a[6],aw=a[7],bx=-a[0],by=-a[1],bz=-a[2],bw=a[3];out[0]=(ax*bw+aw*bx+ay*bz-az*by)*2;out[1]=(ay*bw+aw*by+az*bx-ax*bz)*2;out[2]=(az*bw+aw*bz+ax*by-ay*bx)*2;return out;}function translate(out,a,v){var ax1=a[0],ay1=a[1],az1=a[2],aw1=a[3],bx1=v[0]*.5,by1=v[1]*.5,bz1=v[2]*.5,ax2=a[4],ay2=a[5],az2=a[6],aw2=a[7];out[0]=ax1;out[1]=ay1;out[2]=az1;out[3]=aw1;out[4]=aw1*bx1+ay1*bz1-az1*by1+ax2;out[5]=aw1*by1+az1*bx1-ax1*bz1+ay2;out[6]=aw1*bz1+ax1*by1-ay1*bx1+az2;out[7]=-ax1*bx1-ay1*by1-az1*bz1+aw2;return out;}function rotateX(out,a,rad){var bx=-a[0],by=-a[1],bz=-a[2],bw=a[3],ax=a[4],ay=a[5],az=a[6],aw=a[7],ax1=ax*bw+aw*bx+ay*bz-az*by,ay1=ay*bw+aw*by+az*bx-ax*bz,az1=az*bw+aw*bz+ax*by-ay*bx,aw1=aw*bw-ax*bx-ay*by-az*bz;rotateX$1(out,a,rad);bx=out[0];by=out[1];bz=out[2];bw=out[3];out[4]=ax1*bw+aw1*bx+ay1*bz-az1*by;out[5]=ay1*bw+aw1*by+az1*bx-ax1*bz;out[6]=az1*bw+aw1*bz+ax1*by-ay1*bx;out[7]=aw1*bw-ax1*bx-ay1*by-az1*bz;return out;}function rotateY(out,a,rad){var bx=-a[0],by=-a[1],bz=-a[2],bw=a[3],ax=a[4],ay=a[5],az=a[6],aw=a[7],ax1=ax*bw+aw*bx+ay*bz-az*by,ay1=ay*bw+aw*by+az*bx-ax*bz,az1=az*bw+aw*bz+ax*by-ay*bx,aw1=aw*bw-ax*bx-ay*by-az*bz;rotateY$1(out,a,rad);bx=out[0];by=out[1];bz=out[2];bw=out[3];out[4]=ax1*bw+aw1*bx+ay1*bz-az1*by;out[5]=ay1*bw+aw1*by+az1*bx-ax1*bz;out[6]=az1*bw+aw1*bz+ax1*by-ay1*bx;out[7]=aw1*bw-ax1*bx-ay1*by-az1*bz;return out;}function rotateZ(out,a,rad){var bx=-a[0],by=-a[1],bz=-a[2],bw=a[3],ax=a[4],ay=a[5],az=a[6],aw=a[7],ax1=ax*bw+aw*bx+ay*bz-az*by,ay1=ay*bw+aw*by+az*bx-ax*bz,az1=az*bw+aw*bz+ax*by-ay*bx,aw1=aw*bw-ax*bx-ay*by-az*bz;rotateZ$1(out,a,rad);bx=out[0];by=out[1];bz=out[2];bw=out[3];out[4]=ax1*bw+aw1*bx+ay1*bz-az1*by;out[5]=ay1*bw+aw1*by+az1*bx-ax1*bz;out[6]=az1*bw+aw1*bz+ax1*by-ay1*bx;out[7]=aw1*bw-ax1*bx-ay1*by-az1*bz;return out;}function rotateByQuatAppend(out,a,q){var qx=q[0],qy=q[1],qz=q[2],qw=q[3],ax=a[0],ay=a[1],az=a[2],aw=a[3];out[0]=ax*qw+aw*qx+ay*qz-az*qy;out[1]=ay*qw+aw*qy+az*qx-ax*qz;out[2]=az*qw+aw*qz+ax*qy-ay*qx;out[3]=aw*qw-ax*qx-ay*qy-az*qz;ax=a[4];ay=a[5];az=a[6];aw=a[7];out[4]=ax*qw+aw*qx+ay*qz-az*qy;out[5]=ay*qw+aw*qy+az*qx-ax*qz;out[6]=az*qw+aw*qz+ax*qy-ay*qx;out[7]=aw*qw-ax*qx-ay*qy-az*qz;return out;}function rotateByQuatPrepend(out,q,a){var qx=q[0],qy=q[1],qz=q[2],qw=q[3],bx=a[0],by=a[1],bz=a[2],bw=a[3];out[0]=qx*bw+qw*bx+qy*bz-qz*by;out[1]=qy*bw+qw*by+qz*bx-qx*bz;out[2]=qz*bw+qw*bz+qx*by-qy*bx;out[3]=qw*bw-qx*bx-qy*by-qz*bz;bx=a[4];by=a[5];bz=a[6];bw=a[7];out[4]=qx*bw+qw*bx+qy*bz-qz*by;out[5]=qy*bw+qw*by+qz*bx-qx*bz;out[6]=qz*bw+qw*bz+qx*by-qy*bx;out[7]=qw*bw-qx*bx-qy*by-qz*bz;return out;}function rotateAroundAxis(out,a,axis,rad){if(Math.abs(rad)<EPSILON)return copy$1(out,a);var axisLength=Math.hypot(axis[0],axis[1],axis[2]);rad=rad*.5;var s=Math.sin(rad);var bx=s*axis[0]/axisLength;var by=s*axis[1]/axisLength;var bz=s*axis[2]/axisLength;var bw=Math.cos(rad);var ax1=a[0],ay1=a[1],az1=a[2],aw1=a[3];out[0]=ax1*bw+aw1*bx+ay1*bz-az1*by;out[1]=ay1*bw+aw1*by+az1*bx-ax1*bz;out[2]=az1*bw+aw1*bz+ax1*by-ay1*bx;out[3]=aw1*bw-ax1*bx-ay1*by-az1*bz;var ax=a[4],ay=a[5],az=a[6],aw=a[7];out[4]=ax*bw+aw*bx+ay*bz-az*by;out[5]=ay*bw+aw*by+az*bx-ax*bz;out[6]=az*bw+aw*bz+ax*by-ay*bx;out[7]=aw*bw-ax*bx-ay*by-az*bz;return out;}function add$1(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];out[2]=a[2]+b[2];out[3]=a[3]+b[3];out[4]=a[4]+b[4];out[5]=a[5]+b[5];out[6]=a[6]+b[6];out[7]=a[7]+b[7];return out;}function multiply$1(out,a,b){var ax0=a[0],ay0=a[1],az0=a[2],aw0=a[3],bx1=b[4],by1=b[5],bz1=b[6],bw1=b[7],ax1=a[4],ay1=a[5],az1=a[6],aw1=a[7],bx0=b[0],by0=b[1],bz0=b[2],bw0=b[3];out[0]=ax0*bw0+aw0*bx0+ay0*bz0-az0*by0;out[1]=ay0*bw0+aw0*by0+az0*bx0-ax0*bz0;out[2]=az0*bw0+aw0*bz0+ax0*by0-ay0*bx0;out[3]=aw0*bw0-ax0*bx0-ay0*by0-az0*bz0;out[4]=ax0*bw1+aw0*bx1+ay0*bz1-az0*by1+ax1*bw0+aw1*bx0+ay1*bz0-az1*by0;out[5]=ay0*bw1+aw0*by1+az0*bx1-ax0*bz1+ay1*bw0+aw1*by0+az1*bx0-ax1*bz0;out[6]=az0*bw1+aw0*bz1+ax0*by1-ay0*bx1+az1*bw0+aw1*bz0+ax1*by0-ay1*bx0;out[7]=aw0*bw1-ax0*bx1-ay0*by1-az0*bz1+aw1*bw0-ax1*bx0-ay1*by0-az1*bz0;return out;}var mul$1=multiply$1;function scale$1(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;out[2]=a[2]*b;out[3]=a[3]*b;out[4]=a[4]*b;out[5]=a[5]*b;out[6]=a[6]*b;out[7]=a[7]*b;return out;}var dot$1=dot$2;function lerp$1(out,a,b,t){var mt=1-t;if(dot$1(a,b)<0)t=-t;out[0]=a[0]*mt+b[0]*t;out[1]=a[1]*mt+b[1]*t;out[2]=a[2]*mt+b[2]*t;out[3]=a[3]*mt+b[3]*t;out[4]=a[4]*mt+b[4]*t;out[5]=a[5]*mt+b[5]*t;out[6]=a[6]*mt+b[6]*t;out[7]=a[7]*mt+b[7]*t;return out;}function invert(out,a){var sqlen=squaredLength$1(a);out[0]=-a[0]/sqlen;out[1]=-a[1]/sqlen;out[2]=-a[2]/sqlen;out[3]=a[3]/sqlen;out[4]=-a[4]/sqlen;out[5]=-a[5]/sqlen;out[6]=-a[6]/sqlen;out[7]=a[7]/sqlen;return out;}function conjugate(out,a){out[0]=-a[0];out[1]=-a[1];out[2]=-a[2];out[3]=a[3];out[4]=-a[4];out[5]=-a[5];out[6]=-a[6];out[7]=a[7];return out;}var length$1=length$2;var len$1=length$1;var squaredLength$1=squaredLength$2;var sqrLen$1=squaredLength$1;function normalize$1(out,a){var magnitude=squaredLength$1(a);if(magnitude>0){magnitude=Math.sqrt(magnitude);var a0=a[0]/magnitude;var a1=a[1]/magnitude;var a2=a[2]/magnitude;var a3=a[3]/magnitude;var b0=a[4];var b1=a[5];var b2=a[6];var b3=a[7];var a_dot_b=a0*b0+a1*b1+a2*b2+a3*b3;out[0]=a0;out[1]=a1;out[2]=a2;out[3]=a3;out[4]=(b0-a0*a_dot_b)/magnitude;out[5]=(b1-a1*a_dot_b)/magnitude;out[6]=(b2-a2*a_dot_b)/magnitude;out[7]=(b3-a3*a_dot_b)/magnitude;}return out;}function str$1(a){return"quat2("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+")";}function exactEquals$1(a,b){return a[0]===b[0]&&a[1]===b[1]&&a[2]===b[2]&&a[3]===b[3]&&a[4]===b[4]&&a[5]===b[5]&&a[6]===b[6]&&a[7]===b[7];}function equals$1(a,b){var a0=a[0],a1=a[1],a2=a[2],a3=a[3],a4=a[4],a5=a[5],a6=a[6],a7=a[7];var b0=b[0],b1=b[1],b2=b[2],b3=b[3],b4=b[4],b5=b[5],b6=b[6],b7=b[7];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1))&&Math.abs(a2-b2)<=EPSILON*Math.max(1,Math.abs(a2),Math.abs(b2))&&Math.abs(a3-b3)<=EPSILON*Math.max(1,Math.abs(a3),Math.abs(b3))&&Math.abs(a4-b4)<=EPSILON*Math.max(1,Math.abs(a4),Math.abs(b4))&&Math.abs(a5-b5)<=EPSILON*Math.max(1,Math.abs(a5),Math.abs(b5))&&Math.abs(a6-b6)<=EPSILON*Math.max(1,Math.abs(a6),Math.abs(b6))&&Math.abs(a7-b7)<=EPSILON*Math.max(1,Math.abs(a7),Math.abs(b7));}var quat2=Object.freeze({__proto__:null,create:create$1,clone:clone$1,fromValues:fromValues$1,fromRotationTranslationValues:fromRotationTranslationValues,fromRotationTranslation:fromRotationTranslation,fromTranslation:fromTranslation,fromRotation:fromRotation,fromMat4:fromMat4,copy:copy$1,identity:identity,set:set$1,getReal:getReal,getDual:getDual,setReal:setReal,setDual:setDual,getTranslation:getTranslation,translate:translate,rotateX:rotateX,rotateY:rotateY,rotateZ:rotateZ,rotateByQuatAppend:rotateByQuatAppend,rotateByQuatPrepend:rotateByQuatPrepend,rotateAroundAxis:rotateAroundAxis,add:add$1,multiply:multiply$1,mul:mul$1,scale:scale$1,dot:dot$1,lerp:lerp$1,invert:invert,conjugate:conjugate,length:length$1,len:len$1,squaredLength:squaredLength$1,sqrLen:sqrLen$1,normalize:normalize$1,str:str$1,exactEquals:exactEquals$1,equals:equals$1});function create(){var out=new ARRAY_TYPE(2);if(ARRAY_TYPE!=Float32Array){out[0]=0;out[1]=0;}return out;}function clone(a){var out=new ARRAY_TYPE(2);out[0]=a[0];out[1]=a[1];return out;}function fromValues(x,y){var out=new ARRAY_TYPE(2);out[0]=x;out[1]=y;return out;}function copy(out,a){out[0]=a[0];out[1]=a[1];return out;}function set(out,x,y){out[0]=x;out[1]=y;return out;}function add(out,a,b){out[0]=a[0]+b[0];out[1]=a[1]+b[1];return out;}function subtract(out,a,b){out[0]=a[0]-b[0];out[1]=a[1]-b[1];return out;}function multiply(out,a,b){out[0]=a[0]*b[0];out[1]=a[1]*b[1];return out;}function divide(out,a,b){out[0]=a[0]/b[0];out[1]=a[1]/b[1];return out;}function ceil(out,a){out[0]=Math.ceil(a[0]);out[1]=Math.ceil(a[1]);return out;}function floor(out,a){out[0]=Math.floor(a[0]);out[1]=Math.floor(a[1]);return out;}function min(out,a,b){out[0]=Math.min(a[0],b[0]);out[1]=Math.min(a[1],b[1]);return out;}function max(out,a,b){out[0]=Math.max(a[0],b[0]);out[1]=Math.max(a[1],b[1]);return out;}function round(out,a){out[0]=Math.round(a[0]);out[1]=Math.round(a[1]);return out;}function scale(out,a,b){out[0]=a[0]*b;out[1]=a[1]*b;return out;}function scaleAndAdd(out,a,b,scale){out[0]=a[0]+b[0]*scale;out[1]=a[1]+b[1]*scale;return out;}function distance(a,b){var x=b[0]-a[0],y=b[1]-a[1];return Math.hypot(x,y);}function squaredDistance(a,b){var x=b[0]-a[0],y=b[1]-a[1];return x*x+y*y;}function length(a){var x=a[0],y=a[1];return Math.hypot(x,y);}function squaredLength(a){var x=a[0],y=a[1];return x*x+y*y;}function negate(out,a){out[0]=-a[0];out[1]=-a[1];return out;}function inverse(out,a){out[0]=1/a[0];out[1]=1/a[1];return out;}function normalize(out,a){var x=a[0],y=a[1];var len=x*x+y*y;if(len>0)len=1/Math.sqrt(len);out[0]=a[0]*len;out[1]=a[1]*len;return out;}function dot(a,b){return a[0]*b[0]+a[1]*b[1];}function cross(out,a,b){var z=a[0]*b[1]-a[1]*b[0];out[0]=out[1]=0;out[2]=z;return out;}function lerp(out,a,b,t){var ax=a[0],ay=a[1];out[0]=ax+t*(b[0]-ax);out[1]=ay+t*(b[1]-ay);return out;}function random(out,scale){scale=scale||1;var r=RANDOM()*2*Math.PI;out[0]=Math.cos(r)*scale;out[1]=Math.sin(r)*scale;return out;}function transformMat2(out,a,m){var x=a[0],y=a[1];out[0]=m[0]*x+m[2]*y;out[1]=m[1]*x+m[3]*y;return out;}function transformMat2d(out,a,m){var x=a[0],y=a[1];out[0]=m[0]*x+m[2]*y+m[4];out[1]=m[1]*x+m[3]*y+m[5];return out;}function transformMat3(out,a,m){var x=a[0],y=a[1];out[0]=m[0]*x+m[3]*y+m[6];out[1]=m[1]*x+m[4]*y+m[7];return out;}function transformMat4(out,a,m){var x=a[0];var y=a[1];out[0]=m[0]*x+m[4]*y+m[12];out[1]=m[1]*x+m[5]*y+m[13];return out;}function rotate(out,a,b,rad){var p0=a[0]-b[0],p1=a[1]-b[1],sinC=Math.sin(rad),cosC=Math.cos(rad);out[0]=p0*cosC-p1*sinC+b[0];out[1]=p0*sinC+p1*cosC+b[1];return out;}function angle(a,b){var x1=a[0],y1=a[1],x2=b[0],y2=b[1],mag=Math.sqrt((x1*x1+y1*y1)*(x2*x2+y2*y2)),cosine=mag&&(x1*x2+y1*y2)/mag;return Math.acos(Math.min(Math.max(cosine,-1),1));}function zero(out){out[0]=0;out[1]=0;return out;}function str(a){return"vec2("+a[0]+", "+a[1]+")";}function exactEquals(a,b){return a[0]===b[0]&&a[1]===b[1];}function equals(a,b){var a0=a[0],a1=a[1];var b0=b[0],b1=b[1];return Math.abs(a0-b0)<=EPSILON*Math.max(1,Math.abs(a0),Math.abs(b0))&&Math.abs(a1-b1)<=EPSILON*Math.max(1,Math.abs(a1),Math.abs(b1));}var len=length;var sub=subtract;var mul=multiply;var div=divide;var dist=distance;var sqrDist=squaredDistance;var sqrLen=squaredLength;var forEach=function(){var vec=create();return function(a,stride,offset,count,fn,arg){var i,l;if(!stride)stride=2;if(!offset)offset=0;if(count)l=Math.min(count*stride+offset,a.length);else l=a.length;for(i=offset;i<l;i+=stride){vec[0]=a[i];vec[1]=a[i+1];fn(vec,vec,arg);a[i]=vec[0];a[i+1]=vec[1];}return a;};}();var vec2=Object.freeze({__proto__:null,create:create,clone:clone,fromValues:fromValues,copy:copy,set:set,add:add,subtract:subtract,multiply:multiply,divide:divide,ceil:ceil,floor:floor,min:min,max:max,round:round,scale:scale,scaleAndAdd:scaleAndAdd,distance:distance,squaredDistance:squaredDistance,length:length,squaredLength:squaredLength,negate:negate,inverse:inverse,normalize:normalize,dot:dot,cross:cross,lerp:lerp,random:random,transformMat2:transformMat2,transformMat2d:transformMat2d,transformMat3:transformMat3,transformMat4:transformMat4,rotate:rotate,angle:angle,zero:zero,str:str,exactEquals:exactEquals,equals:equals,len:len,sub:sub,mul:mul,div:div,dist:dist,sqrDist:sqrDist,sqrLen:sqrLen,forEach:forEach});exports.glMatrix=common;exports.mat2=mat2;exports.mat2d=mat2d;exports.mat3=mat3;exports.mat4=mat4;exports.quat=quat;exports.quat2=quat2;exports.vec2=vec2;exports.vec3=vec3;exports.vec4=vec4;Object.defineProperty(exports,"__esModule",{value:true});});}// ../3rdparty/grapheme-splitter.js
{var GraphemeSplitter=function GraphemeSplitter(){function h(a,c){void 0===c&&(c=0);var b=a.charCodeAt(c);if(55296<=b&&56319>=b&&c<a.length-1){var d=b;a=a.charCodeAt(c+1);return 56320<=a&&57343>=a?1024*(d-55296)+(a-56320)+65536:d;}return 56320<=b&&57343>=b&&1<=c?(d=a.charCodeAt(c-1),a=b,55296<=d&&56319>=d?1024*(d-55296)+(a-56320)+65536:a):b;}function l(a,c,b){var d=[a].concat(c).concat([b]),e=d[d.length-2],g=d.lastIndexOf(14);if(1<g&&d.slice(1,g).every(function(f){return 3==f;})&&-1==[3,13,17].indexOf(a))return 2;a=d.lastIndexOf(4);if(0<a&&d.slice(1,a).every(function(f){return 4==f;})&&-1==[12,4].indexOf(e))return 1==d.filter(function(f){return 4==f;}).length%2?3:4;if(0==e&&1==b)return 0;if(2==e||0==e||1==e)return 14==b&&c.every(function(f){return 3==f;})?2:1;if(2==b||0==b||1==b)return 1;if(6!=e||6!=b&&7!=b&&9!=b&&10!=b){if(9!=e&&7!=e||7!=b&&8!=b){if(10!=e&&8!=e||8!=b){if(3==b||15==b||5==b||12==e)return 0;}else return 0;}else return 0;}else return 0;a=-1!=d.indexOf(3)?d.lastIndexOf(3)-1:d.length-2;return-1!=[13,17].indexOf(d[a])&&d.slice(a+1,-1).every(function(f){return 3==f;})&&14==b||15==e&&-1!=[16,17].indexOf(b)?0:-1!=c.indexOf(4)?2:4==e&&4==b?0:1;}function k(a){return 1536<=a&&1541>=a||1757==a||1807==a||2274==a||3406==a||69821==a||70082<=a&&70083>=a||72250==a||72326<=a&&72329>=a||73030==a?12:13==a?0:10==a?1:0<=a&&9>=a||11<=a&&12>=a||14<=a&&31>=a||127<=a&&159>=a||173==a||1564==a||6158==a||8203==a||8206<=a&&8207>=a||8232==a||8233==a||8234<=a&&8238>=a||8288<=a&&8292>=a||8293==a||8294<=a&&8303>=a||55296<=a&&57343>=a||65279==a||65520<=a&&65528>=a||65529<=a&&65531>=a||113824<=a&&113827>=a||119155<=a&&119162>=a||917504==a||917505==a||917506<=a&&917535>=a||917632<=a&&917759>=a||918E3<=a&&921599>=a?2:768<=a&&879>=a||1155<=a&&1159>=a||1160<=a&&1161>=a||1425<=a&&1469>=a||1471==a||1473<=a&&1474>=a||1476<=a&&1477>=a||1479==a||1552<=a&&1562>=a||1611<=a&&1631>=a||1648==a||1750<=a&&1756>=a||1759<=a&&1764>=a||1767<=a&&1768>=a||1770<=a&&1773>=a||1809==a||1840<=a&&1866>=a||1958<=a&&1968>=a||2027<=a&&2035>=a||2070<=a&&2073>=a||2075<=a&&2083>=a||2085<=a&&2087>=a||2089<=a&&2093>=a||2137<=a&&2139>=a||2260<=a&&2273>=a||2275<=a&&2306>=a||2362==a||2364==a||2369<=a&&2376>=a||2381==a||2385<=a&&2391>=a||2402<=a&&2403>=a||2433==a||2492==a||2494==a||2497<=a&&2500>=a||2509==a||2519==a||2530<=a&&2531>=a||2561<=a&&2562>=a||2620==a||2625<=a&&2626>=a||2631<=a&&2632>=a||2635<=a&&2637>=a||2641==a||2672<=a&&2673>=a||2677==a||2689<=a&&2690>=a||2748==a||2753<=a&&2757>=a||2759<=a&&2760>=a||2765==a||2786<=a&&2787>=a||2810<=a&&2815>=a||2817==a||2876==a||2878==a||2879==a||2881<=a&&2884>=a||2893==a||2902==a||2903==a||2914<=a&&2915>=a||2946==a||3006==a||3008==a||3021==a||3031==a||3072==a||3134<=a&&3136>=a||3142<=a&&3144>=a||3146<=a&&3149>=a||3157<=a&&3158>=a||3170<=a&&3171>=a||3201==a||3260==a||3263==a||3266==a||3270==a||3276<=a&&3277>=a||3285<=a&&3286>=a||3298<=a&&3299>=a||3328<=a&&3329>=a||3387<=a&&3388>=a||3390==a||3393<=a&&3396>=a||3405==a||3415==a||3426<=a&&3427>=a||3530==a||3535==a||3538<=a&&3540>=a||3542==a||3551==a||3633==a||3636<=a&&3642>=a||3655<=a&&3662>=a||3761==a||3764<=a&&3769>=a||3771<=a&&3772>=a||3784<=a&&3789>=a||3864<=a&&3865>=a||3893==a||3895==a||3897==a||3953<=a&&3966>=a||3968<=a&&3972>=a||3974<=a&&3975>=a||3981<=a&&3991>=a||3993<=a&&4028>=a||4038==a||4141<=a&&4144>=a||4146<=a&&4151>=a||4153<=a&&4154>=a||4157<=a&&4158>=a||4184<=a&&4185>=a||4190<=a&&4192>=a||4209<=a&&4212>=a||4226==a||4229<=a&&4230>=a||4237==a||4253==a||4957<=a&&4959>=a||5906<=a&&5908>=a||5938<=a&&5940>=a||5970<=a&&5971>=a||6002<=a&&6003>=a||6068<=a&&6069>=a||6071<=a&&6077>=a||6086==a||6089<=a&&6099>=a||6109==a||6155<=a&&6157>=a||6277<=a&&6278>=a||6313==a||6432<=a&&6434>=a||6439<=a&&6440>=a||6450==a||6457<=a&&6459>=a||6679<=a&&6680>=a||6683==a||6742==a||6744<=a&&6750>=a||6752==a||6754==a||6757<=a&&6764>=a||6771<=a&&6780>=a||6783==a||6832<=a&&6845>=a||6846==a||6912<=a&&6915>=a||6964==a||6966<=a&&6970>=a||6972==a||6978==a||7019<=a&&7027>=a||7040<=a&&7041>=a||7074<=a&&7077>=a||7080<=a&&7081>=a||7083<=a&&7085>=a||7142==a||7144<=a&&7145>=a||7149==a||7151<=a&&7153>=a||7212<=a&&7219>=a||7222<=a&&7223>=a||7376<=a&&7378>=a||7380<=a&&7392>=a||7394<=a&&7400>=a||7405==a||7412==a||7416<=a&&7417>=a||7616<=a&&7673>=a||7675<=a&&7679>=a||8204==a||8400<=a&&8412>=a||8413<=a&&8416>=a||8417==a||8418<=a&&8420>=a||8421<=a&&8432>=a||11503<=a&&11505>=a||11647==a||11744<=a&&11775>=a||12330<=a&&12333>=a||12334<=a&&12335>=a||12441<=a&&12442>=a||42607==a||42608<=a&&42610>=a||42612<=a&&42621>=a||42654<=a&&42655>=a||42736<=a&&42737>=a||43010==a||43014==a||43019==a||43045<=a&&43046>=a||43204<=a&&43205>=a||43232<=a&&43249>=a||43302<=a&&43309>=a||43335<=a&&43345>=a||43392<=a&&43394>=a||43443==a||43446<=a&&43449>=a||43452==a||43493==a||43561<=a&&43566>=a||43569<=a&&43570>=a||43573<=a&&43574>=a||43587==a||43596==a||43644==a||43696==a||43698<=a&&43700>=a||43703<=a&&43704>=a||43710<=a&&43711>=a||43713==a||43756<=a&&43757>=a||43766==a||44005==a||44008==a||44013==a||64286==a||65024<=a&&65039>=a||65056<=a&&65071>=a||65438<=a&&65439>=a||66045==a||66272==a||66422<=a&&66426>=a||68097<=a&&68099>=a||68101<=a&&68102>=a||68108<=a&&68111>=a||68152<=a&&68154>=a||68159==a||68325<=a&&68326>=a||69633==a||69688<=a&&69702>=a||69759<=a&&69761>=a||69811<=a&&69814>=a||69817<=a&&69818>=a||69888<=a&&69890>=a||69927<=a&&69931>=a||69933<=a&&69940>=a||70003==a||70016<=a&&70017>=a||70070<=a&&70078>=a||70090<=a&&70092>=a||70191<=a&&70193>=a||70196==a||70198<=a&&70199>=a||70206==a||70367==a||70371<=a&&70378>=a||70400<=a&&70401>=a||70460==a||70462==a||70464==a||70487==a||70502<=a&&70508>=a||70512<=a&&70516>=a||70712<=a&&70719>=a||70722<=a&&70724>=a||70726==a||70832==a||70835<=a&&70840>=a||70842==a||70845==a||70847<=a&&70848>=a||70850<=a&&70851>=a||71087==a||71090<=a&&71093>=a||71100<=a&&71101>=a||71103<=a&&71104>=a||71132<=a&&71133>=a||71219<=a&&71226>=a||71229==a||71231<=a&&71232>=a||71339==a||71341==a||71344<=a&&71349>=a||71351==a||71453<=a&&71455>=a||71458<=a&&71461>=a||71463<=a&&71467>=a||72193<=a&&72198>=a||72201<=a&&72202>=a||72243<=a&&72248>=a||72251<=a&&72254>=a||72263==a||72273<=a&&72278>=a||72281<=a&&72283>=a||72330<=a&&72342>=a||72344<=a&&72345>=a||72752<=a&&72758>=a||72760<=a&&72765>=a||72767==a||72850<=a&&72871>=a||72874<=a&&72880>=a||72882<=a&&72883>=a||72885<=a&&72886>=a||73009<=a&&73014>=a||73018==a||73020<=a&&73021>=a||73023<=a&&73029>=a||73031==a||92912<=a&&92916>=a||92976<=a&&92982>=a||94095<=a&&94098>=a||113821<=a&&113822>=a||119141==a||119143<=a&&119145>=a||119150<=a&&119154>=a||119163<=a&&119170>=a||119173<=a&&119179>=a||119210<=a&&119213>=a||119362<=a&&119364>=a||121344<=a&&121398>=a||121403<=a&&121452>=a||121461==a||121476==a||121499<=a&&121503>=a||121505<=a&&121519>=a||122880<=a&&122886>=a||122888<=a&&122904>=a||122907<=a&&122913>=a||122915<=a&&122916>=a||122918<=a&&122922>=a||125136<=a&&125142>=a||125252<=a&&125258>=a||917536<=a&&917631>=a||917760<=a&&917999>=a?3:127462<=a&&127487>=a?4:2307==a||2363==a||2366<=a&&2368>=a||2377<=a&&2380>=a||2382<=a&&2383>=a||2434<=a&&2435>=a||2495<=a&&2496>=a||2503<=a&&2504>=a||2507<=a&&2508>=a||2563==a||2622<=a&&2624>=a||2691==a||2750<=a&&2752>=a||2761==a||2763<=a&&2764>=a||2818<=a&&2819>=a||2880==a||2887<=a&&2888>=a||2891<=a&&2892>=a||3007==a||3009<=a&&3010>=a||3014<=a&&3016>=a||3018<=a&&3020>=a||3073<=a&&3075>=a||3137<=a&&3140>=a||3202<=a&&3203>=a||3262==a||3264<=a&&3265>=a||3267<=a&&3268>=a||3271<=a&&3272>=a||3274<=a&&3275>=a||3330<=a&&3331>=a||3391<=a&&3392>=a||3398<=a&&3400>=a||3402<=a&&3404>=a||3458<=a&&3459>=a||3536<=a&&3537>=a||3544<=a&&3550>=a||3570<=a&&3571>=a||3635==a||3763==a||3902<=a&&3903>=a||3967==a||4145==a||4155<=a&&4156>=a||4182<=a&&4183>=a||4228==a||6070==a||6078<=a&&6085>=a||6087<=a&&6088>=a||6435<=a&&6438>=a||6441<=a&&6443>=a||6448<=a&&6449>=a||6451<=a&&6456>=a||6681<=a&&6682>=a||6741==a||6743==a||6765<=a&&6770>=a||6916==a||6965==a||6971==a||6973<=a&&6977>=a||6979<=a&&6980>=a||7042==a||7073==a||7078<=a&&7079>=a||7082==a||7143==a||7146<=a&&7148>=a||7150==a||7154<=a&&7155>=a||7204<=a&&7211>=a||7220<=a&&7221>=a||7393==a||7410<=a&&7411>=a||7415==a||43043<=a&&43044>=a||43047==a||43136<=a&&43137>=a||43188<=a&&43203>=a||43346<=a&&43347>=a||43395==a||43444<=a&&43445>=a||43450<=a&&43451>=a||43453<=a&&43456>=a||43567<=a&&43568>=a||43571<=a&&43572>=a||43597==a||43755==a||43758<=a&&43759>=a||43765==a||44003<=a&&44004>=a||44006<=a&&44007>=a||44009<=a&&44010>=a||44012==a||69632==a||69634==a||69762==a||69808<=a&&69810>=a||69815<=a&&69816>=a||69932==a||70018==a||70067<=a&&70069>=a||70079<=a&&70080>=a||70188<=a&&70190>=a||70194<=a&&70195>=a||70197==a||70368<=a&&70370>=a||70402<=a&&70403>=a||70463==a||70465<=a&&70468>=a||70471<=a&&70472>=a||70475<=a&&70477>=a||70498<=a&&70499>=a||70709<=a&&70711>=a||70720<=a&&70721>=a||70725==a||70833<=a&&70834>=a||70841==a||70843<=a&&70844>=a||70846==a||70849==a||71088<=a&&71089>=a||71096<=a&&71099>=a||71102==a||71216<=a&&71218>=a||71227<=a&&71228>=a||71230==a||71340==a||71342<=a&&71343>=a||71350==a||71456<=a&&71457>=a||71462==a||72199<=a&&72200>=a||72249==a||72279<=a&&72280>=a||72343==a||72751==a||72766==a||72873==a||72881==a||72884==a||94033<=a&&94078>=a||119142==a||119149==a?5:4352<=a&&4447>=a||43360<=a&&43388>=a?6:4448<=a&&4519>=a||55216<=a&&55238>=a?7:4520<=a&&4607>=a||55243<=a&&55291>=a?8:44032==a||44060==a||44088==a||44116==a||44144==a||44172==a||44200==a||44228==a||44256==a||44284==a||44312==a||44340==a||44368==a||44396==a||44424==a||44452==a||44480==a||44508==a||44536==a||44564==a||44592==a||44620==a||44648==a||44676==a||44704==a||44732==a||44760==a||44788==a||44816==a||44844==a||44872==a||44900==a||44928==a||44956==a||44984==a||45012==a||45040==a||45068==a||45096==a||45124==a||45152==a||45180==a||45208==a||45236==a||45264==a||45292==a||45320==a||45348==a||45376==a||45404==a||45432==a||45460==a||45488==a||45516==a||45544==a||45572==a||45600==a||45628==a||45656==a||45684==a||45712==a||45740==a||45768==a||45796==a||45824==a||45852==a||45880==a||45908==a||45936==a||45964==a||45992==a||46020==a||46048==a||46076==a||46104==a||46132==a||46160==a||46188==a||46216==a||46244==a||46272==a||46300==a||46328==a||46356==a||46384==a||46412==a||46440==a||46468==a||46496==a||46524==a||46552==a||46580==a||46608==a||46636==a||46664==a||46692==a||46720==a||46748==a||46776==a||46804==a||46832==a||46860==a||46888==a||46916==a||46944==a||46972==a||47E3==a||47028==a||47056==a||47084==a||47112==a||47140==a||47168==a||47196==a||47224==a||47252==a||47280==a||47308==a||47336==a||47364==a||47392==a||47420==a||47448==a||47476==a||47504==a||47532==a||47560==a||47588==a||47616==a||47644==a||47672==a||47700==a||47728==a||47756==a||47784==a||47812==a||47840==a||47868==a||47896==a||47924==a||47952==a||47980==a||48008==a||48036==a||48064==a||48092==a||48120==a||48148==a||48176==a||48204==a||48232==a||48260==a||48288==a||48316==a||48344==a||48372==a||48400==a||48428==a||48456==a||48484==a||48512==a||48540==a||48568==a||48596==a||48624==a||48652==a||48680==a||48708==a||48736==a||48764==a||48792==a||48820==a||48848==a||48876==a||48904==a||48932==a||48960==a||48988==a||49016==a||49044==a||49072==a||49100==a||49128==a||49156==a||49184==a||49212==a||49240==a||49268==a||49296==a||49324==a||49352==a||49380==a||49408==a||49436==a||49464==a||49492==a||49520==a||49548==a||49576==a||49604==a||49632==a||49660==a||49688==a||49716==a||49744==a||49772==a||49800==a||49828==a||49856==a||49884==a||49912==a||49940==a||49968==a||49996==a||50024==a||50052==a||50080==a||50108==a||50136==a||50164==a||50192==a||50220==a||50248==a||50276==a||50304==a||50332==a||50360==a||50388==a||50416==a||50444==a||50472==a||50500==a||50528==a||50556==a||50584==a||50612==a||50640==a||50668==a||50696==a||50724==a||50752==a||50780==a||50808==a||50836==a||50864==a||50892==a||50920==a||50948==a||50976==a||51004==a||51032==a||51060==a||51088==a||51116==a||51144==a||51172==a||51200==a||51228==a||51256==a||51284==a||51312==a||51340==a||51368==a||51396==a||51424==a||51452==a||51480==a||51508==a||51536==a||51564==a||51592==a||51620==a||51648==a||51676==a||51704==a||51732==a||51760==a||51788==a||51816==a||51844==a||51872==a||51900==a||51928==a||51956==a||51984==a||52012==a||52040==a||52068==a||52096==a||52124==a||52152==a||52180==a||52208==a||52236==a||52264==a||52292==a||52320==a||52348==a||52376==a||52404==a||52432==a||52460==a||52488==a||52516==a||52544==a||52572==a||52600==a||52628==a||52656==a||52684==a||52712==a||52740==a||52768==a||52796==a||52824==a||52852==a||52880==a||52908==a||52936==a||52964==a||52992==a||53020==a||53048==a||53076==a||53104==a||53132==a||53160==a||53188==a||53216==a||53244==a||53272==a||53300==a||53328==a||53356==a||53384==a||53412==a||53440==a||53468==a||53496==a||53524==a||53552==a||53580==a||53608==a||53636==a||53664==a||53692==a||53720==a||53748==a||53776==a||53804==a||53832==a||53860==a||53888==a||53916==a||53944==a||53972==a||54E3==a||54028==a||54056==a||54084==a||54112==a||54140==a||54168==a||54196==a||54224==a||54252==a||54280==a||54308==a||54336==a||54364==a||54392==a||54420==a||54448==a||54476==a||54504==a||54532==a||54560==a||54588==a||54616==a||54644==a||54672==a||54700==a||54728==a||54756==a||54784==a||54812==a||54840==a||54868==a||54896==a||54924==a||54952==a||54980==a||55008==a||55036==a||55064==a||55092==a||55120==a||55148==a||55176==a?9:44033<=a&&44059>=a||44061<=a&&44087>=a||44089<=a&&44115>=a||44117<=a&&44143>=a||44145<=a&&44171>=a||44173<=a&&44199>=a||44201<=a&&44227>=a||44229<=a&&44255>=a||44257<=a&&44283>=a||44285<=a&&44311>=a||44313<=a&&44339>=a||44341<=a&&44367>=a||44369<=a&&44395>=a||44397<=a&&44423>=a||44425<=a&&44451>=a||44453<=a&&44479>=a||44481<=a&&44507>=a||44509<=a&&44535>=a||44537<=a&&44563>=a||44565<=a&&44591>=a||44593<=a&&44619>=a||44621<=a&&44647>=a||44649<=a&&44675>=a||44677<=a&&44703>=a||44705<=a&&44731>=a||44733<=a&&44759>=a||44761<=a&&44787>=a||44789<=a&&44815>=a||44817<=a&&44843>=a||44845<=a&&44871>=a||44873<=a&&44899>=a||44901<=a&&44927>=a||44929<=a&&44955>=a||44957<=a&&44983>=a||44985<=a&&45011>=a||45013<=a&&45039>=a||45041<=a&&45067>=a||45069<=a&&45095>=a||45097<=a&&45123>=a||45125<=a&&45151>=a||45153<=a&&45179>=a||45181<=a&&45207>=a||45209<=a&&45235>=a||45237<=a&&45263>=a||45265<=a&&45291>=a||45293<=a&&45319>=a||45321<=a&&45347>=a||45349<=a&&45375>=a||45377<=a&&45403>=a||45405<=a&&45431>=a||45433<=a&&45459>=a||45461<=a&&45487>=a||45489<=a&&45515>=a||45517<=a&&45543>=a||45545<=a&&45571>=a||45573<=a&&45599>=a||45601<=a&&45627>=a||45629<=a&&45655>=a||45657<=a&&45683>=a||45685<=a&&45711>=a||45713<=a&&45739>=a||45741<=a&&45767>=a||45769<=a&&45795>=a||45797<=a&&45823>=a||45825<=a&&45851>=a||45853<=a&&45879>=a||45881<=a&&45907>=a||45909<=a&&45935>=a||45937<=a&&45963>=a||45965<=a&&45991>=a||45993<=a&&46019>=a||46021<=a&&46047>=a||46049<=a&&46075>=a||46077<=a&&46103>=a||46105<=a&&46131>=a||46133<=a&&46159>=a||46161<=a&&46187>=a||46189<=a&&46215>=a||46217<=a&&46243>=a||46245<=a&&46271>=a||46273<=a&&46299>=a||46301<=a&&46327>=a||46329<=a&&46355>=a||46357<=a&&46383>=a||46385<=a&&46411>=a||46413<=a&&46439>=a||46441<=a&&46467>=a||46469<=a&&46495>=a||46497<=a&&46523>=a||46525<=a&&46551>=a||46553<=a&&46579>=a||46581<=a&&46607>=a||46609<=a&&46635>=a||46637<=a&&46663>=a||46665<=a&&46691>=a||46693<=a&&46719>=a||46721<=a&&46747>=a||46749<=a&&46775>=a||46777<=a&&46803>=a||46805<=a&&46831>=a||46833<=a&&46859>=a||46861<=a&&46887>=a||46889<=a&&46915>=a||46917<=a&&46943>=a||46945<=a&&46971>=a||46973<=a&&46999>=a||47001<=a&&47027>=a||47029<=a&&47055>=a||47057<=a&&47083>=a||47085<=a&&47111>=a||47113<=a&&47139>=a||47141<=a&&47167>=a||47169<=a&&47195>=a||47197<=a&&47223>=a||47225<=a&&47251>=a||47253<=a&&47279>=a||47281<=a&&47307>=a||47309<=a&&47335>=a||47337<=a&&47363>=a||47365<=a&&47391>=a||47393<=a&&47419>=a||47421<=a&&47447>=a||47449<=a&&47475>=a||47477<=a&&47503>=a||47505<=a&&47531>=a||47533<=a&&47559>=a||47561<=a&&47587>=a||47589<=a&&47615>=a||47617<=a&&47643>=a||47645<=a&&47671>=a||47673<=a&&47699>=a||47701<=a&&47727>=a||47729<=a&&47755>=a||47757<=a&&47783>=a||47785<=a&&47811>=a||47813<=a&&47839>=a||47841<=a&&47867>=a||47869<=a&&47895>=a||47897<=a&&47923>=a||47925<=a&&47951>=a||47953<=a&&47979>=a||47981<=a&&48007>=a||48009<=a&&48035>=a||48037<=a&&48063>=a||48065<=a&&48091>=a||48093<=a&&48119>=a||48121<=a&&48147>=a||48149<=a&&48175>=a||48177<=a&&48203>=a||48205<=a&&48231>=a||48233<=a&&48259>=a||48261<=a&&48287>=a||48289<=a&&48315>=a||48317<=a&&48343>=a||48345<=a&&48371>=a||48373<=a&&48399>=a||48401<=a&&48427>=a||48429<=a&&48455>=a||48457<=a&&48483>=a||48485<=a&&48511>=a||48513<=a&&48539>=a||48541<=a&&48567>=a||48569<=a&&48595>=a||48597<=a&&48623>=a||48625<=a&&48651>=a||48653<=a&&48679>=a||48681<=a&&48707>=a||48709<=a&&48735>=a||48737<=a&&48763>=a||48765<=a&&48791>=a||48793<=a&&48819>=a||48821<=a&&48847>=a||48849<=a&&48875>=a||48877<=a&&48903>=a||48905<=a&&48931>=a||48933<=a&&48959>=a||48961<=a&&48987>=a||48989<=a&&49015>=a||49017<=a&&49043>=a||49045<=a&&49071>=a||49073<=a&&49099>=a||49101<=a&&49127>=a||49129<=a&&49155>=a||49157<=a&&49183>=a||49185<=a&&49211>=a||49213<=a&&49239>=a||49241<=a&&49267>=a||49269<=a&&49295>=a||49297<=a&&49323>=a||49325<=a&&49351>=a||49353<=a&&49379>=a||49381<=a&&49407>=a||49409<=a&&49435>=a||49437<=a&&49463>=a||49465<=a&&49491>=a||49493<=a&&49519>=a||49521<=a&&49547>=a||49549<=a&&49575>=a||49577<=a&&49603>=a||49605<=a&&49631>=a||49633<=a&&49659>=a||49661<=a&&49687>=a||49689<=a&&49715>=a||49717<=a&&49743>=a||49745<=a&&49771>=a||49773<=a&&49799>=a||49801<=a&&49827>=a||49829<=a&&49855>=a||49857<=a&&49883>=a||49885<=a&&49911>=a||49913<=a&&49939>=a||49941<=a&&49967>=a||49969<=a&&49995>=a||49997<=a&&50023>=a||50025<=a&&50051>=a||50053<=a&&50079>=a||50081<=a&&50107>=a||50109<=a&&50135>=a||50137<=a&&50163>=a||50165<=a&&50191>=a||50193<=a&&50219>=a||50221<=a&&50247>=a||50249<=a&&50275>=a||50277<=a&&50303>=a||50305<=a&&50331>=a||50333<=a&&50359>=a||50361<=a&&50387>=a||50389<=a&&50415>=a||50417<=a&&50443>=a||50445<=a&&50471>=a||50473<=a&&50499>=a||50501<=a&&50527>=a||50529<=a&&50555>=a||50557<=a&&50583>=a||50585<=a&&50611>=a||50613<=a&&50639>=a||50641<=a&&50667>=a||50669<=a&&50695>=a||50697<=a&&50723>=a||50725<=a&&50751>=a||50753<=a&&50779>=a||50781<=a&&50807>=a||50809<=a&&50835>=a||50837<=a&&50863>=a||50865<=a&&50891>=a||50893<=a&&50919>=a||50921<=a&&50947>=a||50949<=a&&50975>=a||50977<=a&&51003>=a||51005<=a&&51031>=a||51033<=a&&51059>=a||51061<=a&&51087>=a||51089<=a&&51115>=a||51117<=a&&51143>=a||51145<=a&&51171>=a||51173<=a&&51199>=a||51201<=a&&51227>=a||51229<=a&&51255>=a||51257<=a&&51283>=a||51285<=a&&51311>=a||51313<=a&&51339>=a||51341<=a&&51367>=a||51369<=a&&51395>=a||51397<=a&&51423>=a||51425<=a&&51451>=a||51453<=a&&51479>=a||51481<=a&&51507>=a||51509<=a&&51535>=a||51537<=a&&51563>=a||51565<=a&&51591>=a||51593<=a&&51619>=a||51621<=a&&51647>=a||51649<=a&&51675>=a||51677<=a&&51703>=a||51705<=a&&51731>=a||51733<=a&&51759>=a||51761<=a&&51787>=a||51789<=a&&51815>=a||51817<=a&&51843>=a||51845<=a&&51871>=a||51873<=a&&51899>=a||51901<=a&&51927>=a||51929<=a&&51955>=a||51957<=a&&51983>=a||51985<=a&&52011>=a||52013<=a&&52039>=a||52041<=a&&52067>=a||52069<=a&&52095>=a||52097<=a&&52123>=a||52125<=a&&52151>=a||52153<=a&&52179>=a||52181<=a&&52207>=a||52209<=a&&52235>=a||52237<=a&&52263>=a||52265<=a&&52291>=a||52293<=a&&52319>=a||52321<=a&&52347>=a||52349<=a&&52375>=a||52377<=a&&52403>=a||52405<=a&&52431>=a||52433<=a&&52459>=a||52461<=a&&52487>=a||52489<=a&&52515>=a||52517<=a&&52543>=a||52545<=a&&52571>=a||52573<=a&&52599>=a||52601<=a&&52627>=a||52629<=a&&52655>=a||52657<=a&&52683>=a||52685<=a&&52711>=a||52713<=a&&52739>=a||52741<=a&&52767>=a||52769<=a&&52795>=a||52797<=a&&52823>=a||52825<=a&&52851>=a||52853<=a&&52879>=a||52881<=a&&52907>=a||52909<=a&&52935>=a||52937<=a&&52963>=a||52965<=a&&52991>=a||52993<=a&&53019>=a||53021<=a&&53047>=a||53049<=a&&53075>=a||53077<=a&&53103>=a||53105<=a&&53131>=a||53133<=a&&53159>=a||53161<=a&&53187>=a||53189<=a&&53215>=a||53217<=a&&53243>=a||53245<=a&&53271>=a||53273<=a&&53299>=a||53301<=a&&53327>=a||53329<=a&&53355>=a||53357<=a&&53383>=a||53385<=a&&53411>=a||53413<=a&&53439>=a||53441<=a&&53467>=a||53469<=a&&53495>=a||53497<=a&&53523>=a||53525<=a&&53551>=a||53553<=a&&53579>=a||53581<=a&&53607>=a||53609<=a&&53635>=a||53637<=a&&53663>=a||53665<=a&&53691>=a||53693<=a&&53719>=a||53721<=a&&53747>=a||53749<=a&&53775>=a||53777<=a&&53803>=a||53805<=a&&53831>=a||53833<=a&&53859>=a||53861<=a&&53887>=a||53889<=a&&53915>=a||53917<=a&&53943>=a||53945<=a&&53971>=a||53973<=a&&53999>=a||54001<=a&&54027>=a||54029<=a&&54055>=a||54057<=a&&54083>=a||54085<=a&&54111>=a||54113<=a&&54139>=a||54141<=a&&54167>=a||54169<=a&&54195>=a||54197<=a&&54223>=a||54225<=a&&54251>=a||54253<=a&&54279>=a||54281<=a&&54307>=a||54309<=a&&54335>=a||54337<=a&&54363>=a||54365<=a&&54391>=a||54393<=a&&54419>=a||54421<=a&&54447>=a||54449<=a&&54475>=a||54477<=a&&54503>=a||54505<=a&&54531>=a||54533<=a&&54559>=a||54561<=a&&54587>=a||54589<=a&&54615>=a||54617<=a&&54643>=a||54645<=a&&54671>=a||54673<=a&&54699>=a||54701<=a&&54727>=a||54729<=a&&54755>=a||54757<=a&&54783>=a||54785<=a&&54811>=a||54813<=a&&54839>=a||54841<=a&&54867>=a||54869<=a&&54895>=a||54897<=a&&54923>=a||54925<=a&&54951>=a||54953<=a&&54979>=a||54981<=a&&55007>=a||55009<=a&&55035>=a||55037<=a&&55063>=a||55065<=a&&55091>=a||55093<=a&&55119>=a||55121<=a&&55147>=a||55149<=a&&55175>=a||55177<=a&&55203>=a?10:9757==a||9977==a||9994<=a&&9997>=a||127877==a||127938<=a&&127940>=a||127943==a||127946<=a&&127948>=a||128066<=a&&128067>=a||128070<=a&&128080>=a||128110==a||128112<=a&&128120>=a||128124==a||128129<=a&&128131>=a||128133<=a&&128135>=a||128170==a||128372<=a&&128373>=a||128378==a||128400==a||128405<=a&&128406>=a||128581<=a&&128583>=a||128587<=a&&128591>=a||128675==a||128692<=a&&128694>=a||128704==a||128716==a||129304<=a&&129308>=a||129310<=a&&129311>=a||129318==a||129328<=a&&129337>=a||129341<=a&&129342>=a||129489<=a&&129501>=a?13:127995<=a&&127999>=a?14:8205==a?15:9792==a||9794==a||9877<=a&&9878>=a||9992==a||10084==a||127752==a||127806==a||127859==a||127891==a||127908==a||127912==a||127979==a||127981==a||128139==a||128187<=a&&128188>=a||128295==a||128300==a||128488==a||128640==a||128658==a?16:128102<=a&&128105>=a?17:11;}this.nextBreak=function(a,c){void 0===c&&(c=0);if(0>c)return 0;if(c>=a.length-1)return a.length;var b=k(h(a,c)),d=[];for(c+=1;c<a.length;c++){var e=a,g=c-1;if(!(55296<=e.charCodeAt(g)&&56319>=e.charCodeAt(g)&&56320<=e.charCodeAt(g+1)&&57343>=e.charCodeAt(g+1))){e=k(h(a,c));if(l(b,d,e))return c;d.push(e);}}return a.length;};this.splitGraphemes=function(a){for(var c=[],b=0,d;(d=this.nextBreak(a,b))<a.length;){c.push(a.slice(b,d)),b=d;}b<a.length&&c.push(a.slice(b));return c;};this.iterateGraphemes=function(a){var c=0,b={next:function(){var d;if((d=this.nextBreak(a,c))<a.length){var e=a.slice(c,d);c=d;return{value:e,done:!1};}return c<a.length?(e=a.slice(c),c=a.length,{value:e,done:!1}):{value:void 0,done:!0};}.bind(this)};"undefined"!==typeof Symbol&&Symbol.iterator&&(b[Symbol.iterator]=function(){return b;});return b;};this.countGraphemes=function(a){for(var c=0,b=0,d;(d=this.nextBreak(a,b))<a.length;){b=d,c++;}b<a.length&&c++;return c;};return this;};self.GraphemeSplitter=GraphemeSplitter;}// 3rdparty/poly-decomp.js
{var lineInt=function lineInt(l1,l2,precision){precision=precision||0;var i=[0,0];var a1,b1,c1,a2,b2,c2,det;a1=l1[1][1]-l1[0][1];b1=l1[0][0]-l1[1][0];c1=a1*l1[0][0]+b1*l1[0][1];a2=l2[1][1]-l2[0][1];b2=l2[0][0]-l2[1][0];c2=a2*l2[0][0]+b2*l2[0][1];det=a1*b2-a2*b1;if(!scalar_eq(det,0,precision)){i[0]=(b2*c1-b1*c2)/det;i[1]=(a1*c2-a2*c1)/det;}return i;};var lineSegmentsIntersect=function lineSegmentsIntersect(p1,p2,q1,q2){var dx=p2[0]-p1[0];var dy=p2[1]-p1[1];var da=q2[0]-q1[0];var db=q2[1]-q1[1];if(da*dy-db*dx===0)return false;var s=(dx*(q1[1]-p1[1])+dy*(p1[0]-q1[0]))/(da*dy-db*dx);var t=(da*(p1[1]-q1[1])+db*(q1[0]-p1[0]))/(db*dx-da*dy);return s>=0&&s<=1&&t>=0&&t<=1;};var triangleArea=function triangleArea(a,b,c){return(b[0]-a[0])*(c[1]-a[1])-(c[0]-a[0])*(b[1]-a[1]);};var isLeft=function isLeft(a,b,c){return triangleArea(a,b,c)>0;};var isLeftOn=function isLeftOn(a,b,c){return triangleArea(a,b,c)>=0;};var isRight=function isRight(a,b,c){return triangleArea(a,b,c)<0;};var isRightOn=function isRightOn(a,b,c){return triangleArea(a,b,c)<=0;};var collinear=function collinear(a,b,c,thresholdAngle){if(!thresholdAngle)return triangleArea(a,b,c)===0;else{var ab=tmpPoint1,bc=tmpPoint2;ab[0]=b[0]-a[0];ab[1]=b[1]-a[1];bc[0]=c[0]-b[0];bc[1]=c[1]-b[1];var dot=ab[0]*bc[0]+ab[1]*bc[1],magA=Math.sqrt(ab[0]*ab[0]+ab[1]*ab[1]),magB=Math.sqrt(bc[0]*bc[0]+bc[1]*bc[1]),angle=Math.acos(dot/(magA*magB));return angle<thresholdAngle;}};var sqdist=function sqdist(a,b){var dx=b[0]-a[0];var dy=b[1]-a[1];return dx*dx+dy*dy;};var polygonAt=function polygonAt(polygon,i){var s=polygon.length;return polygon[i<0?i%s+s:i%s];};var polygonClear=function polygonClear(polygon){polygon.length=0;};var polygonAppend=function polygonAppend(polygon,poly,from,to){for(var i=from;i<to;i++){polygon.push(poly[i]);}};var polygonMakeCCW=function polygonMakeCCW(polygon){var br=0,v=polygon;for(var i=1;i<polygon.length;++i){if(v[i][1]<v[br][1]||v[i][1]===v[br][1]&&v[i][0]>v[br][0])br=i;}if(!isLeft(polygonAt(polygon,br-1),polygonAt(polygon,br),polygonAt(polygon,br+1))){polygonReverse(polygon);return true;}else return false;};var polygonReverse=function polygonReverse(polygon){var tmp=[];var N=polygon.length;for(var i=0;i!==N;i++){tmp.push(polygon.pop());}for(var i=0;i!==N;i++){polygon[i]=tmp[i];}};var polygonIsReflex=function polygonIsReflex(polygon,i){return isRight(polygonAt(polygon,i-1),polygonAt(polygon,i),polygonAt(polygon,i+1));};var polygonCanSee=function polygonCanSee(polygon,a,b){var p,dist,l1=tmpLine1,l2=tmpLine2;if(isLeftOn(polygonAt(polygon,a+1),polygonAt(polygon,a),polygonAt(polygon,b))&&isRightOn(polygonAt(polygon,a-1),polygonAt(polygon,a),polygonAt(polygon,b)))return false;dist=sqdist(polygonAt(polygon,a),polygonAt(polygon,b));for(var i=0;i!==polygon.length;++i){if((i+1)%polygon.length===a||i===a)continue;if(isLeftOn(polygonAt(polygon,a),polygonAt(polygon,b),polygonAt(polygon,i+1))&&isRightOn(polygonAt(polygon,a),polygonAt(polygon,b),polygonAt(polygon,i))){l1[0]=polygonAt(polygon,a);l1[1]=polygonAt(polygon,b);l2[0]=polygonAt(polygon,i);l2[1]=polygonAt(polygon,i+1);p=lineInt(l1,l2);if(sqdist(polygonAt(polygon,a),p)<dist)return false;}}return true;};var polygonCanSee2=function polygonCanSee2(polygon,a,b){for(var i=0;i!==polygon.length;++i){if(i===a||i===b||(i+1)%polygon.length===a||(i+1)%polygon.length===b)continue;if(lineSegmentsIntersect(polygonAt(polygon,a),polygonAt(polygon,b),polygonAt(polygon,i),polygonAt(polygon,i+1)))return false;}return true;};var polygonCopy=function polygonCopy(polygon,i,j,targetPoly){var p=targetPoly||[];polygonClear(p);if(i<j)for(var k=i;k<=j;k++){p.push(polygon[k]);}else{for(var k=0;k<=j;k++){p.push(polygon[k]);}for(var k=i;k<polygon.length;k++){p.push(polygon[k]);}}return p;};var polygonGetCutEdges=function polygonGetCutEdges(polygon){var min=[],tmp1=[],tmp2=[],tmpPoly=[];var nDiags=Number.MAX_VALUE;for(var i=0;i<polygon.length;++i){if(polygonIsReflex(polygon,i))for(var j=0;j<polygon.length;++j){if(polygonCanSee(polygon,i,j)){tmp1=polygonGetCutEdges(polygonCopy(polygon,i,j,tmpPoly));tmp2=polygonGetCutEdges(polygonCopy(polygon,j,i,tmpPoly));for(var k=0;k<tmp2.length;k++){tmp1.push(tmp2[k]);}if(tmp1.length<nDiags){min=tmp1;nDiags=tmp1.length;min.push([polygonAt(polygon,i),polygonAt(polygon,j)]);}}}}return min;};var polygonDecomp=function polygonDecomp(polygon){var edges=polygonGetCutEdges(polygon);if(edges.length>0)return polygonSlice(polygon,edges);else return[polygon];};var polygonSlice=function polygonSlice(polygon,cutEdges){if(cutEdges.length===0)return[polygon];if(cutEdges instanceof Array&&cutEdges.length&&cutEdges[0]instanceof Array&&cutEdges[0].length===2&&cutEdges[0][0]instanceof Array){var polys=[polygon];for(var i=0;i<cutEdges.length;i++){var cutEdge=cutEdges[i];for(var j=0;j<polys.length;j++){var poly=polys[j];var result=polygonSlice(poly,cutEdge);if(result){polys.splice(j,1);polys.push(result[0],result[1]);break;}}}return polys;}else{var cutEdge=cutEdges;var i=polygon.indexOf(cutEdge[0]);var j=polygon.indexOf(cutEdge[1]);if(i!==-1&&j!==-1)return[polygonCopy(polygon,i,j),polygonCopy(polygon,j,i)];else return false;}};var polygonIsSimple=function polygonIsSimple(polygon){var path=polygon,i;for(i=0;i<path.length-1;i++){for(var j=0;j<i-1;j++){if(lineSegmentsIntersect(path[i],path[i+1],path[j],path[j+1]))return false;}}for(i=1;i<path.length-2;i++){if(lineSegmentsIntersect(path[0],path[path.length-1],path[i],path[i+1]))return false;}return true;};var getIntersectionPoint=function getIntersectionPoint(p1,p2,q1,q2,delta){delta=delta||0;var a1=p2[1]-p1[1];var b1=p1[0]-p2[0];var c1=a1*p1[0]+b1*p1[1];var a2=q2[1]-q1[1];var b2=q1[0]-q2[0];var c2=a2*q1[0]+b2*q1[1];var det=a1*b2-a2*b1;if(!scalar_eq(det,0,delta))return[(b2*c1-b1*c2)/det,(a1*c2-a2*c1)/det];else return[0,0];};var polygonQuickDecomp=function polygonQuickDecomp(polygon,result,reflexVertices,steinerPoints,delta,maxlevel,level){maxlevel=maxlevel||100;level=level||0;delta=delta||25;result=typeof result!=="undefined"?result:[];reflexVertices=reflexVertices||[];steinerPoints=steinerPoints||[];var upperInt=[0,0],lowerInt=[0,0],p=[0,0];var upperDist=0,lowerDist=0,d=0,closestDist=0;var upperIndex=0,lowerIndex=0,closestIndex=0;var lowerPoly=[],upperPoly=[];var poly=polygon,v=polygon;if(v.length<3)return result;level++;if(level>maxlevel){console.warn("quickDecomp: max level ("+maxlevel+") reached.");return result;}for(var i=0;i<polygon.length;++i){if(polygonIsReflex(poly,i)){reflexVertices.push(poly[i]);upperDist=lowerDist=Number.MAX_VALUE;for(var j=0;j<polygon.length;++j){if(isLeft(polygonAt(poly,i-1),polygonAt(poly,i),polygonAt(poly,j))&&isRightOn(polygonAt(poly,i-1),polygonAt(poly,i),polygonAt(poly,j-1))){p=getIntersectionPoint(polygonAt(poly,i-1),polygonAt(poly,i),polygonAt(poly,j),polygonAt(poly,j-1));if(isRight(polygonAt(poly,i+1),polygonAt(poly,i),p)){d=sqdist(poly[i],p);if(d<lowerDist){lowerDist=d;lowerInt=p;lowerIndex=j;}}}if(isLeft(polygonAt(poly,i+1),polygonAt(poly,i),polygonAt(poly,j+1))&&isRightOn(polygonAt(poly,i+1),polygonAt(poly,i),polygonAt(poly,j))){p=getIntersectionPoint(polygonAt(poly,i+1),polygonAt(poly,i),polygonAt(poly,j),polygonAt(poly,j+1));if(isLeft(polygonAt(poly,i-1),polygonAt(poly,i),p)){d=sqdist(poly[i],p);if(d<upperDist){upperDist=d;upperInt=p;upperIndex=j;}}}}if(lowerIndex===(upperIndex+1)%polygon.length){p[0]=(lowerInt[0]+upperInt[0])/2;p[1]=(lowerInt[1]+upperInt[1])/2;steinerPoints.push(p);if(i<upperIndex){polygonAppend(lowerPoly,poly,i,upperIndex+1);lowerPoly.push(p);upperPoly.push(p);if(lowerIndex!==0)polygonAppend(upperPoly,poly,lowerIndex,poly.length);polygonAppend(upperPoly,poly,0,i+1);}else{if(i!==0)polygonAppend(lowerPoly,poly,i,poly.length);polygonAppend(lowerPoly,poly,0,upperIndex+1);lowerPoly.push(p);upperPoly.push(p);polygonAppend(upperPoly,poly,lowerIndex,i+1);}}else{if(lowerIndex>upperIndex)upperIndex+=polygon.length;closestDist=Number.MAX_VALUE;if(upperIndex<lowerIndex)return result;for(var j=lowerIndex;j<=upperIndex;++j){if(isLeftOn(polygonAt(poly,i-1),polygonAt(poly,i),polygonAt(poly,j))&&isRightOn(polygonAt(poly,i+1),polygonAt(poly,i),polygonAt(poly,j))){d=sqdist(polygonAt(poly,i),polygonAt(poly,j));if(d<closestDist&&polygonCanSee2(poly,i,j)){closestDist=d;closestIndex=j%polygon.length;}}}if(i<closestIndex){polygonAppend(lowerPoly,poly,i,closestIndex+1);if(closestIndex!==0)polygonAppend(upperPoly,poly,closestIndex,v.length);polygonAppend(upperPoly,poly,0,i+1);}else{if(i!==0)polygonAppend(lowerPoly,poly,i,v.length);polygonAppend(lowerPoly,poly,0,closestIndex+1);polygonAppend(upperPoly,poly,closestIndex,i+1);}}if(lowerPoly.length<upperPoly.length){polygonQuickDecomp(lowerPoly,result,reflexVertices,steinerPoints,delta,maxlevel,level);polygonQuickDecomp(upperPoly,result,reflexVertices,steinerPoints,delta,maxlevel,level);}else{polygonQuickDecomp(upperPoly,result,reflexVertices,steinerPoints,delta,maxlevel,level);polygonQuickDecomp(lowerPoly,result,reflexVertices,steinerPoints,delta,maxlevel,level);}return result;}}result.push(polygon);return result;};var polygonRemoveCollinearPoints=function polygonRemoveCollinearPoints(polygon,precision){var num=0;for(var i=polygon.length-1;polygon.length>3&&i>=0;--i){if(collinear(polygonAt(polygon,i-1),polygonAt(polygon,i),polygonAt(polygon,i+1),precision)){polygon.splice(i%polygon.length,1);num++;}}return num;};var polygonRemoveDuplicatePoints=function polygonRemoveDuplicatePoints(polygon,precision){for(var i=polygon.length-1;i>=1;--i){var pi=polygon[i];for(var j=i-1;j>=0;--j){if(points_eq(pi,polygon[j],precision)){polygon.splice(i,1);continue;}}}};var scalar_eq=function scalar_eq(a,b,precision){precision=precision||0;return Math.abs(a-b)<=precision;};var points_eq=function points_eq(a,b,precision){return scalar_eq(a[0],b[0],precision)&&scalar_eq(a[1],b[1],precision);};'use strict';var tmpPoint1=[],tmpPoint2=[];var tmpLine1=[],tmpLine2=[];self.polyDecomp={decomp:polygonDecomp,quickDecomp:polygonQuickDecomp,isSimple:polygonIsSimple,removeCollinearPoints:polygonRemoveCollinearPoints,removeDuplicatePoints:polygonRemoveDuplicatePoints,makeCCW:polygonMakeCCW};}// lib/c3.js
{'use strict';var isReady=false;var hasAppStarted=false;var buildMode="dev";var C3=self.C3=/*#__PURE__*/function(){function C3(){_classCallCheck(this,C3);throw TypeError("static class can't be instantiated");}_createClass(C3,null,[{key:"SetReady",value:function SetReady(){isReady=true;}},{key:"IsReady",value:function IsReady(){return isReady;}},{key:"SetAppStarted",value:function SetAppStarted(){hasAppStarted=true;}},{key:"HasAppStarted",value:function HasAppStarted(){return hasAppStarted;}},{key:"SetBuildMode",value:function SetBuildMode(m){buildMode=m;}},{key:"GetBuildMode",value:function GetBuildMode(){return buildMode;}},{key:"IsReleaseBuild",value:function IsReleaseBuild(){return buildMode==="final";}}]);return C3;}();C3.isDebug=false;C3.isDebugDefend=false;C3.hardwareConcurrency=navigator.hardwareConcurrency||2;self.C3X={};}// ../lib/queryParser.js
{'use strict';var _C=self.C3;_C.QueryParser=/*#__PURE__*/function(){function QueryParser(queryString){_classCallCheck(this,QueryParser);this._queryString=queryString;this._parameters=new Map();this._Parse();}_createClass(QueryParser,[{key:"_Parse",value:function _Parse(){var str=this._queryString;if(str.startsWith("?")||str.startsWith("#"))str=str.substr(1);var arr=str.split("&");var _iteratorNormalCompletion=true;var _didIteratorError=false;var _iteratorError=undefined;try{for(var _iterator=arr[Symbol.iterator](),_step;!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=true){var p=_step.value;this._ParseParameter(p);}}catch(err){_didIteratorError=true;_iteratorError=err;}finally{try{if(!_iteratorNormalCompletion&&_iterator["return"]!=null){_iterator["return"]();}}finally{if(_didIteratorError){throw _iteratorError;}}}}},{key:"_ParseParameter",value:function _ParseParameter(p){if(!p)return;if(!p.includes("=")){this._parameters.set(p,null);return;}var i=p.indexOf("=");var parameterName=decodeURIComponent(p.substring(0,i));var parameterValue=decodeURIComponent(p.substring(i+1));this._parameters.set(parameterName,parameterValue);}},{key:"LogAll",value:function LogAll(){var _iteratorNormalCompletion2=true;var _didIteratorError2=false;var _iteratorError2=undefined;try{for(var _iterator2=this._parameters[Symbol.iterator](),_step2;!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=true){var e=_step2.value;console.log("[QueryParser] Parameter '"+e[0]+"' = "+(e[1]===null?"null":"'"+e[1]+"'"));}}catch(err){_didIteratorError2=true;_iteratorError2=err;}finally{try{if(!_iteratorNormalCompletion2&&_iterator2["return"]!=null){_iterator2["return"]();}}finally{if(_didIteratorError2){throw _iteratorError2;}}}}},{key:"Has",value:function Has(name){return this._parameters.has(name);}},{key:"Get",value:function Get(name){var ret=this._parameters.get(name);if(typeof ret==="undefined")return null;else return ret;}},{key:"ClearHash",value:function ClearHash(){history.replaceState("",document.title,location.pathname+location.search);}},{key:"Reparse",value:function Reparse(str){this._queryString=str;this._parameters.clear();this._Parse();}}]);return QueryParser;}();_C.QueryString=new _C.QueryParser(location.search);_C.LocationHashString=new _C.QueryParser(location.hash);if(_C.QueryString.Has("perf"))_C.isPerformanceProfiling=true;if(_C.QueryString.Get("mode")!=="dev")_C.SetBuildMode("final");}// ../lib/detect/detect.js
{var GetWindowsNTVersionName=function GetWindowsNTVersionName(ntVer){var num=parseFloat(ntVer);var ret=windowsNTVerMap.get(num);if(ret)return ret;if(num>=13)return"11";return"NT "+ntVer;};'use strict';var _C2=self.C3;var UNKNOWN="(unknown)";_C2.Platform={OS:UNKNOWN,OSVersion:UNKNOWN,Browser:UNKNOWN,BrowserVersion:UNKNOWN,BrowserVersionNumber:NaN,BrowserEngine:UNKNOWN,Context:"browser",IsDesktop:true,IsMobile:false,IsAppleOS:false,IsIpadOS:false,GetDetailedInfo:function GetDetailedInfo(){return regeneratorRuntime.async(function GetDetailedInfo$(_context){while(1){switch(_context.prev=_context.next){case 0:case"end":return _context.stop();}}});}};var windowsNTVerMap=new Map([[5,"2000"],[5.1,"XP"],[5.2,"XP"],[6,"Vista"],[6.1,"7"],[6.2,"8"],[6.3,"8.1"],[10,"10"]]);var uaStr=navigator.userAgent;var uaData=navigator["userAgentData"];if(uaData&&uaData["brands"].length>0){var ReadBrandList=function ReadBrandList(brands){var browser="";var browser_version="";var engine="";var engine_version="";var _iteratorNormalCompletion3=true;var _didIteratorError3=false;var _iteratorError3=undefined;try{for(var _iterator3=brands[Symbol.iterator](),_step3;!(_iteratorNormalCompletion3=(_step3=_iterator3.next()).done);_iteratorNormalCompletion3=true){var o=_step3.value;var recognizedBrowser=RECOGNIZED_BROWSERS.get(o["brand"]);if(!browser&&recognizedBrowser){browser=recognizedBrowser;browser_version=o["version"];}var recognizedEngine=RECOGNIZED_ENGINES.get(o["brand"]);if(!engine&&recognizedEngine){engine=recognizedEngine;engine_version=o["version"];}}}catch(err){_didIteratorError3=true;_iteratorError3=err;}finally{try{if(!_iteratorNormalCompletion3&&_iterator3["return"]!=null){_iterator3["return"]();}}finally{if(_didIteratorError3){throw _iteratorError3;}}}if(!browser&&engine==="Chromium"){_C2.Platform.Browser="Chromium";_C2.Platform.BrowserVersion=engine_version;}_C2.Platform.Browser=browser||UNKNOWN;_C2.Platform.BrowserVersion=browser_version||UNKNOWN;_C2.Platform.BrowserEngine=engine||UNKNOWN;};_C2.Platform.OS=uaData["platform"];_C2.Platform.IsMobile=uaData["mobile"];_C2.Platform.IsDesktop=!_C2.Platform.IsMobile;var RECOGNIZED_BROWSERS=new Map([["Google Chrome","Chrome"],["Microsoft Edge","Edge"],["Opera","Opera"],["Opera GX","Opera GX"],["Mozilla Firefox","Firefox"],["Apple Safari","Safari"],["NW.js","NW.js"]]);var RECOGNIZED_ENGINES=new Map([["Chromium","Chromium"],["Gecko","Gecko"],["WebKit","WebKit"]]);ReadBrandList(uaData["brands"]);var didGetDetailedInfo=false;_C2.Platform.GetDetailedInfo=function _callee(){var details;return regeneratorRuntime.async(function _callee$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:if(!didGetDetailedInfo){_context2.next=2;break;}return _context2.abrupt("return");case 2:_context2.prev=2;_context2.next=5;return regeneratorRuntime.awrap(navigator["userAgentData"]["getHighEntropyValues"](["platformVersion","fullVersionList"]));case 5:details=_context2.sent;ReadBrandList(details["fullVersionList"]);if(_C2.Platform.OS==="Windows")_C2.Platform.OSVersion=GetWindowsNTVersionName(details["platformVersion"]);else _C2.Platform.OSVersion=details["platformVersion"];didGetDetailedInfo=true;_context2.next=14;break;case 11:_context2.prev=11;_context2.t0=_context2["catch"](2);console.warn("Failed to get detailed user agent information: ",_context2.t0);case 14:case"end":return _context2.stop();}}},null,null,[[2,11]]);};}else{var RunTest=function RunTest(regex_or_arr,handler){var arr=Array.isArray(regex_or_arr)?regex_or_arr:[regex_or_arr];var _iteratorNormalCompletion4=true;var _didIteratorError4=false;var _iteratorError4=undefined;try{for(var _iterator4=arr[Symbol.iterator](),_step4;!(_iteratorNormalCompletion4=(_step4=_iterator4.next()).done);_iteratorNormalCompletion4=true){var regex=_step4.value;var result=regex.exec(uaStr);if(result){handler(result);break;}}}catch(err){_didIteratorError4=true;_iteratorError4=err;}finally{try{if(!_iteratorNormalCompletion4&&_iterator4["return"]!=null){_iterator4["return"]();}}finally{if(_didIteratorError4){throw _iteratorError4;}}}};RunTest(/windows\s+nt\s+([\d\.]+)/i,function(result){_C2.Platform.OS="Windows";var ntVer=result[1];_C2.Platform.OSVersion=GetWindowsNTVersionName(ntVer);});RunTest(/mac\s+os\s+x\s+([\d\._]+)/i,function(result){_C2.Platform.OS="macOS";_C2.Platform.OSVersion=result[1].replace(/_/g,".");});RunTest(/CrOS/,function(){_C2.Platform.OS="Chrome OS";});RunTest(/linux|openbsd|freebsd|netbsd/i,function(){_C2.Platform.OS="Linux";});RunTest(/android/i,function(){_C2.Platform.OS="Android";});RunTest(/android\s+([\d\.]+)/i,function(result){_C2.Platform.OS="Android";_C2.Platform.OSVersion=result[1];});if(_C2.Platform.OS===UNKNOWN){RunTest(/(iphone|ipod|ipad)/i,function(result){_C2.Platform.OS="iOS";});RunTest([/iphone\s+os\s+([\d\._]+)/i,/ipad[^)]*os\s+([\d\._]+)/i],function(result){_C2.Platform.OS="iOS";_C2.Platform.OSVersion=result[1].replace(/_/g,".");});}var hasChrome=/chrome\//i.test(uaStr);var hasChromium=/chromium\//i.test(uaStr);var hasEdge=/edg\//i.test(uaStr);var hasOpera=/OPR\//.test(uaStr);var hasNWjs=/nwjs/i.test(uaStr);var hasSafari=/safari\//i.test(uaStr);var hasWebKit=/webkit/i.test(uaStr);if(!hasEdge&&!hasOpera)RunTest(/chrome\/([\d\.]+)/i,function(result){_C2.Platform.Browser="Chrome";_C2.Platform.BrowserVersion=result[1];_C2.Platform.BrowserEngine="Chromium";});RunTest(/edg\/([\d\.]+)/i,function(result){_C2.Platform.Browser="Edge";_C2.Platform.BrowserVersion=result[1];_C2.Platform.BrowserEngine="Chromium";});RunTest(/OPR\/([\d\.]+)/,function(result){_C2.Platform.Browser="Opera";_C2.Platform.BrowserVersion=result[1];_C2.Platform.BrowserEngine="Chromium";});RunTest(/chromium\/([\d\.]+)/i,function(result){_C2.Platform.Browser="Chromium";_C2.Platform.BrowserVersion=result[1];_C2.Platform.BrowserEngine="Chromium";});RunTest(/nwjs\/[0-9.]+/i,function(result){_C2.Platform.Browser="NW.js";_C2.Platform.BrowserVersion=result[1];_C2.Platform.BrowserEngine="Chromium";_C2.Platform.Context="nwjs";});RunTest(/firefox\/([\d\.]+)/i,function(result){_C2.Platform.Browser="Firefox";_C2.Platform.BrowserVersion=result[1];_C2.Platform.BrowserEngine="Gecko";});if(hasSafari&&!hasChrome&&!hasChromium&&!hasEdge&&!hasOpera&&!hasNWjs){_C2.Platform.Browser="Safari";_C2.Platform.BrowserEngine="WebKit";RunTest(/version\/([\d\.]+)/i,function(result){_C2.Platform.BrowserVersion=result[1];});RunTest(/crios\/([\d\.]+)/i,function(result){_C2.Platform.Browser="Chrome for iOS";_C2.Platform.BrowserVersion=result[1];});RunTest(/fxios\/([\d\.]+)/i,function(result){_C2.Platform.Browser="Firefox for iOS";_C2.Platform.BrowserVersion=result[1];});RunTest(/edgios\/([\d\.]+)/i,function(result){_C2.Platform.Browser="Edge for iOS";_C2.Platform.BrowserVersion=result[1];});}if(_C2.Platform.BrowserEngine===UNKNOWN&&hasWebKit)_C2.Platform.BrowserEngine="WebKit";if(_C2.Platform.OS==="Android"&&_C2.Platform.Browser==="Safari")_C2.Platform.Browser="Stock";var desktopOSs=new Set(["Windows","macOS","Linux","Chrome OS"]);var isDesktop=desktopOSs.has(_C2.Platform.OS)||_C2.Platform.Context==="nwjs";_C2.Platform.IsDesktop=isDesktop;_C2.Platform.IsMobile=!isDesktop;}if(_C2.Platform.Browser==="Chrome"&&_C2.Platform.Context==="browser"&&/wv\)/.test(uaStr))_C2.Platform.Context="webview";if(_C2.Platform.Context!=="nwjs"&&typeof window!=="undefined"&&(window.matchMedia&&window.matchMedia("(display-mode: standalone)").matches||navigator["standalone"]))_C2.Platform.Context="webapp";_C2.Platform.BrowserVersionNumber=parseFloat(_C2.Platform.BrowserVersion);var looksLikeIPadOS=_C2.Platform.OS==="macOS"&&navigator["maxTouchPoints"]&&navigator["maxTouchPoints"]>2;if(looksLikeIPadOS){_C2.Platform.OS="iOS";_C2.Platform.OSVersion=_C2.Platform.BrowserVersion;_C2.Platform.IsDesktop=false;_C2.Platform.IsMobile=true;_C2.Platform.IsIpadOS=true;}_C2.Platform.IsAppleOS=_C2.Platform.OS==="macOS"||_C2.Platform.OS==="iOS";}// ../lib/storage/kvStorage.js
{'use strict';{var asyncifyRequest=function asyncifyRequest(request){return new Promise(function(res,rej){request.onsuccess=function(){return res(request.result);};request.onerror=function(){return rej(request.error);};});};var asyncifyTransaction=function asyncifyTransaction(tx){return new Promise(function(res,rej){tx.oncomplete=function(){return res();};tx.onerror=function(){return rej(tx.error);};tx.onabort=function(){return rej(tx.error);};});};var openReadOnlyTransaction=function openReadOnlyTransaction(name,method){return openTransaction(name,method);};var openWriteTransaction=function openWriteTransaction(name,method){return openTransaction(name,method,true);};var openTransaction=function openTransaction(name,method){var write,allowRetry,db,tx,_args3=arguments;return regeneratorRuntime.async(function openTransaction$(_context3){while(1){switch(_context3.prev=_context3.next){case 0:write=_args3.length>2&&_args3[2]!==undefined?_args3[2]:false;allowRetry=_args3.length>3&&_args3[3]!==undefined?_args3[3]:true;_context3.next=4;return regeneratorRuntime.awrap(lazyOpenDatabase(name));case 4:db=_context3.sent;_context3.prev=5;tx=db.transaction([STORE_NAME],write?"readwrite":"readonly");return _context3.abrupt("return",method(tx));case 10:_context3.prev=10;_context3.t0=_context3["catch"](5);if(!(allowRetry&&_context3.t0["name"]==="InvalidStateError")){_context3.next=17;break;}DATABASE_PROMISE_MAP["delete"](name);return _context3.abrupt("return",openTransaction(name,method,write,false));case 17:throw _context3.t0;case 18:case"end":return _context3.stop();}}},null,null,[[5,10]]);};var lazyOpenDatabase=function lazyOpenDatabase(name){RequireString(name);var dbPromise=DATABASE_PROMISE_MAP.get(name);if(!(dbPromise instanceof Promise)){dbPromise=openDatabase(name);DATABASE_PROMISE_MAP.set(name,dbPromise);dbPromise["catch"](function(err){return DATABASE_PROMISE_MAP["delete"](name);});}return dbPromise;};var openDatabase=function openDatabase(name){var openRequest;return regeneratorRuntime.async(function openDatabase$(_context4){while(1){switch(_context4.prev=_context4.next){case 0:RequireString(name);openRequest=indexedDB.open(name,VERSION);openRequest.addEventListener("upgradeneeded",function(e){try{var db=e.target.result;db.createObjectStore(STORE_NAME);}catch(err){console.error("Failed to create objectstore for database ".concat(name),err);}});return _context4.abrupt("return",asyncifyRequest(openRequest));case 4:case"end":return _context4.stop();}}});};var RequireString=function RequireString(x){if(typeof x!=="string")throw new TypeError("expected string");};var getEntriesFromCursor=function getEntriesFromCursor(tx,type){var request=tx.objectStore(STORE_NAME).openCursor();return new Promise(function(resolve){var results=[];request.onsuccess=function(event){var cursor=event.target.result;if(cursor){switch(type){case"entries":results.push([cursor.key,cursor.value]);break;case"keys":results.push(cursor.key);break;case"values":results.push(cursor.value);break;}cursor["continue"]();}else resolve(results);};});};var VERSION=2;var STORE_NAME="keyvaluepairs";var DATABASE_PROMISE_MAP=new Map();var SUPPORTS_GETALL=typeof IDBObjectStore!=="undefined"&&typeof IDBObjectStore.prototype.getAll==="function";var SUPPORTS_GETALLKEYS=typeof IDBObjectStore!=="undefined"&&typeof IDBObjectStore.prototype.getAllKeys==="function";var KVStorageContainer=/*#__PURE__*/function(){function KVStorageContainer(name){_classCallCheck(this,KVStorageContainer);RequireString(name);this.name=name;}_createClass(KVStorageContainer,[{key:"ready",value:function ready(){return regeneratorRuntime.async(function ready$(_context5){while(1){switch(_context5.prev=_context5.next){case 0:_context5.next=2;return regeneratorRuntime.awrap(lazyOpenDatabase(this.name));case 2:case"end":return _context5.stop();}}},null,this);}},{key:"set",value:function set(key,value){RequireString(key);return openWriteTransaction(this.name,function _callee2(tx){var request,requestPromise,txPromise;return regeneratorRuntime.async(function _callee2$(_context6){while(1){switch(_context6.prev=_context6.next){case 0:request=tx.objectStore(STORE_NAME).put(value,key);requestPromise=asyncifyRequest(request);txPromise=asyncifyTransaction(tx);_context6.next=5;return regeneratorRuntime.awrap(Promise.all([txPromise,requestPromise]));case 5:case"end":return _context6.stop();}}});});}},{key:"get",value:function get(key){RequireString(key);return openReadOnlyTransaction(this.name,function _callee3(tx){var request,requestPromise,txPromise,_ref,_ref2,_,value;return regeneratorRuntime.async(function _callee3$(_context7){while(1){switch(_context7.prev=_context7.next){case 0:request=tx.objectStore(STORE_NAME).get(key);requestPromise=asyncifyRequest(request);txPromise=asyncifyTransaction(tx);_context7.next=5;return regeneratorRuntime.awrap(Promise.all([txPromise,requestPromise]));case 5:_ref=_context7.sent;_ref2=_slicedToArray(_ref,2);_=_ref2[0];value=_ref2[1];return _context7.abrupt("return",value);case 10:case"end":return _context7.stop();}}});});}},{key:"delete",value:function _delete(key){RequireString(key);return openWriteTransaction(this.name,function _callee4(tx){var request,requestPromise,txPromise;return regeneratorRuntime.async(function _callee4$(_context8){while(1){switch(_context8.prev=_context8.next){case 0:request=tx.objectStore(STORE_NAME)["delete"](key);requestPromise=asyncifyRequest(request);txPromise=asyncifyTransaction(tx);_context8.next=5;return regeneratorRuntime.awrap(Promise.all([txPromise,requestPromise]));case 5:case"end":return _context8.stop();}}});});}},{key:"clear",value:function clear(){return openWriteTransaction(this.name,function _callee5(tx){var request,requestPromise,txPromise;return regeneratorRuntime.async(function _callee5$(_context9){while(1){switch(_context9.prev=_context9.next){case 0:request=tx.objectStore(STORE_NAME).clear();requestPromise=asyncifyRequest(request);txPromise=asyncifyTransaction(tx);_context9.next=5;return regeneratorRuntime.awrap(Promise.all([txPromise,requestPromise]));case 5:case"end":return _context9.stop();}}});});}},{key:"keys",value:function keys(){return openReadOnlyTransaction(this.name,function _callee6(tx){var requestPromise,request,txPromise,_ref3,_ref4,_,value;return regeneratorRuntime.async(function _callee6$(_context10){while(1){switch(_context10.prev=_context10.next){case 0:if(SUPPORTS_GETALLKEYS){request=tx.objectStore(STORE_NAME).getAllKeys();requestPromise=asyncifyRequest(request);}else requestPromise=getEntriesFromCursor(tx,"keys");txPromise=asyncifyTransaction(tx);_context10.next=4;return regeneratorRuntime.awrap(Promise.all([txPromise,requestPromise]));case 4:_ref3=_context10.sent;_ref4=_slicedToArray(_ref3,2);_=_ref4[0];value=_ref4[1];return _context10.abrupt("return",value);case 9:case"end":return _context10.stop();}}});});}},{key:"values",value:function values(){return openReadOnlyTransaction(this.name,function _callee7(tx){var requestPromise,request,txPromise,_ref5,_ref6,_,value;return regeneratorRuntime.async(function _callee7$(_context11){while(1){switch(_context11.prev=_context11.next){case 0:if(SUPPORTS_GETALL){request=tx.objectStore(STORE_NAME).getAll();requestPromise=asyncifyRequest(request);}else requestPromise=getEntriesFromCursor(tx,"values");txPromise=asyncifyTransaction(tx);_context11.next=4;return regeneratorRuntime.awrap(Promise.all([txPromise,requestPromise]));case 4:_ref5=_context11.sent;_ref6=_slicedToArray(_ref5,2);_=_ref6[0];value=_ref6[1];return _context11.abrupt("return",value);case 9:case"end":return _context11.stop();}}});});}},{key:"entries",value:function entries(){return openReadOnlyTransaction(this.name,function _callee8(tx){var requestPromise,txPromise,_ref7,_ref8,_,value;return regeneratorRuntime.async(function _callee8$(_context12){while(1){switch(_context12.prev=_context12.next){case 0:requestPromise=getEntriesFromCursor(tx,"entries");txPromise=asyncifyTransaction(tx);_context12.next=4;return regeneratorRuntime.awrap(Promise.all([txPromise,requestPromise]));case 4:_ref7=_context12.sent;_ref8=_slicedToArray(_ref7,2);_=_ref8[0];value=_ref8[1];return _context12.abrupt("return",value);case 9:case"end":return _context12.stop();}}});});}}]);return KVStorageContainer;}();self.KVStorageContainer=KVStorageContainer;};}// ../lib/storage/localForageAdaptor.js
{'use strict';{var NOT_IMPLEMENTED=function NOT_IMPLEMENTED(name){throw new Error("\"".concat(name,"\" is not implemented"));};var DISALLOW_CALLBACK=function DISALLOW_CALLBACK(fn){if(typeof fn==="function")throw new Error("localforage callback API is not implemented; please use the promise API instead");};var StructuredClone=function StructuredClone(value){if(_typeof(value)==="object")return new Promise(function(resolve){var _ref9=new MessageChannel(),port1=_ref9.port1,port2=_ref9.port2;port2.onmessage=function(ev){return resolve(ev.data);};port1.postMessage(value);});else return Promise.resolve(value);};var _KVStorageContainer=self.KVStorageContainer;var CRITICAL_ERRORS=[/no available storage method found/i,/an attempt was made to break through the security policy of the user agent/i,/the user denied permission to access the database/i,/a mutation operation was attempted on a database that did not allow mutations/i,/idbfactory\.open\(\) called in an invalid security context/i];var memoryStorage=new WeakMap();var isInMemory=false;if(typeof indexedDB==="undefined"){isInMemory=true;console.warn("Unable to use local storage because indexedDB is not defined");}var ForageAdaptor=/*#__PURE__*/function(){function ForageAdaptor(inst){_classCallCheck(this,ForageAdaptor);this._inst=inst;memoryStorage.set(this,new Map());}_createClass(ForageAdaptor,[{key:"_MaybeSwitchToMemoryFallback",value:function _MaybeSwitchToMemoryFallback(err){if(isInMemory)return;var _iteratorNormalCompletion5=true;var _didIteratorError5=false;var _iteratorError5=undefined;try{for(var _iterator5=CRITICAL_ERRORS[Symbol.iterator](),_step5;!(_iteratorNormalCompletion5=(_step5=_iterator5.next()).done);_iteratorNormalCompletion5=true){var regex=_step5.value;if(err&&regex.test(err.message)){console.error("Unable to use local storage, reverting to in-memory store: ",err,err.message);isInMemory=true;break;}}}catch(err){_didIteratorError5=true;_iteratorError5=err;}finally{try{if(!_iteratorNormalCompletion5&&_iterator5["return"]!=null){_iterator5["return"]();}}finally{if(_didIteratorError5){throw _iteratorError5;}}}}},{key:"_getItemFallback",value:function _getItemFallback(name){var value,ret;return regeneratorRuntime.async(function _getItemFallback$(_context13){while(1){switch(_context13.prev=_context13.next){case 0:value=memoryStorage.get(this).get(name);_context13.next=3;return regeneratorRuntime.awrap(StructuredClone(value));case 3:ret=_context13.sent;return _context13.abrupt("return",typeof ret==="undefined"?null:ret);case 5:case"end":return _context13.stop();}}},null,this);}},{key:"_setItemFallback",value:function _setItemFallback(name,value){return regeneratorRuntime.async(function _setItemFallback$(_context14){while(1){switch(_context14.prev=_context14.next){case 0:_context14.next=2;return regeneratorRuntime.awrap(StructuredClone(value));case 2:value=_context14.sent;memoryStorage.get(this).set(name,value);case 4:case"end":return _context14.stop();}}},null,this);}},{key:"_removeItemFallback",value:function _removeItemFallback(name){memoryStorage.get(this)["delete"](name);}},{key:"_clearFallback",value:function _clearFallback(){memoryStorage.get(this).clear();}},{key:"_keysFallback",value:function _keysFallback(){return Array.from(memoryStorage.get(this).keys());}},{key:"IsUsingFallback",value:function IsUsingFallback(){return isInMemory;}},{key:"getItem",value:function getItem(key,successCallback){var result;return regeneratorRuntime.async(function getItem$(_context15){while(1){switch(_context15.prev=_context15.next){case 0:DISALLOW_CALLBACK(successCallback);if(!isInMemory){_context15.next=5;break;}_context15.next=4;return regeneratorRuntime.awrap(this._getItemFallback(key));case 4:return _context15.abrupt("return",_context15.sent);case 5:_context15.prev=5;_context15.next=8;return regeneratorRuntime.awrap(this._inst.get(key));case 8:result=_context15.sent;_context15.next=22;break;case 11:_context15.prev=11;_context15.t0=_context15["catch"](5);this._MaybeSwitchToMemoryFallback(_context15.t0);if(!isInMemory){_context15.next=20;break;}_context15.next=17;return regeneratorRuntime.awrap(this._getItemFallback(key));case 17:return _context15.abrupt("return",_context15.sent);case 20:console.error("Error reading '".concat(key,"' from storage, returning null: "),_context15.t0);return _context15.abrupt("return",null);case 22:return _context15.abrupt("return",typeof result==="undefined"?null:result);case 23:case"end":return _context15.stop();}}},null,this,[[5,11]]);}},{key:"setItem",value:function setItem(key,value,successCallback){return regeneratorRuntime.async(function setItem$(_context16){while(1){switch(_context16.prev=_context16.next){case 0:DISALLOW_CALLBACK(successCallback);if(typeof value==="undefined")value=null;if(!isInMemory){_context16.next=6;break;}_context16.next=5;return regeneratorRuntime.awrap(this._setItemFallback(key,value));case 5:return _context16.abrupt("return");case 6:_context16.prev=6;_context16.next=9;return regeneratorRuntime.awrap(this._inst.set(key,value));case 9:_context16.next=20;break;case 11:_context16.prev=11;_context16.t0=_context16["catch"](6);this._MaybeSwitchToMemoryFallback(_context16.t0);if(!isInMemory){_context16.next=19;break;}_context16.next=17;return regeneratorRuntime.awrap(this._setItemFallback(key,value));case 17:_context16.next=20;break;case 19:throw _context16.t0;case 20:case"end":return _context16.stop();}}},null,this,[[6,11]]);}},{key:"removeItem",value:function removeItem(key,successCallback){return regeneratorRuntime.async(function removeItem$(_context17){while(1){switch(_context17.prev=_context17.next){case 0:DISALLOW_CALLBACK(successCallback);if(!isInMemory){_context17.next=4;break;}this._removeItemFallback(key);return _context17.abrupt("return");case 4:_context17.prev=4;_context17.next=7;return regeneratorRuntime.awrap(this._inst["delete"](key));case 7:_context17.next=13;break;case 9:_context17.prev=9;_context17.t0=_context17["catch"](4);this._MaybeSwitchToMemoryFallback(_context17.t0);if(isInMemory)this._removeItemFallback(key);else console.error("Error removing '".concat(key,"' from storage: "),_context17.t0);case 13:case"end":return _context17.stop();}}},null,this,[[4,9]]);}},{key:"clear",value:function clear(successCallback){return regeneratorRuntime.async(function clear$(_context18){while(1){switch(_context18.prev=_context18.next){case 0:DISALLOW_CALLBACK(successCallback);if(!isInMemory){_context18.next=4;break;}this._clearFallback();return _context18.abrupt("return");case 4:_context18.prev=4;_context18.next=7;return regeneratorRuntime.awrap(this._inst.clear());case 7:_context18.next=13;break;case 9:_context18.prev=9;_context18.t0=_context18["catch"](4);this._MaybeSwitchToMemoryFallback(_context18.t0);if(isInMemory)this._clearFallback();else console.error("Error clearing storage: ",_context18.t0);case 13:case"end":return _context18.stop();}}},null,this,[[4,9]]);}},{key:"keys",value:function keys(successCallback){var result;return regeneratorRuntime.async(function keys$(_context19){while(1){switch(_context19.prev=_context19.next){case 0:DISALLOW_CALLBACK(successCallback);if(!isInMemory){_context19.next=3;break;}return _context19.abrupt("return",this._keysFallback());case 3:result=[];_context19.prev=4;_context19.next=7;return regeneratorRuntime.awrap(this._inst.keys());case 7:result=_context19.sent;_context19.next=18;break;case 10:_context19.prev=10;_context19.t0=_context19["catch"](4);this._MaybeSwitchToMemoryFallback(_context19.t0);if(!isInMemory){_context19.next=17;break;}return _context19.abrupt("return",this._keysFallback());case 17:console.error("Error getting storage keys: ",_context19.t0);case 18:return _context19.abrupt("return",result);case 19:case"end":return _context19.stop();}}},null,this,[[4,10]]);}},{key:"ready",value:function ready(successCallback){DISALLOW_CALLBACK(successCallback);if(isInMemory)return Promise.resolve(true);else return this._inst.ready();}},{key:"createInstance",value:function createInstance(options){if(_typeof(options)!=="object")throw new TypeError("invalid options object");var name=options["name"];if(typeof name!=="string")throw new TypeError("invalid store name");var inst=new _KVStorageContainer(name);return new ForageAdaptor(inst);}},{key:"length",value:function length(successCallback){NOT_IMPLEMENTED("localforage.length()");}},{key:"key",value:function key(index,successCallback){NOT_IMPLEMENTED("localforage.key()");}},{key:"iterate",value:function iterate(iteratorCallback,successCallback){NOT_IMPLEMENTED("localforage.iterate()");}},{key:"setDriver",value:function setDriver(driverName){NOT_IMPLEMENTED("localforage.setDriver()");}},{key:"config",value:function config(options){NOT_IMPLEMENTED("localforage.config()");}},{key:"defineDriver",value:function defineDriver(customDriver){NOT_IMPLEMENTED("localforage.defineDriver()");}},{key:"driver",value:function driver(){NOT_IMPLEMENTED("localforage.driver()");}},{key:"supports",value:function supports(driverName){NOT_IMPLEMENTED("localforage.supports()");}},{key:"dropInstance",value:function dropInstance(){NOT_IMPLEMENTED("localforage.dropInstance()");}},{key:"disableMemoryMode",value:function disableMemoryMode(){isInMemory=false;}}]);return ForageAdaptor;}();self["localforage"]=new ForageAdaptor(new _KVStorageContainer("localforage"));};}// ../lib/misc/supports.js
{'use strict';var _C3=self.C3;_C3.Supports={};_C3.Supports.WebAnimations=function(){try{if(typeof document==="undefined")return false;var e=document.createElement("div");if(typeof e.animate==="undefined")return false;var player=e.animate([{opacity:"0"},{opacity:"1"}],1E3);return typeof player.reverse!=="undefined";}catch(e){return false;}}();_C3.Supports.DialogElement=typeof HTMLDialogElement!=="undefined";_C3.Supports.RequestIdleCallback=!!self.requestIdleCallback;_C3.Supports.ImageBitmap=!!self.createImageBitmap;_C3.Supports.ImageBitmapOptions=false;_C3.Supports.ImageBitmapOptionsResize=false;if(_C3.Supports.ImageBitmap){try{self.createImageBitmap(new ImageData(32,32),{"premultiplyAlpha":"none"}).then(function(){_C3.Supports.ImageBitmapOptions=true;})["catch"](function(){_C3.Supports.ImageBitmapOptions=false;});}catch(err){_C3.Supports.ImageBitmapOptions=false;}try{self.createImageBitmap(new ImageData(32,32),{"resizeWidth":10,"resizeHeight":10}).then(function(imageBitmap){_C3.Supports.ImageBitmapOptionsResize=imageBitmap.width===10&&imageBitmap.height===10;})["catch"](function(){_C3.Supports.ImageBitmapOptionsResize=false;});}catch(err){_C3.Supports.ImageBitmapOptionsResize=false;}}_C3.Supports.ClipboardReadText=!!(navigator["clipboard"]&&navigator["clipboard"]["readText"]&&_C3.Platform.Browser!=="Firefox");_C3.Supports.PermissionsQuery=!!(navigator["permissions"]&&navigator["permissions"]["query"]);_C3.Supports.ClipboardPermissionsQuery=false;if(_C3.Supports.PermissionsQuery){var permission={"name":"clipboard-read"};navigator["permissions"]["query"](permission).then(function(){_C3.Supports.ClipboardPermissionsQuery=true;})["catch"](function(){_C3.Supports.ClipboardPermissionsQuery=false;});}_C3.Supports.AsyncClipboardApi=!!(navigator["permissions"]&&navigator["clipboard"]&&self["ClipboardItem"]);_C3.Supports.Proxies=typeof Proxy!=="undefined";_C3.Supports.DownloadAttribute=function(){if(typeof document==="undefined")return false;var a=document.createElement("a");return typeof a.download!=="undefined";}();_C3.Supports.Fetch=typeof fetch==="function";_C3.Supports.PersistentStorage=!!(self.isSecureContext&&_C3.Platform.Browser!=="Opera"&&navigator["storage"]&&navigator["storage"]["persist"]);_C3.Supports.StorageQuotaEstimate=!!(self.isSecureContext&&navigator["storage"]&&navigator["storage"]["estimate"]);_C3.Supports.Fullscreen=function(){if(typeof document==="undefined")return false;if(_C3.Platform.OS==="iOS")return false;var elem=document.documentElement;return!!(elem.requestFullscreen||elem.msRequestFullscreen||elem.mozRequestFullScreen||elem.webkitRequestFullscreen);}();_C3.Supports.ImageDecoder=typeof self["ImageDecoder"]!=="undefined";_C3.Supports.WebCodecs=!!self["VideoEncoder"];_C3.Supports.NativeFileSystemAPI=!!self["showOpenFilePicker"];_C3.Supports.QueryLocalFonts=!!self["queryLocalFonts"];_C3.Supports.UserActivation=!!navigator["userActivation"];_C3.Supports.CanvasToBlobWebP=false;(function _callee9(){var canvas,ctx,blob;return regeneratorRuntime.async(function _callee9$(_context20){while(1){switch(_context20.prev=_context20.next){case 0:if(typeof document==="undefined")canvas=new OffscreenCanvas(32,32);else{canvas=document.createElement("canvas");canvas.width=32;canvas.height=32;}ctx=canvas.getContext("2d");ctx.fillStyle="blue";ctx.fillRect(0,0,32,32);blob=null;_context20.prev=5;if(!canvas["convertToBlob"]){_context20.next=12;break;}_context20.next=9;return regeneratorRuntime.awrap(canvas["convertToBlob"]({"type":"image/webp","quality":1}));case 9:blob=_context20.sent;_context20.next=16;break;case 12:if(!canvas.toBlob){_context20.next=16;break;}_context20.next=15;return regeneratorRuntime.awrap(new Promise(function(resolve){return canvas.toBlob(resolve,"image/webp",1);}));case 15:blob=_context20.sent;case 16:_C3.Supports.CanvasToBlobWebP=blob&&blob.type==="image/webp";_context20.next=22;break;case 19:_context20.prev=19;_context20.t0=_context20["catch"](5);_C3.Supports.CanvasToBlobWebP=false;case 22:case"end":return _context20.stop();}}},null,null,[[5,19]]);})();}// ../lib/misc/polyfills.js
{'use strict';var _C4=self.C3;if(!String.prototype.trimStart){var startWhitespace=/^[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]*/;String.prototype.trimStart=function trimStart(){return this.replace(startWhitespace,"");};}if(!String.prototype.trimEnd){var endWhitespace=/[\x09\x0A\x0B\x0C\x0D\x20\xA0\u1680\u180E\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u202F\u205F\u3000\u2028\u2029\uFEFF]*$/;String.prototype.trimEnd=function trimEnd(){return this.replace(endWhitespace,"");};}if(!String.prototype.replaceAll)String.prototype.replaceAll=function replaceAll(find,replace){return this.replace(new RegExp(_C4.EscapeRegex(find),"g"),replace);};if(!Array.prototype.values)Array.prototype.values=/*#__PURE__*/regeneratorRuntime.mark(function _callee10(){var _iteratorNormalCompletion6,_didIteratorError6,_iteratorError6,_iterator6,_step6,i;return regeneratorRuntime.wrap(function _callee10$(_context21){while(1){switch(_context21.prev=_context21.next){case 0:_iteratorNormalCompletion6=true;_didIteratorError6=false;_iteratorError6=undefined;_context21.prev=3;_iterator6=this[Symbol.iterator]();case 5:if(_iteratorNormalCompletion6=(_step6=_iterator6.next()).done){_context21.next=12;break;}i=_step6.value;_context21.next=9;return i;case 9:_iteratorNormalCompletion6=true;_context21.next=5;break;case 12:_context21.next=18;break;case 14:_context21.prev=14;_context21.t0=_context21["catch"](3);_didIteratorError6=true;_iteratorError6=_context21.t0;case 18:_context21.prev=18;_context21.prev=19;if(!_iteratorNormalCompletion6&&_iterator6["return"]!=null){_iterator6["return"]();}case 21:_context21.prev=21;if(!_didIteratorError6){_context21.next=24;break;}throw _iteratorError6;case 24:return _context21.finish(21);case 25:return _context21.finish(18);case 26:case"end":return _context21.stop();}}},_callee10,this,[[3,14,18,26],[19,,21,25]]);});if(!Array.prototype.flat){var arrayFlat=function arrayFlat(arr,depth){return arr.reduce(function(acc,val){if(depth>0&&Array.isArray(val)){Array.prototype.push.apply(acc,arrayFlat(val,depth-1));return acc;}else{acc.push(val);return acc;}},[]);};Array.prototype.flat=function(){var depth=arguments.length>0&&arguments[0]!==undefined?arguments[0]:1;return arrayFlat(this,depth);};}if(!Array.prototype.at)Array.prototype.at=function at(n){n=Math.trunc(n)||0;if(n<0)n+=this.length;if(n<0||n>=this.length)return undefined;return this[n];};if(!String.prototype.at)String.prototype.at=function at(n){n=Math.trunc(n)||0;if(n<0)n+=this.length;if(n<0||n>=this.length)return undefined;return this[n];};if(!RegExp.escape)RegExp.escape=function(s){return String(s).replace(/[\\^$*+?.()|[\]{}]/g,"\\$&");};if(navigator["storage"]&&!navigator["storage"]["estimate"]&&navigator["webkitTemporaryStorage"]&&navigator["webkitTemporaryStorage"]["queryUsageAndQuota"])navigator["storage"]["estimate"]=function(){return new Promise(function(resolve,reject){return navigator["webkitTemporaryStorage"]["queryUsageAndQuota"](function(usage,quota){return resolve({"usage":usage,"quota":quota});},reject);});};if(typeof self.isSecureContext==="undefined")self.isSecureContext=location.protocol==="https:";if(typeof self["globalThis"]==="undefined")self["globalThis"]=self;}// lib/misc/assert.js
{var assertFail=function assertFail(msg_){var stack=_C5.GetCallStack();var msg="Assertion failure: "+msg_+"\n\nStack trace:\n"+stack;console.error(msg);};'use strict';var _C5=self.C3;self.assert=function assert(cnd_,msg_){if(!cnd_)assertFail(msg_);};}// ../lib/misc/typeChecks.js
{'use strict';var _C6=self.C3;var C3X=self.C3X;_C6.IsNumber=function IsNumber(x){return typeof x==="number";};_C6.IsFiniteNumber=function IsFiniteNumber(x){return _C6.IsNumber(x)&&isFinite(x);};_C6.RequireNumber=function RequireNumber(x){if(!_C6.IsNumber(x))throw new TypeError("expected number");};_C6.RequireOptionalNumber=function RequireOptionalNumber(x){if(_C6.IsNullOrUndefined(x))return;};_C6.RequireNumberInRange=function RequireNumberInRange(x,low,high){if(!_C6.IsNumber(x)||isNaN(x)||low>x||high<x)throw new RangeError("number outside of range");};_C6.RequireAllNumber=function RequireAllNumber(){for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}for(var _i2=0,_args22=args;_i2<_args22.length;_i2++){var a=_args22[_i2];}};_C6.RequireFiniteNumber=function RequireFiniteNumber(x){if(!_C6.IsFiniteNumber(x))throw new TypeError("expected finite number");};_C6.RequireOptionalFiniteNumber=function RequireOptionalFiniteNumber(x){if(_C6.IsNullOrUndefined(x))return;};_C6.RequireAllFiniteNumber=function RequireAllFiniteNumber(){for(var _len2=arguments.length,args=new Array(_len2),_key2=0;_key2<_len2;_key2++){args[_key2]=arguments[_key2];}for(var _i3=0,_args23=args;_i3<_args23.length;_i3++){var a=_args23[_i3];}};_C6.IsString=function IsString(x){return typeof x==="string";};_C6.RequireString=function RequireString(x){if(!_C6.IsString(x))throw new TypeError("expected string");};_C6.RequireOptionalString=function RequireOptionalString(x){if(_C6.IsNullOrUndefined(x))return;};_C6.RequireAllString=function RequireAllString(){for(var _len3=arguments.length,args=new Array(_len3),_key3=0;_key3<_len3;_key3++){args[_key3]=arguments[_key3];}for(var _i4=0,_args24=args;_i4<_args24.length;_i4++){var a=_args24[_i4];}};_C6.IsSimpleObject=function IsSimpleObject(x){if(_typeof(x)!=="object"||x===null)return false;var proto=Object.getPrototypeOf(x);return proto?proto.constructor===Object:proto===null;};_C6.RequireSimpleObject=function RequireSimpleObject(x){if(!_C6.IsSimpleObject(x))throw new TypeError("expected simple object");};_C6.RequireOptionalSimpleObject=function RequireSimpleObject(x){if(_C6.IsNullOrUndefined(x))return;if(!_C6.IsSimpleObject(x))throw new TypeError("expected simple object");};_C6.IsObject=function IsObject(x){return _typeof(x)==="object"&&x!==null&&!Array.isArray(x);};_C6.RequireObject=function RequireObject(x){if(!_C6.IsObject(x))throw new TypeError("expected object");};_C6.RequireOptionalObject=function RequireOptionalObject(x){if(_C6.IsNullOrUndefined(x))return;};_C6.RequireAllObject=function RequireAllObject(){for(var _len4=arguments.length,args=new Array(_len4),_key4=0;_key4<_len4;_key4++){args[_key4]=arguments[_key4];}for(var _i5=0,_args25=args;_i5<_args25.length;_i5++){var a=_args25[_i5];}};_C6.IsFileLike=function IsFileLike(x){return _C6.WeakIsInstanceOf(x,Blob)&&typeof x["name"]==="string";};_C6.RequireFileLike=function RequireFileLike(x){if(!_C6.IsFileLike(x))throw new TypeError("expected file");};_C6.RequireOptionalFileLike=function RequireOptionalFileLike(x){if(_C6.IsNullOrUndefined(x))return;};_C6.IsArray=function IsArray(x){return Array.isArray(x);};_C6.RequireArray=function RequireArray(x){if(!_C6.IsArray(x))throw new TypeError("expected array");};_C6.RequireOptionalArray=function RequireOptionalArray(x){if(_C6.IsNullOrUndefined(x))return;};_C6.RequireAllArray=function RequireAllArray(){for(var _len5=arguments.length,args=new Array(_len5),_key5=0;_key5<_len5;_key5++){args[_key5]=arguments[_key5];}for(var _i6=0,_args26=args;_i6<_args26.length;_i6++){var a=_args26[_i6];}};_C6.Is2DArray=function(x){if(!_C6.IsArray(x))return false;if(!x.length)return true;if(!_C6.IsArray(x[0]))return false;return true;};_C6.Require2DArray=function Require2DArray(x){if(!_C6.Is2DArray(x))throw new TypeError("expected 2d array");var _iteratorNormalCompletion7=true;var _didIteratorError7=false;var _iteratorError7=undefined;try{for(var _iterator7=x[Symbol.iterator](),_step7;!(_iteratorNormalCompletion7=(_step7=_iterator7.next()).done);_iteratorNormalCompletion7=true){var arr=_step7.value;if(!_C6.IsArray(arr))throw new TypeError("expected 2d array");}}catch(err){_didIteratorError7=true;_iteratorError7=err;}finally{try{if(!_iteratorNormalCompletion7&&_iterator7["return"]!=null){_iterator7["return"]();}}finally{if(_didIteratorError7){throw _iteratorError7;}}}};_C6.RequireOptional2DArray=function Require2DArray(x){if(_C6.IsNullOrUndefined(x))return;};_C6.IsFunction=function IsFunction(x){return typeof x==="function";};_C6.RequireFunction=function RequireFunction(x,f){if(!_C6.IsFunction(x))throw new TypeError("expected function");if(!_C6.IsNullOrUndefined(f))if(x!==f)throw new TypeError("expected same function reference");};_C6.RequireOptionalFunction=function RequireOptionalFunction(x){if(_C6.IsNullOrUndefined(x))return;};_C6.RequireAllFunction=function RequireAllFunction(){for(var _len6=arguments.length,args=new Array(_len6),_key6=0;_key6<_len6;_key6++){args[_key6]=arguments[_key6];}for(var _i7=0,_args27=args;_i7<_args27.length;_i7++){var a=_args27[_i7];}};_C6.RequireAnyFunction=function RequireAllFunction(x){if(!_C6.IsFunction(x))throw new TypeError("expected function");for(var _len7=arguments.length,args=new Array(_len7>1?_len7-1:0),_key7=1;_key7<_len7;_key7++){args[_key7-1]=arguments[_key7];}if(!args.length)throw new Error("missing comparison functions");for(var _i8=0,_args28=args;_i8<_args28.length;_i8++){var a=_args28[_i8];if(!_C6.IsNullOrUndefined(a))if(x===a)return;}throw new TypeError("expected same function reference");};_C6.RequireOptionalAllFunction=function RequireAllFunction(){for(var _len8=arguments.length,args=new Array(_len8),_key8=0;_key8<_len8;_key8++){args[_key8]=arguments[_key8];}if(_C6.IsNullOrUndefined(args))return;for(var _i9=0,_args29=args;_i9<_args29.length;_i9++){var a=_args29[_i9];}};_C6.IsInstanceOf=function IsInstanceOf(x,t){return x instanceof t;};_C6.IsInstanceOfAny=function IsInstanceOfAny(x){for(var _len9=arguments.length,args=new Array(_len9>1?_len9-1:0),_key9=1;_key9<_len9;_key9++){args[_key9-1]=arguments[_key9];}for(var _i10=0,_args30=args;_i10<_args30.length;_i10++){var t=_args30[_i10];if(_C6.IsInstanceOf(x,t))return true;}return false;};_C6.RequireInstanceOf=function RequireInstanceOf(x,t){if(!_C6.IsInstanceOf(x,t))throw new TypeError("unexpected type");};_C6.RequireOptionalInstanceOf=function RequireOptionalInstanceOf(x,t){if(_C6.IsNullOrUndefined(x))return;};_C6.RequireAllInstanceOf=function RequireAllInstanceOf(t){for(var _len10=arguments.length,args=new Array(_len10>1?_len10-1:0),_key10=1;_key10<_len10;_key10++){args[_key10-1]=arguments[_key10];}for(var _i11=0,_args31=args;_i11<_args31.length;_i11++){var a=_args31[_i11];}};_C6.RequireAnyInstanceOf=function RequireAnyInstanceOf(x){for(var _len11=arguments.length,args=new Array(_len11>1?_len11-1:0),_key11=1;_key11<_len11;_key11++){args[_key11-1]=arguments[_key11];}if(!_C6.IsInstanceOfAny.apply(_C6,[x].concat(args)))throw new TypeError("unexpected type");};_C6.RequireAnyOptionalInstanceOf=function RequireAnyOptionalInstanceOf(x){if(_C6.IsNullOrUndefined(x))return;for(var _len12=arguments.length,args=new Array(_len12>1?_len12-1:0),_key12=1;_key12<_len12;_key12++){args[_key12-1]=arguments[_key12];}if(!_C6.IsInstanceOfAny.apply(_C6,[x].concat(args)))throw new TypeError("unexpected type");};_C6.IsArrayOf=function IsArrayOf(x,t){var _iteratorNormalCompletion8=true;var _didIteratorError8=false;var _iteratorError8=undefined;try{for(var _iterator8=x[Symbol.iterator](),_step8;!(_iteratorNormalCompletion8=(_step8=_iterator8.next()).done);_iteratorNormalCompletion8=true){var i=_step8.value;if(!_C6.IsInstanceOf(i,t))return false;}}catch(err){_didIteratorError8=true;_iteratorError8=err;}finally{try{if(!_iteratorNormalCompletion8&&_iterator8["return"]!=null){_iterator8["return"]();}}finally{if(_didIteratorError8){throw _iteratorError8;}}}return true;};_C6.IsArrayOfFiniteNumbers=function IsArrayOfFiniteNumbers(x){var _iteratorNormalCompletion9=true;var _didIteratorError9=false;var _iteratorError9=undefined;try{for(var _iterator9=x[Symbol.iterator](),_step9;!(_iteratorNormalCompletion9=(_step9=_iterator9.next()).done);_iteratorNormalCompletion9=true){var i=_step9.value;if(!_C6.IsFiniteNumber(i))return false;}}catch(err){_didIteratorError9=true;_iteratorError9=err;}finally{try{if(!_iteratorNormalCompletion9&&_iterator9["return"]!=null){_iterator9["return"]();}}finally{if(_didIteratorError9){throw _iteratorError9;}}}return true;};_C6.RequireArrayOf=function RequireArrayOf(x,t){var _iteratorNormalCompletion10=true;var _didIteratorError10=false;var _iteratorError10=undefined;try{for(var _iterator10=x[Symbol.iterator](),_step10;!(_iteratorNormalCompletion10=(_step10=_iterator10.next()).done);_iteratorNormalCompletion10=true){var i=_step10.value;;}}catch(err){_didIteratorError10=true;_iteratorError10=err;}finally{try{if(!_iteratorNormalCompletion10&&_iterator10["return"]!=null){_iterator10["return"]();}}finally{if(_didIteratorError10){throw _iteratorError10;}}}};_C6.RequireOptionalArrayOf=function RequireOptionalArrayOf(x,t){if(_C6.IsNullOrUndefined(x))return;var _iteratorNormalCompletion11=true;var _didIteratorError11=false;var _iteratorError11=undefined;try{for(var _iterator11=x[Symbol.iterator](),_step11;!(_iteratorNormalCompletion11=(_step11=_iterator11.next()).done);_iteratorNormalCompletion11=true){var i=_step11.value;;}}catch(err){_didIteratorError11=true;_iteratorError11=err;}finally{try{if(!_iteratorNormalCompletion11&&_iterator11["return"]!=null){_iterator11["return"]();}}finally{if(_didIteratorError11){throw _iteratorError11;}}}};_C6.RequireArrayOfAny=function RequireArrayOf(x){var _iteratorNormalCompletion12=true;var _didIteratorError12=false;var _iteratorError12=undefined;try{for(var _iterator12=x[Symbol.iterator](),_step12;!(_iteratorNormalCompletion12=(_step12=_iterator12.next()).done);_iteratorNormalCompletion12=true){var i=_step12.value;;}}catch(err){_didIteratorError12=true;_iteratorError12=err;}finally{try{if(!_iteratorNormalCompletion12&&_iterator12["return"]!=null){_iterator12["return"]();}}finally{if(_didIteratorError12){throw _iteratorError12;}}}};_C6.RequireOptionalArrayOfAny=function RequireOptionalArrayOfAny(x){if(_C6.IsNullOrUndefined(x))return;var _iteratorNormalCompletion13=true;var _didIteratorError13=false;var _iteratorError13=undefined;try{for(var _iterator13=x[Symbol.iterator](),_step13;!(_iteratorNormalCompletion13=(_step13=_iterator13.next()).done);_iteratorNormalCompletion13=true){var i=_step13.value;;}}catch(err){_didIteratorError13=true;_iteratorError13=err;}finally{try{if(!_iteratorNormalCompletion13&&_iterator13["return"]!=null){_iterator13["return"]();}}finally{if(_didIteratorError13){throw _iteratorError13;}}}};_C6.IsDOMNode=function IsDOMNode(d,n){if(_C6.IsNullOrUndefined(d)||!_C6.IsString(d.nodeName))return false;return!n||_C6.equalsNoCase(d.nodeName,n);};_C6.RequireDOMNode=function RequireDOMNode(d,n){if(_C6.IsNullOrUndefined(d)||!_C6.IsString(d.nodeName))throw new TypeError("expected DOM node");if(n&&!_C6.equalsNoCase(d.nodeName,n))throw new TypeError("expected DOM '".concat(n,"' node"));};_C6.RequireOptionalDOMNode=function RequireOptionalDOMNode(d,n){if(_C6.IsNullOrUndefined(d))return;};_C6.IsHTMLElement=function IsHTMLElement(e,t){if(_C6.IsNullOrUndefined(e)||!_C6.IsString(e.tagName))return false;return!t||_C6.equalsNoCase(e.tagName,t);};_C6.RequireHTMLElement=function RequireHTMLElement(e,t){if(_C6.IsNullOrUndefined(e)||!_C6.IsString(e.tagName))throw new TypeError("expected HTML element");if(t&&!_C6.equalsNoCase(e.tagName,t))throw new TypeError("expected HTML '".concat(t,"' element"));};_C6.RequireOptionalHTMLElement=function RequireOptionalHTMLElement(e,t){if(_C6.IsNullOrUndefined(e))return;};_C6.IsDrawable=function IsDrawable(d){return _C6.IsHTMLElement(d,"img")||_C6.IsHTMLElement(d,"canvas")||_C6.IsHTMLElement(d,"video")||typeof OffscreenCanvas!=="undefined"&&d instanceof OffscreenCanvas||typeof ImageBitmap!=="undefined"&&d instanceof ImageBitmap;};_C6.RequireDrawable=function RequireDrawable(d){if(!_C6.IsDrawable(d))throw new TypeError("expected drawable");};_C6.RequireOptionalDrawable=function RequireOptionalDrawable(d){if(_C6.IsNullOrUndefined(d))return;};_C6.IsDrawableOrImageData=function IsDrawableOrImageData(x){if(x instanceof ImageData)return true;return _C6.IsDrawable(x);};_C6.RequireDrawableOrImageData=function RequireDrawableOrImageData(d){if(!_C6.IsDrawableOrImageData(d))throw new TypeError("expected drawable or image data");};_C6.RequireOptionalDrawableOrImageData=function RequireOptionalDrawableOrImageData(d){if(_C6.IsNullOrUndefined(d))return;if(!_C6.IsDrawableOrImageData(d))throw new TypeError("expected drawable or image data");};_C6.IsStringLike=function IsStringLike(x){return typeof x==="string"||_C6.HtmlString&&x instanceof _C6.HtmlString||x instanceof _C6.BBString;};_C6.RequireStringLike=function RequireStringLike(x){if(!_C6.IsStringLike(x))throw new TypeError("expected string-like");};_C6.RequireOptionalStringLike=function RequireOptionalStringLike(x){if(_C6.IsNullOrUndefined(x))return;};_C6.RequireAllStringLike=function RequireAllStringLike(){for(var _len13=arguments.length,args=new Array(_len13),_key13=0;_key13<_len13;_key13++){args[_key13]=arguments[_key13];}for(var _i12=0,_args32=args;_i12<_args32.length;_i12++){var a=_args32[_i12];}};_C6.RequireOverride=function RequireOverride(){throw new Error("must be overridden");};_C6.NotYetImplemented=function NotYetImplemented(){throw new Error("not yet implemented");};_C6.IsDefined=function isDefined(obj){var currentObject=obj;if(typeof currentObject==="undefined")return false;for(var _len14=arguments.length,follow=new Array(_len14>1?_len14-1:0),_key14=1;_key14<_len14;_key14++){follow[_key14-1]=arguments[_key14];}for(var _i13=0,_follow=follow;_i13<_follow.length;_i13++){var key=_follow[_i13];if(typeof currentObject[key]==="undefined")return false;currentObject=currentObject[key];}return true;};_C6.IsNullOrUndefined=function(x){return typeof x==="undefined"||x===null;};_C6.AreArrayElementsOfSameType=function(arr){var type=arr[0].constructor;var _iteratorNormalCompletion14=true;var _didIteratorError14=false;var _iteratorError14=undefined;try{for(var _iterator14=arr[Symbol.iterator](),_step14;!(_iteratorNormalCompletion14=(_step14=_iterator14.next()).done);_iteratorNormalCompletion14=true){var x=_step14.value;if(x.constructor!==type)return false;}}catch(err){_didIteratorError14=true;_iteratorError14=err;}finally{try{if(!_iteratorNormalCompletion14&&_iterator14["return"]!=null){_iterator14["return"]();}}finally{if(_didIteratorError14){throw _iteratorError14;}}}return type;};_C6.AreArrayElementsOfType=function(arr,t){var _iteratorNormalCompletion15=true;var _didIteratorError15=false;var _iteratorError15=undefined;try{for(var _iterator15=arr[Symbol.iterator](),_step15;!(_iteratorNormalCompletion15=(_step15=_iterator15.next()).done);_iteratorNormalCompletion15=true){var x=_step15.value;if(!(x instanceof t))return false;}}catch(err){_didIteratorError15=true;_iteratorError15=err;}finally{try{if(!_iteratorNormalCompletion15&&_iterator15["return"]!=null){_iterator15["return"]();}}finally{if(_didIteratorError15){throw _iteratorError15;}}}return true;};var TypedArray=Object.getPrototypeOf(Uint8Array);_C6.IsTypedArray=function(view){return _C6.IsInstanceOf(view,TypedArray);};_C6.RequireTypedArray=function(view){};_C6.WeakRequireTypedArray=function WeakRequireTypedArray(inst){_C6.WeakRequireInstanceOf(inst,TypedArray);};_C6.WeakRequireAnyInstanceOf=function WeakRequireAnyInstanceOf(inst){for(var _len15=arguments.length,ctors=new Array(_len15>1?_len15-1:0),_key15=1;_key15<_len15;_key15++){ctors[_key15-1]=arguments[_key15];}if(!_C6.WeakIsAnyInstanceOf.apply(_C6,[inst].concat(ctors)))throw new TypeError("unexpected type");};_C6.WeakIsAnyInstanceOf=function WeakIsAnyInstanceOf(inst){for(var _len16=arguments.length,ctors=new Array(_len16>1?_len16-1:0),_key16=1;_key16<_len16;_key16++){ctors[_key16-1]=arguments[_key16];}for(var _i14=0,_ctors=ctors;_i14<_ctors.length;_i14++){var ctor=_ctors[_i14];if(_C6.WeakIsInstanceOf(inst,ctor))return true;}return false;};_C6.WeakRequireInstanceOf=function WeakRequireInstanceOf(inst,ctor){if(!_C6.WeakIsInstanceOf(inst,ctor))throw new TypeError("unexpected type");};_C6.WeakIsInstanceOf=function WeakIsInstanceOf(inst,ctor){while(inst=Object.getPrototypeOf(inst)){if(inst.constructor.name===ctor.name)return true;}return false;};C3X.RequireNumber=_C6.RequireNumber;C3X.RequireOptionalNumber=_C6.RequireOptionalNumber;C3X.RequireFiniteNumber=_C6.RequireFiniteNumber;C3X.RequireOptionalFiniteNumber=_C6.RequireOptionalFiniteNumber;C3X.RequireString=_C6.RequireString;C3X.RequireOptionalString=_C6.RequireOptionalString;C3X.RequireObject=_C6.RequireObject;C3X.RequireOptionalObject=_C6.RequireOptionalObject;C3X.RequireArray=_C6.RequireArray;C3X.RequireOptionalArray=_C6.RequireOptionalArray;C3X.RequireFunction=_C6.RequireFunction;C3X.RequireOptionalFunction=_C6.RequireOptionalFunction;C3X.RequireInstanceOf=_C6.RequireInstanceOf;C3X.RequireOptionalInstanceOf=_C6.RequireOptionalInstanceOf;C3X.IsNullOrUndefined=_C6.IsNullOrUndefined;}// ../lib/misc/jsutil.js
{var isValidTypeChange=function isValidTypeChange(from,to){var fromType=_C7.getType(from);var toType=_C7.getType(to);if(fromType==="null"||toType==="null")return true;if(fromType==="undefined"||toType==="undefined")return false;return fromType===toType;};var logDefendedObjectWarning=function logDefendedObjectWarning(msg){console.warn("[Defence] "+msg+" @",_C7.GetCallStack());};var CheckDefendedObjectsUsedCorrectly=function CheckDefendedObjectsUsedCorrectly(){checkRafId=-1;if(ctorObjectToProxy.size>0||ctorProxyToObject.size>0){var uniqueNames=new Set(_toConsumableArray(ctorObjectToProxy.keys()).map(function(o){return _C7.getName(o);}));var leftoverNames=_toConsumableArray(uniqueNames).join(",");console.warn("An object derived from DefendedBase was not protected with debugDefend(). This will disable some checks. See the coding guidelines! Possible affected class names: ".concat(leftoverNames));ctorObjectToProxy.clear();ctorProxyToObject.clear();}};var getObjectPropertySet=function getObjectPropertySet(o){var ret=new Set();for(var k in o){ret.add(k);}return ret;};var VerifyObjectPropertiesConsistent=function VerifyObjectPropertiesConsistent(Type,o){var properties=getObjectPropertySet(o);var existingProperties=typeProperties.get(Type);if(existingProperties){var inconsistentProperties=[];var _iteratorNormalCompletion16=true;var _didIteratorError16=false;var _iteratorError16=undefined;try{for(var _iterator16=existingProperties.values()[Symbol.iterator](),_step16;!(_iteratorNormalCompletion16=(_step16=_iterator16.next()).done);_iteratorNormalCompletion16=true){var k=_step16.value;if(properties.has(k))properties["delete"](k);else inconsistentProperties.push(k);}}catch(err){_didIteratorError16=true;_iteratorError16=err;}finally{try{if(!_iteratorNormalCompletion16&&_iterator16["return"]!=null){_iterator16["return"]();}}finally{if(_didIteratorError16){throw _iteratorError16;}}}_C7.appendArray(inconsistentProperties,_toConsumableArray(properties));if(inconsistentProperties.length)console.warn("[Defence] '".concat(_C7.getName(Type),"' constructor creates inconsistent properties: ").concat(inconsistentProperties.join(", ")));}else typeProperties.set(Type,properties);};'use strict';var _C7=self.C3;var logRafIds=new Map();_C7.ColorLog=function(message,color){console.log("%c".concat(message),"font-weight: bold; color:".concat(color));};_C7.RafLog=function RaFLog(name){for(var _len17=arguments.length,args=new Array(_len17>1?_len17-1:0),_key17=1;_key17<_len17;_key17++){args[_key17-1]=arguments[_key17];}if(!logRafIds.has(name))logRafIds.set(name,-1);if(logRafIds.get(name)===-1)logRafIds.set(name,requestAnimationFrame(function(){var _console;(_console=console).log.apply(_console,["%c".concat(name),"font-weight: bold"].concat(args));logRafIds.set(name,-1);}));};var measures;_C7.StartMeasure=function StartMeasure(name){performance.mark(name);if(!measures)measures=new Map();if(!measures.has(name))measures.set(name,{current:0,total:0,average:0,calls:1,toString:function toString(){return"".concat(name," :: current => ").concat(this.current.toPrecision(3)," :: average => ").concat(this.average.toPrecision(3)," :: calls => ").concat(this.calls);}});};_C7.EndMeasure=function EndMeasure(name){performance.measure("measure-".concat(name),name);var entry=performance.getEntriesByName("measure-".concat(name))[0];var m=measures.get(name);m.current=entry.duration;m.total+=m.current;m.average=m.total/m.calls;console.log(m.toString());m.calls++;performance.clearMarks(name);performance.clearMeasures("measure-".concat(name));};_C7.GetCallStack=function GetCallStack(){return new Error().stack;};_C7.Debugger=function Debugger(){debugger;};_C7.cast=function cast(o,T){if(o&&o instanceof T)return o;else return null;};_C7.getName=function getName(o){if(typeof o==="undefined")return"undefined";if(o===null)return"null";if(typeof o==="boolean")return"<boolean>";if(_C7.IsNumber(o))return"<number>";if(_C7.IsString(o))return"<string>";if(_C7.IsArray(o))return"<array>";if(_typeof(o)==="symbol")return"<"+o.toString()+">";if(_C7.IsFunction(o)){if(o.name&&o.name!=="Function")return o.name;return"<anonymous function>";}if(_typeof(o)==="object"){if(o.constructor&&o.constructor.name&&o.constructor.name!=="Object")return o.constructor.name;return"<anonymous object>";}return"<unknown>";};_C7.getType=function getType(o){if(o===null)return"null";if(Array.isArray(o))return"array";return _typeof(o);};_C7.range=/*#__PURE__*/regeneratorRuntime.mark(function range(a,b){var i,_i15;return regeneratorRuntime.wrap(function range$(_context22){while(1){switch(_context22.prev=_context22.next){case 0:if(isFinite(Math.abs(a-b))){_context22.next=2;break;}throw new Error("Invalid parameters");case 2:if(!(a>b)){_context22.next=12;break;}i=a-1;case 4:if(!(i>=b)){_context22.next=10;break;}_context22.next=7;return i;case 7:i--;_context22.next=4;break;case 10:_context22.next=19;break;case 12:_i15=a;case 13:if(!(_i15<b)){_context22.next=19;break;}_context22.next=16;return _i15;case 16:_i15++;_context22.next=13;break;case 19:case"end":return _context22.stop();}}},range);});var ctorObjectToProxy=new Map();var ctorProxyToObject=new Map();var proxyToObject=new WeakMap();var releasedObjects=new WeakMap();_C7.DefendHandler={};var VALID_GET_MISSING_KEYS=new Set(["then","splice"]);_C7.DefendHandler.get=function defended_get(target,key){if(!(key in target)&&_typeof(key)!=="symbol"&&!VALID_GET_MISSING_KEYS.has(key))logDefendedObjectWarning("Accessed missing property '".concat(key,"' from defended object '").concat(_C7.getName(target),"', returning undefined"));if(releasedObjects.has(target)&&_typeof(key)!=="symbol"&&!VALID_GET_MISSING_KEYS.has(key))logDefendedObjectWarning("Accessed property '".concat(key,"' on a released object '").concat(_C7.getName(target),"'\nObject was originally released at: ").concat(releasedObjects.get(target),")\nCall stack at access: "));return target[key];};_C7.DefendHandler.set=function defended_set(target,key,value){if(!(key in target)&&!ctorObjectToProxy.has(target))logDefendedObjectWarning("Set non-existent property '".concat(key,"' to '").concat(value,"' on defended object '").concat(_C7.getName(target),"'"));if(!isValidTypeChange(target[key],value)&&!ctorObjectToProxy.has(target))logDefendedObjectWarning("Set '".concat(_C7.getType(target[key]),"' property '").concat(key,"' to type '").concat(_C7.getType(value),"' on defended object '").concat(_C7.getName(target),"'"));if(releasedObjects.has(target))logDefendedObjectWarning("Set property '".concat(key,"' on a released object '").concat(_C7.getName(target),"'\nObject was originally released at: ").concat(releasedObjects.get(target),")\nCall stack at access: "));target[key]=value;return true;};_C7.DefendHandler.deleteProperty=function defended_deleteProperty(target,key){throw new ReferenceError("Cannot delete property '".concat(key,"' from defended object '").concat(_C7.getName(target),"'"));};_C7.DefendHandler.defineProperty=function defended_defineProperty(target,key,desc){throw new ReferenceError("Cannot define property '".concat(key,"' on defended object '").concat(_C7.getName(target),"'"));};_C7.DefendHandler.enumerate=function defended_enumerate(target){throw new ReferenceError("Cannot enumerate defended object '".concat(_C7.getName(target),"'"));};var checkRafId=-1;_C7.DefendedBase=function DefendedBase(){_classCallCheck(this,DefendedBase);if(!_C7.isDebugDefend||!_C7.Supports.Proxies)return;var newTarget=this instanceof DefendedBase?this.constructor:void 0;var realObject=Object.create(newTarget.prototype);var proxy=new Proxy(realObject,_C7.DefendHandler);ctorObjectToProxy.set(realObject,proxy);ctorProxyToObject.set(proxy,realObject);proxyToObject.set(proxy,realObject);if(checkRafId===-1)checkRafId=requestAnimationFrame(CheckDefendedObjectsUsedCorrectly);return proxy;};_C7.debugDefend=function debugDefend(o){if(_C7.isDebugDefend&&_C7.Supports.Proxies&&o instanceof _C7.DefendedBase){if(!ctorProxyToObject.has(o))return o;var realObject=ctorProxyToObject.get(o);ctorProxyToObject["delete"](o);ctorObjectToProxy["delete"](realObject);return o;}else if(_C7.isDebug)return Object.seal(o);else return o;};_C7.New=function New(Type){var o;try{for(var _len18=arguments.length,args=new Array(_len18>1?_len18-1:0),_key18=1;_key18<_len18;_key18++){args[_key18-1]=arguments[_key18];}o=_construct(Type,args);}catch(e){ctorProxyToObject.clear();ctorObjectToProxy.clear();throw e;}if(_C7.isDebugDefend)VerifyObjectPropertiesConsistent(Type,o);return _C7.debugDefend(o);};_C7.Release=function Release(o){var realObject=proxyToObject.get(o);if(realObject)releasedObjects.set(realObject,_C7.GetCallStack());};_C7.WasReleased=function(o){var realObject=proxyToObject.get(o);if(!realObject)return false;return!!releasedObjects.get(realObject);};var typeProperties=new Map();_C7.PerfMark=/*#__PURE__*/function(){function PerfMark(name){_classCallCheck(this,PerfMark);this._name="";if(name)this.start(name);}_createClass(PerfMark,[{key:"start",value:function start(name){if(!_C7.isPerformanceProfiling)return;this._name=name;performance.mark(this._name+"-Start");}},{key:"end",value:function end(){if(!_C7.isPerformanceProfiling)return;performance.mark(this._name+"-End");performance.measure(this._name,this._name+"-Start",this._name+"-End");}},{key:"next",value:function next(name){if(!_C7.isPerformanceProfiling)return;this.end();this._name=name;performance.mark(this._name+"-Start");}}]);return PerfMark;}();}// ../lib/misc/mathutil.js
{var isNegativeZero=function isNegativeZero(x){return x===0&&1/x<0;};'use strict';var _C8=self.C3;var TWO_PI=Math.PI*2;var D_TO_R=Math.PI/180;var R_TO_D=180/Math.PI;_C8.wrap=function wrap(x,min,max){x=Math.floor(x);min=Math.floor(min);max=Math.floor(max);var diff=max-min;if(diff===0)return max;if(x<min){var r=max-(min-x)%diff;return r===max?0:r;}else return min+(x-min)%diff;};_C8.mapToRange=function mapToRange(x,inMin,inMax,outMin,outMax){return(x-inMin)*(outMax-outMin)/(inMax-inMin)+outMin;};_C8.normalize=function normalize(value,minimum,maximum){if(minimum-maximum===0)return 1;return(value-minimum)/(maximum-minimum);};_C8.clamp=function clamp(x,a,b){if(x<a)return a;else if(x>b)return b;else return x;};_C8.clampAngle=function clampAngle(a){a%=TWO_PI;if(a<0)a+=TWO_PI;return a;};_C8.toRadians=function toRadians(x){return x*D_TO_R;};_C8.toDegrees=function toDegrees(x){return x*R_TO_D;};_C8.distanceTo=function distanceTo(x1,y1,x2,y2){return Math.hypot(x2-x1,y2-y1);};_C8.distanceSquared=function distanceSquared(x1,y1,x2,y2){var dx=x2-x1;var dy=y2-y1;return dx*dx+dy*dy;};_C8.angleTo=function angleTo(x1,y1,x2,y2){return Math.atan2(y2-y1,x2-x1);};_C8.angleDiff=function angleDiff(a1,a2){if(a1===a2)return 0;var s1=Math.sin(a1);var c1=Math.cos(a1);var s2=Math.sin(a2);var c2=Math.cos(a2);var n=s1*s2+c1*c2;if(n>=1)return 0;if(n<=-1)return Math.PI;return Math.acos(n);};_C8.angleRotate=function angleRotate(start,end,step){var ss=Math.sin(start);var cs=Math.cos(start);var se=Math.sin(end);var ce=Math.cos(end);if(Math.acos(ss*se+cs*ce)>step){if(cs*se-ss*ce>0)return _C8.clampAngle(start+step);else return _C8.clampAngle(start-step);}else return _C8.clampAngle(end);};_C8.angleClockwise=function angleClockwise(a1,a2){var s1=Math.sin(a1);var c1=Math.cos(a1);var s2=Math.sin(a2);var c2=Math.cos(a2);return c1*s2-s1*c2<=0;};_C8.angleLerp=function angleLerp(a,b,x){var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var diff=_C8.angleDiff(a,b);var revs=TWO_PI*r;if(_C8.angleClockwise(b,a))return _C8.clampAngle(a+(diff+revs)*x);else return _C8.clampAngle(a-(diff+revs)*x);};_C8.angleLerpClockwise=function angleLerpClockwise(a,b,x){var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var diff=_C8.angleDiff(a,b);var revs=TWO_PI*r;if(_C8.angleClockwise(b,a))return _C8.clampAngle(a+(diff+revs)*x);return _C8.clampAngle(a+(TWO_PI-diff+revs)*x);};_C8.angleLerpAntiClockwise=function angleLerpAntiClockwise(a,b,x){var r=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var diff=_C8.angleDiff(a,b);var revs=TWO_PI*r;if(_C8.angleClockwise(b,a))return _C8.clampAngle(a-(-TWO_PI+diff-revs)*x);return _C8.clampAngle(a-(diff+revs)*x);};_C8.angleReflect=function angleReflect(a,b){var diff=_C8.angleDiff(a,b);if(_C8.angleClockwise(a,b))return _C8.clampAngle(b-diff);else return _C8.clampAngle(b+diff);};_C8.lerp=function lerp(a,b,x){return a+x*(b-a);};_C8.unlerp=function unlerp(a,b,x){if(a===b)return 0;return(x-a)/(b-a);};_C8.relerp=function relerp(a,b,x,c,d){return _C8.lerp(c,d,_C8.unlerp(a,b,x));};_C8.qarp=function qarp(a,b,c,x){return _C8.lerp(_C8.lerp(a,b,x),_C8.lerp(b,c,x),x);};_C8.cubic=function cubic(a,b,c,d,x){return _C8.lerp(_C8.qarp(a,b,c,x),_C8.qarp(b,c,d,x),x);};_C8.cosp=function cosp(a,b,x){return(a+b+(a-b)*Math.cos(x*Math.PI))/2;};_C8.isPOT=function isPOT(x){return x>0&&(x-1&x)===0;};_C8.nextHighestPowerOfTwo=function nextHighestPowerOfTwo(x){--x;for(var i=1;i<32;i<<=1){x=x|x>>i;}return x+1;};_C8.roundToNearestFraction=function roundToNearestFraction(x,n){return Math.round(x*n)/n;};_C8.floorToNearestFraction=function floorToNearestFraction(x,n){return Math.floor(x*n)/n;};_C8.roundToDp=function roundToDp(x,dp){dp=Math.max(Math.floor(dp),0);var m=Math.pow(10,dp);return Math.round(x*m)/m;};_C8.countDecimals=function countDecimals(value){if(Math.floor(value)!==value)return value.toString().split(".")[1].length||0;return 0;};_C8.toFixed=function toFixed(n,dp){var ret=n.toFixed(dp);var last=ret.length-1;for(;last>=0&&ret.charAt(last)==="0";--last){;}if(last>=0&&ret.charAt(last)===".")--last;if(last<0)return ret;return ret.substr(0,last+1);};_C8.PackRGB=function PackRGB(red,green,blue){return _C8.clamp(red,0,255)|_C8.clamp(green,0,255)<<8|_C8.clamp(blue,0,255)<<16;};var ALPHAEX_SHIFT=1024;var ALPHAEX_MAX=1023;var RGBEX_SHIFT=16384;var RGBEX_MAX=8191;var RGBEX_MIN=-8192;_C8.PackRGBAEx=function PackRGBAEx(red,green,blue,alpha){red=_C8.clamp(Math.floor(red*1024),RGBEX_MIN,RGBEX_MAX);green=_C8.clamp(Math.floor(green*1024),RGBEX_MIN,RGBEX_MAX);blue=_C8.clamp(Math.floor(blue*1024),RGBEX_MIN,RGBEX_MAX);alpha=_C8.clamp(Math.floor(alpha*ALPHAEX_MAX),0,ALPHAEX_MAX);if(red<0)red+=RGBEX_SHIFT;if(green<0)green+=RGBEX_SHIFT;if(blue<0)blue+=RGBEX_SHIFT;return-(red*RGBEX_SHIFT*RGBEX_SHIFT*ALPHAEX_SHIFT+green*RGBEX_SHIFT*ALPHAEX_SHIFT+blue*ALPHAEX_SHIFT+alpha);};_C8.PackRGBEx=function PackRGBEx(red,green,blue){return _C8.PackRGBAEx(red,green,blue,1);};_C8.GetRValue=function GetRValue(rgb){if(rgb>=0)return(rgb&255)/255;else{var v=Math.floor(-rgb/(RGBEX_SHIFT*RGBEX_SHIFT*ALPHAEX_SHIFT));if(v>RGBEX_MAX)v-=RGBEX_SHIFT;return v/1024;}};_C8.GetGValue=function GetGValue(rgb){if(rgb>=0)return((rgb&65280)>>8)/255;else{var v=Math.floor(-rgb%(RGBEX_SHIFT*RGBEX_SHIFT*ALPHAEX_SHIFT)/(RGBEX_SHIFT*ALPHAEX_SHIFT));if(v>RGBEX_MAX)v-=RGBEX_SHIFT;return v/1024;}};_C8.GetBValue=function GetBValue(rgb){if(rgb>=0)return((rgb&16711680)>>16)/255;else{var v=Math.floor(-rgb%(RGBEX_SHIFT*ALPHAEX_SHIFT)/ALPHAEX_SHIFT);if(v>RGBEX_MAX)v-=RGBEX_SHIFT;return v/1024;}};_C8.GetAValue=function GetAValue(rgb){if(isNegativeZero(rgb))return 0;else if(rgb>=0)return 1;else{var v=Math.floor(-rgb%ALPHAEX_SHIFT);return v/ALPHAEX_MAX;}};_C8.greatestCommonDivisor=function greatestCommonDivisor(a,b){a=Math.floor(a);b=Math.floor(b);while(b!==0){var t=b;b=a%b;a=t;}return a;};var COMMON_ASPECT_RATIOS=[[3,2],[4,3],[5,4],[5,3],[6,5],[14,9],[16,9],[16,10],[21,9]];_C8.getAspectRatio=function getAspectRatio(w,h){w=Math.floor(w);h=Math.floor(h);if(w===h)return[1,1];var _iteratorNormalCompletion17=true;var _didIteratorError17=false;var _iteratorError17=undefined;try{for(var _iterator17=COMMON_ASPECT_RATIOS[Symbol.iterator](),_step17;!(_iteratorNormalCompletion17=(_step17=_iterator17.next()).done);_iteratorNormalCompletion17=true){var aspect=_step17.value;var approxH=w/aspect[0]*aspect[1];if(Math.abs(h-approxH)<1)return aspect.slice(0);approxH=w/aspect[1]*aspect[0];if(Math.abs(h-approxH)<1)return[aspect[1],aspect[0]];}}catch(err){_didIteratorError17=true;_iteratorError17=err;}finally{try{if(!_iteratorNormalCompletion17&&_iterator17["return"]!=null){_iterator17["return"]();}}finally{if(_didIteratorError17){throw _iteratorError17;}}}var gcd=_C8.greatestCommonDivisor(w,h);return[w/gcd,h/gcd];};_C8.segmentsIntersect=function segmentsIntersect(a1x,a1y,a2x,a2y,b1x,b1y,b2x,b2y){var min_ax=Math.min(a1x,a2x);var max_ax=Math.max(a1x,a2x);var min_bx=Math.min(b1x,b2x);var max_bx=Math.max(b1x,b2x);if(max_ax<min_bx||min_ax>max_bx)return false;var min_ay=Math.min(a1y,a2y);var max_ay=Math.max(a1y,a2y);var min_by=Math.min(b1y,b2y);var max_by=Math.max(b1y,b2y);if(max_ay<min_by||min_ay>max_by)return false;var dpx=b1x-a1x+b2x-a2x;var dpy=b1y-a1y+b2y-a2y;var qax=a2x-a1x;var qay=a2y-a1y;var qbx=b2x-b1x;var qby=b2y-b1y;var d=Math.abs(qay*qbx-qby*qax);var la=qbx*dpy-qby*dpx;if(Math.abs(la)>d)return false;var lb=qax*dpy-qay*dpx;return Math.abs(lb)<=d;};_C8.segmentsIntersectPreCalc=function segmentsIntersectPreCalc(a1x,a1y,a2x,a2y,min_ax,max_ax,min_ay,max_ay,b1x,b1y,b2x,b2y){var min_bx=Math.min(b1x,b2x);var max_bx=Math.max(b1x,b2x);if(max_ax<min_bx||min_ax>max_bx)return false;var min_by=Math.min(b1y,b2y);var max_by=Math.max(b1y,b2y);if(max_ay<min_by||min_ay>max_by)return false;var dpx=b1x-a1x+b2x-a2x;var dpy=b1y-a1y+b2y-a2y;var qax=a2x-a1x;var qay=a2y-a1y;var qbx=b2x-b1x;var qby=b2y-b1y;var d=Math.abs(qay*qbx-qby*qax);var la=qbx*dpy-qby*dpx;if(Math.abs(la)>d)return false;var lb=qax*dpy-qay*dpx;return Math.abs(lb)<=d;};_C8.segmentIntersectsQuad=function segmentIntersectsQuad(x1,y1,x2,y2,q){var min_x=Math.min(x1,x2);var max_x=Math.max(x1,x2);var min_y=Math.min(y1,y2);var max_y=Math.max(y1,y2);var tlx=q.getTlx(),tly=q.getTly(),trx=q.getTrx(),try_=q.getTry(),brx=q.getBrx(),bry=q.getBry(),blx=q.getBlx(),bly=q.getBly();return _C8.segmentsIntersectPreCalc(x1,y1,x2,y2,min_x,max_x,min_y,max_y,tlx,tly,trx,try_)||_C8.segmentsIntersectPreCalc(x1,y1,x2,y2,min_x,max_x,min_y,max_y,trx,try_,brx,bry)||_C8.segmentsIntersectPreCalc(x1,y1,x2,y2,min_x,max_x,min_y,max_y,brx,bry,blx,bly)||_C8.segmentsIntersectPreCalc(x1,y1,x2,y2,min_x,max_x,min_y,max_y,blx,bly,tlx,tly);};_C8.segmentIntersectsAnyN=function segmentIntersectsAnyN(x1,y1,x2,y2,points){var min_x=Math.min(x1,x2);var max_x=Math.max(x1,x2);var min_y=Math.min(y1,y2);var max_y=Math.max(y1,y2);var i=0;for(var last=points.length-4;i<=last;i+=2){if(_C8.segmentsIntersectPreCalc(x1,y1,x2,y2,min_x,max_x,min_y,max_y,points[i],points[i+1],points[i+2],points[i+3]))return true;}return _C8.segmentsIntersectPreCalc(x1,y1,x2,y2,min_x,max_x,min_y,max_y,points[i],points[i+1],points[0],points[1]);};var NO_HIT=2;var PADDING=1E-6;_C8.rayIntersect=function rayIntersect(rx1,ry1,rx2,ry2,sx1,sy1,sx2,sy2){var rdx=rx2-rx1;var rdy=ry2-ry1;var sdx=sx2-sx1;var sdy=sy2-sy1;var det=rdx*sdy-rdy*sdx;if(det===0)return NO_HIT;var gamma=((ry1-ry2)*(sx2-rx1)+rdx*(sy2-ry1))/det;if(0<gamma&&gamma<1+PADDING)return(sdy*(sx2-rx1)+(sx1-sx2)*(sy2-ry1))/det;return NO_HIT;};_C8.rayIntersectExtended=function rayIntersect(rx1,ry1,rx2,ry2,sx1,sy1,sx2,sy2,f){var dx=(sx2-sx1)*f;var dy=(sy2-sy1)*f;return _C8.rayIntersect(rx1,ry1,rx2,ry2,sx1-dx,sy1-dy,sx2+dx,sy2+dy);};_C8.isPointInTriangleInclusive=function isPointInTriangleInclusive(px,py,tx1,ty1,tx2,ty2,tx3,ty3){var v0x=tx2-tx1;var v0y=ty2-ty1;var v1x=tx3-tx1;var v1y=ty3-ty1;var v2x=px-tx1;var v2y=py-ty1;var dot00=v0x*v0x+v0y*v0y;var dot01=v0x*v1x+v0y*v1y;var dot02=v0x*v2x+v0y*v2y;var dot11=v1x*v1x+v1y*v1y;var dot12=v1x*v2x+v1y*v2y;var invDenom=1/(dot00*dot11-dot01*dot01);var u=(dot11*dot02-dot01*dot12)*invDenom;var v=(dot00*dot12-dot01*dot02)*invDenom;return u>=0&&v>=0&&u+v<=1;};_C8.triangleCartesianToBarycentric=function triangleCartesianToBarycentric(px,py,tx1,ty1,tx2,ty2,tx3,ty3){var v0x=tx2-tx1;var v0y=ty2-ty1;var v1x=tx3-tx1;var v1y=ty3-ty1;var v2x=px-tx1;var v2y=py-ty1;var dot00=v0x*v0x+v0y*v0y;var dot01=v0x*v1x+v0y*v1y;var dot11=v1x*v1x+v1y*v1y;var dot20=v2x*v0x+v2y*v0y;var dot21=v2x*v1x+v2y*v1y;var denom=dot00*dot11-dot01*dot01;var v=(dot11*dot20-dot01*dot21)/denom;var w=(dot00*dot21-dot01*dot20)/denom;var u=1-v-w;return[u,v,w];};_C8.triangleBarycentricToCartesian3d=function triangleBarycentricToCartesian3d(u,v,w,tx1,ty1,tz1,tx2,ty2,tz2,tx3,ty3,tz3){return[u*tx1+v*tx2+w*tx3,u*ty1+v*ty2+w*ty3,u*tz1+v*tz2+w*tz3];};}// ../lib/misc/miscutil.js
{'use strict';var _C9=self.C3;var mainDocument=null;var baseHref="";if(typeof document!=="undefined"){mainDocument=document;var baseElem=document.querySelector("base");baseHref=baseElem&&baseElem.hasAttribute("href")?baseElem.getAttribute("href"):"";if(baseHref){if(baseHref.startsWith("/"))baseHref=baseHref.substr(1);if(!baseHref.endsWith("/"))baseHref+="/";}}_C9.GetBaseHref=function GetBaseHref(){return baseHref;};_C9.GetBaseURL=function GetBaseURL(){if(!mainDocument)return"";var loc=mainDocument.location;return _C9.GetPathFromURL(loc.origin+loc.pathname)+baseHref;};_C9.GetPathFromURL=function GetPathFromURL(url){if(!url.length)return url;if(url.endsWith("/")||url.endsWith("\\"))return url;var lastSlash=Math.max(url.lastIndexOf("/"),url.lastIndexOf("\\"));if(lastSlash===-1)return"";return url.substr(0,lastSlash+1);};_C9.GetFilenameFromURL=function GetFilenameFromURL(url){if(!url.length)return url;if(url.endsWith("/")||url.endsWith("\\"))return"";var lastSlash=Math.max(url.lastIndexOf("/"),url.lastIndexOf("\\"));if(lastSlash===-1)return url;return url.substr(lastSlash+1);};_C9.GetFileExtension=function GetFileExtension(filename){var i=filename.lastIndexOf(".");if(i<1)return"";else return filename.substr(i);};_C9.SetFileExtension=function SetFileExtension(filename,newExt){var i=filename.lastIndexOf(".");if(i===-1)return filename+"."+newExt;else return filename.substr(0,i+1)+newExt;};_C9.GetFileNamePart=function GetFileNamePart(filename){var i=filename.lastIndexOf(".");if(i<1)return filename;else return filename.substr(0,i);};_C9.NormalizeFileSeparator=function NormalizeFileSeparator(path){return path.replace(/\\/g,"/");};_C9.IsFileExtension=function IsFileExtension(filename,extension){var ext=filename?_C9.GetFileExtension(filename).slice(1):"";return extension===ext;};_C9.FileNameEquals=function FileNameEquals(file_or_filename,other_file_or_filename){var firstName;var secondName;if(_C9.IsFileLike(file_or_filename))firstName=_C9.GetFileNamePart(file_or_filename["name"]);if(_C9.IsString(file_or_filename))firstName=_C9.GetFileNamePart(file_or_filename);if(_C9.IsFileLike(other_file_or_filename))secondName=_C9.GetFileNamePart(other_file_or_filename["name"]);if(_C9.IsString(other_file_or_filename))secondName=_C9.GetFileNamePart(other_file_or_filename);return firstName===secondName;};_C9.ParseFilePath=function ParseFilePath(path){path=_C9.NormalizeFileSeparator(path);var root=/^\w:\//.exec(path);if(root){root=root[0];path=path.slice(3);if(path[0]!=="/")path="/"+path;}else root="";path=path.replace(/\/{2,}/g,"/");if(path.length>1&&path.slice(-1)==="/")path=path.slice(0,-1);var start=path.lastIndexOf("/")+1;var dir="",base=path,name,ext="";if(start>0){dir=path.slice(0,start);base=path.slice(start);}name=base;var end=base.lastIndexOf(".");if(end>0){ext=base.slice(end);name=base.slice(0,-ext.length);}var full=root+dir+base;return{dir:dir,base:base,name:name,root:root,ext:ext,full:full};};_C9.Wait=function Wait(delay,argument){return new Promise(function(resolve,reject){self.setTimeout(resolve,delay,argument);});};_C9.swallowException=function swallowException(f){try{f();}catch(e){if(_C9.isDebug)console.warn("Swallowed exception: ",e);}};_C9.noop=function noop(){};_C9.equalsNoCase=function equalsNoCase(a,b){if(typeof a!=="string"||typeof b!=="string")return false;return a===b||a.normalize().toLowerCase()===b.normalize().toLowerCase();};_C9.equalsCase=function equalsCase(a,b){if(typeof a!=="string"||typeof b!=="string")return false;if(a===b)return true;return a.normalize()===b.normalize();};_C9.typedArraySet16=function typedArraySet16(dest,src,i){dest[i++]=src[0];dest[i++]=src[1];dest[i++]=src[2];dest[i++]=src[3];dest[i++]=src[4];dest[i++]=src[5];dest[i++]=src[6];dest[i++]=src[7];dest[i++]=src[8];dest[i++]=src[9];dest[i++]=src[10];dest[i++]=src[11];dest[i++]=src[12];dest[i++]=src[13];dest[i++]=src[14];dest[i]=src[15];};_C9.truncateArray=function truncateArray(arr,index){arr.length=index;};_C9.clearArray=function clearArray(arr){if(!arr)return;if(arr.length===0)return;_C9.truncateArray(arr,0);};_C9.clear2DArray=function clear2DArray(arr){if(!arr)return;for(var i=0;i<arr.length;i++){var a=arr[i];_C9.truncateArray(a,0);}_C9.truncateArray(arr,0);};_C9.extendArray=function extendArray(arr,len,filler){len=len|0;var arrayLength=arr.length;if(len<=arrayLength)return;for(var i=arrayLength;i<len;++i){arr.push(filler);}};_C9.resizeArray=function resizeArray(arr,len,filler){len=len|0;var arrayLength=arr.length;if(len<arrayLength)_C9.truncateArray(arr,len);else if(len>arrayLength)_C9.extendArray(arr,len,filler);};_C9.shallowAssignArray=function shallowAssignArray(dest,src){_C9.clearArray(dest);_C9.appendArray(dest,src);};_C9.appendArray=function appendArray(a,b){if(b.length<1E4)a.push.apply(a,_toConsumableArray(b));else for(var i=0,len=b.length;i<len;++i){a.push(b[i]);}};_C9.arrayRemove=function(arr,index){index=Math.floor(index);if(index<0||index>=arr.length)return;var len=arr.length-1;for(var i=index;i<len;++i){arr[i]=arr[i+1];}_C9.truncateArray(arr,len);};_C9.arrayFindRemove=function arrayFindRemove(a,o){var i=a.indexOf(o);if(i>=0)a.splice(i,1);};_C9.arraysEqual=function arraysEqual(a,b){var len=a.length;if(b.length!==len)return false;for(var i=0;i<len;++i){if(a[i]!==b[i])return false;}return true;};_C9.arrayFilterOut=function arrayFilterOut(arr,callback){var ret=[];var j=0;for(var i=0,len=arr.length;i<len;++i){var item=arr[i];if(callback(item))ret.push(item);else{arr[j]=item;++j;}}_C9.truncateArray(arr,j);return ret;};_C9.arrayRemoveAllInSet=function arrayRemoveAllInSet(arr,s){var oldLen=arr.length;var j=0;for(var i=0,len=arr.length;i<len;++i){var item=arr[i];if(!s.has(item))arr[j++]=item;}_C9.truncateArray(arr,j);return oldLen-j;};_C9.isArrayIndexInBounds=function isArrayIndexInBounds(index,array){if(index!==Math.floor(index))return false;return index>=0&&index<array.length;};_C9.validateArrayIndex=function validateArrayIndex(index,array){if(!_C9.isArrayIndexInBounds(index,array))throw new RangeError("array index out of bounds");};_C9.cloneArray=function cloneArray(array){return array.slice();};_C9.deepCloneArray=function deepCloneArray(array,f){var ret=[];var _iteratorNormalCompletion18=true;var _didIteratorError18=false;var _iteratorError18=undefined;try{for(var _iterator18=array[Symbol.iterator](),_step18;!(_iteratorNormalCompletion18=(_step18=_iterator18.next()).done);_iteratorNormalCompletion18=true){var e=_step18.value;if(_C9.IsObject(e)){var clone=f(e);if(!clone)throw new Error("missing clone");if(clone.constructor!==e.constructor)throw new Error("object is not a clone");ret.push(clone);}else if(_C9.IsArray(e))ret.push(_C9.deepCloneArray(e,f));else ret.push(e);}}catch(err){_didIteratorError18=true;_iteratorError18=err;}finally{try{if(!_iteratorNormalCompletion18&&_iterator18["return"]!=null){_iterator18["return"]();}}finally{if(_didIteratorError18){throw _iteratorError18;}}}return ret;};_C9.clone2DArray=function cloneArray(array){var ret=[];var _iteratorNormalCompletion19=true;var _didIteratorError19=false;var _iteratorError19=undefined;try{for(var _iterator19=array[Symbol.iterator](),_step19;!(_iteratorNormalCompletion19=(_step19=_iterator19.next()).done);_iteratorNormalCompletion19=true){var arr=_step19.value;ret.push(arr.slice());}}catch(err){_didIteratorError19=true;_iteratorError19=err;}finally{try{if(!_iteratorNormalCompletion19&&_iterator19["return"]!=null){_iterator19["return"]();}}finally{if(_didIteratorError19){throw _iteratorError19;}}}return ret;};_C9.mergeSets=function mergeSets(set1,set2){return new Set([].concat(_toConsumableArray(set1),_toConsumableArray(set2)));};_C9.mergeSetsInPlace=function mergeSetsInPlace(set1,set2){var _iteratorNormalCompletion20=true;var _didIteratorError20=false;var _iteratorError20=undefined;try{for(var _iterator20=set2[Symbol.iterator](),_step20;!(_iteratorNormalCompletion20=(_step20=_iterator20.next()).done);_iteratorNormalCompletion20=true){var item=_step20.value;set1.add(item);}}catch(err){_didIteratorError20=true;_iteratorError20=err;}finally{try{if(!_iteratorNormalCompletion20&&_iterator20["return"]!=null){_iterator20["return"]();}}finally{if(_didIteratorError20){throw _iteratorError20;}}}return set1;};_C9.first=function first(iterable){var _iteratorNormalCompletion21=true;var _didIteratorError21=false;var _iteratorError21=undefined;try{for(var _iterator21=iterable[Symbol.iterator](),_step21;!(_iteratorNormalCompletion21=(_step21=_iterator21.next()).done);_iteratorNormalCompletion21=true){var i=_step21.value;return i;}}catch(err){_didIteratorError21=true;_iteratorError21=err;}finally{try{if(!_iteratorNormalCompletion21&&_iterator21["return"]!=null){_iterator21["return"]();}}finally{if(_didIteratorError21){throw _iteratorError21;}}}return null;};_C9.xor=function(x,y){return!x!==!y;};_C9.compare=function compare(x,cmp,y){switch(cmp){case 0:return x===y;case 1:return x!==y;case 2:return x<y;case 3:return x<=y;case 4:return x>y;case 5:return x>=y;default:return false;}};_C9.hasAnyOwnProperty=function hasAnyOwnProperty(o){for(var p in o){if(o.hasOwnProperty(p))return true;}return false;};_C9.PromiseAllWithProgress=function PromiseAllWithProgress(arr,progressCallback){if(!arr.length)return Promise.resolve([]);return new Promise(function(resolve,reject){var results=[];var numberCompleted=0;var cancelled=false;var _loop=function _loop(i,len){results.push(void 0);arr[i].then(function(result){if(cancelled)return;results[i]=result;++numberCompleted;if(numberCompleted===arr.length)resolve(results);else progressCallback(numberCompleted,arr.length);})["catch"](function(err){cancelled=true;reject(err);});};for(var i=0,len=arr.length;i<len;++i){_loop(i,len);}});};var memoryCallbacks=[];_C9.AddLibraryMemoryCallback=function AddLibraryMemoryCallback(f){memoryCallbacks.push(f);};_C9.GetEstimatedLibraryMemoryUsage=function GetEstimatedLibraryMemoryUsage(){var ret=0;var _iteratorNormalCompletion22=true;var _didIteratorError22=false;var _iteratorError22=undefined;try{for(var _iterator22=memoryCallbacks[Symbol.iterator](),_step22;!(_iteratorNormalCompletion22=(_step22=_iterator22.next()).done);_iteratorNormalCompletion22=true){var f=_step22.value;var m=f();ret+=m;}}catch(err){_didIteratorError22=true;_iteratorError22=err;}finally{try{if(!_iteratorNormalCompletion22&&_iterator22["return"]!=null){_iterator22["return"]();}}finally{if(_didIteratorError22){throw _iteratorError22;}}}return Math.floor(ret);};var nextTaskId=1;var activeTaskIds=new Map();var taskMessageChannel=new MessageChannel();taskMessageChannel.port2.onmessage=function OnTask(e){var id=e.data;var callback=activeTaskIds.get(id);activeTaskIds["delete"](id);if(callback)callback(performance.now());};_C9.RequestUnlimitedAnimationFrame=function RequestUnlimitedAnimationFrame(callback){var id=nextTaskId++;activeTaskIds.set(id,callback);taskMessageChannel.port1.postMessage(id);return id;};_C9.CancelUnlimitedAnimationFrame=function CancelUnlimitedAnimationFrame(id){activeTaskIds["delete"](id);};_C9.PostTask=_C9.RequestUnlimitedAnimationFrame;_C9.WaitForNextTask=function WaitForNextTask(){return new Promise(function(resolve){return _C9.PostTask(resolve);});};var activeRPAFids=new Set();_C9.RequestPostAnimationFrame=function RequestPostAnimationFrame(callback){var id=self.requestAnimationFrame(function _callee11(timestamp){return regeneratorRuntime.async(function _callee11$(_context23){while(1){switch(_context23.prev=_context23.next){case 0:_context23.next=2;return regeneratorRuntime.awrap(_C9.WaitForNextTask());case 2:if(activeRPAFids.has(id)){_context23.next=4;break;}return _context23.abrupt("return");case 4:activeRPAFids["delete"](id);callback(timestamp);case 6:case"end":return _context23.stop();}}});});activeRPAFids.add(id);return id;};_C9.CancelPostAnimationFrame=function CancelPostAnimationFrame(id){if(!activeRPAFids.has(id))return;self.cancelAnimationFrame(id);activeRPAFids["delete"](id);};}// lib/misc/runtimeutil.js
{'use strict';var _C10=self.C3;_C10.IsAbsoluteURL=function IsAbsoluteURL(url){return /^(?:[a-z\-]+:)?\/\//.test(url)||url.substr(0,5)==="data:"||url.substr(0,5)==="blob:";};_C10.IsRelativeURL=function IsRelativeURL(url){return!_C10.IsAbsoluteURL(url);};_C10.ThrowIfNotOk=function ThrowIfNotOk(response){if(!response.ok)throw new Error("fetch '".concat(response.url,"' response returned ").concat(response.status," ").concat(response.statusText));};_C10.FetchOk=function FetchOk(url,init){return fetch(url,init).then(function(response){_C10.ThrowIfNotOk(response);return response;});};_C10.FetchText=function FetchText(url){return _C10.FetchOk(url).then(function(response){return response.text();});};_C10.FetchJson=function FetchJson(url){return _C10.FetchOk(url).then(function(response){return response.json();});};_C10.FetchBlob=function FetchBlob(url){return _C10.FetchOk(url).then(function(response){return response.blob();});};_C10.FetchArrayBuffer=function FetchArrayBuffer(url){return _C10.FetchOk(url).then(function(response){return response.arrayBuffer();});};_C10.FetchImage=function FetchImage(url){return new Promise(function(resolve,reject){var img=new Image();img.onload=function(){return resolve(img);};img.onerror=function(err){return reject(err);};img.src=url;});};_C10.BlobToArrayBuffer=function BlobToArrayBuffer(blob){if(typeof blob["arrayBuffer"]==="function")return blob["arrayBuffer"]();else return new Promise(function(resolve,reject){var fileReader=new FileReader();fileReader.onload=function(){return resolve(fileReader.result);};fileReader.onerror=function(){return reject(fileReader.error);};fileReader.readAsArrayBuffer(blob);});};_C10.BlobToString=function BlobToString(blob){if(typeof blob["text"]==="function")return blob["text"]();else return new Promise(function(resolve,reject){var fileReader=new FileReader();fileReader.onload=function(){return resolve(fileReader.result);};fileReader.onerror=function(){return reject(fileReader.error);};fileReader.readAsText(blob);});};_C10.BlobToJson=function BlobToJson(blob){return _C10.BlobToString(blob).then(function(text){return JSON.parse(text);});};_C10.BlobToImage=function BlobToImage(blob,decodeImage){var blobUrl,img;return regeneratorRuntime.async(function BlobToImage$(_context24){while(1){switch(_context24.prev=_context24.next){case 0:blobUrl=URL.createObjectURL(blob);_context24.prev=1;_context24.next=4;return regeneratorRuntime.awrap(_C10.FetchImage(blobUrl));case 4:img=_context24.sent;URL.revokeObjectURL(blobUrl);blobUrl="";if(!(decodeImage&&typeof img["decode"]==="function")){_context24.next=10;break;}_context24.next=10;return regeneratorRuntime.awrap(img["decode"]());case 10:return _context24.abrupt("return",img);case 11:_context24.prev=11;if(blobUrl)URL.revokeObjectURL(blobUrl);return _context24.finish(11);case 14:case"end":return _context24.stop();}}},null,null,[[1,,11,14]]);};_C10.CreateCanvas=function CreateCanvas(width,height){if(typeof document!=="undefined"&&typeof document.createElement==="function"){var canvas=document.createElement("canvas");canvas.width=width;canvas.height=height;return canvas;}else return new OffscreenCanvas(width,height);};_C10.CanvasToBlob=function CanvasToBlob(canvas,type,quality){if(typeof quality!=="number")quality=1;type=type||"image/png";quality=_C10.clamp(quality,0,1);if(canvas["convertToBlob"])return canvas["convertToBlob"]({"type":type,"quality":quality});else if(canvas.toBlob)return new Promise(function(resolve){return canvas.toBlob(resolve,type,quality);});else throw new Error("could not convert canvas to blob");};_C10.DrawableToBlob=function DrawableToBlob(drawable,type,quality){var canvas=_C10.CreateCanvas(drawable.width,drawable.height);var ctx=canvas.getContext("2d");ctx.drawImage(drawable,0,0);return _C10.CanvasToBlob(canvas,type,quality);};_C10.ImageDataToBlob=function ImageDataToBlob(imageData,type,quality){if(_C10.Supports.ImageBitmapOptions)return createImageBitmap(imageData,{"premultiplyAlpha":"none"}).then(function(imageBitmap){return _C10.DrawableToBlob(imageBitmap,type,quality);});else if(_C10.Supports.ImageBitmap)return createImageBitmap(imageData).then(function(imageBitmap){return _C10.DrawableToBlob(imageBitmap,type,quality);});else{var canvas=_C10.CreateCanvas(imageData.width,imageData.height);var ctx=canvas.getContext("2d");ctx.putImageData(imageData,0,0);return _C10.CanvasToBlob(canvas,type,quality);}};_C10.CopySet=function CopySet(dest,src){dest.clear();var _iteratorNormalCompletion23=true;var _didIteratorError23=false;var _iteratorError23=undefined;try{for(var _iterator23=src[Symbol.iterator](),_step23;!(_iteratorNormalCompletion23=(_step23=_iterator23.next()).done);_iteratorNormalCompletion23=true){var x=_step23.value;dest.add(x);}}catch(err){_didIteratorError23=true;_iteratorError23=err;}finally{try{if(!_iteratorNormalCompletion23&&_iterator23["return"]!=null){_iterator23["return"]();}}finally{if(_didIteratorError23){throw _iteratorError23;}}}};_C10.MapToObject=function MapToObject(map){var ret=Object.create(null);var _iteratorNormalCompletion24=true;var _didIteratorError24=false;var _iteratorError24=undefined;try{for(var _iterator24=map.entries()[Symbol.iterator](),_step24;!(_iteratorNormalCompletion24=(_step24=_iterator24.next()).done);_iteratorNormalCompletion24=true){var _step24$value=_slicedToArray(_step24.value,2),k=_step24$value[0],v=_step24$value[1];ret[k]=v;}}catch(err){_didIteratorError24=true;_iteratorError24=err;}finally{try{if(!_iteratorNormalCompletion24&&_iterator24["return"]!=null){_iterator24["return"]();}}finally{if(_didIteratorError24){throw _iteratorError24;}}}return ret;};_C10.ObjectToMap=function ObjectToMap(o,map){map.clear();for(var _i16=0,_Object$entries=Object.entries(o);_i16<_Object$entries.length;_i16++){var _Object$entries$_i=_slicedToArray(_Object$entries[_i16],2),k=_Object$entries$_i[0],v=_Object$entries$_i[1];map.set(k,v);}};_C10.ToSuperJSON=function ToSuperJSON(v){if(_typeof(v)==="object"&&v!==null)if(v instanceof Set)return{"_c3type_":"set","data":_toConsumableArray(v).map(function(o){return ToSuperJSON(o);})};else if(v instanceof Map)return{"_c3type_":"map","data":_toConsumableArray(v).map(function(pair){return[pair[0],ToSuperJSON(pair[1])];})};else{var ret=Object.create(null);for(var _i17=0,_Object$entries2=Object.entries(v);_i17<_Object$entries2.length;_i17++){var _Object$entries2$_i=_slicedToArray(_Object$entries2[_i17],2),key=_Object$entries2$_i[0],value=_Object$entries2$_i[1];ret[key]=ToSuperJSON(value);}return ret;}return v;};_C10.FromSuperJSON=function FromSuperJSON(v){if(_typeof(v)==="object"&v!==null)if(v["_c3type_"]==="set")return new Set(v["data"].map(function(o){return FromSuperJSON(o);}));else if(v["_c3type_"]==="map")return new Map(v["data"].map(function(pair){return[pair[0],FromSuperJSON(pair[1])];}));else{var ret=Object.create(null);for(var _i18=0,_Object$entries3=Object.entries(v);_i18<_Object$entries3.length;_i18++){var _Object$entries3$_i=_slicedToArray(_Object$entries3[_i18],2),key=_Object$entries3$_i[0],value=_Object$entries3$_i[1];ret[key]=FromSuperJSON(value);}return ret;}return v;};_C10.CSSToCamelCase=function(str){if(str.startsWith("--"))return str;var ret="";var isAfterHyphen=false;var _iteratorNormalCompletion25=true;var _didIteratorError25=false;var _iteratorError25=undefined;try{for(var _iterator25=str[Symbol.iterator](),_step25;!(_iteratorNormalCompletion25=(_step25=_iterator25.next()).done);_iteratorNormalCompletion25=true){var ch=_step25.value;if(ch==="-")isAfterHyphen=true;else if(isAfterHyphen){ret+=ch.toUpperCase();isAfterHyphen=false;}else ret+=ch;}}catch(err){_didIteratorError25=true;_iteratorError25=err;}finally{try{if(!_iteratorNormalCompletion25&&_iterator25["return"]!=null){_iterator25["return"]();}}finally{if(_didIteratorError25){throw _iteratorError25;}}}return ret;};_C10.IsIterator=function(o){return _typeof(o)==="object"&&typeof o.next==="function";};_C10.MakeFilledArray=function MakeFilledArray(len,data){var ret=[];if(typeof data==="function")for(var i=0;i<len;++i){ret.push(data());}else for(var _i19=0;_i19<len;++_i19){ret.push(data);}return ret;};}// ../lib/misc/color.js
{var padTwoDigits=function padTwoDigits(str){if(str.length===0)return"00";else if(str.length===1)return"0"+str;else return str;};var hueToRGB=function hueToRGB(p,q,t){if(t<0)t+=1;if(t>1)t-=1;if(t<1/6)return p+(q-p)*6*t;if(t<1/2)return q;if(t<2/3)return p+(q-p)*(2/3-t)*6;return p;};'use strict';var _C11=self.C3;var HSL_TEST=/([0-9.]+),([0-9.]+)%?,([0-9.]+)%?/i;var HSLA_TEST=/([0-9.]+),([0-9.]+)%?,([0-9.]+)%?,([0-9.])/i;_C11.Color=/*#__PURE__*/function(){function Color(r,g,b,a){_classCallCheck(this,Color);this._r=NaN;this._g=NaN;this._b=NaN;this._a=NaN;this._r=0;this._g=0;this._b=0;this._a=0;if(r instanceof _C11.Color)this.set(r);else this.setRgba(r||0,g||0,b||0,a||0);}_createClass(Color,[{key:"setRgb",value:function setRgb(r,g,b){this._r=+r;this._g=+g;this._b=+b;this.clamp();return this;}},{key:"setRgba",value:function setRgba(r,g,b,a){this._r=+r;this._g=+g;this._b=+b;this._a=+a;this.clamp();return this;}},{key:"set",value:function set(c){this._r=c._r;this._g=c._g;this._b=c._b;this._a=c._a;return this;}},{key:"copy",value:function copy(c){return this.set(c);}},{key:"add",value:function add(c){this._r+=c._r;this._g+=c._g;this._b+=c._b;this._a+=c._a;this.clamp();}},{key:"addRgb",value:function addRgb(r,g,b){var a=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;this._r+=+r;this._g+=+g;this._b+=+b;this._a+=+a;this.clamp();}},{key:"diff",value:function diff(c){this.setR(Math.max(this._r,c._r)-Math.min(this._r,c._r));this.setG(Math.max(this._g,c._g)-Math.min(this._g,c._g));this.setB(Math.max(this._b,c._b)-Math.min(this._b,c._b));this.setA(Math.max(this._a,c._a)-Math.min(this._a,c._a));this.clamp();}},{key:"copyRgb",value:function copyRgb(c){this._r=c._r;this._g=c._g;this._b=c._b;}},{key:"setR",value:function setR(r){this._r=_C11.clamp(+r,0,1);}},{key:"getR",value:function getR(){return this._r;}},{key:"setG",value:function setG(g){this._g=_C11.clamp(+g,0,1);}},{key:"getG",value:function getG(){return this._g;}},{key:"setB",value:function setB(b){this._b=_C11.clamp(+b,0,1);}},{key:"getB",value:function getB(){return this._b;}},{key:"setA",value:function setA(a){this._a=_C11.clamp(+a,0,1);}},{key:"getA",value:function getA(){return this._a;}},{key:"clone",value:function clone(){return _C11.New(_C11.Color,this._r,this._g,this._b,this._a);}},{key:"toArray",value:function toArray(){return[this._r,this._g,this._b,this._a];}},{key:"toTypedArray",value:function toTypedArray(){return new Float64Array(this.toArray());}},{key:"writeToTypedArray",value:function writeToTypedArray(ta,i){ta[i++]=this._r;ta[i++]=this._g;ta[i++]=this._b;ta[i]=this._a;}},{key:"writeRGBToTypedArray",value:function writeRGBToTypedArray(ta,i){ta[i++]=this._r;ta[i++]=this._g;ta[i]=this._b;}},{key:"equals",value:function equals(c){return this._r===c._r&&this._g===c._g&&this._b===c._b&&this._a===c._a;}},{key:"equalsIgnoringAlpha",value:function equalsIgnoringAlpha(c){return this._r===c._r&&this._g===c._g&&this._b===c._b;}},{key:"equalsRgb",value:function equalsRgb(r,g,b){return this._r===r&&this._g===g&&this._b===b;}},{key:"equalsRgba",value:function equalsRgba(r,g,b,a){return this._r===r&&this._g===g&&this._b===b&&this._a===a;}},{key:"equalsF32Array",value:function equalsF32Array(arr,offset){return arr[offset]===Math.fround(this._r)&&arr[offset+1]===Math.fround(this._g)&&arr[offset+2]===Math.fround(this._b)&&arr[offset+3]===Math.fround(this._a);}},{key:"equalsRGBF32Array",value:function equalsRGBF32Array(arr,offset){return arr[offset]===Math.fround(this._r)&&arr[offset+1]===Math.fround(this._g)&&arr[offset+2]===Math.fround(this._b);}},{key:"multiply",value:function multiply(c){this._r*=c._r;this._g*=c._g;this._b*=c._b;this._a*=c._a;}},{key:"multiplyAlpha",value:function multiplyAlpha(a){this._r*=a;this._g*=a;this._b*=a;this._a*=a;}},{key:"premultiply",value:function premultiply(){this._r*=this._a;this._g*=this._a;this._b*=this._a;return this;}},{key:"unpremultiply",value:function unpremultiply(){this._r/=this._a;this._g/=this._a;this._b/=this._a;return this;}},{key:"clamp",value:function clamp(){this._r=_C11.clamp(this._r,0,1);this._g=_C11.clamp(this._g,0,1);this._b=_C11.clamp(this._b,0,1);this._a=_C11.clamp(this._a,0,1);return this;}},{key:"setFromRgbValue",value:function setFromRgbValue(rgb){this._r=_C11.GetRValue(rgb);this._g=_C11.GetGValue(rgb);this._b=_C11.GetBValue(rgb);this._a=_C11.GetAValue(rgb);}},{key:"getCssRgb",value:function getCssRgb(_r,_g,_b){var r=_C11.IsFiniteNumber(_r)?_r:this.getR();var g=_C11.IsFiniteNumber(_g)?_g:this.getG();var b=_C11.IsFiniteNumber(_b)?_b:this.getB();return"rgb(".concat(r*100,"%, ").concat(g*100,"%, ").concat(b*100,"%)");}},{key:"getCssRgba",value:function getCssRgba(_r,_g,_b,_a){var r=_C11.IsFiniteNumber(_r)?_r:this.getR();var g=_C11.IsFiniteNumber(_g)?_g:this.getG();var b=_C11.IsFiniteNumber(_b)?_b:this.getB();var a=_C11.IsFiniteNumber(_a)?_a:this.getA();return"rgba(".concat(r*100,"%, ").concat(g*100,"%, ").concat(b*100,"%, ").concat(a,")");}},{key:"toHexString",value:function toHexString(){var rh=Math.round(this.getR()*255);var gh=Math.round(this.getG()*255);var bh=Math.round(this.getB()*255);return"#"+padTwoDigits(rh.toString(16))+padTwoDigits(gh.toString(16))+padTwoDigits(bh.toString(16));}},{key:"parseHexString",value:function parseHexString(str){if(typeof str!=="string")return false;str=str.trim();if(str.charAt(0)==="#")str=str.substr(1);var rv;var gv;var bv;if(str.length===3){rv=parseInt(str[0],16)/15;gv=parseInt(str[1],16)/15;bv=parseInt(str[2],16)/15;}else if(str.length===6){rv=parseInt(str.substr(0,2),16)/255;gv=parseInt(str.substr(2,2),16)/255;bv=parseInt(str.substr(4,2),16)/255;}else return false;if(isFinite(rv))this.setR(rv);if(isFinite(gv))this.setG(gv);if(isFinite(bv))this.setB(bv);this.setA(1);return true;}},{key:"toCommaSeparatedRgb",value:function toCommaSeparatedRgb(){var rv=Math.round(this.getR()*255);var gv=Math.round(this.getG()*255);var bv=Math.round(this.getB()*255);return"".concat(rv,", ").concat(gv,", ").concat(bv);}},{key:"toRgbArray",value:function toRgbArray(){var rv=Math.round(this.getR()*255);var gv=Math.round(this.getG()*255);var bv=Math.round(this.getB()*255);return[rv,gv,bv];}},{key:"parseCommaSeparatedRgb",value:function parseCommaSeparatedRgb(str){if(typeof str!=="string")return false;str=str.replace(/^rgb\(|\)|%/,"");var arr=str.split(",");if(arr.length<3)return false;var rv=parseInt(arr[0].trim(),10)/255;var gv=parseInt(arr[1].trim(),10)/255;var bv=parseInt(arr[2].trim(),10)/255;if(isFinite(rv))this.setR(rv);if(isFinite(gv))this.setG(gv);if(isFinite(bv))this.setB(bv);this.setA(1);return true;}},{key:"parseCommaSeparatedPercentageRgb",value:function parseCommaSeparatedPercentageRgb(str){if(typeof str!=="string")return false;str=str.replace(/^rgb\(|\)|%/,"");var arr=str.split(",");if(arr.length<3)return false;var rv=parseInt(arr[0].trim(),10)/100;var gv=parseInt(arr[1].trim(),10)/100;var bv=parseInt(arr[2].trim(),10)/100;if(isFinite(rv))this.setR(rv);if(isFinite(gv))this.setG(gv);if(isFinite(bv))this.setB(bv);this.setA(1);return true;}},{key:"parseCommaSeparatedRgba",value:function parseCommaSeparatedRgba(str){if(typeof str!=="string")return false;str=str.replace(/^rgba\(|\)|%/,"");var arr=str.split(",");if(arr.length<4)return false;var rv=parseInt(arr[0].trim(),10)/255;var gv=parseInt(arr[1].trim(),10)/255;var bv=parseInt(arr[2].trim(),10)/255;var av=parseFloat(arr[3].trim());if(isFinite(rv))this.setR(rv);if(isFinite(gv))this.setG(gv);if(isFinite(bv))this.setB(bv);if(isFinite(av))this.setA(av);return true;}},{key:"parseCommaSeparatedPercentageRgba",value:function parseCommaSeparatedPercentageRgba(str){if(typeof str!=="string")return false;str=str.replace(/^rgba\(|\)|%/,"");var arr=str.split(",");if(arr.length<4)return false;var rv=parseInt(arr[0].trim(),10)/100;var gv=parseInt(arr[1].trim(),10)/100;var bv=parseInt(arr[2].trim(),10)/100;var av=parseFloat(arr[3].trim());if(isFinite(rv))this.setR(rv);if(isFinite(gv))this.setG(gv);if(isFinite(bv))this.setB(bv);if(isFinite(av))this.setA(av);return true;}},{key:"parseString",value:function parseString(str){if(typeof str!=="string")return false;str=str.replace(/\s+/,"");if(str.includes(",")){if(str.startsWith("rgb(")){if(str.includes("%"))return this.parseCommaSeparatedPercentageRgb(str);else return this.parseCommaSeparatedRgb(str);}else if(str.startsWith("rgba(")){if(str.includes("%"))return this.parseCommaSeparatedPercentageRgba(str);else return this.parseCommaSeparatedRgba(str);}else if(str.startsWith("hsl(")||str.startsWith("hsla("))return this.parseHSLString(str);else{var components=str.split(",");if(str.includes("%")){if(components.length===3)return this.parseCommaSeparatedPercentageRgb(str);else if(components.length===4)return this.parseCommaSeparatedPercentageRgba(str);return false;}else{if(components.length===3)return this.parseCommaSeparatedRgb(str);else if(components.length===4)return this.parseCommaSeparatedRgba(str);return false;}}}else return this.parseHexString(str);}},{key:"toJSON",value:function toJSON(){return[this._r,this._g,this._b,this._a];}},{key:"setFromHSLA",value:function setFromHSLA(h,s,l,a){var r;var g;var b;h%=360;s=_C11.clamp(s,0,100);l=_C11.clamp(l,0,100);a=_C11.clamp(a,0,1);h/=360;s/=100;l/=100;if(s===0)r=g=b=l;else{var q=l<.5?l*(1+s):l+s-l*s;var p=2*l-q;r=hueToRGB(p,q,h+1/3);g=hueToRGB(p,q,h);b=hueToRGB(p,q,h-1/3);}this.setR(r);this.setG(g);this.setB(b);this.setA(a);return this;}},{key:"parseHSLString",value:function parseHSLString(str){var cleanString=str.replace(/ |hsl|hsla|\(|\)|;/gi,"");var hsl=HSL_TEST.exec(cleanString);var hsla=HSLA_TEST.exec(cleanString);if(hsl&&hsl.length===4){this.setFromHSLA(+hsl[1],+hsl[2],+hsl[3],1);return true;}else if(hsla&&hsla.length===5){this.setFromHSLA(+hsl[1],+hsl[2],+hsl[3],+hsl[4]);return true;}return false;}},{key:"toHSLAString",value:function toHSLAString(){var r=this._r;var g=this._g;var b=this._b;var a=this._a;var h=_C11.Color.GetHue(r,g,b);var s=_C11.Color.GetSaturation(r,g,b);var l=_C11.Color.GetLuminosity(r,g,b);return"hsla(".concat(h,", ").concat(s,"%, ").concat(l,"%, ").concat(a,")");}},{key:"toHSLAArray",value:function toHSLAArray(){var r=this._r;var g=this._g;var b=this._b;return[_C11.Color.GetHue(r,g,b),_C11.Color.GetSaturation(r,g,b),_C11.Color.GetLuminosity(r,g,b),this._a];}},{key:"setFromJSON",value:function setFromJSON(arr){if(!Array.isArray(arr))return;if(arr.length<3)return;this._r=arr[0];this._g=arr[1];this._b=arr[2];if(arr.length>=4)this._a=arr[3];else this._a=1;}},{key:"setAtIndex",value:function setAtIndex(i,v){switch(i){case 0:this.setR(v);break;case 1:this.setG(v);break;case 2:this.setB(v);break;case 3:this.setA(v);break;default:throw new RangeError("invalid color index");}}},{key:"getAtIndex",value:function getAtIndex(i){switch(i){case 0:return this.getR();case 1:return this.getG();case 2:return this.getB();case 3:return this.getA();default:throw new RangeError("invalid color index");}}},{key:"r",set:function set(r){this.setR(r);},get:function get(){return this.getR();}},{key:"g",set:function set(g){this.setG(g);},get:function get(){return this.getG();}},{key:"b",set:function set(b){this.setB(b);},get:function get(){return this.getB();}},{key:"a",set:function set(a){this.setA(a);},get:function get(){return this.getA();}}],[{key:"Equals",value:function Equals(color_or_json_1,color_or_json_2){var c1;var c2;if(Array.isArray(color_or_json_1)){c1=new _C11.Color();c1.setFromJSON(color_or_json_1);}else if(color_or_json_1 instanceof _C11.Color)c1=color_or_json_1;else throw new Error("unexpected type");if(Array.isArray(color_or_json_2)){c2=new _C11.Color();c2.setFromJSON(color_or_json_2);}else if(color_or_json_2 instanceof _C11.Color)c2=color_or_json_2;else throw new Error("unexpected type");return c1.equals(c2);}},{key:"DiffChannel",value:function DiffChannel(channel1,channel2){return _C11.clamp(Math.max(channel1,channel2)-Math.min(channel1,channel2),0,1);}},{key:"Diff",value:function Diff(c1,c2){var ret=new _C11.Color();ret.setR(Math.max(c1._r,c2._r)-Math.min(c1._r,c2._r));ret.setG(Math.max(c1._g,c2._g)-Math.min(c1._g,c2._g));ret.setB(Math.max(c1._b,c2._b)-Math.min(c1._b,c2._b));ret.setA(Math.max(c1._a,c2._a)-Math.min(c1._a,c2._a));return ret;}},{key:"DiffNoAlpha",value:function DiffNoAlpha(c1,c2){var ret=new _C11.Color(0,0,0,1);ret.setR(Math.max(c1._r,c2._r)-Math.min(c1._r,c2._r));ret.setG(Math.max(c1._g,c2._g)-Math.min(c1._g,c2._g));ret.setB(Math.max(c1._b,c2._b)-Math.min(c1._b,c2._b));return ret;}},{key:"GetHue",value:function GetHue(r,g,b){var max=Math.max(r,g,b);var min=Math.min(r,g,b);if(max===min)return 0;var h=0;switch(max){case r:h=(g-b)/(max-min)+(g<b?6:0);break;case g:h=(b-r)/(max-min)+2;break;case b:h=(r-g)/(max-min)+4;break;}return Math.round(h/6*360);}},{key:"GetSaturation",value:function GetSaturation(r,g,b){var max=Math.max(r,g,b);var min=Math.min(r,g,b);if(max===min)return 0;var l=(max+min)/2;var d=max-min;var s=l>.5?d/(2-max-min):d/(max+min);return Math.round(s*100);}},{key:"GetLuminosity",value:function GetLuminosity(r,g,b){var max=Math.max(r,g,b);var min=Math.min(r,g,b);var l=(max+min)/2;if(!max)return 0;return Math.round(l*100);}}]);return Color;}();_C11.Color.White=Object.freeze(_C11.New(_C11.Color,1,1,1,1));_C11.Color.Black=Object.freeze(_C11.New(_C11.Color,0,0,0,1));_C11.Color.TransparentBlack=Object.freeze(_C11.New(_C11.Color,0,0,0,0));}// ../lib/misc/vector2.js
{'use strict';var _C12=self.C3;_C12.Vector2=/*#__PURE__*/function(){function Vector2(x,y){_classCallCheck(this,Vector2);this._x=0;this._y=0;if(x instanceof _C12.Vector2)this.copy(x);else this.set(x||0,y||0);}_createClass(Vector2,[{key:"set",value:function set(x,y){this._x=+x;this._y=+y;}},{key:"copy",value:function copy(v){this._x=v._x;this._y=v._y;}},{key:"equals",value:function equals(v){return this._x===v._x&&this._y===v._y;}},{key:"equalsValues",value:function equalsValues(x,y){return this._x===x&&this._y===y;}},{key:"equalsF32Array",value:function equalsF32Array(arr,offset){return arr[offset]===Math.fround(this._x)&&arr[offset+1]===Math.fround(this._y);}},{key:"setX",value:function setX(x){this._x=+x;}},{key:"getX",value:function getX(){return this._x;}},{key:"setY",value:function setY(y){this._y=+y;}},{key:"getY",value:function getY(){return this._y;}},{key:"toArray",value:function toArray(){return[this._x,this._y];}},{key:"toTypedArray",value:function toTypedArray(){return new Float64Array(this.toArray());}},{key:"writeToTypedArray",value:function writeToTypedArray(ta,i){ta[i++]=this._x;ta[i]=this._y;}},{key:"offset",value:function offset(x,y){this._x+=+x;this._y+=+y;}},{key:"scale",value:function scale(x,y){this._x*=x;this._y*=y;}},{key:"divide",value:function divide(x,y){this._x/=x;this._y/=y;}},{key:"round",value:function round(){this._x=Math.round(this._x);this._y=Math.round(this._y);}},{key:"floor",value:function floor(){this._x=Math.floor(this._x);this._y=Math.floor(this._y);}},{key:"ceil",value:function ceil(){this._x=Math.ceil(this._x);this._y=Math.ceil(this._y);}},{key:"angle",value:function angle(){return _C12.angleTo(0,0,this._x,this._y);}},{key:"lengthSquared",value:function lengthSquared(){return this._x*this._x+this._y*this._y;}},{key:"length",value:function length(){return Math.hypot(this._x,this._y);}},{key:"rotatePrecalc",value:function rotatePrecalc(sin_a,cos_a){var temp=this._x*cos_a-this._y*sin_a;this._y=this._y*cos_a+this._x*sin_a;this._x=temp;}},{key:"rotate",value:function rotate(a){if(a===0)return;this.rotatePrecalc(Math.sin(a),Math.cos(a));}},{key:"rotateAbout",value:function rotateAbout(a,x,y){if(a===0||x===this._x&&y===this._y)return;this._x-=x;this._y-=y;this.rotatePrecalc(Math.sin(a),Math.cos(a));this._x+=+x;this._y+=+y;}},{key:"move",value:function move(a,dist){if(dist===0)return;this._x+=Math.cos(a)*dist;this._y+=Math.sin(a)*dist;}},{key:"normalize",value:function normalize(){var m=this.length();if(m!==0&&m!==1){this._x/=m;this._y/=m;}}},{key:"clamp",value:function clamp(lower,upper){this._x=_C12.clamp(this._x,lower,upper);this._y=_C12.clamp(this._y,lower,upper);}},{key:"dot",value:function dot(other){return this._x*other._x+this._y*other._y;}},{key:"reverse",value:function reverse(){this._x=-this._x;this._y=-this._y;}},{key:"perp",value:function perp(){var x=this._x;this._x=this._y;this._y=-x;return this;}}]);return Vector2;}();}// ../lib/misc/rect.js
{'use strict';var _C13=self.C3;_C13.Rect=/*#__PURE__*/function(){function Rect(left,top,right,bottom){_classCallCheck(this,Rect);this._left=NaN;this._top=NaN;this._right=NaN;this._bottom=NaN;this._left=0;this._top=0;this._right=0;this._bottom=0;if(left instanceof _C13.Rect)this.copy(left);else this.set(left||0,top||0,right||0,bottom||0);}_createClass(Rect,[{key:"set",value:function set(left,top,right,bottom){this._left=+left;this._top=+top;this._right=+right;this._bottom=+bottom;}},{key:"setWH",value:function setWH(left,top,width,height){left=+left;top=+top;this._left=left;this._top=top;this._right=left+ +width;this._bottom=top+ +height;}},{key:"copy",value:function copy(rect){this._left=+rect._left;this._top=+rect._top;this._right=+rect._right;this._bottom=+rect._bottom;}},{key:"clone",value:function clone(){return new _C13.Rect(this._left,this._top,this._right,this._bottom);}},{key:"equals",value:function equals(rect){return this._left===rect._left&&this._top===rect._top&&this._right===rect._right&&this._bottom===rect._bottom;}},{key:"equalsWH",value:function equalsWH(x,y,w,h){return this._left===x&&this._top===y&&this.width()===w&&this.height()===h;}},{key:"equalsF32Array",value:function equalsF32Array(arr,offset){return arr[offset]===Math.fround(this._left)&&arr[offset+1]===Math.fround(this._top)&&arr[offset+2]===Math.fround(this._right)&&arr[offset+3]===Math.fround(this._bottom);}},{key:"setLeft",value:function setLeft(l){this._left=+l;}},{key:"getLeft",value:function getLeft(){return this._left;}},{key:"setTop",value:function setTop(t){this._top=+t;}},{key:"getTop",value:function getTop(){return this._top;}},{key:"setRight",value:function setRight(r){this._right=+r;}},{key:"getRight",value:function getRight(){return this._right;}},{key:"setBottom",value:function setBottom(b){this._bottom=+b;}},{key:"getBottom",value:function getBottom(){return this._bottom;}},{key:"toArray",value:function toArray(){return[this._left,this._top,this._right,this._bottom];}},{key:"toTypedArray",value:function toTypedArray(){return new Float64Array(this.toArray());}},{key:"toDOMRect",value:function toDOMRect(){return new DOMRect(this._left,this._top,this.width(),this.height());}},{key:"writeToTypedArray",value:function writeToTypedArray(ta,i){ta[i++]=this._left;ta[i++]=this._top;ta[i++]=this._right;ta[i]=this._bottom;}},{key:"writeAsQuadToTypedArray",value:function writeAsQuadToTypedArray(ta,i){ta[i++]=this._left;ta[i++]=this._top;ta[i++]=this._right;ta[i++]=this._top;ta[i++]=this._right;ta[i++]=this._bottom;ta[i++]=this._left;ta[i]=this._bottom;}},{key:"writeAsQuadToTypedArray3D",value:function writeAsQuadToTypedArray3D(ta,i,z){ta[i++]=this._left;ta[i++]=this._top;ta[i++]=z;ta[i++]=this._right;ta[i++]=this._top;ta[i++]=z;ta[i++]=this._right;ta[i++]=this._bottom;ta[i++]=z;ta[i++]=this._left;ta[i++]=this._bottom;ta[i]=z;}},{key:"width",value:function width(){return this._right-this._left;}},{key:"height",value:function height(){return this._bottom-this._top;}},{key:"midX",value:function midX(){return(this._left+this._right)/2;}},{key:"midY",value:function midY(){return(this._top+this._bottom)/2;}},{key:"offset",value:function offset(x,y){x=+x;y=+y;this._left+=x;this._top+=y;this._right+=x;this._bottom+=y;}},{key:"offsetLeft",value:function offsetLeft(x){this._left+=+x;}},{key:"offsetTop",value:function offsetTop(y){this._top+=+y;}},{key:"offsetRight",value:function offsetRight(x){this._right+=+x;}},{key:"offsetBottom",value:function offsetBottom(y){this._bottom+=+y;}},{key:"toSquare",value:function toSquare(axis){if(axis!=="x")throw new Error("invalid axis, only 'x' supported");if(this._top<this._bottom){if(this._left<this._right)this._bottom=this._top+this.width();else this._bottom=this._top-this.width();}else if(this._left<this._right)this._bottom=this._top-this.width();else this._bottom=this._top+this.width();}},{key:"inflate",value:function inflate(x,y){x=+x;y=+y;this._left-=x;this._top-=y;this._right+=x;this._bottom+=y;}},{key:"deflate",value:function deflate(x,y){x=+x;y=+y;this._left+=x;this._top+=y;this._right-=x;this._bottom-=y;}},{key:"multiply",value:function multiply(x,y){this._left*=x;this._top*=y;this._right*=x;this._bottom*=y;}},{key:"divide",value:function divide(x,y){this._left/=x;this._top/=y;this._right/=x;this._bottom/=y;}},{key:"mirrorAround",value:function mirrorAround(origin){this._left=+origin-this._left;this._right=+origin-this._right;}},{key:"flipAround",value:function flipAround(origin){this._top=+origin-this._top;this._bottom=+origin-this._bottom;}},{key:"rotate90DegreesAround",value:function rotate90DegreesAround(normalizedX,normalizedY){var w=this.width();var h=this.height();var cx=this.getLeft()+w*normalizedX;var cy=this.getTop()+h*normalizedY;this.setWH(cx-h*normalizedY,cy-w*normalizedX,h,w);}},{key:"swapLeftRight",value:function swapLeftRight(){var temp=this._left;this._left=this._right;this._right=temp;}},{key:"swapTopBottom",value:function swapTopBottom(){var temp=this._top;this._top=this._bottom;this._bottom=temp;}},{key:"shuntY",value:function shuntY(h){var top=this._top;this._top=+h-this._bottom;this._bottom=+h-top;}},{key:"round",value:function round(){this._left=Math.round(this._left);this._top=Math.round(this._top);this._right=Math.round(this._right);this._bottom=Math.round(this._bottom);}},{key:"roundInner",value:function roundInner(){this._left=Math.ceil(this._left);this._top=Math.ceil(this._top);this._right=Math.floor(this._right);this._bottom=Math.floor(this._bottom);}},{key:"roundOuter",value:function roundOuter(){this._left=Math.floor(this._left);this._top=Math.floor(this._top);this._right=Math.ceil(this._right);this._bottom=Math.ceil(this._bottom);}},{key:"floor",value:function floor(){this._left=Math.floor(this._left);this._top=Math.floor(this._top);this._right=Math.floor(this._right);this._bottom=Math.floor(this._bottom);}},{key:"ceil",value:function ceil(){this._left=Math.ceil(this._left);this._top=Math.ceil(this._top);this._right=Math.ceil(this._right);this._bottom=Math.ceil(this._bottom);}},{key:"clamp",value:function clamp(l,t,r,b){this._left=Math.max(this._left,+l);this._top=Math.max(this._top,+t);this._right=Math.min(this._right,+r);this._bottom=Math.min(this._bottom,+b);}},{key:"clampBoth",value:function clampBoth(l,t,r,b){l=+l;t=+t;r=+r;b=+b;this._left=_C13.clamp(this._left,l,r);this._top=_C13.clamp(this._top,t,b);this._right=_C13.clamp(this._right,l,r);this._bottom=_C13.clamp(this._bottom,t,b);}},{key:"normalize",value:function normalize(){if(this._left>this._right)this.swapLeftRight();if(this._top>this._bottom)this.swapTopBottom();}},{key:"intersectsRect",value:function intersectsRect(rect){return!(rect._right<this._left||rect._bottom<this._top||rect._left>this._right||rect._top>this._bottom);}},{key:"intersectsRectOffset",value:function intersectsRectOffset(rect,x,y){return!(rect._right+x<this._left||rect._bottom+y<this._top||rect._left+x>this._right||rect._top+y>this._bottom);}},{key:"containsPoint",value:function containsPoint(x,y){return x>=this._left&&x<=this._right&&y>=this._top&&y<=this._bottom;}},{key:"containsRect",value:function containsRect(rect){return rect._left>=this._left&&rect._top>=this._top&&rect._right<=this._right&&rect._bottom<=this._bottom;}},{key:"expandToContain",value:function expandToContain(rect){if(rect._left<this._left)this._left=+rect._left;if(rect._top<this._top)this._top=+rect._top;if(rect._right>this._right)this._right=+rect._right;if(rect._bottom>this._bottom)this._bottom=+rect._bottom;}},{key:"lerpInto",value:function lerpInto(rect){this._left=_C13.lerp(rect._left,rect._right,this._left);this._top=_C13.lerp(rect._top,rect._bottom,this._top);this._right=_C13.lerp(rect._left,rect._right,this._right);this._bottom=_C13.lerp(rect._top,rect._bottom,this._bottom);}}],[{key:"Merge",value:function Merge(first,second){var ret=new _C13.Rect();ret.setLeft(Math.min(first._left,second._left));ret.setTop(Math.min(first._top,second._top));ret.setRight(Math.max(first._right,second._right));ret.setBottom(Math.max(first._bottom,second._bottom));return ret;}},{key:"FromObject",value:function FromObject(o){return new _C13.Rect(o.left,o.top,o.right,o.bottom);}}]);return Rect;}();}// ../lib/misc/quad.js
{'use strict';var _C14=self.C3;_C14.Quad=/*#__PURE__*/function(){function Quad(tlx,tly,trx,try_,brx,bry,blx,bly){_classCallCheck(this,Quad);this._tlx=NaN;this._tly=NaN;this._trx=NaN;this._try=NaN;this._brx=NaN;this._bry=NaN;this._blx=NaN;this._bly=NaN;this._tlx=0;this._tly=0;this._trx=0;this._try=0;this._brx=0;this._bry=0;this._blx=0;this._bly=0;if(tlx instanceof _C14.Quad)this.copy(tlx);else this.set(tlx||0,tly||0,trx||0,try_||0,brx||0,bry||0,blx||0,bly||0);}_createClass(Quad,[{key:"set",value:function set(tlx,tly,trx,try_,brx,bry,blx,bly){this._tlx=+tlx;this._tly=+tly;this._trx=+trx;this._try=+try_;this._brx=+brx;this._bry=+bry;this._blx=+blx;this._bly=+bly;}},{key:"setRect",value:function setRect(left,top,right,bottom){this.set(left,top,right,top,right,bottom,left,bottom);}},{key:"copy",value:function copy(q){this._tlx=q._tlx;this._tly=q._tly;this._trx=q._trx;this._try=q._try;this._brx=q._brx;this._bry=q._bry;this._blx=q._blx;this._bly=q._bly;}},{key:"equals",value:function equals(q){return this._tlx===q._tlx&&this._tly===q._tly&&this._trx===q._trx&&this._try===q._try&&this._brx===q._brx&&this._bry===q._bry&&this._blx===q._blx&&this._bly===q._bly;}},{key:"setTlx",value:function setTlx(v){this._tlx=+v;}},{key:"getTlx",value:function getTlx(){return this._tlx;}},{key:"setTly",value:function setTly(v){this._tly=+v;}},{key:"getTly",value:function getTly(){return this._tly;}},{key:"setTrx",value:function setTrx(v){this._trx=+v;}},{key:"getTrx",value:function getTrx(){return this._trx;}},{key:"setTry",value:function setTry(v){this._try=+v;}},{key:"getTry",value:function getTry(){return this._try;}},{key:"setBrx",value:function setBrx(v){this._brx=+v;}},{key:"getBrx",value:function getBrx(){return this._brx;}},{key:"setBry",value:function setBry(v){this._bry=+v;}},{key:"getBry",value:function getBry(){return this._bry;}},{key:"setBlx",value:function setBlx(v){this._blx=+v;}},{key:"getBlx",value:function getBlx(){return this._blx;}},{key:"setBly",value:function setBly(v){this._bly=+v;}},{key:"getBly",value:function getBly(){return this._bly;}},{key:"toDOMQuad",value:function toDOMQuad(){return new DOMQuad(new DOMPoint(this._tlx,this._tly),new DOMPoint(this._trx,this._try),new DOMPoint(this._brx,this._bry),new DOMPoint(this._blx,this._bly));}},{key:"toArray",value:function toArray(){return[this._tlx,this._tly,this._trx,this._try,this._brx,this._bry,this._blx,this._bly];}},{key:"toTypedArray",value:function toTypedArray(){return new Float64Array(this.toArray());}},{key:"writeToTypedArray",value:function writeToTypedArray(ta,i){ta[i++]=this._tlx;ta[i++]=this._tly;ta[i++]=this._trx;ta[i++]=this._try;ta[i++]=this._brx;ta[i++]=this._bry;ta[i++]=this._blx;ta[i]=this._bly;}},{key:"writeToTypedArray3D",value:function writeToTypedArray3D(ta,i,z){ta[i++]=this._tlx;ta[i++]=this._tly;ta[i++]=z;ta[i++]=this._trx;ta[i++]=this._try;ta[i++]=z;ta[i++]=this._brx;ta[i++]=this._bry;ta[i++]=z;ta[i++]=this._blx;ta[i++]=this._bly;ta[i]=z;}},{key:"offset",value:function offset(x,y){x=+x;y=+y;this._tlx+=x;this._tly+=y;this._trx+=x;this._try+=y;this._brx+=x;this._bry+=y;this._blx+=x;this._bly+=y;}},{key:"round",value:function round(){this._tlx=Math.round(this._tlx);this._tly=Math.round(this._tly);this._trx=Math.round(this._trx);this._try=Math.round(this._try);this._brx=Math.round(this._brx);this._bry=Math.round(this._bry);this._blx=Math.round(this._blx);this._bly=Math.round(this._bly);}},{key:"floor",value:function floor(){this._tlx=Math.floor(this._tlx);this._tly=Math.floor(this._tly);this._trx=Math.floor(this._trx);this._try=Math.floor(this._try);this._brx=Math.floor(this._brx);this._bry=Math.floor(this._bry);this._blx=Math.floor(this._blx);this._bly=Math.floor(this._bly);}},{key:"ceil",value:function ceil(){this._tlx=Math.ceil(this._tlx);this._tly=Math.ceil(this._tly);this._trx=Math.ceil(this._trx);this._try=Math.ceil(this._try);this._brx=Math.ceil(this._brx);this._bry=Math.ceil(this._bry);this._blx=Math.ceil(this._blx);this._bly=Math.ceil(this._bly);}},{key:"setFromRect",value:function setFromRect(rect){this._tlx=rect._left;this._tly=rect._top;this._trx=rect._right;this._try=rect._top;this._brx=rect._right;this._bry=rect._bottom;this._blx=rect._left;this._bly=rect._bottom;}},{key:"setFromRotatedRect",value:function setFromRotatedRect(rect,a){if(a===0)this.setFromRect(rect);else this.setFromRotatedRectPrecalc(rect,Math.sin(a),Math.cos(a));}},{key:"setFromRotatedRectPrecalc",value:function setFromRotatedRectPrecalc(rect,sin_a,cos_a){var left_sin_a=rect._left*sin_a;var top_sin_a=rect._top*sin_a;var right_sin_a=rect._right*sin_a;var bottom_sin_a=rect._bottom*sin_a;var left_cos_a=rect._left*cos_a;var top_cos_a=rect._top*cos_a;var right_cos_a=rect._right*cos_a;var bottom_cos_a=rect._bottom*cos_a;this._tlx=left_cos_a-top_sin_a;this._tly=top_cos_a+left_sin_a;this._trx=right_cos_a-top_sin_a;this._try=top_cos_a+right_sin_a;this._brx=right_cos_a-bottom_sin_a;this._bry=bottom_cos_a+right_sin_a;this._blx=left_cos_a-bottom_sin_a;this._bly=bottom_cos_a+left_sin_a;}},{key:"getBoundingBox",value:function getBoundingBox(rect){rect.set(Math.min(this._tlx,this._trx,this._brx,this._blx),Math.min(this._tly,this._try,this._bry,this._bly),Math.max(this._tlx,this._trx,this._brx,this._blx),Math.max(this._tly,this._try,this._bry,this._bly));}},{key:"containsPoint",value:function containsPoint(x,y){var v0x=this._trx-this._tlx;var v0y=this._try-this._tly;var v1x=this._brx-this._tlx;var v1y=this._bry-this._tly;var v2x=x-this._tlx;var v2y=y-this._tly;var dot00=v0x*v0x+v0y*v0y;var dot01=v0x*v1x+v0y*v1y;var dot02=v0x*v2x+v0y*v2y;var dot11=v1x*v1x+v1y*v1y;var dot12=v1x*v2x+v1y*v2y;var invDenom=1/(dot00*dot11-dot01*dot01);var u=(dot11*dot02-dot01*dot12)*invDenom;var v=(dot00*dot12-dot01*dot02)*invDenom;if(u>=0&&v>0&&u+v<1)return true;v0x=this._blx-this._tlx;v0y=this._bly-this._tly;dot00=v0x*v0x+v0y*v0y;dot01=v0x*v1x+v0y*v1y;dot02=v0x*v2x+v0y*v2y;invDenom=1/(dot00*dot11-dot01*dot01);u=(dot11*dot02-dot01*dot12)*invDenom;v=(dot00*dot12-dot01*dot02)*invDenom;return u>=0&&v>0&&u+v<1;}},{key:"midX",value:function midX(){return(this._tlx+this._trx+this._brx+this._blx)/4;}},{key:"midY",value:function midY(){return(this._tly+this._try+this._bry+this._bly)/4;}},{key:"intersectsSegment",value:function intersectsSegment(x1,y1,x2,y2){if(this.containsPoint(x1,y1)||this.containsPoint(x2,y2))return true;return _C14.segmentIntersectsQuad(x1,y1,x2,y2,this);}},{key:"intersectsQuad",value:function intersectsQuad(rhs){var midX=rhs.midX();var midY=rhs.midY();if(this.containsPoint(midX,midY))return true;midX=this.midX();midY=this.midY();if(rhs.containsPoint(midX,midY))return true;var tlx=this._tlx,tly=this._tly,trx=this._trx,try_=this._try,brx=this._brx,bry=this._bry,blx=this._blx,bly=this._bly;return _C14.segmentIntersectsQuad(tlx,tly,trx,try_,rhs)||_C14.segmentIntersectsQuad(trx,try_,brx,bry,rhs)||_C14.segmentIntersectsQuad(brx,bry,blx,bly,rhs)||_C14.segmentIntersectsQuad(blx,bly,tlx,tly,rhs);}},{key:"rotatePointsAnticlockwise",value:function rotatePointsAnticlockwise(){var tlx=this._tlx;var tly=this._tly;this._tlx=this._trx;this._tly=this._try;this._trx=this._brx;this._try=this._bry;this._brx=this._blx;this._bry=this._bly;this._blx=tlx;this._bly=tly;}},{key:"mirror",value:function mirror(){this._swap(0,2);this._swap(1,3);this._swap(6,4);this._swap(7,5);}},{key:"flip",value:function flip(){this._swap(0,6);this._swap(1,7);this._swap(2,4);this._swap(3,5);}},{key:"diag",value:function diag(){this._swap(2,6);this._swap(3,7);}},{key:"_swap",value:function _swap(i,j){var tmp=this._getAtIndex(i);this._setAtIndex(i,this._getAtIndex(j));this._setAtIndex(j,tmp);}},{key:"_getAtIndex",value:function _getAtIndex(i){switch(i){case 0:return this._tlx;case 1:return this._tly;case 2:return this._trx;case 3:return this._try;case 4:return this._brx;case 5:return this._bry;case 6:return this._blx;case 7:return this._bly;default:throw new RangeError("invalid quad point index");}}},{key:"_setAtIndex",value:function _setAtIndex(i,v){v=+v;switch(i){case 0:this._tlx=v;break;case 1:this._tly=v;break;case 2:this._trx=v;break;case 3:this._try=v;break;case 4:this._brx=v;break;case 5:this._bry=v;break;case 6:this._blx=v;break;case 7:this._bly=v;break;default:throw new RangeError("invalid quad point index");}}}]);return Quad;}();}// lib/misc/collisionPoly.js
{'use strict';var _C15=self.C3;var assert=self.assert;var DEFAULT_POLY_POINTS=[0,0,1,0,1,1,0,1];var tempQuad=_C15.New(_C15.Quad);_C15.CollisionPoly=/*#__PURE__*/function(_C15$DefendedBase){_inherits(CollisionPoly,_C15$DefendedBase);function CollisionPoly(pointsArr){var _this;var enabled=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;_classCallCheck(this,CollisionPoly);_this=_possibleConstructorReturn(this,_getPrototypeOf(CollisionPoly).call(this));if(!pointsArr)pointsArr=DEFAULT_POLY_POINTS;_this._ptsArr=Float64Array.from(pointsArr);_this._bbox=new _C15.Rect();_this._isBboxChanged=true;_this._enabled=enabled;return _this;}_createClass(CollisionPoly,[{key:"Release",value:function Release(){}},{key:"pointsArr",value:function pointsArr(){return this._ptsArr;}},{key:"pointCount",value:function pointCount(){return this._ptsArr.length/2;}},{key:"setPoints",value:function setPoints(pointsArr){if(this._ptsArr.length===pointsArr.length)this._ptsArr.set(pointsArr);else this._ptsArr=Float64Array.from(pointsArr);this._isBboxChanged=true;}},{key:"setDefaultPoints",value:function setDefaultPoints(){this.setPoints(DEFAULT_POLY_POINTS);}},{key:"copy",value:function copy(poly){this.setPoints(poly._ptsArr);}},{key:"setBboxChanged",value:function setBboxChanged(){this._isBboxChanged=true;}},{key:"_updateBbox",value:function _updateBbox(){if(!this._isBboxChanged)return;var ptsArr=this._ptsArr;var left=ptsArr[0];var top=ptsArr[1];var right=left;var bottom=top;for(var i=0,len=ptsArr.length;i<len;i+=2){var x=ptsArr[i];var y=ptsArr[i+1];if(x<left)left=x;if(x>right)right=x;if(y<top)top=y;if(y>bottom)bottom=y;}this._bbox.set(left,top,right,bottom);this._isBboxChanged=false;}},{key:"setFromRect",value:function setFromRect(rc,offX,offY){var ptsArr=this._ptsArr;if(ptsArr.length!==8){ptsArr=new Float64Array(8);this._ptsArr=ptsArr;}ptsArr[0]=rc.getLeft()-offX;ptsArr[1]=rc.getTop()-offY;ptsArr[2]=rc.getRight()-offX;ptsArr[3]=rc.getTop()-offY;ptsArr[4]=rc.getRight()-offX;ptsArr[5]=rc.getBottom()-offY;ptsArr[6]=rc.getLeft()-offX;ptsArr[7]=rc.getBottom()-offY;this._bbox.copy(rc);if(offX!==0||offY!==0)this._bbox.offset(-offX,-offY);this._isBboxChanged=false;}},{key:"setFromQuad",value:function setFromQuad(q,offX,offY){tempQuad.copy(q);tempQuad.offset(offX,offY);this.setPoints(tempQuad.toArray());this._isBboxChanged=true;}},{key:"transform",value:function transform(w,h,a){var sina=0;var cosa=1;if(a!==0){sina=Math.sin(a);cosa=Math.cos(a);}this.transformPrecalc(w,h,sina,cosa);}},{key:"transformPrecalc",value:function transformPrecalc(w,h,sina,cosa){var ptsArr=this._ptsArr;for(var i=0,len=ptsArr.length;i<len;i+=2){var j=i+1;var x=ptsArr[i]*w;var y=ptsArr[j]*h;ptsArr[i]=x*cosa-y*sina;ptsArr[j]=y*cosa+x*sina;}this._isBboxChanged=true;}},{key:"offset",value:function offset(x,y){var ptsArr=this._ptsArr;for(var i=0,len=ptsArr.length;i<len;i+=2){ptsArr[i]+=x;ptsArr[i+1]+=y;}}},{key:"containsPoint",value:function containsPoint(a2x,a2y){var ptsArr=this._ptsArr;if(a2x===ptsArr[0]&&a2y===ptsArr[1])return true;this._updateBbox();var bbox=this._bbox;var a1x=bbox.getLeft()-110;var a1y=bbox.getTop()-101;var a3x=bbox.getRight()+131;var a3y=bbox.getBottom()+120;var minAx12=0;var minAy12=0;var maxAx12=0;var maxAy12=0;var minAx32=0;var minAy32=0;var maxAx32=0;var maxAy32=0;if(a1x<a2x){minAx12=a1x;maxAx12=a2x;}else{minAx12=a2x;maxAx12=a1x;}if(a1y<a2y){minAy12=a1y;maxAy12=a2y;}else{minAy12=a2y;maxAy12=a1y;}if(a3x<a2x){minAx32=a3x;maxAx32=a2x;}else{minAx32=a2x;maxAx32=a3x;}if(a3y<a2y){minAy32=a3y;maxAy32=a2y;}else{minAy32=a2y;maxAy32=a3y;}var count1=0;var count2=0;for(var i=0,len=ptsArr.length;i<len;i+=2){var j=(i+2)%len;var b1x=ptsArr[i];var b1y=ptsArr[i+1];var b2x=ptsArr[j];var b2y=ptsArr[j+1];if(_C15.segmentsIntersectPreCalc(a1x,a1y,a2x,a2y,minAx12,maxAx12,minAy12,maxAy12,b1x,b1y,b2x,b2y))++count1;if(_C15.segmentsIntersectPreCalc(a3x,a3y,a2x,a2y,minAx32,maxAx32,minAy32,maxAy32,b1x,b1y,b2x,b2y))++count2;}return count1%2===1||count2%2===1;}},{key:"intersectsPoly",value:function intersectsPoly(poly,offX,offY){var rPts=poly._ptsArr;var lPts=this._ptsArr;if(this.containsPoint(rPts[0]+offX,rPts[1]+offY))return true;if(poly.containsPoint(lPts[0]-offX,lPts[1]-offY))return true;for(var i=0,leni=lPts.length;i<leni;i+=2){var j=(i+2)%leni;var a1x=lPts[i];var a1y=lPts[i+1];var a2x=lPts[j];var a2y=lPts[j+1];var minAx=0;var minAy=0;var maxAx=0;var maxAy=0;if(a1x<a2x){minAx=a1x;maxAx=a2x;}else{minAx=a2x;maxAx=a1x;}if(a1y<a2y){minAy=a1y;maxAy=a2y;}else{minAy=a2y;maxAy=a1y;}for(var k=0,lenk=rPts.length;k<lenk;k+=2){var l=(k+2)%lenk;var b1x=rPts[k]+offX;var b1y=rPts[k+1]+offY;var b2x=rPts[l]+offX;var b2y=rPts[l+1]+offY;if(_C15.segmentsIntersectPreCalc(a1x,a1y,a2x,a2y,minAx,maxAx,minAy,maxAy,b1x,b1y,b2x,b2y))return true;}}return false;}},{key:"intersectsSegment",value:function intersectsSegment(offX,offY,a1x,a1y,a2x,a2y){if(this.containsPoint(a1x-offX,a1y-offY))return true;if(this.containsPoint(a2x-offX,a2y-offY))return true;var minAx=0;var minAy=0;var maxAx=0;var maxAy=0;if(a1x<a2x){minAx=a1x;maxAx=a2x;}else{minAx=a2x;maxAx=a1x;}if(a1y<a2y){minAy=a1y;maxAy=a2y;}else{minAy=a2y;maxAy=a1y;}var ptsArr=this._ptsArr;for(var i=0,len=ptsArr.length;i<len;i+=2){var j=(i+2)%len;var b1x=ptsArr[i]+offX;var b1y=ptsArr[i+1]+offY;var b2x=ptsArr[j]+offX;var b2y=ptsArr[j+1]+offY;if(_C15.segmentsIntersectPreCalc(a1x,a1y,a2x,a2y,minAx,maxAx,minAy,maxAy,b1x,b1y,b2x,b2y))return true;}return false;}},{key:"mirror",value:function mirror(px){var ptsArr=this._ptsArr;for(var i=0,len=ptsArr.length;i<len;i+=2){ptsArr[i]=px*2-ptsArr[i];}this._isBboxChanged=true;}},{key:"flip",value:function flip(py){var ptsArr=this._ptsArr;for(var i=0,len=ptsArr.length;i<len;i+=2){var j=i+1;ptsArr[j]=py*2-ptsArr[j];}this._isBboxChanged=true;}},{key:"diag",value:function diag(){var ptsArr=this._ptsArr;for(var i=0,len=ptsArr.length;i<len;i+=2){var j=i+1;var temp=ptsArr[i];ptsArr[i]=ptsArr[j];ptsArr[j]=temp;}this._isBboxChanged=true;}},{key:"GetMidX",value:function GetMidX(){var ptsArr=this._ptsArr;var ret=0;for(var i=0,len=ptsArr.length;i<len;i+=2){ret+=ptsArr[i];}return ret/this.pointCount();}},{key:"GetMidY",value:function GetMidY(){var ptsArr=this._ptsArr;var ret=0;for(var i=0,len=ptsArr.length;i<len;i+=2){ret+=ptsArr[i+1];}return ret/this.pointCount();}},{key:"GetPointsArray",value:function GetPointsArray(){return this._ptsArr;}},{key:"GetPointCount",value:function GetPointCount(){return this.pointCount();}},{key:"IsEnabled",value:function IsEnabled(){return this._enabled;}}]);return CollisionPoly;}(_C15.DefendedBase);}// lib/misc/pairMap.js
{'use strict';var _C16=self.C3;_C16.PairMap=/*#__PURE__*/function(_C16$DefendedBase){_inherits(PairMap,_C16$DefendedBase);function PairMap(iterable){var _this2;_classCallCheck(this,PairMap);_this2=_possibleConstructorReturn(this,_getPrototypeOf(PairMap).call(this));_this2._firstMap=new Map();if(iterable){var _iteratorNormalCompletion26=true;var _didIteratorError26=false;var _iteratorError26=undefined;try{for(var _iterator26=iterable[Symbol.iterator](),_step26;!(_iteratorNormalCompletion26=(_step26=_iterator26.next()).done);_iteratorNormalCompletion26=true){var _step26$value=_slicedToArray(_step26.value,3),x=_step26$value[0],y=_step26$value[1],value=_step26$value[2];_this2.Set(x,y,value);}}catch(err){_didIteratorError26=true;_iteratorError26=err;}finally{try{if(!_iteratorNormalCompletion26&&_iterator26["return"]!=null){_iterator26["return"]();}}finally{if(_didIteratorError26){throw _iteratorError26;}}}}return _this2;}_createClass(PairMap,[{key:"Release",value:function Release(){this.Clear();this._firstMap=null;}},{key:"IsEmpty",value:function IsEmpty(){return this._firstMap.size===0;}},{key:"Clear",value:function Clear(){var firstMap=this._firstMap;var _iteratorNormalCompletion27=true;var _didIteratorError27=false;var _iteratorError27=undefined;try{for(var _iterator27=firstMap.values()[Symbol.iterator](),_step27;!(_iteratorNormalCompletion27=(_step27=_iterator27.next()).done);_iteratorNormalCompletion27=true){var secondMap=_step27.value;secondMap.clear();}}catch(err){_didIteratorError27=true;_iteratorError27=err;}finally{try{if(!_iteratorNormalCompletion27&&_iterator27["return"]!=null){_iterator27["return"]();}}finally{if(_didIteratorError27){throw _iteratorError27;}}}firstMap.clear();}},{key:"Set",value:function Set(x,y,value){var firstMap=this._firstMap;var secondMap=firstMap.get(x);if(!secondMap){secondMap=new Map();firstMap.set(x,secondMap);}secondMap.set(y,value);}},{key:"Get",value:function Get(x,y){var secondMap=this._firstMap.get(x);if(!secondMap)return secondMap;return secondMap.get(y);}},{key:"Has",value:function Has(x,y){var secondMap=this._firstMap.get(x);if(!secondMap)return false;return secondMap.has(y);}},{key:"Delete",value:function Delete(x,y){var firstMap=this._firstMap;var secondMap=firstMap.get(x);if(!secondMap)return false;var ret=secondMap["delete"](y);if(ret&&secondMap.size===0)firstMap["delete"](x);return ret;}},{key:"DeleteEither",value:function DeleteEither(k){var firstMap=this._firstMap;var secondMap=firstMap.get(k);if(secondMap){secondMap.clear();firstMap["delete"](k);}var _iteratorNormalCompletion28=true;var _didIteratorError28=false;var _iteratorError28=undefined;try{for(var _iterator28=firstMap.entries()[Symbol.iterator](),_step28;!(_iteratorNormalCompletion28=(_step28=_iterator28.next()).done);_iteratorNormalCompletion28=true){var _step28$value=_slicedToArray(_step28.value,2),x=_step28$value[0],_secondMap=_step28$value[1];if(_secondMap["delete"](k)&&_secondMap.size===0)firstMap["delete"](x);}}catch(err){_didIteratorError28=true;_iteratorError28=err;}finally{try{if(!_iteratorNormalCompletion28&&_iterator28["return"]!=null){_iterator28["return"]();}}finally{if(_didIteratorError28){throw _iteratorError28;}}}}},{key:"GetSize",value:function GetSize(){var ret=0;var _iteratorNormalCompletion29=true;var _didIteratorError29=false;var _iteratorError29=undefined;try{for(var _iterator29=this._firstMap.values()[Symbol.iterator](),_step29;!(_iteratorNormalCompletion29=(_step29=_iterator29.next()).done);_iteratorNormalCompletion29=true){var secondMap=_step29.value;ret+=secondMap.size;}}catch(err){_didIteratorError29=true;_iteratorError29=err;}finally{try{if(!_iteratorNormalCompletion29&&_iterator29["return"]!=null){_iterator29["return"]();}}finally{if(_didIteratorError29){throw _iteratorError29;}}}return ret;}},{key:"values",value:/*#__PURE__*/regeneratorRuntime.mark(function values(){var _iteratorNormalCompletion30,_didIteratorError30,_iteratorError30,_iterator30,_step30,secondMap;return regeneratorRuntime.wrap(function values$(_context25){while(1){switch(_context25.prev=_context25.next){case 0:_iteratorNormalCompletion30=true;_didIteratorError30=false;_iteratorError30=undefined;_context25.prev=3;_iterator30=this._firstMap.values()[Symbol.iterator]();case 5:if(_iteratorNormalCompletion30=(_step30=_iterator30.next()).done){_context25.next=11;break;}secondMap=_step30.value;return _context25.delegateYield(secondMap.values(),"t0",8);case 8:_iteratorNormalCompletion30=true;_context25.next=5;break;case 11:_context25.next=17;break;case 13:_context25.prev=13;_context25.t1=_context25["catch"](3);_didIteratorError30=true;_iteratorError30=_context25.t1;case 17:_context25.prev=17;_context25.prev=18;if(!_iteratorNormalCompletion30&&_iterator30["return"]!=null){_iterator30["return"]();}case 20:_context25.prev=20;if(!_didIteratorError30){_context25.next=23;break;}throw _iteratorError30;case 23:return _context25.finish(20);case 24:return _context25.finish(17);case 25:case"end":return _context25.stop();}}},values,this,[[3,13,17,25],[18,,20,24]]);})},{key:"keyPairs",value:/*#__PURE__*/regeneratorRuntime.mark(function keyPairs(){var _iteratorNormalCompletion31,_didIteratorError31,_iteratorError31,_iterator31,_step31,_step31$value,x,secondMap,_iteratorNormalCompletion32,_didIteratorError32,_iteratorError32,_iterator32,_step32,y;return regeneratorRuntime.wrap(function keyPairs$(_context26){while(1){switch(_context26.prev=_context26.next){case 0:_iteratorNormalCompletion31=true;_didIteratorError31=false;_iteratorError31=undefined;_context26.prev=3;_iterator31=this._firstMap.entries()[Symbol.iterator]();case 5:if(_iteratorNormalCompletion31=(_step31=_iterator31.next()).done){_context26.next=36;break;}_step31$value=_slicedToArray(_step31.value,2),x=_step31$value[0],secondMap=_step31$value[1];_iteratorNormalCompletion32=true;_didIteratorError32=false;_iteratorError32=undefined;_context26.prev=10;_iterator32=secondMap.keys()[Symbol.iterator]();case 12:if(_iteratorNormalCompletion32=(_step32=_iterator32.next()).done){_context26.next=19;break;}y=_step32.value;_context26.next=16;return[x,y];case 16:_iteratorNormalCompletion32=true;_context26.next=12;break;case 19:_context26.next=25;break;case 21:_context26.prev=21;_context26.t0=_context26["catch"](10);_didIteratorError32=true;_iteratorError32=_context26.t0;case 25:_context26.prev=25;_context26.prev=26;if(!_iteratorNormalCompletion32&&_iterator32["return"]!=null){_iterator32["return"]();}case 28:_context26.prev=28;if(!_didIteratorError32){_context26.next=31;break;}throw _iteratorError32;case 31:return _context26.finish(28);case 32:return _context26.finish(25);case 33:_iteratorNormalCompletion31=true;_context26.next=5;break;case 36:_context26.next=42;break;case 38:_context26.prev=38;_context26.t1=_context26["catch"](3);_didIteratorError31=true;_iteratorError31=_context26.t1;case 42:_context26.prev=42;_context26.prev=43;if(!_iteratorNormalCompletion31&&_iterator31["return"]!=null){_iterator31["return"]();}case 45:_context26.prev=45;if(!_didIteratorError31){_context26.next=48;break;}throw _iteratorError31;case 48:return _context26.finish(45);case 49:return _context26.finish(42);case 50:case"end":return _context26.stop();}}},keyPairs,this,[[3,38,42,50],[10,21,25,33],[26,,28,32],[43,,45,49]]);})},{key:"entries",value:/*#__PURE__*/regeneratorRuntime.mark(function entries(){var _iteratorNormalCompletion33,_didIteratorError33,_iteratorError33,_iterator33,_step33,_step33$value,x,secondMap,_iteratorNormalCompletion34,_didIteratorError34,_iteratorError34,_iterator34,_step34,_step34$value,y,value;return regeneratorRuntime.wrap(function entries$(_context27){while(1){switch(_context27.prev=_context27.next){case 0:_iteratorNormalCompletion33=true;_didIteratorError33=false;_iteratorError33=undefined;_context27.prev=3;_iterator33=this._firstMap.entries()[Symbol.iterator]();case 5:if(_iteratorNormalCompletion33=(_step33=_iterator33.next()).done){_context27.next=36;break;}_step33$value=_slicedToArray(_step33.value,2),x=_step33$value[0],secondMap=_step33$value[1];_iteratorNormalCompletion34=true;_didIteratorError34=false;_iteratorError34=undefined;_context27.prev=10;_iterator34=secondMap.entries()[Symbol.iterator]();case 12:if(_iteratorNormalCompletion34=(_step34=_iterator34.next()).done){_context27.next=19;break;}_step34$value=_slicedToArray(_step34.value,2),y=_step34$value[0],value=_step34$value[1];_context27.next=16;return[x,y,value];case 16:_iteratorNormalCompletion34=true;_context27.next=12;break;case 19:_context27.next=25;break;case 21:_context27.prev=21;_context27.t0=_context27["catch"](10);_didIteratorError34=true;_iteratorError34=_context27.t0;case 25:_context27.prev=25;_context27.prev=26;if(!_iteratorNormalCompletion34&&_iterator34["return"]!=null){_iterator34["return"]();}case 28:_context27.prev=28;if(!_didIteratorError34){_context27.next=31;break;}throw _iteratorError34;case 31:return _context27.finish(28);case 32:return _context27.finish(25);case 33:_iteratorNormalCompletion33=true;_context27.next=5;break;case 36:_context27.next=42;break;case 38:_context27.prev=38;_context27.t1=_context27["catch"](3);_didIteratorError33=true;_iteratorError33=_context27.t1;case 42:_context27.prev=42;_context27.prev=43;if(!_iteratorNormalCompletion33&&_iterator33["return"]!=null){_iterator33["return"]();}case 45:_context27.prev=45;if(!_didIteratorError33){_context27.next=48;break;}throw _iteratorError33;case 48:return _context27.finish(45);case 49:return _context27.finish(42);case 50:case"end":return _context27.stop();}}},entries,this,[[3,38,42,50],[10,21,25,33],[26,,28,32],[43,,45,49]]);})}]);return PairMap;}(_C16.DefendedBase);}// lib/misc/arraySet.js
{'use strict';var _C17=self.C3;_C17.ArraySet=/*#__PURE__*/function(_C17$DefendedBase){_inherits(ArraySet,_C17$DefendedBase);function ArraySet(){var _this3;_classCallCheck(this,ArraySet);_this3=_possibleConstructorReturn(this,_getPrototypeOf(ArraySet).call(this));_this3._set=new Set();_this3._arr=[];_this3._needToRebuildArray=false;return _this3;}_createClass(ArraySet,[{key:"Release",value:function Release(){this.Clear();}},{key:"Clear",value:function Clear(){this._set.clear();_C17.clearArray(this._arr);this._needToRebuildArray=false;}},{key:"Add",value:function Add(v){if(this._set.has(v))return;this._set.add(v);if(!this._needToRebuildArray)this._arr.push(v);}},{key:"Has",value:function Has(v){return this._set.has(v);}},{key:"Delete",value:function Delete(v){if(this._set["delete"](v))this._needToRebuildArray=true;}},{key:"GetSize",value:function GetSize(){return this._set.size;}},{key:"IsEmpty",value:function IsEmpty(){return this._set.size===0;}},{key:"GetArray",value:function GetArray(){if(this._needToRebuildArray){this._RebuildArray();this._needToRebuildArray=false;}return this._arr;}},{key:"_RebuildArray",value:function _RebuildArray(){var arr=this._arr;_C17.clearArray(arr);var _iteratorNormalCompletion35=true;var _didIteratorError35=false;var _iteratorError35=undefined;try{for(var _iterator35=this._set[Symbol.iterator](),_step35;!(_iteratorNormalCompletion35=(_step35=_iterator35.next()).done);_iteratorNormalCompletion35=true){var v=_step35.value;arr.push(v);}}catch(err){_didIteratorError35=true;_iteratorError35=err;}finally{try{if(!_iteratorNormalCompletion35&&_iterator35["return"]!=null){_iterator35["return"]();}}finally{if(_didIteratorError35){throw _iteratorError35;}}}}}]);return ArraySet;}(_C17.DefendedBase);}// ../lib/misc/ease.js
{'use strict';var _C18=self.C3;var EASE_MAP=new Map();var PREDEFINED_EASE_MAP=new Map();var CUSTOM_EASE_EDITOR_MAP=new Map();var CUSTOM_EASE_RUNTIME_MAP=new Map();var PRIVATE_EASE_MAP=new Map();var BUILT_IN_TRANSITION_MAP=new Map();var ALIAS_MAP=new Map();ALIAS_MAP.set("linear","noease");ALIAS_MAP.set("default","noease");var EASE_TRANSLATION_KEYS=["default","noease","easeinquad","easeoutquad","easeinoutquad","easeincubic","easeoutcubic","easeinoutcubic","easeinquart","easeoutquart","easeinoutquart","easeinquint","easeoutquint","easeinoutquint","easeinsine","easeoutsine","easeinoutsine","easeinexpo","easeoutexpo","easeinoutexpo","easeincirc","easeoutcirc","easeinoutcirc","easeinelastic","easeoutelastic","easeinoutelastic","easeinback","easeoutback","easeinoutback","easeinbounce","easeoutbounce","easeinoutbounce"];var SHORT_EASE_TRANSLATION_KEYS=["default","noease","quad","cubic","quart","quint","sine","expo","circ","elastic","back","bounce"];var EASE_API2INTERNAL_NAMES=new Map([["linear","noease"],["in-sine","easeinsine"],["out-sine","easeoutsine"],["in-out-sine","easeinoutsine"],["in-elastic","easeinelastic"],["out-elastic","easeoutelastic"],["in-out-elastic","easeinoutelastic"],["in-back","easeinback"],["out-back","easeoutback"],["in-out-back","easeinoutback"],["in-bounce","easeinbounce"],["out-bounce","easeoutbounce"],["in-out-bounce","easeinoutbounce"],["in-cubic","easeincubic"],["out-cubic","easeoutcubic"],["in-out-cubic","easeinoutcubic"],["in-quadratic","easeinquad"],["out-quadratic","easeoutquad"],["in-out-quadratic","easeinoutquad"],["in-quartic","easeinquart"],["out-quartic","easeoutquart"],["in-out-quartic","easeinoutquart"],["in-quintic","easeinquint"],["out-quintic","easeoutquint"],["in-out-quintic","easeinoutquint"],["in-circular","easeincirc"],["out-circular","easeoutcirc"],["in-out-circular","easeinoutcirc"],["in-exponential","easeinexpo"],["out-exponential","easeoutexpo"],["in-out-exponential","easeinoutexpo"]]);self.Ease=/*#__PURE__*/function(){function Ease(){_classCallCheck(this,Ease);}_createClass(Ease,null,[{key:"InheritEase",value:function InheritEase(){return"default";}},{key:"DefaultEase",value:function DefaultEase(){return"noease";}},{key:"ToInternal",value:function ToInternal(ease){return EASE_API2INTERNAL_NAMES.get(ease);}},{key:"GetEditorEaseNames",value:function GetEditorEaseNames(project){for(var _len19=arguments.length,filter=new Array(_len19>1?_len19-1:0),_key19=1;_key19<_len19;_key19++){filter[_key19-1]=arguments[_key19];}this._CreateEaseMap();var customEaseMap;if(project){if(!CUSTOM_EASE_EDITOR_MAP.has(project))CUSTOM_EASE_EDITOR_MAP.set(project,new Map());customEaseMap=CUSTOM_EASE_EDITOR_MAP.get(project);}else customEaseMap=CUSTOM_EASE_RUNTIME_MAP;var sortedCustomEases=_toConsumableArray(customEaseMap.keys());sortedCustomEases.sort();return _toConsumableArray(PREDEFINED_EASE_MAP.keys()).concat(sortedCustomEases).filter(function(ease){return!filter.includes(ease);});}},{key:"GetRuntimeEaseNames",value:function GetRuntimeEaseNames(){this._CreateEaseMap();var sortedCustomEases=_toConsumableArray(CUSTOM_EASE_RUNTIME_MAP.keys());sortedCustomEases.sort();return _toConsumableArray(PREDEFINED_EASE_MAP.keys()).concat(sortedCustomEases);}},{key:"GetCustomRuntimeEaseNames",value:function GetCustomRuntimeEaseNames(){this._CreateEaseMap();var sortedCustomEases=_toConsumableArray(CUSTOM_EASE_RUNTIME_MAP.keys());sortedCustomEases.sort();return sortedCustomEases;}},{key:"IsPredefinedTranslatedName",value:function IsPredefinedTranslatedName(easeName){var _iteratorNormalCompletion36=true;var _didIteratorError36=false;var _iteratorError36=undefined;try{for(var _iterator36=EASE_TRANSLATION_KEYS[Symbol.iterator](),_step36;!(_iteratorNormalCompletion36=(_step36=_iterator36.next()).done);_iteratorNormalCompletion36=true){var k=_step36.value;var translatedName=self.lang("ui.bars.timeline.eases.".concat(k));if(translatedName===easeName)return true;}}catch(err){_didIteratorError36=true;_iteratorError36=err;}finally{try{if(!_iteratorNormalCompletion36&&_iterator36["return"]!=null){_iterator36["return"]();}}finally{if(_didIteratorError36){throw _iteratorError36;}}}var _iteratorNormalCompletion37=true;var _didIteratorError37=false;var _iteratorError37=undefined;try{for(var _iterator37=SHORT_EASE_TRANSLATION_KEYS[Symbol.iterator](),_step37;!(_iteratorNormalCompletion37=(_step37=_iterator37.next()).done);_iteratorNormalCompletion37=true){var _k=_step37.value;var _translatedName=self.lang("ui.bars.timeline.short-eases.".concat(_k));if(_translatedName===easeName)return true;}}catch(err){_didIteratorError37=true;_iteratorError37=err;}finally{try{if(!_iteratorNormalCompletion37&&_iterator37["return"]!=null){_iterator37["return"]();}}finally{if(_didIteratorError37){throw _iteratorError37;}}}}},{key:"IsNamePredefined",value:function IsNamePredefined(easeName){this._CreateEaseMap();return _toConsumableArray(PREDEFINED_EASE_MAP.keys()).includes(easeName);}},{key:"_GetEase",value:function _GetEase(easeName){var realEaseName=ALIAS_MAP.get(easeName);if(realEaseName)return EASE_MAP.get(realEaseName);if(Ease.IsNamePredefined(easeName))return EASE_MAP.get(easeName);if(PRIVATE_EASE_MAP.has(easeName))return PRIVATE_EASE_MAP.get(easeName);}},{key:"GetBuiltInTransition",value:function GetBuiltInTransition(builtInTransitionName){this._CreateEaseMap();return BUILT_IN_TRANSITION_MAP.get(builtInTransitionName);}},{key:"GetEditorEase",value:function GetEditorEase(easeName,project){this._CreateEaseMap();var ease=Ease._GetEase(easeName);if(ease)return ease;if(!project)throw new Error("missing ease function");return CUSTOM_EASE_EDITOR_MAP.get(project).get(easeName);}},{key:"HasEditorEase",value:function HasEditorEase(easeName,project){this._CreateEaseMap();var ease=Ease._GetEase(easeName);if(ease)return true;return!!CUSTOM_EASE_EDITOR_MAP.get(project).get(easeName);}},{key:"GetRuntimeEase",value:function GetRuntimeEase(easeName){this._CreateEaseMap();var ease=Ease._GetEase(easeName);if(ease)return ease;return CUSTOM_EASE_RUNTIME_MAP.get(easeName);}},{key:"GetEaseFromIndex",value:function GetEaseFromIndex(index){this._CreateEaseMap();var names=this.GetRuntimeEaseNames();return names[index];}},{key:"GetIndexForEase",value:function GetIndexForEase(name,project){this._CreateEaseMap();var names=this.GetEditorEaseNames(project);return names.indexOf(name);}},{key:"GetIndexForEaseAtRuntime",value:function GetIndexForEaseAtRuntime(name){return this.GetIndexForEase(name);}},{key:"_CreateEaseMap",value:function _CreateEaseMap(){if(EASE_MAP.size!==0)return;this._AddPredifinedEase("default",function(){});this._AddPredifinedEase("noease",[{"x":0,"y":0,"sax":.336,"say":0,"eax":0,"eay":0,"se":true,"ee":false},{"x":1,"y":1,"sax":0,"say":0,"eax":-.336,"eay":0,"se":false,"ee":true}],true);this._AddPredifinedEase("easeinsine",[{"x":0,"y":0,"sax":.485,"say":0,"eax":0,"eay":0,"se":true,"ee":false},{"x":1,"y":1,"sax":0,"say":0,"eax":-.038,"eay":0,"se":false,"ee":true}]);this._AddPredifinedEase("easeoutsine",[{"x":0,"y":0,"sax":.038,"say":0,"eax":0,"eay":0,"se":true,"ee":false},{"x":1,"y":1,"sax":0,"say":0,"eax":-.485,"eay":0,"se":false,"ee":true}]);this._AddPredifinedEase("easeinoutsine",[{"x":0,"y":0,"sax":.336,"say":0,"eax":0,"eay":0,"se":true,"ee":false},{"x":1,"y":1,"sax":0,"say":0,"eax":-.336,"eay":0,"se":false,"ee":true}]);this._AddPredifinedEase("easeinelastic",[{"x":0,"y":0,"sax":.018,"say":0,"eax":0,"eay":0,"se":true,"ee":false},{"x":.116,"y":.002,"sax":.025,"say":0,"eax":-.025,"eay":0,"se":true,"ee":true},{"x":.266,"y":-.005,"sax":.024,"say":0,"eax":-.021,"eay":0,"se":true,"ee":true},{"x":.416,"y":.016,"sax":.024,"say":0,"eax":-.026,"eay":0,"se":true,"ee":true},{"x":.566,"y":-.045,"sax":.061,"say":0,"eax":-.025,"eay":0,"se":true,"ee":true},{"x":.716,"y":.132,"sax":.072,"say":-.004,"eax":-.045,"eay":0,"se":true,"ee":true},{"x":.866,"y":-.373,"sax":.06,"say":0,"eax":-.049,"eay":-.002,"se":true,"ee":true},{"x":1,"y":1,"sax":0,"say":0,"eax":-.038,"eay":-.263,"se":false,"ee":true}]);this._AddPredifinedEase("easeoutelastic",[{"x":0,"y":0,"sax":.038,"say":.263,"eax":0,"eay":0,"se":true,"ee":false},{"x":.136,"y":1.373,"sax":.049,"say":.002,"eax":-.06,"eay":0,"se":true,"ee":true},{"x":.286,"y":.868,"sax":.045,"say":0,"eax":-.072,"eay":.004,"se":true,"ee":true},{"x":.436,"y":1.045,"sax":.025,"say":0,"eax":-.061,"eay":0,"se":true,"ee":true},{"x":.586,"y":.984,"sax":.026,"say":0,"eax":-.024,"eay":0,"se":true,"ee":true},{"x":.736,"y":1.005,"sax":.021,"say":0,"eax":-.024,"eay":0,"se":true,"ee":true},{"x":.886,"y":.998,"sax":.025,"say":0,"eax":-.025,"eay":0,"se":true,"ee":true},{"x":1,"y":1,"sax":0,"say":0,"eax":-.018,"eay":0,"se":false,"ee":true}]);this._AddPredifinedEase("easeinoutelastic",[{"x":0,"y":0,"sax":.025,"say":0,"eax":0,"eay":0,"se":true,"ee":false},{"x":.067,"y":.001,"sax":.025,"say":0,"eax":-.025,"eay":0,"se":true,"ee":true},{"x":.18,"y":-.005,"sax":.025,"say":0,"eax":-.025,"eay":0,"se":true,"ee":true},{"x":.292,"y":.025,"sax":.053,"say":0,"eax":-.025,"eay":0,"se":true,"ee":true},{"x":.405,"y":-.118,"sax":.069,"say":0,"eax":-.027,"eay":0,"se":true,"ee":true},{"x":.597,"y":1.118,"sax":.027,"say":0,"eax":-.069,"eay":0,"se":true,"ee":true},{"x":.71,"y":.975,"sax":.025,"say":0,"eax":-.053,"eay":0,"se":true,"ee":true},{"x":.822,"y":1.005,"sax":.025,"say":0,"eax":-.025,"eay":0,"se":true,"ee":true},{"x":.935,"y":.999,"sax":.025,"say":0,"eax":-.025,"eay":0,"se":true,"ee":true},{"x":1,"y":1,"sax":0,"say":0,"eax":-.025,"eay":0,"se":false,"ee":true}]);this._AddPredifinedEase("easeinback",[{"x":0,"y":0,"sax":.35,"say":0,"eax":0,"eay":0,"se":true,"ee":false},{"x":1,"y":1,"sax":0,"say":0,"eax":-.34,"eay":-1.579,"se":false,"ee":true}]);this._AddPredifinedEase("easeoutback",[{"x":0,"y":0,"sax":.34,"say":1.579,"eax":0,"eay":0,"se":true,"ee":false},{"x":1,"y":1,"sax":0,"say":0,"eax":-.35,"eay":0,"se":false,"ee":true}]);this._AddPredifinedEase("easeinoutback",[{"x":0,"y":0,"sax":.035,"say":0,"eax":0,"eay":0,"se":true,"ee":false},{"x":.242,"y":-.1,"sax":.258,"say":0,"eax":-.025,"eay":0,"se":true,"ee":true},{"x":.76,"y":1.1,"sax":.025,"say":0,"eax":-.26,"eay":0,"se":true,"ee":true},{"x":1,"y":1,"sax":0,"say":0,"eax":-.035,"eay":0,"se":false,"ee":true}]);this._AddPredifinedEase("easeinbounce",[{"x":0,"y":0,"sax":.033,"say":.025,"eax":0,"eay":0,"se":true,"ee":false},{"x":.092,"y":0,"sax":.026,"say":.078,"eax":-.033,"eay":.025,"se":true,"ee":true},{"x":.274,"y":0,"sax":.097,"say":.319,"eax":-.026,"eay":.078,"se":true,"ee":true},{"x":.637,"y":0,"sax":.105,"say":.625,"eax":-.097,"eay":.319,"se":true,"ee":true},{"x":1,"y":1,"sax":0,"say":0,"eax":-.125,"eay":-.004,"se":false,"ee":true}]);this._AddPredifinedEase("easeoutbounce",[{"x":0,"y":0,"sax":.125,"say":.004,"eax":0,"eay":0,"se":true,"ee":false},{"x":.365,"y":1,"sax":.097,"say":-.319,"eax":-.105,"eay":-.625,"se":true,"ee":true},{"x":.728,"y":1,"sax":.026,"say":-.078,"eax":-.097,"eay":-.319,"se":true,"ee":true},{"x":.91,"y":1,"sax":.033,"say":-.025,"eax":-.026,"eay":-.078,"se":true,"ee":true},{"x":1,"y":1,"sax":0,"say":0,"eax":-.033,"eay":-.025,"se":false,"ee":true}]);this._AddPredifinedEase("easeinoutbounce",[{"x":0,"y":0,"sax":.01,"say":.006,"eax":0,"eay":0,"se":true,"ee":false},{"x":.046,"y":0,"sax":.021,"say":.038,"eax":-.01,"eay":.006,"se":true,"ee":true},{"x":.137,"y":0,"sax":.059,"say":.158,"eax":-.021,"eay":.038,"se":true,"ee":true},{"x":.319,"y":0,"sax":.117,"say":.744,"eax":-.059,"eay":.158,"se":true,"ee":true},{"x":.683,"y":1,"sax":.059,"say":-.158,"eax":-.117,"eay":-.744,"se":true,"ee":true},{"x":.865,"y":1,"sax":.021,"say":-.038,"eax":-.059,"eay":-.158,"se":true,"ee":true},{"x":.956,"y":1,"sax":.01,"say":-.006,"eax":-.021,"eay":-.038,"se":true,"ee":true},{"x":1,"y":1,"sax":0,"say":0,"eax":-.01,"eay":-.006,"se":false,"ee":true}]);this._AddPredifinedEase("easeincubic",[{"x":0,"y":0,"sax":.75,"say":0,"eax":0,"eay":0,"se":true,"ee":false},{"x":1,"y":1,"sax":0,"say":0,"eax":-.138,"eay":-.321,"se":false,"ee":true}]);this._AddPredifinedEase("easeoutcubic",[{"x":0,"y":0,"sax":.138,"say":.321,"eax":0,"eay":0,"se":true,"ee":false},{"x":1,"y":1,"sax":0,"say":0,"eax":-.75,"eay":0,"se":false,"ee":true}]);this._AddPredifinedEase("easeinoutcubic",[{"x":0,"y":0,"sax":.285,"say":0,"eax":0,"eay":0,"se":true,"ee":false},{"x":.5,"y":.5,"sax":.081,"say":.272,"eax":-.081,"eay":-.272,"se":true,"ee":true},{"x":1,"y":1,"sax":0,"say":0,"eax":-.285,"eay":0,"se":false,"ee":true}]);this._AddPredifinedEase("easeinquad",[{"x":0,"y":0,"sax":.4,"say":0,"eax":0,"eay":0,"se":true,"ee":false},{"x":1,"y":1,"sax":0,"say":0,"eax":-.178,"eay":-.392,"se":false,"ee":true}]);this._AddPredifinedEase("easeoutquad",[{"x":0,"y":0,"sax":.178,"say":.392,"eax":0,"eay":0,"se":true,"ee":false},{"x":1,"y":1,"sax":0,"say":0,"eax":-.4,"eay":0,"se":false,"ee":true}]);this._AddPredifinedEase("easeinoutquad",[{"x":0,"y":0,"sax":.25,"say":0,"eax":0,"eay":0,"se":true,"ee":false},{"x":.5,"y":.5,"sax":.03,"say":.065,"eax":-.03,"eay":-.065,"se":true,"ee":true},{"x":1,"y":1,"sax":0,"say":0,"eax":-.25,"eay":0,"se":false,"ee":true}]);this._AddPredifinedEase("easeinquart",[{"x":0,"y":0,"sax":.25,"say":1,"eax":0,"eay":0,"se":true,"ee":false},{"x":1,"y":1,"sax":0,"say":0,"eax":-.5,"eay":0,"se":false,"ee":true}]);this._AddPredifinedEase("easeoutquart",[{"x":0,"y":0,"sax":.5,"say":0,"eax":0,"eay":0,"se":true,"ee":false},{"x":1,"y":1,"sax":0,"say":0,"eax":-.25,"eay":-1,"se":false,"ee":true}]);this._AddPredifinedEase("easeinoutquart",[{"x":0,"y":0,"sax":.765,"say":.03,"eax":0,"eay":0,"se":true,"ee":false},{"x":1,"y":1,"sax":0,"say":0,"eax":-.765,"eay":-.03,"se":false,"ee":true}]);this._AddPredifinedEase("easeinquint",[{"x":0,"y":0,"sax":.6,"say":0,"eax":0,"eay":0,"se":true,"ee":false},{"x":1,"y":1,"sax":0,"say":0,"eax":-.2,"eay":-1,"se":false,"ee":true}]);this._AddPredifinedEase("easeoutquint",[{"x":0,"y":0,"sax":.2,"say":1,"eax":0,"eay":0,"se":true,"ee":false},{"x":1,"y":1,"sax":0,"say":0,"eax":-.6,"eay":0,"se":false,"ee":true}]);this._AddPredifinedEase("easeinoutquint",[{"eax":0,"eay":0,"ee":false,"sax":.84,"say":0,"se":true,"x":0,"y":0},{"eax":-.84,"eay":0,"ee":true,"sax":0,"say":0,"se":false,"x":1,"y":1}]);this._AddPredifinedEase("easeincirc",[{"x":0,"y":0,"sax":.25,"say":0,"eax":0,"eay":0,"se":true,"ee":false},{"x":1,"y":1,"sax":0,"say":0,"eax":-.024,"eay":-.808,"se":false,"ee":true}]);this._AddPredifinedEase("easeoutcirc",[{"x":0,"y":0,"sax":.024,"say":.808,"eax":0,"eay":0,"se":true,"ee":false},{"x":1,"y":1,"sax":0,"say":0,"eax":-.25,"eay":0,"se":false,"ee":true}]);this._AddPredifinedEase("easeinoutcirc",[{"x":0,"y":0,"sax":.125,"say":0,"eax":0,"eay":0,"se":true,"ee":false},{"x":.5,"y":.5,"sax":.02,"say":.428,"eax":-.02,"eay":-.428,"se":true,"ee":true},{"x":1,"y":1,"sax":0,"say":0,"eax":-.125,"eay":0,"se":false,"ee":true}]);this._AddPredifinedEase("easeinexpo",[{"x":0,"y":0,"sax":.66,"say":0,"eax":0,"eay":0,"se":true,"ee":false},{"x":1,"y":1,"sax":0,"say":0,"eax":-.14,"eay":-1,"se":false,"ee":true}]);this._AddPredifinedEase("easeoutexpo",[{"x":0,"y":0,"sax":.14,"say":1,"eax":0,"eay":0,"se":true,"ee":false},{"x":1,"y":1,"sax":0,"say":0,"eax":-.66,"eay":0,"se":false,"ee":true}]);this._AddPredifinedEase("easeinoutexpo",[{"eax":0,"eay":0,"ee":false,"sax":.345,"say":0,"se":true,"x":0,"y":0},{"eax":-.06,"eay":-.5,"ee":true,"sax":.06,"say":.5,"se":true,"x":.5,"y":.5},{"eax":-.335,"eay":0,"ee":true,"sax":0,"say":0,"se":false,"x":1,"y":1}]);this._AddPrivateCustomEase("cubicbezier",this.EaseCubicBezier);this._AddPrivateCustomEase("spline",this.EaseSpline);}},{key:"_AddPredifinedEase",value:function _AddPredifinedEase(name,dataArray_or_function){var linear=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(typeof dataArray_or_function==="function")Ease._AddEase(name,dataArray_or_function,"predefined");else if(_C18.IsArray(dataArray_or_function)){if(self.BuiltInTransition){var builtInTransition=_C18.New(self.BuiltInTransition,name,linear);builtInTransition.SetFromJson(dataArray_or_function);Ease._AddEase(name,function(t,sv,dv,tt){return builtInTransition.Interpolate(t,sv,dv,tt);},"predefined");BUILT_IN_TRANSITION_MAP.set(name,builtInTransition);}else{var _builtInTransition=_C18.New(_C18.Transition,[name,dataArray_or_function.map(function(data){return[data["x"],data["y"],data["sax"],data["say"],data["eax"],data["eay"],data["se"],data["ee"]];})],false);_builtInTransition.MakeLinear(linear);Ease._AddEase(name,function(t,sv,dv,tt){return _builtInTransition.Interpolate(t,sv,dv,tt);},"predefined");}}else throw new Error("unexpected arguments");}},{key:"_AddPrivateCustomEase",value:function _AddPrivateCustomEase(name,func){Ease._AddEase(name,func,"private");}},{key:"AddCustomEase",value:function AddCustomEase(name,func,project){this._CreateEaseMap();Ease._AddEase(name,func,"custom",project);}},{key:"RemoveCustomEase",value:function RemoveCustomEase(name,project){if(this.IsNamePredefined(name))return;if(_toConsumableArray(PRIVATE_EASE_MAP.keys()).includes(name))return;var customEaseMap=CUSTOM_EASE_EDITOR_MAP.get(project);if(customEaseMap)customEaseMap["delete"](name);}},{key:"_AddEase",value:function _AddEase(name,func,mode,project){switch(mode){case"predefined":{EASE_MAP.set(name,func);PREDEFINED_EASE_MAP.set(name,func);break;}case"custom":{if(project){if(!CUSTOM_EASE_EDITOR_MAP.has(project))CUSTOM_EASE_EDITOR_MAP.set(project,new Map());var customEaseMap=CUSTOM_EASE_EDITOR_MAP.get(project);customEaseMap.set(name,func);}else CUSTOM_EASE_RUNTIME_MAP.set(name,func);break;}case"private":{EASE_MAP.set(name,func);PRIVATE_EASE_MAP.set(name,func);break;}default:throw new Error("unexpected ease mode");}}},{key:"NoEase",value:function NoEase(t,b,c,d){return c*t/d+b;}},{key:"EaseInQuad",value:function EaseInQuad(t,b,c,d){return c*(t/=d)*t+b;}},{key:"EaseOutQuad",value:function EaseOutQuad(t,b,c,d){return-c*(t/=d)*(t-2)+b;}},{key:"EaseInOutQuad",value:function EaseInOutQuad(t,b,c,d){if((t/=d/2)<1)return c/2*t*t+b;return-c/2*(--t*(t-2)-1)+b;}},{key:"EaseInCubic",value:function EaseInCubic(t,b,c,d){return c*(t/=d)*t*t+b;}},{key:"EaseOutCubic",value:function EaseOutCubic(t,b,c,d){return c*((t=t/d-1)*t*t+1)+b;}},{key:"EaseInOutCubic",value:function EaseInOutCubic(t,b,c,d){if((t/=d/2)<1)return c/2*t*t*t+b;return c/2*((t-=2)*t*t+2)+b;}},{key:"EaseInQuart",value:function EaseInQuart(t,b,c,d){return c*(t/=d)*t*t*t+b;}},{key:"EaseOutQuart",value:function EaseOutQuart(t,b,c,d){return-c*((t=t/d-1)*t*t*t-1)+b;}},{key:"EaseInOutQuart",value:function EaseInOutQuart(t,b,c,d){if((t/=d/2)<1)return c/2*t*t*t*t+b;return-c/2*((t-=2)*t*t*t-2)+b;}},{key:"EaseInQuint",value:function EaseInQuint(t,b,c,d){return c*(t/=d)*t*t*t*t+b;}},{key:"EaseOutQuint",value:function EaseOutQuint(t,b,c,d){return c*((t=t/d-1)*t*t*t*t+1)+b;}},{key:"EaseInOutQuint",value:function EaseInOutQuint(t,b,c,d){if((t/=d/2)<1)return c/2*t*t*t*t*t+b;return c/2*((t-=2)*t*t*t*t+2)+b;}},{key:"EaseInSine",value:function EaseInSine(t,b,c,d){return-c*Math.cos(t/d*(Math.PI/2))+c+b;}},{key:"EaseOutSine",value:function EaseOutSine(t,b,c,d){return c*Math.sin(t/d*(Math.PI/2))+b;}},{key:"EaseInOutSine",value:function EaseInOutSine(t,b,c,d){return-c/2*(Math.cos(Math.PI*t/d)-1)+b;}},{key:"EaseInExpo",value:function EaseInExpo(t,b,c,d){return t===0?b:c*Math.pow(2,10*(t/d-1))+b;}},{key:"EaseOutExpo",value:function EaseOutExpo(t,b,c,d){return t===d?b+c:c*(-Math.pow(2,-10*t/d)+1)+b;}},{key:"EaseInOutExpo",value:function EaseInOutExpo(t,b,c,d){if(t===0)return b;if(t===d)return b+c;if((t/=d/2)<1)return c/2*Math.pow(2,10*(t-1))+b;return c/2*(-Math.pow(2,-10*--t)+2)+b;}},{key:"EaseInCirc",value:function EaseInCirc(t,b,c,d){return-c*(Math.sqrt(1-(t/=d)*t)-1)+b;}},{key:"EaseOutCirc",value:function EaseOutCirc(t,b,c,d){return c*Math.sqrt(1-(t=t/d-1)*t)+b;}},{key:"EaseInOutCirc",value:function EaseInOutCirc(t,b,c,d){if((t/=d/2)<1)return-c/2*(Math.sqrt(1-t*t)-1)+b;return c/2*(Math.sqrt(1-(t-=2)*t)+1)+b;}},{key:"EaseInElastic",value:function EaseInElastic(t,b,c,d){var s=1.70158;var p=0;var a=c;if(t===0)return b;if((t/=d)===1)return b+c;if(!p)p=d*.3;if(a<Math.abs(c)){a=c;s=p/4;}else s=p/(2*Math.PI)*Math.asin(c/a);return-(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b;}},{key:"EaseOutElastic",value:function EaseOutElastic(t,b,c,d){var s=1.70158;var p=0;var a=c;if(t===0)return b;if((t/=d)===1)return b+c;if(!p)p=d*.3;if(a<Math.abs(c)){a=c;s=p/4;}else s=p/(2*Math.PI)*Math.asin(c/a);return a*Math.pow(2,-10*t)*Math.sin((t*d-s)*(2*Math.PI)/p)+c+b;}},{key:"EaseInOutElastic",value:function EaseInOutElastic(t,b,c,d){var s=1.70158;var p=0;var a=c;if(t===0)return b;if((t/=d/2)===2)return b+c;if(!p)p=d*(.3*1.5);if(a<Math.abs(c)){a=c;s=p/4;}else s=p/(2*Math.PI)*Math.asin(c/a);if(t<1)return-.5*(a*Math.pow(2,10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p))+b;return a*Math.pow(2,-10*(t-=1))*Math.sin((t*d-s)*(2*Math.PI)/p)*.5+c+b;}},{key:"EaseInBack",value:function EaseInBack(t,b,c,d,s){if(s===undefined)s=1.70158;return c*(t/=d)*t*((s+1)*t-s)+b;}},{key:"EaseOutBack",value:function EaseOutBack(t,b,c,d,s){if(s===undefined)s=1.70158;return c*((t=t/d-1)*t*((s+1)*t+s)+1)+b;}},{key:"EaseInOutBack",value:function EaseInOutBack(t,b,c,d,s){if(s===undefined)s=1.70158;if((t/=d/2)<1)return c/2*(t*t*(((s*=1.525)+1)*t-s))+b;return c/2*((t-=2)*t*(((s*=1.525)+1)*t+s)+2)+b;}},{key:"EaseInBounce",value:function EaseInBounce(t,b,c,d){return c-Ease.EaseOutBounce(d-t,0,c,d)+b;}},{key:"EaseOutBounce",value:function EaseOutBounce(t,b,c,d){if((t/=d)<1/2.75)return c*(7.5625*t*t)+b;else if(t<2/2.75)return c*(7.5625*(t-=1.5/2.75)*t+.75)+b;else if(t<2.5/2.75)return c*(7.5625*(t-=2.25/2.75)*t+.9375)+b;else return c*(7.5625*(t-=2.625/2.75)*t+.984375)+b;}},{key:"EaseInOutBounce",value:function EaseInOutBounce(t,b,c,d){if(t<d/2)return Ease.EaseInBounce(t*2,0,c,d)*.5+b;return Ease.EaseOutBounce(t*2-d,0,c,d)*.5+c*.5+b;}},{key:"EaseCubicBezier",value:function EaseCubicBezier(t,p0,p1,p2,p3){var _0=p0;var _1=3*t*(p1-p0);var _2=3*Math.pow(t,2)*(p0+p2-2*p1);var _3=Math.pow(t,3)*(p3-p0+3*p1-3*p2);return _0+_1+_2+_3;}},{key:"EaseSpline",value:function EaseSpline(t,sx,sy,x1,y1,x2,y2,ex,ey,samples){if(x1===y1&&x2===y2)return t;var tx=get_t_for_x(t,sx,x1,x2,ex,samples);var va=a(sy,y1,y2,ey);var vb=b(sy,y1,y2,ey);var vc=c(sy,y1,y2,ey);return calc_bezier(tx,va,vb,vc);}},{key:"GetBezierSamples",value:function GetBezierSamples(startx,a1x,a2x,endx){var ret=[];var va=a(startx,a1x,a2x,endx);var vb=b(startx,a1x,a2x,endx);var vc=c(startx,a1x,a2x,endx);for(var i=0;i<SAMPLE_COUNT;++i){var sample=calc_bezier(i*SAMPLE_STEP,va,vb,vc);ret.push(sample);}return ret;}}]);return Ease;}();var SAMPLE_COUNT=11;var SAMPLE_STEP=1/(SAMPLE_COUNT-1);var NEWTON_RAPHSON_ITERATIONS=4;var NEWTON_RAPHSON_MIN_SLOPE=.01;var SUBDIVISION_PRECISION=1E-7;var SUBDIVISION_MAX_ITERATIONS=10;var a=function a(p0,p1,p2,p3){return p3-3*p2+3*p1-p0;};var b=function b(p0,p1,p2,p3){return 3*p2-6*p1+3*p0;};var c=function c(p0,p1,p2,p3){return 3*(p1-p0);};var calc_bezier=function calc_bezier(aT,a,b,c){return((a*aT+b)*aT+c)*aT;};var get_slope=function get_slope(aT,a,b,c){return 3*a*aT*aT+2*b*aT+c;};var get_t_for_x=function get_t_for_x(aX,p0,p1,p2,p3,samples){if(aX==1)return 1;var intervalStart=0;var currentSampleIndex=1;var currentSampleValue=samples[currentSampleIndex];var lastSampleIndex=SAMPLE_COUNT-1;var lastSampleValue=samples[SAMPLE_COUNT-1];while(currentSampleIndex!=lastSampleIndex&&currentSampleValue<=aX){currentSampleIndex++;currentSampleValue=samples[currentSampleIndex];intervalStart+=SAMPLE_STEP;}currentSampleIndex--;currentSampleValue=samples[currentSampleIndex];var dist=(aX-currentSampleValue)/(samples[currentSampleIndex+1]-currentSampleValue);var guess=intervalStart+dist*SAMPLE_STEP;var va=a(p0,p1,p2,p3);var vb=b(p0,p1,p2,p3);var vc=c(p0,p1,p2,p3);var initSlope=get_slope(guess,va,vb,vc);if(initSlope===0)return guess;else if(initSlope>=NEWTON_RAPHSON_MIN_SLOPE){for(var i=0;i<NEWTON_RAPHSON_ITERATIONS;++i){var x=calc_bezier(guess,va,vb,vc)-aX;var slope=get_slope(guess,va,vb,vc);guess-=x/slope;}return guess;}else{var aA=intervalStart;var aB=intervalStart+SAMPLE_STEP;var _i20=0;var precissionLimit;var maxIterations;do{guess=aA+(aB-aA)/2;var _x=calc_bezier(guess,va,vb,vc)-aX;if(_x>0)aB=guess;else aA=guess;precissionLimit=Math.abs(_x)>SUBDIVISION_PRECISION;maxIterations=++_i20<SUBDIVISION_MAX_ITERATIONS;}while(precissionLimit&&maxIterations);return guess;}};}// ../lib/misc/probability.js
{var RequireStringOrNumber=function RequireStringOrNumber(value){if(!_C19.IsString(value));};'use strict';var _C19=self.C3;_C19.ProbabilityTable=/*#__PURE__*/function(){function ProbabilityTable(name){_classCallCheck(this,ProbabilityTable);this._items=[];this._name=name||"";this._totalWeight=0;}_createClass(ProbabilityTable,[{key:"Release",value:function Release(){this.Clear();this._items=null;}},{key:"GetName",value:function GetName(){return this._name;}},{key:"Clear",value:function Clear(){_C19.clear2DArray(this._items);this._totalWeight=0;}},{key:"GetTotalWeight",value:function GetTotalWeight(){return this._totalWeight;}},{key:"Sample",value:function Sample(){var t=arguments.length>0&&arguments[0]!==undefined?arguments[0]:Math.random()*this.GetTotalWeight();var sumWeight=0;var _iteratorNormalCompletion38=true;var _didIteratorError38=false;var _iteratorError38=undefined;try{for(var _iterator38=this._items[Symbol.iterator](),_step38;!(_iteratorNormalCompletion38=(_step38=_iterator38.next()).done);_iteratorNormalCompletion38=true){var _step38$value=_slicedToArray(_step38.value,2),weight=_step38$value[0],value=_step38$value[1];sumWeight+=weight;if(t<sumWeight)return value;}}catch(err){_didIteratorError38=true;_iteratorError38=err;}finally{try{if(!_iteratorNormalCompletion38&&_iterator38["return"]!=null){_iterator38["return"]();}}finally{if(_didIteratorError38){throw _iteratorError38;}}}return 0;}},{key:"AddItem",value:function AddItem(weight,value){RequireStringOrNumber(value);this._totalWeight+=weight;this._items.push([weight,value]);}},{key:"RemoveItem",value:function RemoveItem(weight,value){RequireStringOrNumber(value);var ignoreWeight=weight===0;for(var i=0;i<this._items.length;i++){var item=this._items[i];var doesWeightMatch=ignoreWeight||item[0]===weight;var doesValueMatch=item[1]===value;if(doesWeightMatch&&doesValueMatch){this._items.splice(i,1);this._totalWeight-=item[0];break;}}}},{key:"asJSON",value:function asJSON(){return JSON.stringify(this._items);}}],[{key:"fromJSON",value:function fromJSON(str){var table=new _C19.ProbabilityTable();var items=JSON.parse(str);var _iteratorNormalCompletion39=true;var _didIteratorError39=false;var _iteratorError39=undefined;try{for(var _iterator39=items[Symbol.iterator](),_step39;!(_iteratorNormalCompletion39=(_step39=_iterator39.next()).done);_iteratorNormalCompletion39=true){var item=_step39.value;var weight=item[0];var value=item[1];table.AddItem(weight,value);}}catch(err){_didIteratorError39=true;_iteratorError39=err;}finally{try{if(!_iteratorNormalCompletion39&&_iterator39["return"]!=null){_iterator39["return"]();}}finally{if(_didIteratorError39){throw _iteratorError39;}}}return table;}}]);return ProbabilityTable;}();}// lib/misc/screenReaderText.js
{'use strict';var _C20=self.C3;var nextId=0;_C20.ScreenReaderText=/*#__PURE__*/function(){function ScreenReaderText(runtime,text){_classCallCheck(this,ScreenReaderText);this._runtime=runtime;this._text=text;this._id=nextId++;this._runtime.PostComponentMessageToDOM("runtime","screen-reader-text",{"type":"create","id":this._id,"text":this._text});}_createClass(ScreenReaderText,[{key:"Release",value:function Release(){this._runtime.PostComponentMessageToDOM("runtime","screen-reader-text",{"type":"release","id":this._id});this._runtime=null;this._text="";this._id=-1;}},{key:"SetText",value:function SetText(text){if(this._text===text)return;this._text=text;this._runtime.PostComponentMessageToDOM("runtime","screen-reader-text",{"type":"update","id":this._id,"text":this._text});}}]);return ScreenReaderText;}();}// ../lib/events/event.js
{'use strict';var _C21=self.C3;_C21.Event=/*#__PURE__*/function(){function Event(type,cancelable){_classCallCheck(this,Event);this.type=type;this.cancelable=!!cancelable;this.defaultPrevented=false;this.propagationStopped=false;this.isAsync=false;}_createClass(Event,[{key:"preventDefault",value:function preventDefault(){if(!this.cancelable)throw new Error("event '".concat(this.type,"' is not cancelable"));this.defaultPrevented=true;}},{key:"stopPropagation",value:function stopPropagation(){if(!this.cancelable)throw new Error("event '".concat(this.type,"' cannot be stopped"));if(this.isAsync)throw new Error("cannot stop async event '".concat(this.type,"' propagation"));this.propagationStopped=true;}}]);return Event;}();}// ../lib/events/handler.js
{'use strict';var _C22=self.C3;var _assert=self.assert;_C22.Event.Handler=/*#__PURE__*/function(_C22$DefendedBase){_inherits(EventHandler,_C22$DefendedBase);function EventHandler(type){var _this4;_classCallCheck(this,EventHandler);_this4=_possibleConstructorReturn(this,_getPrototypeOf(EventHandler).call(this));_this4._type=type;_this4._captureListeners=[];_this4._captureListenersSet=new Set();_this4._listeners=[];_this4._listenersSet=new Set();_this4._fireDepth=0;_this4._queueModifyListeners=[];return _this4;}_createClass(EventHandler,[{key:"Release",value:function Release(){if(this._fireDepth>0)return;_C22.clearArray(this._captureListeners);this._captureListenersSet.clear();_C22.clearArray(this._listeners);this._listenersSet.clear();_C22.clearArray(this._queueModifyListeners);_C22.Release(this);}},{key:"_AddListener",value:function _AddListener(func,capture){if(this._IsFiring()){this._queueModifyListeners.push({op:"add",func:func,capture:capture});return;}if(capture){if(this._captureListenersSet.has(func))return;this._captureListeners.push(func);this._captureListenersSet.add(func);}else{if(this._listenersSet.has(func))return;this._listeners.push(func);this._listenersSet.add(func);}}},{key:"_RemoveListener",value:function _RemoveListener(func,capture){if(this._IsFiring()){this._queueModifyListeners.push({op:"remove",func:func,capture:capture});return;}if(capture){if(this._captureListenersSet.has(func)){this._captureListenersSet["delete"](func);_C22.arrayFindRemove(this._captureListeners,func);}}else if(this._listenersSet.has(func)){this._listenersSet["delete"](func);_C22.arrayFindRemove(this._listeners,func);}}},{key:"_IsEmpty",value:function _IsEmpty(){return!this._captureListeners.length&&!this._listeners.length;}},{key:"_IsFiring",value:function _IsFiring(){return this._fireDepth>0;}},{key:"_ProcessQueuedListeners",value:function _ProcessQueuedListeners(){var removeListenersSet=new Set();var removeCaptureListenersSet=new Set();var _iteratorNormalCompletion40=true;var _didIteratorError40=false;var _iteratorError40=undefined;try{for(var _iterator40=this._queueModifyListeners[Symbol.iterator](),_step40;!(_iteratorNormalCompletion40=(_step40=_iterator40.next()).done);_iteratorNormalCompletion40=true){var q=_step40.value;if(q.op==="add"){this._AddListener(q.func,q.capture);if(q.capture)removeCaptureListenersSet["delete"](q.func);else removeListenersSet["delete"](q.func);}else if(q.op==="remove"){if(q.capture){this._captureListenersSet["delete"](q.func);removeCaptureListenersSet.add(q.func);}else{this._listenersSet["delete"](q.func);removeListenersSet.add(q.func);}}else throw new Error("invalid op");}}catch(err){_didIteratorError40=true;_iteratorError40=err;}finally{try{if(!_iteratorNormalCompletion40&&_iterator40["return"]!=null){_iterator40["return"]();}}finally{if(_didIteratorError40){throw _iteratorError40;}}}_C22.arrayRemoveAllInSet(this._listeners,removeListenersSet);_C22.arrayRemoveAllInSet(this._captureListeners,removeCaptureListenersSet);_C22.clearArray(this._queueModifyListeners);}},{key:"_FireCancellable",value:function _FireCancellable(event){this._IncreaseFireDepth();var isStopped=false;for(var i=0,len=this._captureListeners.length;i<len;++i){this._captureListeners[i](event);if(event.propagationStopped){isStopped=true;break;}}if(!isStopped)for(var _i21=0,_len20=this._listeners.length;_i21<_len20;++_i21){this._listeners[_i21](event);if(event.propagationStopped)break;}this._DecreaseFireDepth();return!event.defaultPrevented;}},{key:"_FireNonCancellable",value:function _FireNonCancellable(event){this._IncreaseFireDepth();for(var i=0,len=this._captureListeners.length;i<len;++i){this._captureListeners[i](event);}for(var _i22=0,_len21=this._listeners.length;_i22<_len21;++_i22){this._listeners[_i22](event);}this._DecreaseFireDepth();return true;}},{key:"_IncreaseFireDepth",value:function _IncreaseFireDepth(){this._fireDepth++;}},{key:"_DecreaseFireDepth",value:function _DecreaseFireDepth(){this._fireDepth--;if(this._fireDepth===0&&this._queueModifyListeners.length>0)this._ProcessQueuedListeners();}},{key:"SetDelayRemoveEventsEnabled",value:function SetDelayRemoveEventsEnabled(e){if(e)this._IncreaseFireDepth();else this._DecreaseFireDepth();}},{key:"_FireAsync",value:function _FireAsync(event){var _this5=this;var callbackPromises=[];var _loop2=function _loop2(i,len){var func=_this5._captureListeners[i];callbackPromises.push(_C22.Asyncify(function(){return func(event);}));};for(var i=0,len=this._captureListeners.length;i<len;++i){_loop2(i,len);}var _loop3=function _loop3(_i23,_len22){var func=_this5._listeners[_i23];callbackPromises.push(_C22.Asyncify(function(){return func(event);}));};for(var _i23=0,_len22=this._listeners.length;_i23<_len22;++_i23){_loop3(_i23,_len22);}return Promise.all(callbackPromises).then(function(){return!event.defaultPrevented;});}},{key:"_FireAndWait_AsyncOptional",value:function _FireAndWait_AsyncOptional(event){var results=[];this._IncreaseFireDepth();for(var i=0,len=this._captureListeners.length;i<len;++i){var ret=this._captureListeners[i](event);if(ret instanceof Promise)results.push(ret);}for(var _i24=0,_len23=this._listeners.length;_i24<_len23;++_i24){var _ret=this._listeners[_i24](event);if(_ret instanceof Promise)results.push(_ret);}this._DecreaseFireDepth();if(results.length)return Promise.all(results).then(function(){return!event.defaultPrevented;});else return!event.defaultPrevented;}},{key:"_FireAndWaitAsync",value:function _FireAndWaitAsync(event){return regeneratorRuntime.async(function _FireAndWaitAsync$(_context28){while(1){switch(_context28.prev=_context28.next){case 0:_context28.next=2;return regeneratorRuntime.awrap(this._FireAndWait_AsyncOptional(event));case 2:return _context28.abrupt("return",_context28.sent);case 3:case"end":return _context28.stop();}}},null,this);}},{key:"_FireAndWaitAsyncSequential",value:function _FireAndWaitAsyncSequential(event){var i,len,ret,_i25,_len24,_ret2;return regeneratorRuntime.async(function _FireAndWaitAsyncSequential$(_context29){while(1){switch(_context29.prev=_context29.next){case 0:this._IncreaseFireDepth();i=0,len=this._captureListeners.length;case 2:if(!(i<len)){_context29.next=10;break;}ret=this._captureListeners[i](event);if(!(ret instanceof Promise)){_context29.next=7;break;}_context29.next=7;return regeneratorRuntime.awrap(ret);case 7:++i;_context29.next=2;break;case 10:_i25=0,_len24=this._listeners.length;case 11:if(!(_i25<_len24)){_context29.next=19;break;}_ret2=this._listeners[_i25](event);if(!(_ret2 instanceof Promise)){_context29.next=16;break;}_context29.next=16;return regeneratorRuntime.awrap(_ret2);case 16:++_i25;_context29.next=11;break;case 19:this._DecreaseFireDepth();return _context29.abrupt("return",!event.defaultPrevented);case 21:case"end":return _context29.stop();}}},null,this);}},{key:"_FireAsGenerator",value:/*#__PURE__*/regeneratorRuntime.mark(function _FireAsGenerator(event){var i,len,ret,_i26,_len25,_ret3;return regeneratorRuntime.wrap(function _FireAsGenerator$(_context30){while(1){switch(_context30.prev=_context30.next){case 0:this._IncreaseFireDepth();i=0,len=this._captureListeners.length;case 2:if(!(i<len)){_context30.next=9;break;}ret=this._captureListeners[i](event);if(!_C22.IsIterator(ret)){_context30.next=6;break;}return _context30.delegateYield(ret,"t0",6);case 6:++i;_context30.next=2;break;case 9:_i26=0,_len25=this._listeners.length;case 10:if(!(_i26<_len25)){_context30.next=17;break;}_ret3=this._listeners[_i26](event);if(!_C22.IsIterator(_ret3)){_context30.next=14;break;}return _context30.delegateYield(_ret3,"t1",14);case 14:++_i26;_context30.next=10;break;case 17:this._DecreaseFireDepth();case 18:case"end":return _context30.stop();}}},_FireAsGenerator,this);})}]);return EventHandler;}(_C22.DefendedBase);}// ../lib/events/dispatcher.js
{'use strict';var _C23=self.C3;_C23.Event.Dispatcher=/*#__PURE__*/function(_C23$DefendedBase){_inherits(EventDispatcher,_C23$DefendedBase);function EventDispatcher(){var _this6;_classCallCheck(this,EventDispatcher);_this6=_possibleConstructorReturn(this,_getPrototypeOf(EventDispatcher).call(this));_this6._eventHandlers=new Map();_this6._dispatcherWasReleased=false;return _this6;}_createClass(EventDispatcher,[{key:"Release",value:function Release(){if(this._dispatcherWasReleased)throw new Error("already released");this.ClearEvents();this._dispatcherWasReleased=true;_C23.Release(this);}},{key:"WasReleased",value:function WasReleased(){return this._dispatcherWasReleased;}},{key:"ClearEvents",value:function ClearEvents(){var _iteratorNormalCompletion41=true;var _didIteratorError41=false;var _iteratorError41=undefined;try{for(var _iterator41=this._eventHandlers.values()[Symbol.iterator](),_step41;!(_iteratorNormalCompletion41=(_step41=_iterator41.next()).done);_iteratorNormalCompletion41=true){var handler=_step41.value;handler.Release();}}catch(err){_didIteratorError41=true;_iteratorError41=err;}finally{try{if(!_iteratorNormalCompletion41&&_iterator41["return"]!=null){_iterator41["return"]();}}finally{if(_didIteratorError41){throw _iteratorError41;}}}this._eventHandlers.clear();}},{key:"_GetHandlerByType",value:function _GetHandlerByType(type,create_if_missing){var handler=this._eventHandlers.get(type);if(handler)return handler;if(create_if_missing){handler=_C23.New(_C23.Event.Handler,type);this._eventHandlers.set(type,handler);return handler;}return null;}},{key:"HasAnyHandlerFor",value:function HasAnyHandlerFor(type){return this._eventHandlers.has(type);}},{key:"addEventListener",value:function addEventListener(type,func,capture){var handler=this._GetHandlerByType(type,true);handler._AddListener(func,!!capture);}},{key:"removeEventListener",value:function removeEventListener(type,func,capture){var handler=this._GetHandlerByType(type,false);if(!handler)return;handler._RemoveListener(func,!!capture);if(handler._IsEmpty())this._eventHandlers["delete"](type);}},{key:"dispatchEvent",value:function dispatchEvent(event){var handler=this._GetHandlerByType(event.type,false);if(!handler)return true;if(event.cancelable)return handler._FireCancellable(event);else return handler._FireNonCancellable(event);}},{key:"dispatchEventAsync",value:function dispatchEventAsync(event){var handler=this._GetHandlerByType(event.type,false);if(!handler)return Promise.resolve(true);event.isAsync=true;return handler._FireAsync(event);}},{key:"dispatchEventAndClearAsync",value:function dispatchEventAndClearAsync(event){var handler,ret;return regeneratorRuntime.async(function dispatchEventAndClearAsync$(_context31){while(1){switch(_context31.prev=_context31.next){case 0:handler=this._GetHandlerByType(event.type,false);if(handler){_context31.next=3;break;}return _context31.abrupt("return",true);case 3:this._eventHandlers["delete"](event.type);event.isAsync=true;_context31.next=7;return regeneratorRuntime.awrap(handler._FireAsync(event));case 7:ret=_context31.sent;handler.Release();return _context31.abrupt("return",ret);case 10:case"end":return _context31.stop();}}},null,this);}},{key:"dispatchEventAndWaitAsync",value:function dispatchEventAndWaitAsync(event){var handler;return regeneratorRuntime.async(function dispatchEventAndWaitAsync$(_context32){while(1){switch(_context32.prev=_context32.next){case 0:handler=this._GetHandlerByType(event.type,false);if(handler){_context32.next=3;break;}return _context32.abrupt("return",true);case 3:_context32.next=5;return regeneratorRuntime.awrap(handler._FireAndWaitAsync(event));case 5:return _context32.abrupt("return",_context32.sent);case 6:case"end":return _context32.stop();}}},null,this);}},{key:"dispatchEventAndWait_AsyncOptional",value:function dispatchEventAndWait_AsyncOptional(event){var handler=this._GetHandlerByType(event.type,false);if(!handler)return true;return handler._FireAndWait_AsyncOptional(event);}},{key:"dispatchEventAndWaitAsyncSequential",value:function dispatchEventAndWaitAsyncSequential(event){var handler;return regeneratorRuntime.async(function dispatchEventAndWaitAsyncSequential$(_context33){while(1){switch(_context33.prev=_context33.next){case 0:handler=this._GetHandlerByType(event.type,false);if(handler){_context33.next=3;break;}return _context33.abrupt("return",true);case 3:_context33.next=5;return regeneratorRuntime.awrap(handler._FireAndWaitAsyncSequential(event));case 5:return _context33.abrupt("return",_context33.sent);case 6:case"end":return _context33.stop();}}},null,this);}},{key:"dispatchGeneratorEvent",value:function dispatchGeneratorEvent(event){var handler=this._GetHandlerByType(event.type,false);if(!handler)return null;if(event.cancelable)throw new Error("not supported");else return handler._FireAsGenerator(event);}},{key:"SetDelayRemoveEventsEnabled",value:function SetDelayRemoveEventsEnabled(e){var _iteratorNormalCompletion42=true;var _didIteratorError42=false;var _iteratorError42=undefined;try{for(var _iterator42=this._eventHandlers.values()[Symbol.iterator](),_step42;!(_iteratorNormalCompletion42=(_step42=_iterator42.next()).done);_iteratorNormalCompletion42=true){var handler=_step42.value;handler.SetDelayRemoveEventsEnabled(e);}}catch(err){_didIteratorError42=true;_iteratorError42=err;}finally{try{if(!_iteratorNormalCompletion42&&_iterator42["return"]!=null){_iterator42["return"]();}}finally{if(_didIteratorError42){throw _iteratorError42;}}}}}]);return EventDispatcher;}(_C23.DefendedBase);}// ../lib/util/asyncify.js
{var SetNewCallback=function SetNewCallback(timerTimeout){if(SUPPORTS_RIC&&highThroughputMode===0)callbackId=requestIdleCallback(DoAsyncifiedWork,{timeout:IDLECALLBACK_TIMEOUT});else callbackId=setTimeout(DoAsyncifiedWork,highThroughputMode>0?1:timerTimeout);};var DoAsyncifiedWork=function DoAsyncifiedWork(deadline){callbackId=-1;if(!workQueue.length)return;var startTime=performance.now();var curTime=startTime;var jobCount=0;var estimatedNextJobDuration=0;do{DoNextAsyncifiedJob(workQueue.shift());curTime=performance.now();++jobCount;estimatedNextJobDuration=(curTime-startTime)/jobCount*1.1;}while(workQueue.length&&(SUPPORTS_RIC&&highThroughputMode===0&&typeof deadline!=="undefined"?estimatedNextJobDuration<deadline["timeRemaining"]():curTime-startTime+estimatedNextJobDuration<SETTIMEOUT_WORK_DURATION));if(callbackId===-1&&workQueue.length){var workDuration=curTime-startTime;var timeout=Math.max(SETTIMEOUT_INTERVAL-workDuration,4);SetNewCallback(timeout);}};var DoNextAsyncifiedJob=function DoNextAsyncifiedJob(w){var ret;try{ret=w.func();}catch(e){w.reject(e);return;}w.resolve(ret);};'use strict';var _C24=self.C3;var SETTIMEOUT_WORK_DURATION=12;var SETTIMEOUT_INTERVAL=16;var IDLECALLBACK_TIMEOUT=35;var SUPPORTS_RIC=typeof requestIdleCallback!=="undefined";var workQueue=[];var callbackId=-1;var highThroughputMode=0;var asyncifyDisabled=_C24.QueryString.Has("disable-asyncify");if(asyncifyDisabled)console.warn("[Asyncify] Asyncify has been disabled due to disable-asyncify in the query string. Some work will now be done synchronously.");_C24.Asyncify=function Asyncify(func){var stack=null;if(_C24.isDebug)stack=_C24.GetCallStack();return new Promise(function(resolve,reject){workQueue.push({func:func,resolve:resolve,reject:reject,stack:stack});if(asyncifyDisabled){DoNextAsyncifiedJob(workQueue.pop());return;}if(callbackId===-1)SetNewCallback(SETTIMEOUT_INTERVAL);});};_C24.Asyncify.SetHighThroughputMode=function SetHighThroughputMode(m){if(m)++highThroughputMode;else{--highThroughputMode;if(highThroughputMode<0)throw new Error("already turned off high throughput mode");}};}// ../lib/util/idleTimeout.js
{var ClearTimeCache=function ClearTimeCache(){cachedNowTime=-1;};var CheckActiveIdleTimeouts=function CheckActiveIdleTimeouts(){timerId=-1;nextDeadline=-1;var nowTime=Date.now();var _iteratorNormalCompletion43=true;var _didIteratorError43=false;var _iteratorError43=undefined;try{for(var _iterator43=activeIdleTimeouts[Symbol.iterator](),_step43;!(_iteratorNormalCompletion43=(_step43=_iterator43.next()).done);_iteratorNormalCompletion43=true){var i=_step43.value;if(i._CheckTimeout(nowTime)){var deadline=i._GetDeadline();if(nextDeadline===-1||deadline<nextDeadline)nextDeadline=deadline;}else activeIdleTimeouts["delete"](i);}}catch(err){_didIteratorError43=true;_iteratorError43=err;}finally{try{if(!_iteratorNormalCompletion43&&_iterator43["return"]!=null){_iterator43["return"]();}}finally{if(_didIteratorError43){throw _iteratorError43;}}}if(nextDeadline!==-1){var duration=Math.max(nextDeadline-nowTime+IDLE_CHECK_TIMER_OVERSHOOT,IDLE_CHECK_MIN_INTERVAL);timerId=self.setTimeout(CheckActiveIdleTimeouts,duration);}};'use strict';var _C25=self.C3;var IDLE_CHECK_MIN_INTERVAL=1E3;var IDLE_CHECK_TIMER_OVERSHOOT=100;var cachedNowTime=-1;_C25.FastGetDateNow=function FastGetDateNow(){if(cachedNowTime===-1){cachedNowTime=Date.now();self.setTimeout(ClearTimeCache,16);}return cachedNowTime;};var timerId=-1;var nextDeadline=-1;var activeIdleTimeouts=new Set();_C25.IdleTimeout=/*#__PURE__*/function(){function IdleTimeout(callback,timeoutInSeconds){_classCallCheck(this,IdleTimeout);this._callback=callback;this._timeout=timeoutInSeconds*1E3;this._deadline=0;this._isActive=false;}_createClass(IdleTimeout,[{key:"Reset",value:function Reset(){var nowTime=_C25.FastGetDateNow();this._deadline=nowTime+this._timeout;if(!this._isActive){activeIdleTimeouts.add(this);this._isActive=true;}if(timerId===-1){nextDeadline=this._deadline;timerId=self.setTimeout(CheckActiveIdleTimeouts,this._timeout+IDLE_CHECK_TIMER_OVERSHOOT);}else if(this._deadline<nextDeadline&&nextDeadline>nowTime+IDLE_CHECK_MIN_INTERVAL){self.clearTimeout(timerId);nextDeadline=this._deadline;timerId=self.setTimeout(CheckActiveIdleTimeouts,this._timeout+IDLE_CHECK_TIMER_OVERSHOOT);}}},{key:"_CheckTimeout",value:function _CheckTimeout(nowTime){if(nowTime>=this._deadline){if(this._callback()){this._deadline=nowTime+this._timeout;return true;}this._isActive=false;return false;}return true;}},{key:"_GetDeadline",value:function _GetDeadline(){return this._deadline;}},{key:"Cancel",value:function Cancel(){if(this._isActive){activeIdleTimeouts["delete"](this);this._isActive=false;if(activeIdleTimeouts.size===0&&timerId!==-1){self.clearTimeout(timerId);timerId=-1;nextDeadline=-1;}}}},{key:"Release",value:function Release(){this.Cancel();this._callback=null;}}]);return IdleTimeout;}();}// ../lib/util/disposable.js
{'use strict';var _C26=self.C3;_C26.Disposable=/*#__PURE__*/function(){function Disposable(disposeAction){_classCallCheck(this,Disposable);this._disposed=false;this._disposeAction=disposeAction;}_createClass(Disposable,[{key:"Dispose",value:function Dispose(){if(this._disposed)return;this._disposed=true;if(this._disposeAction){this._disposeAction();this._disposeAction=null;}}},{key:"IsDisposed",value:function IsDisposed(){return this._disposed;}},{key:"Release",value:function Release(){this.Dispose();}}],[{key:"Release",value:function Release(instance){return new Disposable(function(){return instance.Release();});}},{key:"From",value:function From(eventDispatcher,eventNames,eventHandler,opts,scope){if(typeof opts==="undefined"||opts===null)opts=false;else if(typeof opts!=="boolean"&&_typeof(opts)!=="object")throw new TypeError("invalid event listener options");if(scope)eventHandler=eventHandler.bind(scope);if(eventNames.includes(" ")){eventNames=eventNames.split(" ");var disposable=new _C26.CompositeDisposable();var _iteratorNormalCompletion44=true;var _didIteratorError44=false;var _iteratorError44=undefined;try{var _loop4=function _loop4(){var eventName=_step44.value;eventDispatcher.addEventListener(eventName,eventHandler,opts);disposable.Add(_C26.New(_C26.Disposable,function(){return eventDispatcher.removeEventListener(eventName,eventHandler,opts);}));};for(var _iterator44=eventNames[Symbol.iterator](),_step44;!(_iteratorNormalCompletion44=(_step44=_iterator44.next()).done);_iteratorNormalCompletion44=true){_loop4();}}catch(err){_didIteratorError44=true;_iteratorError44=err;}finally{try{if(!_iteratorNormalCompletion44&&_iterator44["return"]!=null){_iterator44["return"]();}}finally{if(_didIteratorError44){throw _iteratorError44;}}}return disposable;}else{eventDispatcher.addEventListener(eventNames,eventHandler,opts);return _C26.New(_C26.Disposable,function(){return eventDispatcher.removeEventListener(eventNames,eventHandler,opts);});}}}]);return Disposable;}();_C26.StubDisposable=/*#__PURE__*/function(_C26$Disposable){_inherits(StubDisposable,_C26$Disposable);function StubDisposable(){_classCallCheck(this,StubDisposable);return _possibleConstructorReturn(this,_getPrototypeOf(StubDisposable).apply(this,arguments));}_createClass(StubDisposable,[{key:"SetAction",value:function SetAction(disposeAction){this._disposeAction=disposeAction;}}]);return StubDisposable;}(_C26.Disposable);_C26.CompositeDisposable=/*#__PURE__*/function(_C26$Disposable2){_inherits(CompositeDisposable,_C26$Disposable2);function CompositeDisposable(){var _this7;_classCallCheck(this,CompositeDisposable);_this7=_possibleConstructorReturn(this,_getPrototypeOf(CompositeDisposable).call(this));_this7._disposables=new Set();for(var _len26=arguments.length,disposables=new Array(_len26),_key20=0;_key20<_len26;_key20++){disposables[_key20]=arguments[_key20];}for(var _i27=0,_disposables=disposables;_i27<_disposables.length;_i27++){var disposable=_disposables[_i27];_this7.Add(disposable);}return _this7;}_createClass(CompositeDisposable,[{key:"Add",value:function Add(){if(this._disposed)throw new Error("already disposed");for(var _len27=arguments.length,disposables=new Array(_len27),_key21=0;_key21<_len27;_key21++){disposables[_key21]=arguments[_key21];}for(var _i28=0,_disposables2=disposables;_i28<_disposables2.length;_i28++){var disposable=_disposables2[_i28];this._disposables.add(disposable);}}},{key:"Remove",value:function Remove(disposable){if(this._disposed)throw new Error("already disposed");this._disposables["delete"](disposable);}},{key:"RemoveAll",value:function RemoveAll(){if(this._disposed)throw new Error("already disposed");if(!this._disposables)return;var _iteratorNormalCompletion45=true;var _didIteratorError45=false;var _iteratorError45=undefined;try{for(var _iterator45=this._disposables[Symbol.iterator](),_step45;!(_iteratorNormalCompletion45=(_step45=_iterator45.next()).done);_iteratorNormalCompletion45=true){var disposable=_step45.value;disposable.Dispose();}}catch(err){_didIteratorError45=true;_iteratorError45=err;}finally{try{if(!_iteratorNormalCompletion45&&_iterator45["return"]!=null){_iterator45["return"]();}}finally{if(_didIteratorError45){throw _iteratorError45;}}}this._disposables.clear();}},{key:"IsDisposed",value:function IsDisposed(){return this._disposed;}},{key:"Dispose",value:function Dispose(){if(this._disposed)throw new Error("already disposed");this._disposed=true;var _iteratorNormalCompletion46=true;var _didIteratorError46=false;var _iteratorError46=undefined;try{for(var _iterator46=this._disposables[Symbol.iterator](),_step46;!(_iteratorNormalCompletion46=(_step46=_iterator46.next()).done);_iteratorNormalCompletion46=true){var disposable=_step46.value;disposable.Dispose();}}catch(err){_didIteratorError46=true;_iteratorError46=err;}finally{try{if(!_iteratorNormalCompletion46&&_iterator46["return"]!=null){_iterator46["return"]();}}finally{if(_didIteratorError46){throw _iteratorError46;}}}this._disposables.clear();this._disposables=null;}},{key:"Release",value:function Release(){this.Dispose();}}]);return CompositeDisposable;}(_C26.Disposable);}// lib/util/kahanSum.js
{'use strict';var _C27=self.C3;_C27.KahanSum=/*#__PURE__*/function(_C27$DefendedBase){_inherits(KahanSum,_C27$DefendedBase);function KahanSum(){var _this8;_classCallCheck(this,KahanSum);_this8=_possibleConstructorReturn(this,_getPrototypeOf(KahanSum).call(this));_this8._c=0;_this8._y=0;_this8._t=0;_this8._sum=0;return _this8;}_createClass(KahanSum,[{key:"Add",value:function Add(v){v=+v;this._y=v-this._c;this._t=this._sum+this._y;this._c=this._t-this._sum-this._y;this._sum=this._t;}},{key:"Subtract",value:function Subtract(v){this._sum-=+v;}},{key:"Get",value:function Get(){return this._sum;}},{key:"Reset",value:function Reset(){this._c=0;this._y=0;this._t=0;this._sum=0;}},{key:"Set",value:function Set(s){this._c=0;this._y=0;this._t=0;this._sum=+s;}},{key:"Copy",value:function Copy(ks){this._c=ks._c;this._y=ks._y;this._t=ks._t;this._sum=ks._sum;}},{key:"Release",value:function Release(){}}]);return KahanSum;}(_C27.DefendedBase);}// lib/util/redblackset.js
{'use strict';var _C28=self.C3;var js_cols={};var RED=true;var BLACK=false;js_cols.RBnode=function(tree){this.tree=tree;this.right=this.tree.sentinel;this.left=this.tree.sentinel;this.parent=null;this.color=false;this.key=null;};js_cols.RedBlackSet=function(compare_func){this.size=0;this.sentinel=new js_cols.RBnode(this);this.sentinel.color=BLACK;this.root=this.sentinel;this.root.parent=this.sentinel;this.compare=compare_func||this.default_compare;};js_cols.RedBlackSet.prototype.default_compare=function(a,b){if(a<b)return-1;else if(b<a)return 1;else return 0;};js_cols.RedBlackSet.prototype.clone=function(){var rv=new js_cols.RedBlackSet(this.compare);rv.insertAll(this);return rv;};js_cols.RedBlackSet.prototype.clear=function(){this.size=0;this.sentinel=new js_cols.RBnode(this);this.sentinel.color=BLACK;this.root=this.sentinel;this.root.parent=this.sentinel;};js_cols.RedBlackSet.prototype.leftRotate=function(x){var y=x.right;x.right=y.left;if(y.left!=this.sentinel)y.left.parent=x;y.parent=x.parent;if(x.parent==this.sentinel)this.root=y;else if(x==x.parent.left)x.parent.left=y;else x.parent.right=y;y.left=x;x.parent=y;};js_cols.RedBlackSet.prototype.rightRotate=function(x){var y=x.left;x.left=y.right;if(y.right!=this.sentinel)y.right.parent=x;y.parent=x.parent;if(x.parent==this.sentinel)this.root=y;else if(x==x.parent.right)x.parent.right=y;else x.parent.left=y;y.right=x;x.parent=y;};js_cols.RedBlackSet.prototype.insert=function(key){if(!this.contains(key)){var z=new js_cols.RBnode(this);z.key=key;var y=this.sentinel;var x=this.root;while(x!=this.sentinel){y=x;if(this.compare(z.key,x.key)<0)x=x.left;else x=x.right;}z.parent=y;if(y==this.sentinel)this.root=z;else if(this.compare(z.key,y.key)<0)y.left=z;else y.right=z;z.left=this.sentinel;z.right=this.sentinel;z.color=RED;this.insertFixup(z);this.size++;}else{var node=this.get_(key);node.key=key;}};js_cols.RedBlackSet.prototype.insertFixup=function(z){while(z!=this.sentinel&&z!=this.root&&z.parent.color==RED){if(z.parent==z.parent.parent.left){var y=z.parent.parent.right;if(y.color==RED){z.parent.color=BLACK;y.color=BLACK;z.parent.parent.color=RED;z=z.parent.parent;}else{if(z==z.parent.right){z=z.parent;this.leftRotate(z);}z.parent.color=BLACK;z.parent.parent.color=RED;if(z.parent.parent!=this.sentinel)this.rightRotate(z.parent.parent);}}else{var y=z.parent.parent.left;if(y.color==RED){z.parent.color=BLACK;y.color=BLACK;z.parent.parent.color=RED;z=z.parent.parent;}else{if(z==z.parent.left){z=z.parent;this.rightRotate(z);}z.parent.color=BLACK;z.parent.parent.color=RED;if(z.parent.parent!=this.sentinel)this.leftRotate(z.parent.parent);}}}this.root.color=BLACK;};js_cols.RedBlackSet.prototype.delete_=function(z){var y;var x;if(z.left==this.sentinel||z.right==this.sentinel)y=z;else y=this.successor_(z);if(y.left!=this.sentinel)x=y.left;else x=y.right;x.parent=y.parent;if(y.parent==this.sentinel)this.root=x;else if(y==y.parent.left)y.parent.left=x;else y.parent.right=x;if(y!=z)z.key=y.key;if(y.color==BLACK)this.deleteFixup(x);this.size--;};js_cols.RedBlackSet.prototype.deleteFixup=function(x){while(x!=this.root&&x.color==BLACK){if(x==x.parent.left){var w=x.parent.right;if(w.color==RED){w.color=BLACK;x.parent.color=RED;this.leftRotate(x.parent);w=x.parent.right;}if(w.left.color==BLACK&&w.right.color==BLACK){w.color=RED;x=x.parent;}else{if(w.right.color==BLACK){w.left.color=BLACK;w.color=RED;this.rightRotate(w);w=x.parent.right;}w.color=x.parent.color;x.parent.color=BLACK;w.right.color=BLACK;this.leftRotate(x.parent);x=this.root;}}else{var w=x.parent.left;if(w.color==RED){w.color=BLACK;x.parent.color=RED;this.rightRotate(x.parent);w=x.parent.left;}if(w.right.color==BLACK&&w.left.color==BLACK){w.color=RED;x=x.parent;}else{if(w.left.color==BLACK){w.right.color=BLACK;w.color=RED;this.leftRotate(w);w=x.parent.left;}w.color=x.parent.color;x.parent.color=BLACK;w.left.color=BLACK;this.rightRotate(x.parent);x=this.root;}}}x.color=BLACK;};js_cols.RedBlackSet.prototype.remove=function(key){var x=this.get_(key);if(x!=this.sentinel){var retval=x.key;this.delete_(x);return retval;}else return null;};js_cols.RedBlackSet.prototype.removeSwapped=function(value,key){this.remove(key);};js_cols.RedBlackSet.prototype.min=function(x){while(x.left!=this.sentinel){x=x.left;}return x;};js_cols.RedBlackSet.prototype.max=function(x){while(x.right!=this.sentinel){x=x.right;}return x;};js_cols.RedBlackSet.prototype.successor_=function(x){if(x.right!=this.sentinel)return this.min(x.right);var y=x.parent;while(y!=this.sentinel&&x==y.right){x=y;y=y.parent;}return y;};js_cols.RedBlackSet.prototype.predeccessor_=function(x){if(x.left!=this.sentinel)return this.max(x.left);var y=x.parent;while(y!=this.sentinel&&x==y.left){x=y;y=y.parent;}return y;};js_cols.RedBlackSet.prototype.successor=function(key){if(this.size>0){var x=this.get_(key);if(x==this.sentinel)return null;if(x.right!=this.sentinel)return this.min(x.right).key;var y=x.parent;while(y!=this.sentinel&&x==y.right){x=y;y=y.parent;}if(y!=this.sentinel)return y.key;else return null;}else return null;};js_cols.RedBlackSet.prototype.predecessor=function(key){if(this.size>0){var x=this.get_(key);if(x==this.sentinel)return null;if(x.left!=this.sentinel)return this.max(x.left).key;var y=x.parent;while(y!=this.sentinel&&x==y.left){x=y;y=y.parent;}if(y!=this.sentinel)return y.key;else return null;}else return null;};js_cols.RedBlackSet.prototype.getMin=function(){return this.min(this.root).key;};js_cols.RedBlackSet.prototype.getMax=function(){return this.max(this.root).key;};js_cols.RedBlackSet.prototype.get_=function(key){var x=this.root;while(x!=this.sentinel&&this.compare(x.key,key)!=0){if(this.compare(key,x.key)<0)x=x.left;else x=x.right;}return x;};js_cols.RedBlackSet.prototype.contains=function(key){return this.get_(key).key!=null;};js_cols.RedBlackSet.prototype.getValues=function(){var ret=[];this.forEach(function(x){ret.push(x);});return ret;};js_cols.RedBlackSet.prototype.insertAll=function(col){if(js_cols.typeOf(col)=="array")for(var i=0;i<col.length;i++){this.insert(col[i]);}else if(js_cols.typeOf(col.forEach)=="function")col.forEach(this.insert,this);else if(js_cols.typeOf(col.getValues)=="function"){var arr=col.getValues();for(var i=0;i<arr.length;i++){this.insert(arr[i]);}}else if(js_cols.typeOf(col)=="object")for(var key in col){this.insert(col[key]);}};js_cols.RedBlackSet.prototype.removeAll=function(col){if(js_cols.typeOf(col)=="array")for(var i=0;i<col.length;i++){this.remove(col[i]);}else if(js_cols.typeOf(col.forEach)=="function")col.forEach(this.removeSwapped,this);else if(js_cols.typeOf(col.getValues)=="function"){var arr=col.getValues();for(var i=0;i<arr.length;i++){this.remove(arr[i]);}}else if(js_cols.typeOf(col)=="object")for(var key in col){this.remove(col[key]);}};js_cols.RedBlackSet.prototype.containsAll=function(col){if(js_cols.typeOf(col)=="array"){for(var i=0;i<col.length;i++){if(!this.contains(col[i]))return false;}return true;}else if(js_cols.typeOf(col.forEach)=="function")return col.every(this.contains,this);else if(js_cols.typeOf(col.getValues)=="function"){var arr=col.getValues();for(var i=0;i<arr.length;i++){if(!this.contains(arr[i]))return false;}return true;}else if(js_cols.typeOf(col)=="object"){for(var key in col){if(!this.contains(col[key]))return false;}return true;}};js_cols.RedBlackSet.prototype.range=function(from,to){var retArray=[];this.traverseFromTo(function(x){retArray.push(x);},from,to);return retArray;};js_cols.RedBlackSet.prototype.traverse=function(f,opt_obj){if(this.isEmpty())return;var node=this.min(this.root);while(node!=this.sentinel){if(f.call(opt_obj,node.key,this))return;node=this.successor_(node);}};js_cols.RedBlackSet.prototype.traverseFrom=function(f,fromKey,opt_obj){if(this.isEmpty())return;var node=this.get_(fromKey);while(node!=this.sentinel){if(f.call(opt_obj,node.key,this))return;node=this.successor_(node);}};js_cols.RedBlackSet.prototype.traverseTo=function(f,toKey,opt_obj){if(this.isEmpty())return;var node=this.min(this.root);var toNode=this.get_(toKey);while(node!=toNode){if(f.call(opt_obj,node.key,this))return;node=this.successor_(node);}};js_cols.RedBlackSet.prototype.traverseFromTo=function(f,fromKey,toKey,opt_obj){if(this.isEmpty())return;var node=this.get_(fromKey);var toNode=this.get_(toKey);while(node!=toNode){if(f.call(opt_obj,node.key,this))return;node=this.successor_(node);}};js_cols.RedBlackSet.prototype.traverseBackwards=function(f,opt_obj){if(this.isEmpty())return;var node=this.max(this.root);while(node!=this.sentinel){if(f.call(opt_obj,node.key,this))return;node=this.predeccessor_(node);}};js_cols.RedBlackSet.prototype.forEach=function(f,opt_obj){if(this.isEmpty())return;for(var n=this.min(this.root);n!=this.sentinel;n=this.successor_(n)){f.call(opt_obj,n.key,n.key,this);}};js_cols.RedBlackSet.prototype.some=function(f,opt_obj){if(this.isEmpty())return false;for(var n=this.min(this.root);n!=this.sentinel;n=this.successor_(n)){if(f.call(opt_obj,n.key,n.key,this))return true;}return false;};js_cols.RedBlackSet.prototype.every=function(f,opt_obj){if(this.isEmpty())return false;for(var n=this.min(this.root);n!=this.sentinel;n=this.successor_(n)){if(!f.call(opt_obj,n.key,n.key,this))return false;}return true;};js_cols.RedBlackSet.prototype.map=function(f,opt_obj){var rv=[];if(this.isEmpty())return rv;for(var n=this.min(this.root);n!=this.sentinel;n=this.successor_(n)){rv.push(f.call(opt_obj,n.key,n.key,this));}return rv;};js_cols.RedBlackSet.prototype.filter=function(f,opt_obj){var rv=[];if(this.isEmpty())return rv;for(var n=this.min(this.root);n!=this.sentinel;n=this.successor_(n)){if(f.call(opt_obj,n.key,n.key,this))rv.push(n.key);}return rv;};js_cols.RedBlackSet.prototype.getCount=function(){return this.size;};js_cols.RedBlackSet.prototype.isEmpty=function(){return this.size==0;};js_cols.RedBlackSet.prototype.isSubsetOf=function(col){var colCount=js_cols.getCount(col);if(this.getCount()>colCount)return false;var i=0;if(this.isEmpty())return true;for(var n=this.min(this.root);n!=this.sentinel;n=this.successor_(n)){if(js_cols.contains.call(col,col,n.key))i++;}return i==this.getCount();};js_cols.RedBlackSet.prototype.intersection=function(col){var result=new js_cols.RedBlackSet(this.compare);if(this.isEmpty())return result;for(var n=this.min(this.root);n!=this.sentinel;n=this.successor_(n)){if(col.contains.call(col,n.key,n.key,this))result.insert(n.key);}return result;};_C28.RedBlackSet=/*#__PURE__*/function(_C28$DefendedBase){_inherits(RedBlackSet,_C28$DefendedBase);function RedBlackSet(sortFunc){var _this9;_classCallCheck(this,RedBlackSet);_this9=_possibleConstructorReturn(this,_getPrototypeOf(RedBlackSet).call(this));_this9._rbSet=new js_cols.RedBlackSet(sortFunc);_this9._enableQueue=false;_this9._queueInsert=new Set();_this9._queueRemove=new Set();return _this9;}_createClass(RedBlackSet,[{key:"Add",value:function Add(item){if(this._enableQueue){if(this._rbSet.contains(item))this._queueRemove["delete"](item);else this._queueInsert.add(item);}else this._rbSet.insert(item);}},{key:"Remove",value:function Remove(item){if(this._enableQueue){if(this._rbSet.contains(item))this._queueRemove.add(item);else this._queueInsert["delete"](item);}else this._rbSet.remove(item);}},{key:"Has",value:function Has(item){if(this._enableQueue){if(this._queueInsert.has(item))return true;return!this._queueRemove.has(item)&&this._rbSet.contains(item);}else return this._rbSet.contains(item);}},{key:"Clear",value:function Clear(){this._rbSet.clear();this._queueInsert.clear();this._queueRemove.clear();}},{key:"toArray",value:function toArray(){if(this._enableQueue)throw new Error("cannot be used in queueing mode");return this._rbSet.getValues();}},{key:"GetSize",value:function GetSize(){return this._rbSet.getCount()+this._queueInsert.size-this._queueRemove.size;}},{key:"IsEmpty",value:function IsEmpty(){return this.GetSize()===0;}},{key:"Front",value:function Front(){if(this.IsEmpty())throw new Error("empty set");if(this._enableQueue)throw new Error("cannot be used in queueing mode");var rbSet=this._rbSet;var n=rbSet.min(rbSet.root);return n.key;}},{key:"Shift",value:function Shift(){if(this.IsEmpty())throw new Error("empty set");if(this._enableQueue)throw new Error("cannot be used in queueing mode");var item=this.Front();this.Remove(item);return item;}},{key:"SetQueueingEnabled",value:function SetQueueingEnabled(q){q=!!q;if(this._enableQueue===q)return;this._enableQueue=q;if(!q){var _iteratorNormalCompletion47=true;var _didIteratorError47=false;var _iteratorError47=undefined;try{for(var _iterator47=this._queueRemove[Symbol.iterator](),_step47;!(_iteratorNormalCompletion47=(_step47=_iterator47.next()).done);_iteratorNormalCompletion47=true){var item=_step47.value;this._rbSet.remove(item);}}catch(err){_didIteratorError47=true;_iteratorError47=err;}finally{try{if(!_iteratorNormalCompletion47&&_iterator47["return"]!=null){_iterator47["return"]();}}finally{if(_didIteratorError47){throw _iteratorError47;}}}this._queueRemove.clear();var _iteratorNormalCompletion48=true;var _didIteratorError48=false;var _iteratorError48=undefined;try{for(var _iterator48=this._queueInsert[Symbol.iterator](),_step48;!(_iteratorNormalCompletion48=(_step48=_iterator48.next()).done);_iteratorNormalCompletion48=true){var _item=_step48.value;this._rbSet.insert(_item);}}catch(err){_didIteratorError48=true;_iteratorError48=err;}finally{try{if(!_iteratorNormalCompletion48&&_iterator48["return"]!=null){_iterator48["return"]();}}finally{if(_didIteratorError48){throw _iteratorError48;}}}this._queueInsert.clear();}}},{key:"ForEach",value:function ForEach(func){this._rbSet.forEach(func);}},{key:"values",value:/*#__PURE__*/regeneratorRuntime.mark(function values(){var rbSet,n;return regeneratorRuntime.wrap(function values$(_context34){while(1){switch(_context34.prev=_context34.next){case 0:if(!this.IsEmpty()){_context34.next=2;break;}return _context34.abrupt("return");case 2:rbSet=this._rbSet;n=rbSet.min(rbSet.root);case 4:if(!(n!=rbSet.sentinel)){_context34.next=10;break;}_context34.next=7;return n.key;case 7:n=rbSet.successor_(n);_context34.next=4;break;case 10:case"end":return _context34.stop();}}},values,this);})},{key:Symbol.iterator,value:function value(){return this.values();}}]);return RedBlackSet;}(_C28.DefendedBase);}// ../lib/util/promiseThrottle.js
{'use strict';var _C29=self.C3;_C29.PromiseThrottle=/*#__PURE__*/function(){function PromiseThrottle(){var maxParallel=arguments.length>0&&arguments[0]!==undefined?arguments[0]:_C29.hardwareConcurrency;_classCallCheck(this,PromiseThrottle);this._maxParallel=maxParallel;this._queue=[];this._activeCount=0;}_createClass(PromiseThrottle,[{key:"Add",value:function Add(func){var _this10=this;return new Promise(function(resolve,reject){_this10._queue.push({func:func,resolve:resolve,reject:reject});_this10._MaybeStartNext();});}},{key:"_FindInQueue",value:function _FindInQueue(func){for(var i=0,len=this._queue.length;i<len;++i){if(this._queue[i].func===func)return i;}return-1;}},{key:"RemoveAndResolve",value:function RemoveAndResolve(func,value){var i=this._FindInQueue(func);if(i===-1)throw new Error("cannot find promise to resolve");this._queue[i].resolve(value);this._queue.splice(i,1);}},{key:"RemoveAndReject",value:function RemoveAndReject(func,value){var i=this._FindInQueue(func);if(i===-1)throw new Error("cannot find promise to reject");this._queue[i].reject(value);this._queue.splice(i,1);}},{key:"_MaybeStartNext",value:function _MaybeStartNext(){var job,result;return regeneratorRuntime.async(function _MaybeStartNext$(_context35){while(1){switch(_context35.prev=_context35.next){case 0:if(this._queue.length){_context35.next=2;break;}return _context35.abrupt("return");case 2:if(!(this._activeCount>=this._maxParallel)){_context35.next=4;break;}return _context35.abrupt("return");case 4:this._activeCount++;job=this._queue.shift();_context35.prev=6;_context35.next=9;return regeneratorRuntime.awrap(job.func());case 9:result=_context35.sent;job.resolve(result);_context35.next=16;break;case 13:_context35.prev=13;_context35.t0=_context35["catch"](6);job.reject(_context35.t0);case 16:this._activeCount--;this._MaybeStartNext();case 18:case"end":return _context35.stop();}}},null,this,[[6,13]]);}}],[{key:"Batch",value:function Batch(concurrency,methods){var results,failed,execute,promises;return regeneratorRuntime.async(function Batch$(_context37){while(1){switch(_context37.prev=_context37.next){case 0:results=[];failed=false;execute=function execute(_){var fn;return regeneratorRuntime.async(function execute$(_context36){while(1){switch(_context36.prev=_context36.next){case 0:if(!(fn=methods.pop())){_context36.next=17;break;}if(!failed){_context36.next=3;break;}return _context36.abrupt("return");case 3:_context36.prev=3;_context36.t0=results;_context36.next=7;return regeneratorRuntime.awrap(fn());case 7:_context36.t1=_context36.sent;_context36.t0.push.call(_context36.t0,_context36.t1);_context36.next=15;break;case 11:_context36.prev=11;_context36.t2=_context36["catch"](3);failed=true;throw _context36.t2;case 15:_context36.next=0;break;case 17:case"end":return _context36.stop();}}},null,null,[[3,11]]);};promises=[];while(concurrency--){promises.push(execute());}_context37.next=7;return regeneratorRuntime.awrap(Promise.all(promises));case 7:return _context37.abrupt("return",results);case 8:case"end":return _context37.stop();}}});}}]);return PromiseThrottle;}();}// ../lib/util/rateLimiter.js
{'use strict';var _C30=self.C3;_C30.RateLimiter=/*#__PURE__*/function(){function RateLimiter(callback,interval,intervalOnBattery){var _this11=this;_classCallCheck(this,RateLimiter);this._callback=callback;this._interval=interval;this._intervalOnBattery=intervalOnBattery||interval*2;this._timerId=-1;this._lastCallTime=-Infinity;this._timerCallFunc=function(){return _this11._OnTimer();};this._ignoreReset=false;this._canRunImmediate=false;this._callbackArguments=null;}_createClass(RateLimiter,[{key:"SetCanRunImmediate",value:function SetCanRunImmediate(c){this._canRunImmediate=!!c;}},{key:"_GetInterval",value:function _GetInterval(){if(typeof _C30.Battery!=="undefined"&&_C30.Battery.IsOnBatteryPower())return this._intervalOnBattery;else return this._interval;}},{key:"Call",value:function Call(){if(this._timerId!==-1)return;for(var _len28=arguments.length,args=new Array(_len28),_key22=0;_key22<_len28;_key22++){args[_key22]=arguments[_key22];}this._callbackArguments=args;var nowTime=_C30.FastGetDateNow();var timeSinceLastCall=nowTime-this._lastCallTime;var interval=this._GetInterval();if(timeSinceLastCall>=interval&&this._canRunImmediate){this._lastCallTime=nowTime;this._RunCallback();}else this._timerId=self.setTimeout(this._timerCallFunc,Math.max(interval-timeSinceLastCall,4));}},{key:"_RunCallback",value:function _RunCallback(){this._ignoreReset=true;var args=this._callbackArguments;this._callbackArguments=null;if(args)this._callback.apply(this,_toConsumableArray(args));else this._callback();this._ignoreReset=false;}},{key:"Reset",value:function Reset(){if(this._ignoreReset)return;this._CancelTimer();this._callbackArguments=null;this._lastCallTime=_C30.FastGetDateNow();}},{key:"_OnTimer",value:function _OnTimer(){this._timerId=-1;this._lastCallTime=_C30.FastGetDateNow();this._RunCallback();}},{key:"_CancelTimer",value:function _CancelTimer(){if(this._timerId!==-1){self.clearTimeout(this._timerId);this._timerId=-1;}}},{key:"Release",value:function Release(){this._CancelTimer();this._callback=null;this._callbackArguments=null;this._timerCallFunc=null;}}]);return RateLimiter;}();}// ../lib/util/svgRaster/svgRasterManager.js
{'use strict';var _C31=self.C3;_C31.SVGRasterManager=/*#__PURE__*/function(){function SVGRasterManager(){_classCallCheck(this,SVGRasterManager);this._images=new Map();this._allowNpotSurfaces=false;this._getBaseSizeCallback=null;this._rasterAtSizeCallback=null;this._releaseResultCallback=null;this._redrawCallback=null;}_createClass(SVGRasterManager,[{key:"SetNpotSurfaceAllowed",value:function SetNpotSurfaceAllowed(a){this._allowNpotSurfaces=!!a;}},{key:"IsNpotSurfaceAllowed",value:function IsNpotSurfaceAllowed(){return this._allowNpotSurfaces;}},{key:"SetGetBaseSizeCallback",value:function SetGetBaseSizeCallback(f){this._getBaseSizeCallback=f;}},{key:"GetBaseSize",value:function GetBaseSize(dataSource){if(!this._getBaseSizeCallback)throw new Error("no get base size callback set");return this._getBaseSizeCallback(dataSource);}},{key:"SetRasterAtSizeCallback",value:function SetRasterAtSizeCallback(f){this._rasterAtSizeCallback=f;}},{key:"RasterAtSize",value:function RasterAtSize(dataSource,context,surfaceWidth,surfaceHeight,imageWidth,imageHeight){if(!this._rasterAtSizeCallback)throw new Error("no raster at size callback set");return this._rasterAtSizeCallback(dataSource,context,surfaceWidth,surfaceHeight,imageWidth,imageHeight);}},{key:"SetReleaseResultCallback",value:function SetReleaseResultCallback(f){this._releaseResultCallback=f;}},{key:"ReleaseResult",value:function ReleaseResult(rasterizedResult){if(!this._releaseResultCallback)throw new Error("no release result callback set");this._releaseResultCallback(rasterizedResult);}},{key:"SetRedrawCallback",value:function SetRedrawCallback(f){this._redrawCallback=f;}},{key:"Redraw",value:function Redraw(){if(!this._redrawCallback)throw new Error("no redraw callback set");this._redrawCallback();}},{key:"AddImage",value:function AddImage(dataSource){var ret=this._images.get(dataSource);if(!ret){ret=_C31.New(_C31.SVGRasterImage,this,dataSource);this._images.set(dataSource,ret);}ret.IncReference();return ret;}},{key:"_RemoveImage",value:function _RemoveImage(ri){this._images["delete"](ri.GetDataSource());}},{key:"OnTexturesChanged",value:function OnTexturesChanged(){var _iteratorNormalCompletion49=true;var _didIteratorError49=false;var _iteratorError49=undefined;try{for(var _iterator49=this._images.values()[Symbol.iterator](),_step49;!(_iteratorNormalCompletion49=(_step49=_iterator49.next()).done);_iteratorNormalCompletion49=true){var ri=_step49.value;ri.ReleaseRasterizedResult();ri.ForceRasterAgain();}}catch(err){_didIteratorError49=true;_iteratorError49=err;}finally{try{if(!_iteratorNormalCompletion49&&_iterator49["return"]!=null){_iterator49["return"]();}}finally{if(_didIteratorError49){throw _iteratorError49;}}}}}]);return SVGRasterManager;}();}// ../lib/util/svgRaster/svgRasterImage.js
{'use strict';var _C32=self.C3;var MAX_SURFACE_SIZE=4096;_C32.SVGRasterImage=/*#__PURE__*/function(){function SVGRasterImage(manager,dataSource){var _this12=this;_classCallCheck(this,SVGRasterImage);this._manager=manager;this._dataSource=dataSource;this._refCount=0;this._baseWidth=0;this._baseHeight=0;this._getBaseSizePromise=this._manager.GetBaseSize(dataSource).then(function(baseSize){if(!_this12._manager)return;_this12._baseWidth=baseSize[0];_this12._baseHeight=baseSize[1];_this12._manager.Redraw();})["catch"](function(err){console.error("[SVG] Error loading SVG: ",err);_this12._hadError=true;if(_this12._manager)_this12._manager.Redraw();});this._rasterSurfaceWidth=0;this._rasterSurfaceHeight=0;this._rasterImageWidth=0;this._rasterImageHeight=0;this._isRasterizing=false;this._rasterizedResult=null;this._forceRaster=false;this._hadError=false;}_createClass(SVGRasterImage,[{key:"Release",value:function Release(){if(this._refCount<=0)throw new Error("already released");this._refCount--;if(this._refCount===0)this._Release();}},{key:"ReleaseRasterizedResult",value:function ReleaseRasterizedResult(){if(this._rasterizedResult){this._manager.ReleaseResult(this._rasterizedResult);this._rasterizedResult=null;}}},{key:"_Release",value:function _Release(){this.ReleaseRasterizedResult();this._manager._RemoveImage(this);this._manager=null;}},{key:"GetDataSource",value:function GetDataSource(){return this._dataSource;}},{key:"IncReference",value:function IncReference(){this._refCount++;}},{key:"HasReferences",value:function HasReferences(){return this._refCount>0;}},{key:"GetRasterizedResult",value:function GetRasterizedResult(){return this._rasterizedResult;}},{key:"ForceRasterAgain",value:function ForceRasterAgain(){this._forceRaster=true;}},{key:"StartRasterForSize",value:function StartRasterForSize(context,width,height){var rasterSurfaceWidth,rasterSurfaceHeight,maxDim,scale,imageAspectRatio,surfaceAspectRatio,newRasterizedResult;return regeneratorRuntime.async(function StartRasterForSize$(_context38){while(1){switch(_context38.prev=_context38.next){case 0:if(!(width===0||height===0||this._hadError)){_context38.next=2;break;}return _context38.abrupt("return");case 2:if(!this._isRasterizing){_context38.next=4;break;}return _context38.abrupt("return");case 4:rasterSurfaceWidth=_C32.nextHighestPowerOfTwo(Math.ceil(width));rasterSurfaceHeight=_C32.nextHighestPowerOfTwo(Math.ceil(height));maxDim=Math.max(rasterSurfaceWidth,rasterSurfaceHeight);if(maxDim>MAX_SURFACE_SIZE){scale=MAX_SURFACE_SIZE/maxDim;width*=scale;height*=scale;rasterSurfaceWidth=Math.min(Math.ceil(rasterSurfaceWidth*scale),MAX_SURFACE_SIZE);rasterSurfaceHeight=Math.min(Math.ceil(rasterSurfaceHeight*scale),MAX_SURFACE_SIZE);}if(width<rasterSurfaceWidth&&height<rasterSurfaceHeight){imageAspectRatio=width/height;surfaceAspectRatio=rasterSurfaceWidth/rasterSurfaceHeight;if(surfaceAspectRatio>imageAspectRatio){width=rasterSurfaceHeight*imageAspectRatio;height=rasterSurfaceHeight;}else{width=rasterSurfaceWidth;height=rasterSurfaceWidth/imageAspectRatio;}}if(this._manager.IsNpotSurfaceAllowed()){rasterSurfaceWidth=Math.ceil(width);rasterSurfaceHeight=Math.ceil(height);}if(!(rasterSurfaceWidth<=this._rasterSurfaceWidth&&rasterSurfaceHeight<=this._rasterSurfaceHeight&&!this._forceRaster)){_context38.next=12;break;}return _context38.abrupt("return");case 12:this._isRasterizing=true;this._rasterSurfaceWidth=rasterSurfaceWidth;this._rasterSurfaceHeight=rasterSurfaceHeight;_context38.next=17;return regeneratorRuntime.awrap(this._manager.RasterAtSize(this._dataSource,context,this._rasterSurfaceWidth,this._rasterSurfaceHeight,width,height));case 17:newRasterizedResult=_context38.sent;if(this._manager){_context38.next=20;break;}return _context38.abrupt("return");case 20:this.ReleaseRasterizedResult();this._rasterizedResult=newRasterizedResult;this._rasterImageWidth=width;this._rasterImageHeight=height;this._isRasterizing=false;this._forceRaster=false;this._manager.Redraw();case 27:case"end":return _context38.stop();}}},null,this);}},{key:"WhenBaseSizeReady",value:function WhenBaseSizeReady(){return this._getBaseSizePromise;}},{key:"GetBaseWidth",value:function GetBaseWidth(){return this._baseWidth;}},{key:"GetBaseHeight",value:function GetBaseHeight(){return this._baseHeight;}},{key:"GetRasterWidth",value:function GetRasterWidth(){return this._rasterImageWidth;}},{key:"GetRasterHeight",value:function GetRasterHeight(){return this._rasterImageHeight;}},{key:"HadError",value:function HadError(){return this._hadError;}}]);return SVGRasterImage;}();}// ../lib/str/str.js
{var lookupHtmlEntity=function lookupHtmlEntity(s){return HTML_ENTITY_MAP.get(s);};'use strict';var _C33=self.C3;_C33.UTF8_BOM="\uFEFF";var NUMERIC_CHARS=new Set(_toConsumableArray("0123456789"));_C33.IsNumericChar=function IsNumericChar(c){return NUMERIC_CHARS.has(c);};var WHITESPACE_CHARS=new Set(_toConsumableArray(" \t\n\r\xA0\x85\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200A\u200B\u2028\u2029\u202F\u205F\u3000"));_C33.IsWhitespaceChar=function IsWhitespaceChar(c){return WHITESPACE_CHARS.has(c);};_C33.FilterWhitespace=function FilterWhitespace(str){return _toConsumableArray(str).filter(function(ch){return!_C33.IsWhitespaceChar(ch);}).join("");};_C33.IsStringAllWhitespace=function IsStringAllWhitespace(str){var _iteratorNormalCompletion50=true;var _didIteratorError50=false;var _iteratorError50=undefined;try{for(var _iterator50=str[Symbol.iterator](),_step50;!(_iteratorNormalCompletion50=(_step50=_iterator50.next()).done);_iteratorNormalCompletion50=true){var ch=_step50.value;if(!_C33.IsWhitespaceChar(ch))return false;}}catch(err){_didIteratorError50=true;_iteratorError50=err;}finally{try{if(!_iteratorNormalCompletion50&&_iterator50["return"]!=null){_iterator50["return"]();}}finally{if(_didIteratorError50){throw _iteratorError50;}}}return true;};_C33.IsCharArrayAllWhitespace=function IsStringAllWhitespace(chArr){var _iteratorNormalCompletion51=true;var _didIteratorError51=false;var _iteratorError51=undefined;try{for(var _iterator51=chArr[Symbol.iterator](),_step51;!(_iteratorNormalCompletion51=(_step51=_iterator51.next()).done);_iteratorNormalCompletion51=true){var ch=_step51.value;if(!_C33.IsWhitespaceChar(ch))return false;}}catch(err){_didIteratorError51=true;_iteratorError51=err;}finally{try{if(!_iteratorNormalCompletion51&&_iterator51["return"]!=null){_iterator51["return"]();}}finally{if(_didIteratorError51){throw _iteratorError51;}}}return true;};_C33.IsUnprintableChar=function IsUnprintableChar(c){return c.length===1&&c.charCodeAt(0)<32;};_C33.FilterUnprintableChars=function FilterUnprintableChars(str){return _toConsumableArray(str).filter(function(ch){return!_C33.IsUnprintableChar(ch);}).join("");};var NUMERIC_STRING_CHARS=new Set(_toConsumableArray("0123456789.+-e"));_C33.IsStringNumber=function IsStringNumber(str){str=str.trim();if(!str.length)return false;var firstChar=str.charAt(0);if(firstChar!=="-"&&!NUMERIC_CHARS.has(firstChar))return false;var _iteratorNormalCompletion52=true;var _didIteratorError52=false;var _iteratorError52=undefined;try{for(var _iterator52=str[Symbol.iterator](),_step52;!(_iteratorNormalCompletion52=(_step52=_iterator52.next()).done);_iteratorNormalCompletion52=true){var ch=_step52.value;if(!NUMERIC_STRING_CHARS.has(ch))return false;}}catch(err){_didIteratorError52=true;_iteratorError52=err;}finally{try{if(!_iteratorNormalCompletion52&&_iterator52["return"]!=null){_iterator52["return"]();}}finally{if(_didIteratorError52){throw _iteratorError52;}}}return true;};_C33.RemoveTrailingDigits=function RemoveTrailingDigits(str){var i=str.length;while(i>0){var prev_ch=str.charAt(i-1);if(!_C33.IsNumericChar(prev_ch))break;--i;}return str.substr(0,i);};_C33.IncrementNumberAtEndOf=function IncrementNumberAtEndOf(str){var baseStr=_C33.RemoveTrailingDigits(str);var numberStr=str.substr(baseStr.length);if(numberStr)numberStr=(parseInt(numberStr,10)+1).toString();else numberStr="2";return baseStr+numberStr;};var HTML_ENTITY_MAP=new Map([["&","&amp;"],["<","&lt;"],[">","&gt;"],['"',"&quot;"],["'","&#39;"]]);var HTML_ENTITY_REGEX=/[&<>"']/g;_C33.EscapeHTML=function EscapeHTML(str){return str.replace(HTML_ENTITY_REGEX,lookupHtmlEntity);};_C33.EscapeJS=function EscapeJS(str){var ret=_C33.ReplaceAll(str,"\\","\\\\");ret=_C33.ReplaceAll(ret,'"','\\"');ret=_C33.ReplaceAll(ret,"\t","\\t");ret=_C33.ReplaceAll(ret,"\r","");return _C33.ReplaceAll(ret,"\n","\\n");};_C33.EscapeXML=function EscapeXML(str){var ret=_C33.ReplaceAll(str,"&","&amp;");ret=_C33.ReplaceAll(ret,"<","&lt;");ret=_C33.ReplaceAll(ret,">","&gt;");return _C33.ReplaceAll(ret,'"',"&quot;");};var ESCAPE_REGEX=/[-[\]{}()*+?.,\\^$|#\s]/g;_C33.EscapeRegex=function EscapeRegex(str){return str.replace(ESCAPE_REGEX,"\\$&");};_C33.CountCharsInString=function CountCharsInString(str,ch){var count=0;var _iteratorNormalCompletion53=true;var _didIteratorError53=false;var _iteratorError53=undefined;try{for(var _iterator53=str[Symbol.iterator](),_step53;!(_iteratorNormalCompletion53=(_step53=_iterator53.next()).done);_iteratorNormalCompletion53=true){var _c=_step53.value;if(_c===ch)++count;}}catch(err){_didIteratorError53=true;_iteratorError53=err;}finally{try{if(!_iteratorNormalCompletion53&&_iterator53["return"]!=null){_iterator53["return"]();}}finally{if(_didIteratorError53){throw _iteratorError53;}}}return count;};_C33.FindAll=function FindAll(str,find){var matchCase=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;if(!find)return[];if(!matchCase){str=str.toLowerCase();find=find.toLowerCase();}var findLen=find.length;var startIndex=0;var index=0;var ret=[];while((index=str.indexOf(find,startIndex))>-1){ret.push(index);startIndex=index+findLen;}return ret;};_C33.ReplaceAll=function ReplaceAll(str,find,replace){return str.replaceAll(find,function(){return replace;});};_C33.ReplaceAllCaseInsensitive=function ReplaceAll(str,find,replace){return str.replace(new RegExp(_C33.EscapeRegex(find),"gi"),function(){return replace;});};_C33.SetElementContent=function SetElementContent(elem,stringlike){if(typeof stringlike==="string")elem.textContent=stringlike;else if(stringlike.isPlainText())elem.textContent=stringlike.toString();else{elem.innerHTML=stringlike.toHTML();if(stringlike instanceof _C33.BBString)stringlike.attachLinkHandlers(elem);}};_C33.StringLikeEquals=function StringLikeEquals(a,b){if(a instanceof _C33.HtmlString||a instanceof _C33.BBString)return a.equals(b);else if(b instanceof _C33.HtmlString||b instanceof _C33.BBString)return b.equals(a);else return a===b;};_C33.StringSubstitute=function StringSubstitute(str){var ret=str;for(var _len29=arguments.length,arr=new Array(_len29>1?_len29-1:0),_key23=1;_key23<_len29;_key23++){arr[_key23-1]=arguments[_key23];}for(var i=0,len=arr.length;i<len;++i){var sub="{".concat(i,"}");if(!str.includes(sub))throw new Error("missing placeholder '".concat(sub,"' in string substitution"));ret=ret.replace(sub,arr[i].toString());}return ret;};_C33.StringSubstituteAllowMissing=function StringSubstituteAllowMissing(str){var ret=str;var lowestMissingIndex=-1;var highestUsedIndex=-1;for(var _len30=arguments.length,arr=new Array(_len30>1?_len30-1:0),_key24=1;_key24<_len30;_key24++){arr[_key24-1]=arguments[_key24];}for(var i=0,len=arr.length;i<len;++i){var sub="{".concat(i,"}");if(str.includes(sub)){highestUsedIndex=i;ret=ret.replace(sub,arr[i].toString());}else if(lowestMissingIndex===-1)lowestMissingIndex=i;}if(lowestMissingIndex>=0&&highestUsedIndex>=0&&lowestMissingIndex<highestUsedIndex)throw new Error("missing placeholder '".concat(lowestMissingIndex,"' in string substitution"));return ret;};_C33.StringSubstituteMap=function StringSubstituteMap(str,o){var ret=str;for(var _i29=0,_Object$entries4=Object.entries(o);_i29<_Object$entries4.length;_i29++){var _Object$entries4$_i=_slicedToArray(_Object$entries4[_i29],2),placeholder=_Object$entries4$_i[0],substitution=_Object$entries4$_i[1];ret=ret.replaceAll(placeholder,substitution.toString());}return ret;};_C33.SortAZ=function SortAZ(a,b){if(a>b)return 1;else if(a<b)return-1;else return 0;};_C33.SortAZCaseInsensitive=function SortAZCaseInsensitive(a,b){var lowerA=a.toLowerCase();var lowerB=b.toLowerCase();if(lowerA>lowerB)return 1;else if(lowerA<lowerB)return-1;else return 0;};var intlSegmenter=null;var graphemeSplitter=null;if(self["Intl"]&&self["Intl"]["Segmenter"])intlSegmenter=new self["Intl"]["Segmenter"]();else graphemeSplitter=new self.GraphemeSplitter();_C33.SplitGraphemes=function SplitGraphemes(str){if(intlSegmenter){var ret=[];var _iteratorNormalCompletion54=true;var _didIteratorError54=false;var _iteratorError54=undefined;try{for(var _iterator54=intlSegmenter["segment"](str)[Symbol.iterator](),_step54;!(_iteratorNormalCompletion54=(_step54=_iterator54.next()).done);_iteratorNormalCompletion54=true){var s=_step54.value;ret.push(s["segment"]);}}catch(err){_didIteratorError54=true;_iteratorError54=err;}finally{try{if(!_iteratorNormalCompletion54&&_iterator54["return"]!=null){_iterator54["return"]();}}finally{if(_didIteratorError54){throw _iteratorError54;}}}return ret;}else return graphemeSplitter.splitGraphemes(str);};_C33.IterateGraphemes=/*#__PURE__*/regeneratorRuntime.mark(function IterateGraphemes(str){var _iteratorNormalCompletion55,_didIteratorError55,_iteratorError55,_iterator55,_step55,s;return regeneratorRuntime.wrap(function IterateGraphemes$(_context39){while(1){switch(_context39.prev=_context39.next){case 0:if(!intlSegmenter){_context39.next=29;break;}_iteratorNormalCompletion55=true;_didIteratorError55=false;_iteratorError55=undefined;_context39.prev=4;_iterator55=intlSegmenter["segment"](str)[Symbol.iterator]();case 6:if(_iteratorNormalCompletion55=(_step55=_iterator55.next()).done){_context39.next=13;break;}s=_step55.value;_context39.next=10;return s["segment"];case 10:_iteratorNormalCompletion55=true;_context39.next=6;break;case 13:_context39.next=19;break;case 15:_context39.prev=15;_context39.t0=_context39["catch"](4);_didIteratorError55=true;_iteratorError55=_context39.t0;case 19:_context39.prev=19;_context39.prev=20;if(!_iteratorNormalCompletion55&&_iterator55["return"]!=null){_iterator55["return"]();}case 22:_context39.prev=22;if(!_didIteratorError55){_context39.next=25;break;}throw _iteratorError55;case 25:return _context39.finish(22);case 26:return _context39.finish(19);case 27:_context39.next=30;break;case 29:return _context39.delegateYield(graphemeSplitter.iterateGraphemes(str),"t1",30);case 30:case"end":return _context39.stop();}}},IterateGraphemes,null,[[4,15,19,27],[20,,22,26]]);});_C33.CountGraphemes=function CountGraphemes(str){if(intlSegmenter){var ret=0;var _iteratorNormalCompletion56=true;var _didIteratorError56=false;var _iteratorError56=undefined;try{for(var _iterator56=intlSegmenter["segment"](str)[Symbol.iterator](),_step56;!(_iteratorNormalCompletion56=(_step56=_iterator56.next()).done);_iteratorNormalCompletion56=true){var s=_step56.value;++ret;}}catch(err){_didIteratorError56=true;_iteratorError56=err;}finally{try{if(!_iteratorNormalCompletion56&&_iterator56["return"]!=null){_iterator56["return"]();}}finally{if(_didIteratorError56){throw _iteratorError56;}}}return ret;}else return graphemeSplitter.countGraphemes(str);};var KILOBYTE=1024;var MEGABYTE=KILOBYTE*1024;var GIGABYTE=MEGABYTE*1024;var TERABYTE=GIGABYTE*1024;_C33.FormatDataSize=function FormatDataSize(sizeInBytes,asRate){var rootKey="common."+(asRate?"dataRates":"dataSizes")+".";var langSub=self.langSub;if(sizeInBytes<KILOBYTE)return langSub(rootKey+"bytes",sizeInBytes);else if(sizeInBytes<MEGABYTE){var kb=sizeInBytes/KILOBYTE;if(kb<10)kb=Math.round(kb*10)/10;else kb=Math.round(kb);return langSub(rootKey+"kilobytes",kb);}else if(sizeInBytes<GIGABYTE){var mb=sizeInBytes/MEGABYTE;if(mb<10)mb=Math.round(mb*10)/10;else mb=Math.round(mb);return langSub(rootKey+"megabytes",mb);}else if(sizeInBytes<TERABYTE){var gb=sizeInBytes/GIGABYTE;if(gb<10)gb=Math.round(gb*10)/10;else gb=Math.round(gb);return langSub(rootKey+"gigabytes",gb);}else{var tb=sizeInBytes/TERABYTE;if(tb<10)tb=Math.round(tb*10)/10;else tb=Math.round(tb);return langSub(rootKey+"terabytes",tb);}};var DEFAULT_FORMATTIME_OPTS={approximate:false,days:true,hours:true,minutes:true,seconds:true};_C33.FormatTime=function FormatTime(secondsTotal,opts){opts=Object.assign({},DEFAULT_FORMATTIME_OPTS,opts);_C33.Lang.PushContext("common.time");var parts=[];var lang=self.lang;var langPluralSub=self.langPluralSub;if(opts.days){var days=Math.floor(secondsTotal/(24*3600));if(days>0){secondsTotal-=days*24*3600;parts.push(langPluralSub(".days",null,days));}}if(opts.hours){var hours=Math.floor(secondsTotal/3600);if(hours>0||parts.length){secondsTotal-=hours*3600;parts.push(langPluralSub(".hours",null,hours));}}if(opts.minutes){var minutes=Math.floor(secondsTotal/60);if(minutes>0||parts.length||!opts.seconds){secondsTotal-=minutes*60;parts.push(langPluralSub(".minutes",null,minutes));}}if(opts.seconds){var seconds=Math.floor(secondsTotal%60);parts.push(langPluralSub(".seconds",null,seconds));}var ret=(opts.approximate?lang(".approx-prefix"):"")+parts.join(lang(".separator"));_C33.Lang.PopContext();return ret;};_C33.ZeroPad=function(n,d){var s=n<0?"-":"";n=Math.abs(n);var nStr=n.toString();var zeroes=d-nStr.length;for(var i=0;i<zeroes;++i){s+="0";}return s+nStr;};_C33.StringToTitleCase=function StringToTitleCase(str){return str.toLowerCase().replace(/\b\w/g,function(t){return t.toUpperCase();});};_C33.CompareVersionStrings=function CompareVersionStrings(v1,v2){var a1=v1.split(".").map(function(s){return s.trim();});var a2=v2.split(".").map(function(s){return s.trim();});_C33.resizeArray(a1,4,"0");_C33.resizeArray(a2,4,"0");a1=a1.map(function(s){return parseInt(s,10);});a2=a2.map(function(s){return parseInt(s,10);});for(var i=0;i<4;++i){var diff=a1[i]-a2[i];if(diff!==0)return diff<0?-1:1;}return 0;};_C33.CreateGUID=function CreateGUID(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(c){var r=Math.floor(Math.random()*16);var v=c==="x"?r:r&3|8;return v.toString(16);});};_C33.StringHammingDistance=function StringHammingDistance(a,b){if(a.length!==b.length)throw new Error("strings must be same length");var ret=0;for(var i=0,len=a.length;i<len;++i){if(a.charAt(i)!==b.charAt(i))++ret;}return ret;};_C33.StringLevenshteinDistance=function StringLevenshteinDistance(a,b){if(a.length===0)return b.length;if(b.length===0)return a.length;var tmp,i,j,prev,val,row;if(a.length>b.length){tmp=a;a=b;b=tmp;}row=Array(a.length+1);for(i=0;i<=a.length;i++){row[i]=i;}for(i=1;i<=b.length;i++){prev=i;for(j=1;j<=a.length;j++){if(b[i-1]===a[j-1])val=row[j-1];else val=Math.min(row[j-1]+1,Math.min(prev+1,row[j]+1));row[j-1]=prev;prev=val;}row[a.length]=prev;}return row[a.length];};}// ../lib/str/bbstring.js
{var bbToHtmlReplacerFunc=function bbToHtmlReplacerFunc(match,closeSlash,tagName){var entry=BB_CODE_MAP.get(tagName);if(entry){if(typeof entry==="string"){if(entry==="a"&&linkActions.length===0||entry==="abbr"&&tipList.length===0)return match;if(entry==="a"&&!closeSlash){var index=parseInt(tagName.substring(1),10)-1;if(index<0||index>=linkActions.length)throw new Error("invalid bbcode link substitution");var linkAction=linkActions[index];if(typeof linkAction==="string")return"<a href=\"".concat(linkActions[index],"\">");else if(typeof linkAction==="function")return"<a class=\"bblink".concat(index,"\">");else throw new TypeError("invalid bbcode link action");}else if(entry==="abbr"&&!closeSlash){var _index=parseInt(tagName.substring(3),10)-1;if(_index<0||_index>=tipList.length)throw new Error("invalid bbcode tip substitution");var tip=tipList[_index];var tipStr="";if(typeof tip==="string")tipStr=tip;else if(typeof tip==="function")tipStr=tip();if(typeof tipStr!=="string")throw new TypeError("invalid bbcode tip");return"<abbr title=\"".concat(_C34.ReplaceAll(tipStr,'"',"&quot;"),"\">");}else return"<"+closeSlash+entry+">";}else if(Array.isArray(entry)){var tag=entry[0];var className=entry[1];if(closeSlash)return"</"+tag+">";else return"<".concat(tag," class=\"").concat(className,"\">");}else;}else if(tagName==="class"){if(closeSlash)return"</span>";else return"<span class=\"bbclass".concat(classIndex++,"\">");}else return match;};'use strict';var _C34=self.C3;var _assert2=self.assert;var BB_CODE_MAP=new Map([["b","strong"],["i","em"],["s","s"],["u","u"],["sub","sub"],["sup","sup"],["small","small"],["mark","mark"],["code","code"],["a1","a"],["a2","a"],["a3","a"],["a4","a"],["a5","a"],["a6","a"],["a7","a"],["a8","a"],["a9","a"],["tip1","abbr"],["tip2","abbr"],["tip3","abbr"],["tip4","abbr"],["tip5","abbr"],["tip6","abbr"],["tip7","abbr"],["tip8","abbr"],["tip9","abbr"],["bad",["span","bbCodeBad"]],["good",["span","bbCodeGood"]],["info",["span","bbCodeInfo"]],["h1",["span","bbCodeH1"]],["h2",["span","bbCodeH2"]],["h3",["span","bbCodeH3"]],["h4",["span","bbCodeH4"]],["item",["span","bbCodeItem"]]]);var SELF_CLOSING_TAGS=new Set(["icon"]);var BBREGEX=/\[(\/?)([a-zA-Z0-9]+)\]/g;var CUSTOM_BBREGEX=/\[(\/?)([^\[\n]*?)\]/g;var linkActions=null;var tipList=null;var classIndex=0;var LINEBREAK_REGEX=/\n/g;_C34.BBString=/*#__PURE__*/function(){function BBString(str,opts){_classCallCheck(this,BBString);this._bbstr=opts&&opts.noEscape?str:_C34.EscapeHTML(str);this._htmlstr="";this._convertLineBreaks=false;this._linkActions=[];this._tipList=[];if(opts){this._convertLineBreaks=!!opts.convertLineBreaks;if(opts.links){if(opts.links.length>9)throw new Error("too many links");this._linkActions=opts.links;}if(opts.tips){if(opts.tips.length>9)throw new Error("too many tips");this._tipList=opts.tips;}}this._hasAnyBBtags=this._bbstr.includes("[");this._needsLineBreakConversion=this._convertLineBreaks&&this._bbstr.includes("\n");this._isPlain=!this._hasAnyBBtags&&!this._needsLineBreakConversion&&!this._bbstr.includes("&");this._hasParsedFragments=false;this._fragments=[];}_createClass(BBString,[{key:"toString",value:function toString(){return this._bbstr;}},{key:"valueOf",value:function valueOf(){return this._bbstr;}},{key:"isPlainText",value:function isPlainText(){return this._isPlain;}},{key:"toPlainText",value:function toPlainText(){if(this._hasAnyBBtags)return this._bbstr.replace(BBREGEX,"");else return this._bbstr;}},{key:"toHTML",value:function toHTML(){if(this._isPlain)return this._bbstr;if(!this._htmlstr&&this._bbstr){var str=this._bbstr;if(this._hasAnyBBtags){classIndex=0;linkActions=this._linkActions;tipList=this._tipList;str=str.replace(BBREGEX,bbToHtmlReplacerFunc);linkActions=null;tipList=null;}if(this._needsLineBreakConversion)str=str.replace(LINEBREAK_REGEX,"<br>");this._htmlstr=str;}return this._htmlstr;}},{key:"attachLinkHandlers",value:function attachLinkHandlers(parentElem){if(!this._linkActions.length)return;for(var i=0,len=this._linkActions.length;i<len;++i){var linkAction=this._linkActions[i];if(typeof linkAction!=="function")continue;var linkElem=parentElem.querySelector(".bblink"+i);if(!linkElem)throw new Error("unable to attach BBString link handler");linkElem.onclick=linkAction;}}},{key:"equals",value:function equals(s){if(s instanceof _C34.HtmlString)return this.toHTML()===s.toHTML();else if(s instanceof _C34.BBString)return this._bbstr===s._bbstr;else return this._bbstr===s;}},{key:"toFragmentList",value:function toFragmentList(){if(this._hasParsedFragments)return this._fragments;var fragments=[];var bbStr=this._bbstr;var styleStack=[];CUSTOM_BBREGEX.lastIndex=0;var prevIndex=0;var result=null;while((result=CUSTOM_BBREGEX.exec(bbStr))!==null){var index=result.index;if(index>0&&bbStr.charAt(index-1)==="\\")continue;var matchStr=result[0];var closeSlash=result[1];var tagName=result[2];var strFrag=bbStr.substring(prevIndex,index);prevIndex=index+matchStr.length;if(strFrag)fragments.push({text:strFrag,styles:styleStack.slice(0)});if(!tagName)continue;if(closeSlash){var lowerTagName=tagName.toLowerCase();for(var i=styleStack.length-1;i>=0;--i){if(styleStack[i].tag===lowerTagName){styleStack.splice(i,1);break;}}}else{var tag=tagName;var param=null;var eq=tagName.indexOf("=");if(eq!==-1){tag=tagName.substring(0,eq).toLowerCase();param=tagName.substring(eq+1);}else tag=tag.toLowerCase();if(SELF_CLOSING_TAGS.has(tag)){if(tag==="icon")fragments.push({icon:param,styles:styleStack.slice(0)});else throw new Error("unknown self-closing tag ".concat(tag));}else styleStack.push({tag:tag,param:param});}}if(prevIndex<bbStr.length)fragments.push({text:bbStr.substring(prevIndex),styles:styleStack.slice(0)});for(var _i30=0,_fragments=fragments;_i30<_fragments.length;_i30++){var frag=_fragments[_i30];if(frag.text)frag.text=this._ProcessBBCodeEscapeSequences(frag.text);}this._fragments=fragments.map(function(frag){if(frag.icon)return _C34.New(_C34.IconFragment,{icon:frag.icon,styles:frag.styles});else return _C34.New(_C34.TextFragment,{chArr:_C34.SplitGraphemes(frag.text),styles:frag.styles});});this._hasParsedFragments=true;return this._fragments;}},{key:"_ProcessBBCodeEscapeSequences",value:function _ProcessBBCodeEscapeSequences(text){text=_C34.ReplaceAll(text,"\\[","[");return _C34.ReplaceAll(text,"\\\\","\\");}}],[{key:"StripTags",value:function StripTags(str){return _C34.New(_C34.BBString,str,{noEscape:true}).toPlainText();}},{key:"StripAnyTags",value:function StripAnyTags(str){return str.replace(CUSTOM_BBREGEX,"");}}]);return BBString;}();}// ../lib/str/textLayout/wordWrap.js
{var IsWordBreakWhiteSpace=function IsWordBreakWhiteSpace(ch){if(ch==="\xA0"||ch==="\u202F")return false;else return _C35.IsWhitespaceChar(ch);};var WordBreakTrimEnd=function WordBreakTrimEnd(chArr){while(chArr.length>0&&IsWordBreakWhiteSpace(chArr.at(-1))){chArr.pop();}};var IsNewline=function IsNewline(ch){return ch==="\n"||ch==="\r\n";};'use strict';var _C35=self.C3;_C35.WordWrap=/*#__PURE__*/function(){function WordWrap(){_classCallCheck(this,WordWrap);this._lines=[];this._iconSet=null;}_createClass(WordWrap,[{key:"GetLines",value:function GetLines(){return this._lines;}},{key:"GetLineCount",value:function GetLineCount(){return this._lines.length;}},{key:"SetIconSet",value:function SetIconSet(iconSet){this._iconSet=iconSet;}},{key:"_MeasureLine",value:function _MeasureLine(line,measureFunc){var width=0;var height=0;var fbbAscent=0;var fbbDescent=0;var topToAlphabeticDistance=0;var _iteratorNormalCompletion57=true;var _didIteratorError57=false;var _iteratorError57=undefined;try{for(var _iterator57=line[Symbol.iterator](),_step57;!(_iteratorNormalCompletion57=(_step57=_iterator57.next()).done);_iteratorNormalCompletion57=true){var frag=_step57.value;if(frag.GetWidth()===-1){var m=measureFunc(frag);frag.SetHeight(m.height);frag.SetFontBoundingBoxAscent(m.fontBoundingBoxAscent||0);frag.SetFontBoundingBoxDescent(m.fontBoundingBoxDescent||0);frag.SetTopToAlphabeticDistance(m.topToAlphabeticDistance||0);if(frag.IsText())frag.SetWidth(m.width);else if(frag.IsIcon())frag.CalculateWidthFromHeight(this._iconSet);}width+=frag.GetWidth();height=Math.max(height,frag.GetHeight());fbbAscent=Math.max(fbbAscent,frag.GetFontBoundingBoxAscent());fbbDescent=Math.max(fbbDescent,frag.GetFontBoundingBoxDescent());topToAlphabeticDistance=Math.max(topToAlphabeticDistance,frag.GetTopToAlphabeticDistance());}}catch(err){_didIteratorError57=true;_iteratorError57=err;}finally{try{if(!_iteratorNormalCompletion57&&_iterator57["return"]!=null){_iterator57["return"]();}}finally{if(_didIteratorError57){throw _iteratorError57;}}}return{width:width,height:height,fontBoundingBoxAscent:fbbAscent,fontBoundingBoxDescent:fbbDescent,topToAlphabeticDistance:topToAlphabeticDistance};}},{key:"_AddLine",value:function _AddLine(fragments,width,height,fbbAscent,fbbDescent,topToAlphabeticDistance){this._lines.push(_C35.New(_C35.WordWrap.Line,{fragments:fragments,width:width,height:height,fontBoundingBoxAscent:fbbAscent,fontBoundingBoxDescent:fbbDescent,topToAlphabeticDistance:topToAlphabeticDistance}));}},{key:"WordWrap",value:function WordWrap(fragmentArr,measureFunc,wrapWidth,wrapMode,endOfLineMargin){if(typeof fragmentArr==="string")fragmentArr=[_C35.New(_C35.TextFragment,{chArr:_C35.SplitGraphemes(fragmentArr)})];_C35.clearArray(this._lines);if(!fragmentArr.length||fragmentArr.length===1&&fragmentArr[0].IsText()&&fragmentArr[0].IsEmpty()||wrapWidth<2)return;if(fragmentArr.length===1){var frag=fragmentArr[0];if(frag.IsText()&&frag.GetLength()<=100&&!frag.HasNewLine()){var _measureFunc=measureFunc(frag),width=_measureFunc.width,height=_measureFunc.height,fontBoundingBoxAscent=_measureFunc.fontBoundingBoxAscent,fontBoundingBoxDescent=_measureFunc.fontBoundingBoxDescent,topToAlphabeticDistance=_measureFunc.topToAlphabeticDistance;width+=endOfLineMargin;frag.SetWidth(width);frag.SetHeight(height);frag.SetFontBoundingBoxAscent(fontBoundingBoxAscent||0);frag.SetFontBoundingBoxDescent(fontBoundingBoxDescent||0);frag.SetTopToAlphabeticDistance(topToAlphabeticDistance||0);if(width<=wrapWidth){this._AddLine([frag],width,height,fontBoundingBoxAscent,fontBoundingBoxDescent,topToAlphabeticDistance);return;}}}var tokenisedFragments;if(wrapMode==="word")tokenisedFragments=this._TokeniseWords(fragmentArr);else{tokenisedFragments=[];var _iteratorNormalCompletion58=true;var _didIteratorError58=false;var _iteratorError58=undefined;try{var _loop5=function _loop5(){var frag=_step58.value;if(frag.IsText()){var chArr=frag.GetCharacterArray();_C35.appendArray(tokenisedFragments,chArr.map(function(ch){return[_C35.New(_C35.TextFragment,{chArr:[ch],styles:frag.GetStyles()})];}));}else tokenisedFragments.push([frag]);};for(var _iterator58=fragmentArr[Symbol.iterator](),_step58;!(_iteratorNormalCompletion58=(_step58=_iterator58.next()).done);_iteratorNormalCompletion58=true){_loop5();}}catch(err){_didIteratorError58=true;_iteratorError58=err;}finally{try{if(!_iteratorNormalCompletion58&&_iterator58["return"]!=null){_iterator58["return"]();}}finally{if(_didIteratorError58){throw _iteratorError58;}}}}this._WrapText(tokenisedFragments,measureFunc,wrapWidth,endOfLineMargin);}},{key:"_TokeniseWords",value:function _TokeniseWords(fragmentArr){var ret=[];var curWord=[];var isCurWhitespace=false;var _iteratorNormalCompletion59=true;var _didIteratorError59=false;var _iteratorError59=undefined;try{for(var _iterator59=fragmentArr[Symbol.iterator](),_step59;!(_iteratorNormalCompletion59=(_step59=_iterator59.next()).done);_iteratorNormalCompletion59=true){var frag=_step59.value;var styles=frag.GetStyles();if(frag.IsIcon()){if(curWord.length>0)ret.push(curWord);ret.push([frag]);curWord=[];continue;}var _iteratorNormalCompletion60=true;var _didIteratorError60=false;var _iteratorError60=undefined;try{for(var _iterator60=frag.GetCharacterArray()[Symbol.iterator](),_step60;!(_iteratorNormalCompletion60=(_step60=_iterator60.next()).done);_iteratorNormalCompletion60=true){var ch=_step60.value;if(IsNewline(ch)){if(curWord.length>0)ret.push(curWord);var newlineFrag=_C35.New(_C35.TextFragment,{chArr:["\n"],styles:styles});ret.push([newlineFrag]);curWord=[];}else if(curWord.length===0){var newFrag=_C35.New(_C35.TextFragment,{chArr:[ch],styles:styles});curWord.push(newFrag);isCurWhitespace=IsWordBreakWhiteSpace(ch);}else{var isWhitespace=IsWordBreakWhiteSpace(ch);if(isWhitespace===isCurWhitespace){var curFrag=curWord.at(-1);if(curFrag.GetStyles()===styles)curFrag._AppendChar(ch);else{var _newFrag=_C35.New(_C35.TextFragment,{chArr:[ch],styles:styles});curWord.push(_newFrag);}}else{ret.push(curWord);curWord=[];var _newFrag2=_C35.New(_C35.TextFragment,{chArr:[ch],styles:styles});curWord.push(_newFrag2);isCurWhitespace=isWhitespace;}}}}catch(err){_didIteratorError60=true;_iteratorError60=err;}finally{try{if(!_iteratorNormalCompletion60&&_iterator60["return"]!=null){_iterator60["return"]();}}finally{if(_didIteratorError60){throw _iteratorError60;}}}}}catch(err){_didIteratorError59=true;_iteratorError59=err;}finally{try{if(!_iteratorNormalCompletion59&&_iterator59["return"]!=null){_iterator59["return"]();}}finally{if(_didIteratorError59){throw _iteratorError59;}}}if(curWord.length>0)ret.push(curWord);return ret;}},{key:"_CopyLine",value:function _CopyLine(line){return line.map(function(f){return f._Clone();});}},{key:"_AddWordToLine",value:function _AddWordToLine(currentLine,curWord){var lastFrag=currentLine.length?currentLine.at(-1):null;var i=0;if(lastFrag&&lastFrag.IsText()&&curWord[0].IsText()&&curWord[0].GetStyles()===lastFrag.GetStyles()){lastFrag._Append(curWord[0].GetCharacterArray());i=1;}for(var len=curWord.length;i<len;++i){var f=curWord[i];currentLine.push(f._Clone());}}},{key:"_WrapText",value:function _WrapText(tokenisedFragments,measureFunc,wrapWidth,endOfLineMargin){var currentLine=[];var currentLineWidth=0;var currentLineHeight=0;var currentLineFbbAscent=0;var currentLineFbbDescent=0;var currentLineTopToAlphabetic=0;var _iteratorNormalCompletion61=true;var _didIteratorError61=false;var _iteratorError61=undefined;try{for(var _iterator61=tokenisedFragments[Symbol.iterator](),_step61;!(_iteratorNormalCompletion61=(_step61=_iterator61.next()).done);_iteratorNormalCompletion61=true){var curWord=_step61.value;if(curWord.length===1&&curWord[0].IsText()&&curWord[0].GetLength()===1&&IsNewline(curWord[0].GetCharacterArray()[0])){if(currentLineHeight===0){var tempFrag=_C35.New(_C35.TextFragment,{chArr:[" "],styles:curWord[0].GetStyles()});var m=measureFunc(tempFrag);currentLineHeight=m.height;currentLineFbbAscent=m.fontBoundingBoxAscent||0;currentLineFbbDescent=m.fontBoundingBoxDescent||0;currentLineTopToAlphabetic=m.topToAlphabeticDistance||0;}this._AddLine(currentLine,currentLineWidth,currentLineHeight,currentLineFbbAscent,currentLineFbbDescent,currentLineTopToAlphabetic);currentLine=[];currentLineWidth=0;currentLineHeight=0;currentLineFbbAscent=0;currentLineFbbDescent=0;currentLineTopToAlphabetic=0;continue;}var tryLine=this._CopyLine(currentLine);this._AddWordToLine(tryLine,curWord);var tryMetrics=this._MeasureLine(tryLine,measureFunc);var tryLineWidth=tryMetrics.width;if(tryLineWidth>=wrapWidth){if(currentLine.length>0)this._AddLine(currentLine,currentLineWidth,currentLineHeight,currentLineFbbAscent,currentLineFbbDescent,currentLineTopToAlphabetic);currentLine=[];if(curWord[0].IsText()&&_C35.IsCharArrayAllWhitespace(curWord[0].GetCharacterArray())){currentLineWidth=0;currentLineHeight=0;currentLineFbbAscent=0;currentLineFbbDescent=0;currentLineTopToAlphabetic=0;}else{this._AddWordToLine(currentLine,curWord);var metrics=this._MeasureLine(currentLine,measureFunc);currentLineWidth=metrics.width;currentLineHeight=metrics.height;currentLineFbbAscent=metrics.fontBoundingBoxAscent;currentLineFbbDescent=metrics.fontBoundingBoxDescent;currentLineTopToAlphabetic=metrics.topToAlphabeticDistance;}}else{currentLine=tryLine;currentLineWidth=tryLineWidth;currentLineHeight=tryMetrics.height;currentLineFbbAscent=tryMetrics.fontBoundingBoxAscent;currentLineFbbDescent=tryMetrics.fontBoundingBoxDescent;currentLineTopToAlphabetic=tryMetrics.topToAlphabeticDistance;}}}catch(err){_didIteratorError61=true;_iteratorError61=err;}finally{try{if(!_iteratorNormalCompletion61&&_iterator61["return"]!=null){_iterator61["return"]();}}finally{if(_didIteratorError61){throw _iteratorError61;}}}if(currentLine.length>0)this._AddLine(currentLine,currentLineWidth,currentLineHeight,currentLineFbbAscent,currentLineFbbDescent,currentLineTopToAlphabetic);this._TrimLinesTrailingWhitespace(measureFunc,endOfLineMargin);}},{key:"_TrimLinesTrailingWhitespace",value:function _TrimLinesTrailingWhitespace(measureFunc,endOfLineMargin){var _iteratorNormalCompletion62=true;var _didIteratorError62=false;var _iteratorError62=undefined;try{for(var _iterator62=this._lines[Symbol.iterator](),_step62;!(_iteratorNormalCompletion62=(_step62=_iterator62.next()).done);_iteratorNormalCompletion62=true){var line=_step62.value;var fragments=line._GetFragmentsArray();if(!fragments.length)continue;var lastFrag=fragments.at(-1);if(lastFrag.IsText()){var chArr=lastFrag.GetCharacterArray();var trimmedArr=chArr.slice(0);WordBreakTrimEnd(trimmedArr);if(trimmedArr.length===0){line.OffsetWidth(-lastFrag.GetWidth());fragments.pop();}else if(trimmedArr.length<chArr.length){lastFrag.SetCharacterArray(trimmedArr);var trimmedWidth=measureFunc(lastFrag).width;var diff=lastFrag.GetWidth()-trimmedWidth;lastFrag.SetWidth(trimmedWidth);line.OffsetWidth(-diff);}if(endOfLineMargin!==0&&fragments.length>0){lastFrag=fragments.at(-1);lastFrag.OffsetWidth(endOfLineMargin);line.OffsetWidth(endOfLineMargin);}}}}catch(err){_didIteratorError62=true;_iteratorError62=err;}finally{try{if(!_iteratorNormalCompletion62&&_iterator62["return"]!=null){_iterator62["return"]();}}finally{if(_didIteratorError62){throw _iteratorError62;}}}}},{key:"Clear",value:function Clear(){_C35.clearArray(this._lines);}},{key:"GetMaxLineWidth",value:function GetMaxLineWidth(){return this._lines.reduce(function(a,v){return Math.max(a,v.GetWidth());},0);}},{key:"GetTotalLineHeight",value:function GetTotalLineHeight(){return this._lines.reduce(function(a,v){return a+v.GetHeight();},0);}}]);return WordWrap;}();}// ../lib/str/textLayout/line.js
{'use strict';var _C36=self.C3;_C36.WordWrap.Line=/*#__PURE__*/function(){function WordWrapLine(opts){_classCallCheck(this,WordWrapLine);this._fragments=opts.fragments||[];this._width=opts.width||-1;this._height=opts.height||-1;this._fontBoundingBoxAscent=opts.fontBoundingBoxAscent||-1;this._fontBoundingBoxDescent=opts.fontBoundingBoxDescent||-1;this._topToAlphabeticDistance=opts.topToAlphabeticDistance||-1;this._posX=0;this._posY=0;}_createClass(WordWrapLine,[{key:"fragments",value:function fragments(){return this._fragments.values();}},{key:"fragmentsReverse",value:/*#__PURE__*/regeneratorRuntime.mark(function fragmentsReverse(){var fragments,i;return regeneratorRuntime.wrap(function fragmentsReverse$(_context40){while(1){switch(_context40.prev=_context40.next){case 0:fragments=this._fragments;i=fragments.length-1;case 2:if(!(i>=0)){_context40.next=8;break;}_context40.next=5;return fragments[i];case 5:--i;_context40.next=2;break;case 8:case"end":return _context40.stop();}}},fragmentsReverse,this);})},{key:"_GetFragmentsArray",value:function _GetFragmentsArray(){return this._fragments;}},{key:"OffsetWidth",value:function OffsetWidth(w){this._width+=w;}},{key:"GetWidth",value:function GetWidth(){return this._width;}},{key:"GetHeight",value:function GetHeight(){return this._height;}},{key:"GetFoundBoundingBoxAscent",value:function GetFoundBoundingBoxAscent(){return this._fontBoundingBoxAscent;}},{key:"GetFontBoundingBoxDescent",value:function GetFontBoundingBoxDescent(){return this._fontBoundingBoxDescent;}},{key:"GetTopToAlphabeticDistance",value:function GetTopToAlphabeticDistance(){return this._topToAlphabeticDistance;}},{key:"SetPosX",value:function SetPosX(x){this._posX=x;}},{key:"GetPosX",value:function GetPosX(){return this._posX;}},{key:"SetPosY",value:function SetPosY(y){this._posY=y;}},{key:"GetPosY",value:function GetPosY(){return this._posY;}}]);return WordWrapLine;}();}// ../lib/str/textLayout/fragmentBase.js
{'use strict';var _C37=self.C3;_C37.FragmentBase=/*#__PURE__*/function(){function FragmentBase(opts){_classCallCheck(this,FragmentBase);this._styles=opts.styles||[];this._width=opts.width||-1;this._height=opts.height||-1;this._fontBoundingBoxAscent=opts.fontBoundingBoxAscent||-1;this._fontBoundingBoxDescent=opts.fontBoundingBoxDescent||-1;this._topToAlphabeticDistance=opts.topToAlphabeticDistance||-1;this._posX=0;this._posY=0;}_createClass(FragmentBase,[{key:"IsText",value:function IsText(){return false;}},{key:"IsIcon",value:function IsIcon(){return false;}},{key:"GetStyles",value:function GetStyles(){return this._styles;}},{key:"GetStyleTag",value:function GetStyleTag(tag){var styles=this._styles;for(var i=styles.length-1;i>=0;--i){var s=styles[i];if(s.tag===tag)return s;}return null;}},{key:"HasStyleTag",value:function HasStyleTag(tag){return!!this.GetStyleTag(tag);}},{key:"GetStyleMap",value:function GetStyleMap(){var ret=new Map();var _iteratorNormalCompletion63=true;var _didIteratorError63=false;var _iteratorError63=undefined;try{for(var _iterator63=this._styles[Symbol.iterator](),_step63;!(_iteratorNormalCompletion63=(_step63=_iterator63.next()).done);_iteratorNormalCompletion63=true){var s=_step63.value;ret.set(s.tag,s.param);}}catch(err){_didIteratorError63=true;_iteratorError63=err;}finally{try{if(!_iteratorNormalCompletion63&&_iterator63["return"]!=null){_iterator63["return"]();}}finally{if(_didIteratorError63){throw _iteratorError63;}}}return ret;}},{key:"OffsetWidth",value:function OffsetWidth(w){this._width+=w;}},{key:"SetWidth",value:function SetWidth(w){this._width=w;}},{key:"GetWidth",value:function GetWidth(){return this._width;}},{key:"SetHeight",value:function SetHeight(h){this._height=h;}},{key:"GetHeight",value:function GetHeight(){return this._height;}},{key:"SetFontBoundingBoxAscent",value:function SetFontBoundingBoxAscent(v){this._fontBoundingBoxAscent=v;}},{key:"GetFontBoundingBoxAscent",value:function GetFontBoundingBoxAscent(){return this._fontBoundingBoxAscent;}},{key:"SetFontBoundingBoxDescent",value:function SetFontBoundingBoxDescent(v){this._fontBoundingBoxDescent=v;}},{key:"GetFontBoundingBoxDescent",value:function GetFontBoundingBoxDescent(){return this._fontBoundingBoxDescent;}},{key:"SetTopToAlphabeticDistance",value:function SetTopToAlphabeticDistance(v){this._topToAlphabeticDistance=v;}},{key:"GetTopToAlphabeticDistance",value:function GetTopToAlphabeticDistance(){return this._topToAlphabeticDistance;}},{key:"SetPosX",value:function SetPosX(x){this._posX=x;}},{key:"GetPosX",value:function GetPosX(){return this._posX;}},{key:"SetPosY",value:function SetPosY(y){this._posY=y;}},{key:"GetPosY",value:function GetPosY(){return this._posY;}}]);return FragmentBase;}();}// ../lib/str/textLayout/textFragment.js
{'use strict';var _C38=self.C3;_C38.TextFragment=/*#__PURE__*/function(_C38$FragmentBase){_inherits(TextFragment,_C38$FragmentBase);function TextFragment(opts){var _this13;_classCallCheck(this,TextFragment);_this13=_possibleConstructorReturn(this,_getPrototypeOf(TextFragment).call(this,opts));_this13._chArr=opts.chArr;return _this13;}_createClass(TextFragment,[{key:"IsText",value:function IsText(){return true;}},{key:"_Append",value:function _Append(chArr){_C38.appendArray(this._chArr,chArr);this._width=-1;this._height=-1;this._fontBoundingBoxAscent=-1;this._fontBoundingBoxDescent=-1;this._topToAlphabeticDistance=-1;}},{key:"_AppendChar",value:function _AppendChar(ch){this._chArr.push(ch);}},{key:"_Clone",value:function _Clone(){return _C38.New(_C38.TextFragment,{chArr:this._chArr.slice(0),styles:this._styles,width:this._width,height:this._height,fontBoundingBoxAscent:this._fontBoundingBoxAscent,fontBoundingBoxDescent:this._fontBoundingBoxDescent,topToAlphabeticDistance:this._topToAlphabeticDistance});}},{key:"GetCharacterArray",value:function GetCharacterArray(){return this._chArr;}},{key:"SetCharacterArray",value:function SetCharacterArray(arr){this._chArr=arr;}},{key:"GetLength",value:function GetLength(){return this._chArr.length;}},{key:"IsEmpty",value:function IsEmpty(){return this._chArr.length===0;}},{key:"HasNewLine",value:function HasNewLine(){return this._chArr.includes("\n");}}]);return TextFragment;}(_C38.FragmentBase);}// ../lib/str/textLayout/iconFragment.js
{'use strict';var _C39=self.C3;_C39.IconFragment=/*#__PURE__*/function(_C39$FragmentBase){_inherits(IconFragment,_C39$FragmentBase);function IconFragment(opts){var _this14;_classCallCheck(this,IconFragment);_this14=_possibleConstructorReturn(this,_getPrototypeOf(IconFragment).call(this,opts));_this14._icon=opts.icon;return _this14;}_createClass(IconFragment,[{key:"IsIcon",value:function IsIcon(){return true;}},{key:"GetIconParameter",value:function GetIconParameter(){return this._icon;}},{key:"_Clone",value:function _Clone(){return _C39.New(_C39.IconFragment,{icon:this._icon,styles:this._styles,width:this._width,height:this._height,fontBoundingBoxAscent:this._fontBoundingBoxAscent,fontBoundingBoxDescent:this._fontBoundingBoxDescent,topToAlphabeticDistance:this._topToAlphabeticDistance});}},{key:"GetTextIcon",value:function GetTextIcon(iconSet){if(!iconSet)return null;var index=Number(this._icon);if(String(index)===this._icon){index=Math.floor(index);return iconSet.GetTextIconByIndex(index);}else return iconSet.GetTextIconByTag(this._icon);}},{key:"CalculateWidthFromHeight",value:function CalculateWidthFromHeight(iconSet){var textIcon=this.GetTextIcon(iconSet);if(!textIcon){this._width=0;return;}this._width=this._height*textIcon.GetWidth()/textIcon.GetHeight();}},{key:"GetDrawable",value:function GetDrawable(iconSet){var textIcon=this.GetTextIcon(iconSet);return textIcon?textIcon.GetDrawable():null;}},{key:"GetLength",value:function GetLength(){return 1;}}]);return IconFragment;}(_C39.FragmentBase);}// ../lib/str/textLayout/textIconManager.js
{'use strict';var _C40=self.C3;_C40.TextIconManager=/*#__PURE__*/function(){function TextIconManager(opts){_classCallCheck(this,TextIconManager);this._iconSets=new Map();this._getIconSetMetaCallback=opts.getIconSetMeta;this._getIconSetContentCallback=opts.getIconSetContent;}_createClass(TextIconManager,[{key:"Release",value:function Release(){var _iteratorNormalCompletion64=true;var _didIteratorError64=false;var _iteratorError64=undefined;try{for(var _iterator64=this._iconSets.values()[Symbol.iterator](),_step64;!(_iteratorNormalCompletion64=(_step64=_iterator64.next()).done);_iteratorNormalCompletion64=true){var iconSet=_step64.value;iconSet.Release();}}catch(err){_didIteratorError64=true;_iteratorError64=err;}finally{try{if(!_iteratorNormalCompletion64&&_iterator64["return"]!=null){_iterator64["return"]();}}finally{if(_didIteratorError64){throw _iteratorError64;}}}this._iconSets.clear();}},{key:"GetIconSet",value:function GetIconSet(iconSource){var iconSet=this._iconSets.get(iconSource);if(iconSet)return iconSet;var iconMeta=this._getIconSetMetaCallback(iconSource);iconSet=_C40.New(_C40.TextIconSet,this,{source:iconSource,iconMeta:iconMeta});this._iconSets.set(iconSource,iconSet);return iconSet;}},{key:"HasIconSet",value:function HasIconSet(iconSource){return this._iconSets.has(iconSource);}},{key:"DeleteIconSet",value:function DeleteIconSet(iconSource){var iconSet=this._iconSets.get(iconSource);if(iconSet)iconSet.Release();this._iconSets["delete"](iconSource);}},{key:"_GetIconSetContent",value:function _GetIconSetContent(iconSource){return regeneratorRuntime.async(function _GetIconSetContent$(_context41){while(1){switch(_context41.prev=_context41.next){case 0:_context41.next=2;return regeneratorRuntime.awrap(this._getIconSetContentCallback(iconSource));case 2:return _context41.abrupt("return",_context41.sent);case 3:case"end":return _context41.stop();}}},null,this);}}]);return TextIconManager;}();}// ../lib/str/textLayout/textIconSet.js
{'use strict';var _C41=self.C3;_C41.TextIconSet=/*#__PURE__*/function(){function TextIconSet(textIconManager,opts){_classCallCheck(this,TextIconSet);this._textIconManager=textIconManager;this._source=opts.source;this._iconsArray=[];this._iconsByTag=new Map();this._hasStartedLoad=false;this._isLoading=false;this._loadPromise=null;var iconMetaArr=opts.iconMeta.icons;for(var i=0,len=iconMetaArr.length;i<len;++i){var m=iconMetaArr[i];var textIcon=_C41.New(_C41.TextIcon,this,{index:i,tag:m.tag,source:m.source,width:m.width,height:m.height});this._iconsArray.push(textIcon);if(m.tag)this._iconsByTag.set(m.tag.toLowerCase(),textIcon);}}_createClass(TextIconSet,[{key:"Release",value:function Release(){var _iteratorNormalCompletion65=true;var _didIteratorError65=false;var _iteratorError65=undefined;try{for(var _iterator65=this._iconsArray[Symbol.iterator](),_step65;!(_iteratorNormalCompletion65=(_step65=_iterator65.next()).done);_iteratorNormalCompletion65=true){var textIcon=_step65.value;textIcon.Release();}}catch(err){_didIteratorError65=true;_iteratorError65=err;}finally{try{if(!_iteratorNormalCompletion65&&_iterator65["return"]!=null){_iterator65["return"]();}}finally{if(_didIteratorError65){throw _iteratorError65;}}}_C41.clearArray(this._iconsArray);this._iconsByTag.clear();this._textIconManager=null;this._source=null;}},{key:"HasLoaded",value:function HasLoaded(){return this._hasStartedLoad;}},{key:"IsLoading",value:function IsLoading(){return this._isLoading;}},{key:"LoadContent",value:function LoadContent(){if(!this._loadPromise)this._loadPromise=this._DoLoadContent();return this._loadPromise;}},{key:"_DoLoadContent",value:function _DoLoadContent(){var iconContent,iconsArr,i,len,drawable;return regeneratorRuntime.async(function _DoLoadContent$(_context42){while(1){switch(_context42.prev=_context42.next){case 0:if(!this._hasStartedLoad){_context42.next=2;break;}return _context42.abrupt("return");case 2:this._hasStartedLoad=true;this._isLoading=true;_context42.next=6;return regeneratorRuntime.awrap(this._textIconManager._GetIconSetContent(this._source));case 6:iconContent=_context42.sent;if(this._textIconManager){_context42.next=9;break;}return _context42.abrupt("return");case 9:iconsArr=iconContent.icons;for(i=0,len=Math.min(iconsArr.length,this._iconsArray.length);i<len;++i){drawable=iconsArr[i].drawable;this._iconsArray[i]._SetDrawable(drawable);}this._isLoading=false;case 12:case"end":return _context42.stop();}}},null,this);}},{key:"GetTextIconByIndex",value:function GetTextIconByIndex(index){index=Math.floor(index);if(index<0||index>=this._iconsArray.length)return null;return this._iconsArray[index];}},{key:"GetTextIconByTag",value:function GetTextIconByTag(tag){return this._iconsByTag.get(tag.toLowerCase())||null;}}]);return TextIconSet;}();}// ../lib/str/textLayout/textIcon.js
{'use strict';var _C42=self.C3;_C42.TextIcon=/*#__PURE__*/function(){function TextIcon(textIconSet,opts){_classCallCheck(this,TextIcon);this._textIconSet=textIconSet;this._source=opts.source||null;this._index=opts.index;this._tag=opts.tag;this._width=opts.width;this._height=opts.height;this._drawable=null;}_createClass(TextIcon,[{key:"Release",value:function Release(){this._width=0;this._height=0;this._textIconSet=null;}},{key:"GetSource",value:function GetSource(){return this._source;}},{key:"GetWidth",value:function GetWidth(){return this._width;}},{key:"GetHeight",value:function GetHeight(){return this._height;}},{key:"_SetDrawable",value:function _SetDrawable(drawable){this._drawable=drawable;}},{key:"GetDrawable",value:function GetDrawable(){return this._drawable;}}]);return TextIcon;}();}// ../lib/gfx/gfx.js
{var PlaneFromPoints=function PlaneFromPoints(ptA,ptB,ptC,plane){var normal=tempVec3c;vec3.subtract(tempVec3a,ptC,ptB);vec3.subtract(tempVec3b,ptA,ptB);vec3.cross(normal,tempVec3a,tempVec3b);vec3.normalize(normal,normal);plane.set(normal[0],normal[1],normal[2],vec3.dot(ptA,normal));};var IsInFrontOfPlane=function IsInFrontOfPlane(minX,minY,minZ,maxX,maxY,maxZ,plane){var nx=plane.x;var ny=plane.y;var nz=plane.z;var d=plane.w;var nxT=plane.xF;var nyT=plane.yF;var nzT=plane.zF;var nxF=1-nxT;var nyF=1-nyT;var nzF=1-nzT;var minD=nx*minX*nxT+nx*maxX*nxF+ny*minY*nyT+ny*maxY*nyF+nz*minZ*nzT+nz*maxZ*nzF;if(minD>=d)return true;var maxD=nx*maxX*nxT+nx*minX*nxF+ny*maxY*nyT+ny*minY*nyF+nz*maxZ*nzT+nz*minZ*nzF;return maxD>d;};var IsPointInFrontOfPlane=function IsPointInFrontOfPlane(x,y,z,plane){var nx=plane.x;var ny=plane.y;var nz=plane.z;var d=plane.w;var minD=nx*x+ny*y+nz*z;return minD>=d;};'use strict';var _C43=self.C3;var glMatrix=self.glMatrix;var vec3=glMatrix.vec3;var vec4=glMatrix.vec4;var mat4=glMatrix.mat4;var tempVec3a=vec3.create();var tempVec3b=vec3.create();var tempVec3c=vec3.create();var tempVec4=vec4.create();var tempMat4=mat4.create();var neartl=vec3.create();var neartr=vec3.create();var nearbl=vec3.create();var nearbr=vec3.create();var fartl=vec3.create();var fartr=vec3.create();var farbl=vec3.create();var farbr=vec3.create();var unitViewport=vec4.fromValues(0,0,1,1);_C43.Gfx={Project:function Project(objx,objy,objz,mv,proj,viewport,windowCoordinate){var fTemp0=mv[0]*objx+mv[4]*objy+mv[8]*objz+mv[12];var fTemp1=mv[1]*objx+mv[5]*objy+mv[9]*objz+mv[13];var fTemp2=mv[2]*objx+mv[6]*objy+mv[10]*objz+mv[14];var fTemp3=mv[3]*objx+mv[7]*objy+mv[11]*objz+mv[15];var fTemp4=proj[0]*fTemp0+proj[4]*fTemp1+proj[8]*fTemp2+proj[12]*fTemp3;var fTemp5=proj[1]*fTemp0+proj[5]*fTemp1+proj[9]*fTemp2+proj[13]*fTemp3;var fTemp6=proj[2]*fTemp0+proj[6]*fTemp1+proj[10]*fTemp2+proj[14]*fTemp3;var fTemp7=proj[3]*fTemp0+proj[7]*fTemp1+proj[11]*fTemp2+proj[15]*fTemp3;if(fTemp7===0)return false;fTemp7=1/fTemp7;fTemp4*=fTemp7;fTemp5*=fTemp7;fTemp6*=fTemp7;windowCoordinate[0]=(fTemp4*.5+.5)*viewport[2]+viewport[0];windowCoordinate[1]=(fTemp5*.5+.5)*viewport[3]+viewport[1];windowCoordinate[2]=(1+fTemp6)*.5;return true;},Unproject:function Unproject(winx,winy,winz,mv,proj,viewport,objectCoordinate){var A=tempMat4;var vec=tempVec4;mat4.multiply(A,proj,mv);if(mat4.invert(A,A)===null)return false;vec[0]=(winx-viewport[0])/viewport[2]*2-1;vec[1]=(winy-viewport[1])/viewport[3]*2-1;vec[2]=2*winz-1;vec[3]=1;vec4.transformMat4(vec,vec,A);if(vec[3]===0)return false;vec[3]=1/vec[3];objectCoordinate[0]=vec[0]*vec[3];objectCoordinate[1]=vec[1]*vec[3];objectCoordinate[2]=vec[2]*vec[3];return true;},UnprojectScreenToWorldZ:function UnprojectScreenToWorldZ(winx,winy,worldZ,mv,proj,viewport,objectCoordinate){var nearPt=tempVec3a;var farPt=tempVec3b;if(!_C43.Gfx.Unproject(winx,winy,0,mv,proj,viewport,nearPt))return false;if(!_C43.Gfx.Unproject(winx,winy,1,mv,proj,viewport,farPt))return false;var dirVec=tempVec3b;vec3.subtract(dirVec,farPt,nearPt);var planeNormal=tempVec3c;vec3.set(planeNormal,0,0,1);var planeConstant=-worldZ;var denominator=vec3.dot(planeNormal,dirVec);var distance=0;if(denominator===0){var planeDistToPt=vec3.dot(planeNormal,nearPt)+planeConstant;if(planeDistToPt!==0)return false;}else{distance=-(vec3.dot(nearPt,planeNormal)+planeConstant)/denominator;if(distance<0)return false;}vec3.scaleAndAdd(objectCoordinate,nearPt,dirVec,distance);return true;}};var Plane=/*#__PURE__*/function(){function Plane(){_classCallCheck(this,Plane);this.x=NaN;this.y=NaN;this.z=NaN;this.w=NaN;this.xF=NaN;this.yF=NaN;this.zF=NaN;}_createClass(Plane,[{key:"set",value:function set(x,y,z,w){this.x=x;this.y=y;this.z=z;this.w=w;this.xF=x>0?1:0;this.yF=y>0?1:0;this.zF=z>0?1:0;}}]);return Plane;}();_C43.Gfx.ViewFrustum=/*#__PURE__*/function(){function ViewFrustum(){_classCallCheck(this,ViewFrustum);this._leftP=new Plane();this._topP=new Plane();this._rightP=new Plane();this._bottomP=new Plane();this._nearP=new Plane();this._farP=new Plane();}_createClass(ViewFrustum,[{key:"CalculatePlanes",value:function CalculatePlanes(mv,proj){var vp=unitViewport;_C43.Gfx.Unproject(0,1,0,mv,proj,vp,neartl);_C43.Gfx.Unproject(1,1,0,mv,proj,vp,neartr);_C43.Gfx.Unproject(0,0,0,mv,proj,vp,nearbl);_C43.Gfx.Unproject(1,0,0,mv,proj,vp,nearbr);_C43.Gfx.Unproject(0,1,1,mv,proj,vp,fartl);_C43.Gfx.Unproject(1,1,1,mv,proj,vp,fartr);_C43.Gfx.Unproject(0,0,1,mv,proj,vp,farbl);_C43.Gfx.Unproject(1,0,1,mv,proj,vp,farbr);PlaneFromPoints(nearbl,neartl,fartl,this._leftP);PlaneFromPoints(neartl,neartr,fartr,this._topP);PlaneFromPoints(neartr,nearbr,farbr,this._rightP);PlaneFromPoints(nearbr,nearbl,farbl,this._bottomP);PlaneFromPoints(farbl,fartl,fartr,this._farP);PlaneFromPoints(nearbr,neartr,neartl,this._nearP);}},{key:"ContainsAABB",value:function ContainsAABB(minX,minY,minZ,maxX,maxY,maxZ){return IsInFrontOfPlane(minX,minY,minZ,maxX,maxY,maxZ,this._leftP)&&IsInFrontOfPlane(minX,minY,minZ,maxX,maxY,maxZ,this._topP)&&IsInFrontOfPlane(minX,minY,minZ,maxX,maxY,maxZ,this._rightP)&&IsInFrontOfPlane(minX,minY,minZ,maxX,maxY,maxZ,this._bottomP)&&IsInFrontOfPlane(minX,minY,minZ,maxX,maxY,maxZ,this._nearP)&&IsInFrontOfPlane(minX,minY,minZ,maxX,maxY,maxZ,this._farP);}},{key:"IsBehindNearPlane",value:function IsBehindNearPlane(x,y,z){return!IsPointInFrontOfPlane(x,y,z,this._nearP);}}]);return ViewFrustum;}();}// ../lib/gfx/rendererBase.js
{'use strict';var _C44=self.C3;var _glMatrix=self.glMatrix;var _vec=_glMatrix.vec3;var _vec2=_glMatrix.vec4;var _mat=_glMatrix.mat4;var _tempMat=_mat.create();var tmpVec3a=_vec.fromValues(0,0,0);var tmpVec3b=_vec.fromValues(0,0,0);var tmpVec3c=_vec.fromValues(0,0,0);var defaultUpVector=_vec.fromValues(0,1,0);var tmpVec4=_vec2.fromValues(0,0,0,0);var tmpQuad=new _C44.Quad();var tmpRect=new _C44.Rect();var defaultTexCoordsQuad=new _C44.Quad(0,0,1,0,1,1,0,1);var DEFAULT_RENDERERBASE_OPTS={nearZ:1,farZ:1E4};var matWebGLtoWebGPU=_mat.fromValues(1,0,0,0,0,1,0,0,0,0,.5,0,0,0,.5,1);_C44.Gfx.RendererBase=/*#__PURE__*/function(){function RendererBase(opts){_classCallCheck(this,RendererBase);opts=Object.assign({},DEFAULT_RENDERERBASE_OPTS,opts);this._width=0;this._height=0;this._fovY=_C44.toRadians(45);this._tan_fovY_2=Math.tan(this._fovY/2);this._matP=_mat.create();this._matMV=_mat.create();this._zAxisScale=false;this._nearZ=opts.nearZ;this._farZ=opts.farZ;this._allShaderPrograms=[];this._shaderProgramsByName=new Map();this._spTextureFill=null;this._spPoints=null;this._spTilemapFill=null;this._spTileRandomization=null;this._spColorFill=null;this._spLinearGradientFill=null;this._spPenumbraFill=null;this._spHardEllipseFill=null;this._spHardEllipseOutline=null;this._spSmoothEllipseFill=null;this._spSmoothEllipseOutline=null;this._spSmoothLineFill=null;this._stateGroups=new Map();this._currentStateGroup=null;this._blendModeTable=[];this._namedBlendModeMap=new Map();this._baseZ=0;this._currentZ=0;this._lineWidth=1;this._lineWidthStack=[this._lineWidth];this._lineCap=1;this._lineCapStack=[this._lineCap];this._lineOffset=.5;this._lineOffsetStack=[this._lineOffset];this._frameNumber=0;this._enableMipmaps=true;this._hasMajorPerformanceCaveat=false;}_createClass(RendererBase,[{key:"FillIndexBufferData",value:function FillIndexBufferData(indexData){var i=0,len=indexData.length,fv=0;while(i<len){indexData[i++]=fv;indexData[i++]=fv+1;indexData[i++]=fv+2;indexData[i++]=fv;indexData[i++]=fv+2;indexData[i++]=fv+3;fv+=4;}}},{key:"_ClearState",value:function _ClearState(){this._baseZ=0;this._currentZ=0;this._spTextureFill=null;this._spPoints=null;this._spTilemapFill=null;this._spTileRandomization=null;this._spColorFill=null;this._spLinearGradientFill=null;this._spPenumbraFill=null;this._spHardEllipseFill=null;this._spHardEllipseOutline=null;this._spSmoothEllipseFill=null;this._spSmoothEllipseOutline=null;this._spSmoothLineFill=null;this._ClearAllShaderPrograms();}},{key:"InitState",value:function InitState(){this._ClearState();this._currentStateGroup=null;}},{key:"OnDeviceOrContextLost",value:function OnDeviceOrContextLost(){var _iteratorNormalCompletion66=true;var _didIteratorError66=false;var _iteratorError66=undefined;try{for(var _iterator66=this._allShaderPrograms[Symbol.iterator](),_step66;!(_iteratorNormalCompletion66=(_step66=_iterator66.next()).done);_iteratorNormalCompletion66=true){var s=_step66.value;s.Release();}}catch(err){_didIteratorError66=true;_iteratorError66=err;}finally{try{if(!_iteratorNormalCompletion66&&_iterator66["return"]!=null){_iterator66["return"]();}}finally{if(_didIteratorError66){throw _iteratorError66;}}}this._ClearState();}},{key:"GetWidth",value:function GetWidth(){return this._width;}},{key:"GetHeight",value:function GetHeight(){return this._height;}},{key:"GetDefaultCameraZ",value:function GetDefaultCameraZ(viewH){if(this.IsZAxisScaleNormalized())return 100;else return viewH/(2*this._GetTanFovYDiv2());}},{key:"GetZAxisScaleFactor",value:function GetZAxisScaleFactor(viewH){if(this.IsZAxisScaleNormalized()){var realZunits=viewH/(2*this._GetTanFovYDiv2());return realZunits/this.GetDefaultCameraZ(viewH);}else return 1;}},{key:"SetNearZ",value:function SetNearZ(z){this._nearZ=z;}},{key:"GetNearZ",value:function GetNearZ(){return this._nearZ;}},{key:"SetFarZ",value:function SetFarZ(z){this._farZ=z;}},{key:"GetFarZ",value:function GetFarZ(){return this._farZ;}},{key:"SetFovY",value:function SetFovY(f){this._fovY=f;this._tan_fovY_2=Math.tan(this._fovY/2);}},{key:"GetFovY",value:function GetFovY(){return this._fovY;}},{key:"_GetTanFovYDiv2",value:function _GetTanFovYDiv2(){return this._tan_fovY_2;}},{key:"SetZAxisScaleNormalized",value:function SetZAxisScaleNormalized(){this._zAxisScale=false;}},{key:"SetZAxisScaleRegular",value:function SetZAxisScaleRegular(){this._zAxisScale=true;}},{key:"IsZAxisScaleNormalized",value:function IsZAxisScaleNormalized(){return!this._zAxisScale;}},{key:"IsZAxisScaleRegular",value:function IsZAxisScaleRegular(){return this._zAxisScale;}},{key:"CalculatePerspectiveMatrix",value:function CalculatePerspectiveMatrix(outMat,aspect){var vpX=arguments.length>2&&arguments[2]!==undefined?arguments[2]:.5;var vpY=arguments.length>3&&arguments[3]!==undefined?arguments[3]:.5;var zNear=this.GetNearZ();var zFar=this.GetFarZ();var fovY=this.GetFovY();if(vpX===.5&&vpY===.5){if(this.IsWebGPU())_mat.perspectiveZO(outMat,fovY,aspect,zNear,zFar);else _mat.perspective(outMat,fovY,aspect,zNear,zFar);}else{vpX=1-vpX;var fLeft=vpX*2-2;var fRight=vpX*2;var fBottom=vpY*2-2;var fTop=vpY*2;var fH=this._GetTanFovYDiv2()*zNear;var fW=fH*aspect;_mat.frustum(outMat,fLeft*fW,fRight*fW,fBottom*fH,fTop*fH,zNear,zFar);if(this.IsWebGPU())_mat.mul(outMat,matWebGLtoWebGPU,outMat);}}},{key:"CalculateOrthographicMatrix",value:function CalculateOrthographicMatrix(outMat,width,height){var scale=arguments.length>3&&arguments[3]!==undefined?arguments[3]:1;var dpr=self.devicePixelRatio;var worldScale=this.GetDefaultCameraZ(height)*2*dpr*this._GetTanFovYDiv2()/height;var hScaleX=width*worldScale/(2*dpr*scale);var hScaleY=height*worldScale/(2*dpr*scale);var left=-hScaleX;var right=hScaleX;var bottom=-hScaleY;var top=hScaleY;if(this.IsWebGPU())_mat.orthoZO(outMat,left,right,bottom,top,this.GetNearZ(),this.GetFarZ());else _mat.ortho(outMat,left,right,bottom,top,this.GetNearZ(),this.GetFarZ());}},{key:"CalculateLookAtModelView",value:function CalculateLookAtModelView(outMat,cam,look,up,viewH){var zScale=arguments.length>5&&arguments[5]!==undefined?arguments[5]:1;var worldScale=1;if(this.IsZAxisScaleNormalized())worldScale=200*this._GetTanFovYDiv2()/viewH;var worldScaleVec3=tmpVec3c;_vec.set(worldScaleVec3,worldScale,-worldScale,1);var tmpCam=tmpVec3a;var tmpLook=tmpVec3b;_vec.multiply(tmpCam,cam,worldScaleVec3);_vec.multiply(tmpLook,look,worldScaleVec3);_mat.lookAt(outMat,tmpCam,tmpLook,up||defaultUpVector);worldScaleVec3[2]=zScale;_mat.scale(outMat,outMat,worldScaleVec3);}},{key:"CalculateLookAtModelView2",value:function CalculateLookAtModelView2(camX,camY,camZ,lookX,lookY,lookZ,viewH,zScale){_vec.set(tmpVec3a,camX,camY,camZ);_vec.set(tmpVec3b,lookX,lookY,lookZ);this.CalculateLookAtModelView(_tempMat,tmpVec3a,tmpVec3b,defaultUpVector,viewH,zScale);return _tempMat;}},{key:"_AddShaderProgram",value:function _AddShaderProgram(sp){this._allShaderPrograms.push(sp);this._shaderProgramsByName.set(sp.GetName(),sp);}},{key:"_RemoveShaderProgram",value:function _RemoveShaderProgram(sp){var i=this._allShaderPrograms.indexOf(sp);if(i!==-1)this._allShaderPrograms.splice(i,1);this._shaderProgramsByName["delete"](sp.GetName());}},{key:"_ClearAllShaderPrograms",value:function _ClearAllShaderPrograms(){_C44.clearArray(this._allShaderPrograms);this._shaderProgramsByName.clear();}},{key:"GetShaderProgramByName",value:function GetShaderProgramByName(name){return this._shaderProgramsByName.get(name)||null;}},{key:"GetTextureFillShaderProgram",value:function GetTextureFillShaderProgram(){return this._spTextureFill;}},{key:"SetTextureFillMode",value:function SetTextureFillMode(){this.SetProgram(this._spTextureFill);}},{key:"GetPointsRenderingProgram",value:function GetPointsRenderingProgram(){return this._spPoints;}},{key:"SetPointsRenderingProgram",value:function SetPointsRenderingProgram(){this.SetProgram(this._spPoints);}},{key:"SetTilemapFillMode",value:function SetTilemapFillMode(){this.SetProgram(this._spTilemapFill);}},{key:"SetTileRandomizationMode",value:function SetTileRandomizationMode(){this.SetProgram(this._spTileRandomization);}},{key:"SetColorFillMode",value:function SetColorFillMode(){this.SetProgram(this._spColorFill);}},{key:"SetLinearGradientFillMode",value:function SetLinearGradientFillMode(){this.SetProgram(this._spLinearGradientFill);}},{key:"SetPenumbraFillMode",value:function SetPenumbraFillMode(){this.SetProgram(this._spPenumbraFill);}},{key:"SetHardEllipseFillMode",value:function SetHardEllipseFillMode(){this.SetProgram(this._spHardEllipseFill);}},{key:"SetHardEllipseOutlineMode",value:function SetHardEllipseOutlineMode(){this.SetProgram(this._spHardEllipseOutline);}},{key:"SetSmoothEllipseFillMode",value:function SetSmoothEllipseFillMode(){this.SetProgram(this._spSmoothEllipseFill);}},{key:"SetSmoothEllipseOutlineMode",value:function SetSmoothEllipseOutlineMode(){this.SetProgram(this._spSmoothEllipseOutline);}},{key:"SetSmoothLineFillMode",value:function SetSmoothLineFillMode(){this.SetProgram(this._spSmoothLineFill);}},{key:"_SetCurrentStateGroup",value:function _SetCurrentStateGroup(sg){this._currentStateGroup=sg;}},{key:"GetCurrentStateGroup",value:function GetCurrentStateGroup(){return this._currentStateGroup;}},{key:"AcquireStateGroup",value:function AcquireStateGroup(shaderProgram_or_name,blendMode,color,zElevation){var key=_C44.Gfx.StateGroup.MakeKey(shaderProgram_or_name,blendMode,color,zElevation);var stateGroup=this._stateGroups.get(key);if(!stateGroup){stateGroup=_C44.New(_C44.Gfx.StateGroup,this,shaderProgram_or_name,blendMode,color,zElevation);this._stateGroups.set(key,stateGroup);}stateGroup.AddRef();return stateGroup;}},{key:"ReleaseStateGroup",value:function ReleaseStateGroup(stateGroup){stateGroup.DecRef();if(stateGroup._GetRefCount()===0){if(this._currentStateGroup===stateGroup)this._currentStateGroup=null;this._stateGroups["delete"](stateGroup.GetKey());stateGroup.Release();}}},{key:"_InitBlendModeData",value:function _InitBlendModeData(blendModeData){_C44.clearArray(this._blendModeTable);this._namedBlendModeMap.clear();var number=0;var _iteratorNormalCompletion67=true;var _didIteratorError67=false;var _iteratorError67=undefined;try{for(var _iterator67=blendModeData[Symbol.iterator](),_step67;!(_iteratorNormalCompletion67=(_step67=_iterator67.next()).done);_iteratorNormalCompletion67=true){var bmd=_step67.value;var name=bmd[0];var srcBlend=bmd[1];var destBlend=bmd[2];this._blendModeTable.push([srcBlend,destBlend]);this._namedBlendModeMap.set(name,{number:number,srcBlend:srcBlend,destBlend:destBlend});number++;}}catch(err){_didIteratorError67=true;_iteratorError67=err;}finally{try{if(!_iteratorNormalCompletion67&&_iterator67["return"]!=null){_iterator67["return"]();}}finally{if(_didIteratorError67){throw _iteratorError67;}}}}},{key:"_GetBlendByIndex",value:function _GetBlendByIndex(blendIndex){return this._blendModeTable[blendIndex];}},{key:"GetSrcBlendByIndex",value:function GetSrcBlendByIndex(blendIndex){return this._GetBlendByIndex(blendIndex)[0];}},{key:"GetDestBlendByIndex",value:function GetDestBlendByIndex(blendIndex){return this._GetBlendByIndex(blendIndex)[1];}},{key:"GetNamedBlend",value:function GetNamedBlend(blendName){var ret=this._namedBlendModeMap.get(blendName);if(typeof ret==="undefined")throw new Error("invalid blend name");return ret;}},{key:"NamedBlendToNumber",value:function NamedBlendToNumber(blendName){var ret=this._namedBlendModeMap.get(blendName);if(typeof ret==="undefined")throw new Error("invalid blend name");return ret.number;}},{key:"SetBaseZ",value:function SetBaseZ(z){this._baseZ=z;}},{key:"GetBaseZ",value:function GetBaseZ(){return this._baseZ;}},{key:"SetCurrentZ",value:function SetCurrentZ(z){this._currentZ=z;this._currentStateGroup=null;}},{key:"GetCurrentZ",value:function GetCurrentZ(){return this._currentZ;}},{key:"Line",value:function Line(x1,y1,x2,y2){var a=_C44.angleTo(x1,y1,x2,y2);var sin_a=Math.sin(a);var cos_a=Math.cos(a);var halfLineWidth=this._lineWidth*.5;var sin_a_hlw=sin_a*halfLineWidth;var cos_a_hlw=cos_a*halfLineWidth;var lineCap=this._lineCap;if(lineCap===2)this.LinePreCalc_LineCap2(x1,y1,0,x2,y2,0,sin_a_hlw,cos_a_hlw);else if(lineCap===1)this.LinePreCalc_LineCap1(x1,y1,0,x2,y2,0,sin_a_hlw,cos_a_hlw);else this.LinePreCalc_LineCap0(x1,y1,0,x2,y2,0,sin_a_hlw,cos_a_hlw);}},{key:"Line3D",value:function Line3D(x1,y1,z1,x2,y2,z2){var a=_C44.angleTo(x1,y1,x2,y2);var sin_a=Math.sin(a);var cos_a=Math.cos(a);var halfLineWidth=this._lineWidth*.5;var sin_a_hlw=sin_a*halfLineWidth;var cos_a_hlw=cos_a*halfLineWidth;var lineCap=this._lineCap;if(lineCap===2)this.LinePreCalc_LineCap2(x1,y1,z1,x2,y2,z2,sin_a_hlw,cos_a_hlw);else if(lineCap===1)this.LinePreCalc_LineCap1(x1,y1,z1,x2,y2,z2,sin_a_hlw,cos_a_hlw);else this.LinePreCalc_LineCap0(x1,y1,z1,x2,y2,z2,sin_a_hlw,cos_a_hlw);}},{key:"LinePreCalc_LineCap2",value:function LinePreCalc_LineCap2(x1,y1,z1,x2,y2,z2,sin_a_hlw,cos_a_hlw){var lineOffset=this._lineOffset;var startX=x1+lineOffset-cos_a_hlw;var startY=y1+lineOffset-sin_a_hlw;var endX=x2+lineOffset+cos_a_hlw;var endY=y2+lineOffset+sin_a_hlw;var cos_a_lw=cos_a_hlw*2;var sin_a_lw=sin_a_hlw*2;var tlx=startX+sin_a_hlw;var tly=startY-cos_a_hlw;var blx=startX-sin_a_hlw+cos_a_lw;var bly=startY+cos_a_hlw+sin_a_lw;var trx=endX+sin_a_hlw;var try_=endY-cos_a_hlw;var brx=endX-sin_a_hlw-cos_a_lw;var bry=endY+cos_a_hlw-sin_a_lw;this.Quad3D2(tlx,tly,z1,trx,try_,z2,brx,bry,z2,blx,bly,z1,defaultTexCoordsQuad);}},{key:"LinePreCalc_LineCap1",value:function LinePreCalc_LineCap1(x1,y1,z1,x2,y2,z2,sin_a_hlw,cos_a_hlw){var lineOffset=this._lineOffset;var startX=x1+lineOffset-cos_a_hlw;var startY=y1+lineOffset-sin_a_hlw;var endX=x2+lineOffset+cos_a_hlw;var endY=y2+lineOffset+sin_a_hlw;var tlx=startX+sin_a_hlw;var tly=startY-cos_a_hlw;var blx=startX-sin_a_hlw;var bly=startY+cos_a_hlw;var trx=endX+sin_a_hlw;var try_=endY-cos_a_hlw;var brx=endX-sin_a_hlw;var bry=endY+cos_a_hlw;this.Quad3D2(tlx,tly,z1,trx,try_,z2,brx,bry,z2,blx,bly,z1,defaultTexCoordsQuad);}},{key:"LinePreCalc_LineCap0",value:function LinePreCalc_LineCap0(x1,y1,z1,x2,y2,z2,sin_a_hlw,cos_a_hlw){var lineOffset=this._lineOffset;var startX=x1+lineOffset;var startY=y1+lineOffset;var endX=x2+lineOffset;var endY=y2+lineOffset;var tlx=startX+sin_a_hlw;var tly=startY-cos_a_hlw;var blx=startX-sin_a_hlw;var bly=startY+cos_a_hlw;var trx=endX+sin_a_hlw;var try_=endY-cos_a_hlw;var brx=endX-sin_a_hlw;var bry=endY+cos_a_hlw;this.Quad3D2(tlx,tly,z1,trx,try_,z2,brx,bry,z2,blx,bly,z1,defaultTexCoordsQuad);}},{key:"TexturedLine",value:function TexturedLine(x1,y1,x2,y2,u,v){var a=_C44.angleTo(x1,y1,x2,y2);var sin_a=Math.sin(a);var cos_a=Math.cos(a);var halfLineWidth=this._lineWidth*.5;var sin_a_hlw=sin_a*halfLineWidth;var cos_a_hlw=cos_a*halfLineWidth;var lineCap=this._lineCap;if(lineCap===2)this.TexturedLinePreCalc_LineCap2(x1,y1,x2,y2,sin_a_hlw,cos_a_hlw,u,v);else if(lineCap===1)this.TexturedLinePreCalc_LineCap1(x1,y1,x2,y2,sin_a_hlw,cos_a_hlw,u,v);else this.TexturedLinePreCalc_LineCap0(x1,y1,x2,y2,sin_a_hlw,cos_a_hlw,u,v);}},{key:"TexturedLinePreCalc_LineCap2",value:function TexturedLinePreCalc_LineCap2(x1,y1,x2,y2,sin_a_hlw,cos_a_hlw,u,v){var lineOffset=this._lineOffset;var startX=x1+lineOffset-cos_a_hlw;var startY=y1+lineOffset-sin_a_hlw;var endX=x2+lineOffset+cos_a_hlw;var endY=y2+lineOffset+sin_a_hlw;var cos_a_lw=cos_a_hlw*2;var sin_a_lw=sin_a_hlw*2;var tlx=startX+sin_a_hlw;var tly=startY-cos_a_hlw;var blx=startX-sin_a_hlw+cos_a_lw;var bly=startY+cos_a_hlw+sin_a_lw;var trx=endX+sin_a_hlw;var try_=endY-cos_a_hlw;var brx=endX-sin_a_hlw-cos_a_lw;var bry=endY+cos_a_hlw-sin_a_lw;tmpQuad.set(tlx,tly,trx,try_,brx,bry,blx,bly);tmpRect.set(u,0,v,0);this.Quad3(tmpQuad,tmpRect);}},{key:"TexturedLinePreCalc_LineCap1",value:function TexturedLinePreCalc_LineCap1(x1,y1,x2,y2,sin_a_hlw,cos_a_hlw,u,v){var lineOffset=this._lineOffset;var startX=x1+lineOffset-cos_a_hlw;var startY=y1+lineOffset-sin_a_hlw;var endX=x2+lineOffset+cos_a_hlw;var endY=y2+lineOffset+sin_a_hlw;var tlx=startX+sin_a_hlw;var tly=startY-cos_a_hlw;var blx=startX-sin_a_hlw;var bly=startY+cos_a_hlw;var trx=endX+sin_a_hlw;var try_=endY-cos_a_hlw;var brx=endX-sin_a_hlw;var bry=endY+cos_a_hlw;tmpQuad.set(tlx,tly,trx,try_,brx,bry,blx,bly);tmpRect.set(u,0,v,0);this.Quad3(tmpQuad,tmpRect);}},{key:"TexturedLinePreCalc_LineCap0",value:function TexturedLinePreCalc_LineCap0(x1,y1,x2,y2,sin_a_hlw,cos_a_hlw,u,v){var lineOffset=this._lineOffset;var startX=x1+lineOffset;var startY=y1+lineOffset;var endX=x2+lineOffset;var endY=y2+lineOffset;var tlx=startX+sin_a_hlw;var tly=startY-cos_a_hlw;var blx=startX-sin_a_hlw;var bly=startY+cos_a_hlw;var trx=endX+sin_a_hlw;var try_=endY-cos_a_hlw;var brx=endX-sin_a_hlw;var bry=endY+cos_a_hlw;tmpQuad.set(tlx,tly,trx,try_,brx,bry,blx,bly);tmpRect.set(u,0,v,0);this.Quad3(tmpQuad,tmpRect);}},{key:"LineRect",value:function LineRect(left,top,right,bottom){var halfLineWidth=this._lineWidth*.5;var lineCap=this._lineCap;if(lineCap===2)this._LineRectPreCalc_LineCap2(left,top,right,bottom,halfLineWidth);else if(lineCap===1)this._LineRectPreCalc_LineCap1(left,top,right,bottom,halfLineWidth);else this._LineRectPreCalc_LineCap0(left,top,right,bottom,halfLineWidth);}},{key:"_LineRectPreCalc_LineCap2",value:function _LineRectPreCalc_LineCap2(left,top,right,bottom,halfLineWidth){this.LinePreCalc_LineCap2(left,top,0,right,top,0,0,halfLineWidth);this.LinePreCalc_LineCap2(right,top,0,right,bottom,0,halfLineWidth,0);this.LinePreCalc_LineCap2(right,bottom,0,left,bottom,0,0,-halfLineWidth);this.LinePreCalc_LineCap2(left,bottom,0,left,top,0,-halfLineWidth,0);}},{key:"_LineRectPreCalc_LineCap1",value:function _LineRectPreCalc_LineCap1(left,top,right,bottom,halfLineWidth){this.LinePreCalc_LineCap1(left,top,0,right,top,0,0,halfLineWidth);this.LinePreCalc_LineCap1(right,top,0,right,bottom,0,halfLineWidth,0);this.LinePreCalc_LineCap1(right,bottom,0,left,bottom,0,0,-halfLineWidth);this.LinePreCalc_LineCap1(left,bottom,0,left,top,0,-halfLineWidth,0);}},{key:"_LineRectPreCalc_LineCap0",value:function _LineRectPreCalc_LineCap0(left,top,right,bottom,halfLineWidth){this.LinePreCalc_LineCap0(left,top,0,right,top,0,0,halfLineWidth);this.LinePreCalc_LineCap0(right,top,0,right,bottom,0,halfLineWidth,0);this.LinePreCalc_LineCap0(right,bottom,0,left,bottom,0,0,-halfLineWidth);this.LinePreCalc_LineCap0(left,bottom,0,left,top,0,-halfLineWidth,0);}},{key:"LineRect2",value:function LineRect2(r){this.LineRect(r.getLeft(),r.getTop(),r.getRight(),r.getBottom());}},{key:"LineQuad",value:function LineQuad(q){var a=_C44.angleTo(q.getTlx(),q.getTly(),q.getTrx(),q.getTry());var sin_a=Math.sin(a);var cos_a=Math.cos(a);var halfLineWidth=this._lineWidth*.5;var sin_a_hlw=sin_a*halfLineWidth;var cos_a_hlw=cos_a*halfLineWidth;var lineCap=this._lineCap;if(lineCap===2)this._LineQuadPreCalc_LineCap2(q,sin_a_hlw,cos_a_hlw);else if(lineCap===1)this._LineQuadPreCalc_LineCap1(q,sin_a_hlw,cos_a_hlw);else this._LineQuadPreCalc_LineCap0(q,sin_a_hlw,cos_a_hlw);}},{key:"_LineQuadPreCalc_LineCap2",value:function _LineQuadPreCalc_LineCap2(q,sin_a_hlw,cos_a_hlw){this.LinePreCalc_LineCap2(q.getTlx(),q.getTly(),0,q.getTrx(),q.getTry(),0,sin_a_hlw,cos_a_hlw);this.LinePreCalc_LineCap2(q.getTrx(),q.getTry(),0,q.getBrx(),q.getBry(),0,cos_a_hlw,-sin_a_hlw);this.LinePreCalc_LineCap2(q.getBrx(),q.getBry(),0,q.getBlx(),q.getBly(),0,-sin_a_hlw,-cos_a_hlw);this.LinePreCalc_LineCap2(q.getBlx(),q.getBly(),0,q.getTlx(),q.getTly(),0,-cos_a_hlw,sin_a_hlw);}},{key:"_LineQuadPreCalc_LineCap1",value:function _LineQuadPreCalc_LineCap1(q,sin_a_hlw,cos_a_hlw){this.LinePreCalc_LineCap1(q.getTlx(),q.getTly(),0,q.getTrx(),q.getTry(),0,sin_a_hlw,cos_a_hlw);this.LinePreCalc_LineCap1(q.getTrx(),q.getTry(),0,q.getBrx(),q.getBry(),0,cos_a_hlw,-sin_a_hlw);this.LinePreCalc_LineCap1(q.getBrx(),q.getBry(),0,q.getBlx(),q.getBly(),0,-sin_a_hlw,-cos_a_hlw);this.LinePreCalc_LineCap1(q.getBlx(),q.getBly(),0,q.getTlx(),q.getTly(),0,-cos_a_hlw,sin_a_hlw);}},{key:"_LineQuadPreCalc_LineCap0",value:function _LineQuadPreCalc_LineCap0(q,sin_a_hlw,cos_a_hlw){this.LinePreCalc_LineCap0(q.getTlx(),q.getTly(),0,q.getTrx(),q.getTry(),0,sin_a_hlw,cos_a_hlw);this.LinePreCalc_LineCap0(q.getTrx(),q.getTry(),0,q.getBrx(),q.getBry(),0,cos_a_hlw,-sin_a_hlw);this.LinePreCalc_LineCap0(q.getBrx(),q.getBry(),0,q.getBlx(),q.getBly(),0,-sin_a_hlw,-cos_a_hlw);this.LinePreCalc_LineCap0(q.getBlx(),q.getBly(),0,q.getTlx(),q.getTly(),0,-cos_a_hlw,sin_a_hlw);}},{key:"SetLineWidth",value:function SetLineWidth(n){this._lineWidth=n;this._lineWidthStack[this._lineWidthStack.length-1]=n;}},{key:"GetLineWidth",value:function GetLineWidth(){return this._lineWidth;}},{key:"PushLineWidth",value:function PushLineWidth(n){if(this._lineWidthStack.length>=100)throw new Error("pushed too many line widths - check push/pop pairs");this._lineWidthStack.push(n);this._lineWidth=n;}},{key:"PopLineWidth",value:function PopLineWidth(){if(this._lineWidthStack.length<=1)throw new Error("cannot pop last line width - check push/pop pairs");this._lineWidthStack.pop();this._lineWidth=this._lineWidthStack.at(-1);}},{key:"SetLineCapButt",value:function SetLineCapButt(){this._lineCap=0;this._lineCapStack[this._lineCapStack.length-1]=0;}},{key:"SetLineCapSquare",value:function SetLineCapSquare(){this._lineCap=1;this._lineCapStack[this._lineCapStack.length-1]=0;}},{key:"SetLineCapZag",value:function SetLineCapZag(){this._lineCap=2;this._lineCapStack[this._lineCapStack.length-1]=0;}},{key:"PushLineCap",value:function PushLineCap(type){if(type==="butt")this.PushLineCapButt();else if(type==="square")this.PushLineCapSquare();else if(type==="zag")this.PushLineCapZag();else throw new Error("invalid line cap");}},{key:"PushLineCapButt",value:function PushLineCapButt(){if(this._lineCapStack.length>=100)throw new Error("pushed too many line caps - check push/pop pairs");this._lineCapStack.push(0);this._lineCap=0;}},{key:"PushLineCapSquare",value:function PushLineCapSquare(){if(this._lineCapStack.length>=100)throw new Error("pushed too many line caps - check push/pop pairs");this._lineCapStack.push(1);this._lineCap=1;}},{key:"PushLineCapZag",value:function PushLineCapZag(){if(this._lineCapStack.length>=100)throw new Error("pushed too many line caps - check push/pop pairs");this._lineCapStack.push(2);this._lineCap=2;}},{key:"PopLineCap",value:function PopLineCap(){if(this._lineCapStack.length<=1)throw new Error("cannot pop last line cap - check push/pop pairs");this._lineCapStack.pop();this._lineCap=this._lineCapStack.at(-1);}},{key:"SetLineOffset",value:function SetLineOffset(n){this._lineOffset=n;this._lineOffsetStack[this._lineOffsetStack.length-1]=n;}},{key:"GetLineOffset",value:function GetLineOffset(){return this._lineOffset;}},{key:"PushLineOffset",value:function PushLineOffset(n){if(this._lineOffsetStack.length>=100)throw new Error("pushed too many line offsets - check push/pop pairs");this._lineOffsetStack.push(n);this._lineOffset=n;}},{key:"PopLineOffset",value:function PopLineOffset(){if(this._lineOffsetStack.length<=1)throw new Error("cannot pop last line offset - check push/pop pairs");this._lineOffsetStack.pop();this._lineOffset=this._lineOffsetStack.at(-1);}},{key:"ConvexPoly",value:function ConvexPoly(pts){var pts_count=pts.length/2;if(pts_count<3)throw new Error("need at least 3 points");var tris=pts_count-2;var last_tri=tris-1;var p0x=pts[0];var p0y=pts[1];for(var i=0;i<tris;i+=2){var i2=i*2;var p1x=pts[i2+2];var p1y=pts[i2+3];var p2x=pts[i2+4];var p2y=pts[i2+5];if(i===last_tri)this.Quad2(p0x,p0y,p1x,p1y,p2x,p2y,p2x,p2y);else{var p3x=pts[i2+6];var p3y=pts[i2+7];this.Quad2(p0x,p0y,p1x,p1y,p2x,p2y,p3x,p3y);}}}},{key:"GetNumVertexComponents",value:function GetNumVertexComponents(){return 3;}},{key:"Finish",value:function Finish(){this.EndBatch(true);this._frameNumber++;}},{key:"GetFrameNumber",value:function GetFrameNumber(){return this._frameNumber;}},{key:"IncrementFrameNumber",value:function IncrementFrameNumber(){this._frameNumber++;}},{key:"SetMipmapsEnabled",value:function SetMipmapsEnabled(e){this._enableMipmaps=!!e;}},{key:"AreMipmapsEnabled",value:function AreMipmapsEnabled(){return this._enableMipmaps;}},{key:"SetHasMajorPerformanceCaveat",value:function SetHasMajorPerformanceCaveat(c){this._hasMajorPerformanceCaveat=!!c;}},{key:"HasMajorPerformanceCaveat",value:function HasMajorPerformanceCaveat(){return this._hasMajorPerformanceCaveat;}},{key:"IsWebGL",value:function IsWebGL(){return false;}},{key:"IsWebGPU",value:function IsWebGPU(){return false;}},{key:"GetEstimatedBackBufferMemoryUsage",value:function GetEstimatedBackBufferMemoryUsage(){}},{key:"GetEstimatedRenderBufferMemoryUsage",value:function GetEstimatedRenderBufferMemoryUsage(){}},{key:"GetEstimatedTextureMemoryUsage",value:function GetEstimatedTextureMemoryUsage(){}},{key:"GetEstimatedTotalMemoryUsage",value:function GetEstimatedTotalMemoryUsage(){return this.GetEstimatedBackBufferMemoryUsage()+this.GetEstimatedRenderBufferMemoryUsage()+this.GetEstimatedTextureMemoryUsage();}}]);return RendererBase;}();}// ../lib/gfx/shaderProgramBase.js
{'use strict';var _C45=self.C3;_C45.Gfx.ShaderProgramBase=/*#__PURE__*/function(){function ShaderProgramBase(renderer,shaderInfo){_classCallCheck(this,ShaderProgramBase);this._name=shaderInfo.name;this._renderer=renderer;this._extendBoxHorizontal=shaderInfo.extendBoxHorizontal||0;this._extendBoxVertical=shaderInfo.extendBoxVertical||0;this._crossSampling=!!shaderInfo.crossSampling;this._mustPreDraw=!!shaderInfo.mustPreDraw;this._preservesOpaqueness=!!shaderInfo.preservesOpaqueness;this._animated=!!shaderInfo.animated;this._blendsBackground=!!shaderInfo.blendsBackground;this._usesDepth=!!shaderInfo.usesDepth;this._usesAnySrcRectOrPixelSize=false;this._needsPostDrawOrExtendBox=this._crossSampling||this._blendsBackground||this._extendBoxHorizontal!==0||this._extendBoxVertical!==0;}_createClass(ShaderProgramBase,[{key:"Release",value:function Release(){this._renderer=null;}},{key:"GetRenderer",value:function GetRenderer(){return this._renderer;}},{key:"GetName",value:function GetName(){return this._name;}},{key:"ExtendsBox",value:function ExtendsBox(){return this._extendBoxHorizontal!==0||this._extendBoxVertical!==0;}},{key:"GetBoxExtendHorizontal",value:function GetBoxExtendHorizontal(){return this._extendBoxHorizontal;}},{key:"GetBoxExtendVertical",value:function GetBoxExtendVertical(){return this._extendBoxVertical;}},{key:"UsesCrossSampling",value:function UsesCrossSampling(){return this._crossSampling;}},{key:"MustPreDraw",value:function MustPreDraw(){return this._mustPreDraw;}},{key:"PreservesOpaqueness",value:function PreservesOpaqueness(){return this._preservesOpaqueness;}},{key:"IsAnimated",value:function IsAnimated(){return this._animated;}},{key:"BlendsBackground",value:function BlendsBackground(){return this._blendsBackground;}},{key:"UsesDepth",value:function UsesDepth(){return this._usesDepth;}},{key:"UsesAnySrcRectOrPixelSize",value:function UsesAnySrcRectOrPixelSize(){return this._usesAnySrcRectOrPixelSize;}},{key:"NeedsPostDrawOrExtendsBox",value:function NeedsPostDrawOrExtendsBox(){return this._needsPostDrawOrExtendBox;}},{key:"UsesIsSrcTexRotated",value:function UsesIsSrcTexRotated(){return false;}}]);return ShaderProgramBase;}();}// ../lib/gfx/stateGroup.js
{'use strict';var _C46=self.C3;_C46.Gfx.StateGroup=/*#__PURE__*/function(){function StateGroup(renderer,shaderProgram_or_name,blendMode,color,zElevation){_classCallCheck(this,StateGroup);this._renderer=renderer;this._refCount=0;this._shaderProgram=null;this._shaderProgramName="";this._blendMode=blendMode;this._color=_C46.New(_C46.Color);this._color.set(color);this._zElevation=zElevation;if(typeof shaderProgram_or_name==="string")this._shaderProgramName=shaderProgram_or_name;else{this._shaderProgram=shaderProgram_or_name;this._shaderProgramName=this._shaderProgram.GetName();}}_createClass(StateGroup,[{key:"Release",value:function Release(){if(this._refCount>0)throw new Error("releasing state group still in use");this._renderer=null;this._shaderProgram=null;this._shaderProgramName="";}},{key:"Apply",value:function Apply(){var renderer=this._renderer;renderer.SetProgram(this._shaderProgram);renderer.SetBlendMode(this._blendMode);renderer.SetColor(this._color);renderer.SetCurrentZ(this._zElevation);renderer._SetCurrentStateGroup(this);}},{key:"GetKey",value:function GetKey(){return _C46.Gfx.StateGroup.MakeKey(this._shaderProgramName,this._blendMode,this._color,this._zElevation);}},{key:"AddRef",value:function AddRef(){++this._refCount;}},{key:"DecRef",value:function DecRef(){--this._refCount;}},{key:"_GetRefCount",value:function _GetRefCount(){return this._refCount;}},{key:"OnContextLost",value:function OnContextLost(){this._shaderProgram=null;}},{key:"OnContextRestored",value:function OnContextRestored(renderer){this._shaderProgram=renderer.GetShaderProgramByName(this._shaderProgramName);if(!this._shaderProgram)throw new Error("failed to restore shader program");}}],[{key:"MakeKey",value:function MakeKey(shaderProgram_or_name,blendMode,c,zElevation){var shaderProgramName=typeof shaderProgram_or_name==="string"?shaderProgram_or_name:shaderProgram_or_name.GetName();return shaderProgramName+","+blendMode+","+c.getR()+","+c.getG()+","+c.getB()+","+c.getA()+","+zElevation;}}]);return StateGroup;}();}// ../lib/gfx/mesh.js
{var interpolateQuad=function interpolateQuad(srcX,srcY,quad){var qtlx=quad.getTlx();var qtly=quad.getTly();var qtrx=quad.getTrx()-qtlx;var qtry=quad.getTry()-qtly;var qblx=quad.getBlx()-qtlx;var qbly=quad.getBly()-qtly;var xix=qtrx*srcX;var xiy=qtry*srcX;var yix=qblx*srcY;var yiy=qbly*srcY;return[qtlx+xix+yix,qtly+xiy+yiy];};'use strict';var _C47=self.C3;var tempQuadTex=_C47.New(_C47.Quad);_C47.Gfx.MeshPoint=/*#__PURE__*/function(){function MeshPoint(mesh,col,row){_classCallCheck(this,MeshPoint);this._mesh=mesh;this._col=col;this._row=row;this._x=NaN;this._y=NaN;this._zElevation=NaN;this._u=NaN;this._v=NaN;this._x=0;this._y=0;this._zElevation=0;this._u=0;this._v=0;}_createClass(MeshPoint,[{key:"_Init",value:function _Init(x,y,u,v){this._x=x;this._y=y;this._u=u;this._v=v;}},{key:"GetX",value:function GetX(){return this._x;}},{key:"SetX",value:function SetX(x){if(this._x===x)return;this._x=x;this._mesh._SetPointsChanged();}},{key:"GetY",value:function GetY(){return this._y;}},{key:"SetY",value:function SetY(y){if(this._y===y)return;this._y=y;this._mesh._SetPointsChanged();}},{key:"GetZElevation",value:function GetZElevation(){return this._zElevation;}},{key:"SetZElevation",value:function SetZElevation(z){if(this._zElevation===z)return;this._zElevation=Math.max(z,0);this._mesh._SetPointsChanged();}},{key:"GetU",value:function GetU(){return this._u;}},{key:"SetU",value:function SetU(u){this._u=u;}},{key:"GetV",value:function GetV(){return this._v;}},{key:"SetV",value:function SetV(v){this._v=v;}},{key:"_Interpolate_TexRect",value:function _Interpolate_TexRect(srcPoint,quadPos,rcTex){var _interpolateQuad=interpolateQuad(srcPoint._x,srcPoint._y,quadPos);var _interpolateQuad2=_slicedToArray(_interpolateQuad,2);this._x=_interpolateQuad2[0];this._y=_interpolateQuad2[1];this._zElevation=srcPoint._zElevation;this._u=_C47.lerp(rcTex.getLeft(),rcTex.getRight(),srcPoint._u);this._v=_C47.lerp(rcTex.getTop(),rcTex.getBottom(),srcPoint._v);}},{key:"_Interpolate_TexQuad",value:function _Interpolate_TexQuad(srcPoint,quadPos,quadTex){var _interpolateQuad3=interpolateQuad(srcPoint._x,srcPoint._y,quadPos);var _interpolateQuad4=_slicedToArray(_interpolateQuad3,2);this._x=_interpolateQuad4[0];this._y=_interpolateQuad4[1];this._zElevation=srcPoint._zElevation;var _interpolateQuad5=interpolateQuad(srcPoint._u,srcPoint._v,quadTex);var _interpolateQuad6=_slicedToArray(_interpolateQuad5,2);this._u=_interpolateQuad6[0];this._v=_interpolateQuad6[1];}},{key:"SaveToJson",value:function SaveToJson(){return{"x":this.GetX(),"y":this.GetY(),"z":this.GetZElevation(),"u":this.GetU(),"v":this.GetV()};}},{key:"LoadFromJson",value:function LoadFromJson(o){this.SetX(o["x"]);this.SetY(o["y"]);if(o.hasOwnProperty("z"))this.SetZElevation(o["z"]);this.SetU(o["u"]);this.SetV(o["v"]);}},{key:"GetMesh",value:function GetMesh(){return this._mesh;}},{key:"GetColumn",value:function GetColumn(){return this._col;}},{key:"GetRow",value:function GetRow(){return this._row;}}]);return MeshPoint;}();_C47.Gfx.Mesh=/*#__PURE__*/function(){function Mesh(hsize,vsize,owner){_classCallCheck(this,Mesh);if(hsize<2||vsize<2)throw new Error("invalid mesh size");this._hsize=hsize;this._vsize=vsize;this._owner=owner||null;this._pts=[];this._minX=0;this._minY=0;this._maxX=1;this._maxY=1;this._maxZ=0;this._pointsChanged=false;var lastX=hsize-1;var lastY=vsize-1;for(var y=0;y<vsize;++y){var row=[];for(var x=0;x<hsize;++x){var meshPoint=_C47.New(_C47.Gfx.MeshPoint,this,x,y);var xf=x/lastX;var yf=y/lastY;meshPoint._Init(xf,yf,xf,yf);row.push(meshPoint);}this._pts.push(row);}}_createClass(Mesh,[{key:"Release",value:function Release(){_C47.clearArray(this._pts);}},{key:"GetHSize",value:function GetHSize(){return this._hsize;}},{key:"GetVSize",value:function GetVSize(){return this._vsize;}},{key:"GetOwner",value:function GetOwner(){return this._owner;}},{key:"_GetPoints",value:function _GetPoints(){return this._pts;}},{key:"_SetPointsChanged",value:function _SetPointsChanged(){this._pointsChanged=true;}},{key:"_MaybeComputeBounds",value:function _MaybeComputeBounds(){if(!this._pointsChanged)return;var minX=Infinity;var minY=Infinity;var maxX=-Infinity;var maxY=-Infinity;var maxZ=0;var _iteratorNormalCompletion68=true;var _didIteratorError68=false;var _iteratorError68=undefined;try{for(var _iterator68=this._pts[Symbol.iterator](),_step68;!(_iteratorNormalCompletion68=(_step68=_iterator68.next()).done);_iteratorNormalCompletion68=true){var row=_step68.value;var _iteratorNormalCompletion69=true;var _didIteratorError69=false;var _iteratorError69=undefined;try{for(var _iterator69=row[Symbol.iterator](),_step69;!(_iteratorNormalCompletion69=(_step69=_iterator69.next()).done);_iteratorNormalCompletion69=true){var meshPoint=_step69.value;var x=meshPoint.GetX();var y=meshPoint.GetY();minX=Math.min(minX,x);minY=Math.min(minY,y);maxX=Math.max(maxX,x);maxY=Math.max(maxY,y);maxZ=Math.max(maxZ,meshPoint.GetZElevation());}}catch(err){_didIteratorError69=true;_iteratorError69=err;}finally{try{if(!_iteratorNormalCompletion69&&_iterator69["return"]!=null){_iterator69["return"]();}}finally{if(_didIteratorError69){throw _iteratorError69;}}}}}catch(err){_didIteratorError68=true;_iteratorError68=err;}finally{try{if(!_iteratorNormalCompletion68&&_iterator68["return"]!=null){_iterator68["return"]();}}finally{if(_didIteratorError68){throw _iteratorError68;}}}this._minX=minX;this._minY=minY;this._maxX=maxX;this._maxY=maxY;this._maxZ=maxZ;this._pointsChanged=false;}},{key:"GetMinX",value:function GetMinX(){this._MaybeComputeBounds();return this._minX;}},{key:"GetMinY",value:function GetMinY(){this._MaybeComputeBounds();return this._minY;}},{key:"GetMaxX",value:function GetMaxX(){this._MaybeComputeBounds();return this._maxX;}},{key:"GetMaxY",value:function GetMaxY(){this._MaybeComputeBounds();return this._maxY;}},{key:"GetMaxZ",value:function GetMaxZ(){this._MaybeComputeBounds();return this._maxZ;}},{key:"HasAnyZElevation",value:function HasAnyZElevation(){return this.GetMaxZ()>0;}},{key:"GetMeshPointAt",value:function GetMeshPointAt(x,y){x=Math.floor(x);y=Math.floor(y);if(x<0||x>=this._hsize||y<0||y>=this._vsize)return null;return this._pts[y][x];}},{key:"CalculateTransformedMesh",value:function CalculateTransformedMesh(srcMesh,quadPos,rcTex_or_quad){var isTexRect=rcTex_or_quad instanceof _C47.Rect;if(srcMesh.GetHSize()!==this.GetHSize()||srcMesh.GetVSize()!==this.GetVSize())throw new Error("source mesh wrong size");var srcPts=srcMesh._pts;var destPts=this._pts;for(var y=0,lenY=destPts.length;y<lenY;++y){var srcRow=srcPts[y];var destRow=destPts[y];for(var x=0,lenX=destRow.length;x<lenX;++x){var srcPoint=srcRow[x];var destPoint=destRow[x];if(isTexRect)destPoint._Interpolate_TexRect(srcPoint,quadPos,rcTex_or_quad);else destPoint._Interpolate_TexQuad(srcPoint,quadPos,rcTex_or_quad);}}}},{key:"Draw",value:function Draw(renderer){var pts=this._pts;var prevRow=pts[0];for(var y=1,lenY=pts.length;y<lenY;++y){var row=pts[y];var tl=prevRow[0];var bl=row[0];for(var x=1,lenX=row.length;x<lenX;++x){var tr=prevRow[x];var br=row[x];tempQuadTex.set(tl.GetU(),tl.GetV(),tr.GetU(),tr.GetV(),br.GetU(),br.GetV(),bl.GetU(),bl.GetV());renderer.Quad3D2(tl.GetX(),tl.GetY(),tl.GetZElevation(),tr.GetX(),tr.GetY(),tr.GetZElevation(),br.GetX(),br.GetY(),br.GetZElevation(),bl.GetX(),bl.GetY(),bl.GetZElevation(),tempQuadTex);tl=tr;bl=br;}prevRow=row;}}},{key:"Outline",value:function Outline(renderer,transformFunc){if(!transformFunc)transformFunc=function transformFunc(x,y,z){return[x,y,z];};var pts=this._pts;var prevRow=pts[0];for(var y=1,lenY=pts.length;y<lenY;++y){var row=pts[y];var tl=prevRow[0];var bl=row[0];for(var x=1,lenX=row.length;x<lenX;++x){var tr=prevRow[x];var br=row[x];var _transformFunc=transformFunc(tl.GetX(),tl.GetY(),tl.GetZElevation()),_transformFunc2=_slicedToArray(_transformFunc,3),tlx=_transformFunc2[0],tly=_transformFunc2[1],tlz=_transformFunc2[2];var _transformFunc3=transformFunc(tr.GetX(),tr.GetY(),tr.GetZElevation()),_transformFunc4=_slicedToArray(_transformFunc3,3),trx=_transformFunc4[0],try_=_transformFunc4[1],trz=_transformFunc4[2];var _transformFunc5=transformFunc(br.GetX(),br.GetY(),br.GetZElevation()),_transformFunc6=_slicedToArray(_transformFunc5,3),brx=_transformFunc6[0],bry=_transformFunc6[1],brz=_transformFunc6[2];var _transformFunc7=transformFunc(bl.GetX(),bl.GetY(),bl.GetZElevation()),_transformFunc8=_slicedToArray(_transformFunc7,3),blx=_transformFunc8[0],bly=_transformFunc8[1],blz=_transformFunc8[2];renderer.Line3D(tlx,tly,tlz,trx,try_,trz);renderer.Line3D(tlx,tly,tlz,brx,bry,brz);renderer.Line3D(tlx,tly,tlz,blx,bly,blz);if(x===lenX-1)renderer.Line3D(trx,try_,trz,brx,bry,brz);if(y===lenY-1)renderer.Line3D(blx,bly,blz,brx,bry,brz);tl=tr;bl=br;}prevRow=row;}}},{key:"InsertPolyMeshVertices",value:function InsertPolyMeshVertices(srcPoly){var RAY_EXT_DIST=.001;var MIN_RAY_DIST=0;var MAX_RAY_DIST=.99999999;var inPts=srcPoly.pointsArr();var outPts=[];var colCount=this.GetHSize()-1;var rowCount=this.GetVSize()-1;var colWidthNorm=1/colCount;var rowHeightNorm=1/rowCount;var lastCol=colCount-1;var lastRow=rowCount-1;var curX=inPts[0];var curY=inPts[1];var curCol=_C47.clamp(Math.floor(curX*colCount),0,lastCol);var curRow=_C47.clamp(Math.floor(curY*rowCount),0,lastRow);var isUpper=true;var nextX=0;var nextY=0;var rayHit=0;var NOTHING_DISABLED=-1;var DISABLE_DIAGONAL=0;var DISABLE_LEFT_EDGE=1;var DISABLE_TOP_EDGE=2;var DISABLE_RIGHT_EDGE=3;var DISABLE_BOTTOM_EDGE=4;var disableCheck=NOTHING_DISABLED;var addVertexAtRayHit=function addVertexAtRayHit(){curX=_C47.clamp(_C47.lerp(curX,nextX,rayHit),0,1);curY=_C47.clamp(_C47.lerp(curY,nextY,rayHit),0,1);outPts.push(curX,curY);};for(var i=0,len=inPts.length;i<len;i+=2){curX=inPts[i];curY=inPts[i+1];outPts.push(curX,curY);curCol=_C47.clamp(Math.floor(curX*colCount),0,lastCol);curRow=_C47.clamp(Math.floor(curY*rowCount),0,lastRow);var j=(i+2)%len;nextX=inPts[j];nextY=inPts[j+1];disableCheck=NOTHING_DISABLED;while(true){if(outPts.length>1E6)throw new Error("Too many mesh poly points");var srcTlx=curCol*colWidthNorm;var srcTly=curRow*rowHeightNorm;var srcBrx=(curCol+1)*colWidthNorm;var srcBry=(curRow+1)*rowHeightNorm;isUpper=_C47.isPointInTriangleInclusive(curX,curY,srcTlx,srcTly,srcBrx,srcTly,srcBrx,srcBry);if(disableCheck!==DISABLE_DIAGONAL){rayHit=_C47.rayIntersectExtended(curX,curY,nextX,nextY,srcTlx,srcTly,srcBrx,srcBry,-RAY_EXT_DIST);if(rayHit>=MIN_RAY_DIST&&rayHit<=MAX_RAY_DIST){addVertexAtRayHit();isUpper=!isUpper;disableCheck=DISABLE_DIAGONAL;continue;}}if(curRow>0&&disableCheck!==DISABLE_TOP_EDGE){rayHit=_C47.rayIntersectExtended(curX,curY,nextX,nextY,srcTlx,srcTly,srcBrx,srcTly,RAY_EXT_DIST);if(rayHit>=MIN_RAY_DIST&&rayHit<=MAX_RAY_DIST){addVertexAtRayHit();curRow--;isUpper=false;disableCheck=DISABLE_BOTTOM_EDGE;continue;}}if(curCol<lastCol&&disableCheck!==DISABLE_RIGHT_EDGE){rayHit=_C47.rayIntersectExtended(curX,curY,nextX,nextY,srcBrx,srcTly,srcBrx,srcBry,RAY_EXT_DIST);if(rayHit>=MIN_RAY_DIST&&rayHit<=MAX_RAY_DIST){addVertexAtRayHit();curCol++;isUpper=false;disableCheck=DISABLE_LEFT_EDGE;continue;}}if(curCol>0&&disableCheck!==DISABLE_LEFT_EDGE){rayHit=_C47.rayIntersectExtended(curX,curY,nextX,nextY,srcTlx,srcTly,srcTlx,srcBry,RAY_EXT_DIST);if(rayHit>=MIN_RAY_DIST&&rayHit<=MAX_RAY_DIST){addVertexAtRayHit();curCol--;isUpper=true;disableCheck=DISABLE_RIGHT_EDGE;continue;}}if(curRow<lastRow&&disableCheck!==DISABLE_BOTTOM_EDGE){rayHit=_C47.rayIntersectExtended(curX,curY,nextX,nextY,srcTlx,srcBry,srcBrx,srcBry,RAY_EXT_DIST);if(rayHit>=MIN_RAY_DIST&&rayHit<=MAX_RAY_DIST){addVertexAtRayHit();curRow++;isUpper=true;disableCheck=DISABLE_TOP_EDGE;continue;}}break;}}return _C47.New(_C47.CollisionPoly,outPts);}},{key:"TransformCollisionPoly",value:function TransformCollisionPoly(srcPoly,destPoly){var ptsArr=this._TransformPolyPoints(srcPoly);this._SimplifyPoly(ptsArr);destPoly.setPoints(ptsArr);}},{key:"_TransformPolyPoints",value:function _TransformPolyPoints(srcPoly){var outPts=[];var ptsArr=srcPoly.pointsArr();for(var i=0,len=ptsArr.length;i<len;i+=2){var srcX=ptsArr[i];var srcY=ptsArr[i+1];var _this$TransformPoint=this.TransformPoint(srcX,srcY),_this$TransformPoint2=_slicedToArray(_this$TransformPoint,2),destX=_this$TransformPoint2[0],destY=_this$TransformPoint2[1];outPts.push(destX,destY);}return outPts;}},{key:"TransformPoint",value:function TransformPoint(srcX,srcY){var lastCol=this.GetHSize()-1;var lastRow=this.GetVSize()-1;var colWidthNorm=1/lastCol;var rowHeightNorm=1/lastRow;var srcCol=_C47.clamp(Math.floor(srcX*lastCol),0,lastCol-1);var srcRow=_C47.clamp(Math.floor(srcY*lastRow),0,lastRow-1);var srcTlx=srcCol*colWidthNorm;var srcTly=srcRow*rowHeightNorm;var srcBrx=(srcCol+1)*colWidthNorm;var srcBry=(srcRow+1)*rowHeightNorm;var destTl=this.GetMeshPointAt(srcCol,srcRow);var destBr=this.GetMeshPointAt(srcCol+1,srcRow+1);var isUpper=_C47.isPointInTriangleInclusive(srcX,srcY,srcTlx,srcTly,srcBrx,srcTly,srcBrx,srcBry);var srcAltX=isUpper?srcTlx+colWidthNorm:srcTlx;var srcAltY=isUpper?srcTly:srcTly+rowHeightNorm;var destAlt=this.GetMeshPointAt(srcCol+(isUpper?1:0),srcRow+(isUpper?0:1));var _C47$triangleCartesia=_C47.triangleCartesianToBarycentric(srcX,srcY,srcTlx,srcTly,srcAltX,srcAltY,srcBrx,srcBry),_C47$triangleCartesia2=_slicedToArray(_C47$triangleCartesia,3),u=_C47$triangleCartesia2[0],v=_C47$triangleCartesia2[1],w=_C47$triangleCartesia2[2];return _C47.triangleBarycentricToCartesian3d(u,v,w,destTl.GetX(),destTl.GetY(),destTl.GetZElevation(),destAlt.GetX(),destAlt.GetY(),destAlt.GetZElevation(),destBr.GetX(),destBr.GetY(),destBr.GetZElevation());}},{key:"_SimplifyPoly",value:function _SimplifyPoly(ptsArr){var outPts=[];var NZ_EPSILON=1E-7;var R_EPSILON=.001;var curX=ptsArr[0];var curY=ptsArr[1];var lastDx=curX-ptsArr.at(-2);var lastDy=curY-ptsArr.at(-1);for(var i=0,len=ptsArr.length;i<len;i+=2){var j=(i+2)%len;var nextX=ptsArr[j];var nextY=ptsArr[j+1];var dx=nextX-curX;var dy=nextY-curY;var bothXNearZero=Math.abs(dx)<NZ_EPSILON&&Math.abs(lastDx)<NZ_EPSILON&&Math.sign(dy)===Math.sign(lastDy);var bothYNearZero=Math.abs(dy)<NZ_EPSILON&&Math.abs(lastDy)<NZ_EPSILON&&Math.sign(dx)===Math.sign(lastDx);if(!bothXNearZero&&!bothYNearZero&&Math.abs(dx/lastDx-dy/lastDy)>R_EPSILON||dx==0&&dy===0)outPts.push(curX,curY);curX=nextX;curY=nextY;lastDx=dx;lastDy=dy;}if(outPts.length>=6&&outPts.length<ptsArr.length)_C47.shallowAssignArray(ptsArr,outPts);}},{key:"SaveToJson",value:function SaveToJson(){return{"cols":this.GetHSize(),"rows":this.GetVSize(),"points":this._pts.map(function(row){return row.map(function(pt){return pt.SaveToJson();});})};}},{key:"LoadFromJson",value:function LoadFromJson(o){var cols=this.GetHSize();var rows=this.GetVSize();if(o["cols"]!==cols||o["rows"]!==rows)throw new Error("mesh data wrong size");var meshRows=o["points"];for(var y=0;y<rows;++y){var rowData=meshRows[y];for(var x=0;x<cols;++x){var pt=this.GetMeshPointAt(x,y);pt.LoadFromJson(rowData[x]);}}}}]);return Mesh;}();}// ../lib/gfx/webgl/texture.js
{var GetFormatSpecifiers=function GetFormatSpecifiers(pixelFormat,gl){var sizedinternalformat;var internalformat;var format;var type;switch(pixelFormat){case"rgba8":sizedinternalformat=gl.RGBA8;internalformat=gl.RGBA;format=gl.RGBA;type=gl.UNSIGNED_BYTE;break;case"rgb8":sizedinternalformat=gl.RGB8;internalformat=gl.RGB;format=gl.RGB;type=gl.UNSIGNED_BYTE;break;case"rgba4":sizedinternalformat=gl.RGBA4;internalformat=gl.RGBA;format=gl.RGBA;type=gl.UNSIGNED_SHORT_4_4_4_4;break;case"rgb5_a1":sizedinternalformat=gl.RGB5_A1;internalformat=gl.RGBA;format=gl.RGBA;type=gl.UNSIGNED_SHORT_5_5_5_1;break;case"rgb565":sizedinternalformat=gl.RGB565;internalformat=gl.RGB;format=gl.RGB;type=gl.UNSIGNED_SHORT_5_6_5;break;default:throw new Error("invalid pixel format");}return{sizedinternalformat:sizedinternalformat,internalformat:internalformat,format:format,type:type};};'use strict';var _C48=self.C3;var VALID_PIXEL_FORMATS=new Set(["rgba8","rgb8","rgba4","rgb5_a1","rgb565"]);var VALID_SAMPLINGS=new Set(["nearest","bilinear","trilinear"]);var VALID_MIPMAP_QUALITIES=new Set(["default","low","high"]);var VALID_WRAP_MODES=new Set(["clamp-to-edge","repeat","mirror-repeat"]);var CREATEFROM_DEFAULT_OPTIONS={wrapX:"clamp-to-edge",wrapY:"clamp-to-edge",sampling:"trilinear",anisotropy:0,pixelFormat:"rgba8",mipMap:true,mipMapQuality:"default",premultiplyAlpha:true,isSvg:false,width:-1,height:-1};var UPDATE_DEFAULT_OPTIONS={premultiplyAlpha:true,flipY:false};var _allTextures=new Set();_C48.Gfx.WebGLRendererTexture=/*#__PURE__*/function(){function WebGLRendererTexture(renderer){_classCallCheck(this,WebGLRendererTexture);this._renderer=renderer;this._texture=null;this._width=0;this._height=0;this._isStatic=true;this._wrapX="clamp-to-edge";this._wrapY="clamp-to-edge";this._sampling="trilinear";this._anisotropy=0;this._pixelFormat="rgba8";this._isMipMapped=false;this._mipMapQuality="default";this._refCount=0;}_createClass(WebGLRendererTexture,[{key:"_CreateStatic",value:function _CreateStatic(data,opts){if((typeof HTMLImageElement==="undefined"||!(data instanceof HTMLImageElement))&&(typeof HTMLCanvasElement==="undefined"||!(data instanceof HTMLCanvasElement))&&(typeof ImageBitmap==="undefined"||!(data instanceof ImageBitmap))&&(typeof OffscreenCanvas==="undefined"||!(data instanceof OffscreenCanvas))&&!(data instanceof ImageData)&&!(data instanceof ArrayBuffer)&&data!==null)throw new Error("invalid texture source");opts=Object.assign({},CREATEFROM_DEFAULT_OPTIONS,opts);if(this._texture)throw new Error("already created texture");this._wrapX=opts.wrapX;this._wrapY=opts.wrapY;this._sampling=opts.sampling;this._anisotropy=opts.anisotropy;this._pixelFormat=opts.pixelFormat;this._isMipMapped=!!opts.mipMap&&this._renderer.AreMipmapsEnabled();this._mipMapQuality=opts.mipMapQuality;if(!VALID_WRAP_MODES.has(this._wrapX)||!VALID_WRAP_MODES.has(this._wrapY))throw new Error("invalid wrap mode");if(!VALID_SAMPLINGS.has(this._sampling))throw new Error("invalid sampling");if(!VALID_PIXEL_FORMATS.has(this._pixelFormat))throw new Error("invalid pixel format");if(!VALID_MIPMAP_QUALITIES.has(this._mipMapQuality))throw new Error("invalid mipmap quality");this._isStatic=true;if(data instanceof ArrayBuffer||data===null||opts.isSvg){this._width=opts.width;this._height=opts.height;if(data instanceof ArrayBuffer&&data.byteLength!==this._width*this._height*4)throw new Error("ArrayBuffer wrong size");}else{this._width=data.width;this._height=data.height;}if(this._width<=0||this._height<=0)throw new Error("invalid texture data size");if(opts.isSvg){var canvas=_C48.CreateCanvas(this._width,this._height);var ctx=canvas.getContext("2d");ctx.drawImage(data,0,0,this._width,this._height);data=canvas;}var isPOT=_C48.isPOT(this._width)&&_C48.isPOT(this._height);var maxTextureSize=this._renderer.GetMaxTextureSize();if(this._width>maxTextureSize||this._height>maxTextureSize)throw new Error("texture data exceeds maximum texture size");var gl=this._renderer.GetContext();var webglVersion=this._renderer.GetWebGLVersionNumber();this._texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,this._texture);gl.pixelStorei(gl["UNPACK_PREMULTIPLY_ALPHA_WEBGL"],opts.premultiplyAlpha);gl.pixelStorei(gl["UNPACK_FLIP_Y_WEBGL"],false);var formatspec=GetFormatSpecifiers(this._pixelFormat,gl);if(!this._renderer.SupportsNPOTTextures()&&!isPOT&&this._IsTiled()){if(data===null)throw new Error("cannot pass null data when creating a NPOT tiled texture without NPOT support");if(data instanceof ArrayBuffer)data=new ImageData(new Uint8ClampedArray(data),this._width,this._height);if(data instanceof ImageData){var tmpCanvas=_C48.CreateCanvas(this._width,this._height);var tmpCtx=tmpCanvas.getContext("2d");tmpCtx.putImageData(data,0,0);data=tmpCanvas;}var _canvas=_C48.CreateCanvas(_C48.nextHighestPowerOfTwo(this._width),_C48.nextHighestPowerOfTwo(this._height));var _ctx=_canvas.getContext("2d");_ctx.imageSmoothingEnabled=this._sampling!=="nearest";_ctx.drawImage(data,0,0,this._width,this._height,0,0,_canvas.width,_canvas.height);gl.texImage2D(gl.TEXTURE_2D,0,formatspec.internalformat,formatspec.format,formatspec.type,_canvas);}else if(webglVersion>=2){var levels;if(this._isMipMapped)levels=Math.floor(Math.log2(Math.max(this._width,this._height))+1);else levels=1;gl.texStorage2D(gl.TEXTURE_2D,levels,formatspec.sizedinternalformat,this._width,this._height);if(data instanceof ArrayBuffer)gl.texSubImage2D(gl.TEXTURE_2D,0,0,0,this._width,this._height,formatspec.format,formatspec.type,new Uint8Array(data));else if(data!==null)gl.texSubImage2D(gl.TEXTURE_2D,0,0,0,formatspec.format,formatspec.type,data);}else if(data instanceof ArrayBuffer)gl.texImage2D(gl.TEXTURE_2D,0,formatspec.internalformat,this._width,this._height,0,formatspec.format,formatspec.type,new Uint8Array(data));else if(data===null)gl.texImage2D(gl.TEXTURE_2D,0,formatspec.internalformat,this._width,this._height,0,formatspec.format,formatspec.type,null);else gl.texImage2D(gl.TEXTURE_2D,0,formatspec.internalformat,formatspec.format,formatspec.type,data);if(data!==null)this._SetTextureParameters(gl);gl.bindTexture(gl.TEXTURE_2D,null);this._renderer._ResetLastTexture();this._refCount=1;_allTextures.add(this);}},{key:"_CreateDynamic",value:function _CreateDynamic(width,height,opts){opts=Object.assign({},CREATEFROM_DEFAULT_OPTIONS,opts);if(this._texture)throw new Error("already created texture");this._wrapX=opts.wrapX;this._wrapY=opts.wrapY;this._sampling=opts.sampling;this._pixelFormat=opts.pixelFormat;this._isMipMapped=!!opts.mipMap&&this._renderer.AreMipmapsEnabled();this._mipMapQuality=opts.mipMapQuality;if(!VALID_WRAP_MODES.has(this._wrapX)||!VALID_WRAP_MODES.has(this._wrapY))throw new Error("invalid wrap mode");if(!VALID_SAMPLINGS.has(this._sampling))throw new Error("invalid sampling");if(!VALID_PIXEL_FORMATS.has(this._pixelFormat))throw new Error("invalid pixel format");if(!VALID_MIPMAP_QUALITIES.has(this._mipMapQuality))throw new Error("invalid mipmap quality");this._isStatic=false;this._width=Math.floor(width);this._height=Math.floor(height);var isPOT=_C48.isPOT(this._width)&&_C48.isPOT(this._height);var maxTextureSize=this._renderer.GetMaxTextureSize();if(this._width<=0||this._height<=0)throw new Error("invalid texture size");if(this._width>maxTextureSize||this._height>maxTextureSize)throw new Error("texture exceeds maximum texture size");if(!this._renderer.SupportsNPOTTextures()&&this._IsTiled()&&!isPOT)throw new Error("non-power-of-two tiled textures not supported");var gl=this._renderer.GetContext();var webglVersion=this._renderer.GetWebGLVersionNumber();this._texture=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,this._texture);gl.pixelStorei(gl["UNPACK_PREMULTIPLY_ALPHA_WEBGL"],opts.premultiplyAlpha);gl.pixelStorei(gl["UNPACK_FLIP_Y_WEBGL"],false);var formatspec=GetFormatSpecifiers(this._pixelFormat,gl);var internalformat=webglVersion>=2?formatspec.sizedinternalformat:formatspec.internalformat;gl.texImage2D(gl.TEXTURE_2D,0,internalformat,this._width,this._height,0,formatspec.format,formatspec.type,null);this._SetTextureParameters(gl);gl.bindTexture(gl.TEXTURE_2D,null);this._renderer._ResetLastTexture();this._refCount=1;_allTextures.add(this);}},{key:"_GetMipMapHint",value:function _GetMipMapHint(gl){if(this._mipMapQuality==="default")return this._isStatic?gl.NICEST:gl.FASTEST;else if(this._mipMapQuality==="low")return gl.FASTEST;else if(this._mipMapQuality==="high")return gl.NICEST;else throw new Error("invalid mipmap quality");}},{key:"_IsTiled",value:function _IsTiled(){return this._wrapX!=="clamp-to-edge"||this._wrapY!=="clamp-to-edge";}},{key:"_GetTextureWrapMode",value:function _GetTextureWrapMode(gl,wrapMode){if(wrapMode==="clamp-to-edge")return gl.CLAMP_TO_EDGE;else if(wrapMode==="repeat")return gl.REPEAT;else if(wrapMode==="mirror-repeat")return gl.MIRRORED_REPEAT;else throw new Error("invalid wrap mode");}},{key:"_SetTextureParameters",value:function _SetTextureParameters(gl){var isPOT=_C48.isPOT(this._width)&&_C48.isPOT(this._height);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,this._GetTextureWrapMode(gl,this._wrapX));gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,this._GetTextureWrapMode(gl,this._wrapY));if(this._sampling==="nearest"){gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST);this._isMipMapped=false;}else{gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.LINEAR);if((isPOT||this._renderer.SupportsNPOTTextures())&&this._isMipMapped){gl.hint(gl.GENERATE_MIPMAP_HINT,this._GetMipMapHint(gl));gl.generateMipmap(gl.TEXTURE_2D);var useTrilinear=this._sampling==="trilinear"&&!this._renderer.HasMajorPerformanceCaveat();gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,useTrilinear?gl.LINEAR_MIPMAP_LINEAR:gl.LINEAR_MIPMAP_NEAREST);}else{gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.LINEAR);this._isMipMapped=false;}}var anisotropicExt=this._renderer._GetAnisotropicExtension();if(anisotropicExt&&this._anisotropy>0&&this._sampling!=="nearest")gl.texParameterf(gl.TEXTURE_2D,anisotropicExt["TEXTURE_MAX_ANISOTROPY_EXT"],Math.min(this._anisotropy,this._renderer._GetMaxAnisotropy()));}},{key:"_Update",value:function _Update(data,opts){if((typeof HTMLImageElement==="undefined"||!(data instanceof HTMLImageElement))&&(typeof HTMLVideoElement==="undefined"||!(data instanceof HTMLVideoElement))&&(typeof HTMLCanvasElement==="undefined"||!(data instanceof HTMLCanvasElement))&&(typeof ImageBitmap==="undefined"||!(data instanceof ImageBitmap))&&(typeof OffscreenCanvas==="undefined"||!(data instanceof OffscreenCanvas))&&!(data instanceof ImageData))throw new Error("invalid texture source");if(!this._texture||this._refCount<=0)throw new Error("texture not created");if(this._isStatic)throw new Error("cannot update static texture");opts=Object.assign({},UPDATE_DEFAULT_OPTIONS,opts);var dataWidth=data.width||data.videoWidth;var dataHeight=data.height||data.videoHeight;var webglVersion=this._renderer.GetWebGLVersionNumber();var gl=this._renderer.GetContext();gl.bindTexture(gl.TEXTURE_2D,this._texture);gl.pixelStorei(gl["UNPACK_PREMULTIPLY_ALPHA_WEBGL"],opts.premultiplyAlpha);gl.pixelStorei(gl["UNPACK_FLIP_Y_WEBGL"],!!opts.flipY);var formatspec=GetFormatSpecifiers(this._pixelFormat,gl);var internalformat=webglVersion>=2?formatspec.sizedinternalformat:formatspec.internalformat;try{if(this._width===dataWidth&&this._height===dataHeight){var isPOT=_C48.isPOT(this._width)&&_C48.isPOT(this._height);gl.texSubImage2D(gl.TEXTURE_2D,0,0,0,formatspec.format,formatspec.type,data);if((isPOT||this._renderer.SupportsNPOTTextures())&&this._isMipMapped){gl.hint(gl.GENERATE_MIPMAP_HINT,this._GetMipMapHint(gl));gl.generateMipmap(gl.TEXTURE_2D);}}else{this._width=dataWidth;this._height=dataHeight;var _isPOT=_C48.isPOT(this._width)&&_C48.isPOT(this._height);if(!this._renderer.SupportsNPOTTextures()&&this._IsTiled()&&!_isPOT)throw new Error("non-power-of-two tiled textures not supported");gl.texImage2D(gl.TEXTURE_2D,0,internalformat,formatspec.format,formatspec.type,data);if((_isPOT||this._renderer.SupportsNPOTTextures())&&this._isMipMapped){gl.hint(gl.GENERATE_MIPMAP_HINT,this._GetMipMapHint(gl));gl.generateMipmap(gl.TEXTURE_2D);}}}catch(e){console.error("Error updating WebGL texture: ",e);}gl.bindTexture(gl.TEXTURE_2D,null);this._renderer._ResetLastTexture();}},{key:"_Delete",value:function _Delete(){if(this._refCount>0)throw new Error("texture still has references");if(!this._texture)throw new Error("already deleted texture");_allTextures["delete"](this);var gl=this._renderer.GetContext();gl.deleteTexture(this._texture);this._texture=null;}},{key:"IsValid",value:function IsValid(){return!!this._texture;}},{key:"_GetTexture",value:function _GetTexture(){return this._texture;}},{key:"GetRenderer",value:function GetRenderer(){return this._renderer;}},{key:"AddReference",value:function AddReference(){this._refCount++;}},{key:"SubtractReference",value:function SubtractReference(){if(this._refCount<=0)throw new Error("no more references");this._refCount--;}},{key:"GetReferenceCount",value:function GetReferenceCount(){return this._refCount;}},{key:"GetWidth",value:function GetWidth(){return this._width;}},{key:"GetHeight",value:function GetHeight(){return this._height;}},{key:"IsStatic",value:function IsStatic(){return this._isStatic;}},{key:"GetEstimatedMemoryUsage",value:function GetEstimatedMemoryUsage(){var size=this._width*this._height;switch(this._pixelFormat){case"rgba8":size*=4;break;case"rgb8":size*=3;break;case"rgba4":case"rgb5_a1":case"rgb565":size*=2;break;}if(this._isMipMapped)size+=Math.floor(size/3);return size;}}],[{key:"OnContextLost",value:function OnContextLost(){_allTextures.clear();}},{key:"allTextures",value:function allTextures(){return _allTextures.values();}}]);return WebGLRendererTexture;}();}// ../lib/gfx/webgl/renderTarget.js
{'use strict';var _C49=self.C3;var _assert3=self.assert;var _glMatrix2=self.glMatrix;var _vec3=_glMatrix2.vec3;var _mat2=_glMatrix2.mat4;var _VALID_SAMPLINGS=new Set(["nearest","bilinear","trilinear"]);var DEFAULT_RENDERTARGET_OPTIONS={sampling:"trilinear",alpha:true,depth:false,isSampled:true,isDefaultSize:true,multisampling:0};var _allRenderTargets=new Set();_C49.Gfx.WebGLRenderTarget=/*#__PURE__*/function(){function WebGLRenderTarget(renderer){_classCallCheck(this,WebGLRenderTarget);this._renderer=renderer;this._frameBuffer=null;this._frameBufferNoDepth=null;this._texture=null;this._renderBuffer=null;this._width=0;this._height=0;this._isDefaultSize=true;this._sampling="trilinear";this._alpha=true;this._depth=false;this._isSampled=true;this._multisampling=0;this._projectionMatrix=_mat2.create();this._lastFov=0;this._lastNearZ=0;this._lastFarZ=0;}_createClass(WebGLRenderTarget,[{key:"_Create",value:function _Create(width,height,opts){opts=Object.assign({},DEFAULT_RENDERTARGET_OPTIONS,opts);var webGLVersion=this._renderer.GetWebGLVersionNumber();if(this._texture||this._renderBuffer)throw new Error("already created render target");this._sampling=opts.sampling;this._alpha=!!opts.alpha;this._depth=!!opts.depth;this._isSampled=!!opts.isSampled;this._isDefaultSize=!!opts.isDefaultSize;this._multisampling=opts.multisampling;if(!_VALID_SAMPLINGS.has(this._sampling))throw new Error("invalid sampling");if(this._multisampling>0&&(webGLVersion<2||this._isSampled))throw new Error("invalid use of multisampling");if(webGLVersion<2)this._isSampled=true;this._width=width;this._height=height;if(this._width<=0||this._height<=0)throw new Error("invalid render target size");this._CalculateProjection();var gl=this._renderer.GetContext();this._frameBuffer=gl.createFramebuffer();if(this._depth)this._frameBufferNoDepth=gl.createFramebuffer();if(this._isSampled){this._texture=this._renderer.CreateDynamicTexture(this._width,this._height,{sampling:this._sampling,pixelFormat:this._alpha?"rgba8":"rgb8",mipMap:false});var tex=this._texture._GetTexture();gl.bindFramebuffer(gl.FRAMEBUFFER,this._frameBuffer);gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,tex,0);if(this._depth){gl.bindFramebuffer(gl.FRAMEBUFFER,this._frameBufferNoDepth);gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,tex,0);}}else{this._renderBuffer=gl.createRenderbuffer();gl.bindRenderbuffer(gl.RENDERBUFFER,this._renderBuffer);var internalFormat=this._alpha?gl.RGBA8:gl.RGB8;if(this._multisampling>0){var formatSamples=gl.getInternalformatParameter(gl.RENDERBUFFER,internalFormat,gl.SAMPLES);if(formatSamples&&formatSamples[0]){var maxSamples=formatSamples[0];if(this._multisampling>maxSamples)this._multisampling=maxSamples;}else this._multisampling=0;}if(this._multisampling===0)gl.renderbufferStorage(gl.RENDERBUFFER,internalFormat,this._width,this._height);else gl.renderbufferStorageMultisample(gl.RENDERBUFFER,this._multisampling,internalFormat,this._width,this._height);gl.bindFramebuffer(gl.FRAMEBUFFER,this._frameBuffer);gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.RENDERBUFFER,this._renderBuffer);if(this._depth){gl.bindFramebuffer(gl.FRAMEBUFFER,this._frameBufferNoDepth);gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.RENDERBUFFER,this._renderBuffer);}gl.bindRenderbuffer(gl.RENDERBUFFER,null);}var rendererDepthBuffer=this._renderer._GetDepthBuffer();if(this._depth&&rendererDepthBuffer){gl.bindFramebuffer(gl.FRAMEBUFFER,this._frameBuffer);if(this._renderer._CanSampleDepth())gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.DEPTH_STENCIL_ATTACHMENT,gl.TEXTURE_2D,rendererDepthBuffer,0);else gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_STENCIL_ATTACHMENT,gl.RENDERBUFFER,rendererDepthBuffer);}gl.bindFramebuffer(gl.FRAMEBUFFER,null);_allRenderTargets.add(this);}},{key:"_Resize",value:function _Resize(width,height){if(this._width===width&&this._height===height)return;this._width=width;this._height=height;this._CalculateProjection();var gl=this._renderer.GetContext();gl.bindFramebuffer(gl.FRAMEBUFFER,this._frameBuffer);if(this._texture)this._texture._Update(new ImageData(this._width,this._height));else{gl.bindRenderbuffer(gl.RENDERBUFFER,this._renderBuffer);gl.renderbufferStorage(gl.RENDERBUFFER,this._alpha?gl.RGBA8:gl.RGB8,this._width,this._height);gl.bindRenderbuffer(gl.RENDERBUFFER,null);}var rendererDepthBuffer=this._renderer._GetDepthBuffer();if(this._depth&&rendererDepthBuffer)if(this._renderer._CanSampleDepth())gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.DEPTH_STENCIL_ATTACHMENT,gl.TEXTURE_2D,rendererDepthBuffer,0);else gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.DEPTH_STENCIL_ATTACHMENT,gl.RENDERBUFFER,rendererDepthBuffer);gl.bindFramebuffer(gl.FRAMEBUFFER,null);}},{key:"_Delete",value:function _Delete(){if(!this._texture&&!this._renderBuffer)throw new Error("already deleted render target");_allRenderTargets["delete"](this);var gl=this._renderer.GetContext();if(this._texture){gl.bindFramebuffer(gl.FRAMEBUFFER,this._frameBuffer);gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,null,0);if(this._depth){gl.bindFramebuffer(gl.FRAMEBUFFER,this._frameBufferNoDepth);gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.TEXTURE_2D,null,0);}this._renderer.DeleteTexture(this._texture);this._texture=null;}else if(this._renderBuffer){gl.bindFramebuffer(gl.FRAMEBUFFER,this._frameBuffer);gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.RENDERBUFFER,null);if(this._depth){gl.bindFramebuffer(gl.FRAMEBUFFER,this._frameBufferNoDepth);gl.framebufferRenderbuffer(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,gl.RENDERBUFFER,null);}gl.deleteRenderbuffer(this._renderBuffer);this._renderBuffer=null;}gl.bindFramebuffer(gl.FRAMEBUFFER,null);if(this._renderer.GetWebGLVersionNumber()>=2){gl.bindFramebuffer(gl.READ_FRAMEBUFFER,null);gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER,null);}gl.deleteFramebuffer(this._frameBuffer);if(this._depth)gl.deleteFramebuffer(this._frameBufferNoDepth);var batchState=this._renderer.GetBatchState();batchState.currentFramebuffer=null;batchState.currentFramebufferNoDepth=null;this._frameBuffer=null;}},{key:"_CalculateProjection",value:function _CalculateProjection(){this._renderer.CalculatePerspectiveMatrix(this._projectionMatrix,this._width/this._height);this._lastFov=this._renderer.GetFovY();this._lastNearZ=this._renderer.GetNearZ();this._lastFarZ=this._renderer.GetFarZ();}},{key:"_GetFramebuffer",value:function _GetFramebuffer(){return this._frameBuffer;}},{key:"_GetFramebufferNoDepth",value:function _GetFramebufferNoDepth(){return this._frameBufferNoDepth;}},{key:"GetRenderer",value:function GetRenderer(){return this._renderer;}},{key:"GetTexture",value:function GetTexture(){return this._texture;}},{key:"GetProjectionMatrix",value:function GetProjectionMatrix(){if(this._renderer.GetFovY()!==this._lastFov||this._renderer.GetNearZ()!==this._lastNearZ||this._renderer.GetFarZ()!==this._lastFarZ)this._CalculateProjection();return this._projectionMatrix;}},{key:"IsLinearSampling",value:function IsLinearSampling(){return this._sampling!=="nearest";}},{key:"HasAlpha",value:function HasAlpha(){return this._alpha;}},{key:"IsSampled",value:function IsSampled(){return this._isSampled;}},{key:"HasDepthBuffer",value:function HasDepthBuffer(){return this._depth;}},{key:"GetWidth",value:function GetWidth(){return this._width;}},{key:"GetHeight",value:function GetHeight(){return this._height;}},{key:"IsDefaultSize",value:function IsDefaultSize(){return this._isDefaultSize;}},{key:"GetMultisampling",value:function GetMultisampling(){return this._multisampling;}},{key:"GetOptions",value:function GetOptions(){var ret={sampling:this._sampling,alpha:this._alpha,isSampled:this._isSampled};if(!this._isDefaultSize){ret.width=this._width;ret.height=this._height;}return ret;}},{key:"IsCompatibleWithOptions",value:function IsCompatibleWithOptions(opts){opts=Object.assign({},DEFAULT_RENDERTARGET_OPTIONS,opts);if(opts.sampling!=="nearest"!==this.IsLinearSampling())return false;if(!!opts.alpha!==this.HasAlpha())return false;if(!!opts.depth!==this.HasDepthBuffer())return false;if(this._renderer.GetWebGLVersionNumber()>=2)if(!!opts.isSampled!==this.IsSampled())return false;if(typeof opts.width==="number"||typeof opts.height==="number")return!this.IsDefaultSize()&&this.GetWidth()===Math.floor(opts.width)&&this.GetHeight()===Math.floor(opts.height);else return this.IsDefaultSize();}},{key:"_GetWebGLTexture",value:function _GetWebGLTexture(){if(!this._texture)return null;return this._texture._GetTexture();}},{key:"GetEstimatedMemoryUsage",value:function GetEstimatedMemoryUsage(){if(this._texture)return this._texture.GetEstimatedMemoryUsage();return this._width*this._height*(this._alpha?4:3);}}],[{key:"DebugReadPixelsToBlob",value:function DebugReadPixelsToBlob(renderer,renderTarget){var imageData;return regeneratorRuntime.async(function DebugReadPixelsToBlob$(_context43){while(1){switch(_context43.prev=_context43.next){case 0:_context43.next=2;return regeneratorRuntime.awrap(renderer.ReadBackRenderTargetToImageData(renderTarget,true));case 2:imageData=_context43.sent;_context43.next=5;return regeneratorRuntime.awrap(_C49.ImageDataToBlob(imageData));case 5:return _context43.abrupt("return",_context43.sent);case 6:case"end":return _context43.stop();}}});}},{key:"OnContextLost",value:function OnContextLost(){_allRenderTargets.clear();}},{key:"allRenderTargets",value:function allRenderTargets(){return _allRenderTargets.values();}},{key:"ResizeAll",value:function ResizeAll(width,height){var _iteratorNormalCompletion70=true;var _didIteratorError70=false;var _iteratorError70=undefined;try{for(var _iterator70=_allRenderTargets[Symbol.iterator](),_step70;!(_iteratorNormalCompletion70=(_step70=_iterator70.next()).done);_iteratorNormalCompletion70=true){var rt=_step70.value;if(rt.IsDefaultSize())rt._Resize(width,height);}}catch(err){_didIteratorError70=true;_iteratorError70=err;}finally{try{if(!_iteratorNormalCompletion70&&_iterator70["return"]!=null){_iterator70["return"]();}}finally{if(_didIteratorError70){throw _iteratorError70;}}}}}]);return WebGLRenderTarget;}();}// ../lib/gfx/webgl/shaderProgram.js
{'use strict';var _C50=self.C3;var _glMatrix3=self.glMatrix;var _vec4=_glMatrix3.vec3;var _mat3=_glMatrix3.mat4;var RESERVED_UNIFORM_NAMES=new Set(["aPos","aTex","aPoints","matP","matMV","samplerFront","samplerBack","samplerDepth","destStart","destEnd","srcStart","srcEnd","srcOriginStart","srcOriginEnd","pixelSize","seconds","devicePixelRatio","layerScale","layerAngle","layoutStart","layoutEnd","color","color2_","pointTexStart","pointTexEnd","zElevation","tileSize","tileSpacing","outlineThickness","zNear","zFar"]);_C50.Gfx.WebGLShaderProgram=/*#__PURE__*/function(_C50$Gfx$ShaderProgra){_inherits(WebGLShaderProgram,_C50$Gfx$ShaderProgra);_createClass(WebGLShaderProgram,null,[{key:"Compile",value:function Compile(renderer,shaderInfo){var gl,fragSrc,vertexSrc,name,fragmentShader,vertexShader,shaderProgram,parallelShaderCompileExt,log,_log,_log2,infoLog;return regeneratorRuntime.async(function Compile$(_context44){while(1){switch(_context44.prev=_context44.next){case 0:gl=renderer.GetContext();fragSrc=shaderInfo.src;vertexSrc=shaderInfo.vertexSrc;name=shaderInfo.name;fragmentShader=gl.createShader(gl.FRAGMENT_SHADER);gl.shaderSource(fragmentShader,fragSrc);gl.compileShader(fragmentShader);vertexShader=gl.createShader(gl.VERTEX_SHADER);gl.shaderSource(vertexShader,vertexSrc);gl.compileShader(vertexShader);shaderProgram=gl.createProgram();gl.attachShader(shaderProgram,fragmentShader);gl.attachShader(shaderProgram,vertexShader);gl.bindAttribLocation(shaderProgram,0,"aPos");gl.bindAttribLocation(shaderProgram,1,"aTex");gl.bindAttribLocation(shaderProgram,2,"aPoints");gl.linkProgram(shaderProgram);parallelShaderCompileExt=renderer._GetParallelShaderCompileExtension();if(!parallelShaderCompileExt){_context44.next=23;break;}_context44.next=21;return regeneratorRuntime.awrap(renderer._WaitForObjectReady(function(){return gl.getProgramParameter(shaderProgram,parallelShaderCompileExt["COMPLETION_STATUS_KHR"]);}));case 21:_context44.next=25;break;case 23:_context44.next=25;return regeneratorRuntime.awrap(_C50.Wait(5));case 25:if(gl.getShaderParameter(fragmentShader,gl.COMPILE_STATUS)){_context44.next=31;break;}log=gl.getShaderInfoLog(fragmentShader);gl.deleteShader(fragmentShader);gl.deleteShader(vertexShader);gl.deleteProgram(shaderProgram);throw new Error("Error compiling fragment shader: "+log);case 31:if(gl.getShaderParameter(vertexShader,gl.COMPILE_STATUS)){_context44.next=37;break;}_log=gl.getShaderInfoLog(vertexShader);gl.deleteShader(fragmentShader);gl.deleteShader(vertexShader);gl.deleteProgram(shaderProgram);throw new Error("Error compiling vertex shader: "+_log);case 37:if(gl.getProgramParameter(shaderProgram,gl.LINK_STATUS)){_context44.next=43;break;}_log2=gl.getProgramInfoLog(shaderProgram);gl.deleteShader(fragmentShader);gl.deleteShader(vertexShader);gl.deleteProgram(shaderProgram);throw new Error("Error linking shader program: "+_log2);case 43:infoLog=_C50.FilterUnprintableChars(gl.getProgramInfoLog(shaderProgram)||"").trim();if(infoLog&&!_C50.IsStringAllWhitespace(infoLog))console.info("[WebGL] Shader program '".concat(name,"' compilation log: "),infoLog);gl.deleteShader(fragmentShader);gl.deleteShader(vertexShader);return _context44.abrupt("return",shaderProgram);case 48:case"end":return _context44.stop();}}});}},{key:"Create",value:function Create(renderer,shaderInfo){var shaderProgram;return regeneratorRuntime.async(function Create$(_context45){while(1){switch(_context45.prev=_context45.next){case 0:_context45.next=2;return regeneratorRuntime.awrap(_C50.Gfx.WebGLShaderProgram.Compile(renderer,shaderInfo));case 2:shaderProgram=_context45.sent;return _context45.abrupt("return",new _C50.Gfx.WebGLShaderProgram(renderer,shaderProgram,shaderInfo));case 4:case"end":return _context45.stop();}}});}}]);function WebGLShaderProgram(renderer,shaderProgram,shaderInfo){var _this15;_classCallCheck(this,WebGLShaderProgram);_this15=_possibleConstructorReturn(this,_getPrototypeOf(WebGLShaderProgram).call(this,renderer,shaderInfo));var gl=renderer.GetContext();var batchState=renderer.GetBatchState();renderer.EndBatch();gl.useProgram(shaderProgram);_this15._gl=gl;_this15._shaderProgram=shaderProgram;_this15._isDeviceTransform=shaderInfo.name==="<default-device-transform>";var locAPos=gl.getAttribLocation(shaderProgram,"aPos");var locATex=gl.getAttribLocation(shaderProgram,"aTex");_this15._locAPoints=gl.getAttribLocation(shaderProgram,"aPoints");if(locAPos!==-1){gl.bindBuffer(gl.ARRAY_BUFFER,renderer._vertexBuffer);gl.vertexAttribPointer(locAPos,renderer.GetNumVertexComponents(),gl.FLOAT,false,0,0);gl.enableVertexAttribArray(locAPos);}if(locATex!==-1){gl.bindBuffer(gl.ARRAY_BUFFER,renderer._texcoordBuffer);gl.vertexAttribPointer(locATex,2,gl.FLOAT,false,0,0);gl.enableVertexAttribArray(locATex);}if(_this15._locAPoints!==-1){gl.bindBuffer(gl.ARRAY_BUFFER,renderer._pointBuffer);gl.vertexAttribPointer(_this15._locAPoints,4,gl.FLOAT,false,0,0);gl.enableVertexAttribArray(_this15._locAPoints);}gl.bindBuffer(gl.ARRAY_BUFFER,null);_this15._uMatP=new _C50.Gfx.WebGLShaderUniform(_assertThisInitialized(_this15),"matP","mat4");_this15._uMatMV=new _C50.Gfx.WebGLShaderUniform(_assertThisInitialized(_this15),"matMV","mat4");_this15._uColor=new _C50.Gfx.WebGLShaderUniform(_assertThisInitialized(_this15),"color","vec4");_this15._uSamplerFront=new _C50.Gfx.WebGLShaderUniform(_assertThisInitialized(_this15),"samplerFront","sampler");_this15._uPointTexStart=new _C50.Gfx.WebGLShaderUniform(_assertThisInitialized(_this15),"pointTexStart","vec2");_this15._uPointTexEnd=new _C50.Gfx.WebGLShaderUniform(_assertThisInitialized(_this15),"pointTexEnd","vec2");_this15._uZElevation=new _C50.Gfx.WebGLShaderUniform(_assertThisInitialized(_this15),"zElevation","float");_this15._uTileSize=new _C50.Gfx.WebGLShaderUniform(_assertThisInitialized(_this15),"tileSize","vec2");_this15._uTileSpacing=new _C50.Gfx.WebGLShaderUniform(_assertThisInitialized(_this15),"tileSpacing","vec2");_this15._uColor2=new _C50.Gfx.WebGLShaderUniform(_assertThisInitialized(_this15),"color2_","vec4");_this15._uOutlineThickness=new _C50.Gfx.WebGLShaderUniform(_assertThisInitialized(_this15),"outlineThickness","float");_this15._uSamplerBack=new _C50.Gfx.WebGLShaderUniform(_assertThisInitialized(_this15),"samplerBack","sampler");_this15._uSamplerDepth=new _C50.Gfx.WebGLShaderUniform(_assertThisInitialized(_this15),"samplerDepth","sampler");_this15._uDestStart=new _C50.Gfx.WebGLShaderUniform(_assertThisInitialized(_this15),"destStart","vec2");_this15._uDestEnd=new _C50.Gfx.WebGLShaderUniform(_assertThisInitialized(_this15),"destEnd","vec2");_this15._uSrcStart=new _C50.Gfx.WebGLShaderUniform(_assertThisInitialized(_this15),"srcStart","vec2");_this15._uSrcEnd=new _C50.Gfx.WebGLShaderUniform(_assertThisInitialized(_this15),"srcEnd","vec2");_this15._uSrcOriginStart=new _C50.Gfx.WebGLShaderUniform(_assertThisInitialized(_this15),"srcOriginStart","vec2");_this15._uSrcOriginEnd=new _C50.Gfx.WebGLShaderUniform(_assertThisInitialized(_this15),"srcOriginEnd","vec2");_this15._uPixelSize=new _C50.Gfx.WebGLShaderUniform(_assertThisInitialized(_this15),"pixelSize","vec2");_this15._uSeconds=new _C50.Gfx.WebGLShaderUniform(_assertThisInitialized(_this15),"seconds","float");_this15._uDevicePixelRatio=new _C50.Gfx.WebGLShaderUniform(_assertThisInitialized(_this15),"devicePixelRatio","float");_this15._uLayerScale=new _C50.Gfx.WebGLShaderUniform(_assertThisInitialized(_this15),"layerScale","float");_this15._uLayerAngle=new _C50.Gfx.WebGLShaderUniform(_assertThisInitialized(_this15),"layerAngle","float");_this15._uLayoutStart=new _C50.Gfx.WebGLShaderUniform(_assertThisInitialized(_this15),"layoutStart","vec2");_this15._uLayoutEnd=new _C50.Gfx.WebGLShaderUniform(_assertThisInitialized(_this15),"layoutEnd","vec2");_this15._uZNear=new _C50.Gfx.WebGLShaderUniform(_assertThisInitialized(_this15),"zNear","float");_this15._uZFar=new _C50.Gfx.WebGLShaderUniform(_assertThisInitialized(_this15),"zFar","float");_this15._hasAnyOptionalUniforms=!!(_this15._uPixelSize.IsUsed()||_this15._uSeconds.IsUsed()||_this15._uSamplerBack.IsUsed()||_this15._uDestStart.IsUsed()||_this15._uDestEnd.IsUsed()||_this15._uSrcStart.IsUsed()||_this15._uSrcEnd.IsUsed()||_this15._uSrcOriginStart.IsUsed()||_this15._uSrcOriginEnd.IsUsed()||_this15._uDevicePixelRatio.IsUsed()||_this15._uLayerScale.IsUsed()||_this15._uLayerAngle.IsUsed()||_this15._uLayoutStart.IsUsed()||_this15._uLayoutEnd.IsUsed());var customParameterDefs=shaderInfo.parameters||[];_this15._uCustomParameters=[];_this15._usesAnySrcRectOrPixelSize=_this15._uPixelSize.IsUsed()||_this15._uSrcStart.IsUsed()||_this15._uSrcEnd.IsUsed()||_this15._uSrcOriginStart.IsUsed()||_this15._uSrcOriginEnd.IsUsed();_this15._hasCurrentMatP=false;_this15._hasCurrentMatMV=false;_this15._uColor.Init4f(1,1,1,1);_this15._uColor2.Init4f(1,1,1,1);_this15._uSamplerFront.Init1i(0);_this15._uSamplerBack.Init1i(1);_this15._uSamplerDepth.Init1i(2);_this15._uPointTexStart.Init2f(0,0);_this15._uPointTexEnd.Init2f(1,1);_this15._uZElevation.Init1f(0);_this15._uTileSize.Init2f(0,0);_this15._uTileSpacing.Init2f(0,0);_this15._uDestStart.Init2f(0,0);_this15._uDestEnd.Init2f(1,1);_this15._uSrcStart.Init2f(0,0);_this15._uSrcEnd.Init2f(0,0);_this15._uSrcOriginStart.Init2f(0,0);_this15._uSrcOriginEnd.Init2f(0,0);_this15._uPixelSize.Init2f(0,0);_this15._uDevicePixelRatio.Init1f(1);_this15._uZNear.Init1f(renderer.GetNearZ());_this15._uZFar.Init1f(renderer.GetFarZ());_this15._uLayerScale.Init1f(1);_this15._uLayerAngle.Init1f(0);_this15._uSeconds.Init1f(0);_this15._uLayoutStart.Init2f(0,0);_this15._uLayoutEnd.Init2f(0,0);_this15._uOutlineThickness.Init1f(1);var _iteratorNormalCompletion71=true;var _didIteratorError71=false;var _iteratorError71=undefined;try{for(var _iterator71=customParameterDefs[Symbol.iterator](),_step71;!(_iteratorNormalCompletion71=(_step71=_iterator71.next()).done);_iteratorNormalCompletion71=true){var p=_step71.value;var uniformName=p[0];var paramType=p[2];var shaderUniform=new _C50.Gfx.WebGLShaderUniform(_assertThisInitialized(_this15),uniformName,paramType);if(paramType==="color")shaderUniform.Init3f(0,0,0);else shaderUniform.Init1f(0);_this15._uCustomParameters.push(shaderUniform);}}catch(err){_didIteratorError71=true;_iteratorError71=err;}finally{try{if(!_iteratorNormalCompletion71&&_iterator71["return"]!=null){_iterator71["return"]();}}finally{if(_didIteratorError71){throw _iteratorError71;}}}if(_this15._isDeviceTransform)_this15._UpdateDeviceTransformUniforms(batchState.currentMatP);else{_this15.UpdateMatP(batchState.currentMatP,true);_this15.UpdateMatMV(batchState.currentMV,true);}var currentShader=batchState.currentShader;gl.useProgram(currentShader?currentShader._shaderProgram:null);return _this15;}_createClass(WebGLShaderProgram,[{key:"Release",value:function Release(){this._gl.deleteProgram(this._shaderProgram);this._shaderProgram=null;this._renderer._RemoveShaderProgram(this);this._gl=null;_get(_getPrototypeOf(WebGLShaderProgram.prototype),"Release",this).call(this);}},{key:"GetWebGLContext",value:function GetWebGLContext(){return this._gl;}},{key:"GetShaderProgram",value:function GetShaderProgram(){return this._shaderProgram;}},{key:"GetParameterCount",value:function GetParameterCount(){return this._uCustomParameters.length;}},{key:"GetParameterType",value:function GetParameterType(paramIndex){if(paramIndex<0||paramIndex>=this._uCustomParameters.length)return null;return this._uCustomParameters[paramIndex].GetType();}},{key:"AreCustomParametersAlreadySetInBatch",value:function AreCustomParametersAlreadySetInBatch(params){for(var i=0,len=params.length;i<len;++i){if(!this._uCustomParameters[i].IsSetToCustomInBatch(params[i]))return false;}return true;}},{key:"SetCustomParametersInBatch",value:function SetCustomParametersInBatch(params){for(var i=0,len=params.length;i<len;++i){this._uCustomParameters[i].SetBatchValueCustom(params[i]);}}},{key:"AreOptionalUniformsAlreadySetInBatch",value:function AreOptionalUniformsAlreadySetInBatch(destRect,srcRect,srcOriginRect,layoutRect,pixelWidth,pixelHeight,dpr,layerScale,layerAngle,time){if(this._uSamplerBack.IsUsed())return false;if(this._uPixelSize.IsUsed()&&!this._uPixelSize.IsSetTo2InBatch(pixelWidth,pixelHeight))return false;if(this._uDestStart.IsUsed()&&!this._uDestStart.IsSetTo2InBatch(destRect.getLeft(),destRect.getTop()))return false;if(this._uDestEnd.IsUsed()&&!this._uDestEnd.IsSetTo2InBatch(destRect.getRight(),destRect.getBottom()))return false;if(this._uDevicePixelRatio.IsUsed()&&!this._uDevicePixelRatio.IsSetTo1InBatch(dpr))return false;if(this._uLayerScale.IsUsed()&&!this._uLayerScale.IsSetTo1InBatch(layerScale))return false;if(this._uLayerAngle.IsUsed()&&!this._uLayerAngle.IsSetTo1InBatch(layerAngle))return false;if(this._uSrcStart.IsUsed()&&!this._uSrcStart.IsSetTo2InBatch(srcRect.getLeft(),srcRect.getTop()))return false;if(this._uSrcEnd.IsUsed()&&!this._uSrcEnd.IsSetTo2InBatch(srcRect.getRight(),srcRect.getBottom()))return false;if(this._uSrcOriginStart.IsUsed()&&!this._uSrcOriginStart.IsSetTo2InBatch(srcOriginRect.getLeft(),srcOriginRect.getTop()))return false;if(this._uSrcOriginEnd.IsUsed()&&!this._uSrcOriginEnd.IsSetTo2InBatch(srcOriginRect.getRight(),srcOriginRect.getBottom()))return false;if(this._uLayoutStart.IsUsed()&&!this._uLayoutStart.IsSetTo2InBatch(layoutRect.getLeft(),layoutRect.getTop()))return false;if(this._uLayoutEnd.IsUsed()&&!this._uLayoutEnd.IsSetTo2InBatch(layoutRect.getTop(),layoutRect.getBottom()))return false;if(this._uSeconds.IsUsed()&&!this._uSeconds.IsSetTo1InBatch(time))return false;return true;}},{key:"SetOptionalUniformsInBatch",value:function SetOptionalUniformsInBatch(destRect,srcRect,srcOriginRect,layoutRect,pixelWidth,pixelHeight,dpr,layerScale,layerAngle,time){if(this._uSamplerBack.IsUsed())return;if(this._uPixelSize.IsUsed())this._uPixelSize.SetBatch2(pixelWidth,pixelHeight);if(this._uDestStart.IsUsed())this._uDestStart.SetBatch2(destRect.getLeft(),destRect.getTop());if(this._uDestEnd.IsUsed())this._uDestEnd.SetBatch2(destRect.getRight(),destRect.getBottom());if(this._uDevicePixelRatio.IsUsed())this._uDevicePixelRatio.SetBatch1(dpr);if(this._uLayerScale.IsUsed())this._uLayerScale.SetBatch1(layerScale);if(this._uLayerAngle.IsUsed())this._uLayerAngle.SetBatch1(layerAngle);if(this._uSrcStart.IsUsed())this._uSrcStart.SetBatch2(srcRect.getLeft(),srcRect.getTop());if(this._uSrcEnd.IsUsed())this._uSrcEnd.SetBatch2(srcRect.getRight(),srcRect.getBottom());if(this._uSrcOriginStart.IsUsed())this._uSrcOriginStart.SetBatch2(srcOriginRect.getLeft(),srcOriginRect.getTop());if(this._uSrcOriginEnd.IsUsed())this._uSrcOriginEnd.SetBatch2(srcOriginRect.getRight(),srcOriginRect.getBottom());if(this._uLayoutStart.IsUsed())this._uLayoutStart.SetBatch2(layoutRect.getLeft(),layoutRect.getTop());if(this._uLayoutEnd.IsUsed())this._uLayoutEnd.SetBatch2(layoutRect.getTop(),layoutRect.getBottom());if(this._uSeconds.IsUsed())this._uSeconds.SetBatch1(time);}},{key:"UpdateMatP",value:function UpdateMatP(matP,force){if(this._hasCurrentMatP&&!force)return;if(this._isDeviceTransform)return;if(this._uMatP.IsUsed())this._uMatP.UpdateMatrix4fv(matP);this._hasCurrentMatP=true;}},{key:"SetMatPStale",value:function SetMatPStale(){this._hasCurrentMatP=false;}},{key:"UpdateMatMV",value:function UpdateMatMV(matMV,force){if(this._hasCurrentMatMV&&!force)return;if(this._isDeviceTransform)return;if(this._uMatMV.IsUsed())this._uMatMV.UpdateMatrix4fv(matMV);this._hasCurrentMatMV=true;}},{key:"SetMatMVStale",value:function SetMatMVStale(){this._hasCurrentMatMV=false;}},{key:"_UpdateDeviceTransformUniforms",value:function _UpdateDeviceTransformUniforms(matP){if(!this._isDeviceTransform)throw new Error("not device transform shader");this._uMatP.UpdateMatrix4fv(matP);var renderer=this._renderer;var scrollX=renderer.GetWidth()/2;var scrollY=renderer.GetHeight()/2;var tempMat4=renderer.CalculateLookAtModelView2(scrollX,scrollY,renderer.GetDefaultCameraZ(renderer.GetHeight()),scrollX,scrollY,0,renderer.GetHeight());this._uMatMV.UpdateMatrix4fv(tempMat4);}},{key:"UpdateColor",value:function UpdateColor(c){if(this._uColor.IsUsed())this._uColor.Update4f(c[0],c[1],c[2],c[3]);}}],[{key:"GetReservedUniformNames",value:function GetReservedUniformNames(){return RESERVED_UNIFORM_NAMES;}},{key:"GetDefaultVertexShaderSource",value:function GetDefaultVertexShaderSource(useHighP){var texPrecision=useHighP?"highmedp":"mediump";return["#ifdef GL_FRAGMENT_PRECISION_HIGH","#define highmedp highp","#else","#define highmedp mediump","#endif","attribute highp vec3 aPos;","attribute ".concat(texPrecision," vec2 aTex;"),"varying ".concat(texPrecision," vec2 vTex;"),"uniform highp mat4 matP;","uniform highp mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPos, 1.0);","\tvTex = aTex;","}"].join("\n");}},{key:"GetDefaultVertexShaderSource_WebGL2",value:function GetDefaultVertexShaderSource_WebGL2(useHighP){var texPrecision=useHighP?"highp":"mediump";return["#version 300 es","in highp vec3 aPos;","in ".concat(texPrecision," vec2 aTex;"),"out ".concat(texPrecision," vec2 vTex;"),"uniform highp mat4 matP;","uniform highp mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPos, 1.0);","\tvTex = aTex;","}"].join("\n");}},{key:"GetTextureFillFragmentShaderSource_WebGL1_NoFragDepth",value:function GetTextureFillFragmentShaderSource_WebGL1_NoFragDepth(){return["varying mediump vec2 vTex;","uniform lowp vec4 color;","uniform lowp sampler2D samplerFront;","void main(void) {","\tgl_FragColor = texture2D(samplerFront, vTex) * color;","}"].join("\n");}},{key:"GetTextureFillFragmentShaderSource_WebGL1_FragDepthEXT",value:function GetTextureFillFragmentShaderSource_WebGL1_FragDepthEXT(){return["#extension GL_EXT_frag_depth : enable","varying mediump vec2 vTex;","uniform lowp vec4 color;","uniform lowp sampler2D samplerFront;","void main(void) {","\tgl_FragColor = texture2D(samplerFront, vTex) * color;","\tgl_FragDepthEXT = (gl_FragColor.a == 0.0 ? 1.0 : gl_FragCoord.z);","}"].join("\n");}},{key:"GetTextureFillFragmentShaderSource_WebGL2",value:function GetTextureFillFragmentShaderSource_WebGL2(){return["#version 300 es","in mediump vec2 vTex;","out lowp vec4 outColor;","uniform lowp vec4 color;","uniform lowp sampler2D samplerFront;","void main(void) {","\toutColor = texture(samplerFront, vTex) * color;","\tgl_FragDepth = (outColor.a == 0.0 ? 1.0 : gl_FragCoord.z);","}"].join("\n");}},{key:"GetTilemapFragmentShaderSource_WebGL1_NoFragDepth",value:function GetTilemapFragmentShaderSource_WebGL1_NoFragDepth(){return["#ifdef GL_FRAGMENT_PRECISION_HIGH","#define highmedp highp","#else","#define highmedp mediump","#endif","varying highmedp vec2 vTex;","uniform lowp vec4 color;","uniform lowp sampler2D samplerFront;","uniform highmedp vec2 srcStart;","uniform highmedp vec2 pixelSize;","uniform highmedp vec2 tileSize;","uniform highmedp vec2 tileSpacing;","void main(void) {","\thighmedp vec2 tile = floor(vTex);","\thighmedp vec2 tex = fract(vTex);","\thighmedp vec2 tileOrigin = srcStart + tile * (tileSize + tileSpacing);","\thighmedp vec2 lowerBound = tileOrigin + pixelSize / 2.0;","\thighmedp vec2 upperBound = tileOrigin + tileSize - pixelSize / 2.0;","\tgl_FragColor = texture2D(samplerFront, clamp(tex, lowerBound, upperBound), -16.0) * color;","}"].join("\n");}},{key:"GetTilemapFragmentShaderSource_WebGL1_FragDepthEXT",value:function GetTilemapFragmentShaderSource_WebGL1_FragDepthEXT(){return["#extension GL_EXT_frag_depth : enable","#ifdef GL_FRAGMENT_PRECISION_HIGH","#define highmedp highp","#else","#define highmedp mediump","#endif","varying highmedp vec2 vTex;","uniform lowp vec4 color;","uniform lowp sampler2D samplerFront;","uniform highmedp vec2 srcStart;","uniform highmedp vec2 pixelSize;","uniform highmedp vec2 tileSize;","uniform highmedp vec2 tileSpacing;","void main(void) {","\thighmedp vec2 tile = floor(vTex);","\thighmedp vec2 tex = fract(vTex);","\thighmedp vec2 tileOrigin = srcStart + tile * (tileSize + tileSpacing);","\thighmedp vec2 lowerBound = tileOrigin + pixelSize / 2.0;","\thighmedp vec2 upperBound = tileOrigin + tileSize - pixelSize / 2.0;","\tgl_FragColor = texture2D(samplerFront, clamp(tex, lowerBound, upperBound), -16.0) * color;","\tgl_FragDepthEXT = (gl_FragColor.a == 0.0 ? 1.0 : gl_FragCoord.z);","}"].join("\n");}},{key:"GetTilemapFragmentShaderSource_WebGL2",value:function GetTilemapFragmentShaderSource_WebGL2(){return["#version 300 es","in highp vec2 vTex;","out lowp vec4 outColor;","uniform lowp vec4 color;","uniform lowp sampler2D samplerFront;","uniform highp vec2 srcStart;","uniform highp vec2 pixelSize;","uniform highp vec2 tileSize;","uniform highp vec2 tileSpacing;","void main(void) {","\thighp vec2 tile = floor(vTex);","\thighp vec2 tex = fract(vTex);","\thighp vec2 tileOrigin = srcStart + tile * (tileSize + tileSpacing);","\thighp vec2 lowerBound = tileOrigin + pixelSize / 2.0;","\thighp vec2 upperBound = tileOrigin + tileSize - pixelSize / 2.0;","\toutColor = texture(samplerFront, clamp(tex, lowerBound, upperBound), -16.0) * color;","\tgl_FragDepth = (outColor.a == 0.0 ? 1.0 : gl_FragCoord.z);","}"].join("\n");}},{key:"GetTileRandomizationFragmentShaderSource",value:function GetTileRandomizationFragmentShaderSource(webGLVer,hasFragDepthExt,useDerivatives){var prefix="";if(webGLVer>=2)prefix="#version 300 es\n";else{if(hasFragDepthExt)prefix="#extension GL_EXT_frag_depth : enable\n";if(useDerivatives){prefix+="#extension GL_EXT_shader_texture_lod : enable\n";prefix+="#extension GL_OES_standard_derivatives : enable\n";}}return prefix+"\n#ifdef GL_FRAGMENT_PRECISION_HIGH\n#define highmedp highp\n#else\n#define highmedp mediump\n#endif\nprecision highmedp float;\n".concat(webGLVer>=2?"in":"varying"," vec2 vTex;\n").concat(webGLVer>=2?"out lowp vec4 outColor;":"","\nuniform lowp vec4 color;\nuniform lowp sampler2D samplerFront;\nuniform vec2 pixelSize;\n\nuniform vec2 tileSize;\nuniform vec2 tileSpacing;\nuniform float outlineThickness;\n\nconst float PI = 3.1415926;\n\nlowp vec4 cospVec4(lowp vec4 a, lowp vec4 b, float x)\n{\n\treturn (a + b + (a - b) * cos(x * PI)) / 2.0;\n}\n\nvec3 randVec3(vec2 seed)\n{\n\treturn vec3(fract(sin(dot(seed.xy + vec2(0.1, 0.1), vec2(12.9898,78.233))) * 43758.5453),\n\t\t\t\tfract(sin(dot(seed.yx + vec2(0.1, 0.1), vec2(12.9898,-78.233))) * 43758.5453),\n\t\t\t\tfract(sin(dot(seed.xy + vec2(0.1, 0.1), vec2(-12.9898,-78.233))) * 43758.5453));\n}\n\nlowp vec4 sampleTile(vec2 tile, vec2 uv, vec2 ddx, vec2 ddy)\n{\n\tvec2 posRandom = tileSize;\n\tfloat angleRandom = outlineThickness;\n\t\n\tvec3 rand = (randVec3(floor(tile + 0.5)) - 0.5) * 2.0;\n\t\n\tfloat angle = angleRandom * rand.z * PI;\n\tfloat sin_a = sin(angle);\n\tfloat cos_a = cos(angle);\n\tfloat aspect = pixelSize.x / pixelSize.y;\n\n\tvec2 mid = tile + vec2(0.5, 0.5);\n\tvec2 dp = uv - mid;\n\tdp.x /= aspect;\n\tvec2 r = vec2(dp.x * cos_a - dp.y * sin_a,\n\t\t\t\t  dp.y * cos_a + dp.x * sin_a);\n\tr.x *= aspect;\n\n\tvec2 p = mid + r + (posRandom * rand.xy / 2.0);\n\t\n\t").concat(webGLVer>=2?"return textureGrad(samplerFront, p, ddx, ddy);":"","\n\t").concat(webGLVer<2&&useDerivatives?"return texture2DGradEXT(samplerFront, p, ddx, ddy);":"","\n\t").concat(webGLVer<2&&!useDerivatives?"return texture2D(samplerFront, p);":"","\n}\n\nvoid main(void) {\n\t\n\t").concat(webGLVer<2?"lowp vec4 outColor;":"","\n\t\n\tfloat blendMarginX = tileSpacing.x;\n\tfloat blendMarginY = tileSpacing.y;\n\t\n\tvec2 tile = floor(vTex);\n\tvec2 tex = fract(vTex);\n\tvec2 ddx = ").concat(webGLVer>=2||useDerivatives?"dFdx(vTex)":"vec2(0.0, 0.0)",";\n\tvec2 ddy = ").concat(webGLVer>=2||useDerivatives?"dFdy(vTex)":"vec2(0.0, 0.0)",";\n\t\n\tvec4 curTile = sampleTile(tile, vTex, ddx, ddy);\n\t\n\tbool inLeftMargin = (tex.x < blendMarginX);\n\tbool inRightMargin = (tex.x > 1.0 - blendMarginX);\n\tbool inTopMargin = (tex.y < blendMarginY);\n\tbool inBottomMargin = (tex.y > 1.0 - blendMarginY);\n\t\n\tif (inLeftMargin)\n\t{\n\t\tlowp vec4 leftTile = sampleTile(tile + vec2(-1.0, 0.0), vTex, ddx, ddy);\n\t\tfloat leftMix = (tex.x / (blendMarginX * 2.0)) + 0.5;\n\t\tlowp vec4 leftMixedTile = cospVec4(leftTile, curTile, leftMix);\n\t\t\n\t\tif (inTopMargin)\n\t\t{\n\t\t\tlowp vec4 topTile =     sampleTile(tile + vec2(0.0,  -1.0), vTex, ddx, ddy);\n\t\t\tlowp vec4 topLeftTile = sampleTile(tile + vec2(-1.0, -1.0), vTex, ddx, ddy);\n\t\t\tlowp vec4 topLeftMixedTile = cospVec4(topLeftTile, topTile, leftMix);\n\t\t\t\n\t\t\toutColor = cospVec4(topLeftMixedTile, leftMixedTile, (tex.y / (blendMarginY * 2.0)) + 0.5);\n\t\t}\n\t\telse if (inBottomMargin)\n\t\t{\n\t\t\tlowp vec4 bottomTile =     sampleTile(tile + vec2(0.0,  1.0), vTex, ddx, ddy);\n\t\t\tlowp vec4 bottomLeftTile = sampleTile(tile + vec2(-1.0, 1.0), vTex, ddx, ddy);\n\t\t\tlowp vec4 bottomLeftMixedTile = cospVec4(bottomLeftTile, bottomTile, leftMix);\n\t\t\t\n\t\t\toutColor = cospVec4(leftMixedTile, bottomLeftMixedTile, (tex.y - (1.0 - blendMarginY)) / (blendMarginY * 2.0));\n\t\t}\n\t\telse\n\t\t{\n\t\t\toutColor = leftMixedTile;\n\t\t}\n\t}\n\telse if (inRightMargin)\n\t{\n\t\tlowp vec4 rightTile = sampleTile(tile + vec2(1.0, 0.0), vTex, ddx, ddy);\n\t\tfloat rightMix = (tex.x - (1.0 - blendMarginX)) / (blendMarginX * 2.0);\n\t\tlowp vec4 rightMixedTile = cospVec4(curTile, rightTile, rightMix);\n\t\t\n\t\tif (inTopMargin)\n\t\t{\n\t\t\tlowp vec4 topTile =      sampleTile(tile + vec2(0.0, -1.0), vTex, ddx, ddy);\n\t\t\tlowp vec4 topRightTile = sampleTile(tile + vec2(1.0, -1.0), vTex, ddx, ddy);\n\t\t\tlowp vec4 topRightMixedTile = cospVec4(topTile, topRightTile, rightMix);\n\t\t\t\n\t\t\toutColor = cospVec4(topRightMixedTile, rightMixedTile, (tex.y / (blendMarginY * 2.0)) + 0.5);\n\t\t}\n\t\telse if (inBottomMargin)\n\t\t{\n\t\t\tlowp vec4 bottomTile =      sampleTile(tile + vec2(0.0, 1.0), vTex, ddx, ddy);\n\t\t\tlowp vec4 bottomRightTile = sampleTile(tile + vec2(1.0, 1.0), vTex, ddx, ddy);\n\t\t\tlowp vec4 bottomRightMixedTile = cospVec4(bottomTile, bottomRightTile, rightMix);\n\t\t\t\n\t\t\toutColor = cospVec4(rightMixedTile, bottomRightMixedTile, (tex.y - (1.0 - blendMarginY)) / (blendMarginY * 2.0));\n\t\t}\n\t\telse\n\t\t{\n\t\t\toutColor = rightMixedTile;\n\t\t}\n\t}\n\telse if (inTopMargin)\n\t{\n\t\tlowp vec4 topTile = sampleTile(tile + vec2(0.0, -1.0), vTex, ddx, ddy);\n\t\toutColor = cospVec4(topTile, curTile, (tex.y / (blendMarginY * 2.0)) + 0.5);\n\t}\n\telse if (inBottomMargin)\n\t{\n\t\tlowp vec4 bottomTile = sampleTile(tile + vec2(0.0, 1.0), vTex, ddx, ddy);\n\t\toutColor = cospVec4(curTile, bottomTile, (tex.y - (1.0 - blendMarginY)) / (blendMarginY * 2.0));\n\t}\n\telse\n\t{\n\t\toutColor = curTile;\n\t}\n\t\n\toutColor *= color;\n\t").concat(webGLVer<2?"gl_FragColor = outColor;":"","\n\t").concat(webGLVer>=2?"gl_FragDepth = (outColor.a == 0.0 ? 1.0 : gl_FragCoord.z);":"","\n\t").concat(webGLVer<2&&hasFragDepthExt?"gl_FragDepthEXT = (outColor.a == 0.0 ? 1.0 : gl_FragCoord.z);":"","\n}\n");}},{key:"GetPointVertexShaderSource_WebGL1",value:function GetPointVertexShaderSource_WebGL1(){return["attribute vec4 aPoints;","varying float pointOpacity;","uniform float zElevation;","uniform mat4 matP;","uniform mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPoints.xy, zElevation, 1.0);","\tgl_PointSize = aPoints.z;","\tpointOpacity = aPoints.w;","}"].join("\n");}},{key:"GetPointVertexShaderSource_WebGL2",value:function GetPointVertexShaderSource_WebGL2(){return["#version 300 es","in vec4 aPoints;","out float pointOpacity;","uniform float zElevation;","uniform mat4 matP;","uniform mat4 matMV;","void main(void) {","\tgl_Position = matP * matMV * vec4(aPoints.xy, zElevation, 1.0);","\tgl_PointSize = aPoints.z;","\tpointOpacity = aPoints.w;","}"].join("\n");}},{key:"GetPointFragmentShaderSource_WebGL1_NoFragDepth",value:function GetPointFragmentShaderSource_WebGL1_NoFragDepth(){return["uniform lowp sampler2D samplerFront;","varying lowp float pointOpacity;","uniform mediump vec2 pointTexStart;","uniform mediump vec2 pointTexEnd;","uniform lowp vec4 color;","void main(void) {","\tmediump vec2 pointTexMin = min(pointTexStart, pointTexEnd);","\tmediump vec2 pointTexMax = max(pointTexStart, pointTexEnd);","\tmediump vec2 pointCoord = (pointTexEnd.x > pointTexStart.x ? gl_PointCoord : vec2(1.0 - gl_PointCoord.y, gl_PointCoord.x));","\tgl_FragColor = texture2D(samplerFront, mix(pointTexMin, pointTexMax, pointCoord)) * color * pointOpacity;","}"].join("\n");}},{key:"GetPointFragmentShaderSource_WebGL1_FragDepthEXT",value:function GetPointFragmentShaderSource_WebGL1_FragDepthEXT(){return["#extension GL_EXT_frag_depth : enable","uniform lowp sampler2D samplerFront;","varying lowp float pointOpacity;","uniform mediump vec2 pointTexStart;","uniform mediump vec2 pointTexEnd;","uniform lowp vec4 color;","void main(void) {","\tmediump vec2 pointTexMin = min(pointTexStart, pointTexEnd);","\tmediump vec2 pointTexMax = max(pointTexStart, pointTexEnd);","\tmediump vec2 pointCoord = (pointTexEnd.x > pointTexStart.x ? gl_PointCoord : vec2(1.0 - gl_PointCoord.y, gl_PointCoord.x));","\tgl_FragColor = texture2D(samplerFront, mix(pointTexMin, pointTexMax, pointCoord)) * color * pointOpacity;","\tgl_FragDepthEXT = (gl_FragColor.a == 0.0 ? 1.0 : gl_FragCoord.z);","}"].join("\n");}},{key:"GetPointFragmentShaderSource_WebGL2",value:function GetPointFragmentShaderSource_WebGL2(){return["#version 300 es","uniform lowp sampler2D samplerFront;","in lowp float pointOpacity;","uniform mediump vec2 pointTexStart;","uniform mediump vec2 pointTexEnd;","uniform lowp vec4 color;","out lowp vec4 outColor;","void main(void) {","\tmediump vec2 pointTexMin = min(pointTexStart, pointTexEnd);","\tmediump vec2 pointTexMax = max(pointTexStart, pointTexEnd);","\tmediump vec2 pointCoord = (pointTexEnd.x > pointTexStart.x ? gl_PointCoord : vec2(1.0 - gl_PointCoord.y, gl_PointCoord.x));","\toutColor = texture(samplerFront, mix(pointTexMin, pointTexMax, pointCoord)) * color * pointOpacity;","\tgl_FragDepth = (outColor.a == 0.0 ? 1.0 : gl_FragCoord.z);","}"].join("\n");}},{key:"GetColorFillFragmentShaderSource",value:function GetColorFillFragmentShaderSource(){return["uniform lowp vec4 color;","void main(void) {","\tgl_FragColor = color;","}"].join("\n");}},{key:"GetLinearGradientFillFragmentShaderSource",value:function GetLinearGradientFillFragmentShaderSource(){return["precision lowp float;","varying mediump vec2 vTex;","uniform vec4 color;","uniform vec4 color2_;","vec3 fromLinear(vec3 linearRGB)","{","\tbvec3 cutoff = lessThan(linearRGB, vec3(0.0031308));","\tvec3 higher = vec3(1.055) * pow(abs(linearRGB), vec3(1.0/2.4)) - vec3(0.055);","\tvec3 lower = linearRGB * vec3(12.92);","\treturn mix(higher, lower, vec3(cutoff));","}","vec3 toLinear(vec3 sRGB)","{","\tbvec3 cutoff = lessThan(sRGB, vec3(0.04045));","\tvec3 higher = pow(abs((sRGB + vec3(0.055))/vec3(1.055)), vec3(2.4));","\tvec3 lower = sRGB/vec3(12.92);","\treturn mix(higher, lower, vec3(cutoff));","}","void main(void) {","\tvec3 linearGrad = mix(toLinear(color.rgb), toLinear(color2_.rgb), vTex.x);","\tfloat a = mix(color.a, color2_.a, vTex.x);","\tgl_FragColor = vec4(fromLinear(linearGrad) * a, a);","}"].join("\n");}},{key:"GetPenumbraFillFragmentShaderSource",value:function GetPenumbraFillFragmentShaderSource(){return["#ifdef GL_FRAGMENT_PRECISION_HIGH","#define highmedp highp","#else","#define highmedp mediump","#endif","precision lowp float;","varying highmedp vec2 vTex;","uniform vec4 color;","void main(void) {","\thighmedp float grad = vTex.x / (1.0 - vTex.y);","\tgl_FragColor = color * (1.0 - (cos(grad * 3.141592653589793) + 1.0) / 2.0);","}"].join("\n");}},{key:"GetSmoothLineFillFragmentShaderSource",value:function GetSmoothLineFillFragmentShaderSource(){return["varying mediump vec2 vTex;","uniform lowp vec4 color;","void main(void) {","\tlowp float f = 1.0 - abs(vTex.y - 0.5) * 2.0;","\tgl_FragColor = color * f;","}"].join("\n");}},{key:"GetHardEllipseFillFragmentShaderSource",value:function GetHardEllipseFillFragmentShaderSource(){return["varying mediump vec2 vTex;","uniform lowp vec4 color;","void main(void) {","\tmediump vec2 diff = vTex - vec2(0.5, 0.5);","\tmediump vec2 diffSq = diff * diff;","\tmediump float f = step(diffSq.x + diffSq.y, 0.25);","\tgl_FragColor = color * f;","}"].join("\n");}},{key:"GetHardEllipseOutlineFragmentShaderSource",value:function GetHardEllipseOutlineFragmentShaderSource(){return["varying mediump vec2 vTex;","uniform lowp vec4 color;","uniform mediump vec2 pixelSize;","uniform mediump float outlineThickness;","void main(void) {","\tmediump vec2 diff = vTex - vec2(0.5, 0.5);","\tmediump vec2 diffSq = diff * diff;","\tmediump float distSq = diffSq.x + diffSq.y;","\tmediump vec2 norm = normalize(diff);","\tmediump vec2 halfNorm = norm * 0.5;","\tmediump float innerF = step(distSq, 0.25);","\tmediump vec2 innerEdge = halfNorm - pixelSize * norm * outlineThickness;","\tmediump vec2 innerEdgeSq = innerEdge * innerEdge;","\tmediump float outerF = step(innerEdgeSq.x + innerEdgeSq.y, distSq);","\tgl_FragColor = color * innerF * outerF;","}"].join("\n");}},{key:"GetSmoothEllipseFillFragmentShaderSource",value:function GetSmoothEllipseFillFragmentShaderSource(){return["varying mediump vec2 vTex;","uniform lowp vec4 color;","uniform mediump vec2 pixelSize;","void main(void) {","\tmediump vec2 diff = vTex - vec2(0.5, 0.5);","\tmediump vec2 diffSq = diff * diff;","\tmediump vec2 norm = normalize(diff);","\tmediump vec2 halfNorm = norm * 0.5;","\tmediump vec2 halfNormSq = halfNorm * halfNorm;","\tmediump vec2 innerEdge = halfNorm - pixelSize * norm;","\tmediump vec2 innerEdgeSq = innerEdge * innerEdge;","\tmediump float f = smoothstep(halfNormSq.x + halfNormSq.y, innerEdgeSq.x + innerEdgeSq.y, diffSq.x + diffSq.y);","\tgl_FragColor = color * f;","}"].join("\n");}},{key:"GetSmoothEllipseOutlineFragmentShaderSource",value:function GetSmoothEllipseOutlineFragmentShaderSource(){return["varying mediump vec2 vTex;","uniform lowp vec4 color;","uniform mediump vec2 pixelSize;","uniform mediump float outlineThickness;","void main(void) {","\tmediump vec2 diff = vTex - vec2(0.5, 0.5);","\tmediump vec2 diffSq = diff * diff;","\tmediump float distSq = diffSq.x + diffSq.y;","\tmediump vec2 norm = normalize(diff);","\tmediump vec2 halfNorm = norm * 0.5;","\tmediump vec2 halfNormSq = halfNorm * halfNorm;","\tmediump vec2 pxNorm = pixelSize * norm;","\tmediump vec2 innerEdge1 = halfNorm - pxNorm;","\tmediump vec2 innerEdge1Sq = innerEdge1 * innerEdge1;","\tmediump float innerF = smoothstep(halfNormSq.x + halfNormSq.y, innerEdge1Sq.x + innerEdge1Sq.y, distSq);","\tmediump vec2 innerEdge2 = halfNorm - pxNorm * outlineThickness;","\tmediump vec2 innerEdge2Sq = innerEdge2 * innerEdge2;","\tmediump vec2 innerEdge3 = halfNorm - pxNorm * (outlineThickness + 1.0);","\tmediump vec2 innerEdge3Sq = innerEdge3 * innerEdge3;","\tmediump float outerF = smoothstep(innerEdge3Sq.x + innerEdge3Sq.y, innerEdge2Sq.x + innerEdge2Sq.y, distSq);","\tgl_FragColor = color * innerF * outerF;","}"].join("\n");}}]);return WebGLShaderProgram;}(_C50.Gfx.ShaderProgramBase);}// ../lib/gfx/webgl/shaderUniform.js
{'use strict';var _C51=self.C3;var _glMatrix4=self.glMatrix;var _mat4=_glMatrix4.mat4;var TYPE_SIZES=new Map([["float",1],["percent",1],["sampler",1],["vec2",2],["vec3",3],["color",3],["vec4",4],["mat4",16]]);_C51.Gfx.WebGLShaderUniform=/*#__PURE__*/function(){function WebGLShaderUniform(owner,name,type){_classCallCheck(this,WebGLShaderUniform);if(!TYPE_SIZES.has(type))throw new Error("invalid uniform type");this._owner=owner;this._gl=this._owner.GetWebGLContext();this._name=name;this._type=type;this._isColorType=this._type==="color";this._location=this._gl.getUniformLocation(this._owner.GetShaderProgram(),name);this._isUsed=!!this._location;var typeSize=TYPE_SIZES.get(type);this._lastValue=new Float32Array(typeSize);this._lastBatchValue=new Float32Array(typeSize);}_createClass(WebGLShaderUniform,[{key:"Release",value:function Release(){this._owner=null;this._gl=null;this._location=null;}},{key:"IsUsed",value:function IsUsed(){return this._isUsed;}},{key:"GetType",value:function GetType(){return this._type;}},{key:"IsColorType",value:function IsColorType(){return this._isColorType;}},{key:"Init1f",value:function Init1f(v0){if(!this.IsUsed())return;this._lastValue[0]=v0;this._lastBatchValue.set(this._lastValue);this._gl.uniform1f(this._location,v0);}},{key:"Init1i",value:function Init1i(v0){if(!this.IsUsed())return;this._lastValue[0]=v0;this._lastBatchValue.set(this._lastValue);this._gl.uniform1i(this._location,v0);}},{key:"Init2f",value:function Init2f(v0,v1){if(!this.IsUsed())return;this._lastValue[0]=v0;this._lastValue[1]=v1;this._lastBatchValue.set(this._lastValue);this._gl.uniform2f(this._location,v0,v1);}},{key:"Init3f",value:function Init3f(v0,v1,v2){if(!this.IsUsed())return;this._lastValue[0]=v0;this._lastValue[1]=v1;this._lastValue[2]=v2;this._lastBatchValue.set(this._lastValue);this._gl.uniform3f(this._location,v0,v1,v2);}},{key:"Init4f",value:function Init4f(v0,v1,v2,v3){if(!this.IsUsed())return;this._lastValue[0]=v0;this._lastValue[1]=v1;this._lastValue[2]=v2;this._lastValue[3]=v3;this._lastBatchValue.set(this._lastValue);this._gl.uniform4f(this._location,v0,v1,v2,v3);}},{key:"Update1f",value:function Update1f(v0){v0=Math.fround(v0);var lastValue=this._lastValue;if(lastValue[0]===v0)return;lastValue[0]=v0;this._gl.uniform1f(this._location,v0);}},{key:"Update1i",value:function Update1i(v0){var lastValue=this._lastValue;if(lastValue[0]===v0)return;lastValue[0]=v0;this._gl.uniform1i(this._location,v0);}},{key:"Update2f",value:function Update2f(v0,v1){v0=Math.fround(v0);v1=Math.fround(v1);var lastValue=this._lastValue;if(lastValue[0]===v0&&lastValue[1]===v1)return;lastValue[0]=v0;lastValue[1]=v1;this._gl.uniform2f(this._location,v0,v1);}},{key:"Update3f",value:function Update3f(v0,v1,v2){v0=Math.fround(v0);v1=Math.fround(v1);v2=Math.fround(v2);var lastValue=this._lastValue;if(lastValue[0]===v0&&lastValue[1]===v1&&lastValue[2]===v2)return;lastValue[0]=v0;lastValue[1]=v1;lastValue[2]=v2;this._gl.uniform3f(this._location,v0,v1,v2);}},{key:"Update4f",value:function Update4f(v0,v1,v2,v3){v0=Math.fround(v0);v1=Math.fround(v1);v2=Math.fround(v2);v3=Math.fround(v3);var lastValue=this._lastValue;if(lastValue[0]===v0&&lastValue[1]===v1&&lastValue[2]===v2&&lastValue[3]===v3)return;lastValue[0]=v0;lastValue[1]=v1;lastValue[2]=v2;lastValue[3]=v3;this._gl.uniform4f(this._location,v0,v1,v2,v3);}},{key:"UpdateMatrix4fv",value:function UpdateMatrix4fv(m){var lastValue=this._lastValue;if(_mat4.exactEquals(lastValue,m))return;_C51.typedArraySet16(lastValue,m,0);this._gl.uniformMatrix4fv(this._location,false,m);}},{key:"IsSetToCustomInBatch",value:function IsSetToCustomInBatch(p){var batchValue=this._lastBatchValue;if(this.IsColorType())return batchValue[0]===Math.fround(p.getR())&&batchValue[1]===Math.fround(p.getG())&&batchValue[2]===Math.fround(p.getB());else return batchValue[0]===Math.fround(p);}},{key:"SetBatchValueCustom",value:function SetBatchValueCustom(p){var batchValue=this._lastBatchValue;if(this.IsColorType()){batchValue[0]=p.getR();batchValue[1]=p.getG();batchValue[2]=p.getB();}else batchValue[0]=p;}},{key:"IsSetTo1InBatch",value:function IsSetTo1InBatch(x){return this._lastBatchValue[0]===Math.fround(x);}},{key:"IsSetTo2InBatch",value:function IsSetTo2InBatch(x,y){var batchValue=this._lastBatchValue;return batchValue[0]===Math.fround(x)&&batchValue[1]===Math.fround(y);}},{key:"SetBatch1",value:function SetBatch1(x){this._lastBatchValue[0]=x;}},{key:"SetBatch2",value:function SetBatch2(x,y){var batchValue=this._lastBatchValue;batchValue[0]=x;batchValue[1]=y;}}]);return WebGLShaderUniform;}();}// ../lib/gfx/webgl/batchJob.js
{'use strict';var _C52=self.C3;var _glMatrix5=self.glMatrix;var _vec5=_glMatrix5.vec4;var _mat5=_glMatrix5.mat4;var BATCH_NULL=0;var BATCH_QUAD=1;var BATCH_SETTEXTURE=2;var BATCH_SETCOLOR=3;var BATCH_SETBLEND=4;var BATCH_SETVIEWPORT=5;var BATCH_SETPROJECTION=6;var BATCH_SETMODELVIEW=7;var BATCH_SETRENDERTARGET=8;var BATCH_CLEARSURFACE=9;var BATCH_POINTS=10;var BATCH_SETPROGRAM=11;var BATCH_SETPROGRAMPARAMETERS=12;var BATCH_SETPROGRAMCUSTOMPARAMETERS=13;var BATCH_INVALIDATEFRAMEBUFFER=14;var BATCH_SETPOINTTEXCOORDS=15;var BATCH_SETTILEMAPINFO=16;var BATCH_BLITFRAMEBUFFER=17;var BATCH_STARTQUERY=18;var BATCH_ENDQUERY=19;var BATCH_SETELLIPSEPARAMS=20;var BATCH_SETGRADIENTCOLOR=21;var BATCH_CLEARDEPTH=22;var BATCH_SETDEPTHENABLED=23;var BATCH_SETDEPTHSAMPLINGENABLED=24;var BATCH_COPLANAR_STARTSTENCILPASS=25;var BATCH_COPLANAR_STARTCOLORPASS=26;var BATCH_COPLANAR_RESTORE=27;var BATCH_SET_SCISSOR=28;var BATCH_SETTILERANDOMIZATIONINFO=29;_C52.Gfx.BatchState=function BatchState(renderer){_classCallCheck(this,BatchState);this.renderer=renderer;this.currentMV=_mat5.create();this.currentMatP=_mat5.create();this.currentFramebuffer=null;this.currentFramebufferNoDepth=null;this.isDepthSamplingEnabled=false;this.currentColor=_vec5.fromValues(1,1,1,1);this.currentShader=null;this.pointTexCoords=new _C52.Rect();this.clearColor=_C52.New(_C52.Color,0,0,0,0);};_C52.Gfx.WebGLBatchJob=/*#__PURE__*/function(){function WebGLBatchJob(batchState){_classCallCheck(this,WebGLBatchJob);var arrayBuffer=new ArrayBuffer(96);this._type=0;this._batchState=batchState;this._gl=batchState.renderer.GetContext();this._startIndex=0;this._indexCount=0;this._texParam=null;this._mat4param=new Float32Array(arrayBuffer,0,16);this._colorParam=new Float32Array(arrayBuffer,64,4);this._srcOriginRect=new Float32Array(arrayBuffer,80,4);this._shaderParams=[];}_createClass(WebGLBatchJob,[{key:"InitQuad",value:function InitQuad(startIndex,indexCount){this._type=BATCH_QUAD;this._startIndex=startIndex;this._indexCount=indexCount;}},{key:"DoQuad",value:function DoQuad(){var gl=this._gl;gl.drawElements(gl.TRIANGLES,this._indexCount,gl.UNSIGNED_SHORT,this._startIndex);}},{key:"InitSetTexture",value:function InitSetTexture(rendererTex){this._type=BATCH_SETTEXTURE;this._texParam=rendererTex;}},{key:"DoSetTexture",value:function DoSetTexture(){var gl=this._gl;var texParam=this._texParam;gl.bindTexture(gl.TEXTURE_2D,texParam?texParam._GetTexture():null);}},{key:"InitSetColor",value:function InitSetColor(c){this._type=BATCH_SETCOLOR;c.writeToTypedArray(this._colorParam,0);}},{key:"DoSetColor",value:function DoSetColor(){var c=this._colorParam;var batchState=this._batchState;_vec5.copy(batchState.currentColor,c);batchState.currentShader.UpdateColor(c);}},{key:"InitSetGradientColor",value:function InitSetGradientColor(c){this._type=BATCH_SETGRADIENTCOLOR;c.writeToTypedArray(this._colorParam,0);}},{key:"DoSetGradientColor",value:function DoSetGradientColor(){var c=this._colorParam;var s=this._batchState.currentShader;if(s._uColor2.IsUsed())s._uColor2.Update4f(c[0],c[1],c[2],c[3]);}},{key:"InitSetBlend",value:function InitSetBlend(s,d){this._type=BATCH_SETBLEND;this._startIndex=s;this._indexCount=d;}},{key:"DoSetBlend",value:function DoSetBlend(){this._gl.blendFunc(this._startIndex,this._indexCount);}},{key:"InitSetViewport",value:function InitSetViewport(x,y,w,h){this._type=BATCH_SETVIEWPORT;var colorParam=this._colorParam;colorParam[0]=x;colorParam[1]=y;colorParam[2]=w;colorParam[3]=h;}},{key:"DoSetViewport",value:function DoSetViewport(){var colorParam=this._colorParam;this._gl.viewport(colorParam[0],colorParam[1],colorParam[2],colorParam[3]);}},{key:"InitSetProjection",value:function InitSetProjection(m){this._type=BATCH_SETPROJECTION;_mat5.copy(this._mat4param,m);}},{key:"DoSetProjection",value:function DoSetProjection(){var batchState=this._batchState;var allShaderPrograms=batchState.renderer._allShaderPrograms;var currentShader=batchState.currentShader;var mat4param=this._mat4param;for(var i=0,len=allShaderPrograms.length;i<len;++i){var s=allShaderPrograms[i];if(s===currentShader)s.UpdateMatP(mat4param,true);else s.SetMatPStale();}_mat5.copy(batchState.currentMatP,mat4param);}},{key:"InitSetModelView",value:function InitSetModelView(m){this._type=BATCH_SETMODELVIEW;_mat5.copy(this._mat4param,m);}},{key:"DoSetModelView",value:function DoSetModelView(){var batchState=this._batchState;var allShaderPrograms=batchState.renderer._allShaderPrograms;var currentShader=batchState.currentShader;var mat4param=this._mat4param;for(var i=0,len=allShaderPrograms.length;i<len;++i){var s=allShaderPrograms[i];if(s===currentShader)s.UpdateMatMV(mat4param,true);else s.SetMatMVStale();}_mat5.copy(batchState.currentMV,mat4param);}},{key:"InitSetRenderTarget",value:function InitSetRenderTarget(renderTarget){this._type=BATCH_SETRENDERTARGET;this._texParam=renderTarget;}},{key:"DoSetRenderTarget",value:function DoSetRenderTarget(){var gl=this._gl;var renderTarget=this._texParam;var batchState=this._batchState;if(renderTarget){batchState.currentFramebuffer=renderTarget._GetFramebuffer();batchState.currentFramebufferNoDepth=renderTarget._GetFramebufferNoDepth();if(batchState.isDepthSamplingEnabled&&batchState.currentFramebufferNoDepth)gl.bindFramebuffer(gl.FRAMEBUFFER,batchState.currentFramebufferNoDepth);else gl.bindFramebuffer(gl.FRAMEBUFFER,batchState.currentFramebuffer);}else{batchState.currentFramebuffer=null;batchState.currentFramebufferNoDepth=null;gl.bindFramebuffer(gl.FRAMEBUFFER,null);}}},{key:"InitClearSurface",value:function InitClearSurface(c){this._type=BATCH_CLEARSURFACE;c.writeToTypedArray(this._mat4param,0);}},{key:"InitClearSurface2",value:function InitClearSurface2(r,g,b,a){this._type=BATCH_CLEARSURFACE;var c=this._mat4param;c[0]=r;c[1]=g;c[2]=b;c[3]=a;}},{key:"DoClearSurface",value:function DoClearSurface(){var gl=this._gl;var mat4param=this._mat4param;var batchState=this._batchState;var lastClearColor=batchState.clearColor;var r=mat4param[0];var g=mat4param[1];var b=mat4param[2];var a=mat4param[3];if(!lastClearColor.equalsRgba(r,g,b,a)){gl.clearColor(r,g,b,a);lastClearColor.setRgba(r,g,b,a);}gl.clear(gl.COLOR_BUFFER_BIT);}},{key:"InitSetPointTexCoords",value:function InitSetPointTexCoords(rect){this._type=BATCH_SETPOINTTEXCOORDS;rect.writeToTypedArray(this._mat4param,0);}},{key:"DoSetPointTextureCoords",value:function DoSetPointTextureCoords(){var mat4param=this._mat4param;this._batchState.pointTexCoords.set(mat4param[0],mat4param[1],mat4param[2],mat4param[3]);}},{key:"InitPoints",value:function InitPoints(startIndex,z){this._type=BATCH_POINTS;this._startIndex=startIndex;this._indexCount=1;this._mat4param[0]=z;}},{key:"DoPoints",value:function DoPoints(){var gl=this._gl;var batchState=this._batchState;var renderer=batchState.renderer;var s=renderer._spPoints;gl.useProgram(s._shaderProgram);s.UpdateMatP(batchState.currentMatP,false);s.UpdateMatMV(batchState.currentMV,false);var ptc=batchState.pointTexCoords;if(s._uPointTexStart.IsUsed())s._uPointTexStart.Update2f(ptc.getLeft(),ptc.getTop());if(s._uPointTexEnd.IsUsed())s._uPointTexEnd.Update2f(ptc.getRight(),ptc.getBottom());var z=this._mat4param[0];if(s._uZElevation.IsUsed())s._uZElevation.Update1f(z);if(s._uColor.IsUsed()){var _c2=batchState.currentColor;s._uColor.Update4f(_c2[0],_c2[1],_c2[2],_c2[3]);}gl.drawArrays(gl.POINTS,this._startIndex/4,this._indexCount);gl.useProgram(batchState.currentShader._shaderProgram);}},{key:"InitSetProgram",value:function InitSetProgram(program){this._type=BATCH_SETPROGRAM;this._texParam=program;}},{key:"DoSetProgram",value:function DoSetProgram(){var gl=this._gl;var batchState=this._batchState;var s=this._texParam;batchState.currentShader=s;gl.useProgram(s._shaderProgram);s.UpdateMatP(batchState.currentMatP,false);s.UpdateMatMV(batchState.currentMV,false);if(s._uColor.IsUsed()){var _c3=batchState.currentColor;s._uColor.Update4f(_c3[0],_c3[1],_c3[2],_c3[3]);}}},{key:"InitSetProgramParameters",value:function InitSetProgramParameters(){this._type=BATCH_SETPROGRAMPARAMETERS;}},{key:"DoSetProgramParameters",value:function DoSetProgramParameters(){var s=this._batchState.currentShader;var gl=this._gl;var mat4param=this._mat4param;var colorParam=this._colorParam;var srcOriginRect=this._srcOriginRect;if(s._uSamplerBack.IsUsed()){var renderer=this._batchState.renderer;var texParam=this._texParam;if(renderer._lastTexture1!==texParam){gl.activeTexture(gl.TEXTURE1);gl.bindTexture(gl.TEXTURE_2D,texParam?texParam._GetTexture():null);renderer._lastTexture1=texParam;gl.activeTexture(gl.TEXTURE0);}}if(s._uPixelSize.IsUsed())s._uPixelSize.Update2f(mat4param[0],mat4param[1]);if(s._uDestStart.IsUsed())s._uDestStart.Update2f(mat4param[2],mat4param[3]);if(s._uDestEnd.IsUsed())s._uDestEnd.Update2f(mat4param[4],mat4param[5]);if(s._uDevicePixelRatio.IsUsed())s._uDevicePixelRatio.Update1f(this._indexCount);if(s._uLayerScale.IsUsed())s._uLayerScale.Update1f(mat4param[6]);if(s._uLayerAngle.IsUsed())s._uLayerAngle.Update1f(mat4param[7]);if(s._uSrcStart.IsUsed())s._uSrcStart.Update2f(mat4param[12],mat4param[13]);if(s._uSrcEnd.IsUsed())s._uSrcEnd.Update2f(mat4param[14],mat4param[15]);if(s._uSrcOriginStart.IsUsed())s._uSrcOriginStart.Update2f(srcOriginRect[0],srcOriginRect[1]);if(s._uSrcOriginEnd.IsUsed())s._uSrcOriginEnd.Update2f(srcOriginRect[2],srcOriginRect[3]);if(s._uLayoutStart.IsUsed())s._uLayoutStart.Update2f(colorParam[0],colorParam[1]);if(s._uLayoutEnd.IsUsed())s._uLayoutEnd.Update2f(colorParam[2],colorParam[3]);if(s._uSeconds.IsUsed())s._uSeconds.Update1f(this._startIndex);}},{key:"InitSetProgramCustomParameters",value:function InitSetProgramCustomParameters(){this._type=BATCH_SETPROGRAMCUSTOMPARAMETERS;}},{key:"DoSetProgramCustomParameters",value:function DoSetProgramCustomParameters(){var s=this._batchState.currentShader;var uCustomParameters=s._uCustomParameters;var shaderParams=this._shaderParams;for(var i=0,len=uCustomParameters.length;i<len;++i){var shaderUniform=uCustomParameters[i];var paramValue=shaderParams[i];if(shaderUniform.IsColorType())shaderUniform.Update3f(paramValue.getR(),paramValue.getG(),paramValue.getB());else shaderUniform.Update1f(paramValue);}}},{key:"InitInvalidateFramebuffer",value:function InitInvalidateFramebuffer(fbo){this._type=BATCH_INVALIDATEFRAMEBUFFER;this._texParam=fbo;}},{key:"DoInvalidateFramebuffer",value:function DoInvalidateFramebuffer(){var gl=this._gl;var fbo=this._texParam;var lastBoundFbo=this._batchState.currentFramebuffer;if(fbo!==lastBoundFbo)gl.bindFramebuffer(gl.FRAMEBUFFER,fbo);gl.invalidateFramebuffer(gl.FRAMEBUFFER,[gl.COLOR_ATTACHMENT0]);if(fbo!==lastBoundFbo)gl.bindFramebuffer(gl.FRAMEBUFFER,lastBoundFbo);}},{key:"InitBlitFramebuffer",value:function InitBlitFramebuffer(sourceRenderTarget,destRenderTarget,mode){this._type=BATCH_BLITFRAMEBUFFER;var mat4param=this._mat4param;var renderer=this._batchState.renderer;mat4param[0]=sourceRenderTarget.GetWidth();mat4param[1]=sourceRenderTarget.GetHeight();mat4param[2]=destRenderTarget?destRenderTarget.GetWidth():renderer.GetWidth();mat4param[3]=destRenderTarget?destRenderTarget.GetHeight():renderer.GetHeight();mat4param[4]=sourceRenderTarget.IsLinearSampling()?1:0;mat4param[5]=mode==="stretch";var shaderParams=this._shaderParams;_C52.clearArray(shaderParams);shaderParams.push(sourceRenderTarget._GetFramebuffer());shaderParams.push(destRenderTarget?destRenderTarget._GetFramebuffer():null);}},{key:"DoBlitFramebuffer",value:function DoBlitFramebuffer(){var mat4param=this._mat4param;var shaderParams=this._shaderParams;var gl=this._gl;var srcWidth=mat4param[0];var srcHeight=mat4param[1];var destWidth=mat4param[2];var destHeight=mat4param[3];var isLinearSampling=mat4param[4]!==0;var isStretch=mat4param[5]!==0;var srcFbo=shaderParams[0];var destFbo=shaderParams[1];gl.bindFramebuffer(gl.READ_FRAMEBUFFER,srcFbo);gl.bindFramebuffer(gl.DRAW_FRAMEBUFFER,destFbo);if(isStretch)gl.blitFramebuffer(0,0,srcWidth,srcHeight,0,0,destWidth,destHeight,gl.COLOR_BUFFER_BIT,isLinearSampling?gl.LINEAR:gl.NEAREST);else{var w=Math.min(srcWidth,destWidth);var h=Math.min(srcHeight,destHeight);var srcOffY=Math.max(srcHeight-destHeight,0);var destOffY=Math.max(destHeight-srcHeight,0);gl.blitFramebuffer(0,srcOffY,w,h+srcOffY,0,destOffY,w,h+destOffY,gl.COLOR_BUFFER_BIT,gl.NEAREST);}}},{key:"InitStartQuery",value:function InitStartQuery(query){this._type=BATCH_STARTQUERY;this._texParam=query;}},{key:"DoStartQuery",value:function DoStartQuery(){this._texParam.BeginTimeElapsed();this._texParam=null;}},{key:"InitEndQuery",value:function InitEndQuery(query){this._type=BATCH_ENDQUERY;this._texParam=query;}},{key:"DoEndQuery",value:function DoEndQuery(){this._texParam.EndTimeElapsed();this._texParam=null;}},{key:"InitSetEllipseParams",value:function InitSetEllipseParams(pixelW,pixelH,outlineThickness){this._type=BATCH_SETELLIPSEPARAMS;var mat4param=this._mat4param;mat4param[0]=pixelW;mat4param[1]=pixelH;mat4param[2]=outlineThickness;}},{key:"DoSetEllipseParams",value:function DoSetEllipseParams(){var s=this._batchState.currentShader;var mat4param=this._mat4param;if(s._uPixelSize.IsUsed())s._uPixelSize.Update2f(mat4param[0],mat4param[1]);if(s._uOutlineThickness.IsUsed())s._uOutlineThickness.Update1f(mat4param[2]);}},{key:"InitSetTilemapInfo",value:function InitSetTilemapInfo(srcRect,textureWidth,textureHeight,tileWidth,tileHeight,tileSpacingX,tileSpacingY){this._type=BATCH_SETTILEMAPINFO;var mat4param=this._mat4param;srcRect.writeToTypedArray(mat4param,0);mat4param[4]=1/textureWidth;mat4param[5]=1/textureHeight;mat4param[6]=tileWidth/textureWidth;mat4param[7]=tileHeight/textureHeight;mat4param[8]=tileSpacingX/textureWidth;mat4param[9]=tileSpacingY/textureHeight;}},{key:"DoSetTilemapInfo",value:function DoSetTilemapInfo(){var s=this._batchState.currentShader;var mat4param=this._mat4param;if(s._uSrcStart.IsUsed())s._uSrcStart.Update2f(mat4param[0],mat4param[1]);if(s._uPixelSize.IsUsed())s._uPixelSize.Update2f(mat4param[4],mat4param[5]);if(s._uTileSize.IsUsed())s._uTileSize.Update2f(mat4param[6],mat4param[7]);if(s._uTileSpacing.IsUsed())s._uTileSpacing.Update2f(mat4param[8],mat4param[9]);}},{key:"InitSetTileRandomizationInfo",value:function InitSetTileRandomizationInfo(textureWidth,textureHeight,xRandom,yRandom,angleRandom,blendMarginX,blendMarginY){this._type=BATCH_SETTILERANDOMIZATIONINFO;var mat4param=this._mat4param;mat4param[0]=1/textureWidth;mat4param[1]=1/textureHeight;mat4param[2]=xRandom;mat4param[3]=yRandom;mat4param[4]=angleRandom;mat4param[5]=blendMarginX;mat4param[6]=blendMarginY;}},{key:"DoSetTileRandomizationInfo",value:function DoSetTileRandomizationInfo(){var s=this._batchState.currentShader;var mat4param=this._mat4param;if(s._uPixelSize.IsUsed())s._uPixelSize.Update2f(mat4param[0],mat4param[1]);if(s._uTileSize.IsUsed())s._uTileSize.Update2f(mat4param[2],mat4param[3]);if(s._uOutlineThickness.IsUsed())s._uOutlineThickness.Update1f(mat4param[4]);if(s._uTileSpacing.IsUsed())s._uTileSpacing.Update2f(mat4param[5],mat4param[6]);}},{key:"InitClearDepth",value:function InitClearDepth(isDepthEnabled){this._type=BATCH_CLEARDEPTH;this._startIndex=isDepthEnabled?1:0;}},{key:"DoClearDepth",value:function DoClearDepth(){var gl=this._gl;var isDepthEnabled=this._startIndex!==0;if(!isDepthEnabled)gl.depthMask(true);gl.clear(gl.DEPTH_BUFFER_BIT);if(!isDepthEnabled)gl.depthMask(false);}},{key:"InitSetDepthEnabled",value:function InitSetDepthEnabled(e){this._type=BATCH_SETDEPTHENABLED;this._startIndex=e?1:0;}},{key:"DoSetDepthEnabled",value:function DoSetDepthEnabled(){var gl=this._gl;if(this._startIndex===0){gl.disable(gl.DEPTH_TEST);gl.depthMask(false);}else{gl.enable(gl.DEPTH_TEST);gl.depthMask(true);}}},{key:"InitSetDepthSamplingEnabled",value:function InitSetDepthSamplingEnabled(e){this._type=BATCH_SETDEPTHSAMPLINGENABLED;this._startIndex=e?1:0;}},{key:"DoSetDepthSamplingEnabled",value:function DoSetDepthSamplingEnabled(){var gl=this._gl;var batchState=this._batchState;var renderer=batchState.renderer;var isDepthSamplingEnabled=this._startIndex!==0;batchState.isDepthSamplingEnabled=isDepthSamplingEnabled;gl.activeTexture(gl.TEXTURE2);if(isDepthSamplingEnabled){if(batchState.currentFramebufferNoDepth)gl.bindFramebuffer(gl.FRAMEBUFFER,batchState.currentFramebufferNoDepth);gl.bindTexture(gl.TEXTURE_2D,renderer._GetDepthBuffer());}else{gl.bindTexture(gl.TEXTURE_2D,null);if(batchState.currentFramebufferNoDepth)gl.bindFramebuffer(gl.FRAMEBUFFER,batchState.currentFramebuffer);}gl.activeTexture(gl.TEXTURE0);}},{key:"InitCoplanarStartStencilPass",value:function InitCoplanarStartStencilPass(){this._type=BATCH_COPLANAR_STARTSTENCILPASS;}},{key:"DoCoplanarStartStencilPass",value:function DoCoplanarStartStencilPass(){var gl=this._gl;gl.clear(gl.STENCIL_BUFFER_BIT);gl.enable(gl.STENCIL_TEST);gl.stencilFunc(gl.ALWAYS,1,1);gl.stencilOp(gl.KEEP,gl.KEEP,gl.REPLACE);gl.colorMask(false,false,false,false);}},{key:"InitCoplanarStartColorPass",value:function InitCoplanarStartColorPass(){this._type=BATCH_COPLANAR_STARTCOLORPASS;}},{key:"DoCoplanarStartColorPass",value:function DoCoplanarStartColorPass(){var gl=this._gl;gl.colorMask(true,true,true,true);gl.stencilFunc(gl.EQUAL,1,1);gl.stencilOp(gl.KEEP,gl.KEEP,gl.KEEP);}},{key:"InitCoplanarRestore",value:function InitCoplanarRestore(){this._type=BATCH_COPLANAR_RESTORE;}},{key:"DoCoplanarRestore",value:function DoCoplanarRestore(){var gl=this._gl;gl.disable(gl.STENCIL_TEST);}},{key:"InitSetScissor",value:function InitSetScissor(enable,x,y,w,h){this._type=BATCH_SET_SCISSOR;this._startIndex=enable?1:0;var mat4param=this._mat4param;mat4param[0]=x;mat4param[1]=y;mat4param[2]=w;mat4param[3]=h;}},{key:"DoSetScissor",value:function DoSetScissor(){var gl=this._gl;var mat4param=this._mat4param;if(this._startIndex===1){gl.enable(gl.SCISSOR_TEST);gl.scissor(mat4param[0],mat4param[1],mat4param[2],mat4param[3]);}else gl.disable(gl.SCISSOR_TEST);}},{key:"Run",value:function Run(){switch(this._type){case 1:this.DoQuad();return;case 2:this.DoSetTexture();return;case 3:this.DoSetColor();return;case 4:this.DoSetBlend();return;case 5:this.DoSetViewport();return;case 6:this.DoSetProjection();return;case 7:this.DoSetModelView();return;case 8:this.DoSetRenderTarget();return;case 9:this.DoClearSurface();return;case 10:this.DoPoints();return;case 11:this.DoSetProgram();return;case 12:this.DoSetProgramParameters();return;case 13:this.DoSetProgramCustomParameters();return;case 14:this.DoInvalidateFramebuffer();return;case 15:this.DoSetPointTextureCoords();return;case 16:this.DoSetTilemapInfo();return;case 17:this.DoBlitFramebuffer();return;case 18:this.DoStartQuery();return;case 19:this.DoEndQuery();return;case 20:this.DoSetEllipseParams();return;case 21:this.DoSetGradientColor();return;case 22:this.DoClearDepth();return;case 23:this.DoSetDepthEnabled();return;case 24:this.DoSetDepthSamplingEnabled();return;case 25:this.DoCoplanarStartStencilPass();return;case 26:this.DoCoplanarStartColorPass();return;case 27:this.DoCoplanarRestore();return;case 28:this.DoSetScissor();return;case 29:this.DoSetTileRandomizationInfo();return;}}}]);return WebGLBatchJob;}();}// ../lib/gfx/text.js
{var fillOrStrokeRect=function fillOrStrokeRect(ctx,isStroke,x,y,w,h){if(isStroke)ctx.strokeRect(x,y,w,h);else ctx.fillRect(x,y,w,h);};var ptToPx=function ptToPx(pt){return pt*(4/3);};var getOffsetParam=function getOffsetParam(paramStr,fragHeight){paramStr=paramStr.trim();var param=parseFloat(paramStr);if(!isFinite(param))return 0;if(paramStr.endsWith("%"))return fragHeight*param/100;else return param;};'use strict';var _C53=self.C3;var MAX_TEXTURE_SIZE=4096;var EXTRA_LINE_HEIGHT=4;var GENERIC_FONT_FAMILIES=new Set(["serif","sans-serif","monospace","cursive","fantasy","system-ui","ui-serif","ui-sans-serif","ui-monospace","ui-rounded","math","emoji","fangsong"]);var DEFAULT_OPTS={timeout:60};var tempColor=new _C53.Color(0,0,0,1);var VALID_HORIZ_ALIGNMENTS=new Set(["left","center","right"]);var VALID_VERT_ALIGNMENTS=new Set(["top","center","bottom"]);var VALID_WORD_WRAP_MODES=new Set(["word","character"]);var VALID_TEXT_DIRECTIONS=new Set(["ltr","rtl"]);var allRendererTexts=new Set();if(_C53.FontManager)_C53.FontManager.addEventListener("fontload",function(e){var fontName=e.font.GetName();var _iteratorNormalCompletion72=true;var _didIteratorError72=false;var _iteratorError72=undefined;try{for(var _iterator72=allRendererTexts[Symbol.iterator](),_step72;!(_iteratorNormalCompletion72=(_step72=_iterator72.next()).done);_iteratorNormalCompletion72=true){var f=_step72.value;if(f.IsBBCodeEnabled()||_C53.equalsNoCase(f.GetFontName(),fontName))f._SetWordWrapChanged();}}catch(err){_didIteratorError72=true;_iteratorError72=err;}finally{try{if(!_iteratorNormalCompletion72&&_iterator72["return"]!=null){_iterator72["return"]();}}finally{if(_didIteratorError72){throw _iteratorError72;}}}});var didCheckFoundBoundingBoxSupport=false;var supportsFontBoundingBoxMeasurements=false;_C53.Gfx.RendererText=/*#__PURE__*/function(){function RendererText(renderer,opts){var _this16=this;_classCallCheck(this,RendererText);opts=Object.assign({},DEFAULT_OPTS,opts);this._renderer=renderer;this._fontName="Arial";this._fontSize=16;this._fontSizeScale=1;this._lineHeight=0;this._isBold=false;this._isItalic=false;this._colorStr="black";this._isBBcodeEnabled=false;this._iconSet=null;this._iconSmoothing=true;this.onloadfont=null;this._alreadyLoadedFonts=new Set();this._horizontalAlign="left";this._verticalAlign="top";this._text="";this._bbString=null;this._wrappedText=_C53.New(_C53.WordWrap);this._wrapMode="word";this._textDirection="ltr";this._wordWrapChanged=false;this._textLayoutChanged=false;this._drawChanged=false;this._drawMaxCharCount=-1;this._drawCharCount=0;this._cssWidth=0;this._cssHeight=0;this._width=0;this._height=0;this._zoom=1;this._textCanvas=null;this._textContext=null;this._measureContext=null;this._measureContextTop=null;this._lastCanvasWidth=-1;this._lastCanvasHeight=-1;this._lastTextCanvasFont="";this._lastMeasureCanvasFont="";this._lastTextCanvasFillStyle="";this._lastTextCanvasOpacity=1;this._lastTextCanvasLineWidth=1;this._measureTextCallback=function(frag){return _this16._MeasureText(frag);};this._texture=null;this._rcTex=new _C53.Rect();this._scaleFactor=1;this._textureTimeout=new _C53.IdleTimeout(function(){_this16.ReleaseTexture();_this16._SetTextCanvasSize(8,8);},opts.timeout);this.ontextureupdate=null;this._wasReleased=false;allRendererTexts.add(this);}_createClass(RendererText,[{key:"Release",value:function Release(){this.onloadfont=null;this._alreadyLoadedFonts.clear();this._iconSet=null;this._bbString=null;this._textCanvas=null;this._textContext=null;this._measureContext=null;this._measureContextTop=null;this._measureTextCallback=null;this._textureTimeout.Release();this.ontextureupdate=null;this.ReleaseTexture();this._wrappedText.Clear();this._wrappedText=null;this._renderer=null;this._wasReleased=true;allRendererTexts["delete"](this);}},{key:"_SetDrawChanged",value:function _SetDrawChanged(){this._drawChanged=true;}},{key:"_SetTextLayoutChanged",value:function _SetTextLayoutChanged(){this._SetDrawChanged();this._textLayoutChanged=true;}},{key:"_SetWordWrapChanged",value:function _SetWordWrapChanged(){this._SetTextLayoutChanged();this._wordWrapChanged=true;}},{key:"SetBBCodeEnabled",value:function SetBBCodeEnabled(e){e=!!e;if(this._isBBcodeEnabled===e)return;this._isBBcodeEnabled=e;var textBaseline=this._isBBcodeEnabled?"alphabetic":"top";if(this._textContext)this._textContext.textBaseline=textBaseline;if(this._measureContext)this._measureContext.textBaseline=textBaseline;this._SetWordWrapChanged();}},{key:"IsBBCodeEnabled",value:function IsBBCodeEnabled(){return this._isBBcodeEnabled;}},{key:"SetIconSet",value:function SetIconSet(iconSet){var _this17=this;if(this._iconSet===iconSet)return;this._iconSet=iconSet;this._wrappedText.SetIconSet(iconSet);if(this._iconSet&&this._iconSet.IsLoading())this._iconSet.LoadContent().then(function(){return _this17._SetDrawChanged();});this._SetWordWrapChanged();}},{key:"SetIconSmoothing",value:function SetIconSmoothing(s){s=!!s;if(this._iconSmoothing===s)return;this._iconSmoothing=s;this._SetDrawChanged();}},{key:"SetFontName",value:function SetFontName(fontName){if(!fontName)fontName="serif";if(this._fontName===fontName)return;this._fontName=fontName;this._SetWordWrapChanged();}},{key:"GetFontName",value:function GetFontName(){return this._fontName;}},{key:"SetFontSize",value:function SetFontSize(fontSize){if(fontSize<.1)fontSize=.1;if(this._fontSize===fontSize)return;this._fontSize=fontSize;this._SetWordWrapChanged();}},{key:"SetFontSizeScale",value:function SetFontSizeScale(s){if(this._fontSizeScale===s)return;this._fontSizeScale=s;this._SetWordWrapChanged();}},{key:"SetLineHeight",value:function SetLineHeight(h){if(this._lineHeight===h)return;this._lineHeight=h;this._SetTextLayoutChanged();}},{key:"SetBold",value:function SetBold(bold){bold=!!bold;if(this._isBold===bold)return;this._isBold=bold;this._SetWordWrapChanged();}},{key:"SetItalic",value:function SetItalic(italic){italic=!!italic;if(this._isItalic===italic)return;this._isItalic=italic;this._SetWordWrapChanged();}},{key:"SetDrawMaxCharacterCount",value:function SetDrawMaxCharacterCount(n){n=Math.floor(n);if(this._drawMaxCharCount===n)return;this._drawMaxCharCount=n;this._SetDrawChanged();}},{key:"GetDrawMaxCharacterCount",value:function GetDrawMaxCharacterCount(){return this._drawMaxCharCount;}},{key:"_GetFontString",value:function _GetFontString(useCssUnits,frag){var ret=[];if(this._isBold||frag.HasStyleTag("b"))ret.push("bold");if(this._isItalic||frag.HasStyleTag("i"))ret.push("italic");var sizeStyle=frag.GetStyleTag("size");var fontSize=(sizeStyle?parseFloat(sizeStyle.param):this._fontSize)*this._fontSizeScale;if(useCssUnits)ret.push(fontSize+"pt");else ret.push(fontSize*this.GetDrawScale()+"pt");var fontName=this._fontName;var fontStyle=frag.GetStyleTag("font");if(fontStyle&&fontStyle.param){fontName=fontStyle.param;if(this.onloadfont&&!this._alreadyLoadedFonts.has(fontName)){this.onloadfont(fontName);this._alreadyLoadedFonts.add(fontName);}}if(fontName)if(GENERIC_FONT_FAMILIES.has(fontName))ret.push(fontName);else ret.push('"'+fontName+'"');return ret.join(" ");}},{key:"SetColor",value:function SetColor(c){if(c instanceof _C53.Color)c=c.getCssRgb();if(this._colorStr===c)return;this._colorStr=c;this._SetDrawChanged();}},{key:"SetColorRgb",value:function SetColorRgb(r,g,b){tempColor.setRgb(r,g,b);this.SetColor(tempColor);}},{key:"SetHorizontalAlignment",value:function SetHorizontalAlignment(h){if(!VALID_HORIZ_ALIGNMENTS.has(h))throw new Error("invalid horizontal alignment");if(this._horizontalAlign===h)return;this._horizontalAlign=h;this._SetTextLayoutChanged();}},{key:"SetVerticalAlignment",value:function SetVerticalAlignment(v){if(!VALID_VERT_ALIGNMENTS.has(v))throw new Error("invalid vertical alignment");if(this._verticalAlign===v)return;this._verticalAlign=v;this._SetTextLayoutChanged();}},{key:"SetWordWrapMode",value:function SetWordWrapMode(m){if(!VALID_WORD_WRAP_MODES.has(m))throw new Error("invalid word wrap mode");if(this._wrapMode===m)return;this._wrapMode=m;this._SetWordWrapChanged();}},{key:"SetTextDirection",value:function SetTextDirection(d){if(!VALID_TEXT_DIRECTIONS.has(d))throw new Error("invalid text direction");if(this._textDirection===d)return;this._textDirection=d;if(this._textContext)this._textContext.direction=this._textDirection;if(this._measureContext)this._measureContext.direction=this._textDirection;this._SetWordWrapChanged();}},{key:"SetText",value:function SetText(text){if(this._text===text)return;this._text=text;this._SetWordWrapChanged();}},{key:"GetDrawScale",value:function GetDrawScale(){return this._scaleFactor*this._zoom*self.devicePixelRatio;}},{key:"SetSize",value:function SetSize(cssWidth,cssHeight,zoom){if(typeof zoom==="undefined")zoom=1;if(cssWidth<=0||cssWidth<=0)return;if(this._cssWidth===cssWidth&&this._cssHeight===cssHeight&&this._zoom===zoom)return;var oldCssWidth=this._cssWidth;this._cssWidth=cssWidth;this._cssHeight=cssHeight;this._zoom=zoom;var dpr=self.devicePixelRatio;this._width=this._cssWidth*this._zoom*dpr;this._height=this._cssHeight*this._zoom*dpr;var maxDim=Math.max(this._width,this._height);var maxTextureSize=Math.min(this._renderer.GetMaxTextureSize(),MAX_TEXTURE_SIZE);var scale=1;if(maxDim>maxTextureSize){scale=maxTextureSize/maxDim;this._width=Math.min(this._width*scale,maxTextureSize);this._height=Math.min(this._height*scale,maxTextureSize);}this._scaleFactor=scale;if(this._cssWidth!==oldCssWidth)this._SetWordWrapChanged();else this._SetTextLayoutChanged();}},{key:"GetWidth",value:function GetWidth(){return this._width;}},{key:"GetHeight",value:function GetHeight(){return this._height;}},{key:"GetZoom",value:function GetZoom(){return this._zoom;}},{key:"GetTextWidth",value:function GetTextWidth(){this._UpdateTextMeasurements();return this._wrappedText.GetMaxLineWidth();}},{key:"GetTextHeight",value:function GetTextHeight(){this._UpdateTextMeasurements();return this._wrappedText.GetTotalLineHeight()+this._wrappedText.GetLineCount()*(this._lineHeight+EXTRA_LINE_HEIGHT)-this._lineHeight;}},{key:"GetLengthInGraphemes",value:function GetLengthInGraphemes(){this._UpdateTextMeasurements();var ret=0;var _iteratorNormalCompletion73=true;var _didIteratorError73=false;var _iteratorError73=undefined;try{for(var _iterator73=this._wrappedText.GetLines()[Symbol.iterator](),_step73;!(_iteratorNormalCompletion73=(_step73=_iterator73.next()).done);_iteratorNormalCompletion73=true){var line=_step73.value;var _iteratorNormalCompletion74=true;var _didIteratorError74=false;var _iteratorError74=undefined;try{for(var _iterator74=line.fragments()[Symbol.iterator](),_step74;!(_iteratorNormalCompletion74=(_step74=_iterator74.next()).done);_iteratorNormalCompletion74=true){var frag=_step74.value;ret+=frag.GetLength();}}catch(err){_didIteratorError74=true;_iteratorError74=err;}finally{try{if(!_iteratorNormalCompletion74&&_iterator74["return"]!=null){_iterator74["return"]();}}finally{if(_didIteratorError74){throw _iteratorError74;}}}}}catch(err){_didIteratorError73=true;_iteratorError73=err;}finally{try{if(!_iteratorNormalCompletion73&&_iterator73["return"]!=null){_iterator73["return"]();}}finally{if(_didIteratorError73){throw _iteratorError73;}}}return ret;}},{key:"GetTexture",value:function GetTexture(){this._textureTimeout.Reset();this._MaybeUpdate();return this._texture;}},{key:"HitTestFragment",value:function HitTestFragment(x,y){this._UpdateTextMeasurements();var scale=this.GetDrawScale();var lines=this._wrappedText.GetLines();var _iteratorNormalCompletion75=true;var _didIteratorError75=false;var _iteratorError75=undefined;try{for(var _iterator75=lines[Symbol.iterator](),_step75;!(_iteratorNormalCompletion75=(_step75=_iterator75.next()).done);_iteratorNormalCompletion75=true){var line=_step75.value;var yOff=line.GetFontBoundingBoxDescent()*scale;if(y>=line.GetPosY()-line.GetHeight()*scale+yOff&&y<line.GetPosY()+yOff){var _iteratorNormalCompletion76=true;var _didIteratorError76=false;var _iteratorError76=undefined;try{for(var _iterator76=line.fragments()[Symbol.iterator](),_step76;!(_iteratorNormalCompletion76=(_step76=_iterator76.next()).done);_iteratorNormalCompletion76=true){var frag=_step76.value;if(x>=frag.GetPosX()&&x<frag.GetPosX()+frag.GetWidth()*scale)return frag;}}catch(err){_didIteratorError76=true;_iteratorError76=err;}finally{try{if(!_iteratorNormalCompletion76&&_iterator76["return"]!=null){_iterator76["return"]();}}finally{if(_didIteratorError76){throw _iteratorError76;}}}}}}catch(err){_didIteratorError75=true;_iteratorError75=err;}finally{try{if(!_iteratorNormalCompletion75&&_iterator75["return"]!=null){_iterator75["return"]();}}finally{if(_didIteratorError75){throw _iteratorError75;}}}return null;}},{key:"fragmentsWithTag",value:/*#__PURE__*/regeneratorRuntime.mark(function fragmentsWithTag(tag){var lines,_iteratorNormalCompletion77,_didIteratorError77,_iteratorError77,_iterator77,_step77,line,_iteratorNormalCompletion78,_didIteratorError78,_iteratorError78,_iterator78,_step78,frag,tagStyle;return regeneratorRuntime.wrap(function fragmentsWithTag$(_context46){while(1){switch(_context46.prev=_context46.next){case 0:this._UpdateTextMeasurements();lines=this._wrappedText.GetLines();_iteratorNormalCompletion77=true;_didIteratorError77=false;_iteratorError77=undefined;_context46.prev=5;_iterator77=lines[Symbol.iterator]();case 7:if(_iteratorNormalCompletion77=(_step77=_iterator77.next()).done){_context46.next=40;break;}line=_step77.value;_iteratorNormalCompletion78=true;_didIteratorError78=false;_iteratorError78=undefined;_context46.prev=12;_iterator78=line.fragments()[Symbol.iterator]();case 14:if(_iteratorNormalCompletion78=(_step78=_iterator78.next()).done){_context46.next=23;break;}frag=_step78.value;tagStyle=frag.GetStyleTag("tag");if(!(tagStyle&&_C53.equalsNoCase(tagStyle.param,tag))){_context46.next=20;break;}_context46.next=20;return frag;case 20:_iteratorNormalCompletion78=true;_context46.next=14;break;case 23:_context46.next=29;break;case 25:_context46.prev=25;_context46.t0=_context46["catch"](12);_didIteratorError78=true;_iteratorError78=_context46.t0;case 29:_context46.prev=29;_context46.prev=30;if(!_iteratorNormalCompletion78&&_iterator78["return"]!=null){_iterator78["return"]();}case 32:_context46.prev=32;if(!_didIteratorError78){_context46.next=35;break;}throw _iteratorError78;case 35:return _context46.finish(32);case 36:return _context46.finish(29);case 37:_iteratorNormalCompletion77=true;_context46.next=7;break;case 40:_context46.next=46;break;case 42:_context46.prev=42;_context46.t1=_context46["catch"](5);_didIteratorError77=true;_iteratorError77=_context46.t1;case 46:_context46.prev=46;_context46.prev=47;if(!_iteratorNormalCompletion77&&_iterator77["return"]!=null){_iterator77["return"]();}case 49:_context46.prev=49;if(!_didIteratorError77){_context46.next=52;break;}throw _iteratorError77;case 52:return _context46.finish(49);case 53:return _context46.finish(46);case 54:case"end":return _context46.stop();}}},fragmentsWithTag,this,[[5,42,46,54],[12,25,29,37],[30,,32,36],[47,,49,53]]);})},{key:"FindFragmentWithTag",value:function FindFragmentWithTag(tag,index){var _iteratorNormalCompletion79=true;var _didIteratorError79=false;var _iteratorError79=undefined;try{for(var _iterator79=this.fragmentsWithTag(tag)[Symbol.iterator](),_step79;!(_iteratorNormalCompletion79=(_step79=_iterator79.next()).done);_iteratorNormalCompletion79=true){var frag=_step79.value;if(index===0)return frag;else--index;}}catch(err){_didIteratorError79=true;_iteratorError79=err;}finally{try{if(!_iteratorNormalCompletion79&&_iterator79["return"]!=null){_iterator79["return"]();}}finally{if(_didIteratorError79){throw _iteratorError79;}}}return null;}},{key:"CountFragmentsWithTag",value:function CountFragmentsWithTag(tag){var count=0;var _iteratorNormalCompletion80=true;var _didIteratorError80=false;var _iteratorError80=undefined;try{for(var _iterator80=this.fragmentsWithTag(tag)[Symbol.iterator](),_step80;!(_iteratorNormalCompletion80=(_step80=_iterator80.next()).done);_iteratorNormalCompletion80=true){var frag=_step80.value;++count;}}catch(err){_didIteratorError80=true;_iteratorError80=err;}finally{try{if(!_iteratorNormalCompletion80&&_iterator80["return"]!=null){_iterator80["return"]();}}finally{if(_didIteratorError80){throw _iteratorError80;}}}return count;}},{key:"_MaybeUpdate",value:function _MaybeUpdate(){if(this._texture&&!this._drawChanged&&!this._textLayoutChanged&&!this._wordWrapChanged)return;if(this._wasReleased)return;if(this._width<=0||this._height<=0)return;this._drawChanged=false;this._DoUpdate();}},{key:"_DoUpdate",value:function _DoUpdate(){if(this._wasReleased)return;this._UpdateTextMeasurements();this._SetTextCanvasSize(Math.max(_C53.nextHighestPowerOfTwo(Math.ceil(this._width)),128),Math.max(_C53.nextHighestPowerOfTwo(Math.ceil(this._height)),64));this._DrawTextToCanvas();this._UpdateTexture();this._textureTimeout.Reset();}},{key:"_SetTextCanvasSize",value:function _SetTextCanvasSize(w,h){if(!this._textCanvas)this._textCanvas=_C53.CreateCanvas(16,16);var wasReset=false;if(this._lastCanvasWidth!==w||this._lastCanvasHeight!==h){this._lastCanvasWidth=w;this._lastCanvasHeight=h;this._textCanvas.width=w;this._textCanvas.height=h;wasReset=true;}if(!this._textContext){this._textContext=this._textCanvas.getContext("2d");wasReset=true;}if(wasReset){this._textContext.textBaseline=this._isBBcodeEnabled?"alphabetic":"top";this._textContext.direction=this._textDirection;this._textContext.font=this._lastTextCanvasFont;this._textContext.fillStyle=this._lastTextCanvasFillStyle;this._textContext.strokeStyle=this._lastTextCanvasFillStyle;this._textContext.globalAlpha=this._lastTextCanvasOpacity;this._textContext.lineWidth=this._lastTextCanvasLineWidth;}else this._textContext.clearRect(0,0,w,h);}},{key:"_MaybeCreateMeasureContext",value:function _MaybeCreateMeasureContext(){if(this._measureContext)return;this._measureContext=_C53.CreateCanvas(16,16).getContext("2d");this._measureContextTop=_C53.CreateCanvas(16,16).getContext("2d");this._measureContext.textBaseline=this._isBBcodeEnabled?"alphabetic":"top";this._measureContextTop.textBaseline="top";this._measureContext.direction=this._textDirection;this._measureContextTop.direction=this._textDirection;}},{key:"_SetMeasureFontString",value:function _SetMeasureFontString(fontString){if(this._lastMeasureCanvasFont===fontString)return;this._lastMeasureCanvasFont=fontString;this._measureContext.font=fontString;this._measureContextTop.font=fontString;}},{key:"_SupportsFontBoundingBoxMeasurements",value:function _SupportsFontBoundingBoxMeasurements(){if(!didCheckFoundBoundingBoxSupport){didCheckFoundBoundingBoxSupport=true;this._MaybeCreateMeasureContext();var textMetrics=this._measureContext.measureText("test");supportsFontBoundingBoxMeasurements=typeof textMetrics["fontBoundingBoxAscent"]==="number"&&typeof textMetrics["fontBoundingBoxDescent"]==="number";}return supportsFontBoundingBoxMeasurements;}},{key:"_UpdateTextMeasurements",value:function _UpdateTextMeasurements(){this._UpdateWordWrap();this._UpdateTextLayout();}},{key:"_UpdateWordWrap",value:function _UpdateWordWrap(){if(!this._wordWrapChanged)return;this._MaybeCreateMeasureContext();if(this._isBBcodeEnabled&&(!this._bbString||this._bbString.toString()!==this._text))this._bbString=new _C53.BBString(this._text,{noEscape:true});this._wrappedText.WordWrap(this._isBBcodeEnabled?this._bbString.toFragmentList():this._text,this._measureTextCallback,this._cssWidth,this._wrapMode,0);this._wordWrapChanged=false;}},{key:"_UpdateTextLayout",value:function _UpdateTextLayout(){if(!this._textLayoutChanged)return;this._LayoutText();this._textLayoutChanged=false;}},{key:"_MeasureText",value:function _MeasureText(frag){var text=frag.IsText()?frag.GetCharacterArray().join(""):" ";this._SetMeasureFontString(this._GetFontString(true,frag));var sizeStyle=frag.GetStyleTag("size");var fontSize=(sizeStyle?parseFloat(sizeStyle.param):this._fontSize)*this._fontSizeScale;var textMetrics=this._measureContext.measureText(text);var topToAlphabeticDistance=0;if(this._isBBcodeEnabled&&this._SupportsFontBoundingBoxMeasurements()){var textMetricsTop=this._measureContextTop.measureText(text);topToAlphabeticDistance=textMetrics["fontBoundingBoxAscent"]-textMetricsTop["fontBoundingBoxAscent"];}return{width:textMetrics.width,height:ptToPx(fontSize),fontBoundingBoxAscent:textMetrics["fontBoundingBoxAscent"]||0,fontBoundingBoxDescent:textMetrics["fontBoundingBoxDescent"]||0,topToAlphabeticDistance:topToAlphabeticDistance};}},{key:"_SetDrawFontString",value:function _SetDrawFontString(fontString){if(this._lastTextCanvasFont===fontString)return;this._lastTextCanvasFont=fontString;this._textContext.font=fontString;}},{key:"_SetDrawCanvasColor",value:function _SetDrawCanvasColor(styleStr){if(this._lastTextCanvasFillStyle===styleStr)return;this._lastTextCanvasFillStyle=styleStr;this._textContext.fillStyle=styleStr;this._textContext.strokeStyle=styleStr;}},{key:"_SetDrawCanvasOpacity",value:function _SetDrawCanvasOpacity(o){if(this._lastTextCanvasOpacity===o)return;this._lastTextCanvasOpacity=o;this._textContext.globalAlpha=o;}},{key:"_SetDrawCanvasLineWith",value:function _SetDrawCanvasLineWith(w){if(this._lastTextCanvasLineWidth===w)return;this._lastTextCanvasLineWidth=w;this._textContext.lineWidth=w;}},{key:"_LayoutText",value:function _LayoutText(){var scale=this.GetDrawScale();var lineSpaceHeight=(EXTRA_LINE_HEIGHT+this._lineHeight)*scale;var penY=0;var lines=this._wrappedText.GetLines();if(lines.length===0)return;var _iteratorNormalCompletion81=true;var _didIteratorError81=false;var _iteratorError81=undefined;try{for(var _iterator81=lines[Symbol.iterator](),_step81;!(_iteratorNormalCompletion81=(_step81=_iterator81.next()).done);_iteratorNormalCompletion81=true){var _line=_step81.value;_line.SetPosX(NaN);_line.SetPosY(NaN);var _iteratorNormalCompletion82=true;var _didIteratorError82=false;var _iteratorError82=undefined;try{for(var _iterator82=_line.fragments()[Symbol.iterator](),_step82;!(_iteratorNormalCompletion82=(_step82=_iterator82.next()).done);_iteratorNormalCompletion82=true){var frag=_step82.value;frag.SetPosX(NaN);frag.SetPosY(NaN);}}catch(err){_didIteratorError82=true;_iteratorError82=err;}finally{try{if(!_iteratorNormalCompletion82&&_iterator82["return"]!=null){_iterator82["return"]();}}finally{if(_didIteratorError82){throw _iteratorError82;}}}}}catch(err){_didIteratorError81=true;_iteratorError81=err;}finally{try{if(!_iteratorNormalCompletion81&&_iterator81["return"]!=null){_iterator81["return"]();}}finally{if(_didIteratorError81){throw _iteratorError81;}}}var useFontBoundingBoxMeasurements=this._isBBcodeEnabled&&this._SupportsFontBoundingBoxMeasurements();var firstLineTextHeight=lines[0].GetHeight()*scale;if(this._verticalAlign==="center"){var linesTotalHeight=lines.reduce(function(a,v){return a+v.GetHeight()*scale+lineSpaceHeight;},0)-lineSpaceHeight;penY=Math.max(this._height/2-linesTotalHeight/2,0);if(useFontBoundingBoxMeasurements)firstLineTextHeight=lines[0].GetTopToAlphabeticDistance()*scale;}else if(this._verticalAlign==="bottom"){var _linesTotalHeight=lines.reduce(function(a,v){return a+v.GetHeight()*scale+lineSpaceHeight;},0)-this._lineHeight*scale;var lastLineDescentHeight=useFontBoundingBoxMeasurements?lines.at(-1).GetFontBoundingBoxDescent()*scale:0;penY=this._height-_linesTotalHeight-lastLineDescentHeight-2;}for(var i=0,len=lines.length;i<len;++i){var line=lines[i];var curLineTextHeight=line.GetHeight()*scale;var startPenY=penY;if(this._isBBcodeEnabled){penY+=i===0?firstLineTextHeight:curLineTextHeight;if(i>0&&penY>this._height-EXTRA_LINE_HEIGHT*scale)break;}else if(i>0&&penY>=this._height-curLineTextHeight)break;if(startPenY>=0)this._LayoutTextLine(line,penY,scale);if(!this._isBBcodeEnabled)penY+=curLineTextHeight;penY+=lineSpaceHeight;}}},{key:"_LayoutTextLine",value:function _LayoutTextLine(line,penY,scale){var penX=0;if(this._horizontalAlign==="center")penX=(this._width-line.GetWidth()*scale)/2;else if(this._horizontalAlign==="right")penX=this._width-line.GetWidth()*scale;line.SetPosX(penX);line.SetPosY(penY);var _iteratorNormalCompletion83=true;var _didIteratorError83=false;var _iteratorError83=undefined;try{for(var _iterator83=(this._textDirection==="ltr"?line.fragments():line.fragmentsReverse())[Symbol.iterator](),_step83;!(_iteratorNormalCompletion83=(_step83=_iterator83.next()).done);_iteratorNormalCompletion83=true){var frag=_step83.value;this._LayoutFragment(frag,penX,penY,scale);penX+=frag.GetWidth()*scale;}}catch(err){_didIteratorError83=true;_iteratorError83=err;}finally{try{if(!_iteratorNormalCompletion83&&_iterator83["return"]!=null){_iterator83["return"]();}}finally{if(_didIteratorError83){throw _iteratorError83;}}}}},{key:"_LayoutFragment",value:function _LayoutFragment(frag,penX,penY,scale){var offsetXStyle=frag.GetStyleTag("offsetx");penX+=offsetXStyle?getOffsetParam(offsetXStyle.param,frag.GetHeight())*scale:0;var offsetYStyle=frag.GetStyleTag("offsety");penY+=offsetYStyle?getOffsetParam(offsetYStyle.param,frag.GetHeight())*scale:0;if(frag.IsIcon()){var iconOffsetYStyle=frag.GetStyleTag("iconoffsety");penY+=iconOffsetYStyle?getOffsetParam(iconOffsetYStyle.param,frag.GetHeight())*scale:.2*frag.GetHeight()*scale;}frag.SetPosX(penX);frag.SetPosY(penY);}},{key:"_DrawTextToCanvas",value:function _DrawTextToCanvas(){this._textContext.imageSmoothingEnabled=this._iconSmoothing;this._drawCharCount=0;var scale=this.GetDrawScale();var lines=this._wrappedText.GetLines();var _iteratorNormalCompletion84=true;var _didIteratorError84=false;var _iteratorError84=undefined;try{for(var _iterator84=lines[Symbol.iterator](),_step84;!(_iteratorNormalCompletion84=(_step84=_iterator84.next()).done);_iteratorNormalCompletion84=true){var line=_step84.value;this._DrawTextLine(line,scale);}}catch(err){_didIteratorError84=true;_iteratorError84=err;}finally{try{if(!_iteratorNormalCompletion84&&_iterator84["return"]!=null){_iterator84["return"]();}}finally{if(_didIteratorError84){throw _iteratorError84;}}}}},{key:"_DrawTextLine",value:function _DrawTextLine(line,scale){var penX=line.GetPosX();var penY=line.GetPosY();if(!Number.isFinite(penX)||!Number.isFinite(penY))return;var _iteratorNormalCompletion85=true;var _didIteratorError85=false;var _iteratorError85=undefined;try{for(var _iterator85=(this._textDirection==="ltr"?line.fragments():line.fragmentsReverse())[Symbol.iterator](),_step85;!(_iteratorNormalCompletion85=(_step85=_iterator85.next()).done);_iteratorNormalCompletion85=true){var frag=_step85.value;this._DrawFragment(frag,scale,line.GetHeight());}}catch(err){_didIteratorError85=true;_iteratorError85=err;}finally{try{if(!_iteratorNormalCompletion85&&_iterator85["return"]!=null){_iterator85["return"]();}}finally{if(_didIteratorError85){throw _iteratorError85;}}}}},{key:"_DrawFragment",value:function _DrawFragment(frag,scale,lineHeight){var textContext=this._textContext;var penX=frag.GetPosX();var penY=frag.GetPosY();if(!Number.isFinite(penX)||!Number.isFinite(penY))return;var lineFontScale=lineHeight/16;var fragWidth=frag.GetWidth()*scale;var fragHeight=frag.GetHeight()*scale;var fragFontScale=frag.GetHeight()/16;var lineSpaceHeight=(EXTRA_LINE_HEIGHT+this._lineHeight)*scale;var chArr=frag.IsText()?frag.GetCharacterArray():null;if(this._drawMaxCharCount!==-1){if(this._drawCharCount>=this._drawMaxCharCount)return;if(frag.IsText())if(this._drawCharCount+chArr.length>this._drawMaxCharCount){chArr=chArr.slice(0,this._drawMaxCharCount-this._drawCharCount);fragWidth=this._MeasureText(frag).width*scale;}this._drawCharCount+=frag.GetLength();}var backgroundStyle=frag.GetStyleTag("background");var hasUnderline=frag.HasStyleTag("u");var hasStrikethrough=frag.HasStyleTag("s");if(frag.IsText()&&_C53.IsCharArrayAllWhitespace(chArr)&&!backgroundStyle&&!hasUnderline&&!hasStrikethrough||frag.HasStyleTag("hide"))return;if(backgroundStyle){this._SetDrawCanvasColor(backgroundStyle.param);textContext.fillRect(penX,penY-fragHeight,fragWidth,fragHeight+lineSpaceHeight);}var colorStyle=frag.GetStyleTag("color");var opacityStyle=frag.GetStyleTag("opacity");this._SetDrawCanvasOpacity(opacityStyle?parseFloat(opacityStyle.param)/100:1);var lineThicknessStyle=frag.GetStyleTag("linethickness");var lineThicknessScale=lineThicknessStyle?parseFloat(lineThicknessStyle.param):1;var isStroke=frag.HasStyleTag("stroke");if(isStroke)this._SetDrawCanvasLineWith(fragFontScale*.5*lineThicknessScale*this.GetDrawScale());if(frag.IsText()){var text=chArr.join("");this._SetDrawFontString(this._GetFontString(false,frag));if(!isStroke){this._SetDrawCanvasLineWith(fragFontScale*.5*lineThicknessScale*this.GetDrawScale());var outlineBackStyle=frag.GetStyleTag("outlineback");if(outlineBackStyle){this._SetDrawCanvasColor(outlineBackStyle.param);this._FillOrStrokeText(true,text,penX,penY,fragWidth);}}this._SetDrawCanvasColor(colorStyle?colorStyle.param:this._colorStr);this._FillOrStrokeText(isStroke,text,penX,penY,fragWidth);if(!isStroke){this._SetDrawCanvasLineWith(fragFontScale*.5*lineThicknessScale*this.GetDrawScale());var outlineStyle=frag.GetStyleTag("outline");if(outlineStyle){this._SetDrawCanvasColor(outlineStyle.param);this._FillOrStrokeText(true,text,penX,penY,fragWidth);}}}else if(frag.IsIcon())if(frag.GetWidth()>0){var drawable=frag.GetDrawable(this._iconSet);if(drawable)textContext.drawImage(drawable,penX,penY-fragHeight,fragWidth,fragHeight);}this._SetDrawCanvasColor(colorStyle?colorStyle.param:this._colorStr);if(hasUnderline)fillOrStrokeRect(textContext,isStroke,penX,penY+scale*lineFontScale,fragWidth,scale*lineFontScale*lineThicknessScale);if(hasStrikethrough){var defaultStrikeY=penY-fragHeight/4;var defaultStrikeHeight=scale*fragFontScale;var strikeYMid=defaultStrikeY+defaultStrikeHeight/2;textContext.fillRect(penX,strikeYMid-defaultStrikeHeight*lineThicknessScale/2,fragWidth,defaultStrikeHeight*lineThicknessScale);}}},{key:"_FillOrStrokeText",value:function _FillOrStrokeText(isStroke,text,x,y,width){if(this._textDirection==="rtl")x+=width;if(isStroke){if(_C53.Platform.BrowserEngine==="Gecko")this._textContext.strokeText(text,x,y,width);else this._textContext.strokeText(text,x,y);}else if(_C53.Platform.BrowserEngine==="Gecko")this._textContext.fillText(text,x,y,width);else this._textContext.fillText(text,x,y);}},{key:"_UpdateTexture",value:function _UpdateTexture(){if(this._renderer.IsContextLost())return;if(!this._texture)this._texture=this._renderer.CreateDynamicTexture(this._textCanvas.width,this._textCanvas.height,{mipMap:true,mipMapQuality:"high"});this._renderer.UpdateTexture(this._textCanvas,this._texture);this._rcTex.set(0,0,this._width/this._texture.GetWidth(),this._height/this._texture.GetHeight());if(this.ontextureupdate)this.ontextureupdate();}},{key:"GetTexRect",value:function GetTexRect(){return this._rcTex;}},{key:"ReleaseTexture",value:function ReleaseTexture(){if(this._texture){if(!this._renderer.IsContextLost())this._renderer.DeleteTexture(this._texture);this._texture=null;}}}],[{key:"OnContextLost",value:function OnContextLost(){var _iteratorNormalCompletion86=true;var _didIteratorError86=false;var _iteratorError86=undefined;try{for(var _iterator86=allRendererTexts[Symbol.iterator](),_step86;!(_iteratorNormalCompletion86=(_step86=_iterator86.next()).done);_iteratorNormalCompletion86=true){var rendererText=_step86.value;rendererText.ReleaseTexture();}}catch(err){_didIteratorError86=true;_iteratorError86=err;}finally{try{if(!_iteratorNormalCompletion86&&_iterator86["return"]!=null){_iterator86["return"]();}}finally{if(_didIteratorError86){throw _iteratorError86;}}}}},{key:"GetAll",value:function GetAll(){return allRendererTexts.values();}}]);return RendererText;}();}// ../lib/gfx/webgl/query.js
{'use strict';var _C54=self.C3;var WebGLRealTimeElapsedQuery=/*#__PURE__*/function(){function WebGLRealTimeElapsedQuery(renderer){_classCallCheck(this,WebGLRealTimeElapsedQuery);this._gl=renderer.GetContext();this._version=renderer.GetWebGLVersionNumber();this._timerExt=renderer._GetDisjointTimerQueryExtension();this._query=null;this._isActive=false;this._hasResult=false;this._result=0;if(this._version===1)this._query=this._timerExt["createQueryEXT"]();else this._query=this._gl["createQuery"]();}_createClass(WebGLRealTimeElapsedQuery,[{key:"Release",value:function Release(){this._DeleteQueryObject();this._gl=null;this._timerExt=null;this._hasResult=false;}},{key:"_DeleteQueryObject",value:function _DeleteQueryObject(){if(!this._query)return;if(this._version===1)this._timerExt["deleteQueryEXT"](this._query);else this._gl["deleteQuery"](this._query);this._query=null;}},{key:"BeginTimeElapsed",value:function BeginTimeElapsed(){if(this._isActive)throw new Error("query already active");if(this._version===1)this._timerExt["beginQueryEXT"](this._timerExt["TIME_ELAPSED_EXT"],this._query);else this._gl["beginQuery"](this._timerExt["TIME_ELAPSED_EXT"],this._query);this._isActive=true;}},{key:"EndTimeElapsed",value:function EndTimeElapsed(){if(!this._isActive)throw new Error("query not active");if(this._version===1)this._timerExt["endQueryEXT"](this._timerExt["TIME_ELAPSED_EXT"]);else this._gl["endQuery"](this._timerExt["TIME_ELAPSED_EXT"]);this._isActive=false;}},{key:"CheckForResult",value:function CheckForResult(){if(!this._query||this._hasResult||this._isActive)return;var available=false;if(this._version===1)available=this._timerExt["getQueryObjectEXT"](this._query,this._timerExt["QUERY_RESULT_AVAILABLE_EXT"]);else available=this._gl["getQueryParameter"](this._query,this._gl["QUERY_RESULT_AVAILABLE"]);var disjoint=this._gl.getParameter(this._timerExt["GPU_DISJOINT_EXT"]);if(available&&!disjoint){if(this._version===1)this._result=this._timerExt["getQueryObjectEXT"](this._query,this._timerExt["QUERY_RESULT_EXT"]);else this._result=this._gl["getQueryParameter"](this._query,this._gl["QUERY_RESULT"]);this._result/=1E9;this._hasResult=true;}if(available||disjoint)this._DeleteQueryObject();}},{key:"HasResult",value:function HasResult(){return this._hasResult;}},{key:"GetResult",value:function GetResult(){if(!this._hasResult)throw new Error("no result available");return this._result;}}]);return WebGLRealTimeElapsedQuery;}();_C54.Gfx.WebGLTimeElapsedQuery=/*#__PURE__*/function(){function WebGLTimeElapsedQuery(renderer){_classCallCheck(this,WebGLTimeElapsedQuery);this._renderer=renderer;this._frameNumber=renderer.GetFrameNumber();this._isActive=false;this._parentQuery=null;this._isNested=false;this._realQuery=null;this._queries=[];}_createClass(WebGLTimeElapsedQuery,[{key:"Release",value:function Release(){var _iteratorNormalCompletion87=true;var _didIteratorError87=false;var _iteratorError87=undefined;try{for(var _iterator87=this._queries[Symbol.iterator](),_step87;!(_iteratorNormalCompletion87=(_step87=_iterator87.next()).done);_iteratorNormalCompletion87=true){var q=_step87.value;if(q instanceof WebGLRealTimeElapsedQuery)q.Release();}}catch(err){_didIteratorError87=true;_iteratorError87=err;}finally{try{if(!_iteratorNormalCompletion87&&_iterator87["return"]!=null){_iterator87["return"]();}}finally{if(_didIteratorError87){throw _iteratorError87;}}}_C54.clearArray(this._queries);this._parentQuery=null;this._realQuery=null;this._renderer=null;}},{key:"BeginTimeElapsed",value:function BeginTimeElapsed(){if(this._isActive)throw new Error("query already active");var stack=this._renderer._GetTimeQueryStack();if(stack.length>0){this._isNested=true;this._parentQuery=stack.at(-1);this._parentQuery._EndReal();this._parentQuery._queries.push(this);}else{this._isNested=false;this._parentQuery=null;}this._isActive=true;stack.push(this);this._StartReal();}},{key:"EndTimeElapsed",value:function EndTimeElapsed(){if(!this._isActive)throw new Error("query not active");var top=this._renderer._GetTimeQueryStack().pop();if(top!==this)throw new Error("can only end most nested query");this._isActive=false;this._EndReal();if(this._parentQuery){this._parentQuery._StartReal();this._parentQuery=null;}}},{key:"_StartReal",value:function _StartReal(){this._realQuery=_C54.New(WebGLRealTimeElapsedQuery,this._renderer);this._queries.push(this._realQuery);this._realQuery.BeginTimeElapsed();}},{key:"_EndReal",value:function _EndReal(){this._realQuery.EndTimeElapsed();this._realQuery=null;}},{key:"CheckForResult",value:function CheckForResult(){var _iteratorNormalCompletion88=true;var _didIteratorError88=false;var _iteratorError88=undefined;try{for(var _iterator88=this._queries[Symbol.iterator](),_step88;!(_iteratorNormalCompletion88=(_step88=_iterator88.next()).done);_iteratorNormalCompletion88=true){var q=_step88.value;q.CheckForResult();}}catch(err){_didIteratorError88=true;_iteratorError88=err;}finally{try{if(!_iteratorNormalCompletion88&&_iterator88["return"]!=null){_iterator88["return"]();}}finally{if(_didIteratorError88){throw _iteratorError88;}}}}},{key:"IsNested",value:function IsNested(){return this._isNested;}},{key:"HasResult",value:function HasResult(){return this._queries.every(function(q){return q.HasResult();});}},{key:"GetResult",value:function GetResult(){return this._queries.reduce(function(a,v){return a+v.GetResult();},0);}},{key:"GetFrameNumber",value:function GetFrameNumber(){return this._frameNumber;}}]);return WebGLTimeElapsedQuery;}();}// ../lib/gfx/webgl/queryResultBuffer.js
{'use strict';var _C55=self.C3;_C55.Gfx.WebGLQueryResultBuffer=/*#__PURE__*/function(){function WebGLQueryResultBuffer(renderer){var maxQueries=arguments.length>1&&arguments[1]!==undefined?arguments[1]:1E3;_classCallCheck(this,WebGLQueryResultBuffer);this._renderer=renderer;this._maxQueries=maxQueries;this._buffer=[];this._renderer._AddQueryResultBuffer(this);}_createClass(WebGLQueryResultBuffer,[{key:"Release",value:function Release(){this.Clear();this._renderer._RemoveQueryResultBuffer(this);this._renderer=null;}},{key:"Clear",value:function Clear(){var _iteratorNormalCompletion89=true;var _didIteratorError89=false;var _iteratorError89=undefined;try{for(var _iterator89=this._buffer[Symbol.iterator](),_step89;!(_iteratorNormalCompletion89=(_step89=_iterator89.next()).done);_iteratorNormalCompletion89=true){var q=_step89.value;q.Release();}}catch(err){_didIteratorError89=true;_iteratorError89=err;}finally{try{if(!_iteratorNormalCompletion89&&_iterator89["return"]!=null){_iterator89["return"]();}}finally{if(_didIteratorError89){throw _iteratorError89;}}}_C55.clearArray(this._buffer);}},{key:"AddTimeElapsedQuery",value:function AddTimeElapsedQuery(){var ret=new _C55.Gfx.WebGLTimeElapsedQuery(this._renderer);this._buffer.push(ret);if(this._buffer.length>this._maxQueries){var oldest=this._buffer.shift();oldest.Release();}return ret;}},{key:"CheckForResults",value:function CheckForResults(toFrameNumber){var _iteratorNormalCompletion90=true;var _didIteratorError90=false;var _iteratorError90=undefined;try{for(var _iterator90=this._buffer[Symbol.iterator](),_step90;!(_iteratorNormalCompletion90=(_step90=_iterator90.next()).done);_iteratorNormalCompletion90=true){var q=_step90.value;if(q.GetFrameNumber()>=toFrameNumber)return;if(q.IsNested())return;q.CheckForResult();}}catch(err){_didIteratorError90=true;_iteratorError90=err;}finally{try{if(!_iteratorNormalCompletion90&&_iterator90["return"]!=null){_iterator90["return"]();}}finally{if(_didIteratorError90){throw _iteratorError90;}}}}},{key:"GetFrameRangeResultSum",value:function GetFrameRangeResultSum(startFrame,endFrame){if(endFrame<=startFrame)return NaN;var sum=0;var _iteratorNormalCompletion91=true;var _didIteratorError91=false;var _iteratorError91=undefined;try{for(var _iterator91=this._buffer[Symbol.iterator](),_step91;!(_iteratorNormalCompletion91=(_step91=_iterator91.next()).done);_iteratorNormalCompletion91=true){var q=_step91.value;if(q.GetFrameNumber()>=endFrame)break;if(q.GetFrameNumber()<startFrame)continue;if(q.HasResult())sum+=q.GetResult();else return NaN;}}catch(err){_didIteratorError91=true;_iteratorError91=err;}finally{try{if(!_iteratorNormalCompletion91&&_iterator91["return"]!=null){_iterator91["return"]();}}finally{if(_didIteratorError91){throw _iteratorError91;}}}return sum;}},{key:"DeleteAllBeforeFrameNumber",value:function DeleteAllBeforeFrameNumber(frameNumber){for(var i=0,len=this._buffer.length;i<len;++i){var q=this._buffer[i];if(q.GetFrameNumber()<frameNumber)q.Release();else{if(i>0)this._buffer.splice(0,i);return;}}}}]);return WebGLQueryResultBuffer;}();}// ../lib/gfx/webgl/webglRenderer.js
{var CheckPendingPolls=function CheckPendingPolls(){pollRafId=-1;var _iteratorNormalCompletion92=true;var _didIteratorError92=false;var _iteratorError92=undefined;try{for(var _iterator92=pendingPolls[Symbol.iterator](),_step92;!(_iteratorNormalCompletion92=(_step92=_iterator92.next()).done);_iteratorNormalCompletion92=true){var info=_step92.value;if(info.checkFunc()){info.resolve();pendingPolls["delete"](info);}}}catch(err){_didIteratorError92=true;_iteratorError92=err;}finally{try{if(!_iteratorNormalCompletion92&&_iterator92["return"]!=null){_iterator92["return"]();}}finally{if(_didIteratorError92){throw _iteratorError92;}}}if(pendingPolls.size>0)pollRafId=self.requestAnimationFrame(CheckPendingPolls);};'use strict';var _C56=self.C3;var _assert4=self.assert;var _glMatrix6=self.glMatrix;var _vec6=_glMatrix6.vec3;var _vec7=_glMatrix6.vec4;var _mat6=_glMatrix6.mat4;var DEFAULT_WEBGLRENDERER_OPTS={powerPreference:"default",enableGpuProfiling:true,alpha:false,lowLatency:false,depth:false,canSampleDepth:false,maxWebGLVersion:2,failIfMajorPerformanceCaveat:false};var VALID_POWER_PREFERENCES=new Set(["default","low-power","high-performance"]);var MAX_VERTICES=8E3;var MAX_INDICES=MAX_VERTICES/2*3;var MAX_POINTS=8E3;var LAST_POINT=MAX_POINTS-4;var PARTIAL_TEXTURE_UPLOAD_CHUNK_SIZE=256*1024;var _defaultTexCoordsQuad=new _C56.Quad(0,0,1,0,1,1,0,1);var tmpProjection=_mat6.create();var tmpModelView=_mat6.create();var _tmpQuad=new _C56.Quad();var _tmpRect=new _C56.Rect();var loseContextExtension=null;if(_C56.isDebug){self.debug_lose_webgl_context=function(){if(!loseContextExtension){console.warn("WEBGL_lose_context not supported");return;}loseContextExtension.loseContext();};self.debug_restore_webgl_context=function(){if(!loseContextExtension){console.warn("WEBGL_lose_context not supported");return;}loseContextExtension.restoreContext();};}var pendingPolls=new Set();var pollRafId=-1;_C56.Gfx.WebGLRenderer=/*#__PURE__*/function(_C56$Gfx$RendererBase){_inherits(WebGLRenderer,_C56$Gfx$RendererBase);function WebGLRenderer(canvas,opts){var _this18;_classCallCheck(this,WebGLRenderer);_this18=_possibleConstructorReturn(this,_getPrototypeOf(WebGLRenderer).call(this,opts));opts=Object.assign({},DEFAULT_WEBGLRENDERER_OPTS,opts);if(!VALID_POWER_PREFERENCES.has(opts.powerPreference))throw new Error("invalid power preference");var attribs={"alpha":!!opts.alpha,"depth":false,"antialias":false,"powerPreference":opts.powerPreference,"failIfMajorPerformanceCaveat":!!opts.failIfMajorPerformanceCaveat};if(opts.lowLatency){attribs["desynchronized"]=true;attribs["preserveDrawingBuffer"]=true;}var gl=null;var version=0;if(opts.maxWebGLVersion>=2){gl=canvas.getContext("webgl2",attribs);version=2;}if(!gl){gl=canvas.getContext("webgl",attribs);version=1;}if(!gl)throw new Error("renderer-unavailable (could not get WebGL context)");_this18._gl=gl;_this18._attribs=gl.getContextAttributes();if(opts.lowLatency&&!_this18._attribs["desynchronized"])console.info("[WebGLRenderer] Low-latency mode specified but is not supported here");_this18._versionString=gl.getParameter(gl.VERSION);_this18._version=version;_this18._viewport=_vec7.create();_this18._didChangeTransform=false;_this18._bbProjectionMatrix=_mat6.create();_this18._usesDepthBuffer=!!opts.depth;_this18._canSampleDepth=!!(opts.depth&&opts.canSampleDepth);_this18._isDepthEnabled=_this18._usesDepthBuffer;_this18._isDepthSamplingEnabled=false;_this18._depthBuffer=null;_this18._isAutoSizeDepthBuffer=true;_this18._depthBufferWidth=0;_this18._depthBufferHeight=0;_this18._vertexBuffer=null;_this18._texcoordBuffer=null;_this18._indexBuffer=null;_this18._pointBuffer=null;_this18._vertexData=new Float32Array(MAX_VERTICES*_this18.GetNumVertexComponents());_this18._indexData=new Uint16Array(MAX_INDICES);_this18._texcoordData=new Float32Array(MAX_VERTICES*2);_this18._pointData=new Float32Array(MAX_POINTS*4);_this18._vertexPtr=0;_this18._texPtr=0;_this18._pointPtr=0;_this18._lastVertexPtr=0;_this18._lastProgram=null;_this18._spDeviceTransformTextureFill=null;_this18._batch=[];_this18._batchPtr=0;_this18._topOfBatch=0;_this18._currentRenderTarget=null;_this18._lastPointZ=0;_this18._batchState=_C56.New(_C56.Gfx.BatchState,_assertThisInitialized(_this18));_this18._lastColor=_C56.New(_C56.Color,1,1,1,1);_this18._lastTexture0=null;_this18._lastTexture1=null;_this18._lastSrcBlend=0;_this18._lastDestBlend=0;_this18._lastPointTexCoords=new _C56.Rect();_this18._lastScissorRect=_C56.New(_C56.Rect,0,0,-1,-1);_this18._coplanarMode=0;_this18._maxTextureSize=-1;_this18._minPointSize=0;_this18._maxPointSize=0;_this18._highpPrecision=0;_this18._unmaskedVendor="(unavailable)";_this18._unmaskedRenderer="(unavailable)";_this18._extensions=[];_this18._isInitialisingAfterContextRestored=false;_this18._parallelShaderCompileExt=null;_this18._anisotropicExt=null;_this18._depthTextureExt=null;_this18._fragDepthExt=null;_this18._stdDerivativesExt=null;_this18._textureLodExt=null;_this18._maxAnisotropy=0;_this18._isGpuProfilingEnabled=!!opts.enableGpuProfiling;_this18._timerExt=null;_this18._allQueryResultBuffers=new Set();_this18._timeQueryStack=[];_this18.FillIndexBufferData(_this18._indexData);return _this18;}_createClass(WebGLRenderer,[{key:"IsWebGL",value:function IsWebGL(){return true;}},{key:"InitState",value:function InitState(){var _this19=this;var gl,numVertexComponents,batchState,pointsizes,highpVertex,highpFrag,debug_ext,WebGLShaderProgram,vsSource,textureFillFragmentSrc,textureFillVertexSrc,pointFragmentSrc,pointVertexSrc,tilemapFragmentSrc,tilemapVertexSrc,useFragDepthExt,tileRandomizationFragmentSrc,tileRandomizationVertexSrc,DEFAULT_SHADER_PROGRAMS,defaultShaders;return regeneratorRuntime.async(function InitState$(_context47){while(1){switch(_context47.prev=_context47.next){case 0:_get(_getPrototypeOf(WebGLRenderer.prototype),"InitState",this).call(this);gl=this._gl;numVertexComponents=this.GetNumVertexComponents();this._lastColor.setRgba(1,1,1,1);this._lastTexture0=null;this._lastTexture1=null;this._vertexPtr=0;this._pointPtr=0;this._lastVertexPtr=MAX_VERTICES*numVertexComponents-4*numVertexComponents;_C56.clearArray(this._batch);this._batchPtr=0;this._topOfBatch=0;this._lastProgram=null;this._currentRenderTarget=null;this._lastPointTexCoords.set(0,0,1,1);this._lastPointZ=0;batchState=this._batchState;batchState.currentShader=null;batchState.currentFramebuffer=null;batchState.currentFramebufferNoDepth=null;_vec7.set(batchState.currentColor,1,1,1,1);batchState.clearColor.setRgba(0,0,0,0);batchState.pointTexCoords.set(0,0,1,1);gl.clearColor(0,0,0,0);gl.clear(gl.COLOR_BUFFER_BIT);gl.enable(gl.BLEND);gl.blendFunc(gl.ONE,gl.ONE_MINUS_SRC_ALPHA);this._lastSrcBlend=gl.ONE;this._lastDestBlend=gl.ONE_MINUS_SRC_ALPHA;this._InitBlendModes(gl);gl.disable(gl.CULL_FACE);gl.disable(gl.STENCIL_TEST);gl.disable(gl.DITHER);if(this._usesDepthBuffer){gl.enable(gl.DEPTH_TEST);gl.depthMask(true);gl.depthFunc(gl.LEQUAL);}else{gl.disable(gl.DEPTH_TEST);gl.depthMask(false);}this._isDepthEnabled=this._usesDepthBuffer;this._isDepthSamplingEnabled=false;this._pointBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,this._pointBuffer);gl.bufferData(gl.ARRAY_BUFFER,this._pointData.byteLength,gl.DYNAMIC_DRAW);this._vertexBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,this._vertexBuffer);gl.bufferData(gl.ARRAY_BUFFER,this._vertexData.byteLength,gl.DYNAMIC_DRAW);this._texcoordBuffer=gl.createBuffer();gl.bindBuffer(gl.ARRAY_BUFFER,this._texcoordBuffer);gl.bufferData(gl.ARRAY_BUFFER,this._texcoordData.byteLength,gl.DYNAMIC_DRAW);this._indexBuffer=gl.createBuffer();gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this._indexBuffer);gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,this._indexData,gl.STATIC_DRAW);gl.activeTexture(gl.TEXTURE0);gl.bindTexture(gl.TEXTURE_2D,null);this._maxTextureSize=gl.getParameter(gl.MAX_TEXTURE_SIZE);pointsizes=gl.getParameter(gl.ALIASED_POINT_SIZE_RANGE);this._minPointSize=pointsizes[0];this._maxPointSize=pointsizes[1];highpVertex=gl.getShaderPrecisionFormat(gl.VERTEX_SHADER,gl.HIGH_FLOAT);highpFrag=gl.getShaderPrecisionFormat(gl.FRAGMENT_SHADER,gl.HIGH_FLOAT);if(highpVertex&&highpFrag)this._highpPrecision=Math.min(highpVertex["precision"],highpFrag["precision"]);else this._highpPrecision=0;if(this._maxPointSize>2048)this._maxPointSize=2048;this._extensions=gl.getSupportedExtensions();debug_ext=gl.getExtension("WEBGL_debug_renderer_info");if(debug_ext){this._unmaskedVendor=gl.getParameter(debug_ext["UNMASKED_VENDOR_WEBGL"]);this._unmaskedRenderer=gl.getParameter(debug_ext["UNMASKED_RENDERER_WEBGL"]);}this._parallelShaderCompileExt=gl.getExtension("KHR_parallel_shader_compile");if(_C56.isDebug)loseContextExtension=gl.getExtension("WEBGL_lose_context");if(this._isGpuProfilingEnabled)if(this.GetWebGLVersionNumber()===1){if(_C56.Platform.BrowserEngine!=="Chromium"||_C56.Platform.BrowserVersionNumber>=81||typeof document!=="undefined")this._timerExt=gl.getExtension("EXT_disjoint_timer_query");}else this._timerExt=gl.getExtension("EXT_disjoint_timer_query_webgl2")||gl.getExtension("EXT_disjoint_timer_query");this._anisotropicExt=gl.getExtension("EXT_texture_filter_anisotropic");if(this._anisotropicExt)this._maxAnisotropy=gl.getParameter(this._anisotropicExt["MAX_TEXTURE_MAX_ANISOTROPY_EXT"]);else this._maxAnisotropy=0;if(!(this.GetWebGLVersionNumber()<2&&this._usesDepthBuffer&&this._canSampleDepth)){_context47.next=70;break;}this._depthTextureExt=gl.getExtension("WEBGL_depth_texture");if(this._depthTextureExt){_context47.next=70;break;}throw new Error("no depth texture support");case 70:if(this.GetWebGLVersionNumber()<2){this._fragDepthExt=gl.getExtension("EXT_frag_depth");this._stdDerivativesExt=gl.getExtension("OES_standard_derivatives");this._textureLodExt=gl.getExtension("EXT_shader_texture_lod");}WebGLShaderProgram=_C56.Gfx.WebGLShaderProgram;vsSource=WebGLShaderProgram.GetDefaultVertexShaderSource(false);textureFillFragmentSrc=WebGLShaderProgram.GetTextureFillFragmentShaderSource_WebGL1_NoFragDepth();textureFillVertexSrc=vsSource;pointFragmentSrc=WebGLShaderProgram.GetPointFragmentShaderSource_WebGL1_NoFragDepth();pointVertexSrc=WebGLShaderProgram.GetPointVertexShaderSource_WebGL1();tilemapFragmentSrc=WebGLShaderProgram.GetTilemapFragmentShaderSource_WebGL1_NoFragDepth();tilemapVertexSrc=WebGLShaderProgram.GetDefaultVertexShaderSource(true);useFragDepthExt=false;if(this._usesDepthBuffer)if(this.GetWebGLVersionNumber()<2){if(this._fragDepthExt){textureFillFragmentSrc=WebGLShaderProgram.GetTextureFillFragmentShaderSource_WebGL1_FragDepthEXT();pointFragmentSrc=WebGLShaderProgram.GetPointFragmentShaderSource_WebGL1_FragDepthEXT();tilemapFragmentSrc=WebGLShaderProgram.GetTilemapFragmentShaderSource_WebGL1_FragDepthEXT();useFragDepthExt=true;}}else{textureFillVertexSrc=WebGLShaderProgram.GetDefaultVertexShaderSource_WebGL2();textureFillFragmentSrc=WebGLShaderProgram.GetTextureFillFragmentShaderSource_WebGL2();pointFragmentSrc=WebGLShaderProgram.GetPointFragmentShaderSource_WebGL2();pointVertexSrc=WebGLShaderProgram.GetPointVertexShaderSource_WebGL2();tilemapFragmentSrc=WebGLShaderProgram.GetTilemapFragmentShaderSource_WebGL2();tilemapVertexSrc=WebGLShaderProgram.GetDefaultVertexShaderSource_WebGL2(true);}tileRandomizationFragmentSrc=WebGLShaderProgram.GetTileRandomizationFragmentShaderSource(this.GetWebGLVersionNumber(),useFragDepthExt,this._stdDerivativesExt&&this._textureLodExt);tileRandomizationVertexSrc=this.GetWebGLVersionNumber()>=2?WebGLShaderProgram.GetDefaultVertexShaderSource_WebGL2():vsSource;DEFAULT_SHADER_PROGRAMS=[[textureFillFragmentSrc,textureFillVertexSrc,"<default>"],[textureFillFragmentSrc,textureFillVertexSrc,"<default-device-transform>"],[pointFragmentSrc,pointVertexSrc,"<point>"],[WebGLShaderProgram.GetColorFillFragmentShaderSource(),vsSource,"<fill>"],[WebGLShaderProgram.GetLinearGradientFillFragmentShaderSource(),vsSource,"<lineargradient>"],[WebGLShaderProgram.GetPenumbraFillFragmentShaderSource(),vsSource,"<penumbra>"],[WebGLShaderProgram.GetHardEllipseFillFragmentShaderSource(),vsSource,"<hardellipse>"],[WebGLShaderProgram.GetHardEllipseOutlineFragmentShaderSource(),vsSource,"<hardellipseoutline>"],[WebGLShaderProgram.GetSmoothEllipseFillFragmentShaderSource(),vsSource,"<smoothellipse>"],[WebGLShaderProgram.GetSmoothEllipseOutlineFragmentShaderSource(),vsSource,"<smoothellipseoutline>"],[WebGLShaderProgram.GetSmoothLineFillFragmentShaderSource(),vsSource,"<smoothline>"],[tilemapFragmentSrc,tilemapVertexSrc,"<tilemap>"],[tileRandomizationFragmentSrc,tileRandomizationVertexSrc,"<tilerandomization>"]];_context47.next=86;return regeneratorRuntime.awrap(Promise.all(DEFAULT_SHADER_PROGRAMS.map(function(i){return _this19.CreateShaderProgram({src:i[0],vertexSrc:i[1],name:i[2]});})));case 86:defaultShaders=_context47.sent;this._spTextureFill=defaultShaders[0];this._spDeviceTransformTextureFill=defaultShaders[1];this._spPoints=defaultShaders[2];this._spColorFill=defaultShaders[3];this._spLinearGradientFill=defaultShaders[4];this._spPenumbraFill=defaultShaders[5];this._spHardEllipseFill=defaultShaders[6];this._spHardEllipseOutline=defaultShaders[7];this._spSmoothEllipseFill=defaultShaders[8];this._spSmoothEllipseOutline=defaultShaders[9];this._spSmoothLineFill=defaultShaders[10];this._spTilemapFill=defaultShaders[11];this._spTileRandomization=defaultShaders[12];this.SetTextureFillMode();case 101:case"end":return _context47.stop();}}},null,this);}},{key:"CreateShaderProgram",value:function CreateShaderProgram(shaderInfo){var ret;return regeneratorRuntime.async(function CreateShaderProgram$(_context48){while(1){switch(_context48.prev=_context48.next){case 0:_context48.next=2;return regeneratorRuntime.awrap(_C56.Gfx.WebGLShaderProgram.Create(this,shaderInfo));case 2:ret=_context48.sent;this._AddShaderProgram(ret);return _context48.abrupt("return",ret);case 5:case"end":return _context48.stop();}}},null,this);}},{key:"ResetLastProgram",value:function ResetLastProgram(){this._lastProgram=null;}},{key:"SetSize",value:function SetSize(w,h,force){if(this._width===w&&this._height===h&&!force)return;this.EndBatch();var gl=this._gl;var batchState=this._batchState;this._width=w;this._height=h;this._SetViewport(0,0,w,h);this.CalculatePerspectiveMatrix(this._bbProjectionMatrix,w/h);this.SetProjectionMatrix(this._bbProjectionMatrix);if(this._spDeviceTransformTextureFill){gl.useProgram(this._spDeviceTransformTextureFill.GetShaderProgram());this._spDeviceTransformTextureFill._UpdateDeviceTransformUniforms(this._matP);this._lastProgram=this._spDeviceTransformTextureFill;this._batchState.currentShader=this._spDeviceTransformTextureFill;}gl.bindTexture(gl.TEXTURE_2D,null);gl.activeTexture(gl.TEXTURE1);gl.bindTexture(gl.TEXTURE_2D,null);gl.activeTexture(gl.TEXTURE0);this._lastTexture0=null;this._lastTexture1=null;if(this._usesDepthBuffer&&this._isAutoSizeDepthBuffer)this._SetDepthBufferSize(this._width,this._height);if(this._currentRenderTarget)this._currentRenderTarget._Resize(this._width,this._height);gl.bindFramebuffer(gl.FRAMEBUFFER,null);this._currentRenderTarget=null;batchState.currentFramebuffer=null;batchState.currentFramebufferNoDepth=null;}},{key:"_SetDepthBufferSize",value:function _SetDepthBufferSize(width,height){var gl=this._gl;if(this._depthBuffer&&this._depthBufferWidth===width&&this._depthBufferHeight===height)return;if(this._canSampleDepth){if(this._depthBuffer)gl.deleteTexture(this._depthBuffer);this._depthBuffer=gl.createTexture();gl.bindTexture(gl.TEXTURE_2D,this._depthBuffer);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MAG_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_MIN_FILTER,gl.NEAREST);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_S,gl.CLAMP_TO_EDGE);gl.texParameteri(gl.TEXTURE_2D,gl.TEXTURE_WRAP_T,gl.CLAMP_TO_EDGE);if(this.GetWebGLVersionNumber()>=2)gl.texImage2D(gl.TEXTURE_2D,0,gl.DEPTH24_STENCIL8,width,height,0,gl.DEPTH_STENCIL,gl.UNSIGNED_INT_24_8,null);else if(this._depthTextureExt)gl.texImage2D(gl.TEXTURE_2D,0,gl.DEPTH_STENCIL,width,height,0,gl.DEPTH_STENCIL,this._depthTextureExt["UNSIGNED_INT_24_8_WEBGL"],null);else;gl.bindTexture(gl.TEXTURE_2D,null);}else{if(this._depthBuffer)gl.deleteRenderbuffer(this._depthBuffer);this._depthBuffer=gl.createRenderbuffer();gl.bindRenderbuffer(gl.RENDERBUFFER,this._depthBuffer);gl.renderbufferStorage(gl.RENDERBUFFER,this._version>=2?gl.DEPTH24_STENCIL8:gl.DEPTH_STENCIL,width,height);gl.bindRenderbuffer(gl.RENDERBUFFER,null);}this._depthBufferWidth=width;this._depthBufferHeight=height;}},{key:"SetFixedSizeDepthBuffer",value:function SetFixedSizeDepthBuffer(width,height){if(!this._usesDepthBuffer)return;this._isAutoSizeDepthBuffer=false;this._SetDepthBufferSize(width,height);}},{key:"SetAutoSizeDepthBuffer",value:function SetAutoSizeDepthBuffer(){if(!this._usesDepthBuffer)return;this._isAutoSizeDepthBuffer=true;this._SetDepthBufferSize(this._width,this._height);}},{key:"_SetViewport",value:function _SetViewport(x,y,w,h){var viewport=this._viewport;if(viewport[0]===x&&viewport[1]===y&&viewport[2]===w&&viewport[3]===h)return;var b=this.PushBatch();b.InitSetViewport(x,y,w,h);_vec7.set(viewport,x,y,w,h);this._topOfBatch=0;}},{key:"SetFovY",value:function SetFovY(f){_get(_getPrototypeOf(WebGLRenderer.prototype),"SetFovY",this).call(this,f);this.CalculatePerspectiveMatrix(this._bbProjectionMatrix,this._width/this._height);}},{key:"SetNearZ",value:function SetNearZ(z){_get(_getPrototypeOf(WebGLRenderer.prototype),"SetNearZ",this).call(this,z);this.CalculatePerspectiveMatrix(this._bbProjectionMatrix,this._width/this._height);}},{key:"SetFarZ",value:function SetFarZ(z){_get(_getPrototypeOf(WebGLRenderer.prototype),"SetFarZ",this).call(this,z);this.CalculatePerspectiveMatrix(this._bbProjectionMatrix,this._width/this._height);}},{key:"SetProjectionMatrix",value:function SetProjectionMatrix(matP){if(_mat6.exactEquals(this._matP,matP))return;var b=this.PushBatch();b.InitSetProjection(matP);_mat6.copy(this._matP,matP);this._topOfBatch=0;this._didChangeTransform=true;}},{key:"SetDefaultRenderTargetProjectionState",value:function SetDefaultRenderTargetProjectionState(){var projectionMatrix;var viewportWidth,viewportHeight;var currentRenderTarget=this._currentRenderTarget;if(currentRenderTarget===null){projectionMatrix=this._bbProjectionMatrix;viewportWidth=this.GetWidth();viewportHeight=this.GetHeight();}else{projectionMatrix=currentRenderTarget.GetProjectionMatrix();viewportWidth=currentRenderTarget.GetWidth();viewportHeight=currentRenderTarget.GetHeight();}this.SetProjectionMatrix(projectionMatrix);this._SetViewport(0,0,viewportWidth,viewportHeight);}},{key:"SetModelViewMatrix",value:function SetModelViewMatrix(matMV){if(_mat6.exactEquals(this._matMV,matMV))return;var b=this.PushBatch();b.InitSetModelView(matMV);_mat6.copy(this._matMV,matMV);this._topOfBatch=0;this._didChangeTransform=true;}},{key:"ResetDidChangeTransformFlag",value:function ResetDidChangeTransformFlag(){this._didChangeTransform=false;}},{key:"DidChangeTransform",value:function DidChangeTransform(){return this._didChangeTransform;}},{key:"GetBatchState",value:function GetBatchState(){return this._batchState;}},{key:"PushBatch",value:function PushBatch(){var batch=this._batch;if(this._batchPtr===batch.length)batch.push(new _C56.Gfx.WebGLBatchJob(this._batchState));return batch[this._batchPtr++];}},{key:"EndBatch",value:function EndBatch(){if(this._batchPtr===0)return;if(this.IsContextLost())return;this._WriteBuffers();this._ExecuteBatch();this._batchPtr=0;this._vertexPtr=0;this._texPtr=0;this._pointPtr=0;this._topOfBatch=0;}},{key:"_WriteBuffers",value:function _WriteBuffers(){var gl=this._gl;if(this._pointPtr>0){gl.bindBuffer(gl.ARRAY_BUFFER,this._pointBuffer);gl.bufferSubData(gl.ARRAY_BUFFER,0,this._pointData.subarray(0,this._pointPtr));}if(this._vertexPtr>0){gl.bindBuffer(gl.ARRAY_BUFFER,this._vertexBuffer);gl.bufferSubData(gl.ARRAY_BUFFER,0,this._vertexData.subarray(0,this._vertexPtr));gl.bindBuffer(gl.ARRAY_BUFFER,this._texcoordBuffer);gl.bufferSubData(gl.ARRAY_BUFFER,0,this._texcoordData.subarray(0,this._texPtr));}}},{key:"_ExecuteBatch",value:function _ExecuteBatch(){var batch=this._batch;for(var i=0,len=this._batchPtr;i<len;++i){batch[i].Run();}}},{key:"GetOpacity",value:function GetOpacity(){return this._lastColor.getA();}},{key:"SetColorRgba",value:function SetColorRgba(r,g,b,a){var lastColor=this._lastColor;if(lastColor.equalsRgba(r,g,b,a))return;lastColor.setRgba(r,g,b,a);var batch=this.PushBatch();batch.InitSetColor(lastColor);this._topOfBatch=0;this._currentStateGroup=null;}},{key:"SetOpacity",value:function SetOpacity(a){var lastColor=this._lastColor;if(lastColor.getA()===a)return;lastColor.setA(a);var batch=this.PushBatch();batch.InitSetColor(lastColor);this._topOfBatch=0;this._currentStateGroup=null;}},{key:"SetColor",value:function SetColor(c){var lastColor=this._lastColor;if(lastColor.equals(c))return;lastColor.set(c);var batch=this.PushBatch();batch.InitSetColor(lastColor);this._topOfBatch=0;this._currentStateGroup=null;}},{key:"ResetColor",value:function ResetColor(){this.SetColorRgba(1,1,1,1);}},{key:"GetColor",value:function GetColor(){return this._lastColor;}},{key:"SetTexture",value:function SetTexture(rendererTex){if(rendererTex===this._lastTexture0)return;var b=this.PushBatch();b.InitSetTexture(rendererTex);this._lastTexture0=rendererTex;this._topOfBatch=0;}},{key:"_ResetLastTexture",value:function _ResetLastTexture(){this._lastTexture0=null;}},{key:"SetBlendMode",value:function SetBlendMode(bm){var arr=this._GetBlendByIndex(bm);this._SetBlend(arr[0],arr[1]);}},{key:"SetNamedBlendMode",value:function SetNamedBlendMode(bm){var o=this.GetNamedBlend(bm);this._SetBlend(o.srcBlend,o.destBlend);}},{key:"_SetBlend",value:function _SetBlend(s,d){if(s===this._lastSrcBlend&&d===this._lastDestBlend)return;var b=this.PushBatch();b.InitSetBlend(s,d);this._lastSrcBlend=s;this._lastDestBlend=d;this._topOfBatch=0;this._currentStateGroup=null;}},{key:"IsPremultipliedAlphaBlend",value:function IsPremultipliedAlphaBlend(){return this._lastSrcBlend===this._gl.ONE&&this._lastDestBlend===this._gl.ONE_MINUS_SRC_ALPHA;}},{key:"SetAlphaBlend",value:function SetAlphaBlend(){this._SetBlend(this._gl.ONE,this._gl.ONE_MINUS_SRC_ALPHA);}},{key:"SetNoPremultiplyAlphaBlend",value:function SetNoPremultiplyAlphaBlend(){this._SetBlend(this._gl.SRC_ALPHA,this._gl.ONE_MINUS_SRC_ALPHA);}},{key:"SetCopyBlend",value:function SetCopyBlend(){this._SetBlend(this._gl.ONE,this._gl.ZERO);}},{key:"Rect",value:function Rect(r){this.Rect2(r.getLeft(),r.getTop(),r.getRight(),r.getBottom());}},{key:"Rect2",value:function Rect2(left,top,right,bottom){this.Quad2(left,top,right,top,right,bottom,left,bottom);}},{key:"_ExtendQuadBatch",value:function _ExtendQuadBatch(){var v=this._vertexPtr;if(v>=this._lastVertexPtr){this.EndBatch();v=0;}if(this._topOfBatch===1)this._batch[this._batchPtr-1]._indexCount+=6;else{var _b2=this.PushBatch();_b2.InitQuad(v,6);this._topOfBatch=1;}}},{key:"_WriteQuadToVertexBuffer",value:function _WriteQuadToVertexBuffer(quad){quad.writeToTypedArray3D(this._vertexData,this._vertexPtr,this._baseZ+this._currentZ);this._vertexPtr+=12;}},{key:"Quad",value:function Quad(quad){this._ExtendQuadBatch();this._WriteQuadToVertexBuffer(quad);_defaultTexCoordsQuad.writeToTypedArray(this._texcoordData,this._texPtr);this._texPtr+=8;}},{key:"Quad2",value:function Quad2(tlx,tly,trx,try_,brx,bry,blx,bly){this._ExtendQuadBatch();var vd=this._vertexData;var v=this._vertexPtr;var z=this._baseZ+this._currentZ;vd[v++]=tlx;vd[v++]=tly;vd[v++]=z;vd[v++]=trx;vd[v++]=try_;vd[v++]=z;vd[v++]=brx;vd[v++]=bry;vd[v++]=z;vd[v++]=blx;vd[v++]=bly;vd[v++]=z;this._vertexPtr=v;_defaultTexCoordsQuad.writeToTypedArray(this._texcoordData,this._texPtr);this._texPtr+=8;}},{key:"Quad3",value:function Quad3(quad,rcTex){this._ExtendQuadBatch();this._WriteQuadToVertexBuffer(quad);rcTex.writeAsQuadToTypedArray(this._texcoordData,this._texPtr);this._texPtr+=8;}},{key:"Quad4",value:function Quad4(quad,uv){this._ExtendQuadBatch();this._WriteQuadToVertexBuffer(quad);uv.writeToTypedArray(this._texcoordData,this._texPtr);this._texPtr+=8;}},{key:"Quad3D",value:function Quad3D(tlx,tly,tlz,trx,try_,trz,brx,bry,brz,blx,bly,blz,rcTex){this._ExtendQuadBatch();var vd=this._vertexData;var v=this._vertexPtr;var z=this._baseZ+this._currentZ;vd[v++]=tlx;vd[v++]=tly;vd[v++]=z+tlz;vd[v++]=trx;vd[v++]=try_;vd[v++]=z+trz;vd[v++]=brx;vd[v++]=bry;vd[v++]=z+brz;vd[v++]=blx;vd[v++]=bly;vd[v++]=z+blz;this._vertexPtr=v;rcTex.writeAsQuadToTypedArray(this._texcoordData,this._texPtr);this._texPtr+=8;}},{key:"Quad3D2",value:function Quad3D2(tlx,tly,tlz,trx,try_,trz,brx,bry,brz,blx,bly,blz,uv){this._ExtendQuadBatch();var vd=this._vertexData;var v=this._vertexPtr;var z=this._baseZ+this._currentZ;vd[v++]=tlx;vd[v++]=tly;vd[v++]=z+tlz;vd[v++]=trx;vd[v++]=try_;vd[v++]=z+trz;vd[v++]=brx;vd[v++]=bry;vd[v++]=z+brz;vd[v++]=blx;vd[v++]=bly;vd[v++]=z+blz;this._vertexPtr=v;uv.writeToTypedArray(this._texcoordData,this._texPtr);this._texPtr+=8;}},{key:"FullscreenQuad",value:function FullscreenQuad(mode,curTex){this.SetCurrentZ(0);_mat6.copy(tmpProjection,this._matP);_mat6.copy(tmpModelView,this._matMV);this.SetDefaultRenderTargetProjectionState();var _this$GetRenderTarget=this.GetRenderTargetSize(this._currentRenderTarget),_this$GetRenderTarget2=_slicedToArray(_this$GetRenderTarget,2),width=_this$GetRenderTarget2[0],height=_this$GetRenderTarget2[1];var tempMat4b=this.CalculateLookAtModelView2(0,0,this.GetDefaultCameraZ(height),0,0,0,height);this.SetModelViewMatrix(tempMat4b);if(mode==="crop"&&this._currentRenderTarget&&curTex){var left=this._width/2;var top=this._height/2;var srcW=curTex.GetWidth();var srcH=curTex.GetHeight();var destW=this._currentRenderTarget.GetWidth();var destH=this._currentRenderTarget.GetHeight();var copyW=Math.min(destW,srcW);var copyH=Math.min(destH,srcH);var srcOffY=Math.max(srcH-destH,0);var destOffY=Math.max(destH-srcH,0);_tmpRect.set(-left,top-destOffY,-left+copyW,top-copyH-destOffY);_tmpQuad.setFromRect(_tmpRect);_tmpRect.set(0,srcOffY,copyW,copyH+srcOffY);_tmpRect.divide(srcW,srcH);this.Quad3(_tmpQuad,_tmpRect);}else{var halfW=width/2;var halfH=height/2;this.Rect2(-halfW,halfH,halfW,-halfH);}this.SetProjectionMatrix(tmpProjection);this.SetModelViewMatrix(tmpModelView);}},{key:"StartRenderingPoints",value:function StartRenderingPoints(rect){if(this._lastPointTexCoords.equals(rect))return;this._lastPointTexCoords.copy(rect);var b=this.PushBatch();b.InitSetPointTexCoords(rect);this._topOfBatch=0;}},{key:"FinishRenderingPoints",value:function FinishRenderingPoints(){}},{key:"Point",value:function Point(x_,y_,size_,opacity_){if(this._pointPtr>=LAST_POINT)this.EndBatch();var p=this._pointPtr;var z=this._baseZ+this._currentZ;if(this._topOfBatch===2&&this._lastPointZ===z)this._batch[this._batchPtr-1]._indexCount++;else{var _b3=this.PushBatch();_b3.InitPoints(p,z);this._topOfBatch=2;this._lastPointZ=z;}var pd=this._pointData;pd[p++]=x_;pd[p++]=y_;pd[p++]=size_;pd[p++]=opacity_;this._pointPtr=p;}},{key:"SetProgram",value:function SetProgram(program){if(this._lastProgram===program)return;var b=this.PushBatch();b.InitSetProgram(program);this._lastProgram=program;this._topOfBatch=0;this._currentStateGroup=null;}},{key:"SetDeviceTransformTextureFillMode",value:function SetDeviceTransformTextureFillMode(){this.SetProgram(this._spDeviceTransformTextureFill);}},{key:"SetGradientColor",value:function SetGradientColor(c){var b=this.PushBatch();b.InitSetGradientColor(c);this._topOfBatch=0;}},{key:"SetEllipseParams",value:function SetEllipseParams(pixelW,pixelH){var outlineThickness=arguments.length>2&&arguments[2]!==undefined?arguments[2]:1;var b=this.PushBatch();b.InitSetEllipseParams(pixelW,pixelH,outlineThickness);this._topOfBatch=0;}},{key:"SetTilemapInfo",value:function SetTilemapInfo(srcRect,textureWidth,textureHeight,tileWidth,tileHeight,tileSpacingX,tileSpacingY){if(this._lastProgram!==this._spTilemapFill)throw new Error("must set tilemap fill mode first");var b=this.PushBatch();b.InitSetTilemapInfo(srcRect,textureWidth,textureHeight,tileWidth,tileHeight,tileSpacingX,tileSpacingY);this._topOfBatch=0;}},{key:"SetTileRandomizationInfo",value:function SetTileRandomizationInfo(textureWidth,textureHeight,xRandom,yRandom,angleRandom,blendMarginX,blendMarginY){if(this._lastProgram!==this._spTileRandomization)throw new Error("must set tile randomization mode first");var b=this.PushBatch();b.InitSetTileRandomizationInfo(textureWidth,textureHeight,xRandom,yRandom,angleRandom,blendMarginX,blendMarginY);this._topOfBatch=0;}},{key:"SetProgramParameters",value:function SetProgramParameters(backTex,destRect,srcRect,srcOriginRect,layoutRect,pixelWidth,pixelHeight,dpr,layerScale,layerAngle,time){var s=this._lastProgram;time=time%10800;if(!s._hasAnyOptionalUniforms||s.AreOptionalUniformsAlreadySetInBatch(destRect,srcRect,srcOriginRect,layoutRect,pixelWidth,pixelHeight,dpr,layerScale,layerAngle,time))return;var b=this.PushBatch();b.InitSetProgramParameters();s.SetOptionalUniformsInBatch(destRect,srcRect,srcOriginRect,layoutRect,pixelWidth,pixelHeight,dpr,layerScale,layerAngle,time);var mat4param=b._mat4param;mat4param[0]=pixelWidth;mat4param[1]=pixelHeight;destRect.writeToTypedArray(mat4param,2);mat4param[6]=layerScale;mat4param[7]=layerAngle;srcRect.writeToTypedArray(mat4param,12);var colorParam=b._colorParam;layoutRect.writeToTypedArray(colorParam,0);var tmp=colorParam[1];colorParam[1]=colorParam[3];colorParam[3]=tmp;srcOriginRect.writeToTypedArray(b._srcOriginRect,0);b._startIndex=time;b._indexCount=dpr;if(s._uSamplerBack.IsUsed())b._texParam=backTex?backTex.GetTexture():null;else b._texParam=null;this._topOfBatch=0;}},{key:"SetProgramCustomParameters",value:function SetProgramCustomParameters(params){var s=this._lastProgram;if(params.length===0||s.AreCustomParametersAlreadySetInBatch(params))return;var b=this.PushBatch();b.InitSetProgramCustomParameters();s.SetCustomParametersInBatch(params);_C56.shallowAssignArray(b._shaderParams,params);this._topOfBatch=0;}},{key:"ClearRgba",value:function ClearRgba(r,g,b_,a){var b=this.PushBatch();b.InitClearSurface2(r,g,b_,a);this._topOfBatch=0;}},{key:"Clear",value:function Clear(c){var b=this.PushBatch();b.InitClearSurface(c);this._topOfBatch=0;}},{key:"Start",value:function Start(){}},{key:"Finish",value:function Finish(){_get(_getPrototypeOf(WebGLRenderer.prototype),"Finish",this).call(this);this._gl.flush();}},{key:"ClearDepth",value:function ClearDepth(){if(!this._usesDepthBuffer||!this._currentRenderTarget||!this._currentRenderTarget.HasDepthBuffer())return;var batch=this.PushBatch();batch.InitClearDepth(this._isDepthEnabled);this._topOfBatch=0;}},{key:"SetDepthEnabled",value:function SetDepthEnabled(e){e=!!e;if(this._isDepthEnabled===e)return;if(!this._usesDepthBuffer)return;this._isDepthEnabled=e;var batch=this.PushBatch();batch.InitSetDepthEnabled(e);this._topOfBatch=0;}},{key:"IsDepthEnabled",value:function IsDepthEnabled(){return this._isDepthEnabled;}},{key:"_GetDepthBuffer",value:function _GetDepthBuffer(){return this._depthBuffer;}},{key:"_CanSampleDepth",value:function _CanSampleDepth(){return this._canSampleDepth;}},{key:"SetDepthSamplingEnabled",value:function SetDepthSamplingEnabled(e){e=!!e;if(!this._canSampleDepth)return;if(this._isDepthSamplingEnabled===e)return;if(e&&this.IsDepthEnabled())throw new Error("depth still enabled");this._isDepthSamplingEnabled=e;var batch=this.PushBatch();batch.InitSetDepthSamplingEnabled(e);this._topOfBatch=0;}},{key:"SetScissorRect",value:function SetScissorRect(x,y,w,h){var rtHeight_=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;x=Math.floor(x);y=Math.floor(y);w=Math.floor(w);h=Math.floor(h);if(this._lastScissorRect.equalsWH(x,y,w,h))return;this._lastScissorRect.setWH(x,y,w,h);var rtHeight=rtHeight_||this.GetRenderTargetSize(this.GetRenderTarget())[1];y=rtHeight-y-h;var batch=this.PushBatch();batch.InitSetScissor(true,x,y,w,h);this._topOfBatch=0;}},{key:"RemoveScissorRect",value:function RemoveScissorRect(){if(this._lastScissorRect.getRight()===-1)return;this._lastScissorRect.set(0,0,-1,-1);var batch=this.PushBatch();batch.InitSetScissor(false,0,0,0,0);this._topOfBatch=0;}},{key:"CheckForQueryResults",value:function CheckForQueryResults(){var _iteratorNormalCompletion93=true;var _didIteratorError93=false;var _iteratorError93=undefined;try{for(var _iterator93=this._allQueryResultBuffers[Symbol.iterator](),_step93;!(_iteratorNormalCompletion93=(_step93=_iterator93.next()).done);_iteratorNormalCompletion93=true){var qrb=_step93.value;qrb.CheckForResults(this._frameNumber);}}catch(err){_didIteratorError93=true;_iteratorError93=err;}finally{try{if(!_iteratorNormalCompletion93&&_iterator93["return"]!=null){_iterator93["return"]();}}finally{if(_didIteratorError93){throw _iteratorError93;}}}}},{key:"IsContextLost",value:function IsContextLost(){return!this._gl||this._gl.isContextLost()||this._isInitialisingAfterContextRestored;}},{key:"OnContextLost",value:function OnContextLost(){_get(_getPrototypeOf(WebGLRenderer.prototype),"OnDeviceOrContextLost",this).call(this);_C56.Gfx.WebGLRendererTexture.OnContextLost();_C56.Gfx.WebGLRenderTarget.OnContextLost();_C56.Gfx.RendererText.OnContextLost();var _iteratorNormalCompletion94=true;var _didIteratorError94=false;var _iteratorError94=undefined;try{for(var _iterator94=this._allQueryResultBuffers[Symbol.iterator](),_step94;!(_iteratorNormalCompletion94=(_step94=_iterator94.next()).done);_iteratorNormalCompletion94=true){var qrb=_step94.value;qrb.Clear();}}catch(err){_didIteratorError94=true;_iteratorError94=err;}finally{try{if(!_iteratorNormalCompletion94&&_iterator94["return"]!=null){_iterator94["return"]();}}finally{if(_didIteratorError94){throw _iteratorError94;}}}this._extensions=[];this._timerExt=null;this._parallelShaderCompileExt=null;this._anisotropicExt=null;this._depthTextureExt=null;this._fragDepthExt=null;this._stdDerivativesExt=null;this._textureLodExt=null;this._maxAnisotropy=0;this._unmaskedVendor="(unavailable)";this._unmaskedRenderer="(unavailable)";this._lastProgram=null;this._spDeviceTransformTextureFill=null;this._depthBuffer=null;var _iteratorNormalCompletion95=true;var _didIteratorError95=false;var _iteratorError95=undefined;try{for(var _iterator95=this._stateGroups.values()[Symbol.iterator](),_step95;!(_iteratorNormalCompletion95=(_step95=_iterator95.next()).done);_iteratorNormalCompletion95=true){var stateGroup=_step95.value;stateGroup.OnContextLost();}}catch(err){_didIteratorError95=true;_iteratorError95=err;}finally{try{if(!_iteratorNormalCompletion95&&_iterator95["return"]!=null){_iterator95["return"]();}}finally{if(_didIteratorError95){throw _iteratorError95;}}}}},{key:"OnContextRestored",value:function OnContextRestored(){var _iteratorNormalCompletion96,_didIteratorError96,_iteratorError96,_iterator96,_step96,stateGroup;return regeneratorRuntime.async(function OnContextRestored$(_context49){while(1){switch(_context49.prev=_context49.next){case 0:this._isInitialisingAfterContextRestored=true;_context49.next=3;return regeneratorRuntime.awrap(this.InitState());case 3:this._isInitialisingAfterContextRestored=false;_iteratorNormalCompletion96=true;_didIteratorError96=false;_iteratorError96=undefined;_context49.prev=7;for(_iterator96=this._stateGroups.values()[Symbol.iterator]();!(_iteratorNormalCompletion96=(_step96=_iterator96.next()).done);_iteratorNormalCompletion96=true){stateGroup=_step96.value;stateGroup.OnContextRestored(this);}_context49.next=15;break;case 11:_context49.prev=11;_context49.t0=_context49["catch"](7);_didIteratorError96=true;_iteratorError96=_context49.t0;case 15:_context49.prev=15;_context49.prev=16;if(!_iteratorNormalCompletion96&&_iterator96["return"]!=null){_iterator96["return"]();}case 18:_context49.prev=18;if(!_didIteratorError96){_context49.next=21;break;}throw _iteratorError96;case 21:return _context49.finish(18);case 22:return _context49.finish(15);case 23:this.SetSize(this._width,this._height,true);case 24:case"end":return _context49.stop();}}},null,this,[[7,11,15,23],[16,,18,22]]);}},{key:"CreateStaticTexture",value:function CreateStaticTexture(data,opts){if(this.IsContextLost())throw new Error("context lost");this.EndBatch();var rendererTex=_C56.New(_C56.Gfx.WebGLRendererTexture,this);rendererTex._CreateStatic(data,opts);return rendererTex;}},{key:"CreateStaticTextureAsync",value:function CreateStaticTextureAsync(data,opts){var _this20=this;var imageBitmap,isTiled,isPOT,img;return regeneratorRuntime.async(function CreateStaticTextureAsync$(_context50){while(1){switch(_context50.prev=_context50.next){case 0:if(!this.IsContextLost()){_context50.next=2;break;}throw new Error("context lost");case 2:opts=Object.assign({},opts);if(!_C56.Supports.ImageBitmapOptions){_context50.next=28;break;}_context50.next=6;return regeneratorRuntime.awrap(createImageBitmap(data,{"premultiplyAlpha":"premultiply"}));case 6:imageBitmap=_context50.sent;isTiled=opts.wrapX&&opts.wrapX!=="clamp-to-edge"||opts.wrapY&&opts.wrapY!=="clamp-to-edge";isPOT=_C56.isPOT(imageBitmap.width)&&_C56.isPOT(imageBitmap.height);if(!(!this.SupportsNPOTTextures()&&!isPOT&&isTiled)){_context50.next=22;break;}if(!_C56.Supports.ImageBitmapOptionsResize){_context50.next=17;break;}_context50.next=13;return regeneratorRuntime.awrap(createImageBitmap(data,{"premultiplyAlpha":"premultiply","resizeWidth":_C56.nextHighestPowerOfTwo(imageBitmap.width),"resizeHeight":_C56.nextHighestPowerOfTwo(imageBitmap.height)}));case 13:imageBitmap=_context50.sent;opts.premultiplyAlpha=false;_context50.next=20;break;case 17:_context50.next=19;return regeneratorRuntime.awrap(createImageBitmap(data,{"premultiplyAlpha":"none"}));case 19:imageBitmap=_context50.sent;case 20:_context50.next=23;break;case 22:opts.premultiplyAlpha=false;case 23:_context50.next=25;return regeneratorRuntime.awrap(_C56.Asyncify(function(){return _this20.CreateStaticTexture(imageBitmap,opts);}));case 25:return _context50.abrupt("return",_context50.sent);case 28:if(!(data instanceof Blob)){_context50.next=35;break;}if(!(typeof Image==="undefined")){_context50.next=31;break;}throw new Error("texture upload variant not supported in worker");case 31:_context50.next=33;return regeneratorRuntime.awrap(_C56.BlobToImage(data));case 33:img=_context50.sent;data=img;case 35:_context50.next=37;return regeneratorRuntime.awrap(_C56.Asyncify(function(){return _this20.CreateStaticTexture(data,opts);}));case 37:return _context50.abrupt("return",_context50.sent);case 38:case"end":return _context50.stop();}}},null,this);}},{key:"CreateDynamicTexture",value:function CreateDynamicTexture(width,height,opts){this.EndBatch();var rendererTex=_C56.New(_C56.Gfx.WebGLRendererTexture,this);rendererTex._CreateDynamic(width,height,opts);return rendererTex;}},{key:"UpdateTexture",value:function UpdateTexture(data,rendererTex,opts){this.EndBatch();rendererTex._Update(data,opts);}},{key:"DeleteTexture",value:function DeleteTexture(rendererTex){if(!rendererTex)return;rendererTex.SubtractReference();if(rendererTex.GetReferenceCount()>0)return;this.EndBatch();if(rendererTex===this._lastTexture0){this._gl.bindTexture(this._gl.TEXTURE_2D,null);this._lastTexture0=null;}if(rendererTex===this._lastTexture1){this._gl.activeTexture(this._gl.TEXTURE1);this._gl.bindTexture(this._gl.TEXTURE_2D,null);this._gl.activeTexture(this._gl.TEXTURE0);this._lastTexture1=null;}rendererTex._Delete();}},{key:"CreateRenderTarget",value:function CreateRenderTarget(opts){var width=this._width;var height=this._height;var isDefaultSize=true;if(opts){if(typeof opts.width==="number"){width=Math.floor(opts.width);isDefaultSize=false;}if(typeof opts.height==="number"){height=Math.floor(opts.height);isDefaultSize=false;}}if(width<=0||height<=0)throw new Error("invalid size");this.EndBatch();var renderTarget=_C56.New(_C56.Gfx.WebGLRenderTarget,this);renderTarget._Create(width,height,Object.assign({isDefaultSize:isDefaultSize},opts));this._currentRenderTarget=null;this._batchState.currentFramebuffer=null;this._batchState.currentFramebufferNoDepth=null;return renderTarget;}},{key:"SetRenderTarget",value:function SetRenderTarget(renderTarget){var updateProjection=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(renderTarget===this._currentRenderTarget)return;if(renderTarget&&renderTarget.IsDefaultSize())renderTarget._Resize(this._width,this._height);var b=this.PushBatch();b.InitSetRenderTarget(renderTarget);this._currentRenderTarget=renderTarget;this._topOfBatch=0;if(updateProjection)this.SetDefaultRenderTargetProjectionState();}},{key:"GetRenderTarget",value:function GetRenderTarget(){return this._currentRenderTarget;}},{key:"GetRenderTargetSize",value:function GetRenderTargetSize(renderTarget){if(renderTarget)return[renderTarget.GetWidth(),renderTarget.GetHeight()];else return[this._width,this._height];}},{key:"CopyRenderTarget",value:function CopyRenderTarget(renderTarget){var mode=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"stretch";if(this._version<2||this._currentRenderTarget&&this._currentRenderTarget.GetMultisampling()>0){this.SetCopyBlend();this.ResetColor();this.DrawRenderTarget(renderTarget,mode);}else{var _b4=this.PushBatch();_b4.InitBlitFramebuffer(renderTarget,this._currentRenderTarget,mode);this._topOfBatch=0;}}},{key:"DrawRenderTarget",value:function DrawRenderTarget(renderTarget){var mode=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"stretch";var tex=renderTarget.GetTexture();if(!tex)throw new Error("not a texture-backed render target");this.SetTexture(tex);this.FullscreenQuad(mode,tex);}},{key:"InvalidateRenderTarget",value:function InvalidateRenderTarget(renderTarget){if(this._version<2)return;var b=this.PushBatch();b.InitInvalidateFramebuffer(renderTarget._GetFramebuffer());this._topOfBatch=0;}},{key:"DeleteRenderTarget",value:function DeleteRenderTarget(renderTarget){this.SetRenderTarget(null);this.EndBatch();var renderTex=renderTarget.GetTexture();if(renderTex===this._lastTexture0){this._gl.bindTexture(this._gl.TEXTURE_2D,null);this._lastTexture0=null;}if(renderTex===this._lastTexture1){this._gl.activeTexture(this._gl.TEXTURE1);this._gl.bindTexture(this._gl.TEXTURE_2D,null);this._gl.activeTexture(this._gl.TEXTURE0);this._lastTexture1=null;}renderTarget._Delete();}},{key:"ReadBackRenderTargetToImageData",value:function ReadBackRenderTargetToImageData(renderTarget,forceSynchronous,areaRect){var _this21=this;var oldRenderTarget,width,height,framebuffer,x,y,areaWidth,areaHeight,w,h,gl,restorePreviousRenderTarget,imageData,pixelBuffer,bufferSize,PIXEL_PACK_BUFFER,sync;return regeneratorRuntime.async(function ReadBackRenderTargetToImageData$(_context51){while(1){switch(_context51.prev=_context51.next){case 0:this.EndBatch();oldRenderTarget=this._currentRenderTarget;if(renderTarget){width=renderTarget.GetWidth();height=renderTarget.GetHeight();framebuffer=renderTarget._GetFramebuffer();}else{width=this.GetWidth();height=this.GetHeight();framebuffer=null;}x=0;y=0;areaWidth=width;areaHeight=height;if(areaRect){x=_C56.clamp(Math.floor(areaRect.getLeft()),0,width-1);y=_C56.clamp(Math.floor(areaRect.getTop()),0,height-1);w=areaRect.width();if(w===0)w=width-x;else w=_C56.clamp(Math.floor(w),0,width-x);h=areaRect.height();if(h===0)h=height-y;else h=_C56.clamp(Math.floor(h),0,height-y);areaWidth=w;areaHeight=h;y=height-(y+areaHeight);}gl=this._gl;gl.bindFramebuffer(gl.FRAMEBUFFER,framebuffer);restorePreviousRenderTarget=function restorePreviousRenderTarget(){gl.bindFramebuffer(gl.FRAMEBUFFER,null);_this21._currentRenderTarget=null;_this21._batchState.currentFramebuffer=null;_this21._batchState.currentFramebufferNoDepth=null;_this21.SetRenderTarget(oldRenderTarget);};if(!(!forceSynchronous&&this.GetWebGLVersionNumber()>=2)){_context51.next=33;break;}gl.bindFramebuffer(gl.READ_FRAMEBUFFER,framebuffer);pixelBuffer=gl.createBuffer();bufferSize=areaWidth*areaHeight*4;PIXEL_PACK_BUFFER=gl["PIXEL_PACK_BUFFER"];gl.bindBuffer(PIXEL_PACK_BUFFER,pixelBuffer);gl.bufferData(PIXEL_PACK_BUFFER,bufferSize,gl["STREAM_READ"]);gl.readPixels(x,y,areaWidth,areaHeight,gl.RGBA,gl.UNSIGNED_BYTE,0);gl.bindFramebuffer(gl.READ_FRAMEBUFFER,null);gl.bindBuffer(PIXEL_PACK_BUFFER,null);restorePreviousRenderTarget();sync=gl["fenceSync"](gl["SYNC_GPU_COMMANDS_COMPLETE"],0);_context51.next=25;return regeneratorRuntime.awrap(this._WaitForObjectReady(function(){return gl["getSyncParameter"](sync,gl["SYNC_STATUS"])===gl["SIGNALED"];}));case 25:gl["deleteSync"](sync);imageData=new ImageData(areaWidth,areaHeight);gl.bindBuffer(PIXEL_PACK_BUFFER,pixelBuffer);gl["getBufferSubData"](PIXEL_PACK_BUFFER,0,new Uint8Array(imageData.data.buffer),0,bufferSize);gl.bindBuffer(PIXEL_PACK_BUFFER,null);gl.deleteBuffer(pixelBuffer);_context51.next=36;break;case 33:imageData=new ImageData(areaWidth,areaHeight);gl.readPixels(x,y,areaWidth,areaHeight,gl.RGBA,gl.UNSIGNED_BYTE,new Uint8Array(imageData.data.buffer));restorePreviousRenderTarget();case 36:return _context51.abrupt("return",imageData);case 37:case"end":return _context51.stop();}}},null,this);}},{key:"CoplanarStartStencilPass",value:function CoplanarStartStencilPass(){this.SetDepthEnabled(true);var batch=this.PushBatch();batch.InitCoplanarStartStencilPass();this._topOfBatch=0;this._coplanarMode=1;}},{key:"CoplanarStartColorPass",value:function CoplanarStartColorPass(){this.SetDepthEnabled(false);var batch=this.PushBatch();batch.InitCoplanarStartColorPass();this._topOfBatch=0;this._coplanarMode=2;}},{key:"IsCoplanarColorPass",value:function IsCoplanarColorPass(){return this._coplanarMode===2;}},{key:"CoplanarRestoreStandardRendering",value:function CoplanarRestoreStandardRendering(){this.SetDepthEnabled(true);var batch=this.PushBatch();batch.InitCoplanarRestore();this._topOfBatch=0;this._coplanarMode=0;}},{key:"StartQuery",value:function StartQuery(query){if(!this.SupportsGPUProfiling())return;var b=this.PushBatch();b.InitStartQuery(query);this._topOfBatch=0;}},{key:"EndQuery",value:function EndQuery(query){if(!this.SupportsGPUProfiling())return;var b=this.PushBatch();b.InitEndQuery(query);this._topOfBatch=0;}},{key:"_WaitForObjectReady",value:function _WaitForObjectReady(checkFunc){var ret=new Promise(function(resolve){return pendingPolls.add({resolve:resolve,checkFunc:checkFunc});});if(pollRafId===-1)pollRafId=self.requestAnimationFrame(CheckPendingPolls);return ret;}},{key:"IsDesynchronized",value:function IsDesynchronized(){return!!this._attribs["desynchronized"];}},{key:"GetEstimatedBackBufferMemoryUsage",value:function GetEstimatedBackBufferMemoryUsage(){return this._width*this._height*(this._attribs["alpha"]?4:3);}},{key:"GetEstimatedRenderBufferMemoryUsage",value:function GetEstimatedRenderBufferMemoryUsage(){var ret=0;var _iteratorNormalCompletion97=true;var _didIteratorError97=false;var _iteratorError97=undefined;try{for(var _iterator97=_C56.Gfx.WebGLRenderTarget.allRenderTargets()[Symbol.iterator](),_step97;!(_iteratorNormalCompletion97=(_step97=_iterator97.next()).done);_iteratorNormalCompletion97=true){var t=_step97.value;if(t.GetTexture())continue;ret+=t.GetEstimatedMemoryUsage();}}catch(err){_didIteratorError97=true;_iteratorError97=err;}finally{try{if(!_iteratorNormalCompletion97&&_iterator97["return"]!=null){_iterator97["return"]();}}finally{if(_didIteratorError97){throw _iteratorError97;}}}return ret;}},{key:"GetEstimatedTextureMemoryUsage",value:function GetEstimatedTextureMemoryUsage(){var ret=0;var _iteratorNormalCompletion98=true;var _didIteratorError98=false;var _iteratorError98=undefined;try{for(var _iterator98=_C56.Gfx.WebGLRendererTexture.allTextures()[Symbol.iterator](),_step98;!(_iteratorNormalCompletion98=(_step98=_iterator98.next()).done);_iteratorNormalCompletion98=true){var t=_step98.value;ret+=t.GetEstimatedMemoryUsage();}}catch(err){_didIteratorError98=true;_iteratorError98=err;}finally{try{if(!_iteratorNormalCompletion98&&_iterator98["return"]!=null){_iterator98["return"]();}}finally{if(_didIteratorError98){throw _iteratorError98;}}}return ret;}},{key:"GetWebGLVersionString",value:function GetWebGLVersionString(){return this._versionString;}},{key:"GetWebGLVersionNumber",value:function GetWebGLVersionNumber(){return this._version;}},{key:"GetDisplayName",value:function GetDisplayName(){return"webgl"+this.GetWebGLVersionNumber();}},{key:"SupportsNPOTTextures",value:function SupportsNPOTTextures(){return this.GetWebGLVersionNumber()>=2;}},{key:"GetMaxTextureSize",value:function GetMaxTextureSize(){return this._maxTextureSize;}},{key:"GetMinPointSize",value:function GetMinPointSize(){return this._minPointSize;}},{key:"GetMaxPointSize",value:function GetMaxPointSize(){return this._maxPointSize;}},{key:"SupportsHighP",value:function SupportsHighP(){return this._highpPrecision!==0;}},{key:"GetHighPPrecision",value:function GetHighPPrecision(){return this._highpPrecision;}},{key:"GetUnmaskedVendor",value:function GetUnmaskedVendor(){return this._unmaskedVendor;}},{key:"GetUnmaskedRenderer",value:function GetUnmaskedRenderer(){return this._unmaskedRenderer;}},{key:"GetWebGLExtensionsAnalyticsString",value:function GetWebGLExtensionsAnalyticsString(){if(this.GetWebGLVersionNumber()>=2)return"webgl2";else{var exts=[];if(this._fragDepthExt)exts.push("EXT_frag_depth");if(this._stdDerivativesExt)exts.push("OES_standard_derivatives");if(this._textureLodExt)exts.push("EXT_shader_texture_lod");if(exts.length>0)return"webgl1:"+exts.join(",");else return"webgl1:none";}}},{key:"GetExtensions",value:function GetExtensions(){return this._extensions;}},{key:"SupportsGPUProfiling",value:function SupportsGPUProfiling(){return!!this._timerExt;}},{key:"_GetDisjointTimerQueryExtension",value:function _GetDisjointTimerQueryExtension(){return this._timerExt;}},{key:"_GetParallelShaderCompileExtension",value:function _GetParallelShaderCompileExtension(){return this._parallelShaderCompileExt;}},{key:"_GetAnisotropicExtension",value:function _GetAnisotropicExtension(){return this._anisotropicExt;}},{key:"_GetMaxAnisotropy",value:function _GetMaxAnisotropy(){return this._maxAnisotropy;}},{key:"_AddQueryResultBuffer",value:function _AddQueryResultBuffer(qrb){this._allQueryResultBuffers.add(qrb);}},{key:"_RemoveQueryResultBuffer",value:function _RemoveQueryResultBuffer(qrb){this._allQueryResultBuffers["delete"](qrb);}},{key:"_GetTimeQueryStack",value:function _GetTimeQueryStack(){return this._timeQueryStack;}},{key:"GetContext",value:function GetContext(){return this._gl;}},{key:"_InitBlendModes",value:function _InitBlendModes(gl){this._InitBlendModeData([["normal",gl.ONE,gl.ONE_MINUS_SRC_ALPHA],["additive",gl.ONE,gl.ONE],["xor",gl.ONE,gl.ONE_MINUS_SRC_ALPHA],["copy",gl.ONE,gl.ZERO],["destination-over",gl.ONE_MINUS_DST_ALPHA,gl.ONE],["source-in",gl.DST_ALPHA,gl.ZERO],["destination-in",gl.ZERO,gl.SRC_ALPHA],["source-out",gl.ONE_MINUS_DST_ALPHA,gl.ZERO],["destination-out",gl.ZERO,gl.ONE_MINUS_SRC_ALPHA],["source-atop",gl.DST_ALPHA,gl.ONE_MINUS_SRC_ALPHA],["destination-atop",gl.ONE_MINUS_DST_ALPHA,gl.SRC_ALPHA]]);}},{key:"CreateRendererText",value:function CreateRendererText(){return _C56.New(_C56.Gfx.RendererText,this);}},{key:"CreateWebGLText",value:function CreateWebGLText(){return this.CreateRendererText();}}]);return WebGLRenderer;}(_C56.Gfx.RendererBase);}// ../lib/gfx/effectCompositor/effectChainManager.js
{'use strict';var _C57=self.C3;var DEFAULT_CTOR_OPTS={getDrawSize:null,getRenderTarget:null,releaseRenderTarget:null,getTime:null,redraw:null};_C57.Gfx.EffectChainManager=/*#__PURE__*/function(){function EffectChainManager(opts){_classCallCheck(this,EffectChainManager);opts=Object.assign({},DEFAULT_CTOR_OPTS,opts);this._cbGetDrawSize=opts.getDrawSize;this._cbGetRenderTarget=opts.getRenderTarget;this._cbReleaseRenderTarget=opts.releaseRenderTarget;this._cbGetTime=opts.getTime;this._cbRedraw=opts.redraw;this._webgpuBackTexture=null;this._allEffectChains=new Set();}_createClass(EffectChainManager,[{key:"_AddEffectChain",value:function _AddEffectChain(ec){this._allEffectChains.add(ec);}},{key:"_RemoveEffectChain",value:function _RemoveEffectChain(ec){this._allEffectChains["delete"](ec);}},{key:"OnContextLost",value:function OnContextLost(){this._webgpuBackTexture=null;var _iteratorNormalCompletion99=true;var _didIteratorError99=false;var _iteratorError99=undefined;try{for(var _iterator99=this._allEffectChains[Symbol.iterator](),_step99;!(_iteratorNormalCompletion99=(_step99=_iterator99.next()).done);_iteratorNormalCompletion99=true){var ec=_step99.value;ec.OnContextLost();}}catch(err){_didIteratorError99=true;_iteratorError99=err;}finally{try{if(!_iteratorNormalCompletion99&&_iterator99["return"]!=null){_iterator99["return"]();}}finally{if(_didIteratorError99){throw _iteratorError99;}}}}},{key:"GetDrawSize",value:function GetDrawSize(renderer){if(this._cbGetDrawSize)return this._cbGetDrawSize(renderer);else return[renderer.GetWidth(),renderer.GetHeight()];}},{key:"GetRenderTarget",value:function GetRenderTarget(effectChain){return this._cbGetRenderTarget(effectChain);}},{key:"ReleaseRenderTarget",value:function ReleaseRenderTarget(rt,effectChain){this._cbReleaseRenderTarget(rt,effectChain);}},{key:"GetTime",value:function GetTime(){return this._cbGetTime();}},{key:"Redraw",value:function Redraw(effectChain){this._cbRedraw(effectChain);}},{key:"_GetWebGPUBackTexture",value:function _GetWebGPUBackTexture(renderer,width,height){width=Math.floor(width);height=Math.floor(height);if(this._webgpuBackTexture&&(this._webgpuBackTexture.GetWidth()!==width||this._webgpuBackTexture.GetHeight()!==height)){renderer.DeleteTexture(this._webgpuBackTexture);this._webgpuBackTexture=null;}if(this._webgpuBackTexture===null)this._webgpuBackTexture=renderer.CreateStaticTexture(null,{width:width,height:height,sampling:"nearest",mipMap:false});return this._webgpuBackTexture;}}]);return EffectChainManager;}();}// ../lib/gfx/effectCompositor/effectChain.js
{'use strict';var _C58=self.C3;var _assert5=self.assert;var _glMatrix7=self.glMatrix;var _mat7=_glMatrix7.mat4;var tempRect=_C58.New(_C58.Rect);var tempRect2=_C58.New(_C58.Rect);var tempRect3=_C58.New(_C58.Rect);var tempRect4=_C58.New(_C58.Rect);var tempMat4a=_mat7.create();var tempMat4b=_mat7.create();var _DEFAULT_CTOR_OPTS={drawContent:null,getSourceTextureInfo:null,getShaderParameters:null,invalidateRenderTargets:false};var DEFAULT_BUILDSTEPS_OPTS={indexMap:null,forcePreDraw:false,forcePostDraw:false,is3D:false,isSourceTextureRotated:false,isRotatedOrNegativeSizeInstance:false,useFullSurface:false};_C58.Gfx.EffectChain=/*#__PURE__*/function(){function EffectChain(manager,opts){_classCallCheck(this,EffectChain);opts=Object.assign({},_DEFAULT_CTOR_OPTS,opts);this._manager=manager;this._cbDrawContent=opts.drawContent;this._cbGetSourceTextureInfo=opts.getSourceTextureInfo;this._cbGetShaderParameters=opts.getShaderParameters;this._cbDrawContentHook=null;this._shaderProgramList=[];this._shaderProgramIndices=[];this._steps=[];this._needsRebuild=false;this._blendMode=0;this._isAnyShaderAnimated=false;this._isAnyShaderDepthSampling=false;this._isAnyShaderBackgroundBlending=false;this._isAnyShaderCrossSampling=false;this._isAnyIsSrcTexRotated=false;this._useCopyTextureBackgroundSampling=false;this._didChangeTransform=false;this._depthEnabledAtStart=false;this._coplanarColorPassAtStart=false;this._canUseFastPath=false;this._useFullSurface=false;this._isSourceTextureRotated=false;this._numTempSurfacesRequired=0;this._renderTargets=[null,null,null];this._invalidateRenderTargets=!!opts.invalidateRenderTargets;this._boxExtendHorizontal=0;this._boxExtendVertical=0;this._drawWidth=0;this._drawHeight=0;this._contentObject=null;this._contextObject=null;this._layoutRect=_C58.New(_C58.Rect);this._drawSurfaceRect=_C58.New(_C58.Rect);this._rcTexOriginal=_C58.New(_C58.Rect);this._rcTexBounce=_C58.New(_C58.Rect);this._rcTexDest=_C58.New(_C58.Rect);this._devicePixelRatio=1;this._layerScale=1;this._layerAngle=0;this._time=0;this._destRenderTarget=null;this._backTex=null;this._compositOffX=0;this._compositOffY=0;this._updateOwnProjection=false;this._projectionMatrix=_mat7.create();this._modelViewMatrix=_mat7.create();this._manager._AddEffectChain(this);}_createClass(EffectChain,[{key:"Release",value:function Release(){this._manager._RemoveEffectChain(this);_C58.clearArray(this._steps);_C58.clearArray(this._shaderProgramList);_C58.clearArray(this._shaderProgramIndices);this._contentObject=null;this._contextObject=null;this._cbDrawContent=null;this._cbGetSourceTextureInfo=null;this._cbGetShaderParameters=null;}},{key:"OnContextLost",value:function OnContextLost(){this._needsRebuild=true;_C58.clearArray(this._steps);_C58.clearArray(this._shaderProgramList);_C58.clearArray(this._shaderProgramIndices);}},{key:"NeedsRebuild",value:function NeedsRebuild(){return this._needsRebuild;}},{key:"BuildSteps",value:function BuildSteps(shaderProgramList,opts){opts=Object.assign({},DEFAULT_BUILDSTEPS_OPTS,opts);_C58.clearArray(this._steps);this._boxExtendHorizontal=0;this._boxExtendVertical=0;this._isAnyShaderAnimated=false;this._isAnyShaderDepthSampling=false;this._isAnyShaderBackgroundBlending=false;this._isAnyShaderCrossSampling=false;this._isAnyIsSrcTexRotated=false;this._useCopyTextureBackgroundSampling=false;this._numTempSurfacesRequired=0;this._isSourceTextureRotated=!!opts.isSourceTextureRotated;this._useFullSurface=!!opts.useFullSurface;this._needsRebuild=false;_C58.shallowAssignArray(this._shaderProgramList,shaderProgramList);if(shaderProgramList.length===0)return;if(opts.indexMap){if(opts.indexMap.length!==shaderProgramList.length)throw new Error("incorrect indexMap length");_C58.shallowAssignArray(this._shaderProgramIndices,opts.indexMap);}else{_C58.clearArray(this._shaderProgramIndices);for(var i=0,len=shaderProgramList.length;i<len;++i){this._shaderProgramIndices.push(i);}}var _iteratorNormalCompletion100=true;var _didIteratorError100=false;var _iteratorError100=undefined;try{for(var _iterator100=shaderProgramList[Symbol.iterator](),_step100;!(_iteratorNormalCompletion100=(_step100=_iterator100.next()).done);_iteratorNormalCompletion100=true){var s=_step100.value;this._boxExtendHorizontal+=s.GetBoxExtendHorizontal();this._boxExtendVertical+=s.GetBoxExtendVertical();if(s.IsAnimated())this._isAnyShaderAnimated=true;if(s.UsesDepth())this._isAnyShaderDepthSampling=true;if(s.BlendsBackground())this._isAnyShaderBackgroundBlending=true;if(s.UsesCrossSampling())this._isAnyShaderCrossSampling=true;if(s.UsesIsSrcTexRotated())this._isAnyIsSrcTexRotated=true;}}catch(err){_didIteratorError100=true;_iteratorError100=err;}finally{try{if(!_iteratorNormalCompletion100&&_iterator100["return"]!=null){_iterator100["return"]();}}finally{if(_didIteratorError100){throw _iteratorError100;}}}this._useCopyTextureBackgroundSampling=this._ShouldUseCopyTextureBackgroundSampling(shaderProgramList[0].GetRenderer());var doPreDraw=this._ShouldPreDraw(shaderProgramList[0],opts);var doPostDraw=this._ShouldPostDraw(shaderProgramList.at(-1),opts);if(shaderProgramList.length===1&&!doPreDraw&&!doPostDraw){this._canUseFastPath=true;return;}this._canUseFastPath=false;var lastTargetId=0;if(doPreDraw){this._numTempSurfacesRequired=1;this._steps.push(_C58.New(_C58.Gfx.EffectChain.Step.PreDraw,this,-1,1));lastTargetId=1;}for(var _i31=0,_len31=shaderProgramList.length;_i31<_len31;++_i31){if(_i31===0&&!doPreDraw){this._numTempSurfacesRequired=1;this._steps.push(_C58.New(_C58.Gfx.EffectChain.Step.FirstBounce,this,-1,1,_i31));lastTargetId=1;}else{var nextTargetId=lastTargetId===1?2:1;if(_i31===_len31-1&&!doPostDraw)nextTargetId=0;this._numTempSurfacesRequired=Math.max(this._numTempSurfacesRequired,nextTargetId);this._steps.push(_C58.New(_C58.Gfx.EffectChain.Step.Bounce,this,lastTargetId,nextTargetId,_i31));lastTargetId=nextTargetId;}}if(doPostDraw)this._steps.push(_C58.New(_C58.Gfx.EffectChain.Step.PostDraw,this,lastTargetId,0));}},{key:"_ShouldPreDraw",value:function _ShouldPreDraw(firstShaderProgram,opts){if(opts.forcePreDraw||firstShaderProgram.MustPreDraw()||opts.is3D||firstShaderProgram.UsesDepth()&&!this._useFullSurface||this._boxExtendHorizontal!==0||this._boxExtendVertical!==0)return true;if(firstShaderProgram.GetRenderer().IsWebGL())return firstShaderProgram.BlendsBackground()&&(opts.isRotatedOrNegativeSizeInstance||opts.isSourceTextureRotated)||firstShaderProgram.UsesAnySrcRectOrPixelSize()&&opts.isSourceTextureRotated;else return false;}},{key:"_ShouldPostDraw",value:function _ShouldPostDraw(lastShaderProgram,opts){if(opts.forcePostDraw)return true;if(lastShaderProgram.GetRenderer().IsWebGL())return lastShaderProgram.BlendsBackground()||lastShaderProgram.UsesCrossSampling();else return(lastShaderProgram.BlendsBackground()||lastShaderProgram.UsesCrossSampling())&&this._UseRenderTargetBackgroundSampling();}},{key:"_ShouldUseCopyTextureBackgroundSampling",value:function _ShouldUseCopyTextureBackgroundSampling(renderer){return renderer.IsWebGPU()&&this._isAnyShaderBackgroundBlending&&!this._isAnyShaderCrossSampling;}},{key:"Render",value:function Render(renderer,destRenderTarget,opts){if(renderer.IsWebGPU()&&destRenderTarget===null)destRenderTarget=renderer.GetBackbufferRenderTarget();this._destRenderTarget=destRenderTarget;this._contentObject=opts.contentObject||null;this._contextObject=opts.contextObject||null;this._blendMode=opts.blendMode||0;this._devicePixelRatio=opts.devicePixelRatio||1;this._layerScale=opts.layerScale||1;this._layerAngle=opts.layerAngle||0;this._time=typeof opts.time==="number"?opts.time:this._manager.GetTime();this._didChangeTransform=false;renderer.ResetDidChangeTransformFlag();if(this._isAnyShaderAnimated)this._Redraw();var didCalcDrawSizeAndRects=false;if(this._UseCopyTextureBackgroundSampling()){this._CalculateDrawSizeAndRectangles(renderer,opts);didCalcDrawSizeAndRects=true;this._backTex=this._manager._GetWebGPUBackTexture(renderer,this._drawWidth,this._drawHeight);tempRect.copy(this._drawSurfaceRect);tempRect.roundOuter();if(renderer.IsWebGPU())renderer._MaybeDoPendingClearRenderPass(this._destRenderTarget);renderer.CopyTextureToTexture(this._destRenderTarget.GetTexture(),this._backTex,tempRect.getLeft(),tempRect.getTop(),tempRect.width(),tempRect.height());}if(this._canUseFastPath){this._Render_FastPath(renderer,opts);return;}if(!didCalcDrawSizeAndRects)this._CalculateDrawSizeAndRectangles(renderer,opts);renderer.SetAlphaBlend();renderer.ResetColor();renderer.SetBaseZ(0);renderer.SetCurrentZ(0);this._cbDrawContentHook=opts.drawContentHook||null;this._compositOffX=opts.compositOffX||0;this._compositOffY=opts.compositOffY||0;this._updateOwnProjection=!!opts.updateOwnProjection;this._OnBeforeStartEffectChain(renderer);this._renderTargets[0]=destRenderTarget;this._renderTargets[1]=this._numTempSurfacesRequired>=1?this._GetRenderTarget():null;this._renderTargets[2]=this._numTempSurfacesRequired===2?this._GetRenderTarget():null;var _iteratorNormalCompletion101=true;var _didIteratorError101=false;var _iteratorError101=undefined;try{for(var _iterator101=this._steps[Symbol.iterator](),_step101;!(_iteratorNormalCompletion101=(_step101=_iterator101.next()).done);_iteratorNormalCompletion101=true){var step=_step101.value;var srcTarget=this._GetRenderTargetForId(step.GetSrcTargetId());var destTarget=this._GetRenderTargetForId(step.GetDestTargetId());if(renderer.IsWebGPU())step.Run_WebGPU(renderer,srcTarget,destTarget);else step.Run_WebGL(renderer,srcTarget,destTarget);}}catch(err){_didIteratorError101=true;_iteratorError101=err;}finally{try{if(!_iteratorNormalCompletion101&&_iterator101["return"]!=null){_iterator101["return"]();}}finally{if(_didIteratorError101){throw _iteratorError101;}}}if(this._renderTargets[1])this._ReleaseRenderTarget(this._renderTargets[1]);if(this._renderTargets[2])this._ReleaseRenderTarget(this._renderTargets[2]);this._renderTargets.fill(null);this._OnAfterEndEffectChain(renderer);this._destRenderTarget=null;this._backTex=null;this._contentObject=null;this._contextObject=null;this._cbDrawContentHook=null;}},{key:"_CalculateDrawSizeAndRectangles",value:function _CalculateDrawSizeAndRectangles(renderer,opts){var _this$_manager$GetDra=this._manager.GetDrawSize(renderer),_this$_manager$GetDra2=_slicedToArray(_this$_manager$GetDra,2),drawWidth=_this$_manager$GetDra2[0],drawHeight=_this$_manager$GetDra2[1];this._SetDrawSize(renderer,drawWidth,drawHeight);this._CalculateRectangles(opts);}},{key:"_SetDrawSize",value:function _SetDrawSize(renderer,drawWidth,drawHeight){if(drawWidth<=0||drawHeight<=0)throw new Error("invalid draw size");if(this._drawWidth!==drawWidth||this._drawHeight!==drawHeight)this._CalculateDeviceTransformMatrices(renderer,drawWidth,drawHeight,0,0,this._projectionMatrix,this._modelViewMatrix);this._drawWidth=drawWidth;this._drawHeight=drawHeight;}},{key:"_CalculateDeviceTransformMatrices",value:function _CalculateDeviceTransformMatrices(renderer,width,height,offX,offY,projMat,mvMat){var scrollX=width/2+offX;var scrollY=height/2+offY;renderer.CalculatePerspectiveMatrix(projMat,width/height);var tempMat4=renderer.CalculateLookAtModelView2(scrollX,scrollY,renderer.GetDefaultCameraZ(height),scrollX,scrollY,0,height);_mat7.copy(mvMat,tempMat4);}},{key:"_CalculateRectangles",value:function _CalculateRectangles(opts){this._layoutRect.copy(opts.layoutRect);if(opts.drawSurfaceRect)this._drawSurfaceRect.copy(opts.drawSurfaceRect);else this._drawSurfaceRect.set(0,0,this._drawWidth,this._drawHeight);this._rcTexOriginal.copy(this._drawSurfaceRect);this._rcTexOriginal.divide(this._drawWidth,this._drawHeight);var boxScale=this._layerScale*this._devicePixelRatio;this._drawSurfaceRect.inflate(this._boxExtendHorizontal*boxScale,this._boxExtendVertical*boxScale);this._rcTexDest.copy(this._drawSurfaceRect);this._rcTexDest.divide(this._drawWidth,this._drawHeight);this._drawSurfaceRect.clampBoth(0,0,this._drawWidth,this._drawHeight);this._rcTexBounce.copy(this._drawSurfaceRect);this._rcTexBounce.divide(this._drawWidth,this._drawHeight);}},{key:"_OnBeforeStartEffectChain",value:function _OnBeforeStartEffectChain(renderer){this._depthEnabledAtStart=renderer.IsDepthEnabled();this._coplanarColorPassAtStart=renderer.IsCoplanarColorPass();if(this._useFullSurface){renderer.SetDepthEnabled(false);if(this._isAnyShaderDepthSampling)renderer.SetDepthSamplingEnabled(true);}else{tempRect.copy(this._drawSurfaceRect);if(renderer.IsWebGL()){var boxScale=this._layerScale*this._devicePixelRatio;tempRect.inflate(Math.max(this._boxExtendHorizontal,1)*boxScale,Math.max(this._boxExtendVertical,1)*boxScale);tempRect.roundOuter();tempRect.clamp(0,0,this._drawWidth,this._drawHeight);}else tempRect.roundOuter();renderer.SetScissorRect(tempRect.getLeft(),tempRect.getTop(),tempRect.width(),tempRect.height(),this._drawHeight);}}},{key:"_OnAfterEffectChainDrawContent",value:function _OnAfterEffectChainDrawContent(renderer){renderer.ResetColor();if(!this._useFullSurface){if(this._coplanarColorPassAtStart)renderer.CoplanarRestoreStandardRendering();renderer.SetDepthEnabled(false);if(this._isAnyShaderDepthSampling)renderer.SetDepthSamplingEnabled(true);}if(renderer.IsWebGPU())renderer.SetNormalizedCoordsProgramVariant(true);}},{key:"_OnAfterEndEffectChain",value:function _OnAfterEndEffectChain(renderer){renderer.SetDepthSamplingEnabled(false);if(this._coplanarColorPassAtStart)renderer.CoplanarStartColorPass();renderer.SetDepthEnabled(this._depthEnabledAtStart);if(!this._useFullSurface)renderer.RemoveScissorRect();if(renderer.IsWebGPU())renderer.SetNormalizedCoordsProgramVariant(false);this._didChangeTransform=renderer.DidChangeTransform();}},{key:"_ClampRcTexDest",value:function _ClampRcTexDest(){this._rcTexDest.clamp(0,0,1,1);}},{key:"_GetRenderTargetForId",value:function _GetRenderTargetForId(id){return id<0?null:this._renderTargets[id];}},{key:"_GetRenderTarget",value:function _GetRenderTarget(){return this._manager.GetRenderTarget(this);}},{key:"_GetDestRenderTarget",value:function _GetDestRenderTarget(){return this._destRenderTarget;}},{key:"_ReleaseRenderTarget",value:function _ReleaseRenderTarget(rt){this._manager.ReleaseRenderTarget(rt,this);}},{key:"_GetShaderProgramAt",value:function _GetShaderProgramAt(i){return this._shaderProgramList[i];}},{key:"_DrawContent",value:function _DrawContent(renderer){var _this22=this;if(this._cbDrawContentHook)this._cbDrawContentHook(this,renderer,function(){return _this22._cbDrawContent(renderer,_this22);});else this._cbDrawContent(renderer,this);if(!this._canUseFastPath)this._OnAfterEffectChainDrawContent(renderer);}},{key:"_IsRenderTargetSameSizeAndOffset",value:function _IsRenderTargetSameSizeAndOffset(renderer){if(this._useFullSurface)return true;if(this._compositOffX!==0||this._compositOffY!==0)return false;var _renderer$GetRenderTa=renderer.GetRenderTargetSize(renderer.GetRenderTarget()),_renderer$GetRenderTa2=_slicedToArray(_renderer$GetRenderTa,2),rtWidth=_renderer$GetRenderTa2[0],rtHeight=_renderer$GetRenderTa2[1];if(rtWidth!==this._drawWidth||rtHeight!==this._drawHeight)return false;return true;}},{key:"_SetDeviceTransform",value:function _SetDeviceTransform(renderer,isLast){var projMat=this._projectionMatrix;var mvMat=this._modelViewMatrix;if(isLast&&!this._IsRenderTargetSameSizeAndOffset(renderer)){projMat=tempMat4a;mvMat=tempMat4b;var _renderer$GetRenderTa3=renderer.GetRenderTargetSize(renderer.GetRenderTarget()),_renderer$GetRenderTa4=_slicedToArray(_renderer$GetRenderTa3,2),rtWidth=_renderer$GetRenderTa4[0],rtHeight=_renderer$GetRenderTa4[1];this._CalculateDeviceTransformMatrices(renderer,rtWidth,rtHeight,this._compositOffX,this._compositOffY,projMat,mvMat);if(!this._useFullSurface)renderer.RemoveScissorRect();}renderer.SetProjectionMatrix(projMat);renderer.SetModelViewMatrix(mvMat);}},{key:"_Redraw",value:function _Redraw(){this._manager.Redraw(this);}},{key:"_GetShaderParameters",value:function _GetShaderParameters(index,renderer){return this._cbGetShaderParameters(this._shaderProgramIndices[index],renderer);}},{key:"_SetProgramParameters",value:function _SetProgramParameters(renderer,index){var rcTexDest=this._rcTexDest;var srcRect=this._rcTexBounce;var srcOriginRect=this._rcTexOriginal;if(renderer.IsWebGL()){tempRect2.copy(rcTexDest);tempRect2.flipAround(1);rcTexDest=tempRect2;tempRect3.copy(srcRect);tempRect3.flipAround(1);srcRect=tempRect3;tempRect4.copy(srcOriginRect);tempRect4.flipAround(1);srcOriginRect=tempRect4;}this._DoSetProgramParameters(renderer,index,srcRect,srcOriginRect,rcTexDest,1/this._drawWidth,1/this._drawHeight);}},{key:"_SetFirstBounceProgramParameters",value:function _SetFirstBounceProgramParameters(renderer,index){var srcRect=this._rcTexBounce;var srcOriginRect=this._rcTexOriginal;var pixelWidth=1/this._drawWidth;var pixelHeight=1/this._drawHeight;if(this._cbGetSourceTextureInfo){var _this$_cbGetSourceTex=this._cbGetSourceTextureInfo(this._contentObject),srcTexRect=_this$_cbGetSourceTex.srcTexRect,srcWidth=_this$_cbGetSourceTex.srcWidth,srcHeight=_this$_cbGetSourceTex.srcHeight;if(!srcTexRect){tempRect.set(0,0,0,0);srcTexRect=tempRect;}if(!srcWidth)srcWidth=this._drawWidth;if(!srcHeight)srcHeight=this._drawHeight;srcRect=srcTexRect;srcOriginRect=srcTexRect;pixelWidth=1/srcWidth;pixelHeight=1/srcHeight;}else if(renderer.IsWebGL()){tempRect3.copy(srcRect);tempRect3.flipAround(1);srcRect=tempRect3;tempRect4.copy(srcOriginRect);tempRect4.flipAround(1);srcOriginRect=tempRect4;}var rcTexDest=this._rcTexDest;if(renderer.IsWebGL()){rcTexDest=tempRect2;rcTexDest.copy(this._rcTexDest);rcTexDest.flipAround(1);}this._DoSetProgramParameters(renderer,index,srcRect,srcOriginRect,rcTexDest,pixelWidth,pixelHeight);if(renderer.IsWebGPU()&&this._isAnyIsSrcTexRotated)renderer.SetProgramParameter_IsSrcTexRotated(this._isSourceTextureRotated);}},{key:"_GetBackTex",value:function _GetBackTex(renderer){if(this._isAnyShaderBackgroundBlending){if(renderer.IsWebGPU()){if(this._UseCopyTextureBackgroundSampling())return this._backTex;else return this._destRenderTarget.GetTexture();}else return this._destRenderTarget;}else return null;}},{key:"_DoSetProgramParameters",value:function _DoSetProgramParameters(renderer,index,srcRect,srcOriginRect,rcTexDest,pixelWidth,pixelHeight){renderer.SetProgramParameters(this._GetBackTex(renderer),rcTexDest,srcRect,srcOriginRect,this._layoutRect,pixelWidth,pixelHeight,this._devicePixelRatio,this._layerScale,this._layerAngle,this._time);renderer.SetProgramCustomParameters(this._GetShaderParameters(index,renderer));}},{key:"_Render_FastPath",value:function _Render_FastPath(renderer,opts){var shaderProgram=this._shaderProgramList[0];var wasDepthEnabled=renderer.IsDepthEnabled();var usesDepth=shaderProgram.UsesDepth();if(usesDepth){renderer.SetDepthEnabled(false);renderer.SetDepthSamplingEnabled(true);this._rcTexDest.set(0,0,1,1);this._rcTexOriginal.set(0,0,1,1);}renderer.SetProgram(shaderProgram);renderer.SetBlendMode(this._blendMode);renderer.SetRenderTarget(this._destRenderTarget);var pixelWidth=0;var pixelHeight=1;this._rcTexOriginal.set(0,0,1,1);if(shaderProgram.UsesAnySrcRectOrPixelSize()&&this._cbGetSourceTextureInfo){var _this$_cbGetSourceTex2=this._cbGetSourceTextureInfo(this._contentObject),srcTexRect=_this$_cbGetSourceTex2.srcTexRect,srcWidth=_this$_cbGetSourceTex2.srcWidth,srcHeight=_this$_cbGetSourceTex2.srcHeight;if(srcTexRect)this._rcTexOriginal.copy(srcTexRect);pixelWidth=Number.isFinite(srcWidth)?1/srcWidth:0;pixelHeight=Number.isFinite(srcHeight)?1/srcHeight:0;}else{var _this$_manager$GetDra3=this._manager.GetDrawSize(renderer),_this$_manager$GetDra4=_slicedToArray(_this$_manager$GetDra3,2),drawWidth=_this$_manager$GetDra4[0],drawHeight=_this$_manager$GetDra4[1];pixelWidth=1/drawWidth;pixelHeight=1/drawHeight;}if(opts.layoutRect)this._layoutRect.copy(opts.layoutRect);else this._layoutRect.set(0,0,0,0);renderer.SetProgramParameters(this._GetBackTex(renderer),this._rcTexDest,this._rcTexOriginal,this._rcTexOriginal,this._layoutRect,pixelWidth,pixelHeight,this._devicePixelRatio,this._layerScale,this._layerAngle,this._time);renderer.SetProgramCustomParameters(this._GetShaderParameters(0,renderer));if(renderer.IsWebGPU()&&this._isAnyIsSrcTexRotated)renderer.SetProgramParameter_IsSrcTexRotated(this._isSourceTextureRotated);renderer.SetBaseZ(0);this._DrawContent(renderer);if(usesDepth){renderer.SetDepthSamplingEnabled(false);renderer.SetDepthEnabled(wasDepthEnabled);}}},{key:"_UseCopyTextureBackgroundSampling",value:function _UseCopyTextureBackgroundSampling(){return this._useCopyTextureBackgroundSampling;}},{key:"_UseRenderTargetBackgroundSampling",value:function _UseRenderTargetBackgroundSampling(){return!this._useCopyTextureBackgroundSampling;}},{key:"IsAnyShaderBackgroundBlending",value:function IsAnyShaderBackgroundBlending(){return this._isAnyShaderBackgroundBlending;}},{key:"CanSkipCalculatingDrawSurfaceRect",value:function CanSkipCalculatingDrawSurfaceRect(){if(!this._canUseFastPath)return false;if(this._UseCopyTextureBackgroundSampling())return false;return true;}},{key:"UseFullSurface",value:function UseFullSurface(){return this._useFullSurface;}},{key:"GetContentObject",value:function GetContentObject(){return this._contentObject;}},{key:"GetContextObject",value:function GetContextObject(){return this._contextObject;}},{key:"_GetBlendMode",value:function _GetBlendMode(){return this._blendMode;}},{key:"_UpdateOwnProjection",value:function _UpdateOwnProjection(){return this._updateOwnProjection;}},{key:"DidChangeTransform",value:function DidChangeTransform(){return this._didChangeTransform;}},{key:"_GetDrawSurfaceRect",value:function _GetDrawSurfaceRect(){return this._drawSurfaceRect;}},{key:"_GetRcTexBounce",value:function _GetRcTexBounce(){return this._rcTexBounce;}},{key:"_ShouldInvalidateRenderTargets",value:function _ShouldInvalidateRenderTargets(){return this._invalidateRenderTargets;}},{key:"DebugLogRenderTargetContents",value:function DebugLogRenderTargetContents(msg,renderer,renderTarget){return regeneratorRuntime.async(function DebugLogRenderTargetContents$(_context52){while(1){switch(_context52.prev=_context52.next){case 0:case"end":return _context52.stop();}}});}}]);return EffectChain;}();}// ../lib/gfx/effectCompositor/step.js
{'use strict';var _C59=self.C3;_C59.Gfx.EffectChain.Step=/*#__PURE__*/function(){function EffectChainStep(effectChain,srcTargetId,destTargetId){var index=arguments.length>3&&arguments[3]!==undefined?arguments[3]:-1;_classCallCheck(this,EffectChainStep);this._effectChain=effectChain;this._srcTargetId=srcTargetId;this._destTargetId=destTargetId;this._index=index;}_createClass(EffectChainStep,[{key:"GetEffectChain",value:function GetEffectChain(){return this._effectChain;}},{key:"GetSrcTargetId",value:function GetSrcTargetId(){return this._srcTargetId;}},{key:"GetDestTargetId",value:function GetDestTargetId(){return this._destTargetId;}},{key:"GetIndex",value:function GetIndex(){return this._index;}},{key:"GetShaderProgram",value:function GetShaderProgram(){return this.GetEffectChain()._GetShaderProgramAt(this.GetIndex());}},{key:"Run_WebGL",value:function Run_WebGL(renderer,srcRenderTarget,destRenderTarget){}},{key:"Run_WebGPU",value:function Run_WebGPU(renderer,srcRenderTarget,destRenderTarget){}}]);return EffectChainStep;}();}// ../lib/gfx/effectCompositor/preDrawStep.js
{'use strict';var _C60=self.C3;_C60.Gfx.EffectChain.Step.PreDraw=/*#__PURE__*/function(_C60$Gfx$EffectChain$){_inherits(PreDrawStep,_C60$Gfx$EffectChain$);function PreDrawStep(effectChain,srcTargetId,destTargetId,index){_classCallCheck(this,PreDrawStep);return _possibleConstructorReturn(this,_getPrototypeOf(PreDrawStep).call(this,effectChain,srcTargetId,destTargetId,index));}_createClass(PreDrawStep,[{key:"Run_WebGL",value:function Run_WebGL(renderer,srcRenderTarget,destRenderTarget){var effectChain=this.GetEffectChain();renderer.SetAlphaBlend();renderer.SetTextureFillMode();renderer.SetRenderTarget(destRenderTarget,effectChain._UpdateOwnProjection());renderer.ClearRgba(0,0,0,0);effectChain._DrawContent(renderer);effectChain._ClampRcTexDest();}},{key:"Run_WebGPU",value:function Run_WebGPU(renderer,srcRenderTarget,destRenderTarget){var effectChain=this.GetEffectChain();renderer.SetAlphaBlend();renderer.SetTextureFillMode();renderer.SetRenderTarget(destRenderTarget,false);renderer.ClearRgba(0,0,0,0);effectChain._DrawContent(renderer);effectChain._ClampRcTexDest();}}]);return PreDrawStep;}(_C60.Gfx.EffectChain.Step);}// ../lib/gfx/effectCompositor/postDrawStep.js
{'use strict';var _C61=self.C3;var _tempRect=_C61.New(_C61.Rect);var _tempQuad=_C61.New(_C61.Quad);_C61.Gfx.EffectChain.Step.PostDraw=/*#__PURE__*/function(_C61$Gfx$EffectChain$){_inherits(PostDrawStep,_C61$Gfx$EffectChain$);function PostDrawStep(effectChain,srcTargetId,destTargetId,index){_classCallCheck(this,PostDrawStep);return _possibleConstructorReturn(this,_getPrototypeOf(PostDrawStep).call(this,effectChain,srcTargetId,destTargetId,index));}_createClass(PostDrawStep,[{key:"Run_WebGL",value:function Run_WebGL(renderer,srcRenderTarget,destRenderTarget){var effectChain=this.GetEffectChain();renderer.SetTextureFillMode();renderer.SetRenderTarget(destRenderTarget);effectChain._SetDeviceTransform(renderer,true);renderer.SetBlendMode(effectChain._GetBlendMode());renderer.SetTexture(srcRenderTarget.GetTexture());_tempQuad.setFromRect(effectChain._GetDrawSurfaceRect());_tempRect.copy(effectChain._GetRcTexBounce());_tempRect.flipAround(1);renderer.Quad3(_tempQuad,_tempRect);if(effectChain._ShouldInvalidateRenderTargets())renderer.InvalidateRenderTarget(srcRenderTarget);}},{key:"Run_WebGPU",value:function Run_WebGPU(renderer,srcRenderTarget,destRenderTarget){var effectChain=this.GetEffectChain();renderer.SetTextureFillMode();renderer.SetRenderTarget(destRenderTarget,false);if(effectChain._IsRenderTargetSameSizeAndOffset(renderer))_tempQuad.setFromRect(effectChain._GetRcTexBounce());else{renderer.SetNormalizedCoordsProgramVariant(false);effectChain._SetDeviceTransform(renderer,true);_tempQuad.setFromRect(effectChain._GetDrawSurfaceRect());}renderer.SetBackTexture(null);renderer.SetBlendMode(effectChain._GetBlendMode());renderer.SetTexture(srcRenderTarget.GetTexture());if(effectChain.UseFullSurface())renderer.FullscreenQuad();else renderer.Quad3(_tempQuad,effectChain._GetRcTexBounce());}}]);return PostDrawStep;}(_C61.Gfx.EffectChain.Step);}// ../lib/gfx/effectCompositor/firstBounceStep.js
{'use strict';var _C62=self.C3;_C62.Gfx.EffectChain.Step.FirstBounce=/*#__PURE__*/function(_C62$Gfx$EffectChain$){_inherits(FirstBounceStep,_C62$Gfx$EffectChain$);function FirstBounceStep(effectChain,srcTargetId,destTargetId,index){_classCallCheck(this,FirstBounceStep);return _possibleConstructorReturn(this,_getPrototypeOf(FirstBounceStep).call(this,effectChain,srcTargetId,destTargetId,index));}_createClass(FirstBounceStep,[{key:"Run_WebGL",value:function Run_WebGL(renderer,srcRenderTarget,destRenderTarget){var effectChain=this.GetEffectChain();renderer.SetRenderTarget(destRenderTarget,effectChain._UpdateOwnProjection());renderer.ClearRgba(0,0,0,0);renderer.SetCopyBlend();renderer.SetProgram(this.GetShaderProgram());effectChain._SetFirstBounceProgramParameters(renderer,this.GetIndex());effectChain._DrawContent(renderer);effectChain._ClampRcTexDest();}},{key:"Run_WebGPU",value:function Run_WebGPU(renderer,srcRenderTarget,destRenderTarget){var effectChain=this.GetEffectChain();renderer.SetRenderTarget(destRenderTarget,false);renderer.ClearRgba(0,0,0,0);renderer.SetCopyBlend();renderer.SetProgram(this.GetShaderProgram());effectChain._SetFirstBounceProgramParameters(renderer,this.GetIndex());effectChain._DrawContent(renderer);effectChain._ClampRcTexDest();}}]);return FirstBounceStep;}(_C62.Gfx.EffectChain.Step);}// ../lib/gfx/effectCompositor/bounceStep.js
{'use strict';var _C63=self.C3;var _tempRect2=_C63.New(_C63.Rect);var _tempQuad2=_C63.New(_C63.Quad);_C63.Gfx.EffectChain.Step.Bounce=/*#__PURE__*/function(_C63$Gfx$EffectChain$){_inherits(BounceStep,_C63$Gfx$EffectChain$);function BounceStep(effectChain,srcTargetId,destTargetId,index){_classCallCheck(this,BounceStep);return _possibleConstructorReturn(this,_getPrototypeOf(BounceStep).call(this,effectChain,srcTargetId,destTargetId,index));}_createClass(BounceStep,[{key:"Run_WebGL",value:function Run_WebGL(renderer,srcRenderTarget,destRenderTarget){var effectChain=this.GetEffectChain();renderer.SetRenderTarget(destRenderTarget);var isLast=this.GetDestTargetId()===0;if(isLast)renderer.SetBlendMode(effectChain._GetBlendMode());else{renderer.ClearRgba(0,0,0,0);renderer.SetCopyBlend();}renderer.SetProgram(this.GetShaderProgram());effectChain._SetProgramParameters(renderer,this.GetIndex());renderer.SetTexture(srcRenderTarget.GetTexture());effectChain._SetDeviceTransform(renderer,isLast);_tempQuad2.setFromRect(effectChain._GetDrawSurfaceRect());_tempRect2.copy(effectChain._GetRcTexBounce());_tempRect2.flipAround(1);renderer.Quad3(_tempQuad2,_tempRect2);if(effectChain._ShouldInvalidateRenderTargets())renderer.InvalidateRenderTarget(srcRenderTarget);}},{key:"Run_WebGPU",value:function Run_WebGPU(renderer,srcRenderTarget,destRenderTarget){var effectChain=this.GetEffectChain();renderer.SetRenderTarget(destRenderTarget,false);var isLast=this.GetDestTargetId()===0;if(isLast){renderer.SetBlendMode(effectChain._GetBlendMode());renderer.SetBackTexture(null);if(effectChain._IsRenderTargetSameSizeAndOffset(renderer))_tempQuad2.setFromRect(effectChain._GetRcTexBounce());else{renderer.SetNormalizedCoordsProgramVariant(false);effectChain._SetDeviceTransform(renderer,true);_tempQuad2.setFromRect(effectChain._GetDrawSurfaceRect());}}else{renderer.ClearRgba(0,0,0,0);renderer.SetCopyBlend();_tempQuad2.setFromRect(effectChain._GetRcTexBounce());}renderer.SetProgram(this.GetShaderProgram());effectChain._SetProgramParameters(renderer,this.GetIndex());renderer.SetTexture(srcRenderTarget.GetTexture());if(effectChain.UseFullSurface())renderer.FullscreenQuad();else renderer.Quad3(_tempQuad2,effectChain._GetRcTexBounce());}}]);return BounceStep;}(_C63.Gfx.EffectChain.Step);}// interfaces/IRuntime.js
{var SortZOrderList=function SortZOrderList(a,b){var layerA=a[0];var layerB=b[0];var diff=layerA-layerB;if(diff!==0)return diff;var indexA=a[1];var indexB=b[1];return indexA-indexB;};'use strict';var _C64=self.C3;var _C3X=self.C3X;var runtime=null;var keysDownByKey=new Set();var tempZOrderList=[];var tempInstances=[];var didWarnInAlertPolyfill=false;self.IRuntime=/*#__PURE__*/function(){function IRuntime(runtime_,objects){var _this23=this;_classCallCheck(this,IRuntime);runtime=runtime_;Object.defineProperties(this,{assets:{value:runtime.GetAssetManager().GetIAssetManager(),writable:false},collisions:{value:runtime.GetCollisionEngine().GetICollisionEngine(),writable:false},objects:{value:objects,writable:false},globalVars:{value:{},writable:false},projectName:{value:runtime.GetProjectName(),writable:false},projectVersion:{value:runtime.GetProjectVersion(),writable:false},storage:{value:new self.IStorage(runtime),writable:false},isInWorker:{value:runtime.IsInWorker(),writable:false},viewportWidth:{value:runtime.GetOriginalViewportWidth(),writable:false},viewportHeight:{value:runtime.GetOriginalViewportHeight(),writable:false}});runtime.UserScriptDispatcher().addEventListener("keydown",function(e){if(keysDownByKey.has(e["key"])){e.stopPropagation();return;}keysDownByKey.add(e["key"]);});runtime.UserScriptDispatcher().addEventListener("keyup",function(e){return keysDownByKey["delete"](e["key"]);});runtime.Dispatcher().addEventListener("window-blur",function(){return keysDownByKey.clear();});if(runtime.IsInWorker())self["alert"]=function(message){if(!didWarnInAlertPolyfill){didWarnInAlertPolyfill=true;console.warn("[Construct] alert() was called from a Web Worker, because the project 'Use worker' setting is enabled. This method is not normally available in a Web Worker. Construct has implemented the alert for you, but note that other features may be missing in worker mode. You may wish to disable 'Use worker', or use a more convenient function like console.log(). For more information please refer to the scripting section of the manual.");}return _this23.alert(message);};}_createClass(IRuntime,[{key:"_InitGlobalVars",value:function _InitGlobalVars(globalVarDescriptors){Object.defineProperties(this.globalVars,globalVarDescriptors);}},{key:"addEventListener",value:function addEventListener(name,func){runtime.UserScriptDispatcher().addEventListener(name,func);}},{key:"removeEventListener",value:function removeEventListener(name,func){runtime.UserScriptDispatcher().removeEventListener(name,func);}},{key:"callFunction",value:function callFunction(name){_C3X.RequireString(name);var eventSheetManager=runtime.GetEventSheetManager();var functionBlock=eventSheetManager.GetFunctionBlockByName(name);if(!functionBlock)throw new Error("cannot find function name '".concat(name,"'"));if(!functionBlock.IsEnabled())return functionBlock.GetDefaultReturnValue();for(var _len32=arguments.length,params=new Array(_len32>1?_len32-1:0),_key25=1;_key25<_len32;_key25++){params[_key25-1]=arguments[_key25];}if(params.length<functionBlock.GetFunctionParameterCount())throw new Error("not enough function parameters passed for '".concat(name,"' (").concat(params.length," passed, ").concat(functionBlock.GetFunctionParameterCount()," expected)"));var callEventBlock=functionBlock.GetEventBlock();var allSolModifiers=callEventBlock.GetSolModifiersIncludingParents();var currentEvent=eventSheetManager.GetCurrentEvent();if(currentEvent){allSolModifiers=allSolModifiers.slice(0);var allSolModifiersSet=new Set(allSolModifiers);var _iteratorNormalCompletion102=true;var _didIteratorError102=false;var _iteratorError102=undefined;try{for(var _iterator102=currentEvent.GetSolModifiersIncludingParents()[Symbol.iterator](),_step102;!(_iteratorNormalCompletion102=(_step102=_iterator102.next()).done);_iteratorNormalCompletion102=true){var objectClass=_step102.value;if(!allSolModifiersSet.has(objectClass)){allSolModifiers.push(objectClass);allSolModifiersSet.add(objectClass);}}}catch(err){_didIteratorError102=true;_iteratorError102=err;}finally{try{if(!_iteratorNormalCompletion102&&_iterator102["return"]!=null){_iterator102["return"]();}}finally{if(_didIteratorError102){throw _iteratorError102;}}}var _iteratorNormalCompletion103=true;var _didIteratorError103=false;var _iteratorError103=undefined;try{for(var _iterator103=eventSheetManager.GetDynamicSolModifiersSet()[Symbol.iterator](),_step103;!(_iteratorNormalCompletion103=(_step103=_iterator103.next()).done);_iteratorNormalCompletion103=true){var _objectClass=_step103.value;if(!allSolModifiersSet.has(_objectClass)){allSolModifiers.push(_objectClass);allSolModifiersSet.add(_objectClass);}}}catch(err){_didIteratorError103=true;_iteratorError103=err;}finally{try{if(!_iteratorNormalCompletion103&&_iterator103["return"]!=null){_iterator103["return"]();}}finally{if(_didIteratorError103){throw _iteratorError103;}}}}var ret=callEventBlock.RunAsExpressionFunctionCall.apply(callEventBlock,[allSolModifiers,functionBlock.IsCopyPicked(),functionBlock.GetReturnType(),functionBlock.GetDefaultReturnValue()].concat(params));return ret;}},{key:"setReturnValue",value:function setReturnValue(v){var frame=runtime.GetEventStack().GetCurrentExpFuncStackFrame();if(!frame)throw new Error("not in a function which returns a value");switch(frame.GetFunctionReturnType()){case 1:if(typeof v==="number")frame.SetFunctionReturnValue(v);break;case 2:if(typeof v==="string")frame.SetFunctionReturnValue(v);break;case 3:if(typeof v==="number"||typeof v==="string")frame.SetFunctionReturnValue(v);break;}}},{key:"getViewportSize",value:function getViewportSize(){return[runtime.GetOriginalViewportWidth(),runtime.GetOriginalViewportHeight()];}},{key:"random",value:function random(){return runtime.Random();}},{key:"getLayout",value:function getLayout(nameOrIndex){var layoutManager=runtime.GetLayoutManager();var layout=null;if(typeof nameOrIndex==="number"||typeof nameOrIndex==="string")layout=layoutManager.GetLayout(nameOrIndex);else throw new TypeError("expected string or number");if(!layout)throw new Error("invalid layout");return layout.GetILayout();}},{key:"getAllLayouts",value:function getAllLayouts(){return runtime.GetLayoutManager().GetAllLayouts().map(function(layout){return layout.GetILayout();});}},{key:"goToLayout",value:function goToLayout(nameOrIndex){var layoutManager=runtime.GetLayoutManager();var layout=null;if(typeof nameOrIndex==="number"||typeof nameOrIndex==="string")layout=layoutManager.GetLayout(nameOrIndex);else throw new TypeError("expected string or number");if(!layout)throw new Error("invalid layout");if(layoutManager.IsPendingChangeMainLayout())return;layoutManager.ChangeMainLayout(layout);}},{key:"invokeDownload",value:function invokeDownload(url,filename){_C3X.RequireString(url);_C3X.RequireString(filename);runtime.InvokeDownload(url,filename);}},{key:"getInstanceByUid",value:function getInstanceByUid(uid){_C3X.RequireFiniteNumber(uid);var ret=runtime.GetInstanceByUID(uid);return ret?ret.GetInterfaceClass():null;}},{key:"sortZOrder",value:function sortZOrder(iterable,callback){_C3X.RequireFunction(callback);var layout=runtime.GetCurrentLayout();var _iteratorNormalCompletion104=true;var _didIteratorError104=false;var _iteratorError104=undefined;try{for(var _iterator104=iterable[Symbol.iterator](),_step104;!(_iteratorNormalCompletion104=(_step104=_iterator104.next()).done);_iteratorNormalCompletion104=true){var iinst=_step104.value;var _inst=runtime._UnwrapIWorldInstance(iinst);var wi=_inst.GetWorldInfo();tempZOrderList.push([wi.GetLayer().GetIndex(),wi.GetZIndex()]);tempInstances.push(_inst);}}catch(err){_didIteratorError104=true;_iteratorError104=err;}finally{try{if(!_iteratorNormalCompletion104&&_iterator104["return"]!=null){_iterator104["return"]();}}finally{if(_didIteratorError104){throw _iteratorError104;}}}if(tempZOrderList.length===0)return;tempZOrderList.sort(SortZOrderList);tempInstances.sort(function(a,b){return callback(a.GetInterfaceClass(),b.GetInterfaceClass());});var anyChanged=false;for(var i=0,len=tempZOrderList.length;i<len;++i){var inst=tempInstances[i];var layer=layout.GetLayerByIndex(tempZOrderList[i][0]);var toZ=tempZOrderList[i][1];var layerInstances=layer._GetInstances();if(layerInstances[toZ]!==inst){layerInstances[toZ]=inst;inst.GetWorldInfo()._SetLayer(layer,true);layer.SetZIndicesChanged(inst);anyChanged=true;}}if(anyChanged)runtime.UpdateRender();_C64.clearArray(tempZOrderList);_C64.clearArray(tempInstances);}},{key:"createWorker",value:function createWorker(url,opts){var messageChannel,port1,port2;return regeneratorRuntime.async(function createWorker$(_context53){while(1){switch(_context53.prev=_context53.next){case 0:messageChannel=new MessageChannel();port1=messageChannel.port1;port2=messageChannel.port2;_context53.next=5;return regeneratorRuntime.awrap(runtime.PostComponentMessageToDOMAsync("runtime","script-create-worker",{"url":url,"opts":opts,"port2":port2},[port2]));case 5:return _context53.abrupt("return",port1);case 6:case"end":return _context53.stop();}}});}},{key:"alert",value:function alert(message){return runtime.PostComponentMessageToDOMAsync("runtime","alert",{"message":message+(runtime.IsInWorker()?" [via Web Worker]":"")});}},{key:"dt",get:function get(){return runtime.GetDt();}},{key:"dtRaw",get:function get(){return runtime.GetDtRaw();}},{key:"gameTime",get:function get(){return runtime.GetGameTime();}},{key:"wallTime",get:function get(){return runtime.GetWallTime();}},{key:"timeScale",get:function get(){return runtime.GetTimeScale();},set:function set(t){_C3X.RequireFiniteNumber(t);runtime.SetTimeScale(t);}},{key:"fps",get:function get(){return runtime.GetFPS();}},{key:"cpuUtilisation",get:function get(){return runtime.GetMainThreadTime();}},{key:"gpuUtilisation",get:function get(){return runtime.GetGPUUtilisation();}},{key:"layout",get:function get(){var layout=runtime.GetMainRunningLayout();if(!layout)throw new Error("no layout is running - make sure a layout is loaded before accessing");return layout.GetILayout();}},{key:"keyboard",get:function get(){var ret=runtime._GetCommonScriptInterfaces().keyboard;if(!ret)throw new Error("runtime.keyboard used but Keyboard object missing - add it to your project first");return ret;}},{key:"mouse",get:function get(){var ret=runtime._GetCommonScriptInterfaces().mouse;if(!ret)throw new Error("runtime.mouse used but Mouse object missing - add it to your project first");return ret;}},{key:"touch",get:function get(){var ret=runtime._GetCommonScriptInterfaces().touch;if(!ret)throw new Error("runtime.touch used but Touch object missing - add it to your project first");return ret;}}]);return IRuntime;}();}// interfaces/IAssetManager.js
{'use strict';var _C65=self.C3;var _C3X2=self.C3X;var assetManager=null;self.IAssetManager=/*#__PURE__*/function(){function IAssetManager(assetManager_){_classCallCheck(this,IAssetManager);assetManager=assetManager_;Object.defineProperties(this,{isWebMOpusSupported:{value:assetManager.IsAudioFormatSupported("audio/webm; codecs=opus"),writable:false}});}_createClass(IAssetManager,[{key:"fetchText",value:function fetchText(url){return assetManager.FetchText(url);}},{key:"fetchJson",value:function fetchJson(url){return assetManager.FetchJson(url);}},{key:"fetchBlob",value:function fetchBlob(url){return assetManager.FetchBlob(url);}},{key:"fetchArrayBuffer",value:function fetchArrayBuffer(url){return assetManager.FetchArrayBuffer(url);}},{key:"getProjectFileUrl",value:function getProjectFileUrl(url){return assetManager.GetProjectFileUrl(url);}},{key:"getMediaFileUrl",value:function getMediaFileUrl(url){if(assetManager.GetFileStructure()==="flat"&&_C65.IsRelativeURL(url))url=url.toLowerCase();return assetManager.GetMediaFileUrl(url);}},{key:"decodeWebMOpus",value:function decodeWebMOpus(audioContext,arrayBuffer){var decodedArrayBuffer,decodedFloats,audioBuffer,channelBuffer;return regeneratorRuntime.async(function decodeWebMOpus$(_context54){while(1){switch(_context54.prev=_context54.next){case 0:if(!this.isWebMOpusSupported){_context54.next=2;break;}throw new Error("decodeWebMOpus(): not supported because WebM Opus is supported by the platform");case 2:_context54.next=4;return regeneratorRuntime.awrap(assetManager.GetRuntime()._WasmDecodeWebMOpus(arrayBuffer));case 4:decodedArrayBuffer=_context54.sent;decodedFloats=new Float32Array(decodedArrayBuffer);audioBuffer=audioContext["createBuffer"](1,decodedFloats.length,48E3);channelBuffer=audioBuffer["getChannelData"](0);channelBuffer.set(decodedFloats);return _context54.abrupt("return",audioBuffer);case 10:case"end":return _context54.stop();}}},null,this);}},{key:"loadScripts",value:function loadScripts(){var _assetManager;return(_assetManager=assetManager).LoadScripts.apply(_assetManager,arguments);}},{key:"compileWebAssembly",value:function compileWebAssembly(url){return assetManager.CompileWebAssembly(url);}},{key:"loadStyleSheet",value:function loadStyleSheet(url){return assetManager.LoadStyleSheet(url);}},{key:"mediaFolder",get:function get(){return assetManager.GetMediaSubfolder();}}]);return IAssetManager;}();}// interfaces/ICollisionEngine.js
{'use strict';var _C66=self.C3;var _C3X3=self.C3X;var collisionEngine=null;self.ICollisionEngine=/*#__PURE__*/function(){function ICollisionEngine(collisionEngine_){_classCallCheck(this,ICollisionEngine);collisionEngine=collisionEngine_;Object.defineProperties(this,{runtime:{value:collisionEngine.GetRuntime(),writable:false}});}_createClass(ICollisionEngine,[{key:"testOverlap",value:function testOverlap(wi1_,wi2_){var runtime=collisionEngine.GetRuntime();var wi1=runtime._UnwrapIWorldInstance(wi1_);var wi2=runtime._UnwrapIWorldInstance(wi2_);return collisionEngine.TestOverlap(wi1,wi2);}},{key:"testOverlapAny",value:function testOverlapAny(wi1_,iterable){var runtime=collisionEngine.GetRuntime();var wi1=runtime._UnwrapIWorldInstance(wi1_);var _iteratorNormalCompletion105=true;var _didIteratorError105=false;var _iteratorError105=undefined;try{for(var _iterator105=iterable[Symbol.iterator](),_step105;!(_iteratorNormalCompletion105=(_step105=_iterator105.next()).done);_iteratorNormalCompletion105=true){var wi2_=_step105.value;var wi2=runtime._UnwrapIWorldInstance(wi2_);if(collisionEngine.TestOverlap(wi1,wi2))return wi2_;}}catch(err){_didIteratorError105=true;_iteratorError105=err;}finally{try{if(!_iteratorNormalCompletion105&&_iterator105["return"]!=null){_iterator105["return"]();}}finally{if(_didIteratorError105){throw _iteratorError105;}}}return null;}},{key:"testOverlapSolid",value:function testOverlapSolid(wi_){var wi=collisionEngine.GetRuntime()._UnwrapIWorldInstance(wi_);var ret=collisionEngine.TestOverlapSolid(wi);return ret?ret.GetInterfaceClass():null;}},{key:"setCollisionCellSize",value:function setCollisionCellSize(width,height){_C3X3.RequireFiniteNumber(width);_C3X3.RequireFiniteNumber(height);width=Math.floor(width);height=Math.floor(height);if(width<=0||height<=0)throw new Error("invalid cell size");collisionEngine.SetCollisionCellSize(width,height);}},{key:"getCollisionCellSize",value:function getCollisionCellSize(){return collisionEngine.GetCollisionCellSize();}},{key:"getCollisionCandidates",value:function getCollisionCandidates(iObjectClasses,domrect){var runtime=collisionEngine.GetRuntime();var objectClasses;if(Array.isArray(iObjectClasses))objectClasses=iObjectClasses.map(function(ioc){return runtime._UnwrapIObjectClass(ioc);});else objectClasses=[runtime._UnwrapIObjectClass(iObjectClasses)];var bbox=_C66.Rect.FromObject(domrect);var ret=[];collisionEngine.GetObjectClassesCollisionCandidates(null,objectClasses,bbox,ret);return ret.map(function(wi){return wi.GetInterfaceClass();});}}]);return ICollisionEngine;}();}// interfaces/IStorage.js
{'use strict';var _C67=self.C3;var _C3X4=self.C3X;self.IStorage=/*#__PURE__*/function(){function IStorage(runtime){_classCallCheck(this,IStorage);this._storage=runtime._GetProjectStorage();}_createClass(IStorage,[{key:"getItem",value:function getItem(key){_C3X4.RequireString(key);return this._storage.getItem(key);}},{key:"setItem",value:function setItem(key,value){_C3X4.RequireString(key);return this._storage.setItem(key,value);}},{key:"removeItem",value:function removeItem(key){_C3X4.RequireString(key);return this._storage.removeItem(key);}},{key:"clear",value:function clear(){return this._storage.clear();}},{key:"keys",value:function keys(){return this._storage.keys();}}]);return IStorage;}();}// interfaces/IObjectClass.js
{'use strict';var _C68=self.C3;var _C3X5=self.C3X;var map=new WeakMap();self.IObjectClass=/*#__PURE__*/function(){function IObjectClass(objectClass){_classCallCheck(this,IObjectClass);map.set(this,objectClass);Object.defineProperties(this,{name:{value:objectClass.GetName(),writable:false}});objectClass.GetRuntime()._MapScriptInterface(this,objectClass);}_createClass(IObjectClass,[{key:"addEventListener",value:function addEventListener(type,func){_C3X5.RequireString(type);_C3X5.RequireFunction(func);map.get(this).UserScriptDispatcher().addEventListener(type,func);}},{key:"removeEventListener",value:function removeEventListener(type,func){_C3X5.RequireString(type);_C3X5.RequireFunction(func);map.get(this).UserScriptDispatcher().removeEventListener(type,func);}},{key:"getAllInstances",value:function getAllInstances(){return _toConsumableArray(this.instances());}},{key:"getFirstInstance",value:function getFirstInstance(){return _C68.first(this.instances());}},{key:"getPickedInstances",value:function getPickedInstances(){return _toConsumableArray(this.pickedInstances());}},{key:"getFirstPickedInstance",value:function getFirstPickedInstance(){return _C68.first(this.pickedInstances());}},{key:"instances",value:/*#__PURE__*/regeneratorRuntime.mark(function instances(){var _iteratorNormalCompletion106,_didIteratorError106,_iteratorError106,_iterator106,_step106,inst;return regeneratorRuntime.wrap(function instances$(_context55){while(1){switch(_context55.prev=_context55.next){case 0:_iteratorNormalCompletion106=true;_didIteratorError106=false;_iteratorError106=undefined;_context55.prev=3;_iterator106=map.get(this).instancesIncludingPendingCreate()[Symbol.iterator]();case 5:if(_iteratorNormalCompletion106=(_step106=_iterator106.next()).done){_context55.next=12;break;}inst=_step106.value;_context55.next=9;return inst.GetInterfaceClass();case 9:_iteratorNormalCompletion106=true;_context55.next=5;break;case 12:_context55.next=18;break;case 14:_context55.prev=14;_context55.t0=_context55["catch"](3);_didIteratorError106=true;_iteratorError106=_context55.t0;case 18:_context55.prev=18;_context55.prev=19;if(!_iteratorNormalCompletion106&&_iterator106["return"]!=null){_iterator106["return"]();}case 21:_context55.prev=21;if(!_didIteratorError106){_context55.next=24;break;}throw _iteratorError106;case 24:return _context55.finish(21);case 25:return _context55.finish(18);case 26:case"end":return _context55.stop();}}},instances,this,[[3,14,18,26],[19,,21,25]]);})},{key:"pickedInstances",value:/*#__PURE__*/regeneratorRuntime.mark(function pickedInstances(){var _iteratorNormalCompletion107,_didIteratorError107,_iteratorError107,_iterator107,_step107,inst;return regeneratorRuntime.wrap(function pickedInstances$(_context56){while(1){switch(_context56.prev=_context56.next){case 0:_iteratorNormalCompletion107=true;_didIteratorError107=false;_iteratorError107=undefined;_context56.prev=3;_iterator107=map.get(this).GetCurrentSol().GetInstances()[Symbol.iterator]();case 5:if(_iteratorNormalCompletion107=(_step107=_iterator107.next()).done){_context56.next=12;break;}inst=_step107.value;_context56.next=9;return inst.GetInterfaceClass();case 9:_iteratorNormalCompletion107=true;_context56.next=5;break;case 12:_context56.next=18;break;case 14:_context56.prev=14;_context56.t0=_context56["catch"](3);_didIteratorError107=true;_iteratorError107=_context56.t0;case 18:_context56.prev=18;_context56.prev=19;if(!_iteratorNormalCompletion107&&_iterator107["return"]!=null){_iterator107["return"]();}case 21:_context56.prev=21;if(!_didIteratorError107){_context56.next=24;break;}throw _iteratorError107;case 24:return _context56.finish(21);case 25:return _context56.finish(18);case 26:case"end":return _context56.stop();}}},pickedInstances,this,[[3,14,18,26],[19,,21,25]]);})},{key:"setInstanceClass",value:function setInstanceClass(Class){_C3X5.RequireFunction(Class);var objectClass=map.get(this);if(objectClass.GetInstanceCount()>0)throw new Error("setInstanceClass() called too late, because instances have already been created - call in runOnStartup");map.get(this)._SetUserScriptInstanceClass(Class);}},{key:"createInstance",value:function createInstance(layerNameOrIndex,x,y,createHierarchy,template){_C3X5.RequireNumber(x);_C3X5.RequireNumber(y);if(typeof layerNameOrIndex!=="number"&&typeof layerNameOrIndex!=="string")throw new TypeError("invalid layer parameter");var objectClass=map.get(this);var runtime=objectClass.GetRuntime();var layer=runtime.GetMainRunningLayout().GetLayer(layerNameOrIndex);if(!layer)throw new Error("invalid layer");var inst=runtime.CreateInstance(objectClass,layer,x,y,createHierarchy,template);if(createHierarchy)layer.SortAndAddInstancesByZIndex(inst);var eventSheetManager=runtime.GetEventSheetManager();eventSheetManager.BlockFlushingInstances(true);inst._TriggerOnCreatedOnSelfAndRelated();eventSheetManager.BlockFlushingInstances(false);if(!eventSheetManager.IsInEventEngine()&&!runtime.GetLayoutManager().IsEndingLayout())runtime.FlushPendingInstances();return inst.GetInterfaceClass();}}]);return IObjectClass;}();}// interfaces/ILayout.js
{'use strict';var _C69=self.C3;var _C3X6=self.C3X;var _map=new WeakMap();var VALID_WHERE_STRINGS=["above","below","top-sublayer","bottom-sublayer"];self.ILayout=/*#__PURE__*/function(){function ILayout(layout){_classCallCheck(this,ILayout);_map.set(this,layout);var effectInstanceArr=[];var effectList=layout.GetEffectList();var effectCount=effectList.GetAllEffectTypes().length;for(var i=0;i<effectCount;++i){effectInstanceArr.push(new self.IEffectInstance(effectList,i));}Object.defineProperties(this,{name:{value:layout.GetName(),writable:false},index:{value:layout.GetIndex(),writable:false},effects:{value:effectInstanceArr,writable:false}});}_createClass(ILayout,[{key:"addEventListener",value:function addEventListener(type,func){_C3X6.RequireString(type);_C3X6.RequireFunction(func);_map.get(this).UserScriptDispatcher().addEventListener(type,func);}},{key:"removeEventListener",value:function removeEventListener(type,func){_C3X6.RequireString(type);_C3X6.RequireFunction(func);_map.get(this).UserScriptDispatcher().removeEventListener(type,func);}},{key:"setSize",value:function setSize(w,h){_C3X6.RequireFiniteNumber(w);_C3X6.RequireFiniteNumber(h);var layout=_map.get(this);layout.SetWidth(w);layout.SetHeight(h);}},{key:"getSize",value:function getSize(){var layout=_map.get(this);return[layout.GetWidth(),layout.GetHeight()];}},{key:"scrollTo",value:function scrollTo(x,y){_C3X6.RequireNumber(x);_C3X6.RequireNumber(y);var layout=_map.get(this);layout.SetScrollX(x);layout.SetScrollY(y);}},{key:"getScrollPosition",value:function getScrollPosition(){var layout=_map.get(this);return[layout.GetScrollX(),layout.GetScrollY()];}},{key:"getLayer",value:function getLayer(nameOrIndex){var layout=_map.get(this);var layer=null;if(typeof nameOrIndex==="number"||typeof nameOrIndex==="string")layer=layout.GetLayer(nameOrIndex);else throw new TypeError("expected string or number");if(!layer)return null;return layer.GetILayer();}},{key:"getAllLayers",value:function getAllLayers(){return _map.get(this).GetLayers().map(function(layer){return layer.GetILayer();});}},{key:"allLayers",value:/*#__PURE__*/regeneratorRuntime.mark(function allLayers(){var _iteratorNormalCompletion108,_didIteratorError108,_iteratorError108,_iterator108,_step108,layer;return regeneratorRuntime.wrap(function allLayers$(_context57){while(1){switch(_context57.prev=_context57.next){case 0:_iteratorNormalCompletion108=true;_didIteratorError108=false;_iteratorError108=undefined;_context57.prev=3;_iterator108=_map.get(this).allLayers()[Symbol.iterator]();case 5:if(_iteratorNormalCompletion108=(_step108=_iterator108.next()).done){_context57.next=12;break;}layer=_step108.value;_context57.next=9;return layer.GetILayer();case 9:_iteratorNormalCompletion108=true;_context57.next=5;break;case 12:_context57.next=18;break;case 14:_context57.prev=14;_context57.t0=_context57["catch"](3);_didIteratorError108=true;_iteratorError108=_context57.t0;case 18:_context57.prev=18;_context57.prev=19;if(!_iteratorNormalCompletion108&&_iterator108["return"]!=null){_iterator108["return"]();}case 21:_context57.prev=21;if(!_didIteratorError108){_context57.next=24;break;}throw _iteratorError108;case 24:return _context57.finish(21);case 25:return _context57.finish(18);case 26:case"end":return _context57.stop();}}},allLayers,this,[[3,14,18,26],[19,,21,25]]);})},{key:"addLayer",value:function addLayer(layerName,iInsertBy,whereStr){var ILayer=self.ILayer;_C3X6.RequireString(layerName);_C3X6.RequireOptionalInstanceOf(iInsertBy,ILayer);var insertBy=iInsertBy?ILayer._Unwrap(iInsertBy):null;var where=VALID_WHERE_STRINGS.indexOf(whereStr);if(where<0)throw new Error("invalid location");_map.get(this).AddLayer(layerName,insertBy,where);}},{key:"moveLayer",value:function moveLayer(iLayer,iInsertBy,whereStr){var ILayer=self.ILayer;_C3X6.RequireInstanceOf(iLayer,ILayer);var layer=ILayer._Unwrap(iLayer);if(!layer)throw new Error("invalid layer");_C3X6.RequireOptionalInstanceOf(iInsertBy,ILayer);var insertBy=iInsertBy?ILayer._Unwrap(iInsertBy):null;var where=VALID_WHERE_STRINGS.indexOf(whereStr);if(where<0)throw new Error("invalid location");_map.get(this).MoveLayer(layer,insertBy,where);}},{key:"removeLayer",value:function removeLayer(iLayer){var ILayer=self.ILayer;_C3X6.RequireInstanceOf(iLayer,ILayer);var layer=ILayer._Unwrap(iLayer);if(!layer)throw new Error("invalid layer");var runtime=layer.GetRuntime();_map.get(this).RemoveLayer(layer);if(!runtime.GetEventSheetManager().IsInEventEngine())runtime.FlushPendingInstances();}},{key:"removeAllDynamicLayers",value:function removeAllDynamicLayers(){var layout=_map.get(this);var runtime=layout.GetRuntime();layout.RemoveAllDynamicLayers();if(!runtime.GetEventSheetManager().IsInEventEngine())runtime.FlushPendingInstances();}},{key:"setVanishingPoint",value:function setVanishingPoint(vpX,vpY){_C3X6.RequireFiniteNumber(vpX);_C3X6.RequireFiniteNumber(vpY);_map.get(this).SetVanishingPointXY(vpX,vpY);}},{key:"getVanishingPoint",value:function getVanishingPoint(){return _map.get(this)._GetVanishingPoint();}},{key:"width",get:function get(){return _map.get(this).GetWidth();},set:function set(w){_C3X6.RequireFiniteNumber(w);_map.get(this).SetWidth(w);}},{key:"height",get:function get(){return _map.get(this).GetHeight();},set:function set(h){_C3X6.RequireFiniteNumber(h);_map.get(this).SetHeight(h);}},{key:"scale",set:function set(s){_C3X6.RequireFiniteNumber(s);_map.get(this).SetScale(s);},get:function get(){return _map.get(this).GetScale();}},{key:"angle",set:function set(a){_C3X6.RequireFiniteNumber(a);_map.get(this).SetAngle(a);},get:function get(){return _map.get(this).GetAngle();}},{key:"scrollX",set:function set(x){_C3X6.RequireNumber(x);_map.get(this).SetScrollX(x);},get:function get(){return _map.get(this).GetScrollX();}},{key:"scrollY",set:function set(y){_C3X6.RequireNumber(y);_map.get(this).SetScrollY(y);},get:function get(){return _map.get(this).GetScrollY();}},{key:"projection",set:function set(p){_C3X6.RequireString(p);var layout=_map.get(this);if(p==="perspective")layout.SetPerspectiveProjection();else if(p==="orthographic")layout.SetOrthographicProjection();else throw new Error("invalid projection");},get:function get(){if(_map.get(this).IsOrthographicProjection())return"orthographic";else return"perspective";}}]);return ILayout;}();}// interfaces/ILayer.js
{'use strict';var _C70=self.C3;var _C3X7=self.C3X;var _map2=new WeakMap();var BLEND_MODE_TO_INDEX=new Map([["normal",0],["additive",1],["copy",3],["destination-over",4],["source-in",5],["destination-in",6],["source-out",7],["destination-out",8],["source-atop",9],["destination-atop",10]]);var INDEX_TO_BLEND_MODE=new Map(_toConsumableArray(BLEND_MODE_TO_INDEX.entries()).map(function(a){return[a[1],a[0]];}));var _tempColor=_C70.New(_C70.Color);self.ILayer=/*#__PURE__*/function(){function ILayer(layer){_classCallCheck(this,ILayer);_map2.set(this,layer);var effectInstanceArr=[];var effectList=layer.GetEffectList();var effectCount=effectList.GetAllEffectTypes().length;for(var i=0;i<effectCount;++i){effectInstanceArr.push(new self.IEffectInstance(effectList,i));}Object.defineProperties(this,{name:{value:layer.GetName(),writable:false},layout:{value:layer.GetLayout().GetILayout(),writable:false},effects:{value:effectInstanceArr,writable:false}});}_createClass(ILayer,[{key:"parentLayers",value:/*#__PURE__*/regeneratorRuntime.mark(function parentLayers(){var _iteratorNormalCompletion109,_didIteratorError109,_iteratorError109,_iterator109,_step109,parent;return regeneratorRuntime.wrap(function parentLayers$(_context58){while(1){switch(_context58.prev=_context58.next){case 0:_iteratorNormalCompletion109=true;_didIteratorError109=false;_iteratorError109=undefined;_context58.prev=3;_iterator109=_map2.get(this).parentLayers()[Symbol.iterator]();case 5:if(_iteratorNormalCompletion109=(_step109=_iterator109.next()).done){_context58.next=12;break;}parent=_step109.value;_context58.next=9;return parent.GetILayer();case 9:_iteratorNormalCompletion109=true;_context58.next=5;break;case 12:_context58.next=18;break;case 14:_context58.prev=14;_context58.t0=_context58["catch"](3);_didIteratorError109=true;_iteratorError109=_context58.t0;case 18:_context58.prev=18;_context58.prev=19;if(!_iteratorNormalCompletion109&&_iterator109["return"]!=null){_iterator109["return"]();}case 21:_context58.prev=21;if(!_didIteratorError109){_context58.next=24;break;}throw _iteratorError109;case 24:return _context58.finish(21);case 25:return _context58.finish(18);case 26:case"end":return _context58.stop();}}},parentLayers,this,[[3,14,18,26],[19,,21,25]]);})},{key:"subLayers",value:/*#__PURE__*/regeneratorRuntime.mark(function subLayers(){var _iteratorNormalCompletion110,_didIteratorError110,_iteratorError110,_iterator110,_step110,layer;return regeneratorRuntime.wrap(function subLayers$(_context59){while(1){switch(_context59.prev=_context59.next){case 0:_iteratorNormalCompletion110=true;_didIteratorError110=false;_iteratorError110=undefined;_context59.prev=3;_iterator110=_map2.get(this).GetSubLayers()[Symbol.iterator]();case 5:if(_iteratorNormalCompletion110=(_step110=_iterator110.next()).done){_context59.next=12;break;}layer=_step110.value;_context59.next=9;return layer.GetILayer();case 9:_iteratorNormalCompletion110=true;_context59.next=5;break;case 12:_context59.next=18;break;case 14:_context59.prev=14;_context59.t0=_context59["catch"](3);_didIteratorError110=true;_iteratorError110=_context59.t0;case 18:_context59.prev=18;_context59.prev=19;if(!_iteratorNormalCompletion110&&_iterator110["return"]!=null){_iterator110["return"]();}case 21:_context59.prev=21;if(!_didIteratorError110){_context59.next=24;break;}throw _iteratorError110;case 24:return _context59.finish(21);case 25:return _context59.finish(18);case 26:case"end":return _context59.stop();}}},subLayers,this,[[3,14,18,26],[19,,21,25]]);})},{key:"allSubLayers",value:/*#__PURE__*/regeneratorRuntime.mark(function allSubLayers(){var _iteratorNormalCompletion111,_didIteratorError111,_iteratorError111,_iterator111,_step111,subLayer,_iteratorNormalCompletion112,_didIteratorError112,_iteratorError112,_iterator112,_step112,layer;return regeneratorRuntime.wrap(function allSubLayers$(_context60){while(1){switch(_context60.prev=_context60.next){case 0:_iteratorNormalCompletion111=true;_didIteratorError111=false;_iteratorError111=undefined;_context60.prev=3;_iterator111=_map2.get(this).GetSubLayers()[Symbol.iterator]();case 5:if(_iteratorNormalCompletion111=(_step111=_iterator111.next()).done){_context60.next=36;break;}subLayer=_step111.value;_iteratorNormalCompletion112=true;_didIteratorError112=false;_iteratorError112=undefined;_context60.prev=10;_iterator112=subLayer.selfAndAllSubLayers()[Symbol.iterator]();case 12:if(_iteratorNormalCompletion112=(_step112=_iterator112.next()).done){_context60.next=19;break;}layer=_step112.value;_context60.next=16;return layer.GetILayer();case 16:_iteratorNormalCompletion112=true;_context60.next=12;break;case 19:_context60.next=25;break;case 21:_context60.prev=21;_context60.t0=_context60["catch"](10);_didIteratorError112=true;_iteratorError112=_context60.t0;case 25:_context60.prev=25;_context60.prev=26;if(!_iteratorNormalCompletion112&&_iterator112["return"]!=null){_iterator112["return"]();}case 28:_context60.prev=28;if(!_didIteratorError112){_context60.next=31;break;}throw _iteratorError112;case 31:return _context60.finish(28);case 32:return _context60.finish(25);case 33:_iteratorNormalCompletion111=true;_context60.next=5;break;case 36:_context60.next=42;break;case 38:_context60.prev=38;_context60.t1=_context60["catch"](3);_didIteratorError111=true;_iteratorError111=_context60.t1;case 42:_context60.prev=42;_context60.prev=43;if(!_iteratorNormalCompletion111&&_iterator111["return"]!=null){_iterator111["return"]();}case 45:_context60.prev=45;if(!_didIteratorError111){_context60.next=48;break;}throw _iteratorError111;case 48:return _context60.finish(45);case 49:return _context60.finish(42);case 50:case"end":return _context60.stop();}}},allSubLayers,this,[[3,38,42,50],[10,21,25,33],[26,,28,32],[43,,45,49]]);})},{key:"scrollTo",value:function scrollTo(x,y){_C3X7.RequireNumber(x);_C3X7.RequireNumber(y);var layer=_map2.get(this);layer.SetOwnScrollPositionEnabled(true);layer.SetScrollX(x);layer.SetScrollY(y);}},{key:"getScrollPosition",value:function getScrollPosition(){var layer=_map2.get(this);return[layer.GetScrollX(),layer.GetScrollY()];}},{key:"restoreScrollPosition",value:function restoreScrollPosition(){_map2.get(this).SetOwnScrollPositionEnabled(false);}},{key:"getViewport",value:function getViewport(){return _map2.get(this).GetViewport().toDOMRect();}},{key:"cssPxToLayer",value:function cssPxToLayer(clientX,clientY){var z=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;_C3X7.RequireNumber(clientX);_C3X7.RequireNumber(clientY);_C3X7.RequireNumber(z);var layer=_map2.get(this);var runtime=layer.GetRuntime();return layer.CanvasCssToLayer(clientX-runtime.GetCanvasClientX(),clientY-runtime.GetCanvasClientY(),z);}},{key:"layerToCssPx",value:function layerToCssPx(layerX,layerY){var z=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;_C3X7.RequireNumber(layerX);_C3X7.RequireNumber(layerY);_C3X7.RequireNumber(z);var layer=_map2.get(this);var runtime=layer.GetRuntime();var _layer$LayerToCanvasC=layer.LayerToCanvasCss(layerX,layerY,z),_layer$LayerToCanvasC2=_slicedToArray(_layer$LayerToCanvasC,2),clientX=_layer$LayerToCanvasC2[0],clientY=_layer$LayerToCanvasC2[1];return[clientX+runtime.GetCanvasClientX(),clientY+runtime.GetCanvasClientY()];}},{key:"parentLayer",get:function get(){var parent=_map2.get(this).GetParentLayer();return parent?parent.GetILayer():null;}},{key:"index",get:function get(){return _map2.get(this).GetIndex();}},{key:"isVisible",get:function get(){return _map2.get(this)._IsVisibleFlagSet();},set:function set(v){_map2.get(this).SetVisible(v);}},{key:"isSelfAndParentsVisible",get:function get(){return _map2.get(this).IsVisible();}},{key:"isInteractive",get:function get(){return _map2.get(this).IsInteractive();},set:function set(i){_map2.get(this).SetInteractive(i);}},{key:"isHTMLElementsLayer",get:function get(){return _map2.get(this).IsHTMLElementsLayer();},set:function set(i){_map2.get(this).SetIsHTMLElementsLayer(!!i);}},{key:"isSelfAndParentsInteractive",get:function get(){return _map2.get(this).IsSelfAndParentsInteractive();}},{key:"opacity",get:function get(){return _map2.get(this).GetOpacity();},set:function set(o){o=_C70.clamp(+o,0,1);if(isNaN(o))return;_map2.get(this).SetOpacity(o);}},{key:"scale",set:function set(s){_C3X7.RequireFiniteNumber(s);_map2.get(this).SetOwnScale(s);},get:function get(){return _map2.get(this).GetOwnScale();}},{key:"scaleRate",set:function set(r){_C3X7.RequireFiniteNumber(r);_map2.get(this).SetScaleRate(r);},get:function get(){return _map2.get(this).GetScaleRate();}},{key:"angle",set:function set(a){_C3X7.RequireFiniteNumber(a);_map2.get(this).SetAngle(a);},get:function get(){return _map2.get(this).GetOwnAngle();}},{key:"parallaxX",set:function set(p){_C3X7.RequireFiniteNumber(p);_map2.get(this).SetParallaxX(p);},get:function get(){return _map2.get(this).GetParallaxX();}},{key:"parallaxY",set:function set(p){_C3X7.RequireFiniteNumber(p);_map2.get(this).SetParallaxY(p);},get:function get(){return _map2.get(this).GetParallaxY();}},{key:"zElevation",set:function set(z){_C3X7.RequireFiniteNumber(z);_map2.get(this).SetZElevation(z);},get:function get(){return _map2.get(this).GetZElevation();}},{key:"isTransparent",set:function set(t){_map2.get(this).SetTransparent(t);},get:function get(){return _map2.get(this).IsTransparent();}},{key:"isForceOwnTexture",set:function set(f){_map2.get(this).SetForceOwnTexture(f);},get:function get(){return _map2.get(this).IsForceOwnTexture();}},{key:"blendMode",set:function set(bm){_C3X7.RequireString(bm);var index=BLEND_MODE_TO_INDEX.get(bm);if(typeof index!=="number")throw new Error("invalid blend mode");_map2.get(this).SetBlendMode(index);},get:function get(){return INDEX_TO_BLEND_MODE.get(_map2.get(this).GetBlendMode());}},{key:"backgroundColor",set:function set(arr){_C3X7.RequireArray(arr);if(arr.length<3)throw new Error("expected 3 elements");_tempColor.setRgb(arr[0],arr[1],arr[2]);var layer=_map2.get(this);var bgColor=layer.GetBackgroundColor();if(bgColor.equalsIgnoringAlpha(_tempColor))return;bgColor.copyRgb(_tempColor);layer.GetRuntime().UpdateRender();},get:function get(){var c=_map2.get(this).GetBackgroundColor();return[c.getR(),c.getG(),c.getB()];}},{key:"scrollX",set:function set(x){_C3X7.RequireNumber(x);var layer=_map2.get(this);layer.SetOwnScrollPositionEnabled(true);layer.SetScrollX(x);},get:function get(){return _map2.get(this).GetScrollX();}},{key:"scrollY",set:function set(y){_C3X7.RequireNumber(y);var layer=_map2.get(this);layer.SetOwnScrollPositionEnabled(true);layer.SetScrollY(y);},get:function get(){return _map2.get(this).GetScrollY();}}],[{key:"_Unwrap",value:function _Unwrap(ilayer){return _map2.get(ilayer);}}]);return ILayer;}();}// interfaces/IInstance.js
{var GetDispatcher=function GetDispatcher(iinst){var dispatcher=dispatchers.get(iinst);if(dispatcher)return dispatcher;dispatcher=_C71.New(_C71.Event.Dispatcher);dispatchers.set(iinst,dispatcher);return dispatcher;};'use strict';var _C71=self.C3;var _C3X8=self.C3X;var _map3=new WeakMap();var dispatchers=new WeakMap();var initInst=null;self.IInstance=/*#__PURE__*/function(){function IInstance(){_classCallCheck(this,IInstance);_map3.set(this,initInst);var descriptors={runtime:{value:initInst.GetRuntime().GetIRuntime(),writable:false},objectType:{value:initInst.GetObjectClass().GetIObjectClass(),writable:false},uid:{value:initInst.GetUID(),writable:false}};initInst._GetInstVarsScriptDescriptor(descriptors);initInst._GetBehaviorsScriptDescriptor(descriptors);Object.defineProperties(this,descriptors);initInst.GetRuntime()._MapScriptInterface(this,initInst);}_createClass(IInstance,[{key:"_Release",value:function _Release(){var dispatcher=dispatchers.get(this);if(dispatcher){dispatcher.Release();dispatchers["delete"](this);}_map3["delete"](this);}},{key:"addEventListener",value:function addEventListener(type,func,capture){_C3X8.RequireString(type);_C3X8.RequireFunction(func);GetDispatcher(this).addEventListener(type,func,capture);}},{key:"removeEventListener",value:function removeEventListener(type,func,capture){_C3X8.RequireString(type);_C3X8.RequireFunction(func);GetDispatcher(this).removeEventListener(type,func,capture);}},{key:"dispatchEvent",value:function dispatchEvent(e){GetDispatcher(this).dispatchEvent(e);}},{key:"destroy",value:function destroy(){var inst=_map3.get(this);var runtime=inst.GetRuntime();runtime.DestroyInstance(inst);if(!runtime.GetEventSheetManager().IsInEventEngine()&&!runtime.GetLayoutManager().IsEndingLayout()&&!runtime.GetEventSheetManager().IsFlushingBlocked())runtime.FlushPendingInstances();}},{key:"getOtherContainerInstances",value:function getOtherContainerInstances(){var siblings=_map3.get(this).GetSiblings();return siblings?siblings.map(function(s){return s.GetInterfaceClass();}):[];}},{key:"otherContainerInstances",value:/*#__PURE__*/regeneratorRuntime.mark(function otherContainerInstances(){var inst,_iteratorNormalCompletion113,_didIteratorError113,_iteratorError113,_iterator113,_step113,s;return regeneratorRuntime.wrap(function otherContainerInstances$(_context61){while(1){switch(_context61.prev=_context61.next){case 0:inst=_map3.get(this);if(inst.IsInContainer()){_context61.next=3;break;}return _context61.abrupt("return");case 3:_iteratorNormalCompletion113=true;_didIteratorError113=false;_iteratorError113=undefined;_context61.prev=6;_iterator113=inst.siblings()[Symbol.iterator]();case 8:if(_iteratorNormalCompletion113=(_step113=_iterator113.next()).done){_context61.next=15;break;}s=_step113.value;_context61.next=12;return s.GetInterfaceClass();case 12:_iteratorNormalCompletion113=true;_context61.next=8;break;case 15:_context61.next=21;break;case 17:_context61.prev=17;_context61.t0=_context61["catch"](6);_didIteratorError113=true;_iteratorError113=_context61.t0;case 21:_context61.prev=21;_context61.prev=22;if(!_iteratorNormalCompletion113&&_iterator113["return"]!=null){_iterator113["return"]();}case 24:_context61.prev=24;if(!_didIteratorError113){_context61.next=27;break;}throw _iteratorError113;case 27:return _context61.finish(24);case 28:return _context61.finish(21);case 29:case"end":return _context61.stop();}}},otherContainerInstances,this,[[6,17,21,29],[22,,24,28]]);})},{key:"restoreTimeScale",value:function restoreTimeScale(){_map3.get(this).RestoreTimeScale();}},{key:"templateName",get:function get(){return _map3.get(this).GetTemplateName();}},{key:"timeScale",set:function set(t){_C3X8.RequireFiniteNumber(t);_map3.get(this).SetTimeScale(t);},get:function get(){return _map3.get(this).GetActiveTimeScale();}}],[{key:"_Init",value:function _Init(inst){initInst=inst;}},{key:"_GetInitInst",value:function _GetInitInst(){return initInst;}}]);return IInstance;}();}// interfaces/IWorldInstance.js
{'use strict';var _C72=self.C3;var _C3X9=self.C3X;var _IInstance=self.IInstance;var _ILayer=self.ILayer;var _map4=new WeakMap();var _BLEND_MODE_TO_INDEX=new Map([["normal",0],["additive",1],["copy",3],["destination-over",4],["source-in",5],["destination-in",6],["source-out",7],["destination-out",8],["source-atop",9],["destination-atop",10]]);var _INDEX_TO_BLEND_MODE=new Map(_toConsumableArray(_BLEND_MODE_TO_INDEX.entries()).map(function(a){return[a[1],a[0]];}));var _tempColor2=_C72.New(_C72.Color);self.IWorldInstance=/*#__PURE__*/function(_IInstance2){_inherits(IWorldInstance,_IInstance2);function IWorldInstance(){var _this24;_classCallCheck(this,IWorldInstance);_this24=_possibleConstructorReturn(this,_getPrototypeOf(IWorldInstance).call(this));var inst=_IInstance._GetInitInst();_map4.set(_assertThisInitialized(_this24),inst);var effectInstanceArr=[];var wi=inst.GetWorldInfo();var instanceEffectList=wi.GetInstanceEffectList();if(instanceEffectList){var _effectCount=wi.GetObjectClass().GetEffectList().GetAllEffectTypes().length;for(var i=0;i<_effectCount;++i){effectInstanceArr.push(new self.IEffectInstance(instanceEffectList,i));}}var descriptors={effects:{value:effectInstanceArr,writable:false}};Object.defineProperties(_assertThisInitialized(_this24),descriptors);return _this24;}_createClass(IWorldInstance,[{key:"setPosition",value:function setPosition(x,y){x=+x;y=+y;var wi=_map4.get(this).GetWorldInfo();if(isNaN(x)||isNaN(y)||wi.GetX()===x&&wi.GetY()===y)return;wi.SetXY(x,y);wi.SetBboxChanged();}},{key:"getPosition",value:function getPosition(){var wi=_map4.get(this).GetWorldInfo();return[wi.GetX(),wi.GetY()];}},{key:"offsetPosition",value:function offsetPosition(dx,dy){dx=+dx;dy=+dy;if(isNaN(dx)||isNaN(dy)||dx===0&&dy===0)return;var wi=_map4.get(this).GetWorldInfo();wi.OffsetXY(dx,dy);wi.SetBboxChanged();}},{key:"setSize",value:function setSize(w,h){w=+w;h=+h;var wi=_map4.get(this).GetWorldInfo();if(isNaN(w)||isNaN(h)||wi.GetWidth()===w&&wi.GetHeight()===h)return;wi.SetSize(w,h);wi.SetBboxChanged();}},{key:"getSize",value:function getSize(){var wi=_map4.get(this).GetWorldInfo();return[wi.GetWidth(),wi.GetHeight()];}},{key:"getBoundingBox",value:function getBoundingBox(){return _map4.get(this).GetWorldInfo().GetBoundingBox().toDOMRect();}},{key:"getBoundingQuad",value:function getBoundingQuad(){return _map4.get(this).GetWorldInfo().GetBoundingQuad().toDOMQuad();}},{key:"moveToTop",value:function moveToTop(){_map4.get(this).GetWorldInfo().ZOrderMoveToTop();}},{key:"moveToBottom",value:function moveToBottom(){_map4.get(this).GetWorldInfo().ZOrderMoveToBottom();}},{key:"moveToLayer",value:function moveToLayer(ilayer){_C3X9.RequireInstanceOf(ilayer,_ILayer);var layer=_ILayer._Unwrap(ilayer);if(!layer)throw new Error("invalid layer");_map4.get(this).GetWorldInfo().ZOrderMoveToLayer(layer);}},{key:"moveAdjacentToInstance",value:function moveAdjacentToInstance(other,isAfter){_C3X9.RequireInstanceOf(other,IWorldInstance);_map4.get(this).GetWorldInfo().ZOrderMoveAdjacentToInstance(_map4.get(other),isAfter);}},{key:"containsPoint",value:function containsPoint(x,y){_C3X9.RequireNumber(x);_C3X9.RequireNumber(y);return _map4.get(this).GetWorldInfo().ContainsPoint(+x,+y);}},{key:"testOverlap",value:function testOverlap(worldInstance){_C3X9.RequireInstanceOf(worldInstance,IWorldInstance);var a=_map4.get(this);var b=_map4.get(worldInstance);return a.GetRuntime().GetCollisionEngine().TestOverlap(a,b);}},{key:"testOverlapSolid",value:function testOverlapSolid(){var inst=_map4.get(this);var overlapInst=inst.GetRuntime().GetCollisionEngine().TestOverlapSolid(inst);return overlapInst?overlapInst.GetInterfaceClass():null;}},{key:"getParent",value:function getParent(){var parent=_map4.get(this).GetParent();return parent?parent.GetInterfaceClass():null;}},{key:"getTopParent",value:function getTopParent(){var parent=_map4.get(this).GetTopParent();return parent?parent.GetInterfaceClass():null;}},{key:"parents",value:/*#__PURE__*/regeneratorRuntime.mark(function parents(){var _iteratorNormalCompletion114,_didIteratorError114,_iteratorError114,_iterator114,_step114,parent;return regeneratorRuntime.wrap(function parents$(_context62){while(1){switch(_context62.prev=_context62.next){case 0:_iteratorNormalCompletion114=true;_didIteratorError114=false;_iteratorError114=undefined;_context62.prev=3;_iterator114=_map4.get(this).parents()[Symbol.iterator]();case 5:if(_iteratorNormalCompletion114=(_step114=_iterator114.next()).done){_context62.next=12;break;}parent=_step114.value;_context62.next=9;return parent.GetInterfaceClass();case 9:_iteratorNormalCompletion114=true;_context62.next=5;break;case 12:_context62.next=18;break;case 14:_context62.prev=14;_context62.t0=_context62["catch"](3);_didIteratorError114=true;_iteratorError114=_context62.t0;case 18:_context62.prev=18;_context62.prev=19;if(!_iteratorNormalCompletion114&&_iterator114["return"]!=null){_iterator114["return"]();}case 21:_context62.prev=21;if(!_didIteratorError114){_context62.next=24;break;}throw _iteratorError114;case 24:return _context62.finish(21);case 25:return _context62.finish(18);case 26:case"end":return _context62.stop();}}},parents,this,[[3,14,18,26],[19,,21,25]]);})},{key:"getChildCount",value:function getChildCount(){return _map4.get(this).GetChildCount();}},{key:"getChildAt",value:function getChildAt(index){var child=_map4.get(this).GetChildAt(index);return child?child.GetInterfaceClass():null;}},{key:"children",value:/*#__PURE__*/regeneratorRuntime.mark(function children(){var _iteratorNormalCompletion115,_didIteratorError115,_iteratorError115,_iterator115,_step115,child;return regeneratorRuntime.wrap(function children$(_context63){while(1){switch(_context63.prev=_context63.next){case 0:_iteratorNormalCompletion115=true;_didIteratorError115=false;_iteratorError115=undefined;_context63.prev=3;_iterator115=_map4.get(this).children()[Symbol.iterator]();case 5:if(_iteratorNormalCompletion115=(_step115=_iterator115.next()).done){_context63.next=12;break;}child=_step115.value;_context63.next=9;return child.GetInterfaceClass();case 9:_iteratorNormalCompletion115=true;_context63.next=5;break;case 12:_context63.next=18;break;case 14:_context63.prev=14;_context63.t0=_context63["catch"](3);_didIteratorError115=true;_iteratorError115=_context63.t0;case 18:_context63.prev=18;_context63.prev=19;if(!_iteratorNormalCompletion115&&_iterator115["return"]!=null){_iterator115["return"]();}case 21:_context63.prev=21;if(!_didIteratorError115){_context63.next=24;break;}throw _iteratorError115;case 24:return _context63.finish(21);case 25:return _context63.finish(18);case 26:case"end":return _context63.stop();}}},children,this,[[3,14,18,26],[19,,21,25]]);})},{key:"allChildren",value:/*#__PURE__*/regeneratorRuntime.mark(function allChildren(){var _iteratorNormalCompletion116,_didIteratorError116,_iteratorError116,_iterator116,_step116,child;return regeneratorRuntime.wrap(function allChildren$(_context64){while(1){switch(_context64.prev=_context64.next){case 0:_iteratorNormalCompletion116=true;_didIteratorError116=false;_iteratorError116=undefined;_context64.prev=3;_iterator116=_map4.get(this).allChildren()[Symbol.iterator]();case 5:if(_iteratorNormalCompletion116=(_step116=_iterator116.next()).done){_context64.next=12;break;}child=_step116.value;_context64.next=9;return child.GetInterfaceClass();case 9:_iteratorNormalCompletion116=true;_context64.next=5;break;case 12:_context64.next=18;break;case 14:_context64.prev=14;_context64.t0=_context64["catch"](3);_didIteratorError116=true;_iteratorError116=_context64.t0;case 18:_context64.prev=18;_context64.prev=19;if(!_iteratorNormalCompletion116&&_iterator116["return"]!=null){_iterator116["return"]();}case 21:_context64.prev=21;if(!_didIteratorError116){_context64.next=24;break;}throw _iteratorError116;case 24:return _context64.finish(21);case 25:return _context64.finish(18);case 26:case"end":return _context64.stop();}}},allChildren,this,[[3,14,18,26],[19,,21,25]]);})},{key:"addChild",value:function addChild(ichild,opts){_C3X9.RequireInstanceOf(ichild,IWorldInstance);_C3X9.RequireOptionalObject(opts);if(!opts)opts={};var inst=_map4.get(this);var child=_map4.get(ichild);inst.AddChild(child,opts);}},{key:"removeChild",value:function removeChild(ichild){_C3X9.RequireInstanceOf(ichild,IWorldInstance);var inst=_map4.get(this);var child=_map4.get(ichild);inst.RemoveChild(child);}},{key:"removeFromParent",value:function removeFromParent(){var inst=_map4.get(this);if(!inst.HasParent())return;var parent=inst.GetParent();parent.RemoveChild(inst);}},{key:"createMesh",value:function createMesh(hsize,vsize){_C3X9.RequireFiniteNumber(hsize);_C3X9.RequireFiniteNumber(vsize);_map4.get(this).GetWorldInfo().CreateMesh(hsize,vsize);}},{key:"releaseMesh",value:function releaseMesh(){var wi=_map4.get(this).GetWorldInfo();wi.ReleaseMesh();wi.SetBboxChanged();}},{key:"setMeshPoint",value:function setMeshPoint(col,row,opts){_C3X9.RequireFiniteNumber(col);_C3X9.RequireFiniteNumber(row);_C3X9.RequireObject(opts);var wi=_map4.get(this).GetWorldInfo();if(wi.SetMeshPoint(col,row,opts))wi.SetBboxChanged();}},{key:"getMeshSize",value:function getMeshSize(){var wi=_map4.get(this).GetWorldInfo();if(!wi.HasMesh())return[0,0];var sourceMesh=wi.GetSourceMesh();return[sourceMesh.GetHSize(),sourceMesh.GetVSize()];}},{key:"layout",get:function get(){return _map4.get(this).GetWorldInfo().GetLayout().GetILayout();}},{key:"layer",get:function get(){return _map4.get(this).GetWorldInfo().GetLayer().GetILayer();}},{key:"x",get:function get(){return _map4.get(this).GetWorldInfo().GetX();},set:function set(v){v=+v;var wi=_map4.get(this).GetWorldInfo();if(isNaN(v)||wi.GetX()===v)return;wi.SetX(v);wi.SetBboxChanged();}},{key:"y",get:function get(){return _map4.get(this).GetWorldInfo().GetY();},set:function set(v){v=+v;var wi=_map4.get(this).GetWorldInfo();if(isNaN(v)||wi.GetY()===v)return;wi.SetY(v);wi.SetBboxChanged();}},{key:"zElevation",get:function get(){return _map4.get(this).GetWorldInfo().GetZElevation();},set:function set(z){z=+z;var inst=_map4.get(this);var wi=inst.GetWorldInfo();if(isNaN(z)||wi.GetZElevation()===z)return;wi.SetZElevation(z);inst.GetRuntime().UpdateRender();}},{key:"totalZElevation",get:function get(){return _map4.get(this).GetWorldInfo().GetTotalZElevation();}},{key:"width",get:function get(){return _map4.get(this).GetWorldInfo().GetWidth();},set:function set(w){w=+w;var wi=_map4.get(this).GetWorldInfo();if(isNaN(w)||wi.GetWidth()===w)return;wi.SetWidth(w);wi.SetBboxChanged();}},{key:"height",get:function get(){return _map4.get(this).GetWorldInfo().GetHeight();},set:function set(h){h=+h;var wi=_map4.get(this).GetWorldInfo();if(isNaN(h)||wi.GetHeight()===h)return;wi.SetHeight(h);wi.SetBboxChanged();}},{key:"angle",get:function get(){return _map4.get(this).GetWorldInfo().GetAngle();},set:function set(a){a=_C72.clampAngle(+a);var wi=_map4.get(this).GetWorldInfo();if(isNaN(a)||wi.GetAngle()===a)return;wi.SetAngle(a);wi.SetBboxChanged();}},{key:"angleDegrees",get:function get(){return _C72.toDegrees(this.angle);},set:function set(a){this.angle=_C72.toRadians(a);}},{key:"isVisible",get:function get(){return _map4.get(this).GetWorldInfo().IsVisible();},set:function set(v){v=!!v;var inst=_map4.get(this);var wi=inst.GetWorldInfo();if(wi.IsVisible()===v)return;wi.SetVisible(v);inst.GetRuntime().UpdateRender();}},{key:"opacity",get:function get(){return _map4.get(this).GetWorldInfo().GetOpacity();},set:function set(o){o=_C72.clamp(+o,0,1);var inst=_map4.get(this);var wi=inst.GetWorldInfo();if(isNaN(o)||wi.GetOpacity()===o)return;wi.SetOpacity(o);inst.GetRuntime().UpdateRender();}},{key:"colorRgb",set:function set(arr){_C3X9.RequireArray(arr);if(arr.length<3)throw new Error("expected 3 elements");_tempColor2.setRgb(arr[0],arr[1],arr[2]);var inst=_map4.get(this);var wi=inst.GetWorldInfo();if(wi.GetUnpremultipliedColor().equalsIgnoringAlpha(_tempColor2))return;wi.SetUnpremultipliedColor(_tempColor2);inst.GetRuntime().UpdateRender();},get:function get(){var c=_map4.get(this).GetWorldInfo().GetUnpremultipliedColor();return[c.getR(),c.getG(),c.getB()];}},{key:"blendMode",set:function set(bm){_C3X9.RequireString(bm);var index=_BLEND_MODE_TO_INDEX.get(bm);if(typeof index!=="number")throw new Error("invalid blend mode");var inst=_map4.get(this);var wi=inst.GetWorldInfo();wi.SetBlendMode(index);inst.GetRuntime().UpdateRender();},get:function get(){return _INDEX_TO_BLEND_MODE.get(_map4.get(this).GetWorldInfo().GetBlendMode());}},{key:"zIndex",get:function get(){return _map4.get(this).GetWorldInfo().GetZIndex();}},{key:"isCollisionEnabled",get:function get(){return _map4.get(this).GetWorldInfo().IsCollisionEnabled();},set:function set(e){_map4.get(this).GetWorldInfo().SetCollisionEnabled(!!e);}}]);return IWorldInstance;}(_IInstance);}// interfaces/IDOMInstance.js
{'use strict';var _C73=self.C3;var _C3X10=self.C3X;var _map5=new WeakMap();self.IDOMInstance=/*#__PURE__*/function(_self$IWorldInstance){_inherits(IDOMInstance,_self$IWorldInstance);function IDOMInstance(){var _this25;_classCallCheck(this,IDOMInstance);_this25=_possibleConstructorReturn(this,_getPrototypeOf(IDOMInstance).call(this));_map5.set(_assertThisInitialized(_this25),self.IInstance._GetInitInst());return _this25;}_createClass(IDOMInstance,[{key:"getElement",value:function getElement(){return _map5.get(this).GetSdkInstance()._GetElementInDOMMode();}},{key:"focus",value:function focus(){_map5.get(this).GetSdkInstance().FocusElement();}},{key:"blur",value:function blur(){_map5.get(this).GetSdkInstance().BlurElement();}},{key:"setCssStyle",value:function setCssStyle(prop,val){_C3X10.RequireString(prop);_map5.get(this).GetSdkInstance().SetElementCSSStyle(prop,val);}}]);return IDOMInstance;}(self.IWorldInstance);}// interfaces/IBehaviorInstance.js
{var _GetDispatcher=function _GetDispatcher(ibehinst){var dispatcher=_dispatchers.get(ibehinst);if(dispatcher)return dispatcher;dispatcher=_C74.New(_C74.Event.Dispatcher);_dispatchers.set(ibehinst,dispatcher);return dispatcher;};'use strict';var _C74=self.C3;var _C3X11=self.C3X;var _map6=new WeakMap();var _dispatchers=new WeakMap();var initBehInst=null;self.IBehaviorInstance=/*#__PURE__*/function(){function IBehaviorInstance(){_classCallCheck(this,IBehaviorInstance);_map6.set(this,initBehInst);var descriptors={runtime:{value:initBehInst.GetRuntime().GetIRuntime(),writable:false},behavior:{value:initBehInst.GetBehavior().GetIBehavior(),writable:false}};Object.defineProperties(this,descriptors);}_createClass(IBehaviorInstance,[{key:"_Release",value:function _Release(){var dispatcher=_dispatchers.get(this);if(dispatcher){dispatcher.Release();_dispatchers["delete"](this);}_map6["delete"](this);}},{key:"addEventListener",value:function addEventListener(type,func,capture){_C3X11.RequireString(type);_C3X11.RequireFunction(func);_GetDispatcher(this).addEventListener(type,func,capture);}},{key:"removeEventListener",value:function removeEventListener(type,func,capture){_C3X11.RequireString(type);_C3X11.RequireFunction(func);_GetDispatcher(this).removeEventListener(type,func,capture);}},{key:"dispatchEvent",value:function dispatchEvent(e){_GetDispatcher(this).dispatchEvent(e);}},{key:"instance",get:function get(){return _map6.get(this).GetObjectInstance().GetInterfaceClass();}}],[{key:"_Init",value:function _Init(behInst){initBehInst=behInst;}},{key:"_GetInitInst",value:function _GetInitInst(){return initBehInst;}}]);return IBehaviorInstance;}();}// interfaces/IBehavior.js
{'use strict';var _C75=self.C3;var _C3X12=self.C3X;var _map7=new WeakMap();self.IBehavior=/*#__PURE__*/function(){function IBehavior(behavior){_classCallCheck(this,IBehavior);_map7.set(this,behavior);var descriptors={runtime:{value:behavior.GetRuntime().GetIRuntime(),writable:false}};Object.defineProperties(this,descriptors);}_createClass(IBehavior,[{key:"getAllInstances",value:function getAllInstances(){return _map7.get(this).GetInstances().map(function(inst){return inst.GetInterfaceClass();});}}]);return IBehavior;}();}// interfaces/IEffectInstance.js
{'use strict';var _C76=self.C3;var _C3X13=self.C3X;var _map8=new WeakMap();var _tempColor3=_C76.New(_C76.Color);self.IEffectInstance=/*#__PURE__*/function(){function IEffectInstance(effectList,index){_classCallCheck(this,IEffectInstance);_map8.set(this,effectList);var descriptors={index:{value:index,writable:false}};Object.defineProperties(this,descriptors);}_createClass(IEffectInstance,[{key:"setParameter",value:function setParameter(i,v){_C3X13.RequireFiniteNumber(i);i=Math.floor(+i);var fxList=_map8.get(this);var oldValue=fxList.GetEffectParameter(this.index,i);if(oldValue===null)throw new RangeError("invalid index");if(oldValue instanceof _C76.Color){if(!Array.isArray(v)||v.length<3)throw new TypeError("expected array with 3 elements");_tempColor3.setRgb(v[0],v[1],v[2]);v=_tempColor3;}else if(typeof v!=="number")throw new TypeError("expected number");var didChange=fxList.SetEffectParameter(this.index,i,v);if(didChange&&fxList.IsEffectIndexActive(this.index))fxList.GetRuntime().UpdateRender();}},{key:"getParameter",value:function getParameter(i){_C3X13.RequireFiniteNumber(i);i=Math.floor(+i);var fxList=_map8.get(this);var ret=fxList.GetEffectParameter(this.index,i);if(ret===null)throw new RangeError("invalid index");if(ret instanceof _C76.Color)return[ret.getR(),ret.getG(),ret.getB()];else return ret;}},{key:"name",get:function get(){var effectTypes=_map8.get(this).GetAllEffectTypes();return effectTypes[this.index].GetName();}},{key:"isActive",get:function get(){return _map8.get(this).IsEffectIndexActive(this.index);},set:function set(a){a=!!a;var fxList=_map8.get(this);if(fxList.IsEffectIndexActive(this.index)===a)return;fxList.SetEffectIndexActive(this.index,a);fxList.UpdateActiveEffects();fxList.GetRuntime().UpdateRender();}}]);return IEffectInstance;}();}// interfaces/IAnimation.js
{'use strict';var _C77=self.C3;var _C3X14=self.C3X;var _map9=new WeakMap();self.IAnimation=/*#__PURE__*/function(){function IAnimation(animationInfo){_classCallCheck(this,IAnimation);_map9.set(this,animationInfo);Object.defineProperties(this,{name:{value:animationInfo.GetName(),writable:false},speed:{value:animationInfo.GetSpeed(),writable:false},isLooping:{value:animationInfo.IsLooping(),writable:false},repeatCount:{value:animationInfo.GetRepeatCount(),writable:false},repeatTo:{value:animationInfo.GetRepeatTo(),writable:false},isPingPong:{value:animationInfo.IsPingPong(),writable:false},frameCount:{value:animationInfo.GetFrameCount(),writable:false}});}_createClass(IAnimation,[{key:"getFrames",value:function getFrames(){return _map9.get(this).GetFrames().map(function(f){return f.GetIAnimationFrame();});}},{key:"frames",value:/*#__PURE__*/regeneratorRuntime.mark(function frames(){var _iteratorNormalCompletion117,_didIteratorError117,_iteratorError117,_iterator117,_step117,f;return regeneratorRuntime.wrap(function frames$(_context65){while(1){switch(_context65.prev=_context65.next){case 0:_iteratorNormalCompletion117=true;_didIteratorError117=false;_iteratorError117=undefined;_context65.prev=3;_iterator117=_map9.get(this).GetFrames()[Symbol.iterator]();case 5:if(_iteratorNormalCompletion117=(_step117=_iterator117.next()).done){_context65.next=12;break;}f=_step117.value;_context65.next=9;return f.GetIAnimationFrame();case 9:_iteratorNormalCompletion117=true;_context65.next=5;break;case 12:_context65.next=18;break;case 14:_context65.prev=14;_context65.t0=_context65["catch"](3);_didIteratorError117=true;_iteratorError117=_context65.t0;case 18:_context65.prev=18;_context65.prev=19;if(!_iteratorNormalCompletion117&&_iterator117["return"]!=null){_iterator117["return"]();}case 21:_context65.prev=21;if(!_didIteratorError117){_context65.next=24;break;}throw _iteratorError117;case 24:return _context65.finish(21);case 25:return _context65.finish(18);case 26:case"end":return _context65.stop();}}},frames,this,[[3,14,18,26],[19,,21,25]]);})}]);return IAnimation;}();}// interfaces/IImageInfo.js
{'use strict';var _C78=self.C3;var _C3X15=self.C3X;var _map10=new WeakMap();self.IImageInfo=/*#__PURE__*/function(){function IImageInfo(imageInfo){_classCallCheck(this,IImageInfo);_map10.set(this,imageInfo);}_createClass(IImageInfo,[{key:"getSize",value:function getSize(){var imageInfo=_map10.get(this);return[imageInfo.GetWidth(),imageInfo.GetHeight()];}},{key:"width",get:function get(){return _map10.get(this).GetWidth();}},{key:"height",get:function get(){return _map10.get(this).GetHeight();}}]);return IImageInfo;}();}// interfaces/IAnimationFrame.js
{'use strict';var _C79=self.C3;var _C3X16=self.C3X;var _map11=new WeakMap();self.IAnimationFrame=/*#__PURE__*/function(_self$IImageInfo){_inherits(IAnimationFrame,_self$IImageInfo);function IAnimationFrame(animationFrameInfo){var _this26;_classCallCheck(this,IAnimationFrame);_this26=_possibleConstructorReturn(this,_getPrototypeOf(IAnimationFrame).call(this,animationFrameInfo.GetImageInfo()));_map11.set(_assertThisInitialized(_this26),animationFrameInfo);Object.defineProperties(_assertThisInitialized(_this26),{duration:{value:animationFrameInfo.GetDuration(),writable:false},originX:{value:animationFrameInfo.GetOriginX(),writable:false},originY:{value:animationFrameInfo.GetOriginY(),writable:false}});return _this26;}_createClass(IAnimationFrame,[{key:"getOrigin",value:function getOrigin(){var afi=_map11.get(this);return[afi.GetOriginX(),afi.GetOriginY()];}},{key:"getImagePointCount",value:function getImagePointCount(){return _map11.get(this).GetImagePointCount();}},{key:"getImagePointX",value:function getImagePointX(nameOrIndex){return this.getImagePoint(nameOrIndex)[0];}},{key:"getImagePointY",value:function getImagePointY(nameOrIndex){return this.getImagePoint(nameOrIndex)[1];}},{key:"getImagePoint",value:function getImagePoint(nameOrIndex){var afi=_map11.get(this);var ip=null;if(typeof nameOrIndex==="number")ip=afi.GetImagePointByIndex(Math.floor(nameOrIndex));else if(typeof nameOrIndex==="string")ip=afi.GetImagePointByName(nameOrIndex);else throw new TypeError("expected string or number");if(!ip)return this.getOrigin();return[ip.GetX(),ip.GetY()];}},{key:"getPolyPointCount",value:function getPolyPointCount(){var poly=_map11.get(this).GetCollisionPoly();return poly?poly.pointCount():0;}},{key:"getPolyPointX",value:function getPolyPointX(index){return this.getPolyPoint(index)[0];}},{key:"getPolyPointY",value:function getPolyPointY(index){return this.getPolyPoint(index)[1];}},{key:"getPolyPoint",value:function getPolyPoint(index){_C3X16.RequireFiniteNumber(index);index=Math.floor(index);var poly=_map11.get(this).GetCollisionPoly();if(!poly||index<0||index>=poly.pointCount())return[0,0];var pointsArr=poly.pointsArr();var ptX=pointsArr[index*2];var ptY=pointsArr[index*2+1];return[ptX,ptY];}},{key:"tag",get:function get(){return _map11.get(this).GetTag();}}]);return IAnimationFrame;}(self.IImageInfo);}// interfaces/ITimelineState.js
{var GetTimelineState=function GetTimelineState(iface){var timelineState=_map12.get(iface);if(timelineState.IsReleased())throw new Error("timeline/tween was released and is no longer valid");return timelineState;};'use strict';var _C80=self.C3;var _C3X17=self.C3X;var _map12=new WeakMap();self.ITimelineState=/*#__PURE__*/function(){function ITimelineState(timelineState){_classCallCheck(this,ITimelineState);_map12.set(this,timelineState);}_createClass(ITimelineState,[{key:"pause",value:function pause(){GetTimelineState(this).Stop();}},{key:"resume",value:function resume(){GetTimelineState(this).Resume();}},{key:"hasTags",value:function hasTags(tags){return GetTimelineState(this).HasTags(tags);}},{key:"time",set:function set(t){_C3X17.RequireFiniteNumber(t);GetTimelineState(this).SetTime(t);},get:function get(){return GetTimelineState(this).GetTime();}},{key:"totalTime",set:function set(t){_C3X17.RequireFiniteNumber(t);GetTimelineState(this).SetTotalTime(t);},get:function get(){return GetTimelineState(this).GetTotalTime();}},{key:"isLooping",set:function set(l){GetTimelineState(this).SetLoop(!!l);},get:function get(){return GetTimelineState(this).GetLoop();}},{key:"isPingPong",set:function set(p){GetTimelineState(this).SetPingPong(!!p);},get:function get(){return GetTimelineState(this).GetPingPong();}},{key:"playbackRate",set:function set(p){_C3X17.RequireFiniteNumber(p);GetTimelineState(this).SetPlaybackRate(p);},get:function get(){return GetTimelineState(this).GetPlaybackRate();}},{key:"progress",get:function get(){var timelineState=GetTimelineState(this);return timelineState.GetTime()/timelineState.GetTotalTime();}},{key:"tags",get:function get(){return GetTimelineState(this).GetTags();}},{key:"finished",get:function get(){return GetTimelineState(this).GetPlayPromise();}},{key:"isPlaying",get:function get(){return GetTimelineState(this).IsPlaying();}},{key:"isPaused",get:function get(){return GetTimelineState(this).IsPaused();}},{key:"isReleased",get:function get(){return _map12.get(this).IsReleased();}}]);return ITimelineState;}();}// interfaces/ITweenState.js
{var GetTweenState=function GetTweenState(iface){var tweenState=_map13.get(iface);if(tweenState.IsReleased())throw new Error("timeline/tween was released and is no longer valid");return tweenState;};'use strict';var _C81=self.C3;var _C3X18=self.C3X;var _map13=new WeakMap();var behInstMap=new WeakMap();var easeToIndexFunc=null;self.ITweenState=/*#__PURE__*/function(_self$ITimelineState){_inherits(ITweenState,_self$ITimelineState);function ITweenState(tweenState,behInst,opts){var _this27;_classCallCheck(this,ITweenState);_this27=_possibleConstructorReturn(this,_getPrototypeOf(ITweenState).call(this,tweenState));if(!easeToIndexFunc)easeToIndexFunc=opts.easeToIndexFunc;_map13.set(_assertThisInitialized(_this27),tweenState);if(behInst)behInstMap.set(_assertThisInitialized(_this27),behInst);return _this27;}_createClass(ITweenState,[{key:"stop",value:function stop(){var tweenState=GetTweenState(this);var behInst=behInstMap.get(this);behInst.ReleaseTween(tweenState);}},{key:"setEase",value:function setEase(easeName){_C3X18.RequireString(easeName);var ease=self.Ease.GetEaseFromIndex(easeToIndexFunc(easeName));GetTweenState(this).SetEase(ease);}},{key:"instance",get:function get(){var inst=GetTweenState(this).GetInstance();return inst?inst.GetInterfaceClass():null;}},{key:"isDestroyOnComplete",get:function get(){return GetTweenState(this).GetDestroyInstanceOnComplete();},set:function set(d){GetTweenState(this).SetDestroyInstanceOnComplete(!!d);}},{key:"value",get:function get(){var tweenState=GetTweenState(this);if(tweenState.GetId()!=="value")throw new Error("not a value tween");return tweenState.GetPropertyTrack("value").GetSourceAdapterValue();}}]);return ITweenState;}(self.ITimelineState);}// assets/assetManager.js
{var GetTypeFromFileExtension=function GetTypeFromFileExtension(filename){if(!filename)return"";var parts=filename.split(".");if(parts.length<2)return"";var ext=parts.at(-1).toLowerCase();return EXT_TO_TYPE.get(ext)||"";};var AddScript=function AddScript(url){return new Promise(function(resolve,reject){var elem=document.createElement("script");elem.onload=resolve;elem.onerror=reject;elem.async=false;elem.type="module";elem.src=url;document.head.appendChild(elem);});};'use strict';var _C82=self.C3;var VALID_LOAD_POLICIES=new Set(["local","remote"]);var EXT_TO_TYPE=new Map([["mp4","video/mp4"],["webm","video/webm"],["m4a","audio/mp4"],["mp3","audio/mpeg"],["js","application/javascript"],["wasm","application/wasm"],["svg","image/svg+xml"],["html","text/html"]]);_C82.AssetManager=/*#__PURE__*/function(_C82$DefendedBase){_inherits(AssetManager,_C82$DefendedBase);function AssetManager(runtime,opts){var _this28;_classCallCheck(this,AssetManager);_this28=_possibleConstructorReturn(this,_getPrototypeOf(AssetManager).call(this));var exportType=opts["exportType"];_this28._runtime=runtime;_this28._fileStructure="folders";_this28._localUrlBlobs=new Map();_this28._localBlobUrlCache=new Map();_this28._localBlobSWUrls=new Map();_this28._isCordova=exportType==="cordova";_this28._isiOSCordova=!!opts["isiOSCordova"];_this28._isFileProtocol=!!opts["isFileProtocol"];_this28._swClientId=opts["swClientId"];_this28._supportedAudioFormats=opts["supportedAudioFormats"]||{};_this28._audioFiles=new Map();_this28._preloadSounds=false;_this28._mediaSubfolder="";_this28._fontsSubfolder="";_this28._iconsSubfolder="";var isRemoteLoadPolicy=exportType==="html5"||exportType==="scirra-arcade"||exportType==="instant-games";_this28._defaultLoadPolicy=isRemoteLoadPolicy?"remote":"local";_this28._allAssets=[];_this28._assetsByUrl=new Map();_this28._webFonts=[];_this28._loadPromises=[];_this28._hasFinishedInitialLoad=false;_this28._totalAssetSizeToLoad=0;_this28._assetSizeLoaded=0;_this28._lastLoadProgress=0;_this28._hasHadErrorLoading=false;_this28._loadingRateLimiter=_C82.New(_C82.RateLimiter,function(){return _this28._FireLoadingProgressEvent();},50);_this28._localPromiseThrottle=_C82.New(_C82.PromiseThrottle,Math.max(_C82.hardwareConcurrency,8));_this28._remotePromiseThrottle=_C82.New(_C82.PromiseThrottle,20);var localUrlBlobs=opts["previewImageBlobs"];if(localUrlBlobs){var projectFileBlobs=opts["previewProjectFileBlobs"];if(projectFileBlobs)Object.assign(localUrlBlobs,projectFileBlobs);var projectData=opts["projectData"];if(projectData)localUrlBlobs["data.json"]=projectData;for(var _i32=0,_Object$entries5=Object.entries(localUrlBlobs);_i32<_Object$entries5.length;_i32++){var _Object$entries5$_i=_slicedToArray(_Object$entries5[_i32],2),url=_Object$entries5$_i[0],blob=_Object$entries5$_i[1];_this28._localUrlBlobs.set(url,blob);}}var localSWUrlMap=opts["previewProjectFileSWUrls"];if(localSWUrlMap){for(var _i33=0,_Object$entries6=Object.entries(localSWUrlMap);_i33<_Object$entries6.length;_i33++){var _Object$entries6$_i=_slicedToArray(_Object$entries6[_i33],2),srcUrl=_Object$entries6$_i[0],destUrl=_Object$entries6$_i[1];_this28._localBlobSWUrls.set(srcUrl,destUrl);}}_this28._iAssetManager=new self.IAssetManager(_assertThisInitialized(_this28));return _this28;}_createClass(AssetManager,[{key:"Release",value:function Release(){this._localUrlBlobs.clear();var _iteratorNormalCompletion118=true;var _didIteratorError118=false;var _iteratorError118=undefined;try{for(var _iterator118=this._localBlobUrlCache.values()[Symbol.iterator](),_step118;!(_iteratorNormalCompletion118=(_step118=_iterator118.next()).done);_iteratorNormalCompletion118=true){var url=_step118.value;if(url.startsWith("blob:"))URL.revokeObjectURL(url);}}catch(err){_didIteratorError118=true;_iteratorError118=err;}finally{try{if(!_iteratorNormalCompletion118&&_iterator118["return"]!=null){_iterator118["return"]();}}finally{if(_didIteratorError118){throw _iteratorError118;}}}this._localBlobUrlCache.clear();var _iteratorNormalCompletion119=true;var _didIteratorError119=false;var _iteratorError119=undefined;try{for(var _iterator119=this._allAssets[Symbol.iterator](),_step119;!(_iteratorNormalCompletion119=(_step119=_iterator119.next()).done);_iteratorNormalCompletion119=true){var asset=_step119.value;asset.Release();}}catch(err){_didIteratorError119=true;_iteratorError119=err;}finally{try{if(!_iteratorNormalCompletion119&&_iterator119["return"]!=null){_iterator119["return"]();}}finally{if(_didIteratorError119){throw _iteratorError119;}}}_C82.clearArray(this._allAssets);this._assetsByUrl.clear();_C82.clearArray(this._loadPromises);this._runtime=null;}},{key:"GetRuntime",value:function GetRuntime(){return this._runtime;}},{key:"_SetFileStructure",value:function _SetFileStructure(f){this._fileStructure=f;if(f==="flat"){var newMap=new Map();var _iteratorNormalCompletion120=true;var _didIteratorError120=false;var _iteratorError120=undefined;try{for(var _iterator120=this._localUrlBlobs.entries()[Symbol.iterator](),_step120;!(_iteratorNormalCompletion120=(_step120=_iterator120.next()).done);_iteratorNormalCompletion120=true){var _step120$value=_slicedToArray(_step120.value,2),url=_step120$value[0],blob=_step120$value[1];newMap.set(url.toLowerCase(),blob);}}catch(err){_didIteratorError120=true;_iteratorError120=err;}finally{try{if(!_iteratorNormalCompletion120&&_iterator120["return"]!=null){_iterator120["return"]();}}finally{if(_didIteratorError120){throw _iteratorError120;}}}this._localUrlBlobs=newMap;}}},{key:"GetFileStructure",value:function GetFileStructure(){return this._fileStructure;}},{key:"_SetMediaSubfolder",value:function _SetMediaSubfolder(folder){this._mediaSubfolder=folder;}},{key:"GetMediaSubfolder",value:function GetMediaSubfolder(){return this._mediaSubfolder;}},{key:"_SetFontsSubfolder",value:function _SetFontsSubfolder(folder){this._fontsSubfolder=folder;}},{key:"GetFontsSubfolder",value:function GetFontsSubfolder(){return this._fontsSubfolder;}},{key:"_SetIconsSubfolder",value:function _SetIconsSubfolder(folder){this._iconsSubfolder=folder;}},{key:"GetIconsSubfolder",value:function GetIconsSubfolder(){return this._iconsSubfolder;}},{key:"IsFileProtocol",value:function IsFileProtocol(){return this._isFileProtocol;}},{key:"_HasLocalUrlBlob",value:function _HasLocalUrlBlob(url){if(this._fileStructure==="flat")url=url.toLowerCase();return this._localUrlBlobs.has(url);}},{key:"_GetLocalUrlBlob",value:function _GetLocalUrlBlob(url){if(this._fileStructure==="flat")url=url.toLowerCase();return this._localUrlBlobs.get(url)||null;}},{key:"GetLocalUrlAsBlobUrl",value:function GetLocalUrlAsBlobUrl(url){if(this._fileStructure==="flat")url=url.toLowerCase();if(!this._HasLocalUrlBlob(url))return url;var ret=this._localBlobUrlCache.get(url);if(!ret){var blob=this._GetLocalUrlBlob(url);ret=URL.createObjectURL(blob);this._localBlobUrlCache.set(url,ret);}return ret;}},{key:"FetchBlob",value:function FetchBlob(url,loadPolicy){loadPolicy=loadPolicy||this._defaultLoadPolicy;var localBlob=this._GetLocalUrlBlob(url);if(localBlob)return Promise.resolve(localBlob);else if(_C82.IsRelativeURL(url)){if(this._fileStructure==="flat")url=url.toLowerCase();if(this._isCordova&&this._isFileProtocol)return this.CordovaFetchLocalFileAsBlob(url);else if(loadPolicy==="local")return this._localPromiseThrottle.Add(function(){return _C82.FetchBlob(url);});else return this._remotePromiseThrottle.Add(function(){return _C82.FetchBlob(url);});}else return _C82.FetchBlob(url);}},{key:"FetchArrayBuffer",value:function FetchArrayBuffer(url){var localBlob=this._GetLocalUrlBlob(url);if(localBlob)return _C82.BlobToArrayBuffer(localBlob);else if(_C82.IsRelativeURL(url)){if(this._fileStructure==="flat")url=url.toLowerCase();if(this._isCordova&&this._isFileProtocol)return this.CordovaFetchLocalFileAsArrayBuffer(url);else if(this._defaultLoadPolicy==="local")return this._localPromiseThrottle.Add(function(){return _C82.FetchArrayBuffer(url);});else return this._remotePromiseThrottle.Add(function(){return _C82.FetchArrayBuffer(url);});}else return _C82.FetchArrayBuffer(url);}},{key:"FetchText",value:function FetchText(url){var localBlob=this._GetLocalUrlBlob(url);if(localBlob)return _C82.BlobToString(localBlob);else if(_C82.IsRelativeURL(url)){if(this._fileStructure==="flat")url=url.toLowerCase();if(this._isCordova&&this._isFileProtocol)return this.CordovaFetchLocalFileAsText(url);else if(this._defaultLoadPolicy==="local")return this._localPromiseThrottle.Add(function(){return _C82.FetchText(url);});else return this._remotePromiseThrottle.Add(function(){return _C82.FetchText(url);});}else return _C82.FetchText(url);}},{key:"FetchJson",value:function FetchJson(url){var text;return regeneratorRuntime.async(function FetchJson$(_context66){while(1){switch(_context66.prev=_context66.next){case 0:_context66.next=2;return regeneratorRuntime.awrap(this.FetchText(url));case 2:text=_context66.sent;return _context66.abrupt("return",JSON.parse(text));case 4:case"end":return _context66.stop();}}},null,this);}},{key:"_CordovaFetchLocalFileAs",value:function _CordovaFetchLocalFileAs(filename,as_){if(this._fileStructure==="flat")filename=filename.toLowerCase();return this._runtime.PostComponentMessageToDOMAsync("runtime","cordova-fetch-local-file",{"filename":filename,"as":as_});}},{key:"CordovaFetchLocalFileAsText",value:function CordovaFetchLocalFileAsText(filename){return this._CordovaFetchLocalFileAs(filename,"text");}},{key:"CordovaFetchLocalFileAsBlob",value:function CordovaFetchLocalFileAsBlob(filename){var buffer,type;return regeneratorRuntime.async(function CordovaFetchLocalFileAsBlob$(_context67){while(1){switch(_context67.prev=_context67.next){case 0:_context67.next=2;return regeneratorRuntime.awrap(this._CordovaFetchLocalFileAs(filename,"buffer"));case 2:buffer=_context67.sent;type=GetTypeFromFileExtension(filename);return _context67.abrupt("return",new Blob([buffer],{"type":type}));case 5:case"end":return _context67.stop();}}},null,this);}},{key:"CordovaFetchLocalFileAsBlobURL",value:function CordovaFetchLocalFileAsBlobURL(filename){var blobUrl,blob;return regeneratorRuntime.async(function CordovaFetchLocalFileAsBlobURL$(_context68){while(1){switch(_context68.prev=_context68.next){case 0:if(this._fileStructure==="flat")filename=filename.toLowerCase();blobUrl=this._localBlobUrlCache.get(filename);if(!blobUrl){_context68.next=4;break;}return _context68.abrupt("return",blobUrl);case 4:_context68.next=6;return regeneratorRuntime.awrap(this.CordovaFetchLocalFileAsBlob(filename));case 6:blob=_context68.sent;blobUrl=URL.createObjectURL(blob);this._localBlobUrlCache.set(filename,blobUrl);return _context68.abrupt("return",blobUrl);case 10:case"end":return _context68.stop();}}},null,this);}},{key:"CordovaFetchLocalFileAsArrayBuffer",value:function CordovaFetchLocalFileAsArrayBuffer(filename){return this._CordovaFetchLocalFileAs(filename,"buffer");}},{key:"GetMediaFileUrl",value:function GetMediaFileUrl(filename){if(this._fileStructure==="flat")filename=filename.toLowerCase();filename=this._mediaSubfolder+filename;if(this._HasLocalUrlBlob(filename))return this.GetLocalUrlAsBlobUrl(filename);else return filename;}},{key:"GetProjectFileUrl",value:function GetProjectFileUrl(url){if(_C82.IsAbsoluteURL(url))return Promise.resolve(url);else if(this._HasLocalUrlBlob(url))return Promise.resolve(this.GetLocalUrlAsBlobUrl(url));else if(this._isCordova&&this._isFileProtocol)return this.CordovaFetchLocalFileAsBlobURL(url);else{if(this._fileStructure==="flat")url=url.toLowerCase();return Promise.resolve(url);}}},{key:"GetProjectFileIframeUrl",value:function GetProjectFileIframeUrl(url){if(_C82.IsAbsoluteURL(url))return Promise.resolve(url);else{var queryIndex=url.indexOf("?");var queryStr=queryIndex===-1?"":url.substr(queryIndex);var urlNoSearch=queryIndex===-1?url:url.substr(0,queryIndex);if(this._HasLocalUrlBlob(urlNoSearch)){var localUrl=this._localBlobSWUrls.get(urlNoSearch)||this.GetLocalUrlAsBlobUrl(urlNoSearch);if(!localUrl.startsWith("blob:")&&this._swClientId){var asUrl=new URL(localUrl);var params=new URLSearchParams(queryStr);params.set("__c3_client_id",this._swClientId);asUrl.search=params.toString();localUrl=asUrl.toString();}return Promise.resolve(localUrl);}else if(this._isCordova&&this._isFileProtocol)return this.CordovaFetchLocalFileAsBlobURL(urlNoSearch);else{if(this._fileStructure==="flat")url=url.toLowerCase();return Promise.resolve(url);}}}},{key:"LoadProjectFileUrl",value:function LoadProjectFileUrl(url){return this.GetProjectFileUrl(url);}},{key:"LoadImage",value:function LoadImage(opts){var _this29=this;if(opts.loadPolicy&&!VALID_LOAD_POLICIES.has(opts.loadPolicy))throw new Error("invalid load policy");var asset=this._assetsByUrl.get(opts.url);if(asset)return asset;asset=_C82.New(_C82.ImageAsset,this,{url:opts.url,size:opts.size||0,loadPolicy:opts.loadPolicy||this._defaultLoadPolicy});this._allAssets.push(asset);this._assetsByUrl.set(asset.GetURL(),asset);if(!this._hasFinishedInitialLoad){this._totalAssetSizeToLoad+=asset.GetSize();this._loadPromises.push(asset.Load().then(function(){return _this29._AddLoadedSize(asset.GetSize());}));}return asset;}},{key:"WaitForAllToLoad",value:function WaitForAllToLoad(){return regeneratorRuntime.async(function WaitForAllToLoad$(_context69){while(1){switch(_context69.prev=_context69.next){case 0:_context69.prev=0;_context69.next=3;return regeneratorRuntime.awrap(Promise.all(this._loadPromises));case 3:this._lastLoadProgress=1;_context69.next=11;break;case 6:_context69.prev=6;_context69.t0=_context69["catch"](0);console.error("Error loading: ",_context69.t0);this._hasHadErrorLoading=true;this._FireLoadingProgressEvent();case 11:case"end":return _context69.stop();}}},null,this,[[0,6]]);}},{key:"SetInitialLoadFinished",value:function SetInitialLoadFinished(){this._hasFinishedInitialLoad=true;}},{key:"HasHadErrorLoading",value:function HasHadErrorLoading(){return this._hasHadErrorLoading;}},{key:"_AddLoadedSize",value:function _AddLoadedSize(s){this._assetSizeLoaded+=s;this._loadingRateLimiter.Call();}},{key:"_FireLoadingProgressEvent",value:function _FireLoadingProgressEvent(){var event=_C82.New(_C82.Event,"loadingprogress");this._lastLoadProgress=_C82.clamp(this._assetSizeLoaded/this._totalAssetSizeToLoad,0,1);event.progress=this._lastLoadProgress;this._runtime.Dispatcher().dispatchEvent(event);}},{key:"GetLoadProgress",value:function GetLoadProgress(){return this._lastLoadProgress;}},{key:"_SetWebFonts",value:function _SetWebFonts(arr){_C82.shallowAssignArray(this._webFonts,arr);if(this._webFonts.length)this._loadPromises.push(this._LoadWebFonts());}},{key:"_LoadWebFonts",value:function _LoadWebFonts(){var _this30=this;var promises,loadFontsForDOM,_iteratorNormalCompletion121,_didIteratorError121,_iteratorError121,_loop6,_iterator121,_step121;return regeneratorRuntime.async(function _LoadWebFonts$(_context70){while(1){switch(_context70.prev=_context70.next){case 0:promises=[];loadFontsForDOM=[];_iteratorNormalCompletion121=true;_didIteratorError121=false;_iteratorError121=undefined;_context70.prev=5;_loop6=function _loop6(){var _step121$value=_slicedToArray(_step121.value,3),name=_step121$value[0],filename=_step121$value[1],size=_step121$value[2];_this30._totalAssetSizeToLoad+=size;promises.push(_this30._LoadWebFont(name,filename,loadFontsForDOM).then(function(){return _this30._AddLoadedSize(size);}));};for(_iterator121=this._webFonts[Symbol.iterator]();!(_iteratorNormalCompletion121=(_step121=_iterator121.next()).done);_iteratorNormalCompletion121=true){_loop6();}_context70.next=14;break;case 10:_context70.prev=10;_context70.t0=_context70["catch"](5);_didIteratorError121=true;_iteratorError121=_context70.t0;case 14:_context70.prev=14;_context70.prev=15;if(!_iteratorNormalCompletion121&&_iterator121["return"]!=null){_iterator121["return"]();}case 17:_context70.prev=17;if(!_didIteratorError121){_context70.next=20;break;}throw _iteratorError121;case 20:return _context70.finish(17);case 21:return _context70.finish(14);case 22:_context70.next=24;return regeneratorRuntime.awrap(Promise.all(promises));case 24:if(!(this._runtime.IsInWorker()&&loadFontsForDOM.length>0)){_context70.next=27;break;}_context70.next=27;return regeneratorRuntime.awrap(this._runtime.PostComponentMessageToDOMAsync("runtime","load-webfonts",{"webfonts":loadFontsForDOM}));case 27:case"end":return _context70.stop();}}},null,this,[[5,10,14,22],[15,,17,21]]);}},{key:"_LoadWebFont",value:function _LoadWebFont(name,filename,loadFontsForDOM){var url,fontFace;return regeneratorRuntime.async(function _LoadWebFont$(_context71){while(1){switch(_context71.prev=_context71.next){case 0:_context71.prev=0;_context71.next=3;return regeneratorRuntime.awrap(this.GetProjectFileUrl(filename));case 3:url=_context71.sent;fontFace=new FontFace(name,"url('".concat(url,"')"));if(this._runtime.IsInWorker())self.fonts.add(fontFace);else document.fonts.add(fontFace);_context71.next=8;return regeneratorRuntime.awrap(fontFace.load());case 8:if(this._runtime.IsInWorker())loadFontsForDOM.push({name:name,url:url});_context71.next=14;break;case 11:_context71.prev=11;_context71.t0=_context71["catch"](0);console.warn("[C3 runtime] Failed to load web font '".concat(name,"': "),_context71.t0);case 14:case"end":return _context71.stop();}}},null,this,[[0,11]]);}},{key:"IsAudioFormatSupported",value:function IsAudioFormatSupported(type){return!!this._supportedAudioFormats[type];}},{key:"_SetAudioFiles",value:function _SetAudioFiles(arr,preloadSounds){var _this31=this;this._preloadSounds=!!preloadSounds;var _iteratorNormalCompletion122=true;var _didIteratorError122=false;var _iteratorError122=undefined;try{var _loop7=function _loop7(){var _step122$value=_slicedToArray(_step122.value,3),fileName=_step122$value[0],projectFilesInfo=_step122$value[1],isMusic=_step122$value[2];_this31._audioFiles.set(fileName,{fileName:fileName,formats:projectFilesInfo.map(function(si){return{type:si[0],fileExtension:si[1],fullName:fileName+si[1],fileSize:si[2]};}),isMusic:isMusic});};for(var _iterator122=arr[Symbol.iterator](),_step122;!(_iteratorNormalCompletion122=(_step122=_iterator122.next()).done);_iteratorNormalCompletion122=true){_loop7();}}catch(err){_didIteratorError122=true;_iteratorError122=err;}finally{try{if(!_iteratorNormalCompletion122&&_iterator122["return"]!=null){_iterator122["return"]();}}finally{if(_didIteratorError122){throw _iteratorError122;}}}}},{key:"GetPreferredAudioFile",value:function GetPreferredAudioFile(namePart){if(this._fileStructure==="flat")namePart=namePart.toLowerCase();var info=this._audioFiles.get(namePart);if(!info)return null;var webMOpusFile=null;var _iteratorNormalCompletion123=true;var _didIteratorError123=false;var _iteratorError123=undefined;try{for(var _iterator123=info.formats[Symbol.iterator](),_step123;!(_iteratorNormalCompletion123=(_step123=_iterator123.next()).done);_iteratorNormalCompletion123=true){var formatInfo=_step123.value;if(!webMOpusFile&&formatInfo.type==="audio/webm; codecs=opus")webMOpusFile=formatInfo;if(this.IsAudioFormatSupported(formatInfo.type))return formatInfo;}}catch(err){_didIteratorError123=true;_iteratorError123=err;}finally{try{if(!_iteratorNormalCompletion123&&_iterator123["return"]!=null){_iterator123["return"]();}}finally{if(_didIteratorError123){throw _iteratorError123;}}}return webMOpusFile;}},{key:"GetProjectAudioFileUrl",value:function GetProjectAudioFileUrl(namePart){var formatInfo=this.GetPreferredAudioFile(namePart);if(!formatInfo)return null;return{url:this.GetMediaFileUrl(formatInfo.fullName),type:formatInfo.type};}},{key:"GetAudioToPreload",value:function GetAudioToPreload(){if(this._preloadSounds){var ret=[];var _iteratorNormalCompletion124=true;var _didIteratorError124=false;var _iteratorError124=undefined;try{for(var _iterator124=this._audioFiles.values()[Symbol.iterator](),_step124;!(_iteratorNormalCompletion124=(_step124=_iterator124.next()).done);_iteratorNormalCompletion124=true){var info=_step124.value;if(info.isMusic)continue;var formatInfo=this.GetPreferredAudioFile(info.fileName);if(!formatInfo)continue;ret.push({originalUrl:info.fileName,url:this.GetMediaFileUrl(formatInfo.fullName),type:formatInfo.type,fileSize:formatInfo.fileSize});}}catch(err){_didIteratorError124=true;_iteratorError124=err;}finally{try{if(!_iteratorNormalCompletion124&&_iterator124["return"]!=null){_iterator124["return"]();}}finally{if(_didIteratorError124){throw _iteratorError124;}}}return ret;}else return[];}},{key:"GetIAssetManager",value:function GetIAssetManager(){return this._iAssetManager;}},{key:"LoadScripts",value:function LoadScripts(){var _this32=this;var _len33,urls,_key26,scriptUrls,url,scriptStr,blobUrl,_args83=arguments;return regeneratorRuntime.async(function LoadScripts$(_context72){while(1){switch(_context72.prev=_context72.next){case 0:for(_len33=_args83.length,urls=new Array(_len33),_key26=0;_key26<_len33;_key26++){urls[_key26]=_args83[_key26];}_context72.next=3;return regeneratorRuntime.awrap(Promise.all(urls.map(function(url){return _this32.GetProjectFileUrl(url);})));case 3:scriptUrls=_context72.sent;if(!this._runtime.IsInWorker()){_context72.next=17;break;}if(!(urls.length===1)){_context72.next=11;break;}url=urls[0];_context72.next=9;return regeneratorRuntime.awrap(self.c3_import((_C82.IsRelativeURL(url)?"./":"")+url));case 9:_context72.next=15;break;case 11:scriptStr=urls.map(function(url){return"import \"".concat(_C82.IsRelativeURL(url)?"./":"").concat(url,"\";");}).join("\n");blobUrl=URL.createObjectURL(new Blob([scriptStr],{type:"application/javascript"}));_context72.next=15;return regeneratorRuntime.awrap(self.c3_import(blobUrl));case 15:_context72.next=19;break;case 17:_context72.next=19;return regeneratorRuntime.awrap(Promise.all(scriptUrls.map(function(url){return AddScript(url);})));case 19:case"end":return _context72.stop();}}},null,this);}},{key:"CompileWebAssembly",value:function CompileWebAssembly(url){var fetchUrl,arrayBuffer;return regeneratorRuntime.async(function CompileWebAssembly$(_context73){while(1){switch(_context73.prev=_context73.next){case 0:if(!WebAssembly.compileStreaming){_context73.next=9;break;}_context73.next=3;return regeneratorRuntime.awrap(this.GetProjectFileUrl(url));case 3:fetchUrl=_context73.sent;_context73.next=6;return regeneratorRuntime.awrap(WebAssembly.compileStreaming(fetch(fetchUrl)));case 6:return _context73.abrupt("return",_context73.sent);case 9:_context73.next=11;return regeneratorRuntime.awrap(_C82.FetchArrayBuffer(url));case 11:arrayBuffer=_context73.sent;_context73.next=14;return regeneratorRuntime.awrap(WebAssembly.compile(arrayBuffer));case 14:return _context73.abrupt("return",_context73.sent);case 15:case"end":return _context73.stop();}}},null,this);}},{key:"LoadStyleSheet",value:function LoadStyleSheet(url){var fetchUrl;return regeneratorRuntime.async(function LoadStyleSheet$(_context74){while(1){switch(_context74.prev=_context74.next){case 0:_context74.next=2;return regeneratorRuntime.awrap(this.GetProjectFileUrl(url));case 2:fetchUrl=_context74.sent;_context74.next=5;return regeneratorRuntime.awrap(this._runtime.PostComponentMessageToDOMAsync("runtime","add-stylesheet",{"url":fetchUrl}));case 5:return _context74.abrupt("return",_context74.sent);case 6:case"end":return _context74.stop();}}},null,this);}}]);return AssetManager;}(_C82.DefendedBase);}// assets/asset.js
{'use strict';var _C83=self.C3;_C83.Asset=/*#__PURE__*/function(_C83$DefendedBase){_inherits(Asset,_C83$DefendedBase);function Asset(assetManager,opts){var _this33;_classCallCheck(this,Asset);_this33=_possibleConstructorReturn(this,_getPrototypeOf(Asset).call(this));_this33._assetManager=assetManager;_this33._runtime=assetManager.GetRuntime();_this33._url=opts.url||"";_this33._size=opts.size;_this33._loadPolicy=opts.loadPolicy;_this33._blob=opts.blob||null;_this33._isLoaded=!!_this33._blob;_this33._loadPromise=null;return _this33;}_createClass(Asset,[{key:"Release",value:function Release(){this._loadPromise=null;this._assetManager=null;this._runtime=null;this._blob=null;}},{key:"GetURL",value:function GetURL(){return this._url;}},{key:"GetSize",value:function GetSize(){return this._size;}},{key:"Load",value:function Load(){var _this34=this;if(this._loadPolicy==="local"||this._blob){this._isLoaded=true;return Promise.resolve();}if(this._loadPromise)return this._loadPromise;this._loadPromise=this._assetManager.FetchBlob(this._url,this._loadPolicy).then(function(blob){_this34._isLoaded=true;_this34._loadPromise=null;_this34._blob=blob;return blob;})["catch"](function(err){console.error("Error loading resource: ",err);_this34._loadPromise=null;});return this._loadPromise;}},{key:"IsLoaded",value:function IsLoaded(){return this._isLoaded;}},{key:"GetBlob",value:function GetBlob(){if(this._blob)return Promise.resolve(this._blob);if(this._loadPromise)return this._loadPromise;return this._assetManager.FetchBlob(this._url,this._loadPolicy);}}]);return Asset;}(_C83.DefendedBase);}// assets/imageAsset.js
{'use strict';var _C84=self.C3;var promiseThrottle=new _C84.PromiseThrottle();var allImageAssets=new Set();_C84.ImageAsset=/*#__PURE__*/function(_C84$Asset){_inherits(ImageAsset,_C84$Asset);function ImageAsset(assetManager,opts){var _this35;_classCallCheck(this,ImageAsset);_this35=_possibleConstructorReturn(this,_getPrototypeOf(ImageAsset).call(this,assetManager,opts));_this35._texturePromise=null;_this35._webglTexture=null;_this35._refCount=0;_this35._imageWidth=-1;_this35._imageHeight=-1;allImageAssets.add(_assertThisInitialized(_this35));return _this35;}_createClass(ImageAsset,[{key:"Release",value:function Release(){this.ReleaseTexture();if(this._refCount!==0)throw new Error("released image asset which still has texture references");this._texturePromise=null;allImageAssets["delete"](this);_get(_getPrototypeOf(ImageAsset.prototype),"Release",this).call(this);}},{key:"LoadStaticTexture",value:function LoadStaticTexture(renderer,opts){var _this36=this;opts=opts||{};this._refCount++;if(this._webglTexture)return Promise.resolve(this._webglTexture);if(this._texturePromise)return this._texturePromise;opts.anisotropy=this._runtime.GetCanvasManager().GetTextureAnisotropy();this._texturePromise=this.GetBlob().then(function(blob){return promiseThrottle.Add(function(){return renderer.CreateStaticTextureAsync(blob,opts).then(function(texture){_this36._texturePromise=null;if(_this36._refCount===0){renderer.DeleteTexture(texture);return null;}_this36._webglTexture=texture;_this36._imageWidth=texture.GetWidth();_this36._imageHeight=texture.GetHeight();return _this36._webglTexture;});});})["catch"](function(err){console.error("Failed to load texture: ",err);throw err;});return this._texturePromise;}},{key:"ReleaseTexture",value:function ReleaseTexture(){if(this._refCount<=0)throw new Error("texture released too many times");this._refCount--;if(this._refCount===0&&this._webglTexture){var renderer=this._webglTexture.GetRenderer();renderer.DeleteTexture(this._webglTexture);this._webglTexture=null;}}},{key:"GetTexture",value:function GetTexture(){return this._webglTexture;}},{key:"GetWidth",value:function GetWidth(){return this._imageWidth;}},{key:"GetHeight",value:function GetHeight(){return this._imageHeight;}},{key:"LoadToDrawable",value:function LoadToDrawable(){var blob;return regeneratorRuntime.async(function LoadToDrawable$(_context75){while(1){switch(_context75.prev=_context75.next){case 0:_context75.next=2;return regeneratorRuntime.awrap(this.GetBlob());case 2:blob=_context75.sent;if(!_C84.Supports.ImageBitmap){_context75.next=9;break;}_context75.next=6;return regeneratorRuntime.awrap(createImageBitmap(blob));case 6:return _context75.abrupt("return",_context75.sent);case 9:_context75.next=11;return regeneratorRuntime.awrap(_C84.BlobToImage(blob));case 11:return _context75.abrupt("return",_context75.sent);case 12:case"end":return _context75.stop();}}},null,this);}}],[{key:"OnRendererContextLost",value:function OnRendererContextLost(){var _iteratorNormalCompletion125=true;var _didIteratorError125=false;var _iteratorError125=undefined;try{for(var _iterator125=allImageAssets[Symbol.iterator](),_step125;!(_iteratorNormalCompletion125=(_step125=_iterator125.next()).done);_iteratorNormalCompletion125=true){var imageAsset=_step125.value;imageAsset._texturePromise=null;imageAsset._webglTexture=null;imageAsset._refCount=0;}}catch(err){_didIteratorError125=true;_iteratorError125=err;}finally{try{if(!_iteratorNormalCompletion125&&_iterator125["return"]!=null){_iterator125["return"]();}}finally{if(_didIteratorError125){throw _iteratorError125;}}}}}]);return ImageAsset;}(_C84.Asset);}// layouts/renderCell.js
{var SortByInstLastCachedZIndex=function SortByInstLastCachedZIndex(a,b){return a.GetWorldInfo()._GetLastCachedZIndex()-b.GetWorldInfo()._GetLastCachedZIndex();};'use strict';var _C85=self.C3;var _assert6=self.assert;_C85.RenderCell=/*#__PURE__*/function(_C85$DefendedBase){_inherits(RenderCell,_C85$DefendedBase);function RenderCell(grid,x,y){var _this37;_classCallCheck(this,RenderCell);_this37=_possibleConstructorReturn(this,_getPrototypeOf(RenderCell).call(this));_this37._grid=grid;_this37._x=x;_this37._y=y;_this37._instances=[];_this37._isSorted=true;_this37._pendingRemoval=new Set();_this37._isAnyPendingRemoval=false;return _this37;}_createClass(RenderCell,[{key:"Release",value:function Release(){_C85.clearArray(this._instances);this._pendingRemoval.clear();this._grid=null;}},{key:"Reset",value:function Reset(){_C85.clearArray(this._instances);this._isSorted=true;this._pendingRemoval.clear();this._isAnyPendingRemoval=false;}},{key:"SetChanged",value:function SetChanged(){this._isSorted=false;}},{key:"IsEmpty",value:function IsEmpty(){if(!this._instances.length)return true;if(this._instances.length>this._pendingRemoval.size)return false;this._FlushPending();return true;}},{key:"Insert",value:function Insert(inst){if(this._pendingRemoval.has(inst)){this._pendingRemoval["delete"](inst);if(this._pendingRemoval.size===0)this._isAnyPendingRemoval=false;return;}this._instances.push(inst);this._isSorted=this._instances.length===1;}},{key:"Remove",value:function Remove(inst){this._pendingRemoval.add(inst);this._isAnyPendingRemoval=true;if(this._pendingRemoval.size>=50)this._FlushPending();}},{key:"_FlushPending",value:function _FlushPending(){if(!this._isAnyPendingRemoval)return;if(this._instances.length===this._pendingRemoval.size){this.Reset();return;}_C85.arrayRemoveAllInSet(this._instances,this._pendingRemoval);this._pendingRemoval.clear();this._isAnyPendingRemoval=false;}},{key:"_EnsureSorted",value:function _EnsureSorted(){if(this._isSorted)return;this._instances.sort(SortByInstLastCachedZIndex);this._isSorted=true;}},{key:"Dump",value:function Dump(result){this._FlushPending();this._EnsureSorted();if(this._instances.length)result.push(this._instances);}}]);return RenderCell;}(_C85.DefendedBase);}// layouts/renderGrid.js
{'use strict';var _C86=self.C3;_C86.RenderGrid=/*#__PURE__*/function(_C86$DefendedBase){_inherits(RenderGrid,_C86$DefendedBase);function RenderGrid(cellWidth,cellHeight){var _this38;_classCallCheck(this,RenderGrid);_this38=_possibleConstructorReturn(this,_getPrototypeOf(RenderGrid).call(this));_this38._cellWidth=cellWidth;_this38._cellHeight=cellHeight;_this38._cells=_C86.New(_C86.PairMap);return _this38;}_createClass(RenderGrid,[{key:"Release",value:function Release(){this._cells.Release();this._cells=null;}},{key:"GetCell",value:function GetCell(x,y,createIfMissing){var ret=this._cells.Get(x,y);if(ret)return ret;else if(createIfMissing){ret=_C86.New(_C86.RenderCell,this,x,y);this._cells.Set(x,y,ret);return ret;}else return null;}},{key:"XToCell",value:function XToCell(x){return Math.floor(x/this._cellWidth);}},{key:"YToCell",value:function YToCell(y){return Math.floor(y/this._cellHeight);}},{key:"Update",value:function Update(inst,oldRange,newRange){if(oldRange)for(var x=oldRange.getLeft(),lenx=oldRange.getRight();x<=lenx;++x){for(var y=oldRange.getTop(),leny=oldRange.getBottom();y<=leny;++y){if(newRange&&newRange.containsPoint(x,y))continue;var cell=this.GetCell(x,y,false);if(!cell)continue;cell.Remove(inst);if(cell.IsEmpty())this._cells.Delete(x,y);}}if(newRange)for(var _x2=newRange.getLeft(),_lenx=newRange.getRight();_x2<=_lenx;++_x2){for(var _y=newRange.getTop(),_leny=newRange.getBottom();_y<=_leny;++_y){if(oldRange&&oldRange.containsPoint(_x2,_y))continue;this.GetCell(_x2,_y,true).Insert(inst);}}}},{key:"QueryRange",value:function QueryRange(rc,result){var x=this.XToCell(rc.getLeft());var ystart=this.YToCell(rc.getTop());var lenx=this.XToCell(rc.getRight());var leny=this.YToCell(rc.getBottom());for(;x<=lenx;++x){for(var y=ystart;y<=leny;++y){var cell=this.GetCell(x,y,false);if(!cell)continue;cell.Dump(result);}}}},{key:"MarkRangeChanged",value:function MarkRangeChanged(rc){var x=rc.getLeft();var ystart=rc.getTop();var lenx=rc.getRight();var leny=rc.getBottom();for(;x<=lenx;++x){for(var y=ystart;y<=leny;++y){var cell=this.GetCell(x,y,false);if(!cell)continue;cell.SetChanged();}}}}]);return RenderGrid;}(_C86.DefendedBase);}// layouts/layer.js
{var _SortByInstLastCachedZIndex=function _SortByInstLastCachedZIndex(a,b){return a.GetWorldInfo()._GetLastCachedZIndex()-b.GetWorldInfo()._GetLastCachedZIndex();};var SortByInstZElevation=function SortByInstZElevation(a,b){return a.GetWorldInfo().GetZElevation()-b.GetWorldInfo().GetZElevation();};'use strict';var _C87=self.C3;var _assert7=self.assert;var _tmpRect2=new _C87.Rect();var _tmpQuad2=new _C87.Quad();var renderCellArr=[];var tmpDestRect=new _C87.Rect();var tmpSrcRect=new _C87.Rect();var _glMatrix8=self.glMatrix;var _vec8=_glMatrix8.vec3;var _vec9=_glMatrix8.vec4;var _mat8=_glMatrix8.mat4;var _tempMat2=_mat8.create();var tempVec3=_vec8.create();var _tempVec=_vec9.create();var camVector=_vec8.create();var lookVector=_vec8.create();var upVector=_vec8.create();var tempVec2=_C87.New(_C87.Vector2);var _tempRect3=_C87.New(_C87.Rect);var tempInstanceList1=[];var tempInstanceList2=[];var tempInstancesByCameraDist=[];var DEFAULT_LAYER_OPTIONS={name:"",sid:-1,isDynamic:false,isVisible:true,isInteractive:true,isHTMLElementsLayer:false,backgroundColor:[1,1,1,1],isTransparent:true,parallax:[1,1],opacity:1,isForceOwnTexture:false,renderAs3d:false,useCameraDistanceDrawOrder:false,useRenderCells:false,scaleRate:1,blendMode:0,zElevation:0,initialInstancesData:[],effectListData:[],subLayersData:[]};_C87.Layer=/*#__PURE__*/function(_C87$DefendedBase){_inherits(Layer,_C87$DefendedBase);function Layer(layout,parentLayer,opts){var _this39;_classCallCheck(this,Layer);_this39=_possibleConstructorReturn(this,_getPrototypeOf(Layer).call(this));opts=Object.assign({},DEFAULT_LAYER_OPTIONS,opts);_this39._layout=layout;_this39._runtime=layout.GetRuntime();_this39._parentLayer=parentLayer;_this39._name=opts.name;_this39._index=-1;_this39._isHTMLElementsLayer=!!opts.isHTMLElementsLayer;_this39._htmlIndex=-1;_this39._sid=opts.sid;_this39._isDynamic=!!opts.isDynamic;_this39._isVisible=!!opts.isVisible;_this39._isInteractive=!!opts.isInteractive;_this39._backgroundColor=_C87.New(_C87.Color);_this39._backgroundColor.setFromJSON(opts.backgroundColor);_this39._isTransparent=!!opts.isTransparent;_this39._parallaxX=opts.parallax[0];_this39._parallaxY=opts.parallax[1];_this39._color=_C87.New(_C87.Color,1,1,1,opts.opacity);_this39._premultipliedColor=_C87.New(_C87.Color);_this39._isForceOwnTexture=!!opts.isForceOwnTexture;_this39._renderAs3d=!!opts.renderAs3d;_this39._useCameraDistanceDrawOrder=!!opts.useCameraDistanceDrawOrder;_this39._useRenderCells=!!opts.useRenderCells;_this39._scaleRate=opts.scaleRate;_this39._blendMode=opts.blendMode;_this39._curRenderTarget=null;_this39._scale=1;_this39._zElevation=opts.zElevation;_this39._angle=0;_this39._scrollX=0;_this39._scrollY=0;_this39._hasOwnScrollPosition=false;_this39._viewport=_C87.New(_C87.Rect);_this39._viewportZ0=_C87.New(_C87.Rect);_this39._viewport3D=_C87.New(_C87.Rect);_this39._isViewportChanged=true;_this39._projectionMatrix=_mat8.create();_this39._isProjectionMatrixChanged=true;_this39._modelViewMatrix=_mat8.create();_this39._isMVMatrixChanged=true;_this39._viewFrustum=_C87.New(_C87.Gfx.ViewFrustum);_this39._isViewFrustumChanged=true;_this39._startupInitialInstances=[];_this39._initialInstancesData=opts.initialInstancesData;_this39._initialInstances=[];_this39._createdGlobalUids=[];_this39._initialUIDsToInstanceData=new Map();_this39._instances=[];_this39._zIndicesUpToDate=false;_this39._htmlZIndicesUpToDate=false;_this39._anyInstanceZElevated=false;var canvasManager=_this39._runtime.GetCanvasManager();_this39._effectList=_C87.New(_C87.EffectList,_assertThisInitialized(_this39),opts.effectListData);_this39._effectChain=_C87.New(_C87.Gfx.EffectChain,canvasManager.GetEffectChainManager(),{drawContent:function drawContent(renderer,effectChain){var layer=effectChain.GetContentObject();var renderSurface=layer.GetRenderTarget();renderer.SetColor(layer.GetPremultipliedColor());renderer.DrawRenderTarget(renderSurface);renderer.InvalidateRenderTarget(renderSurface);canvasManager.ReleaseAdditionalRenderTarget(renderSurface);},getShaderParameters:function getShaderParameters(index){return _this39.GetEffectList()._GetEffectChainShaderParametersForIndex(index);}});_this39._needsRebuildEffectChainSteps=true;_this39._wasDefaultColor=true;_this39._renderGrid=null;_this39._lastRenderList=[];_this39._isRenderListUpToDate=false;_this39._lastRenderCells=_C87.New(_C87.Rect,0,0,-1,-1);_this39._curRenderCells=_C87.New(_C87.Rect,0,0,-1,-1);_this39._iLayer=new self.ILayer(_assertThisInitialized(_this39));_this39._UpdatePremultipliedColor();if(_this39.UsesRenderCells())_this39._renderGrid=_C87.New(_C87.RenderGrid,_this39._runtime.GetOriginalViewportWidth(),_this39._runtime.GetOriginalViewportHeight());_this39._subLayers=opts.subLayersData.map(function(ld){return _C87.Layer.CreateFromExportData(_this39._layout,_assertThisInitialized(_this39),ld);});return _this39;}_createClass(Layer,[{key:"_InitInitialInstances",value:function _InitInitialInstances(){var _iteratorNormalCompletion126=true;var _didIteratorError126=false;var _iteratorError126=undefined;try{for(var _iterator126=this._initialInstancesData[Symbol.iterator](),_step126;!(_iteratorNormalCompletion126=(_step126=_iterator126.next()).done);_iteratorNormalCompletion126=true){var instData=_step126.value;var objectClass=this._runtime.GetObjectClassByIndex(instData[1]);this._layout._AddInitialObjectClass(objectClass);if(!objectClass.GetDefaultInstanceData()){objectClass.SetDefaultInstanceData(instData);objectClass._SetDefaultLayerIndex(this._index);}this._initialInstances.push(instData);this._initialUIDsToInstanceData.set(instData[2],instData);}}catch(err){_didIteratorError126=true;_iteratorError126=err;}finally{try{if(!_iteratorNormalCompletion126&&_iterator126["return"]!=null){_iterator126["return"]();}}finally{if(_didIteratorError126){throw _iteratorError126;}}}_C87.shallowAssignArray(this._startupInitialInstances,this._initialInstances);this._initialInstancesData=null;}},{key:"Release",value:function Release(){var _iteratorNormalCompletion127=true;var _didIteratorError127=false;var _iteratorError127=undefined;try{for(var _iterator127=this._subLayers[Symbol.iterator](),_step127;!(_iteratorNormalCompletion127=(_step127=_iterator127.next()).done);_iteratorNormalCompletion127=true){var subLayer=_step127.value;subLayer.Release();}}catch(err){_didIteratorError127=true;_iteratorError127=err;}finally{try{if(!_iteratorNormalCompletion127&&_iterator127["return"]!=null){_iterator127["return"]();}}finally{if(_didIteratorError127){throw _iteratorError127;}}}_C87.clearArray(this._subLayers);var _iteratorNormalCompletion128=true;var _didIteratorError128=false;var _iteratorError128=undefined;try{for(var _iterator128=this._instances[Symbol.iterator](),_step128;!(_iteratorNormalCompletion128=(_step128=_iterator128.next()).done);_iteratorNormalCompletion128=true){var inst=_step128.value;this._runtime.DestroyInstance(inst);}}catch(err){_didIteratorError128=true;_iteratorError128=err;}finally{try{if(!_iteratorNormalCompletion128&&_iterator128["return"]!=null){_iterator128["return"]();}}finally{if(_didIteratorError128){throw _iteratorError128;}}}_C87.clearArray(this._instances);this._effectList.Release();this._effectList=null;this._effectChain.Release();this._effectChain=null;this._iLayer=null;this._parentLayer=null;this._layout=null;this._runtime=null;}},{key:"GetInitialInstanceData",value:function GetInitialInstanceData(uid){return this._initialUIDsToInstanceData.get(uid);}},{key:"CreateInitialInstances",value:function CreateInitialInstances(createdInstances){var isFirstVisit=this._layout.IsFirstVisit();var k=0;var initialInstances=this._initialInstances;for(var i=0,len=initialInstances.length;i<len;++i){var instData=initialInstances[i];var objectClass=this._runtime.GetObjectClassByIndex(instData[1]);var keep=true;if(!objectClass.HasPersistBehavior()||isFirstVisit){var inst=this._runtime.CreateInstanceFromData(instData,this,true);createdInstances.push(inst);if(objectClass.IsGlobal()){keep=false;this._createdGlobalUids.push(inst.GetUID());}}if(keep){initialInstances[k]=initialInstances[i];++k;}}_C87.truncateArray(initialInstances,k);this._runtime.FlushPendingInstances();this.SetZIndicesChanged();}},{key:"_AddInstance",value:function _AddInstance(inst,addToGrid){if(!inst.GetPlugin().IsWorldType())throw new Error("instance is not of world type");var wi=inst.GetWorldInfo();if(wi.GetLayer()!==this)throw new Error("instance added to wrong layer");this._instances.push(inst);if(wi.GetZElevation()!==0)this._anyInstanceZElevated=true;if(addToGrid&&this.UsesRenderCells())inst.GetWorldInfo().SetBboxChanged();this.SetZIndicesChanged(inst);}},{key:"_MaybeAddInstance",value:function _MaybeAddInstance(inst){if(this._instances.includes(inst))return;this._instances.push(inst);if(inst.GetWorldInfo().GetZElevation()!==0)this._anyInstanceZElevated=true;this.SetZIndicesChanged(inst);}},{key:"_PrependInstance",value:function _PrependInstance(inst,addToGrid){var wi=inst.GetWorldInfo();if(wi.GetLayer()!==this)throw new Error("instance added to wrong layer");this._instances.unshift(inst);if(wi.GetZElevation()!==0)this._anyInstanceZElevated=true;this.SetZIndicesChanged(inst);if(addToGrid&&this.UsesRenderCells())inst.GetWorldInfo().SetBboxChanged();}},{key:"_RemoveInstance",value:function _RemoveInstance(inst,removeFromGrid){var index=this._instances.indexOf(inst);if(index<0)return;if(removeFromGrid&&this.UsesRenderCells())inst.GetWorldInfo()._RemoveFromRenderCells();this._instances.splice(index,1);this.SetZIndicesChanged(inst);this._MaybeResetAnyInstanceZElevatedFlag();}},{key:"_SetAnyInstanceZElevated",value:function _SetAnyInstanceZElevated(){this._anyInstanceZElevated=true;}},{key:"_MaybeResetAnyInstanceZElevatedFlag",value:function _MaybeResetAnyInstanceZElevatedFlag(){if(this._instances.length===0)this._anyInstanceZElevated=false;}},{key:"_SortInstancesByLastCachedZIndex",value:function _SortInstancesByLastCachedZIndex(isPersistMode){if(isPersistMode){var assignedZIndices=new Set();var _iteratorNormalCompletion129=true;var _didIteratorError129=false;var _iteratorError129=undefined;try{for(var _iterator129=this._instances[Symbol.iterator](),_step129;!(_iteratorNormalCompletion129=(_step129=_iterator129.next()).done);_iteratorNormalCompletion129=true){var inst=_step129.value;var cachedZIndex=inst.GetWorldInfo()._GetLastCachedZIndex();if(cachedZIndex>=0)assignedZIndices.add(cachedZIndex);}}catch(err){_didIteratorError129=true;_iteratorError129=err;}finally{try{if(!_iteratorNormalCompletion129&&_iterator129["return"]!=null){_iterator129["return"]();}}finally{if(_didIteratorError129){throw _iteratorError129;}}}var index=-1;var _iteratorNormalCompletion130=true;var _didIteratorError130=false;var _iteratorError130=undefined;try{for(var _iterator130=this._instances[Symbol.iterator](),_step130;!(_iteratorNormalCompletion130=(_step130=_iterator130.next()).done);_iteratorNormalCompletion130=true){var _inst2=_step130.value;var wi=_inst2.GetWorldInfo();if(wi._GetLastCachedZIndex()>=0)continue;++index;while(assignedZIndices.has(index)){++index;}wi._SetZIndex(index);}}catch(err){_didIteratorError130=true;_iteratorError130=err;}finally{try{if(!_iteratorNormalCompletion130&&_iterator130["return"]!=null){_iterator130["return"]();}}finally{if(_didIteratorError130){throw _iteratorError130;}}}}this._instances.sort(_SortByInstLastCachedZIndex);}},{key:"_Start",value:function _Start(){}},{key:"_End",value:function _End(){var _iteratorNormalCompletion131=true;var _didIteratorError131=false;var _iteratorError131=undefined;try{for(var _iterator131=this._instances[Symbol.iterator](),_step131;!(_iteratorNormalCompletion131=(_step131=_iterator131.next()).done);_iteratorNormalCompletion131=true){var inst=_step131.value;if(!inst.GetObjectClass().IsGlobal())this._runtime.DestroyInstance(inst);}}catch(err){_didIteratorError131=true;_iteratorError131=err;}finally{try{if(!_iteratorNormalCompletion131&&_iterator131["return"]!=null){_iterator131["return"]();}}finally{if(_didIteratorError131){throw _iteratorError131;}}}this._runtime.FlushPendingInstances();_C87.clearArray(this._instances);this._anyInstanceZElevated=false;this.SetZIndicesChanged();}},{key:"RecreateInitialObjects",value:function RecreateInitialObjects(objectClass,rc,offsetX,offsetY,createHierarchy){var eventSheetManager=this._runtime.GetEventSheetManager();var allObjectClasses=this._runtime.GetAllObjectClasses();var isFamily=objectClass.IsFamily();var ret=[];var _iteratorNormalCompletion132=true;var _didIteratorError132=false;var _iteratorError132=undefined;try{for(var _iterator132=this._initialInstances[Symbol.iterator](),_step132;!(_iteratorNormalCompletion132=(_step132=_iterator132.next()).done);_iteratorNormalCompletion132=true){var instData=_step132.value;var worldData=instData[0];var x=worldData[0];var y=worldData[1];if(!rc.containsPoint(x,y))continue;var objectType=allObjectClasses[instData[1]];if(objectType!==objectClass)if(isFamily){if(!objectClass.FamilyHasMember(objectType))continue;}else continue;var createOnLayer=this;var runningLayout=this._runtime.GetCurrentLayout();if(this.GetLayout()!==runningLayout){createOnLayer=runningLayout.GetLayerByName(this.GetName());if(!createOnLayer)createOnLayer=runningLayout.GetLayerByIndex(this.GetIndex());}var inst=this._runtime.CreateInstanceFromData(instData,createOnLayer,false,undefined,undefined,false,createHierarchy);createOnLayer.SortAndAddInstancesByZIndex(inst);var wi=inst.GetWorldInfo();wi.OffsetXY(offsetX,offsetY);wi.SetBboxChanged();eventSheetManager.BlockFlushingInstances(true);inst._TriggerOnCreatedOnSelfAndRelated();eventSheetManager.BlockFlushingInstances(false);ret.push(inst);}}catch(err){_didIteratorError132=true;_iteratorError132=err;}finally{try{if(!_iteratorNormalCompletion132&&_iterator132["return"]!=null){_iterator132["return"]();}}finally{if(_didIteratorError132){throw _iteratorError132;}}}return ret;}},{key:"GetInstanceCount",value:function GetInstanceCount(){return this._instances.length;}},{key:"GetLayout",value:function GetLayout(){return this._layout;}},{key:"GetName",value:function GetName(){return this._name;}},{key:"_SetIndex",value:function _SetIndex(i){this._index=i;}},{key:"GetIndex",value:function GetIndex(){return this._index;}},{key:"_SetHTMLIndex",value:function _SetHTMLIndex(i){this._htmlIndex=i;}},{key:"GetHTMLIndex",value:function GetHTMLIndex(){return this._htmlIndex;}},{key:"IsHTMLElementsLayer",value:function IsHTMLElementsLayer(){return this._isHTMLElementsLayer;}},{key:"SetIsHTMLElementsLayer",value:function SetIsHTMLElementsLayer(i){i=!!i;if(this._isHTMLElementsLayer===i)return;this._isHTMLElementsLayer=i;this._layout._ReindexAndUpdateAllLayers();this._runtime.UpdateRender();}},{key:"_GetSiblingIndex",value:function _GetSiblingIndex(){var ret=-1;var parentLayer=this.GetParentLayer();if(parentLayer)ret=parentLayer.GetSubLayers().indexOf(this);else ret=this.GetLayout()._GetRootLayers().indexOf(this);return ret;}},{key:"GetSID",value:function GetSID(){return this._sid;}},{key:"GetRuntime",value:function GetRuntime(){return this._runtime;}},{key:"IsDynamic",value:function IsDynamic(){return this._isDynamic;}},{key:"HasAnyDynamicParentLayer",value:function HasAnyDynamicParentLayer(){var _iteratorNormalCompletion133=true;var _didIteratorError133=false;var _iteratorError133=undefined;try{for(var _iterator133=this.parentLayers()[Symbol.iterator](),_step133;!(_iteratorNormalCompletion133=(_step133=_iterator133.next()).done);_iteratorNormalCompletion133=true){var parent=_step133.value;if(parent.IsDynamic())return true;}}catch(err){_didIteratorError133=true;_iteratorError133=err;}finally{try{if(!_iteratorNormalCompletion133&&_iterator133["return"]!=null){_iterator133["return"]();}}finally{if(_didIteratorError133){throw _iteratorError133;}}}return false;}},{key:"GetDevicePixelRatio",value:function GetDevicePixelRatio(){return this._runtime.GetDevicePixelRatio();}},{key:"GetEffectList",value:function GetEffectList(){return this._effectList;}},{key:"GetEffectChain",value:function GetEffectChain(){this._MaybeRebuildEffectChainSteps();return this._effectChain;}},{key:"_MaybeRebuildEffectChainSteps",value:function _MaybeRebuildEffectChainSteps(){var isDefaultColor=this.HasDefaultColor();if(!this._needsRebuildEffectChainSteps&&isDefaultColor===this._wasDefaultColor&&!this._effectChain.NeedsRebuild())return;var activeEffectTypes=this.GetEffectList().GetActiveEffectTypes();this._effectChain.BuildSteps(activeEffectTypes.map(function(e){return e.GetShaderProgram();}),{indexMap:activeEffectTypes.map(function(e){return e.GetIndex();}),forcePreDraw:!isDefaultColor,useFullSurface:true});this._needsRebuildEffectChainSteps=false;this._wasDefaultColor=isDefaultColor;}},{key:"UpdateActiveEffects",value:function UpdateActiveEffects(){this.GetEffectList().UpdateActiveEffects();this._needsRebuildEffectChainSteps=true;}},{key:"UsesRenderCells",value:function UsesRenderCells(){return this._useRenderCells&&!this._useCameraDistanceDrawOrder;}},{key:"GetRenderGrid",value:function GetRenderGrid(){return this._renderGrid;}},{key:"SetRenderListStale",value:function SetRenderListStale(){this._isRenderListUpToDate=false;}},{key:"IsVisible",value:function IsVisible(){var _iteratorNormalCompletion134=true;var _didIteratorError134=false;var _iteratorError134=undefined;try{for(var _iterator134=this.selfAndParentLayers()[Symbol.iterator](),_step134;!(_iteratorNormalCompletion134=(_step134=_iterator134.next()).done);_iteratorNormalCompletion134=true){var layer=_step134.value;if(!layer._IsVisibleFlagSet())return false;}}catch(err){_didIteratorError134=true;_iteratorError134=err;}finally{try{if(!_iteratorNormalCompletion134&&_iterator134["return"]!=null){_iterator134["return"]();}}finally{if(_didIteratorError134){throw _iteratorError134;}}}return true;}},{key:"_IsVisibleFlagSet",value:function _IsVisibleFlagSet(){return this._isVisible;}},{key:"SetVisible",value:function SetVisible(v){v=!!v;if(this._isVisible===v)return;this._isVisible=v;this._runtime.UpdateRender();}},{key:"SetInteractive",value:function SetInteractive(i){this._isInteractive=!!i;}},{key:"IsInteractive",value:function IsInteractive(){return this._isInteractive;}},{key:"IsSelfAndParentsInteractive",value:function IsSelfAndParentsInteractive(){var _iteratorNormalCompletion135=true;var _didIteratorError135=false;var _iteratorError135=undefined;try{for(var _iterator135=this.selfAndParentLayers()[Symbol.iterator](),_step135;!(_iteratorNormalCompletion135=(_step135=_iterator135.next()).done);_iteratorNormalCompletion135=true){var layer=_step135.value;if(!layer.IsInteractive())return false;}}catch(err){_didIteratorError135=true;_iteratorError135=err;}finally{try{if(!_iteratorNormalCompletion135&&_iterator135["return"]!=null){_iterator135["return"]();}}finally{if(_didIteratorError135){throw _iteratorError135;}}}return true;}},{key:"SetOwnScrollPositionEnabled",value:function SetOwnScrollPositionEnabled(e){e=!!e;if(this._hasOwnScrollPosition===e)return;this._hasOwnScrollPosition=e;if(e){var layout=this.GetLayout();this._scrollX=layout.GetScrollX();this._scrollY=layout.GetScrollY();}this._SetMVMatrixChanged();this._runtime.UpdateRender();}},{key:"IsOwnScrollPositionEnabled",value:function IsOwnScrollPositionEnabled(){return this._hasOwnScrollPosition;}},{key:"SetScrollX",value:function SetScrollX(x){var layout=this.GetLayout();var lbound=layout.GetScrollLeftBound();var rbound=layout.GetScrollRightBound();if(x>rbound)x=rbound;if(x<lbound)x=lbound;if(this._scrollX!==x){this._scrollX=x;if(this.IsOwnScrollPositionEnabled()){this._SetMVMatrixChanged();this._runtime.UpdateRender();}}}},{key:"SetScrollY",value:function SetScrollY(y){var layout=this.GetLayout();var ubound=layout.GetScrollTopBound();var bbound=layout.GetScrollBottomBound();if(y>bbound)y=bbound;if(y<ubound)y=ubound;if(this._scrollY!==y){this._scrollY=y;if(this.IsOwnScrollPositionEnabled()){this._SetMVMatrixChanged();this._runtime.UpdateRender();}}}},{key:"GetScrollX",value:function GetScrollX(){if(this.IsOwnScrollPositionEnabled())return this._scrollX;else return this.GetLayout().GetScrollX();}},{key:"GetScrollY",value:function GetScrollY(){if(this.IsOwnScrollPositionEnabled())return this._scrollY;else return this.GetLayout().GetScrollY();}},{key:"GetViewport",value:function GetViewport(){this._MaybeUpdateViewport();return this._viewport;}},{key:"_GetViewportZ0",value:function _GetViewportZ0(){this._MaybeUpdateViewport();return this._viewportZ0;}},{key:"GetViewport3D",value:function GetViewport3D(){this._MaybeUpdateViewport();return this._viewport3D;}},{key:"_GetVanishingPoint",value:function _GetVanishingPoint(){var layout=this.GetLayout();return[layout.GetVanishingPointX(),layout.GetVanishingPointY()];}},{key:"GetDefaultCameraZ",value:function GetDefaultCameraZ(viewH){return this._runtime.GetDefaultCameraZ(viewH);}},{key:"GetViewportForZ",value:function GetViewportForZ(z,outRect){var viewportZ0=this._GetViewportZ0();if(z===0)outRect.copy(viewportZ0);else{var midX=viewportZ0.midX();var midY=viewportZ0.midY();var scaleFactor=this.Get2DScaleFactorToZ(z);var viewW=viewportZ0.width()/scaleFactor;var viewH=viewportZ0.height()/scaleFactor;var _this$_GetVanishingPo=this._GetVanishingPoint(),_this$_GetVanishingPo2=_slicedToArray(_this$_GetVanishingPo,2),vpX=_this$_GetVanishingPo2[0],vpY=_this$_GetVanishingPo2[1];if(vpX!==.5||vpY!==.5){var cameraZ=this.GetCameraZ();var _runtime=this._runtime;var zf=this.GetDefaultCameraZ()/cameraZ;var camOffX=(vpX-.5)*_runtime.GetViewportWidth()/zf;var camOffY=(vpY-.5)*_runtime.GetViewportHeight()/zf;var _a2=this.GetAngle();if(_a2!==0){tempVec2.set(camOffX,camOffY);tempVec2.rotate(_a2);camOffX=tempVec2.getX();camOffY=tempVec2.getY();}var zProg=_C87.unlerp(cameraZ,0,z);midX+=_C87.lerp(camOffX,0,zProg);midY+=_C87.lerp(camOffY,0,zProg);}outRect.set(midX-viewW/2,midY-viewH/2,midX+viewW/2,midY+viewH/2);}}},{key:"GetOpacity",value:function GetOpacity(){return this._color.getA();}},{key:"SetOpacity",value:function SetOpacity(o){o=_C87.clamp(o,0,1);if(this._color.getA()===o)return;this._color.setA(o);this._UpdatePremultipliedColor();this._runtime.UpdateRender();}},{key:"_UpdatePremultipliedColor",value:function _UpdatePremultipliedColor(){this._premultipliedColor.copy(this._color);this._premultipliedColor.premultiply();}},{key:"GetPremultipliedColor",value:function GetPremultipliedColor(){return this._premultipliedColor;}},{key:"HasDefaultColor",value:function HasDefaultColor(){return this._color.equalsRgba(1,1,1,1);}},{key:"GetScaleRate",value:function GetScaleRate(){return this._scaleRate;}},{key:"SetScaleRate",value:function SetScaleRate(r){if(this._scaleRate===r)return;this._scaleRate=r;this._SetMVMatrixChanged();this._runtime.UpdateRender();}},{key:"GetParallaxX",value:function GetParallaxX(){return this._parallaxX;}},{key:"GetParallaxY",value:function GetParallaxY(){return this._parallaxY;}},{key:"SetParallax",value:function SetParallax(px,py){if(this._parallaxX===px&&this._parallaxY===py)return;this._parallaxX=px;this._parallaxY=py;this._SetMVMatrixChanged();this._runtime.UpdateRender();if(this._parallaxX!==1||this._parallaxY!==1){var _iteratorNormalCompletion136=true;var _didIteratorError136=false;var _iteratorError136=undefined;try{for(var _iterator136=this._instances[Symbol.iterator](),_step136;!(_iteratorNormalCompletion136=(_step136=_iterator136.next()).done);_iteratorNormalCompletion136=true){var inst=_step136.value;inst.GetObjectClass()._SetAnyInstanceParallaxed(true);}}catch(err){_didIteratorError136=true;_iteratorError136=err;}finally{try{if(!_iteratorNormalCompletion136&&_iterator136["return"]!=null){_iterator136["return"]();}}finally{if(_didIteratorError136){throw _iteratorError136;}}}}}},{key:"SetParallaxX",value:function SetParallaxX(px){this.SetParallax(px,this.GetParallaxY());}},{key:"SetParallaxY",value:function SetParallaxY(py){this.SetParallax(this.GetParallaxX(),py);}},{key:"SetZElevation",value:function SetZElevation(z){if(this._zElevation===z)return;this._zElevation=z;this._runtime.UpdateRender();}},{key:"GetZElevation",value:function GetZElevation(){return this._zElevation;}},{key:"SetAngle",value:function SetAngle(a){a=_C87.clampAngle(a);if(this._angle===a)return;this._angle=a;this._SetMVMatrixChanged();this._runtime.UpdateRender();}},{key:"GetAngle",value:function GetAngle(){return _C87.clampAngle(this._layout.GetAngle()+this._angle);}},{key:"GetOwnAngle",value:function GetOwnAngle(){return this._angle;}},{key:"HasInstances",value:function HasInstances(){return this._instances.length>0;}},{key:"_GetInstances",value:function _GetInstances(){return this._instances;}},{key:"_GetInstancesInDrawOrder",value:function _GetInstancesInDrawOrder(){var _this40=this;if(this.RendersIn3DMode()&&this._useCameraDistanceDrawOrder){_C87.shallowAssignArray(tempInstancesByCameraDist,this._GetInstances());tempInstancesByCameraDist.sort(function(a,b){return _this40._SortInstancesByCameraDistance(a,b);});return tempInstancesByCameraDist;}else return this._GetInstances();}},{key:"_AppendAllInstancesIncludingSubLayersInDrawOrder",value:function _AppendAllInstancesIncludingSubLayersInDrawOrder(arr){_C87.appendArray(arr,this._GetInstancesInDrawOrder());var _iteratorNormalCompletion137=true;var _didIteratorError137=false;var _iteratorError137=undefined;try{for(var _iterator137=this._subLayers[Symbol.iterator](),_step137;!(_iteratorNormalCompletion137=(_step137=_iterator137.next()).done);_iteratorNormalCompletion137=true){var subLayer=_step137.value;if(subLayer.IsVisible()&&subLayer.GetOpacity()>0)subLayer._AppendAllInstancesIncludingSubLayersInDrawOrder(arr);}}catch(err){_didIteratorError137=true;_iteratorError137=err;}finally{try{if(!_iteratorNormalCompletion137&&_iterator137["return"]!=null){_iterator137["return"]();}}finally{if(_didIteratorError137){throw _iteratorError137;}}}}},{key:"_SortInstancesByCameraDistance",value:function _SortInstancesByCameraDistance(a,b){var camVec=this.GetLayout().Get3DCameraPosition();var camX=camVec[0];var camY=camVec[1];var camZ=camVec[2];var wiA=a.GetWorldInfo();var wiB=b.GetWorldInfo();var dxA=wiA.GetX()-camX;var dyA=wiA.GetY()-camY;var dzA=wiA.GetZElevation()-camZ;var dxB=wiB.GetX()-camX;var dyB=wiB.GetY()-camY;var dzB=wiB.GetZElevation()-camZ;return dxB*dxB+dyB*dyB+dzB*dzB-(dxA*dxA+dyA*dyA+dzA*dzA);}},{key:"GetBackgroundColor",value:function GetBackgroundColor(){return this._backgroundColor;}},{key:"IsTransparent",value:function IsTransparent(){return this._isTransparent;}},{key:"SetTransparent",value:function SetTransparent(t){t=!!t;if(this._isTransparent===t)return;this._isTransparent=t;this._runtime.UpdateRender();}},{key:"IsForceOwnTexture",value:function IsForceOwnTexture(){return this._isForceOwnTexture;}},{key:"SetForceOwnTexture",value:function SetForceOwnTexture(f){f=!!f;if(this._isForceOwnTexture===f)return;this._isForceOwnTexture=f;this._runtime.UpdateRender();}},{key:"RendersIn2DMode",value:function RendersIn2DMode(){return!this.GetRuntime().Uses3DFeatures()||!this._renderAs3d;}},{key:"RendersIn3DMode",value:function RendersIn3DMode(){return!this.RendersIn2DMode();}},{key:"Has3DCamera",value:function Has3DCamera(){return this.RendersIn3DMode()&&this.GetLayout().Is3DCameraEnabled();}},{key:"SelfAndAllSubLayersHave3DCamera",value:function SelfAndAllSubLayersHave3DCamera(){if(!this.Has3DCamera())return false;var _iteratorNormalCompletion138=true;var _didIteratorError138=false;var _iteratorError138=undefined;try{for(var _iterator138=this._subLayers[Symbol.iterator](),_step138;!(_iteratorNormalCompletion138=(_step138=_iterator138.next()).done);_iteratorNormalCompletion138=true){var subLayer=_step138.value;if(!subLayer.SelfAndAllSubLayersHave3DCamera())return false;}}catch(err){_didIteratorError138=true;_iteratorError138=err;}finally{try{if(!_iteratorNormalCompletion138&&_iterator138["return"]!=null){_iterator138["return"]();}}finally{if(_didIteratorError138){throw _iteratorError138;}}}return true;}},{key:"SetBlendMode",value:function SetBlendMode(bm){if(this._blendMode===bm)return;this._blendMode=bm;this._runtime.UpdateRender();}},{key:"GetBlendMode",value:function GetBlendMode(){return this._blendMode;}},{key:"IsRootLayer",value:function IsRootLayer(){return!this._parentLayer;}},{key:"GetParentLayer",value:function GetParentLayer(){return this._parentLayer;}},{key:"_SetParentLayer",value:function _SetParentLayer(layer){this._parentLayer=layer;}},{key:"GetSubLayers",value:function GetSubLayers(){return this._subLayers;}},{key:"HasAnySubLayers",value:function HasAnySubLayers(){return this._subLayers.length>0;}},{key:"_AddSubLayer",value:function _AddSubLayer(layer){var atTop=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;if(atTop)this._subLayers.push(layer);else this._subLayers.unshift(layer);}},{key:"_InsertSubLayer",value:function _InsertSubLayer(layer,insertBy,isAbove){var i=this._subLayers.indexOf(insertBy);if(i===-1)throw new Error("cannot find layer to insert by");if(isAbove)++i;this._subLayers.splice(i,0,layer);}},{key:"_RemoveSubLayer",value:function _RemoveSubLayer(layer){var i=this._subLayers.indexOf(layer);if(i===-1)throw new Error("cannot find layer to remove");this._subLayers.splice(i,1);}},{key:"HasAnyVisibleSubLayer",value:function HasAnyVisibleSubLayer(){var _iteratorNormalCompletion139=true;var _didIteratorError139=false;var _iteratorError139=undefined;try{for(var _iterator139=this._subLayers[Symbol.iterator](),_step139;!(_iteratorNormalCompletion139=(_step139=_iterator139.next()).done);_iteratorNormalCompletion139=true){var subLayer=_step139.value;if(subLayer.ShouldDraw())return true;}}catch(err){_didIteratorError139=true;_iteratorError139=err;}finally{try{if(!_iteratorNormalCompletion139&&_iterator139["return"]!=null){_iterator139["return"]();}}finally{if(_didIteratorError139){throw _iteratorError139;}}}return false;}},{key:"selfAndAllSubLayers",value:/*#__PURE__*/regeneratorRuntime.mark(function selfAndAllSubLayers(){var _iteratorNormalCompletion140,_didIteratorError140,_iteratorError140,_iterator140,_step140,subLayer;return regeneratorRuntime.wrap(function selfAndAllSubLayers$(_context76){while(1){switch(_context76.prev=_context76.next){case 0:_iteratorNormalCompletion140=true;_didIteratorError140=false;_iteratorError140=undefined;_context76.prev=3;_iterator140=this._subLayers[Symbol.iterator]();case 5:if(_iteratorNormalCompletion140=(_step140=_iterator140.next()).done){_context76.next=11;break;}subLayer=_step140.value;return _context76.delegateYield(subLayer.selfAndAllSubLayers(),"t0",8);case 8:_iteratorNormalCompletion140=true;_context76.next=5;break;case 11:_context76.next=17;break;case 13:_context76.prev=13;_context76.t1=_context76["catch"](3);_didIteratorError140=true;_iteratorError140=_context76.t1;case 17:_context76.prev=17;_context76.prev=18;if(!_iteratorNormalCompletion140&&_iterator140["return"]!=null){_iterator140["return"]();}case 20:_context76.prev=20;if(!_didIteratorError140){_context76.next=23;break;}throw _iteratorError140;case 23:return _context76.finish(20);case 24:return _context76.finish(17);case 25:_context76.next=27;return this;case 27:case"end":return _context76.stop();}}},selfAndAllSubLayers,this,[[3,13,17,25],[18,,20,24]]);})},{key:"parentLayers",value:/*#__PURE__*/regeneratorRuntime.mark(function parentLayers(){var parentLayer;return regeneratorRuntime.wrap(function parentLayers$(_context77){while(1){switch(_context77.prev=_context77.next){case 0:parentLayer=this.GetParentLayer();case 1:if(!parentLayer){_context77.next=7;break;}_context77.next=4;return parentLayer;case 4:parentLayer=parentLayer.GetParentLayer();_context77.next=1;break;case 7:case"end":return _context77.stop();}}},parentLayers,this);})},{key:"selfAndParentLayers",value:/*#__PURE__*/regeneratorRuntime.mark(function selfAndParentLayers(){return regeneratorRuntime.wrap(function selfAndParentLayers$(_context78){while(1){switch(_context78.prev=_context78.next){case 0:_context78.next=2;return this;case 2:return _context78.delegateYield(this.parentLayers(),"t0",3);case 3:case"end":return _context78.stop();}}},selfAndParentLayers,this);})},{key:"HasParentLayer",value:function HasParentLayer(layer){var _iteratorNormalCompletion141=true;var _didIteratorError141=false;var _iteratorError141=undefined;try{for(var _iterator141=this.parentLayers()[Symbol.iterator](),_step141;!(_iteratorNormalCompletion141=(_step141=_iterator141.next()).done);_iteratorNormalCompletion141=true){var p=_step141.value;if(p===layer)return true;}}catch(err){_didIteratorError141=true;_iteratorError141=err;}finally{try{if(!_iteratorNormalCompletion141&&_iterator141["return"]!=null){_iterator141["return"]();}}finally{if(_didIteratorError141){throw _iteratorError141;}}}return false;}},{key:"IsTransformCompatibleWith",value:function IsTransformCompatibleWith(otherLayer){return this===otherLayer||this._parallaxX===otherLayer._parallaxX&&this._parallaxY===otherLayer._parallaxY&&this._scale===otherLayer._scale&&this._scaleRate===otherLayer._scaleRate&&this._angle===otherLayer._angle&&this.GetScrollX()===otherLayer.GetScrollX()&&this.GetScrollY()===otherLayer.GetScrollY();}},{key:"SaveTransform",value:function SaveTransform(){return{"parallaxX":this.GetParallaxX(),"parallaxY":this.GetParallaxY(),"scale":this.GetOwnScale(),"scaleRate":this.GetScaleRate(),"angle":this.GetOwnAngle(),"hasOwnScroll":this.IsOwnScrollPositionEnabled(),"scrollX":this.GetScrollX(),"scrollY":this.GetScrollY()};}},{key:"RestoreTransform",value:function RestoreTransform(t){this.SetParallax(t["parallaxX"],t["parallaxY"]);this.SetOwnScale(t["scale"]);this.SetScaleRate(t["scaleRate"]);this.SetAngle(t["angle"]);this.SetOwnScrollPositionEnabled(t["hasOwnScroll"]);this.SetScrollX(t["scrollX"]);this.SetScrollY(t["scrollY"]);this._MaybeUpdateViewport();}},{key:"_RemoveAllInstancesInSet",value:function _RemoveAllInstancesInSet(s){if(s.size===0)return;var numRemoved=_C87.arrayRemoveAllInSet(this._instances,s);if(numRemoved>0){this._MaybeResetAnyInstanceZElevatedFlag();this.SetZIndicesChanged();}}},{key:"SetZIndicesChanged",value:function SetZIndicesChanged(inst){this._zIndicesUpToDate=false;this._isRenderListUpToDate=false;if(!inst||inst.GetObjectClass().GetPlugin().IsHTMLElementType())this._htmlZIndicesUpToDate=false;}},{key:"_UpdateZIndices",value:function _UpdateZIndices(){if(this._zIndicesUpToDate)return;this._instances.sort(SortByInstZElevation);if(this.UsesRenderCells())for(var i=0,len=this._instances.length;i<len;++i){var wi=this._instances[i].GetWorldInfo();wi._SetZIndex(i);this._renderGrid.MarkRangeChanged(wi.GetRenderCellRange());}else for(var _i34=0,_len34=this._instances.length;_i34<_len34;++_i34){this._instances[_i34].GetWorldInfo()._SetZIndex(_i34);}this._zIndicesUpToDate=true;}},{key:"_UpdateHTMLZIndices",value:function _UpdateHTMLZIndices(){if(this._htmlZIndicesUpToDate)return;var rootLayers=this._layout.GetRootLayersForHTMLLayer(this.GetHTMLIndex());var allLayers=rootLayers.map(function(l){return _toConsumableArray(l.selfAndAllSubLayers());}).flat();var htmlZIndex=0;var _iteratorNormalCompletion142=true;var _didIteratorError142=false;var _iteratorError142=undefined;try{for(var _iterator142=allLayers[Symbol.iterator](),_step142;!(_iteratorNormalCompletion142=(_step142=_iterator142.next()).done);_iteratorNormalCompletion142=true){var layer=_step142.value;var _iteratorNormalCompletion143=true;var _didIteratorError143=false;var _iteratorError143=undefined;try{for(var _iterator143=layer._GetInstances()[Symbol.iterator](),_step143;!(_iteratorNormalCompletion143=(_step143=_iterator143.next()).done);_iteratorNormalCompletion143=true){var inst=_step143.value;if(inst.GetObjectClass().GetPlugin().IsHTMLElementType())inst.GetWorldInfo()._SetHTMLZIndex(htmlZIndex++);}}catch(err){_didIteratorError143=true;_iteratorError143=err;}finally{try{if(!_iteratorNormalCompletion143&&_iterator143["return"]!=null){_iterator143["return"]();}}finally{if(_didIteratorError143){throw _iteratorError143;}}}layer._SetHTMLZIndicesUpToDate();}}catch(err){_didIteratorError142=true;_iteratorError142=err;}finally{try{if(!_iteratorNormalCompletion142&&_iterator142["return"]!=null){_iterator142["return"]();}}finally{if(_didIteratorError142){throw _iteratorError142;}}}}},{key:"_SetHTMLZIndicesUpToDate",value:function _SetHTMLZIndicesUpToDate(){this._htmlZIndicesUpToDate=true;}},{key:"MoveInstanceAdjacent",value:function MoveInstanceAdjacent(inst,other,isAfter){var instWi=inst.GetWorldInfo();var otherWi=other.GetWorldInfo();if(instWi.GetLayer()!==this||otherWi.GetLayer()!==this)throw new Error("can't arrange Z order unless both objects on this layer");var myZ=instWi.GetZIndex();var insertZ=otherWi.GetZIndex();if(myZ===insertZ+(isAfter?1:-1))return false;_C87.arrayRemove(this._instances,myZ);if(myZ<insertZ)insertZ--;if(isAfter)insertZ++;if(insertZ===this._instances.length)this._instances.push(inst);else this._instances.splice(insertZ,0,inst);this.SetZIndicesChanged(inst);return true;}},{key:"_MergeSortedZArrays",value:function _MergeSortedZArrays(a,b){var ret=[];var i=0,j=0,lena=a.length,lenb=b.length;while(i<lena&&j<lenb){var ai=a[i];var bj=b[j];if(ai.GetWorldInfo()._GetLastCachedZIndex()<bj.GetWorldInfo()._GetLastCachedZIndex()){ret.push(ai);++i;}else{ret.push(bj);++j;}}for(;i<lena;++i){ret.push(a[i]);}for(;j<lenb;++j){ret.push(b[j]);}return ret;}},{key:"_MergeAllSortedZArrays_pass",value:function _MergeAllSortedZArrays_pass(arr){var ret=[];var len=arr.length;for(var i=0;i<len-1;i+=2){var arr1=arr[i];var arr2=arr[i+1];ret.push(this._MergeSortedZArrays(arr1,arr2));}if(len%2===1)ret.push(arr[len-1]);return ret;}},{key:"_MergeAllSortedZArrays",value:function _MergeAllSortedZArrays(arr){while(arr.length>1){arr=this._MergeAllSortedZArrays_pass(arr);}return arr[0];}},{key:"_GetRenderCellInstancesToDraw",value:function _GetRenderCellInstancesToDraw(){this._UpdateZIndices();_C87.clearArray(renderCellArr);this._renderGrid.QueryRange(this.GetViewport(),renderCellArr);if(!renderCellArr.length)return[];if(renderCellArr.length===1)return renderCellArr[0];return this._MergeAllSortedZArrays(renderCellArr);}},{key:"ShouldDraw",value:function ShouldDraw(){return this.IsVisible()&&this.GetOpacity()>0&&this._DrawsAnyContentInSelfOrSubLayers();}},{key:"_DrawsAnyContentInSelfOrSubLayers",value:function _DrawsAnyContentInSelfOrSubLayers(){if(this.HasInstances()||!this.IsTransparent())return true;var _iteratorNormalCompletion144=true;var _didIteratorError144=false;var _iteratorError144=undefined;try{for(var _iterator144=this._subLayers[Symbol.iterator](),_step144;!(_iteratorNormalCompletion144=(_step144=_iterator144.next()).done);_iteratorNormalCompletion144=true){var subLayer=_step144.value;if(subLayer._DrawsAnyContentInSelfOrSubLayers())return true;}}catch(err){_didIteratorError144=true;_iteratorError144=err;}finally{try{if(!_iteratorNormalCompletion144&&_iterator144["return"]!=null){_iterator144["return"]();}}finally{if(_didIteratorError144){throw _iteratorError144;}}}return false;}},{key:"UsesOwnTexture",value:function UsesOwnTexture(){return this.IsForceOwnTexture()||!this.HasDefaultColor()||this.GetBlendMode()!==0||this._effectList.HasAnyActiveEffect();}},{key:"SelfOrAnySubLayerUsesOwnTexture",value:function SelfOrAnySubLayerUsesOwnTexture(){if(this.UsesOwnTexture())return true;var _iteratorNormalCompletion145=true;var _didIteratorError145=false;var _iteratorError145=undefined;try{for(var _iterator145=this._subLayers[Symbol.iterator](),_step145;!(_iteratorNormalCompletion145=(_step145=_iterator145.next()).done);_iteratorNormalCompletion145=true){var subLayer=_step145.value;if(subLayer.SelfOrAnySubLayerUsesOwnTexture())return true;}}catch(err){_didIteratorError145=true;_iteratorError145=err;}finally{try{if(!_iteratorNormalCompletion145&&_iterator145["return"]!=null){_iterator145["return"]();}}finally{if(_didIteratorError145){throw _iteratorError145;}}}return false;}},{key:"GetRenderTarget",value:function GetRenderTarget(){return this._curRenderTarget;}},{key:"Get2DScaleFactorToZ",value:function Get2DScaleFactorToZ(z){if(this._layout.IsOrthographicProjection())return 1;else{var camZ=this.GetCameraZ();return camZ/(camZ-z);}}},{key:"GetCameraZ",value:function GetCameraZ(viewH){return this.GetDefaultCameraZ(viewH)/this.GetNormalScale();}},{key:"_SetMVMatrixChanged",value:function _SetMVMatrixChanged(){this._isMVMatrixChanged=true;this._isViewFrustumChanged=true;this._isViewportChanged=true;}},{key:"_GetModelViewMatrix",value:function _GetModelViewMatrix(renderer){if(this._isMVMatrixChanged){this._CalculateModelViewMatrix(renderer,this._modelViewMatrix,0,0,null);this._isMVMatrixChanged=false;}return this._modelViewMatrix;}},{key:"GetCameraPosition",value:function GetCameraPosition(){if(this.Has3DCamera()){var camPos=this.GetLayout().Get3DCameraPosition();return[camPos[0],camPos[1],camPos[2]];}else return this._Get2DCameraPosition();}},{key:"_Get2DCameraPosition",value:function _Get2DCameraPosition(){var offX=arguments.length>0&&arguments[0]!==undefined?arguments[0]:0;var offY=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var viewH=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var runtime=this._runtime;var layout=this.GetLayout();var parallaxOriginX=runtime.GetParallaxXOrigin();var parallaxOriginY=runtime.GetParallaxYOrigin();var scrollOriginX=(this.GetScrollX()-parallaxOriginX)*this._parallaxX+parallaxOriginX;var scrollOriginY=(this.GetScrollY()-parallaxOriginY)*this._parallaxY+parallaxOriginY;if(runtime.IsPixelRoundingEnabled()){scrollOriginX=Math.round(scrollOriginX);scrollOriginY=Math.round(scrollOriginY);}var camX=scrollOriginX+offX;var camY=scrollOriginY+offY;var camZ=layout.IsOrthographicProjection()?this.GetDefaultCameraZ(viewH):this.GetCameraZ(viewH);var _this$_GetVanishingPo3=this._GetVanishingPoint(),_this$_GetVanishingPo4=_slicedToArray(_this$_GetVanishingPo3,2),vpX=_this$_GetVanishingPo4[0],vpY=_this$_GetVanishingPo4[1];if(vpX!==.5||vpY!==.5){var zf=this.GetDefaultCameraZ(viewH)/camZ;var camOffX=(vpX-.5)*runtime.GetViewportWidth()/zf;var camOffY=(vpY-.5)*runtime.GetViewportHeight()/zf;var _a3=this.GetAngle();if(_a3!==0){tempVec2.set(camOffX,camOffY);tempVec2.rotate(_a3);camOffX=tempVec2.getX();camOffY=tempVec2.getY();}camX+=camOffX;camY+=camOffY;}return[camX,camY,camZ];}},{key:"_CalculateModelViewMatrix",value:function _CalculateModelViewMatrix(renderer,outMat,offX,offY,viewH){var runtime=this._runtime;var layout=this.GetLayout();if(this.Has3DCamera()){_vec8.copy(camVector,layout.Get3DCameraPosition());_vec8.copy(lookVector,layout.Get3DCameraLookAt());_vec8.copy(upVector,layout.Get3DCameraUpVector());var parallaxOriginX=runtime.GetParallaxXOrigin();var parallaxOriginY=runtime.GetParallaxYOrigin();var lookDx=lookVector[0]-camVector[0];var lookDy=lookVector[1]-camVector[1];var lookDz=lookVector[2]-camVector[2];camVector[0]=(camVector[0]-parallaxOriginX)*this._parallaxX+parallaxOriginX;camVector[1]=(camVector[1]-parallaxOriginY)*this._parallaxY+parallaxOriginY;camVector[2]*=Math.max(this._parallaxX,this._parallaxY);lookVector[0]=camVector[0]+lookDx;lookVector[1]=camVector[1]+lookDy;lookVector[2]=camVector[2]+lookDz;}else{var _this$_Get2DCameraPos=this._Get2DCameraPosition(offX,offY,viewH),_this$_Get2DCameraPos2=_slicedToArray(_this$_Get2DCameraPos,3),camX=_this$_Get2DCameraPos2[0],camY=_this$_Get2DCameraPos2[1],camZ=_this$_Get2DCameraPos2[2];_vec8.set(camVector,camX,camY,camZ);_vec8.set(lookVector,camX,camY,camZ-100);var _a4=this.GetAngle();if(_a4===0)_vec8.set(upVector,0,1,0);else _vec8.set(upVector,Math.sin(_a4),Math.cos(_a4),0);}renderer.CalculateLookAtModelView(outMat,camVector,lookVector,upVector,viewH||runtime.GetViewportHeight());}},{key:"_SetProjectionMatrixChanged",value:function _SetProjectionMatrixChanged(){this._isProjectionMatrixChanged=true;this._isViewFrustumChanged=true;this._isViewportChanged=true;}},{key:"_GetProjectionMatrix",value:function _GetProjectionMatrix(renderer){if(this._isProjectionMatrixChanged){this._CalculateProjectionMatrix(renderer);this._isProjectionMatrixChanged=false;}return this._projectionMatrix;}},{key:"_CalculateProjectionMatrix",value:function _CalculateProjectionMatrix(renderer){var canvasManager=this._runtime.GetCanvasManager();var _this$_GetVanishingPo5=this._GetVanishingPoint(),_this$_GetVanishingPo6=_slicedToArray(_this$_GetVanishingPo5,2),vpX=_this$_GetVanishingPo6[0],vpY=_this$_GetVanishingPo6[1];if(this._layout.IsOrthographicProjection())renderer.CalculateOrthographicMatrix(this._projectionMatrix,canvasManager.GetDrawWidth(),canvasManager.GetDrawHeight());else if(vpX===.5&&vpY===.5)_mat8.copy(this._projectionMatrix,canvasManager.GetDefaultProjectionMatrix());else{var drawW=canvasManager.GetDrawWidth();var drawH=canvasManager.GetDrawHeight();renderer.CalculatePerspectiveMatrix(this._projectionMatrix,drawW/drawH,vpX,vpY);}}},{key:"_SetTransform",value:function _SetTransform(renderer){var updateProjection=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var offX=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;var offY=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var viewH=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;if(updateProjection)renderer.SetProjectionMatrix(this._GetProjectionMatrix(renderer));var modelViewMatrix=null;if(offX===0&&offY===0&&viewH===0)modelViewMatrix=this._GetModelViewMatrix(renderer);else{this._CalculateModelViewMatrix(renderer,_tempMat2,offX,offY,viewH);modelViewMatrix=_tempMat2;}renderer.SetModelViewMatrix(modelViewMatrix);}},{key:"PrepareForDraw",value:function PrepareForDraw(renderer){this._SetTransform(renderer);renderer.SetBaseZ(this.GetZElevation());}},{key:"Draw",value:function Draw(renderer,destinationRenderTarget,isFirstToTarget){var canvasManager=this._runtime.GetCanvasManager();var useOwnTexture=this.UsesOwnTexture();var ownRenderTarget=null;var layerQuery=null;if(this._runtime.IsGPUProfiling())if(renderer.IsWebGL()){var timingsBuffer=canvasManager.GetLayerTimingsBuffer(this);if(timingsBuffer){layerQuery=timingsBuffer.AddTimeElapsedQuery();renderer.StartQuery(layerQuery);}}else if(renderer.IsWebGPU())renderer.WriteTimestamp((this.GetIndex()+1)*2);if(useOwnTexture){var rtOpts={sampling:this._runtime.GetSampling(),isSampled:true,canReadPixels:renderer.IsWebGPU()?this._runtime.UsesAnyBackgroundBlending():false};if(canvasManager.GetCurrentFullscreenScalingQuality()==="low"){rtOpts.width=canvasManager.GetDrawWidth();rtOpts.height=canvasManager.GetDrawHeight();}ownRenderTarget=this._runtime.GetAdditionalRenderTarget(rtOpts);this._curRenderTarget=ownRenderTarget;renderer.SetRenderTarget(ownRenderTarget);if(this.IsTransparent())renderer.ClearRgba(0,0,0,0);}else{this._curRenderTarget=destinationRenderTarget;renderer.SetRenderTarget(destinationRenderTarget);}if(!this.IsTransparent())renderer.Clear(this._backgroundColor);this._layout._DrawLayerList(renderer,this._curRenderTarget,this._subLayers,useOwnTexture&&this.IsTransparent());this._SetTransform(renderer);renderer.SetBaseZ(this.GetZElevation());renderer.SetDepthEnabled(this.RendersIn3DMode());if(this.GetNormalScale()>Number.EPSILON){this._UpdateZIndices();var useRenderCells=this.UsesRenderCells()&&this.GetZElevation()===0&&!this._anyInstanceZElevated;if(this.Has3DCamera())this._DrawInstances_3DCamera(renderer);else if(useRenderCells)this._DrawInstances_RenderCells(renderer);else this._DrawInstances(renderer,this._GetInstancesInDrawOrder());}renderer.SetBaseZ(0);renderer.SetCurrentZ(0);if(useOwnTexture){renderer.SetDepthEnabled(false);this._DrawLayerOwnTextureToRenderTarget(renderer,ownRenderTarget,destinationRenderTarget,isFirstToTarget);}if(layerQuery)renderer.EndQuery(layerQuery);if(this._runtime.IsGPUProfiling()&&renderer.IsWebGPU())renderer.WriteTimestamp((this.GetIndex()+1)*2+1);this._curRenderTarget=null;}},{key:"_DrawInstances",value:function _DrawInstances(renderer,instances){var viewport=this.GetViewport();var renderTarget=this._curRenderTarget;var isOrthographic=this.GetLayout().IsOrthographicProjection();var hasVanishingPointOutsideViewport=this.GetLayout().HasVanishingPointOutsideViewport();var lastInst=null;for(var i=0,len=instances.length;i<len;++i){var inst=instances[i];if(inst===lastInst)continue;lastInst=inst;var wi=inst.GetWorldInfo();if(wi.IsVisible()&&wi.IsInViewport(viewport,hasVanishingPointOutsideViewport,isOrthographic))this._DrawInstanceMaybeWithEffects(inst,wi,renderer,renderTarget);}}},{key:"_DrawInstances_3DCamera",value:function _DrawInstances_3DCamera(renderer){var renderTarget=this._curRenderTarget;var viewFrustum=this._GetViewFrustum();var coplanarInstances=tempInstanceList1;var postRenderInstances=tempInstanceList2;var instances=this._GetInstancesInDrawOrder();for(var i=0,len=instances.length;i<len;){var inst=instances[i];var wi=inst.GetWorldInfo();if(!wi.IsVisible()||!wi.IsInViewport3D(viewFrustum)){++i;continue;}if(!inst.RendersToOwnZPlane()||wi.GetDepth()>0)postRenderInstances.push(inst);var startZ=inst.GetWorldInfo().GetTotalZElevation();coplanarInstances.push(inst);var endIndex=i+1;for(;endIndex<len;++endIndex){var nextInst=instances[endIndex];var nextWi=nextInst.GetWorldInfo();if(!nextWi.IsVisible()||!nextWi.IsInViewport3D(viewFrustum))continue;if(nextWi.GetTotalZElevation()!==startZ)break;if(!nextInst.RendersToOwnZPlane()){postRenderInstances.push(nextInst);continue;}if(nextWi.GetDepth()>0)postRenderInstances.push(nextInst);coplanarInstances.push(nextInst);}if(coplanarInstances.length===1&&!coplanarInstances[0].MustMitigateZFighting()){this._DrawInstanceMaybeWithEffects(inst,wi,renderer,renderTarget);for(var j=0,lenj=postRenderInstances.length;j<lenj;++j){var postInst=postRenderInstances[j];if(postInst===inst)continue;var postWi=postInst.GetWorldInfo();var postWiLayer=postWi.GetLayer();postWiLayer._DrawInstanceMaybeWithEffects(postInst,postWi,renderer,renderTarget);}}else{this._DrawCoplanarInstances_3DCamera(renderer,coplanarInstances);for(var _j=0,_lenj=postRenderInstances.length;_j<_lenj;++_j){var _postInst=postRenderInstances[_j];var _postWi=_postInst.GetWorldInfo();_postWi._SetDrawNonBackFacesOnly(true);this._DrawInstanceMaybeWithEffects(_postInst,_postWi,renderer,renderTarget);_postWi._SetDrawNonBackFacesOnly(false);}}i=endIndex;_C87.clearArray(coplanarInstances);_C87.clearArray(postRenderInstances);}}},{key:"_DrawCoplanarInstances_3DCamera",value:function _DrawCoplanarInstances_3DCamera(renderer,instances){var renderTarget=this._curRenderTarget;renderer.CoplanarStartStencilPass();for(var i=0,len=instances.length;i<len;++i){var inst=instances[i];var wi=inst.GetWorldInfo();wi._SetDrawBackFaceOnly(true);this._DrawInstance(inst,wi,renderer);}renderer.CoplanarStartColorPass();for(var _i35=0,_len35=instances.length;_i35<_len35;++_i35){var _inst3=instances[_i35];var _wi=_inst3.GetWorldInfo();this._DrawInstanceMaybeWithEffects(_inst3,_wi,renderer,renderTarget);_wi._SetDrawBackFaceOnly(false);}renderer.CoplanarRestoreStandardRendering();}},{key:"_DrawInstances_RenderCells",value:function _DrawInstances_RenderCells(renderer){var renderGrid=this._renderGrid;var curRenderCells=this._curRenderCells;var lastRenderCells=this._lastRenderCells;var viewport=this.GetViewport();var instancesToDraw;curRenderCells.set(renderGrid.XToCell(viewport.getLeft()),renderGrid.YToCell(viewport.getTop()),renderGrid.XToCell(viewport.getRight()),renderGrid.YToCell(viewport.getBottom()));if(!this._isRenderListUpToDate||!curRenderCells.equals(lastRenderCells)){instancesToDraw=this._GetRenderCellInstancesToDraw();this._isRenderListUpToDate=true;lastRenderCells.copy(curRenderCells);}else instancesToDraw=this._lastRenderList;this._DrawInstances(renderer,instancesToDraw);if(instancesToDraw!==this._lastRenderList)_C87.shallowAssignArray(this._lastRenderList,instancesToDraw);}},{key:"_DrawInstanceMaybeWithEffects",value:function _DrawInstanceMaybeWithEffects(inst,wi,renderer,renderTarget){if(wi.HasAnyActiveEffect())this._DrawInstanceWithEffectsAndRestore(inst,wi,renderer,renderTarget);else this._DrawInstance(inst,wi,renderer);}},{key:"_DrawInstance",value:function _DrawInstance(inst,wi,renderer){var wiStateGroup=wi.GetRendererStateGroup();if(renderer.GetCurrentStateGroup()!==wiStateGroup)wiStateGroup.Apply();inst.Draw(renderer);}},{key:"_DrawInstanceWithEffectsAndRestore",value:function _DrawInstanceWithEffectsAndRestore(inst,wi,renderer,renderTarget){if(this._DrawInstanceWithEffects(inst,wi,renderer,renderTarget,null))this._SetTransform(renderer);}},{key:"_DrawInstanceWithEffects",value:function _DrawInstanceWithEffects(inst,wi,renderer,renderTarget,opts){var effectChain=wi.GetInstanceEffectList().GetEffectChain();effectChain.Render(renderer,renderTarget,{contentObject:inst,blendMode:wi.GetBlendMode(),devicePixelRatio:this._runtime.GetEffectDevicePixelRatioParam(),time:inst.GetInstanceGameTime(),layerScale:this._runtime.GetEffectLayerScaleParam()*this.GetNormalScale(),layerAngle:this.GetAngle(),layoutRect:wi.GetBoundingBox(),drawSurfaceRect:effectChain.CanSkipCalculatingDrawSurfaceRect()?null:this._InstanceBoxToDrawSurface(wi),drawContentHook:opts&&opts.drawContentHook,compositOffX:opts&&opts.compositOffX,compositOffY:opts&&opts.compositOffY,updateOwnProjection:opts&&opts.updateOwnProjection});renderer.SetBaseZ(this.GetZElevation());return effectChain.DidChangeTransform();}},{key:"_DrawLayerOwnTextureToRenderTarget",value:function _DrawLayerOwnTextureToRenderTarget(renderer,ownRenderTarget,destinationRenderTarget,isFirstToTarget){var activeEffectTypes=this._effectList.GetActiveEffectTypes();var runtime=this._runtime;if(activeEffectTypes.length===0){renderer.SetRenderTarget(destinationRenderTarget);renderer.SetTextureFillMode();if(isFirstToTarget&&this._blendMode===0&&this.HasDefaultColor())renderer.CopyRenderTarget(ownRenderTarget);else{renderer.SetBlendMode(this._blendMode);renderer.SetColor(this._premultipliedColor);renderer.DrawRenderTarget(ownRenderTarget);}renderer.InvalidateRenderTarget(ownRenderTarget);runtime.ReleaseAdditionalRenderTarget(ownRenderTarget);}else this.GetEffectChain().Render(renderer,destinationRenderTarget,{contentObject:this,blendMode:this.GetBlendMode(),devicePixelRatio:runtime.GetEffectDevicePixelRatioParam(),layerScale:runtime.GetEffectLayerScaleParam()*this.GetNormalScale(),layerAngle:this.GetAngle(),layoutRect:this.GetViewport(),drawSurfaceRect:null,invalidateRenderTargets:true});}},{key:"GetOwnScale",value:function GetOwnScale(){return this._scale;}},{key:"SetOwnScale",value:function SetOwnScale(s){if(this._scale===s)return;this._scale=s;this._layout.BoundScrolling();this._SetMVMatrixChanged();this._runtime.UpdateRender();}},{key:"GetRenderScale",value:function GetRenderScale(){return this.GetNormalScale()*this._runtime.GetRenderScale();}},{key:"GetDisplayScale",value:function GetDisplayScale(){return this.GetNormalScale()*this._runtime.GetDisplayScale();}},{key:"GetNormalScale",value:function GetNormalScale(){return(this._scale*this._layout.GetScale()-1)*this._scaleRate+1;}},{key:"_MaybeUpdateViewport",value:function _MaybeUpdateViewport(){if(!this._isViewportChanged)return;this._isViewportChanged=false;var parallaxOriginX=this._runtime.GetParallaxXOrigin();var parallaxOriginY=this._runtime.GetParallaxYOrigin();var scrollOriginX=(this.GetScrollX()-parallaxOriginX)*this._parallaxX+parallaxOriginX;var scrollOriginY=(this.GetScrollY()-parallaxOriginY)*this._parallaxY+parallaxOriginY;var normalScale=this.GetNormalScale();var scaledViewportWidth=this._runtime.GetViewportWidth()/normalScale;var scaledViewportHeight=this._runtime.GetViewportHeight()/normalScale;var px=scrollOriginX-scaledViewportWidth/2;var py=scrollOriginY-scaledViewportHeight/2;if(this._runtime.IsPixelRoundingEnabled()){px=Math.round(px);py=Math.round(py);}var viewportZ0=this._viewportZ0;viewportZ0.set(px,py,px+scaledViewportWidth,py+scaledViewportHeight);var myAngle=this.GetAngle();if(myAngle!==0){_tmpRect2.copy(viewportZ0);_tmpRect2.offset(-viewportZ0.midX(),-viewportZ0.midY());_tmpQuad2.setFromRotatedRect(_tmpRect2,myAngle);_tmpQuad2.getBoundingBox(_tmpRect2);_tmpRect2.offset(viewportZ0.midX(),viewportZ0.midY());viewportZ0.copy(_tmpRect2);}var layerZ=this._zElevation;this.GetViewportForZ(layerZ,this._viewport);if(this.Has3DCamera())this.CalculateViewport3D(layerZ,this._viewport3D);else this._viewport3D.copy(this._viewport);}},{key:"CalculateViewport3D",value:function CalculateViewport3D(z,outRect){var canvasManager=this._runtime.GetCanvasManager();var canvasWidth=canvasManager.GetCssWidth();var canvasHeight=canvasManager.GetCssHeight();var _this$CanvasCssToLaye=this.CanvasCssToLayer(0,0,z),_this$CanvasCssToLaye2=_slicedToArray(_this$CanvasCssToLaye,2),tlx=_this$CanvasCssToLaye2[0],tly=_this$CanvasCssToLaye2[1];var _this$CanvasCssToLaye3=this.CanvasCssToLayer(canvasWidth,0,z),_this$CanvasCssToLaye4=_slicedToArray(_this$CanvasCssToLaye3,2),trx=_this$CanvasCssToLaye4[0],try_=_this$CanvasCssToLaye4[1];var _this$CanvasCssToLaye5=this.CanvasCssToLayer(canvasWidth,canvasHeight,z),_this$CanvasCssToLaye6=_slicedToArray(_this$CanvasCssToLaye5,2),brx=_this$CanvasCssToLaye6[0],bry=_this$CanvasCssToLaye6[1];var _this$CanvasCssToLaye7=this.CanvasCssToLayer(0,canvasHeight,z),_this$CanvasCssToLaye8=_slicedToArray(_this$CanvasCssToLaye7,2),blx=_this$CanvasCssToLaye8[0],bly=_this$CanvasCssToLaye8[1];var left=Math.min(tlx,trx,brx,blx);var top=Math.min(tly,try_,bry,bly);var right=Math.max(tlx,trx,brx,blx);var bottom=Math.max(tly,try_,bry,bly);if(!isFinite(left))left=-Infinity;if(!isFinite(top))top=-Infinity;if(!isFinite(right))right=Infinity;if(!isFinite(bottom))bottom=Infinity;outRect.set(left,top,right,bottom);}},{key:"CanvasCssToLayer",value:function CanvasCssToLayer(ptx,pty){var z=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;return this._CanvasToLayer(ptx,pty,z,this.GetDisplayScale());}},{key:"DrawSurfaceToLayer",value:function DrawSurfaceToLayer(ptx,pty){var z=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;return this._CanvasToLayer(ptx,pty,z,this.GetRenderScale()*this.GetDevicePixelRatio());}},{key:"_CanvasToLayer",value:function _CanvasToLayer(canvasX,canvasY,zElevation,displayScale){var runtime=this._runtime;var renderer=runtime.GetRenderer();var normalScale=this.GetNormalScale();var scaledViewportWidth=runtime.GetViewportWidth()/normalScale;var scaledViewportHeight=runtime.GetViewportHeight()/normalScale;var viewport=_tempVec;_vec9.set(viewport,0,0,scaledViewportWidth,scaledViewportHeight);canvasX=canvasX/displayScale;canvasY=viewport[3]-canvasY/displayScale;var matP=this._GetProjectionMatrix(renderer);var matMV=this._GetModelViewMatrix(renderer);var objectCoord=tempVec3;var result=_C87.Gfx.UnprojectScreenToWorldZ(canvasX,canvasY,zElevation,matMV,matP,viewport,objectCoord);if(result)return[objectCoord[0],objectCoord[1]];else return[NaN,NaN];}},{key:"CanvasCssToLayer_DefaultTransform",value:function CanvasCssToLayer_DefaultTransform(ptx,pty){var scale=this._scale;var scaleRate=this._scaleRate;var parallaxX=this._parallaxX;var parallaxY=this._parallaxY;var angle=this._angle;this._scale=1;this._scaleRate=1;this._parallaxX=1;this._parallaxY=1;this._angle=0;this._SetMVMatrixChanged();var ret=this.CanvasCssToLayer(ptx,pty);this._scale=scale;this._scaleRate=scaleRate;this._parallaxX=parallaxX;this._parallaxY=parallaxY;this._angle=angle;this._SetMVMatrixChanged();return ret;}},{key:"LayerToCanvasCss",value:function LayerToCanvasCss(ptx,pty){var z=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;return this._LayerToCanvas(ptx,pty,z,this.GetDisplayScale());}},{key:"LayerToDrawSurface",value:function LayerToDrawSurface(ptx,pty){var z=arguments.length>2&&arguments[2]!==undefined?arguments[2]:0;return this._LayerToCanvas(ptx,pty,z,this.GetRenderScale()*this.GetDevicePixelRatio());}},{key:"_LayerToCanvas",value:function _LayerToCanvas(layerX,layerY,zElevation,displayScale){var runtime=this._runtime;var renderer=runtime.GetRenderer();var normalScale=this.GetNormalScale();var scaledViewportWidth=runtime.GetViewportWidth()/normalScale;var scaledViewportHeight=runtime.GetViewportHeight()/normalScale;var viewport=_tempVec;_vec9.set(viewport,0,0,scaledViewportWidth,scaledViewportHeight);var matP=this._GetProjectionMatrix(renderer);var matMV=this._GetModelViewMatrix(renderer);var windowCoord=tempVec3;var result=_C87.Gfx.Project(layerX,layerY,zElevation,matMV,matP,viewport,windowCoord);if(result)return[windowCoord[0]*displayScale,(viewport[3]-windowCoord[1])*displayScale];else return[NaN,NaN];}},{key:"_GetLayerToDrawSurfaceScale",value:function _GetLayerToDrawSurfaceScale(size,zElevation){size*=this.GetRenderScale()*this.GetDevicePixelRatio();if(zElevation!==0)size*=this.Get2DScaleFactorToZ(zElevation);return size;}},{key:"_InstanceBoxToDrawSurface",value:function _InstanceBoxToDrawSurface(wi){var bbox=wi.GetBoundingBox();var z=wi.GetTotalZElevation();var depth=wi.GetDepth();var topZ=z+depth;var bbLeft=bbox.getLeft();var bbTop=bbox.getTop();var bbRight=bbox.getRight();var bbBottom=bbox.getBottom();if(this.Has3DCamera()){if(this._IsPointBehindNearPlane(bbLeft,bbTop,z)||this._IsPointBehindNearPlane(bbRight,bbTop,z)||this._IsPointBehindNearPlane(bbRight,bbBottom,z)||this._IsPointBehindNearPlane(bbLeft,bbBottom,z))return null;if(depth>0)if(this._IsPointBehindNearPlane(bbLeft,bbTop,topZ)||this._IsPointBehindNearPlane(bbRight,bbTop,topZ)||this._IsPointBehindNearPlane(bbRight,bbBottom,topZ)||this._IsPointBehindNearPlane(bbLeft,bbBottom,topZ))return null;}else if(topZ>=this.GetCameraZ())return null;var _this$LayerToDrawSurf=this.LayerToDrawSurface(bbLeft,bbTop,z),_this$LayerToDrawSurf2=_slicedToArray(_this$LayerToDrawSurf,2),stlx=_this$LayerToDrawSurf2[0],stly=_this$LayerToDrawSurf2[1];var _this$LayerToDrawSurf3=this.LayerToDrawSurface(bbRight,bbBottom,z),_this$LayerToDrawSurf4=_slicedToArray(_this$LayerToDrawSurf3,2),sbrx=_this$LayerToDrawSurf4[0],sbry=_this$LayerToDrawSurf4[1];if(this.GetAngle()!==0||depth>0||this.Has3DCamera()){var _this$LayerToDrawSurf5=this.LayerToDrawSurface(bbRight,bbTop,z),_this$LayerToDrawSurf6=_slicedToArray(_this$LayerToDrawSurf5,2),strx=_this$LayerToDrawSurf6[0],stry=_this$LayerToDrawSurf6[1];var _this$LayerToDrawSurf7=this.LayerToDrawSurface(bbLeft,bbBottom,z),_this$LayerToDrawSurf8=_slicedToArray(_this$LayerToDrawSurf7,2),sblx=_this$LayerToDrawSurf8[0],sbly=_this$LayerToDrawSurf8[1];if(depth>0){var _this$LayerToDrawSurf9=this.LayerToDrawSurface(bbLeft,bbTop,topZ),_this$LayerToDrawSurf10=_slicedToArray(_this$LayerToDrawSurf9,2),stlxTop=_this$LayerToDrawSurf10[0],stlyTop=_this$LayerToDrawSurf10[1];var _this$LayerToDrawSurf11=this.LayerToDrawSurface(bbRight,bbTop,topZ),_this$LayerToDrawSurf12=_slicedToArray(_this$LayerToDrawSurf11,2),strxTop=_this$LayerToDrawSurf12[0],stryTop=_this$LayerToDrawSurf12[1];var _this$LayerToDrawSurf13=this.LayerToDrawSurface(bbRight,bbBottom,topZ),_this$LayerToDrawSurf14=_slicedToArray(_this$LayerToDrawSurf13,2),sbrxTop=_this$LayerToDrawSurf14[0],sbryTop=_this$LayerToDrawSurf14[1];var _this$LayerToDrawSurf15=this.LayerToDrawSurface(bbLeft,bbBottom,topZ),_this$LayerToDrawSurf16=_slicedToArray(_this$LayerToDrawSurf15,2),sblxTop=_this$LayerToDrawSurf16[0],sblyTop=_this$LayerToDrawSurf16[1];var temp=Math.min(stlx,sbrx,strx,sblx,stlxTop,strxTop,sbrxTop,sblxTop);sbrx=Math.max(stlx,sbrx,strx,sblx,stlxTop,strxTop,sbrxTop,sblxTop);stlx=temp;temp=Math.min(stly,sbry,stry,sbly,stlyTop,stryTop,sbryTop,sblyTop);sbry=Math.max(stly,sbry,stry,sbly,stlyTop,stryTop,sbryTop,sblyTop);stly=temp;}else{var _temp=Math.min(stlx,sbrx,strx,sblx);sbrx=Math.max(stlx,sbrx,strx,sblx);stlx=_temp;_temp=Math.min(stly,sbry,stry,sbly);sbry=Math.max(stly,sbry,stry,sbly);stly=_temp;}}_tmpRect2.set(stlx,stly,sbrx,sbry);return _tmpRect2;}},{key:"_GetViewFrustum",value:function _GetViewFrustum(){if(this._isViewFrustumChanged){this._UpdateViewFrustum();this._isViewFrustumChanged=false;}return this._viewFrustum;}},{key:"_UpdateViewFrustum",value:function _UpdateViewFrustum(){var renderer=this._runtime.GetRenderer();var matP=this._GetProjectionMatrix(renderer);var matMV=this._GetModelViewMatrix(renderer);this._viewFrustum.CalculatePlanes(matMV,matP);}},{key:"_IsPointBehindNearPlane",value:function _IsPointBehindNearPlane(x,y,z){return this._GetViewFrustum().IsBehindNearPlane(x,y,z);}},{key:"_SaveToJson",value:function _SaveToJson(){var o={"d":this.IsDynamic(),"s":this.GetOwnScale(),"a":this.GetOwnAngle(),"v":this._IsVisibleFlagSet(),"i":this.IsInteractive(),"html":this.IsHTMLElementsLayer(),"bc":this._backgroundColor.toJSON(),"t":this.IsTransparent(),"sx":this._scrollX,"sy":this._scrollY,"hosp":this._hasOwnScrollPosition,"px":this.GetParallaxX(),"py":this.GetParallaxY(),"c":this._color.toJSON(),"sr":this.GetScaleRate(),"fx":this._effectList.SaveToJson(),"cg":this._createdGlobalUids};return o;}},{key:"_LoadFromJson",value:function _LoadFromJson(o){this._isDynamic=!!o["d"];this._scale=o["s"];this._angle=o["a"];this._isVisible=!!o["v"];this._isInteractive=o.hasOwnProperty("i")?o["i"]:true;this._isHTMLElementsLayer=!!o["html"];this._backgroundColor.setFromJSON(o["bc"]);this._isTransparent=!!o["t"];if(o.hasOwnProperty("sx"))this._scrollX=o["sx"];if(o.hasOwnProperty("sy"))this._scrollY=o["sy"];if(o.hasOwnProperty("hosp"))this._hasOwnScrollPosition=!!o["hosp"];this._parallaxX=o["px"];this._parallaxY=o["py"];this._color.setFromJSON(o["c"]);this._UpdatePremultipliedColor();this._scaleRate=o["sr"];_C87.shallowAssignArray(this._createdGlobalUids,o["cg"]);_C87.shallowAssignArray(this._initialInstances,this._startupInitialInstances);var tempSet=new Set(this._createdGlobalUids);var j=0;for(var i=0,len=this._initialInstances.length;i<len;++i){if(!tempSet.has(this._initialInstances[i][2])){this._initialInstances[j]=this._initialInstances[i];++j;}}_C87.truncateArray(this._initialInstances,j);this._effectList.LoadFromJson(o["fx"]);this._needsRebuildEffectChainSteps=true;}},{key:"_LoadFromJsonAfterInstances",value:function _LoadFromJsonAfterInstances(){this._SortInstancesByLastCachedZIndex(false);this.SetZIndicesChanged();this._SetMVMatrixChanged();this._SetProjectionMatrixChanged();}},{key:"GetILayer",value:function GetILayer(){return this._iLayer;}},{key:"SortAndAddInstancesByZIndex",value:function SortAndAddInstancesByZIndex(inst){var sortExisting=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(this._instances.includes(inst)){if(sortExisting)this._instances.sort(function(f,s){var firstZIndex=f.GetWorldInfo().GetSceneGraphZIndex();var secondZIndex=s.GetWorldInfo().GetSceneGraphZIndex();return firstZIndex-secondZIndex;});return;}if(inst.HasChildren()){var _instances=_toConsumableArray(inst.allChildren());_instances.push(inst);_instances.sort(function(f,s){var firstZIndex=f.GetWorldInfo().GetSceneGraphZIndex();var secondZIndex=s.GetWorldInfo().GetSceneGraphZIndex();return firstZIndex-secondZIndex;});var _iteratorNormalCompletion146=true;var _didIteratorError146=false;var _iteratorError146=undefined;try{for(var _iterator146=_instances[Symbol.iterator](),_step146;!(_iteratorNormalCompletion146=(_step146=_iterator146.next()).done);_iteratorNormalCompletion146=true){var instanceToAdd=_step146.value;if(!instanceToAdd.IsInContainer())continue;var _iteratorNormalCompletion148=true;var _didIteratorError148=false;var _iteratorError148=undefined;try{for(var _iterator148=instanceToAdd.siblings()[Symbol.iterator](),_step148;!(_iteratorNormalCompletion148=(_step148=_iterator148.next()).done);_iteratorNormalCompletion148=true){var instanceToAddSibling=_step148.value;if(_instances.includes(instanceToAddSibling))continue;var siblingAndChildren=_toConsumableArray(instanceToAddSibling.allChildren());siblingAndChildren.push(instanceToAddSibling);siblingAndChildren.sort(function(f,s){var firstZIndex=f.GetWorldInfo().GetSceneGraphZIndex();var secondZIndex=s.GetWorldInfo().GetSceneGraphZIndex();return firstZIndex-secondZIndex;});if(!siblingAndChildren||!siblingAndChildren.length)continue;_instances.splice.apply(_instances,[_instances.length,0].concat(_toConsumableArray(siblingAndChildren)));}}catch(err){_didIteratorError148=true;_iteratorError148=err;}finally{try{if(!_iteratorNormalCompletion148&&_iterator148["return"]!=null){_iterator148["return"]();}}finally{if(_didIteratorError148){throw _iteratorError148;}}}}}catch(err){_didIteratorError146=true;_iteratorError146=err;}finally{try{if(!_iteratorNormalCompletion146&&_iterator146["return"]!=null){_iterator146["return"]();}}finally{if(_didIteratorError146){throw _iteratorError146;}}}var _iteratorNormalCompletion147=true;var _didIteratorError147=false;var _iteratorError147=undefined;try{for(var _iterator147=_instances[Symbol.iterator](),_step147;!(_iteratorNormalCompletion147=(_step147=_iterator147.next()).done);_iteratorNormalCompletion147=true){var instance=_step147.value;if(instance.GetPlugin().IsWorldType())this._AddInstance(instance,true);}}catch(err){_didIteratorError147=true;_iteratorError147=err;}finally{try{if(!_iteratorNormalCompletion147&&_iterator147["return"]!=null){_iterator147["return"]();}}finally{if(_didIteratorError147){throw _iteratorError147;}}}}else{if(inst.GetPlugin().IsWorldType())this._AddInstance(inst,true);if(!inst.IsInContainer())return;var _iteratorNormalCompletion149=true;var _didIteratorError149=false;var _iteratorError149=undefined;try{for(var _iterator149=inst.siblings()[Symbol.iterator](),_step149;!(_iteratorNormalCompletion149=(_step149=_iterator149.next()).done);_iteratorNormalCompletion149=true){var sibling=_step149.value;var _siblingAndChildren=_toConsumableArray(sibling.allChildren());_siblingAndChildren.push(sibling);_siblingAndChildren.sort(function(f,s){var firstZIndex=f.GetWorldInfo().GetSceneGraphZIndex();var secondZIndex=s.GetWorldInfo().GetSceneGraphZIndex();return firstZIndex-secondZIndex;});if(!_siblingAndChildren||!_siblingAndChildren.length)continue;var _iteratorNormalCompletion150=true;var _didIteratorError150=false;var _iteratorError150=undefined;try{for(var _iterator150=_siblingAndChildren[Symbol.iterator](),_step150;!(_iteratorNormalCompletion150=(_step150=_iterator150.next()).done);_iteratorNormalCompletion150=true){var _instance=_step150.value;if(_instance.GetPlugin().IsWorldType())this._AddInstance(_instance,true);}}catch(err){_didIteratorError150=true;_iteratorError150=err;}finally{try{if(!_iteratorNormalCompletion150&&_iterator150["return"]!=null){_iterator150["return"]();}}finally{if(_didIteratorError150){throw _iteratorError150;}}}}}catch(err){_didIteratorError149=true;_iteratorError149=err;}finally{try{if(!_iteratorNormalCompletion149&&_iterator149["return"]!=null){_iterator149["return"]();}}finally{if(_didIteratorError149){throw _iteratorError149;}}}}}}],[{key:"CreateFromExportData",value:function CreateFromExportData(layout,parentLayer,data){return _C87.New(_C87.Layer,layout,parentLayer,{name:data[0],sid:data[2],isVisible:data[3],isInteractive:data[13],isHTMLElementsLayer:data[19],backgroundColor:data[4].map(function(x){return x/255;}),isTransparent:data[5],parallax:[data[6],data[7]],opacity:data[8],isForceOwnTexture:data[9],renderAs3d:data[17],useCameraDistanceDrawOrder:data[18],useRenderCells:data[10],scaleRate:data[11],blendMode:data[12],zElevation:data[16],initialInstancesData:data[14],effectListData:data[15],subLayersData:data[20]});}}]);return Layer;}(_C87.DefendedBase);}// layouts/layout.js
{var vec3EqualsXYZ=function vec3EqualsXYZ(v,x,y,z){return v[0]===Math.fround(x)&&v[1]===Math.fround(y)&&v[2]===Math.fround(z);};var MaybePrepareLayerDraw=function MaybePrepareLayerDraw(layer,renderer){if(lastLayerPreparedForDrawing===layer)return;layer.PrepareForDraw(renderer);lastLayerPreparedForDrawing=layer;};'use strict';var _C88=self.C3;var C3Debugger=self.C3Debugger;var _assert8=self.assert;var tempDestRect=_C88.New(_C88.Rect);var tempSrcRect=_C88.New(_C88.Rect);var tempLayoutRect=_C88.New(_C88.Rect);var _tempColor4=_C88.New(_C88.Color);var _glMatrix9=self.glMatrix;var _vec10=_glMatrix9.vec3;var tempRender3dList=[];var _tempInstanceList=[];var _tempInstanceList2=[];var tempInstanceList3=[];var lastLayerPreparedForDrawing=null;_C88.Layout=/*#__PURE__*/function(_C88$DefendedBase){_inherits(Layout,_C88$DefendedBase);function Layout(layoutManager,index,data){var _this41;_classCallCheck(this,Layout);_this41=_possibleConstructorReturn(this,_getPrototypeOf(Layout).call(this));_this41._layoutManager=layoutManager;_this41._runtime=layoutManager.GetRuntime();_this41._name=data[0];_this41._originalWidth=data[1];_this41._originalHeight=data[2];_this41._width=data[1];_this41._height=data[2];_this41._isUnboundedScrolling=!!data[3];_this41._isOrthographicProjection=!!data[4];_this41._vanishingPointX=data[5];_this41._vanishingPointY=data[6];_this41._eventSheetName=data[7];_this41._eventSheet=null;_this41._sid=data[8];_this41._index=index;_this41._scrollX=0;_this41._scrollY=0;_this41._scale=1;_this41._angle=0;_this41._initialObjectClasses=new Set();_this41._textureLoadedTypes=new Set();_this41._textureLoadPendingPromises=new Set();_this41._createdInstances=[];_this41._createdPersistedInstances=[];_this41._createdPersistedInstancesToDataMap=new Map();_this41._createdPersistedIndexToInstanceMap=new Map();_this41._initialNonWorld=[];_this41._is3dCameraEnabled=false;_this41._cam3dposition=_vec10.create();_this41._cam3dlook=_vec10.create();_this41._cam3dup=_vec10.create();_this41._rootLayers=[];_this41._allLayersFlat=[];_this41._layersByName=new Map();_this41._layersBySid=new Map();_this41._pendingSetHTMLLayerCount=-1;var canvasManager=_this41._runtime.GetCanvasManager();_this41._effectList=_C88.New(_C88.EffectList,_assertThisInitialized(_this41),data[11]);_this41._effectChain=_C88.New(_C88.Gfx.EffectChain,canvasManager.GetEffectChainManager(),{drawContent:function drawContent(renderer,effectChain){var layout=effectChain.GetContentObject();var renderSurface=layout.GetRenderTarget();renderer.ResetColor();renderer.DrawRenderTarget(renderSurface);renderer.InvalidateRenderTarget(renderSurface);canvasManager.ReleaseAdditionalRenderTarget(renderSurface);},getShaderParameters:function getShaderParameters(index){return _this41.GetEffectList()._GetEffectChainShaderParametersForIndex(index);}});_this41._needsRebuildEffectChainSteps=true;_this41._wasFullScreenQualityLow=false;_this41._curRenderTarget=null;_this41._persistData={};_this41._persistedIntances=new Map();_this41._isFirstVisit=true;_this41._iLayout=new self.ILayout(_assertThisInitialized(_this41));_this41._userScriptDispatcher=_C88.New(_C88.Event.Dispatcher);var _iteratorNormalCompletion151=true;var _didIteratorError151=false;var _iteratorError151=undefined;try{for(var _iterator151=data[9][Symbol.iterator](),_step151;!(_iteratorNormalCompletion151=(_step151=_iterator151.next()).done);_iteratorNormalCompletion151=true){var layerData=_step151.value;_this41._rootLayers.push(_C88.Layer.CreateFromExportData(_assertThisInitialized(_this41),null,layerData));}}catch(err){_didIteratorError151=true;_iteratorError151=err;}finally{try{if(!_iteratorNormalCompletion151&&_iterator151["return"]!=null){_iterator151["return"]();}}finally{if(_didIteratorError151){throw _iteratorError151;}}}_this41._ReindexLayers();var _iteratorNormalCompletion152=true;var _didIteratorError152=false;var _iteratorError152=undefined;try{for(var _iterator152=_this41.allLayers()[Symbol.iterator](),_step152;!(_iteratorNormalCompletion152=(_step152=_iterator152.next()).done);_iteratorNormalCompletion152=true){var layer=_step152.value;layer._InitInitialInstances();}}catch(err){_didIteratorError152=true;_iteratorError152=err;}finally{try{if(!_iteratorNormalCompletion152&&_iterator152["return"]!=null){_iterator152["return"]();}}finally{if(_didIteratorError152){throw _iteratorError152;}}}var _iteratorNormalCompletion153=true;var _didIteratorError153=false;var _iteratorError153=undefined;try{for(var _iterator153=data[10][Symbol.iterator](),_step153;!(_iteratorNormalCompletion153=(_step153=_iterator153.next()).done);_iteratorNormalCompletion153=true){var instData=_step153.value;var objectClass=_this41._runtime.GetObjectClassByIndex(instData[1]);if(!objectClass)throw new Error("missing nonworld object class");if(!objectClass.GetDefaultInstanceData())objectClass.SetDefaultInstanceData(instData);_this41._initialNonWorld.push(instData);_this41._AddInitialObjectClass(objectClass);}}catch(err){_didIteratorError153=true;_iteratorError153=err;}finally{try{if(!_iteratorNormalCompletion153&&_iterator153["return"]!=null){_iterator153["return"]();}}finally{if(_didIteratorError153){throw _iteratorError153;}}}return _this41;}_createClass(Layout,[{key:"Release",value:function Release(){var _iteratorNormalCompletion154=true;var _didIteratorError154=false;var _iteratorError154=undefined;try{for(var _iterator154=this._allLayersFlat[Symbol.iterator](),_step154;!(_iteratorNormalCompletion154=(_step154=_iterator154.next()).done);_iteratorNormalCompletion154=true){var l=_step154.value;l.Release();}}catch(err){_didIteratorError154=true;_iteratorError154=err;}finally{try{if(!_iteratorNormalCompletion154&&_iterator154["return"]!=null){_iterator154["return"]();}}finally{if(_didIteratorError154){throw _iteratorError154;}}}_C88.clearArray(this._allLayersFlat);this._textureLoadPendingPromises.clear();this._eventSheet=null;this._layoutManager=null;this._runtime=null;}},{key:"GetRuntime",value:function GetRuntime(){return this._runtime;}},{key:"GetName",value:function GetName(){return this._name;}},{key:"GetSID",value:function GetSID(){return this._sid;}},{key:"GetIndex",value:function GetIndex(){return this._index;}},{key:"GetEffectList",value:function GetEffectList(){return this._effectList;}},{key:"GetEffectChain",value:function GetEffectChain(){this._MaybeRebuildEffectChainSteps();return this._effectChain;}},{key:"_MaybeRebuildEffectChainSteps",value:function _MaybeRebuildEffectChainSteps(){var isFullscreenQualityLow=this._runtime.GetCanvasManager().GetCurrentFullscreenScalingQuality()==="low";if(!this._needsRebuildEffectChainSteps&&this._wasFullScreenQualityLow===isFullscreenQualityLow&&!this._effectChain.NeedsRebuild())return;var activeEffectTypes=this.GetEffectList().GetActiveEffectTypes();this._effectChain.BuildSteps(activeEffectTypes.map(function(e){return e.GetShaderProgram();}),{indexMap:activeEffectTypes.map(function(e){return e.GetIndex();}),forcePostDraw:isFullscreenQualityLow,useFullSurface:true});this._needsRebuildEffectChainSteps=false;this._wasFullScreenQualityLow=isFullscreenQualityLow;}},{key:"UpdateActiveEffects",value:function UpdateActiveEffects(){this.GetEffectList().UpdateActiveEffects();this._needsRebuildEffectChainSteps=true;}},{key:"GetMinLayerScale",value:function GetMinLayerScale(){var m=this._allLayersFlat[0].GetNormalScale();for(var i=1,len=this._allLayersFlat.length;i<len;++i){var layer=this._allLayersFlat[i];if(layer.GetParallaxX()===0&&layer.GetParallaxY()===0)continue;m=Math.min(m,layer.GetNormalScale());}return m;}},{key:"_GetScrollBoundMarginHorizontal",value:function _GetScrollBoundMarginHorizontal(){return .5*this._runtime.GetViewportWidth()/this.GetMinLayerScale();}},{key:"_GetScrollBoundMarginVertical",value:function _GetScrollBoundMarginVertical(){return .5*this._runtime.GetViewportHeight()/this.GetMinLayerScale();}},{key:"GetScrollLeftBound",value:function GetScrollLeftBound(){if(this.IsUnboundedScrolling())return-Infinity;else return this._GetScrollBoundMarginHorizontal();}},{key:"GetScrollRightBound",value:function GetScrollRightBound(){if(this.IsUnboundedScrolling())return Infinity;else return this.GetWidth()-this._GetScrollBoundMarginHorizontal();}},{key:"GetScrollTopBound",value:function GetScrollTopBound(){if(this.IsUnboundedScrolling())return-Infinity;else return this._GetScrollBoundMarginVertical();}},{key:"GetScrollBottomBound",value:function GetScrollBottomBound(){if(this.IsUnboundedScrolling())return Infinity;else return this.GetHeight()-this._GetScrollBoundMarginVertical();}},{key:"SetScrollX",value:function SetScrollX(x){var lbound=this.GetScrollLeftBound();var rbound=this.GetScrollRightBound();if(x>rbound)x=rbound;if(x<lbound)x=lbound;if(this._scrollX!==x){this._scrollX=x;this._SetAllLayersMVChanged();this._runtime.UpdateRender();}}},{key:"GetScrollX",value:function GetScrollX(){return this._scrollX;}},{key:"SetScrollY",value:function SetScrollY(y){var ubound=this.GetScrollTopBound();var bbound=this.GetScrollBottomBound();if(y>bbound)y=bbound;if(y<ubound)y=ubound;if(this._scrollY!==y){this._scrollY=y;this._SetAllLayersMVChanged();this._runtime.UpdateRender();}}},{key:"GetScrollY",value:function GetScrollY(){return this._scrollY;}},{key:"IsUnboundedScrolling",value:function IsUnboundedScrolling(){return this._isUnboundedScrolling;}},{key:"BoundScrolling",value:function BoundScrolling(){this.SetScrollX(this.GetScrollX());this.SetScrollY(this.GetScrollY());var _iteratorNormalCompletion155=true;var _didIteratorError155=false;var _iteratorError155=undefined;try{for(var _iterator155=this._allLayersFlat[Symbol.iterator](),_step155;!(_iteratorNormalCompletion155=(_step155=_iterator155.next()).done);_iteratorNormalCompletion155=true){var layer=_step155.value;if(layer.IsOwnScrollPositionEnabled()){layer.SetScrollX(layer.GetScrollX());layer.SetScrollY(layer.GetScrollY());}}}catch(err){_didIteratorError155=true;_iteratorError155=err;}finally{try{if(!_iteratorNormalCompletion155&&_iterator155["return"]!=null){_iterator155["return"]();}}finally{if(_didIteratorError155){throw _iteratorError155;}}}}},{key:"SetVanishingPointXY",value:function SetVanishingPointXY(vpX,vpY){if(this._vanishingPointX===vpX&&this._vanishingPointY===vpY)return;this._vanishingPointX=vpX;this._vanishingPointY=vpY;if(this.IsPerspectiveProjection()){this._SetAllLayersProjectionChanged();this._SetAllLayersMVChanged();this._runtime.UpdateRender();}}},{key:"GetVanishingPointX",value:function GetVanishingPointX(){if(this.IsOrthographicProjection())return .5;else return this._vanishingPointX;}},{key:"GetVanishingPointY",value:function GetVanishingPointY(){if(this.IsOrthographicProjection())return .5;else return this._vanishingPointY;}},{key:"HasVanishingPointOutsideViewport",value:function HasVanishingPointOutsideViewport(){var vpX=this.GetVanishingPointX();var vpY=this.GetVanishingPointY();return vpX<0||vpX>1||vpY<0||vpY>1;}},{key:"SetPerspectiveProjection",value:function SetPerspectiveProjection(){if(!this._isOrthographicProjection)return;this._isOrthographicProjection=false;this._SetAllLayersProjectionChanged();this._SetAllLayersMVChanged();this._runtime.UpdateRender();}},{key:"SetOrthographicProjection",value:function SetOrthographicProjection(){if(this._isOrthographicProjection)return;this._isOrthographicProjection=true;this._SetAllLayersProjectionChanged();this._SetAllLayersMVChanged();this._runtime.UpdateRender();}},{key:"IsOrthographicProjection",value:function IsOrthographicProjection(){return this._isOrthographicProjection;}},{key:"IsPerspectiveProjection",value:function IsPerspectiveProjection(){return!this.IsOrthographicProjection();}},{key:"Set3DCameraEnabled",value:function Set3DCameraEnabled(e){e=!!e;if(this._is3dCameraEnabled===e)return;this._is3dCameraEnabled=e;this._SetAllLayersMVChanged();this._runtime.UpdateRender();}},{key:"Is3DCameraEnabled",value:function Is3DCameraEnabled(){return this._is3dCameraEnabled;}},{key:"Set3DCameraOrientation",value:function Set3DCameraOrientation(camX,camY,camZ,lookX,lookY,lookZ,upX,upY,upZ){if(vec3EqualsXYZ(this._cam3dposition,camX,camY,camZ)&&vec3EqualsXYZ(this._cam3dlook,lookX,lookY,lookZ)&&vec3EqualsXYZ(this._cam3dup,upX,upY,upZ))return;_vec10.set(this._cam3dposition,camX,camY,camZ);_vec10.set(this._cam3dlook,lookX,lookY,lookZ);_vec10.set(this._cam3dup,upX,upY,upZ);this.Set3DCameraChanged();}},{key:"Set3DCameraChanged",value:function Set3DCameraChanged(){this._SetAllLayersMVChanged();this._runtime.UpdateRender();}},{key:"Get3DCameraPosition",value:function Get3DCameraPosition(){return this._cam3dposition;}},{key:"Get3DCameraLookAt",value:function Get3DCameraLookAt(){return this._cam3dlook;}},{key:"Get3DCameraUpVector",value:function Get3DCameraUpVector(){return this._cam3dup;}},{key:"GetScale",value:function GetScale(){return this._scale;}},{key:"SetScale",value:function SetScale(s){if(this._scale===s)return;this._scale=s;this._SetAllLayersMVChanged();this.BoundScrolling();this._runtime.UpdateRender();}},{key:"SetAngle",value:function SetAngle(a){a=_C88.clampAngle(a);if(this._angle===a)return;this._angle=a;this._SetAllLayersMVChanged();this._runtime.UpdateRender();}},{key:"GetAngle",value:function GetAngle(){return this._angle;}},{key:"GetWidth",value:function GetWidth(){return this._width;}},{key:"SetWidth",value:function SetWidth(w){if(!isFinite(w)||w<1)return;this._width=w;}},{key:"GetHeight",value:function GetHeight(){return this._height;}},{key:"SetHeight",value:function SetHeight(h){if(!isFinite(h)||h<1)return;this._height=h;}},{key:"GetEventSheet",value:function GetEventSheet(){return this._eventSheet;}},{key:"_GetRootLayers",value:function _GetRootLayers(){return this._rootLayers;}},{key:"allLayers",value:/*#__PURE__*/regeneratorRuntime.mark(function allLayers(){var _iteratorNormalCompletion156,_didIteratorError156,_iteratorError156,_iterator156,_step156,rootLayer;return regeneratorRuntime.wrap(function allLayers$(_context79){while(1){switch(_context79.prev=_context79.next){case 0:_iteratorNormalCompletion156=true;_didIteratorError156=false;_iteratorError156=undefined;_context79.prev=3;_iterator156=this._rootLayers[Symbol.iterator]();case 5:if(_iteratorNormalCompletion156=(_step156=_iterator156.next()).done){_context79.next=11;break;}rootLayer=_step156.value;return _context79.delegateYield(rootLayer.selfAndAllSubLayers(),"t0",8);case 8:_iteratorNormalCompletion156=true;_context79.next=5;break;case 11:_context79.next=17;break;case 13:_context79.prev=13;_context79.t1=_context79["catch"](3);_didIteratorError156=true;_iteratorError156=_context79.t1;case 17:_context79.prev=17;_context79.prev=18;if(!_iteratorNormalCompletion156&&_iterator156["return"]!=null){_iterator156["return"]();}case 20:_context79.prev=20;if(!_didIteratorError156){_context79.next=23;break;}throw _iteratorError156;case 23:return _context79.finish(20);case 24:return _context79.finish(17);case 25:case"end":return _context79.stop();}}},allLayers,this,[[3,13,17,25],[18,,20,24]]);})},{key:"GetLayers",value:function GetLayers(){return this._allLayersFlat;}},{key:"GetLayerCount",value:function GetLayerCount(){return this._allLayersFlat.length;}},{key:"GetLayer",value:function GetLayer(p){if(typeof p==="number")return this.GetLayerByIndex(p);else return this.GetLayerByName(p.toString());}},{key:"GetLayerByIndex",value:function GetLayerByIndex(i){i=_C88.clamp(Math.floor(i),0,this._allLayersFlat.length-1);return this._allLayersFlat[i];}},{key:"GetLayerByName",value:function GetLayerByName(name){return this._layersByName.get(name.toLowerCase())||null;}},{key:"HasLayerByName",value:function HasLayerByName(name){return!!this.GetLayerByName(name);}},{key:"GetLayerBySID",value:function GetLayerBySID(sid){return this._layersBySid.get(sid)||null;}},{key:"_SetAllLayersProjectionChanged",value:function _SetAllLayersProjectionChanged(){var _iteratorNormalCompletion157=true;var _didIteratorError157=false;var _iteratorError157=undefined;try{for(var _iterator157=this._allLayersFlat[Symbol.iterator](),_step157;!(_iteratorNormalCompletion157=(_step157=_iterator157.next()).done);_iteratorNormalCompletion157=true){var layer=_step157.value;layer._SetProjectionMatrixChanged();}}catch(err){_didIteratorError157=true;_iteratorError157=err;}finally{try{if(!_iteratorNormalCompletion157&&_iterator157["return"]!=null){_iterator157["return"]();}}finally{if(_didIteratorError157){throw _iteratorError157;}}}}},{key:"_SetAllLayersMVChanged",value:function _SetAllLayersMVChanged(){var _iteratorNormalCompletion158=true;var _didIteratorError158=false;var _iteratorError158=undefined;try{for(var _iterator158=this._allLayersFlat[Symbol.iterator](),_step158;!(_iteratorNormalCompletion158=(_step158=_iterator158.next()).done);_iteratorNormalCompletion158=true){var layer=_step158.value;layer._SetMVMatrixChanged();}}catch(err){_didIteratorError158=true;_iteratorError158=err;}finally{try{if(!_iteratorNormalCompletion158&&_iterator158["return"]!=null){_iterator158["return"]();}}finally{if(_didIteratorError158){throw _iteratorError158;}}}}},{key:"AddLayer",value:function AddLayer(layerName,insertBy,where){if(this.HasLayerByName(layerName))throw new Error("layer name '".concat(layerName,"' already in use"));if(!insertBy&&where<2)throw new Error("invalid insert position");var parentLayer=where>=2?insertBy:insertBy.GetParentLayer();var layer=_C88.New(_C88.Layer,this,parentLayer,{name:layerName,sid:Math.floor(Math.random()*1E15),isDynamic:true});this._InsertLayer(layer,insertBy,where);this.GetRuntime().UpdateRender();this._ReindexAndUpdateAllLayers();}},{key:"MoveLayer",value:function MoveLayer(layer,insertBy,where){if(!insertBy&&where<2)throw new Error("invalid insert position");if(layer===insertBy&&where<2)return;this._RemoveLayer(layer);this._InsertLayer(layer,insertBy,where);this.GetRuntime().UpdateRender();this._ReindexAndUpdateAllLayers();}},{key:"RemoveLayer",value:function RemoveLayer(layer){if(this._RemoveLayer(layer)){var eventSheetManager=this._runtime.GetEventSheetManager();eventSheetManager.BlockFlushingInstances(true);layer.Release();eventSheetManager.BlockFlushingInstances(false);this.GetRuntime().UpdateRender();this._ReindexAndUpdateAllLayers();}}},{key:"RemoveAllDynamicLayers",value:function RemoveAllDynamicLayers(){var toRemove=new Set();var _iteratorNormalCompletion159=true;var _didIteratorError159=false;var _iteratorError159=undefined;try{for(var _iterator159=this.allLayers()[Symbol.iterator](),_step159;!(_iteratorNormalCompletion159=(_step159=_iterator159.next()).done);_iteratorNormalCompletion159=true){var layer=_step159.value;if(layer.IsDynamic()&&!layer.HasAnyDynamicParentLayer())toRemove.add(layer);}}catch(err){_didIteratorError159=true;_iteratorError159=err;}finally{try{if(!_iteratorNormalCompletion159&&_iterator159["return"]!=null){_iterator159["return"]();}}finally{if(_didIteratorError159){throw _iteratorError159;}}}if(toRemove.size===0)return;var eventSheetManager=this._runtime.GetEventSheetManager();eventSheetManager.BlockFlushingInstances(true);var _iteratorNormalCompletion160=true;var _didIteratorError160=false;var _iteratorError160=undefined;try{for(var _iterator160=toRemove[Symbol.iterator](),_step160;!(_iteratorNormalCompletion160=(_step160=_iterator160.next()).done);_iteratorNormalCompletion160=true){var _layer=_step160.value;this._RemoveLayer(_layer);_layer.Release();}}catch(err){_didIteratorError160=true;_iteratorError160=err;}finally{try{if(!_iteratorNormalCompletion160&&_iterator160["return"]!=null){_iterator160["return"]();}}finally{if(_didIteratorError160){throw _iteratorError160;}}}eventSheetManager.BlockFlushingInstances(false);this.GetRuntime().UpdateRender();this._ReindexAndUpdateAllLayers();}},{key:"_InsertLayer",value:function _InsertLayer(layer,insertBy,where){if(where>=2){if(insertBy){if(insertBy===layer||insertBy.HasParentLayer(layer))throw new Error("cannot move layer '".concat(layer.GetName(),"' to sub-layer of itself"));insertBy._AddSubLayer(layer,where===2);layer._SetParentLayer(insertBy);}else{if(where===2)this._rootLayers.push(layer);else this._rootLayers.unshift(layer);layer._SetParentLayer(null);}}else{var parentLayer=insertBy.GetParentLayer();if(parentLayer){if(insertBy.HasParentLayer(layer))throw new Error("cannot move layer '".concat(layer.GetName(),"' to sub-layer of itself"));parentLayer._InsertSubLayer(layer,insertBy,where===0);layer._SetParentLayer(parentLayer);}else{var i=this._rootLayers.indexOf(insertBy);if(i===-1)throw new Error("cannot find layer to insert by");if(where===0)++i;this._rootLayers.splice(i,0,layer);layer._SetParentLayer(null);}}}},{key:"_RemoveLayer",value:function _RemoveLayer(layer){var parentLayer=layer.GetParentLayer();if(parentLayer){parentLayer._RemoveSubLayer(layer);return true;}else if(this._rootLayers.length>1){var i=this._rootLayers.indexOf(layer);if(i===-1)throw new Error("cannot find layer to remove");this._rootLayers.splice(i,1);return true;}return false;}},{key:"_ReindexLayers",value:function _ReindexLayers(){this._allLayersFlat=_toConsumableArray(this.allLayers());this._layersByName.clear();this._layersBySid.clear();for(var i=0,len=this._allLayersFlat.length;i<len;++i){var layer=this._allLayersFlat[i];layer._SetIndex(i);this._layersByName.set(layer.GetName().toLowerCase(),layer);this._layersBySid.set(layer.GetSID(),layer);}}},{key:"_ReindexHTMLLayers",value:function _ReindexHTMLLayers(){var htmlIndex=0;var _iteratorNormalCompletion161=true;var _didIteratorError161=false;var _iteratorError161=undefined;try{for(var _iterator161=this._rootLayers[Symbol.iterator](),_step161;!(_iteratorNormalCompletion161=(_step161=_iterator161.next()).done);_iteratorNormalCompletion161=true){var rootLayer=_step161.value;var _iteratorNormalCompletion162=true;var _didIteratorError162=false;var _iteratorError162=undefined;try{for(var _iterator162=rootLayer.selfAndAllSubLayers()[Symbol.iterator](),_step162;!(_iteratorNormalCompletion162=(_step162=_iterator162.next()).done);_iteratorNormalCompletion162=true){var layer=_step162.value;layer._SetHTMLIndex(htmlIndex);}}catch(err){_didIteratorError162=true;_iteratorError162=err;}finally{try{if(!_iteratorNormalCompletion162&&_iterator162["return"]!=null){_iterator162["return"]();}}finally{if(_didIteratorError162){throw _iteratorError162;}}}if(rootLayer.IsHTMLElementsLayer())htmlIndex++;}}catch(err){_didIteratorError161=true;_iteratorError161=err;}finally{try{if(!_iteratorNormalCompletion161&&_iterator161["return"]!=null){_iterator161["return"]();}}finally{if(_didIteratorError161){throw _iteratorError161;}}}}},{key:"GetHTMLLayerCount",value:function GetHTMLLayerCount(){return this._rootLayers.at(-1).GetHTMLIndex()+1;}},{key:"_ReindexAndUpdateAllLayers",value:function _ReindexAndUpdateAllLayers(){return regeneratorRuntime.async(function _ReindexAndUpdateAllLayers$(_context80){while(1){switch(_context80.prev=_context80.next){case 0:this._ReindexLayers();this._ReindexHTMLLayers();this._pendingSetHTMLLayerCount=this.GetHTMLLayerCount();case 3:case"end":return _context80.stop();}}},null,this);}},{key:"_GetPendingSetHTMLLayerCount",value:function _GetPendingSetHTMLLayerCount(){return this._pendingSetHTMLLayerCount;}},{key:"_ResetPendingHTMLLayerCount",value:function _ResetPendingHTMLLayerCount(){this._pendingSetHTMLLayerCount=-1;}},{key:"GetRootLayersForHTMLLayer",value:function GetRootLayersForHTMLLayer(i){var ret=[];var _iteratorNormalCompletion163=true;var _didIteratorError163=false;var _iteratorError163=undefined;try{for(var _iterator163=this._rootLayers[Symbol.iterator](),_step163;!(_iteratorNormalCompletion163=(_step163=_iterator163.next()).done);_iteratorNormalCompletion163=true){var rootLayer=_step163.value;var htmlIndex=rootLayer.GetHTMLIndex();if(htmlIndex===i)ret.push(rootLayer);else if(htmlIndex>i)break;}}catch(err){_didIteratorError163=true;_iteratorError163=err;}finally{try{if(!_iteratorNormalCompletion163&&_iterator163["return"]!=null){_iterator163["return"]();}}finally{if(_didIteratorError163){throw _iteratorError163;}}}return ret;}},{key:"SaveTransform",value:function SaveTransform(){return{"scrollX":this.GetScrollX(),"scrollY":this.GetScrollY(),"scale":this.GetScale(),"angle":this.GetAngle(),"vpX":this.GetVanishingPointX(),"vpY":this.GetVanishingPointY()};}},{key:"RestoreTransform",value:function RestoreTransform(t){this.SetScrollX(t["scrollX"]);this.SetScrollY(t["scrollY"]);this.SetScale(t["scale"]);this.SetAngle(t["angle"]);this.SetVanishingPointXY(t["vpX"],t["vpY"]);}},{key:"GetLayoutBackgroundColor",value:function GetLayoutBackgroundColor(){var firstDrawLayer=this._rootLayers.filter(function(l){return l.ShouldDraw();})[0];while(firstDrawLayer){if(!firstDrawLayer.IsTransparent()){_tempColor4.copyRgb(firstDrawLayer.GetBackgroundColor());_tempColor4.setA(1);return _tempColor4;}else if(firstDrawLayer.UsesOwnTexture()){_tempColor4.setRgba(0,0,0,0);return _tempColor4;}firstDrawLayer=firstDrawLayer.GetSubLayers().filter(function(l){return l.ShouldDraw();})[0];}_tempColor4.setRgba(0,0,0,0);return _tempColor4;}},{key:"IsFirstVisit",value:function IsFirstVisit(){return this._isFirstVisit;}},{key:"_GetInitialObjectClasses",value:function _GetInitialObjectClasses(){return _toConsumableArray(this._initialObjectClasses);}},{key:"_AddInitialObjectClass",value:function _AddInitialObjectClass(objectClass){if(objectClass.IsInContainer()){var _iteratorNormalCompletion164=true;var _didIteratorError164=false;var _iteratorError164=undefined;try{for(var _iterator164=objectClass.GetContainer().GetObjectTypes()[Symbol.iterator](),_step164;!(_iteratorNormalCompletion164=(_step164=_iterator164.next()).done);_iteratorNormalCompletion164=true){var containerType=_step164.value;this._initialObjectClasses.add(containerType);}}catch(err){_didIteratorError164=true;_iteratorError164=err;}finally{try{if(!_iteratorNormalCompletion164&&_iterator164["return"]!=null){_iterator164["return"]();}}finally{if(_didIteratorError164){throw _iteratorError164;}}}}else this._initialObjectClasses.add(objectClass);}},{key:"_GetTextureLoadedObjectTypes",value:function _GetTextureLoadedObjectTypes(){return _toConsumableArray(this._textureLoadedTypes);}},{key:"_Load",value:function _Load(previousLayout,renderer){if(previousLayout===this||!renderer)return Promise.resolve();if(previousLayout){_C88.CopySet(this._textureLoadedTypes,previousLayout._textureLoadedTypes);previousLayout._textureLoadedTypes.clear();}var promises=[];var _iteratorNormalCompletion165=true;var _didIteratorError165=false;var _iteratorError165=undefined;try{for(var _iterator165=this._initialObjectClasses[Symbol.iterator](),_step165;!(_iteratorNormalCompletion165=(_step165=_iterator165.next()).done);_iteratorNormalCompletion165=true){var oc=_step165.value;if(!this._textureLoadedTypes.has(oc)){promises.push(oc.LoadTextures(renderer));this._textureLoadedTypes.add(oc);}}}catch(err){_didIteratorError165=true;_iteratorError165=err;}finally{try{if(!_iteratorNormalCompletion165&&_iterator165["return"]!=null){_iterator165["return"]();}}finally{if(_didIteratorError165){throw _iteratorError165;}}}return Promise.all(promises);}},{key:"MaybeLoadTexturesFor",value:function MaybeLoadTexturesFor(objectClass){var renderer,loadPromise;return regeneratorRuntime.async(function MaybeLoadTexturesFor$(_context81){while(1){switch(_context81.prev=_context81.next){case 0:if(!objectClass.IsFamily()){_context81.next=2;break;}throw new Error("cannot load textures for family");case 2:renderer=this._runtime.GetRenderer();if(!(!renderer||renderer.IsContextLost()||this._textureLoadedTypes.has(objectClass))){_context81.next=5;break;}return _context81.abrupt("return");case 5:this._textureLoadedTypes.add(objectClass);loadPromise=objectClass.LoadTextures(renderer);this._AddPendingTextureLoadPromise(loadPromise);_context81.next=10;return regeneratorRuntime.awrap(loadPromise);case 10:objectClass.OnDynamicTextureLoadComplete();this._runtime.UpdateRender();case 12:case"end":return _context81.stop();}}},null,this);}},{key:"_AddPendingTextureLoadPromise",value:function _AddPendingTextureLoadPromise(promise){var _this42=this;this._textureLoadPendingPromises.add(promise);promise.then(function(){return _this42._textureLoadPendingPromises["delete"](promise);})["catch"](function(){return _this42._textureLoadPendingPromises["delete"](promise);});}},{key:"WaitForPendingTextureLoadsToComplete",value:function WaitForPendingTextureLoadsToComplete(){return Promise.all(_toConsumableArray(this._textureLoadPendingPromises));}},{key:"MaybeUnloadTexturesFor",value:function MaybeUnloadTexturesFor(objectClass){if(objectClass.IsFamily()||objectClass.GetInstanceCount()>0)throw new Error("cannot unload textures");var renderer=this._runtime.GetRenderer();if(!renderer||!this._textureLoadedTypes.has(objectClass))return;this._textureLoadedTypes["delete"](objectClass);objectClass.ReleaseTextures(renderer);}},{key:"_Unload",value:function _Unload(nextLayout,renderer){if(nextLayout===this||!renderer)return;var _iteratorNormalCompletion166=true;var _didIteratorError166=false;var _iteratorError166=undefined;try{for(var _iterator166=this._textureLoadedTypes[Symbol.iterator](),_step166;!(_iteratorNormalCompletion166=(_step166=_iterator166.next()).done);_iteratorNormalCompletion166=true){var oc=_step166.value;if(!oc.IsGlobal()&&!nextLayout._initialObjectClasses.has(oc)){oc.ReleaseTextures();this._textureLoadedTypes["delete"](oc);}}}catch(err){_didIteratorError166=true;_iteratorError166=err;}finally{try{if(!_iteratorNormalCompletion166&&_iterator166["return"]!=null){_iterator166["return"]();}}finally{if(_didIteratorError166){throw _iteratorError166;}}}}},{key:"_OnRendererContextLost",value:function _OnRendererContextLost(){this._textureLoadedTypes.clear();}},{key:"_StartRunning",value:function _StartRunning(isFirstLayout){var _this43=this;var runtime,layoutManager,eventSheetManager,createPromises,_iteratorNormalCompletion167,_didIteratorError167,_iteratorError167,_iterator167,_step167,inst,_iteratorNormalCompletion168,_didIteratorError168,_iteratorError168,_iterator168,_step168,_inst4,_i36,_Object$entries7,_Object$entries7$_i,sidStr,typeData,objectClass,_iteratorNormalCompletion169,_didIteratorError169,_iteratorError169,_iterator169,_step169,_inst5,_iteratorNormalCompletion170,_didIteratorError170,_iteratorError170,_iterator170,_step170,_inst6;return regeneratorRuntime.async(function _StartRunning$(_context82){while(1){switch(_context82.prev=_context82.next){case 0:runtime=this._runtime;layoutManager=this._layoutManager;eventSheetManager=runtime.GetEventSheetManager();if(this._eventSheetName){this._eventSheet=eventSheetManager.GetEventSheetByName(this._eventSheetName);this._eventSheet._UpdateDeepIncludes();}layoutManager._SetMainRunningLayout(this);this._width=this._originalWidth;this._height=this._originalHeight;this._scrollX=runtime.GetOriginalViewportWidth()/2;this._scrollY=runtime.GetOriginalViewportHeight()/2;this.BoundScrolling();this._SetAllLayersProjectionChanged();this._SetAllLayersMVChanged();this._ReindexHTMLLayers();_context82.next=15;return regeneratorRuntime.awrap(this._runtime.GetCanvasManager().SetHTMLLayerCount(this.GetHTMLLayerCount(),true));case 15:this._MoveGlobalObjectsToThisLayout(isFirstLayout);this._runtime.SetUsingCreatePromises(true);this._CreateInitialInstances();if(!this._isFirstVisit)this._CreatePersistedInstances();this._CreateAndLinkContainerInstances(this._createdInstances);this._CreateAndLinkContainerInstances(this._createdPersistedInstances);this._CreateInitialNonWorldInstances();layoutManager.ClearPendingChangeLayout();runtime.FlushPendingInstances();this._runtime.SetUsingCreatePromises(false);createPromises=this._runtime.GetCreatePromises();_context82.next=28;return regeneratorRuntime.awrap(Promise.all(createPromises));case 28:_C88.clearArray(createPromises);if(runtime.IsLoadingState()){_context82.next=116;break;}_iteratorNormalCompletion167=true;_didIteratorError167=false;_iteratorError167=undefined;_context82.prev=33;for(_iterator167=this._createdInstances[Symbol.iterator]();!(_iteratorNormalCompletion167=(_step167=_iterator167.next()).done);_iteratorNormalCompletion167=true){inst=_step167.value;inst.SetupInitialSceneGraphConnections();}_context82.next=41;break;case 37:_context82.prev=37;_context82.t0=_context82["catch"](33);_didIteratorError167=true;_iteratorError167=_context82.t0;case 41:_context82.prev=41;_context82.prev=42;if(!_iteratorNormalCompletion167&&_iterator167["return"]!=null){_iterator167["return"]();}case 44:_context82.prev=44;if(!_didIteratorError167){_context82.next=47;break;}throw _iteratorError167;case 47:return _context82.finish(44);case 48:return _context82.finish(41);case 49:_iteratorNormalCompletion168=true;_didIteratorError168=false;_iteratorError168=undefined;_context82.prev=52;for(_iterator168=this._createdPersistedInstances[Symbol.iterator]();!(_iteratorNormalCompletion168=(_step168=_iterator168.next()).done);_iteratorNormalCompletion168=true){_inst4=_step168.value;_inst4.SetupPersistedSceneGraphConnections(this._createdPersistedInstancesToDataMap,this._createdPersistedIndexToInstanceMap);}_context82.next=60;break;case 56:_context82.prev=56;_context82.t1=_context82["catch"](52);_didIteratorError168=true;_iteratorError168=_context82.t1;case 60:_context82.prev=60;_context82.prev=61;if(!_iteratorNormalCompletion168&&_iterator168["return"]!=null){_iterator168["return"]();}case 63:_context82.prev=63;if(!_didIteratorError168){_context82.next=66;break;}throw _iteratorError168;case 66:return _context82.finish(63);case 67:return _context82.finish(60);case 68:_i36=0,_Object$entries7=Object.entries(this._persistData);case 69:if(!(_i36<_Object$entries7.length)){_context82.next=78;break;}_Object$entries7$_i=_slicedToArray(_Object$entries7[_i36],2),sidStr=_Object$entries7$_i[0],typeData=_Object$entries7$_i[1];objectClass=this._runtime.GetObjectClassBySID(parseInt(sidStr,10));if(!(!objectClass||objectClass.IsFamily()||!objectClass.HasPersistBehavior())){_context82.next=74;break;}return _context82.abrupt("continue",75);case 74:_C88.clearArray(typeData);case 75:_i36++;_context82.next=69;break;case 78:_iteratorNormalCompletion169=true;_didIteratorError169=false;_iteratorError169=undefined;_context82.prev=81;for(_iterator169=this._createdInstances[Symbol.iterator]();!(_iteratorNormalCompletion169=(_step169=_iterator169.next()).done);_iteratorNormalCompletion169=true){_inst5=_step169.value;_inst5._TriggerOnCreated();}_context82.next=89;break;case 85:_context82.prev=85;_context82.t2=_context82["catch"](81);_didIteratorError169=true;_iteratorError169=_context82.t2;case 89:_context82.prev=89;_context82.prev=90;if(!_iteratorNormalCompletion169&&_iterator169["return"]!=null){_iterator169["return"]();}case 92:_context82.prev=92;if(!_didIteratorError169){_context82.next=95;break;}throw _iteratorError169;case 95:return _context82.finish(92);case 96:return _context82.finish(89);case 97:_iteratorNormalCompletion170=true;_didIteratorError170=false;_iteratorError170=undefined;_context82.prev=100;for(_iterator170=this._createdPersistedInstances[Symbol.iterator]();!(_iteratorNormalCompletion170=(_step170=_iterator170.next()).done);_iteratorNormalCompletion170=true){_inst6=_step170.value;_inst6._TriggerOnCreated();}_context82.next=108;break;case 104:_context82.prev=104;_context82.t3=_context82["catch"](100);_didIteratorError170=true;_iteratorError170=_context82.t3;case 108:_context82.prev=108;_context82.prev=109;if(!_iteratorNormalCompletion170&&_iterator170["return"]!=null){_iterator170["return"]();}case 111:_context82.prev=111;if(!_didIteratorError170){_context82.next=114;break;}throw _iteratorError170;case 114:return _context82.finish(111);case 115:return _context82.finish(108);case 116:_C88.clearArray(this._createdInstances);_C88.clearArray(this._createdPersistedInstances);this._createdPersistedInstancesToDataMap.clear();this._createdPersistedIndexToInstanceMap.clear();_context82.next=122;return regeneratorRuntime.awrap(Promise.all(_toConsumableArray(this._initialObjectClasses).map(function(oc){return oc.PreloadTexturesWithInstances(_this43._runtime.GetRenderer());})));case 122:if(!isFirstLayout){_context82.next=126;break;}runtime.Dispatcher().dispatchEvent(new _C88.Event("beforefirstlayoutstart"));_context82.next=126;return regeneratorRuntime.awrap(runtime.DispatchUserScriptEventAsyncWait(new _C88.Event("beforeprojectstart")));case 126:runtime.Dispatcher().dispatchEvent(new _C88.Event("beforelayoutstart"));_context82.next=129;return regeneratorRuntime.awrap(this.DispatchUserScriptEventAsyncWait(new _C88.Event("beforelayoutstart")));case 129:if(runtime.IsLoadingState()){_context82.next=132;break;}_context82.next=132;return regeneratorRuntime.awrap(runtime.TriggerAsync(_C88.Plugins.System.Cnds.OnLayoutStart,null,null));case 132:runtime.Dispatcher().dispatchEvent(new _C88.Event("afterlayoutstart"));_context82.next=135;return regeneratorRuntime.awrap(this.DispatchUserScriptEventAsyncWait(new _C88.Event("afterlayoutstart")));case 135:if(!isFirstLayout){_context82.next=139;break;}runtime.Dispatcher().dispatchEvent(new _C88.Event("afterfirstlayoutstart"));_context82.next=139;return regeneratorRuntime.awrap(runtime.DispatchUserScriptEventAsyncWait(new _C88.Event("afterprojectstart")));case 139:eventSheetManager._RunQueuedTriggers(layoutManager);_context82.next=142;return regeneratorRuntime.awrap(this.WaitForPendingTextureLoadsToComplete());case 142:this._isFirstVisit=false;case 143:case"end":return _context82.stop();}}},null,this,[[33,37,41,49],[42,,44,48],[52,56,60,68],[61,,63,67],[81,85,89,97],[90,,92,96],[100,104,108,116],[109,,111,115]]);}},{key:"_MoveGlobalObjectsToThisLayout",value:function _MoveGlobalObjectsToThisLayout(isFirstLayout){var _iteratorNormalCompletion171=true;var _didIteratorError171=false;var _iteratorError171=undefined;try{for(var _iterator171=this._runtime.GetAllObjectClasses()[Symbol.iterator](),_step171;!(_iteratorNormalCompletion171=(_step171=_iterator171.next()).done);_iteratorNormalCompletion171=true){var objectClass=_step171.value;if(objectClass.IsFamily()||!objectClass.IsWorldType())continue;var _iteratorNormalCompletion173=true;var _didIteratorError173=false;var _iteratorError173=undefined;try{for(var _iterator173=objectClass.GetInstances()[Symbol.iterator](),_step173;!(_iteratorNormalCompletion173=(_step173=_iterator173.next()).done);_iteratorNormalCompletion173=true){var inst=_step173.value;var wi=inst.GetWorldInfo();var oldLayer=wi.GetLayer();var layerIndex=_C88.clamp(oldLayer.GetIndex(),0,this._allLayersFlat.length-1);var newLayer=this._allLayersFlat[layerIndex];wi._SetLayer(newLayer,true);newLayer._MaybeAddInstance(inst);}}catch(err){_didIteratorError173=true;_iteratorError173=err;}finally{try{if(!_iteratorNormalCompletion173&&_iterator173["return"]!=null){_iterator173["return"]();}}finally{if(_didIteratorError173){throw _iteratorError173;}}}}}catch(err){_didIteratorError171=true;_iteratorError171=err;}finally{try{if(!_iteratorNormalCompletion171&&_iterator171["return"]!=null){_iterator171["return"]();}}finally{if(_didIteratorError171){throw _iteratorError171;}}}if(!isFirstLayout){var _iteratorNormalCompletion172=true;var _didIteratorError172=false;var _iteratorError172=undefined;try{for(var _iterator172=this._allLayersFlat[Symbol.iterator](),_step172;!(_iteratorNormalCompletion172=(_step172=_iterator172.next()).done);_iteratorNormalCompletion172=true){var layer=_step172.value;layer._SortInstancesByLastCachedZIndex(false);}}catch(err){_didIteratorError172=true;_iteratorError172=err;}finally{try{if(!_iteratorNormalCompletion172&&_iterator172["return"]!=null){_iterator172["return"]();}}finally{if(_didIteratorError172){throw _iteratorError172;}}}}}},{key:"_CreateInitialInstances",value:function _CreateInitialInstances(){var _iteratorNormalCompletion174=true;var _didIteratorError174=false;var _iteratorError174=undefined;try{for(var _iterator174=this._allLayersFlat[Symbol.iterator](),_step174;!(_iteratorNormalCompletion174=(_step174=_iterator174.next()).done);_iteratorNormalCompletion174=true){var layer=_step174.value;layer.CreateInitialInstances(this._createdInstances);layer._Start();}}catch(err){_didIteratorError174=true;_iteratorError174=err;}finally{try{if(!_iteratorNormalCompletion174&&_iterator174["return"]!=null){_iterator174["return"]();}}finally{if(_didIteratorError174){throw _iteratorError174;}}}}},{key:"_CreatePersistedInstances",value:function _CreatePersistedInstances(){var uidsChanged=false;for(var _i37=0,_Object$entries8=Object.entries(this._persistData);_i37<_Object$entries8.length;_i37++){var _Object$entries8$_i=_slicedToArray(_Object$entries8[_i37],2),sidStr=_Object$entries8$_i[0],typeData=_Object$entries8$_i[1];var objectClass=this._runtime.GetObjectClassBySID(parseInt(sidStr,10));if(!objectClass||objectClass.IsFamily()||!objectClass.HasPersistBehavior())continue;var _iteratorNormalCompletion176=true;var _didIteratorError176=false;var _iteratorError176=undefined;try{for(var _iterator176=typeData[Symbol.iterator](),_step176;!(_iteratorNormalCompletion176=(_step176=_iterator176.next()).done);_iteratorNormalCompletion176=true){var instData=_step176.value;var layer=null;if(objectClass.IsWorldType()){if(instData.hasOwnProperty("instJson"))layer=this.GetLayerBySID(instData["instJson"]["w"]["l"]);else layer=this.GetLayerBySID(instData["w"]["l"]);if(!layer)continue;}var inst=this._runtime.CreateInstanceFromData(objectClass,layer,false,0,0,true);if(instData.hasOwnProperty("instJson"))inst.LoadFromJson(instData["instJson"]);else inst.LoadFromJson(instData);uidsChanged=true;this._createdPersistedInstances.push(inst);if(instData.hasOwnProperty("instJson")){this._createdPersistedInstancesToDataMap.set(inst,instData);this._createdPersistedIndexToInstanceMap.set(instData["index"],inst);}}}catch(err){_didIteratorError176=true;_iteratorError176=err;}finally{try{if(!_iteratorNormalCompletion176&&_iterator176["return"]!=null){_iterator176["return"]();}}finally{if(_didIteratorError176){throw _iteratorError176;}}}}var _iteratorNormalCompletion175=true;var _didIteratorError175=false;var _iteratorError175=undefined;try{for(var _iterator175=this._allLayersFlat[Symbol.iterator](),_step175;!(_iteratorNormalCompletion175=(_step175=_iterator175.next()).done);_iteratorNormalCompletion175=true){var _layer2=_step175.value;_layer2._SortInstancesByLastCachedZIndex(true);_layer2.SetZIndicesChanged();}}catch(err){_didIteratorError175=true;_iteratorError175=err;}finally{try{if(!_iteratorNormalCompletion175&&_iterator175["return"]!=null){_iterator175["return"]();}}finally{if(_didIteratorError175){throw _iteratorError175;}}}if(uidsChanged){this._runtime.FlushPendingInstances();this._runtime._RefreshUidMap();}}},{key:"_CreateAndLinkContainerInstances",value:function _CreateAndLinkContainerInstances(createdInstances){var _iteratorNormalCompletion177=true;var _didIteratorError177=false;var _iteratorError177=undefined;try{for(var _iterator177=createdInstances[Symbol.iterator](),_step177;!(_iteratorNormalCompletion177=(_step177=_iterator177.next()).done);_iteratorNormalCompletion177=true){var inst=_step177.value;if(!inst.IsInContainer())continue;var wi=inst.GetWorldInfo();var iid=inst.GetIID();var _iteratorNormalCompletion178=true;var _didIteratorError178=false;var _iteratorError178=undefined;try{for(var _iterator178=inst.GetObjectClass().GetContainer().objectTypes()[Symbol.iterator](),_step178;!(_iteratorNormalCompletion178=(_step178=_iterator178.next()).done);_iteratorNormalCompletion178=true){var containerType=_step178.value;if(containerType===inst.GetObjectClass())continue;var _instances2=containerType.GetInstances();if(_instances2.length>iid)inst._AddSibling(_instances2[iid]);else{var s=void 0;if(wi)s=this._runtime.CreateInstanceFromData(containerType,wi.GetLayer(),true,wi.GetX(),wi.GetY(),true);else s=this._runtime.CreateInstanceFromData(containerType,null,true,0,0,true);this._runtime.FlushPendingInstances();containerType._UpdateIIDs();inst._AddSibling(s);createdInstances.push(s);}}}catch(err){_didIteratorError178=true;_iteratorError178=err;}finally{try{if(!_iteratorNormalCompletion178&&_iterator178["return"]!=null){_iterator178["return"]();}}finally{if(_didIteratorError178){throw _iteratorError178;}}}}}catch(err){_didIteratorError177=true;_iteratorError177=err;}finally{try{if(!_iteratorNormalCompletion177&&_iterator177["return"]!=null){_iterator177["return"]();}}finally{if(_didIteratorError177){throw _iteratorError177;}}}}},{key:"_CreateInitialNonWorldInstances",value:function _CreateInitialNonWorldInstances(){var _iteratorNormalCompletion179=true;var _didIteratorError179=false;var _iteratorError179=undefined;try{for(var _iterator179=this._initialNonWorld[Symbol.iterator](),_step179;!(_iteratorNormalCompletion179=(_step179=_iterator179.next()).done);_iteratorNormalCompletion179=true){var instData=_step179.value;var objectClass=this._runtime.GetObjectClassByIndex(instData[1]);if(!objectClass.IsInContainer())this._runtime.CreateInstanceFromData(instData,null,true);}}catch(err){_didIteratorError179=true;_iteratorError179=err;}finally{try{if(!_iteratorNormalCompletion179&&_iterator179["return"]!=null){_iterator179["return"]();}}finally{if(_didIteratorError179){throw _iteratorError179;}}}}},{key:"_CreateGlobalNonWorlds",value:function _CreateGlobalNonWorlds(){var createdInstances=[];var initialNonWorld=this._initialNonWorld;var k=0;for(var i=0,len=initialNonWorld.length;i<len;++i){var instData=initialNonWorld[i];var objectClass=this._runtime.GetObjectClassByIndex(instData[1]);if(objectClass.IsGlobal()){if(!objectClass.IsInContainer()||!objectClass.GetContainer().HasAnyWorldType())createdInstances.push(this._runtime.CreateInstanceFromData(instData,null,true));}else{initialNonWorld[k]=instData;++k;}}_C88.truncateArray(initialNonWorld,k);this._runtime.FlushPendingInstances();this._CreateAndLinkContainerInstances(createdInstances);}},{key:"RecreateInitialObjects",value:function RecreateInitialObjects(objectClass,rc,srcLayer,offsetX,offsetY,createHierarchy){if(srcLayer)return srcLayer.RecreateInitialObjects(objectClass,rc,offsetX,offsetY,createHierarchy);else{var ret=[];var _iteratorNormalCompletion180=true;var _didIteratorError180=false;var _iteratorError180=undefined;try{for(var _iterator180=this._allLayersFlat[Symbol.iterator](),_step180;!(_iteratorNormalCompletion180=(_step180=_iterator180.next()).done);_iteratorNormalCompletion180=true){var layer=_step180.value;ret.push(layer.RecreateInitialObjects(objectClass,rc,offsetX,offsetY,createHierarchy));}}catch(err){_didIteratorError180=true;_iteratorError180=err;}finally{try{if(!_iteratorNormalCompletion180&&_iterator180["return"]!=null){_iterator180["return"]();}}finally{if(_didIteratorError180){throw _iteratorError180;}}}return ret.flat();}}},{key:"_StopRunning",value:function _StopRunning(){var layoutManager,_iteratorNormalCompletion181,_didIteratorError181,_iteratorError181,_iterator181,_step181,layer,_iteratorNormalCompletion182,_didIteratorError182,_iteratorError182,_iterator182,_step182,objectClass,_iteratorNormalCompletion183,_didIteratorError183,_iteratorError183,_iterator183,_step183,inst;return regeneratorRuntime.async(function _StopRunning$(_context83){while(1){switch(_context83.prev=_context83.next){case 0:layoutManager=this._layoutManager;if(this._runtime.IsLoadingState()){_context83.next=8;break;}_context83.next=4;return regeneratorRuntime.awrap(this.DispatchUserScriptEventAsyncWait(new _C88.Event("beforelayoutend")));case 4:_context83.next=6;return regeneratorRuntime.awrap(this._runtime.TriggerAsync(_C88.Plugins.System.Cnds.OnLayoutEnd,null,null));case 6:_context83.next=8;return regeneratorRuntime.awrap(this.DispatchUserScriptEventAsyncWait(new _C88.Event("afterlayoutend")));case 8:layoutManager.SetIsEndingLayout(true);this._runtime.GetEventSheetManager().ClearAllScheduledWaits();if(!this._isFirstVisit)this._SavePersistData();_iteratorNormalCompletion181=true;_didIteratorError181=false;_iteratorError181=undefined;_context83.prev=14;for(_iterator181=this._allLayersFlat[Symbol.iterator]();!(_iteratorNormalCompletion181=(_step181=_iterator181.next()).done);_iteratorNormalCompletion181=true){layer=_step181.value;layer._End();}_context83.next=22;break;case 18:_context83.prev=18;_context83.t0=_context83["catch"](14);_didIteratorError181=true;_iteratorError181=_context83.t0;case 22:_context83.prev=22;_context83.prev=23;if(!_iteratorNormalCompletion181&&_iterator181["return"]!=null){_iterator181["return"]();}case 25:_context83.prev=25;if(!_didIteratorError181){_context83.next=28;break;}throw _iteratorError181;case 28:return _context83.finish(25);case 29:return _context83.finish(22);case 30:_iteratorNormalCompletion182=true;_didIteratorError182=false;_iteratorError182=undefined;_context83.prev=33;_iterator182=this._runtime.GetAllObjectClasses()[Symbol.iterator]();case 35:if(_iteratorNormalCompletion182=(_step182=_iterator182.next()).done){_context83.next=62;break;}objectClass=_step182.value;if(!(objectClass.IsGlobal()||objectClass.IsWorldType()||objectClass.GetPlugin().IsSingleGlobal()||objectClass.IsFamily())){_context83.next=39;break;}return _context83.abrupt("continue",59);case 39:_iteratorNormalCompletion183=true;_didIteratorError183=false;_iteratorError183=undefined;_context83.prev=42;for(_iterator183=objectClass.GetInstances()[Symbol.iterator]();!(_iteratorNormalCompletion183=(_step183=_iterator183.next()).done);_iteratorNormalCompletion183=true){inst=_step183.value;this._runtime.DestroyInstance(inst);}_context83.next=50;break;case 46:_context83.prev=46;_context83.t1=_context83["catch"](42);_didIteratorError183=true;_iteratorError183=_context83.t1;case 50:_context83.prev=50;_context83.prev=51;if(!_iteratorNormalCompletion183&&_iterator183["return"]!=null){_iterator183["return"]();}case 53:_context83.prev=53;if(!_didIteratorError183){_context83.next=56;break;}throw _iteratorError183;case 56:return _context83.finish(53);case 57:return _context83.finish(50);case 58:this._runtime.FlushPendingInstances();case 59:_iteratorNormalCompletion182=true;_context83.next=35;break;case 62:_context83.next=68;break;case 64:_context83.prev=64;_context83.t2=_context83["catch"](33);_didIteratorError182=true;_iteratorError182=_context83.t2;case 68:_context83.prev=68;_context83.prev=69;if(!_iteratorNormalCompletion182&&_iterator182["return"]!=null){_iterator182["return"]();}case 71:_context83.prev=71;if(!_didIteratorError182){_context83.next=74;break;}throw _iteratorError182;case 74:return _context83.finish(71);case 75:return _context83.finish(68);case 76:layoutManager.SetIsEndingLayout(false);if(layoutManager.GetMainRunningLayout()===this)layoutManager._SetMainRunningLayout(null);case 78:case"end":return _context83.stop();}}},null,this,[[14,18,22,30],[23,,25,29],[33,64,68,76],[42,46,50,58],[51,,53,57],[69,,71,75]]);}},{key:"_SaveInstanceToPersist",value:function _SaveInstanceToPersist(inst,index){var sidStr=inst.GetObjectClass().GetSID().toString();if(!this._persistData.hasOwnProperty(sidStr))this._persistData[sidStr]=[];var typePersist=this._persistData[sidStr];var persistData={"index":index,"instJson":inst.SaveToJson(),"sceneGraphJson":{"children":[]}};typePersist.push(persistData);this._persistedIntances.set(inst,persistData);}},{key:"_SaveSceneGraphInfoToPersist",value:function _SaveSceneGraphInfoToPersist(inst){var persistData=this._persistedIntances.get(inst);var _iteratorNormalCompletion184=true;var _didIteratorError184=false;var _iteratorError184=undefined;try{for(var _iterator184=inst.GetChildren()[Symbol.iterator](),_step184;!(_iteratorNormalCompletion184=(_step184=_iterator184.next()).done);_iteratorNormalCompletion184=true){var child=_step184.value;var childPersistData=this._persistedIntances.get(child);if(childPersistData)persistData["sceneGraphJson"]["children"].push({"index":childPersistData["index"],"flags":_C88.SceneGraphInfo._GetFlagsNumber(child.GetWorldInfo())});}}catch(err){_didIteratorError184=true;_iteratorError184=err;}finally{try{if(!_iteratorNormalCompletion184&&_iterator184["return"]!=null){_iterator184["return"]();}}finally{if(_didIteratorError184){throw _iteratorError184;}}}}},{key:"_SavePersistData",value:function _SavePersistData(){this._persistedIntances.clear();var persisDataIndex=0;var _iteratorNormalCompletion185=true;var _didIteratorError185=false;var _iteratorError185=undefined;try{for(var _iterator185=this._allLayersFlat[Symbol.iterator](),_step185;!(_iteratorNormalCompletion185=(_step185=_iterator185.next()).done);_iteratorNormalCompletion185=true){var layer=_step185.value;layer._UpdateZIndices();var _iteratorNormalCompletion187=true;var _didIteratorError187=false;var _iteratorError187=undefined;try{for(var _iterator187=layer._GetInstances()[Symbol.iterator](),_step187;!(_iteratorNormalCompletion187=(_step187=_iterator187.next()).done);_iteratorNormalCompletion187=true){var inst=_step187.value;var objectClass=inst.GetObjectClass();if(!objectClass.IsGlobal()&&objectClass.HasPersistBehavior()){this._SaveInstanceToPersist(inst,persisDataIndex);persisDataIndex++;}}}catch(err){_didIteratorError187=true;_iteratorError187=err;}finally{try{if(!_iteratorNormalCompletion187&&_iterator187["return"]!=null){_iterator187["return"]();}}finally{if(_didIteratorError187){throw _iteratorError187;}}}}}catch(err){_didIteratorError185=true;_iteratorError185=err;}finally{try{if(!_iteratorNormalCompletion185&&_iterator185["return"]!=null){_iterator185["return"]();}}finally{if(_didIteratorError185){throw _iteratorError185;}}}var _iteratorNormalCompletion186=true;var _didIteratorError186=false;var _iteratorError186=undefined;try{for(var _iterator186=this._allLayersFlat[Symbol.iterator](),_step186;!(_iteratorNormalCompletion186=(_step186=_iterator186.next()).done);_iteratorNormalCompletion186=true){var _layer3=_step186.value;var _iteratorNormalCompletion188=true;var _didIteratorError188=false;var _iteratorError188=undefined;try{for(var _iterator188=_layer3._GetInstances()[Symbol.iterator](),_step188;!(_iteratorNormalCompletion188=(_step188=_iterator188.next()).done);_iteratorNormalCompletion188=true){var _inst7=_step188.value;var _objectClass2=_inst7.GetObjectClass();if(!_objectClass2.IsGlobal()&&_objectClass2.HasPersistBehavior())this._SaveSceneGraphInfoToPersist(_inst7);}}catch(err){_didIteratorError188=true;_iteratorError188=err;}finally{try{if(!_iteratorNormalCompletion188&&_iterator188["return"]!=null){_iterator188["return"]();}}finally{if(_didIteratorError188){throw _iteratorError188;}}}}}catch(err){_didIteratorError186=true;_iteratorError186=err;}finally{try{if(!_iteratorNormalCompletion186&&_iterator186["return"]!=null){_iterator186["return"]();}}finally{if(_didIteratorError186){throw _iteratorError186;}}}this._persistedIntances.clear();}},{key:"ResetPersistData",value:function ResetPersistData(){this._persistData={};this._isFirstVisit=true;}},{key:"GetRenderTarget",value:function GetRenderTarget(){return this._curRenderTarget;}},{key:"UsesOwnTexture",value:function UsesOwnTexture(){var runtime=this._runtime;var isWebGL=runtime.GetRenderer().IsWebGL();return runtime.GetCanvasManager().GetCurrentFullscreenScalingQuality()==="low"||isWebGL&&runtime.UsesAnyBackgroundBlending()||runtime.GetCompositingMode()==="low-latency"||this._effectList.HasAnyActiveEffect()||isWebGL&&runtime.Uses3DFeatures();}},{key:"_MaybeStartDrawToOwnTexture",value:function _MaybeStartDrawToOwnTexture(renderer){var canvasManager=this._runtime.GetCanvasManager();if(this.UsesOwnTexture()){if(this._runtime.GetCompositingMode()!=="low-latency"){renderer.SetRenderTarget(null);renderer.ClearRgba(0,0,0,0);}var rtOpts={sampling:this._runtime.GetSampling(),isSampled:renderer.IsWebGPU()||this._runtime.UsesAnyBackgroundBlending()||this._effectList.HasAnyActiveEffect(),canReadPixels:renderer.IsWebGPU()?this._runtime.UsesAnyBackgroundBlending():false};if(canvasManager.GetCurrentFullscreenScalingQuality()==="low"){rtOpts.width=canvasManager.GetDrawWidth();rtOpts.height=canvasManager.GetDrawHeight();}this._curRenderTarget=this._runtime.GetAdditionalRenderTarget(rtOpts);}else this._curRenderTarget=null;}},{key:"_MaybeCopyOwnTextureToBackbuffer",value:function _MaybeCopyOwnTextureToBackbuffer(renderer){if(this._runtime._NeedsHTMLLayerCompositing(renderer)){renderer.SetDepthEnabled(false);renderer.SetRenderTarget(null);renderer.SetTextureFillMode();renderer.CopyRenderTarget(this._curRenderTarget);}}},{key:"_MaybeEndDrawToOwnTexture",value:function _MaybeEndDrawToOwnTexture(renderer){if(this.UsesOwnTexture()){renderer.SetDepthEnabled(false);this._DrawLayoutOwnTextureToRenderTarget(renderer,this._curRenderTarget);}}},{key:"DrawMain",value:function DrawMain(renderer){renderer.SetRenderTarget(this._curRenderTarget);renderer.Clear(this.GetLayoutBackgroundColor());if(this._runtime.Uses3DFeatures())renderer.ClearDepth();var rootLayers=this.GetRootLayersForHTMLLayer(0);this._DrawLayerList(renderer,this._curRenderTarget,rootLayers,true);this._MaybeEndDrawToOwnTexture(renderer);this._curRenderTarget=null;}},{key:"DrawForHTMLLayerIndex",value:function DrawForHTMLLayerIndex(renderer,htmlIndex){var destRenderTarget=null;if(this._runtime._NeedsHTMLLayerCompositing(renderer))destRenderTarget=this._curRenderTarget;renderer.SetRenderTarget(destRenderTarget);renderer.ClearRgba(0,0,0,0);if(this._runtime.Uses3DFeatures())renderer.ClearDepth();var rootLayers=this.GetRootLayersForHTMLLayer(htmlIndex);this._DrawLayerList(renderer,destRenderTarget,rootLayers,true);this._MaybeCopyOwnTextureToBackbuffer(renderer);renderer.EndBatch();this._runtime.GetCanvasManager().BlitMainCanvasToHTMLLayerCanvas(htmlIndex);}},{key:"_DrawLayerList",value:function _DrawLayerList(renderer,destRenderTarget,layersArr,canCopyFirstLayer){var layersToDraw=layersArr.filter(function(l){return l.ShouldDraw();});for(var i=0,len=layersToDraw.length;i<len;){var layer=layersToDraw[i];if(layer.SelfAndAllSubLayersHave3DCamera()&&!layer.SelfOrAnySubLayerUsesOwnTexture()){tempRender3dList.push(layer);for(var j=i+1;j<len;++j){var nextLayer=layersToDraw[j];if(nextLayer.SelfAndAllSubLayersHave3DCamera()&&!nextLayer.SelfOrAnySubLayerUsesOwnTexture())tempRender3dList.push(layersToDraw[j]);else break;}if(tempRender3dList.length>=2||tempRender3dList.length===1&&tempRender3dList[0].HasAnyVisibleSubLayer()){this._Draw3DLayers(renderer,destRenderTarget,tempRender3dList);i+=tempRender3dList.length;_C88.clearArray(tempRender3dList);continue;}_C88.clearArray(tempRender3dList);}layer.Draw(renderer,destRenderTarget,canCopyFirstLayer&&i===0);++i;}}},{key:"_DrawLayoutOwnTextureToRenderTarget",value:function _DrawLayoutOwnTextureToRenderTarget(renderer,ownRenderTarget){var activeEffectTypes=this._effectList.GetActiveEffectTypes();var runtime=this._runtime;if(activeEffectTypes.length===0){renderer.SetRenderTarget(null);renderer.SetTextureFillMode();renderer.CopyRenderTarget(ownRenderTarget);renderer.InvalidateRenderTarget(ownRenderTarget);runtime.ReleaseAdditionalRenderTarget(ownRenderTarget);}else{tempLayoutRect.set(0,0,runtime.GetViewportWidth(),runtime.GetViewportHeight());this.GetEffectChain().Render(renderer,null,{contentObject:this,blendMode:3,devicePixelRatio:this._runtime.GetEffectDevicePixelRatioParam(),layerScale:this._runtime.GetEffectLayerScaleParam()*this.GetScale(),layerAngle:this.GetAngle(),layoutRect:tempLayoutRect,drawSurfaceRect:null,invalidateRenderTargets:true});}}},{key:"_Draw3DLayers",value:function _Draw3DLayers(renderer,renderTarget,layerList){if(!layerList[0].IsTransparent()){_tempColor4.copyRgb(layerList[0].GetBackgroundColor());_tempColor4.setA(1);renderer.Clear(_tempColor4);}var canvasManager=this._runtime.GetCanvasManager();renderer.SetDepthEnabled(true);var fullInstanceList=_tempInstanceList;var coplanarInstances=_tempInstanceList2;var postRenderInstances=tempInstanceList3;var _iteratorNormalCompletion189=true;var _didIteratorError189=false;var _iteratorError189=undefined;try{for(var _iterator189=layerList[Symbol.iterator](),_step189;!(_iteratorNormalCompletion189=(_step189=_iterator189.next()).done);_iteratorNormalCompletion189=true){var layer=_step189.value;layer._UpdateZIndices();layer._AppendAllInstancesIncludingSubLayersInDrawOrder(fullInstanceList);}}catch(err){_didIteratorError189=true;_iteratorError189=err;}finally{try{if(!_iteratorNormalCompletion189&&_iterator189["return"]!=null){_iterator189["return"]();}}finally{if(_didIteratorError189){throw _iteratorError189;}}}var firstLayer=layerList[0];var layerQuery=null;if(this._runtime.IsGPUProfiling())if(renderer.IsWebGL()){var timingsBuffer=canvasManager.GetLayerTimingsBuffer(firstLayer);if(timingsBuffer){layerQuery=timingsBuffer.AddTimeElapsedQuery();renderer.StartQuery(layerQuery);}}else if(renderer.IsWebGPU())renderer.WriteTimestamp((firstLayer.GetIndex()+1)*2);for(var i=0,len=fullInstanceList.length;i<len;){var inst=fullInstanceList[i];var wi=inst.GetWorldInfo();var wiLayer=wi.GetLayer();if(!wi.IsVisible()||!wi.IsInViewport3D(wiLayer._GetViewFrustum())){++i;continue;}if(!inst.RendersToOwnZPlane()||wi.GetDepth()>0)postRenderInstances.push(inst);var startZ=inst.GetWorldInfo().GetTotalZElevation();coplanarInstances.push(inst);var endIndex=i+1;for(;endIndex<len;++endIndex){var nextInst=fullInstanceList[endIndex];var nextWi=nextInst.GetWorldInfo();if(!nextWi.IsVisible()||!nextWi.IsInViewport3D(nextWi.GetLayer()._GetViewFrustum()))continue;if(nextWi.GetTotalZElevation()!==startZ)break;if(!nextInst.RendersToOwnZPlane()){postRenderInstances.push(nextInst);continue;}if(nextWi.GetDepth()>0)postRenderInstances.push(nextInst);coplanarInstances.push(nextInst);}if(coplanarInstances.length===1&&!coplanarInstances[0].MustMitigateZFighting()){MaybePrepareLayerDraw(wiLayer,renderer);wiLayer._DrawInstanceMaybeWithEffects(inst,wi,renderer,renderTarget);for(var j=0,lenj=postRenderInstances.length;j<lenj;++j){var postInst=postRenderInstances[j];if(postInst===inst)continue;var postWi=postInst.GetWorldInfo();var postWiLayer=postWi.GetLayer();MaybePrepareLayerDraw(postWiLayer,renderer);postWiLayer._DrawInstanceMaybeWithEffects(postInst,postWi,renderer,renderTarget);}}else{this._Draw3DLayersCoplanarInstances(renderer,renderTarget,coplanarInstances);for(var _j2=0,_lenj2=postRenderInstances.length;_j2<_lenj2;++_j2){var _postInst2=postRenderInstances[_j2];var _postWi2=_postInst2.GetWorldInfo();var _postWiLayer=_postWi2.GetLayer();_postWi2._SetDrawNonBackFacesOnly(true);MaybePrepareLayerDraw(_postWiLayer,renderer);_postWiLayer._DrawInstanceMaybeWithEffects(_postInst2,_postWi2,renderer,renderTarget);_postWi2._SetDrawNonBackFacesOnly(false);}}i=endIndex;_C88.clearArray(coplanarInstances);_C88.clearArray(postRenderInstances);}if(layerQuery)renderer.EndQuery(layerQuery);if(this._runtime.IsGPUProfiling()&&renderer.IsWebGPU())renderer.WriteTimestamp((firstLayer.GetIndex()+1)*2+1);_C88.clearArray(fullInstanceList);lastLayerPreparedForDrawing=null;}},{key:"_Draw3DLayersCoplanarInstances",value:function _Draw3DLayersCoplanarInstances(renderer,renderTarget,instances){renderer.CoplanarStartStencilPass();for(var i=0,len=instances.length;i<len;++i){var inst=instances[i];var wi=inst.GetWorldInfo();var layer=wi.GetLayer();wi._SetDrawBackFaceOnly(true);MaybePrepareLayerDraw(layer,renderer);layer._DrawInstance(inst,wi,renderer);}renderer.CoplanarStartColorPass();for(var _i38=0,_len36=instances.length;_i38<_len36;++_i38){var _inst8=instances[_i38];var _wi2=_inst8.GetWorldInfo();var _layer4=_wi2.GetLayer();MaybePrepareLayerDraw(_layer4,renderer);_layer4._DrawInstanceMaybeWithEffects(_inst8,_wi2,renderer,renderTarget);_wi2._SetDrawBackFaceOnly(false);}renderer.CoplanarRestoreStandardRendering();}},{key:"_SaveToJson",value:function _SaveToJson(){var o={"sx":this.GetScrollX(),"sy":this.GetScrollY(),"s":this.GetScale(),"a":this.GetAngle(),"w":this.GetWidth(),"h":this.GetHeight(),"ortho":this.IsOrthographicProjection(),"vpX":this.GetVanishingPointX(),"vpY":this.GetVanishingPointY(),"fv":this._isFirstVisit,"persist":this._persistData,"fx":this._effectList.SaveToJson(),"layers":{},"dynamicLayers":[]};var _iteratorNormalCompletion190=true;var _didIteratorError190=false;var _iteratorError190=undefined;try{for(var _iterator190=this._allLayersFlat[Symbol.iterator](),_step190;!(_iteratorNormalCompletion190=(_step190=_iterator190.next()).done);_iteratorNormalCompletion190=true){var layer=_step190.value;if(layer.IsDynamic()){var parentLayer=layer.GetParentLayer();o["dynamicLayers"].push({"sid":layer.GetSID(),"name":layer.GetName(),"parentSid":parentLayer?parentLayer.GetSID():null,"siblingIndex":layer._GetSiblingIndex(),"data":layer._SaveToJson()});}else o["layers"][layer.GetSID().toString()]=layer._SaveToJson();}}catch(err){_didIteratorError190=true;_iteratorError190=err;}finally{try{if(!_iteratorNormalCompletion190&&_iterator190["return"]!=null){_iterator190["return"]();}}finally{if(_didIteratorError190){throw _iteratorError190;}}}return o;}},{key:"_LoadFromJson",value:function _LoadFromJson(o){this._scrollX=o["sx"];this._scrollY=o["sy"];this._scale=o["s"];this._angle=o["a"];this._width=o["w"];this._height=o["h"];this._isOrthographicProjection=!!o["ortho"];if(o.hasOwnProperty("vpX"))this._vanishingPointX=o["vpX"];if(o.hasOwnProperty("vpY"))this._vanishingPointY=o["vpY"];this._isFirstVisit=!!o["fv"];this._persistData=o["persist"];this._effectList.LoadFromJson(o["fx"]);this._needsRebuildEffectChainSteps=true;for(var _i39=0,_Object$entries9=Object.entries(o["layers"]);_i39<_Object$entries9.length;_i39++){var _Object$entries9$_i=_slicedToArray(_Object$entries9[_i39],2),sidStr=_Object$entries9$_i[0],data=_Object$entries9$_i[1];var _sid=parseInt(sidStr,10);var _layer6=this.GetLayerBySID(_sid);if(!_layer6)continue;_layer6._LoadFromJson(data);}if(o.hasOwnProperty("dynamicLayers")){this.RemoveAllDynamicLayers();this._runtime.FlushPendingInstances();var reorderLayers=new Map();var dynamicLayersData=o["dynamicLayers"];for(var i=dynamicLayersData.length-1;i>=0;--i){var dld=dynamicLayersData[i];var sid=dld["sid"];var layerName=dld["name"];var parentSid=dld["parentSid"];var siblingIndex=dld["siblingIndex"];var layerData=dld["data"];this._ReindexLayers();if(this.HasLayerByName(layerName)||this.GetLayerBySID(sid))continue;var parentLayer=void 0;var parentLayerArr=void 0;if(parentSid===null){parentLayer=null;parentLayerArr=this._rootLayers;}else{parentLayer=this.GetLayerBySID(parentSid);if(!parentLayer)continue;parentLayerArr=parentLayer.GetSubLayers();}var layer=_C88.New(_C88.Layer,this,parentLayer,{name:layerName,sid:sid,isDynamic:true});parentLayerArr.push(layer);var arr=reorderLayers.get(parentLayerArr);if(!arr){arr=[];reorderLayers.set(parentLayerArr,arr);}arr.push({layer:layer,siblingIndex:siblingIndex});layer._LoadFromJson(layerData);}var _iteratorNormalCompletion191=true;var _didIteratorError191=false;var _iteratorError191=undefined;try{for(var _iterator191=reorderLayers[Symbol.iterator](),_step191;!(_iteratorNormalCompletion191=(_step191=_iterator191.next()).done);_iteratorNormalCompletion191=true){var _step191$value=_slicedToArray(_step191.value,2),_parentLayerArr=_step191$value[0],reorderArr=_step191$value[1];reorderArr.sort(function(a,b){return a.siblingIndex-b.siblingIndex;});var _iteratorNormalCompletion192=true;var _didIteratorError192=false;var _iteratorError192=undefined;try{for(var _iterator192=reorderArr[Symbol.iterator](),_step192;!(_iteratorNormalCompletion192=(_step192=_iterator192.next()).done);_iteratorNormalCompletion192=true){var r=_step192.value;var _layer5=r.layer;var _siblingIndex=r.siblingIndex;var _i40=_parentLayerArr.indexOf(_layer5);_parentLayerArr.splice(_i40,1);_parentLayerArr.splice(_siblingIndex,0,_layer5);}}catch(err){_didIteratorError192=true;_iteratorError192=err;}finally{try{if(!_iteratorNormalCompletion192&&_iterator192["return"]!=null){_iterator192["return"]();}}finally{if(_didIteratorError192){throw _iteratorError192;}}}}}catch(err){_didIteratorError191=true;_iteratorError191=err;}finally{try{if(!_iteratorNormalCompletion191&&_iterator191["return"]!=null){_iterator191["return"]();}}finally{if(_didIteratorError191){throw _iteratorError191;}}}}this._ReindexAndUpdateAllLayers();this._SetAllLayersProjectionChanged();this._SetAllLayersMVChanged();}},{key:"GetILayout",value:function GetILayout(){return this._iLayout;}},{key:"UserScriptDispatcher",value:function UserScriptDispatcher(){return this._userScriptDispatcher;}},{key:"DispatchUserScriptEvent",value:function DispatchUserScriptEvent(e){e.layout=this.GetILayout();var runtime=this._runtime;var shouldTime=runtime.IsDebug()&&!runtime.GetEventSheetManager().IsInEventEngine();if(shouldTime)C3Debugger.StartMeasuringScriptTime();this._userScriptDispatcher.dispatchEvent(e);if(shouldTime)C3Debugger.AddScriptTime();}},{key:"DispatchUserScriptEventAsyncWait",value:function DispatchUserScriptEventAsyncWait(e){e.layout=this.GetILayout();return this._userScriptDispatcher.dispatchEventAndWaitAsync(e);}},{key:"_LogLayerTree",value:function _LogLayerTree(){this._LogLayerList(this._rootLayers);}},{key:"_LogLayerList",value:function _LogLayerList(layersArr){var indent=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var layersRev=layersArr.slice(0);layersRev.reverse();var _iteratorNormalCompletion193=true;var _didIteratorError193=false;var _iteratorError193=undefined;try{for(var _iterator193=layersRev[Symbol.iterator](),_step193;!(_iteratorNormalCompletion193=(_step193=_iterator193.next()).done);_iteratorNormalCompletion193=true){var layer=_step193.value;console.log("".concat("\t".repeat(indent),"- ").concat(layer.GetName()));this._LogLayerList(layer.GetSubLayers(),indent+1);}}catch(err){_didIteratorError193=true;_iteratorError193=err;}finally{try{if(!_iteratorNormalCompletion193&&_iterator193["return"]!=null){_iterator193["return"]();}}finally{if(_didIteratorError193){throw _iteratorError193;}}}}}]);return Layout;}(_C88.DefendedBase);}// layouts/layoutManager.js
{'use strict';var _C89=self.C3;_C89.LayoutManager=/*#__PURE__*/function(_C89$DefendedBase){_inherits(LayoutManager,_C89$DefendedBase);function LayoutManager(runtime){var _this44;_classCallCheck(this,LayoutManager);_this44=_possibleConstructorReturn(this,_getPrototypeOf(LayoutManager).call(this));_this44._runtime=runtime;_this44._allLayouts=[];_this44._layoutsByName=new Map();_this44._layoutsBySid=new Map();_this44._mainRunningLayout=null;_this44._runningSubLayouts=[];_this44._firstLayout=null;_this44._isEndingLayout=0;_this44._pendingChangeLayout=null;return _this44;}_createClass(LayoutManager,[{key:"Release",value:function Release(){this._runtime=null;this._mainRunningLayout=null;this._firstLayout=null;this._pendingChangeLayout=null;_C89.clearArray(this._allLayouts);this._layoutsByName.clear();this._layoutsBySid.clear();_C89.clearArray(this._runningSubLayouts);}},{key:"Create",value:function Create(layoutData){var layout=_C89.New(_C89.Layout,this,this._allLayouts.length,layoutData);this._allLayouts.push(layout);this._layoutsByName.set(layout.GetName().toLowerCase(),layout);this._layoutsBySid.set(layout.GetSID(),layout);}},{key:"GetRuntime",value:function GetRuntime(){return this._runtime;}},{key:"SetFirstLayout",value:function SetFirstLayout(layout){this._firstLayout=layout;}},{key:"GetFirstLayout",value:function GetFirstLayout(){if(this._firstLayout)return this._firstLayout;if(this._allLayouts.length)return this._allLayouts[0];throw new Error("no first layout");}},{key:"GetLayoutByName",value:function GetLayoutByName(name){return this._layoutsByName.get(name.toLowerCase())||null;}},{key:"GetLayoutBySID",value:function GetLayoutBySID(sid){return this._layoutsBySid.get(sid)||null;}},{key:"GetLayoutByIndex",value:function GetLayoutByIndex(index){index=_C89.clamp(Math.floor(index),0,this._allLayouts.length-1);return this._allLayouts[index];}},{key:"GetLayout",value:function GetLayout(p){if(typeof p==="number")return this.GetLayoutByIndex(p);else return this.GetLayoutByName(p.toString());}},{key:"GetAllLayouts",value:function GetAllLayouts(){return this._allLayouts;}},{key:"_SetMainRunningLayout",value:function _SetMainRunningLayout(layout){this._mainRunningLayout=layout;}},{key:"GetMainRunningLayout",value:function GetMainRunningLayout(){return this._mainRunningLayout;}},{key:"_AddRunningSubLayout",value:function _AddRunningSubLayout(layout){if(this._runningSubLayouts.includes(layout))throw new Error("layout already running");this._runningSubLayouts.push(layout);}},{key:"_RemoveRunningSubLayout",value:function _RemoveRunningSubLayout(layout){var i=this._runningSubLayouts.indexOf(layout);if(i===-1)throw new Error("layout not running");this._runningSubLayouts.splice(i,1);}},{key:"runningLayouts",value:/*#__PURE__*/regeneratorRuntime.mark(function runningLayouts(){return regeneratorRuntime.wrap(function runningLayouts$(_context84){while(1){switch(_context84.prev=_context84.next){case 0:if(!this._mainRunningLayout){_context84.next=3;break;}_context84.next=3;return this._mainRunningLayout;case 3:if(!this._runningSubLayouts.length){_context84.next=5;break;}return _context84.delegateYield(this._runningSubLayouts,"t0",5);case 5:case"end":return _context84.stop();}}},runningLayouts,this);})},{key:"IsLayoutRunning",value:function IsLayoutRunning(layout){return this._mainRunningLayout===layout||this._runningSubLayouts.includes(layout);}},{key:"SetIsEndingLayout",value:function SetIsEndingLayout(e){if(e)this._isEndingLayout++;else{if(this._isEndingLayout<=0)throw new Error("already unset");this._isEndingLayout--;}}},{key:"IsEndingLayout",value:function IsEndingLayout(){return this._isEndingLayout>0;}},{key:"ChangeMainLayout",value:function ChangeMainLayout(layout){this._pendingChangeLayout=layout;}},{key:"ClearPendingChangeLayout",value:function ClearPendingChangeLayout(){this._pendingChangeLayout=null;}},{key:"IsPendingChangeMainLayout",value:function IsPendingChangeMainLayout(){return!!this._pendingChangeLayout;}},{key:"GetPendingChangeMainLayout",value:function GetPendingChangeMainLayout(){return this._pendingChangeLayout;}},{key:"SetAllLayerProjectionChanged",value:function SetAllLayerProjectionChanged(){var runningLayout=this.GetMainRunningLayout();if(!runningLayout)return;runningLayout._SetAllLayersProjectionChanged();}},{key:"SetAllLayerMVChanged",value:function SetAllLayerMVChanged(){var runningLayout=this.GetMainRunningLayout();if(!runningLayout)return;runningLayout._SetAllLayersMVChanged();}}]);return LayoutManager;}(_C89.DefendedBase);}// timelines/timelineManager.js
{'use strict';var _C90=self.C3;var NAMES_REGEXP=new RegExp("<(.+?)>","g");_C90.TimelineManager=/*#__PURE__*/function(_C90$DefendedBase){_inherits(TimelineManager,_C90$DefendedBase);function TimelineManager(runtime){var _this45;_classCallCheck(this,TimelineManager);_this45=_possibleConstructorReturn(this,_getPrototypeOf(TimelineManager).call(this));_this45._runtime=runtime;_this45._timelineDataManager=_C90.New(_C90.TimelineDataManager);_this45._pluginInstance=null;_this45._timelines=[];_this45._timelinesByName=new Map();_this45._objectClassToTimelineMap=new Map();_this45._timelinesCreatedByTemplate=new Map();_this45._scheduledTimelines=[];_this45._playingTimelines=[];_this45._markedForRemovalTimelines=[];_this45._hasRuntimeListeners=false;_this45._changingLayout=false;_this45._isTickingTimelines=false;_this45._tickFunc=function(){return _this45._OnTick();};_this45._tick2Func=function(){return _this45._OnTick2();};_this45._beforeLayoutChange=function(){return _this45._OnBeforeChangeLayout();};_this45._layoutChange=function(){return _this45._OnAfterChangeLayout();};_this45._instanceDestroy=function(e){return _this45._OnInstanceDestroy(e.instance);};_this45._beforeLoad=function(e){return _this45._OnBeforeLoad();};_this45._afterLoad=function(e){return _this45._OnAfterLoad();};_this45._afterLayoutStart=function(e){return _this45._OnAfterLayoutStart();};_this45._destroyedWhileLoadingState=[];_this45._renderChange=0;return _this45;}_createClass(TimelineManager,[{key:"Release",value:function Release(){this.RemoveRuntimeListeners();this._tickFunc=null;this._tick2Func=null;this._beforeLayoutChange=null;this._layoutChange=null;this._instanceDestroy=null;this._afterLoad=null;var _iteratorNormalCompletion194=true;var _didIteratorError194=false;var _iteratorError194=undefined;try{for(var _iterator194=this._timelines[Symbol.iterator](),_step194;!(_iteratorNormalCompletion194=(_step194=_iterator194.next()).done);_iteratorNormalCompletion194=true){var timeline=_step194.value;timeline.Stop();timeline.Release();}}catch(err){_didIteratorError194=true;_iteratorError194=err;}finally{try{if(!_iteratorNormalCompletion194&&_iterator194["return"]!=null){_iterator194["return"]();}}finally{if(_didIteratorError194){throw _iteratorError194;}}}_C90.clearArray(this._timelines);this._timelines=null;this._timelineDataManager.Release();this._timelineDataManager=null;_C90.clearArray(this._scheduledTimelines);this._scheduledTimelines=null;_C90.clearArray(this._playingTimelines);this._playingTimelines=null;_C90.clearArray(this._markedForRemovalTimelines);this._markedForRemovalTimelines=null;this._timelinesByName.clear();this._timelinesByName=null;this._objectClassToTimelineMap.clear();this._objectClassToTimelineMap=null;this._timelinesCreatedByTemplate.clear();this._timelinesCreatedByTemplate=null;_C90.clearArray(this._destroyedWhileLoadingState);this._destroyedWhileLoadingState=null;this._runtime=null;}},{key:"AddRuntimeListeners",value:function AddRuntimeListeners(){var dispatcher=this._runtime.Dispatcher();dispatcher.addEventListener("pretick",this._tickFunc);dispatcher.addEventListener("tick2",this._tick2Func);dispatcher.addEventListener("beforelayoutchange",this._beforeLayoutChange);dispatcher.addEventListener("layoutchange",this._layoutChange);dispatcher.addEventListener("instancedestroy",this._instanceDestroy);dispatcher.addEventListener("beforeload",this._beforeLoad);dispatcher.addEventListener("afterload",this._afterLoad);dispatcher.addEventListener("afterlayoutstart",this._afterLayoutStart);}},{key:"RemoveRuntimeListeners",value:function RemoveRuntimeListeners(){var dispatcher=this._runtime.Dispatcher();dispatcher.removeEventListener("pretick",this._tickFunc);dispatcher.removeEventListener("tick2",this._tick2Func);dispatcher.removeEventListener("beforelayoutchange",this._beforeLayoutChange);dispatcher.removeEventListener("layoutchange",this._layoutChange);dispatcher.removeEventListener("instancedestroy",this._instanceDestroy);dispatcher.removeEventListener("beforeload",this._beforeLoad);dispatcher.removeEventListener("afterload",this._afterLoad);dispatcher.removeEventListener("afterlayoutstart",this._afterLayoutStart);}},{key:"Create",value:function Create(timelineData){this._timelineDataManager.Add(timelineData);var timeline=_C90.TimelineState.CreateInitial(timelineData,this);this.Add(timeline);this.SetTimelineObjectClassesToMap(timeline);this._timelinesCreatedByTemplate.set(timeline.GetName(),0);}},{key:"CreateFromTemplate",value:function CreateFromTemplate(template){var timelineDataManager=this.GetTimelineDataManager();var templateName=template.GetTemplateName();var timelineDataItem=timelineDataManager.Get(templateName);var timeline=_C90.TimelineState.CreateFromTemplate("".concat(templateName,":").concat(this._timelinesCreatedByTemplate.get(templateName)),timelineDataItem,this);this._IncreaseTemplateTimelinesCount(templateName);this.Add(timeline);return timeline;}},{key:"_IncreaseTemplateTimelinesCount",value:function _IncreaseTemplateTimelinesCount(templateName){this._timelinesCreatedByTemplate.set(templateName,this._timelinesCreatedByTemplate.get(templateName)+1);}},{key:"_SetCreatedTemplateTimelinesCount",value:function _SetCreatedTemplateTimelinesCount(){var _iteratorNormalCompletion195=true;var _didIteratorError195=false;var _iteratorError195=undefined;try{for(var _iterator195=this._timelines[Symbol.iterator](),_step195;!(_iteratorNormalCompletion195=(_step195=_iterator195.next()).done);_iteratorNormalCompletion195=true){var timeline=_step195.value;if(timeline.IsTemplate())continue;var templateName=timeline.GetTemplateName();this._IncreaseTemplateTimelinesCount(templateName);}}catch(err){_didIteratorError195=true;_iteratorError195=err;}finally{try{if(!_iteratorNormalCompletion195&&_iterator195["return"]!=null){_iterator195["return"]();}}finally{if(_didIteratorError195){throw _iteratorError195;}}}}},{key:"_ClearCreatedTemplateTimelinesCount",value:function _ClearCreatedTemplateTimelinesCount(){var _iteratorNormalCompletion196=true;var _didIteratorError196=false;var _iteratorError196=undefined;try{for(var _iterator196=this._timelinesCreatedByTemplate.keys()[Symbol.iterator](),_step196;!(_iteratorNormalCompletion196=(_step196=_iterator196.next()).done);_iteratorNormalCompletion196=true){var templateName=_step196.value;this._timelinesCreatedByTemplate.set(templateName,0);}}catch(err){_didIteratorError196=true;_iteratorError196=err;}finally{try{if(!_iteratorNormalCompletion196&&_iterator196["return"]!=null){_iterator196["return"]();}}finally{if(_didIteratorError196){throw _iteratorError196;}}}}},{key:"Add",value:function Add(timeline){this._timelines.push(timeline);this._timelinesByName.set(timeline.GetName().toLowerCase(),timeline);}},{key:"Remove",value:function Remove(timeline){timeline.Removed();if(timeline.IsTemplate())return;_C90.arrayFindRemove(this._timelines,timeline);_C90.arrayFindRemove(this._scheduledTimelines,timeline);_C90.arrayFindRemove(this._playingTimelines,timeline);_C90.arrayFindRemove(this._markedForRemovalTimelines,timeline);this._timelinesByName["delete"](timeline.GetName().toLowerCase());this.RemoveTimelineFromObjectClassMap(timeline);if(!timeline.IsReleased())timeline.Release();}},{key:"Trigger",value:function Trigger(method){this._runtime.Trigger(method,this._pluginInstance,null);}},{key:"GetRuntime",value:function GetRuntime(){return this._runtime;}},{key:"GetTimelineDataManager",value:function GetTimelineDataManager(){return this._timelineDataManager;}},{key:"SetPluginInstance",value:function SetPluginInstance(inst){this._pluginInstance=inst;}},{key:"GetPluginInstance",value:function GetPluginInstance(){return this._pluginInstance;}},{key:"GetTimelines",value:/*#__PURE__*/regeneratorRuntime.mark(function GetTimelines(){var _iteratorNormalCompletion197,_didIteratorError197,_iteratorError197,_iterator197,_step197,timeline;return regeneratorRuntime.wrap(function GetTimelines$(_context85){while(1){switch(_context85.prev=_context85.next){case 0:_iteratorNormalCompletion197=true;_didIteratorError197=false;_iteratorError197=undefined;_context85.prev=3;_iterator197=this._timelines[Symbol.iterator]();case 5:if(_iteratorNormalCompletion197=(_step197=_iterator197.next()).done){_context85.next=12;break;}timeline=_step197.value;_context85.next=9;return timeline;case 9:_iteratorNormalCompletion197=true;_context85.next=5;break;case 12:_context85.next=18;break;case 14:_context85.prev=14;_context85.t0=_context85["catch"](3);_didIteratorError197=true;_iteratorError197=_context85.t0;case 18:_context85.prev=18;_context85.prev=19;if(!_iteratorNormalCompletion197&&_iterator197["return"]!=null){_iterator197["return"]();}case 21:_context85.prev=21;if(!_didIteratorError197){_context85.next=24;break;}throw _iteratorError197;case 24:return _context85.finish(21);case 25:return _context85.finish(18);case 26:case"end":return _context85.stop();}}},GetTimelines,this,[[3,14,18,26],[19,,21,25]]);})},{key:"GetPlayingTimelines",value:/*#__PURE__*/regeneratorRuntime.mark(function GetPlayingTimelines(){var _iteratorNormalCompletion198,_didIteratorError198,_iteratorError198,_iterator198,_step198,timeline;return regeneratorRuntime.wrap(function GetPlayingTimelines$(_context86){while(1){switch(_context86.prev=_context86.next){case 0:_iteratorNormalCompletion198=true;_didIteratorError198=false;_iteratorError198=undefined;_context86.prev=3;_iterator198=this._playingTimelines[Symbol.iterator]();case 5:if(_iteratorNormalCompletion198=(_step198=_iterator198.next()).done){_context86.next=12;break;}timeline=_step198.value;_context86.next=9;return timeline;case 9:_iteratorNormalCompletion198=true;_context86.next=5;break;case 12:_context86.next=18;break;case 14:_context86.prev=14;_context86.t0=_context86["catch"](3);_didIteratorError198=true;_iteratorError198=_context86.t0;case 18:_context86.prev=18;_context86.prev=19;if(!_iteratorNormalCompletion198&&_iterator198["return"]!=null){_iterator198["return"]();}case 21:_context86.prev=21;if(!_didIteratorError198){_context86.next=24;break;}throw _iteratorError198;case 24:return _context86.finish(21);case 25:return _context86.finish(18);case 26:case"end":return _context86.stop();}}},GetPlayingTimelines,this,[[3,14,18,26],[19,,21,25]]);})},{key:"SetTimelineObjectClassToMap",value:function SetTimelineObjectClassToMap(objectClass,timeline){if(!this._objectClassToTimelineMap.has(objectClass))this._objectClassToTimelineMap.set(objectClass,new Set());this._objectClassToTimelineMap.get(objectClass).add(timeline);}},{key:"SetTimelineObjectClassesToMap",value:function SetTimelineObjectClassesToMap(timeline){var _iteratorNormalCompletion199=true;var _didIteratorError199=false;var _iteratorError199=undefined;try{for(var _iterator199=timeline.GetObjectClasses()[Symbol.iterator](),_step199;!(_iteratorNormalCompletion199=(_step199=_iterator199.next()).done);_iteratorNormalCompletion199=true){var objectClass=_step199.value;this.SetTimelineObjectClassToMap(objectClass,timeline);}}catch(err){_didIteratorError199=true;_iteratorError199=err;}finally{try{if(!_iteratorNormalCompletion199&&_iterator199["return"]!=null){_iterator199["return"]();}}finally{if(_didIteratorError199){throw _iteratorError199;}}}}},{key:"RemoveTimelineFromObjectClassMap",value:function RemoveTimelineFromObjectClassMap(timeline){var _iteratorNormalCompletion200=true;var _didIteratorError200=false;var _iteratorError200=undefined;try{for(var _iterator200=this._objectClassToTimelineMap.entries()[Symbol.iterator](),_step200;!(_iteratorNormalCompletion200=(_step200=_iterator200.next()).done);_iteratorNormalCompletion200=true){var _step200$value=_slicedToArray(_step200.value,2),objectClass=_step200$value[0],timelines=_step200$value[1];if(timelines.has(timeline)){timelines["delete"](timeline);if(timelines.size===0)this._objectClassToTimelineMap["delete"](objectClass);}}}catch(err){_didIteratorError200=true;_iteratorError200=err;}finally{try{if(!_iteratorNormalCompletion200&&_iterator200["return"]!=null){_iterator200["return"]();}}finally{if(_didIteratorError200){throw _iteratorError200;}}}}},{key:"GetTimelinesForObjectClass",value:function GetTimelinesForObjectClass(objectClass){if(!this._objectClassToTimelineMap.has(objectClass))return;return this._objectClassToTimelineMap.get(objectClass);}},{key:"GetTimelineOfTemplateForInstances",value:function GetTimelineOfTemplateForInstances(templateTimeline,instancesObject){if(!instancesObject)return;var _iteratorNormalCompletion201=true;var _didIteratorError201=false;var _iteratorError201=undefined;try{var _loop8=function _loop8(){var timeline=_step201.value;var found=instancesObject.every(function(io){return timeline.HasTrackInstance(io.instance,io.trackId);});if(found)if(timeline.GetName().includes(templateTimeline.GetName()))return{v:timeline};};for(var _iterator201=this._timelines[Symbol.iterator](),_step201;!(_iteratorNormalCompletion201=(_step201=_iterator201.next()).done);_iteratorNormalCompletion201=true){var _ret4=_loop8();if(_typeof(_ret4)==="object")return _ret4.v;}}catch(err){_didIteratorError201=true;_iteratorError201=err;}finally{try{if(!_iteratorNormalCompletion201&&_iterator201["return"]!=null){_iterator201["return"]();}}finally{if(_didIteratorError201){throw _iteratorError201;}}}}},{key:"GetTimelineByName",value:function GetTimelineByName(name){return this._timelinesByName.get(name.toLowerCase())||null;}},{key:"GetScheduledOrPlayingTimelineByName",value:function GetScheduledOrPlayingTimelineByName(name){var _iteratorNormalCompletion202=true;var _didIteratorError202=false;var _iteratorError202=undefined;try{for(var _iterator202=this._scheduledTimelines[Symbol.iterator](),_step202;!(_iteratorNormalCompletion202=(_step202=_iterator202.next()).done);_iteratorNormalCompletion202=true){var timeline=_step202.value;if(timeline.GetName()===name)return timeline;}}catch(err){_didIteratorError202=true;_iteratorError202=err;}finally{try{if(!_iteratorNormalCompletion202&&_iterator202["return"]!=null){_iterator202["return"]();}}finally{if(_didIteratorError202){throw _iteratorError202;}}}var _iteratorNormalCompletion203=true;var _didIteratorError203=false;var _iteratorError203=undefined;try{for(var _iterator203=this._playingTimelines[Symbol.iterator](),_step203;!(_iteratorNormalCompletion203=(_step203=_iterator203.next()).done);_iteratorNormalCompletion203=true){var _timeline=_step203.value;if(_timeline.GetName()===name)return _timeline;}}catch(err){_didIteratorError203=true;_iteratorError203=err;}finally{try{if(!_iteratorNormalCompletion203&&_iterator203["return"]!=null){_iterator203["return"]();}}finally{if(_didIteratorError203){throw _iteratorError203;}}}return null;}},{key:"GetTimelinesByName",value:/*#__PURE__*/regeneratorRuntime.mark(function GetTimelinesByName(name){var match,uniqueNames,names,_iteratorNormalCompletion204,_didIteratorError204,_iteratorError204,_iterator204,_step204,_name,_iteratorNormalCompletion205,_didIteratorError205,_iteratorError205,_iterator205,_step205,_name2,timeline,_timeline2;return regeneratorRuntime.wrap(function GetTimelinesByName$(_context87){while(1){switch(_context87.prev=_context87.next){case 0:if(!NAMES_REGEXP.test(name)){_context87.next=57;break;}NAMES_REGEXP.lastIndex=0;uniqueNames=new Set();case 3:match=NAMES_REGEXP.exec(name);if(!match){_context87.next=25;break;}names=match[1].split(",");_iteratorNormalCompletion204=true;_didIteratorError204=false;_iteratorError204=undefined;_context87.prev=9;for(_iterator204=names[Symbol.iterator]();!(_iteratorNormalCompletion204=(_step204=_iterator204.next()).done);_iteratorNormalCompletion204=true){_name=_step204.value;uniqueNames.add(_name);}_context87.next=17;break;case 13:_context87.prev=13;_context87.t0=_context87["catch"](9);_didIteratorError204=true;_iteratorError204=_context87.t0;case 17:_context87.prev=17;_context87.prev=18;if(!_iteratorNormalCompletion204&&_iterator204["return"]!=null){_iterator204["return"]();}case 20:_context87.prev=20;if(!_didIteratorError204){_context87.next=23;break;}throw _iteratorError204;case 23:return _context87.finish(20);case 24:return _context87.finish(17);case 25:if(match){_context87.next=3;break;}case 26:_iteratorNormalCompletion205=true;_didIteratorError205=false;_iteratorError205=undefined;_context87.prev=29;_iterator205=uniqueNames.values()[Symbol.iterator]();case 31:if(_iteratorNormalCompletion205=(_step205=_iterator205.next()).done){_context87.next=40;break;}_name2=_step205.value;timeline=this.GetTimelineByName(_name2);if(!timeline){_context87.next=37;break;}_context87.next=37;return timeline;case 37:_iteratorNormalCompletion205=true;_context87.next=31;break;case 40:_context87.next=46;break;case 42:_context87.prev=42;_context87.t1=_context87["catch"](29);_didIteratorError205=true;_iteratorError205=_context87.t1;case 46:_context87.prev=46;_context87.prev=47;if(!_iteratorNormalCompletion205&&_iterator205["return"]!=null){_iterator205["return"]();}case 49:_context87.prev=49;if(!_didIteratorError205){_context87.next=52;break;}throw _iteratorError205;case 52:return _context87.finish(49);case 53:return _context87.finish(46);case 54:uniqueNames.clear();_context87.next=61;break;case 57:_timeline2=this.GetTimelineByName(name);if(!_timeline2){_context87.next=61;break;}_context87.next=61;return _timeline2;case 61:case"end":return _context87.stop();}}},GetTimelinesByName,this,[[9,13,17,25],[18,,20,24],[29,42,46,54],[47,,49,53]]);})},{key:"GetTimelinesByTags",value:/*#__PURE__*/regeneratorRuntime.mark(function GetTimelinesByTags(tags){var _iteratorNormalCompletion206,_didIteratorError206,_iteratorError206,_iterator206,_step206,timeline;return regeneratorRuntime.wrap(function GetTimelinesByTags$(_context88){while(1){switch(_context88.prev=_context88.next){case 0:_iteratorNormalCompletion206=true;_didIteratorError206=false;_iteratorError206=undefined;_context88.prev=3;_iterator206=this._timelines[Symbol.iterator]();case 5:if(_iteratorNormalCompletion206=(_step206=_iterator206.next()).done){_context88.next=13;break;}timeline=_step206.value;if(!timeline.HasTags(tags)){_context88.next=10;break;}_context88.next=10;return timeline;case 10:_iteratorNormalCompletion206=true;_context88.next=5;break;case 13:_context88.next=19;break;case 15:_context88.prev=15;_context88.t0=_context88["catch"](3);_didIteratorError206=true;_iteratorError206=_context88.t0;case 19:_context88.prev=19;_context88.prev=20;if(!_iteratorNormalCompletion206&&_iterator206["return"]!=null){_iterator206["return"]();}case 22:_context88.prev=22;if(!_didIteratorError206){_context88.next=25;break;}throw _iteratorError206;case 25:return _context88.finish(22);case 26:return _context88.finish(19);case 27:case"end":return _context88.stop();}}},GetTimelinesByTags,this,[[3,15,19,27],[20,,22,26]]);})},{key:"AddScheduledTimeline",value:function AddScheduledTimeline(timeline){if(!this._scheduledTimelines.includes(timeline))this._scheduledTimelines.push(timeline);this._MaybeEnableRuntimeListeners();}},{key:"RemovePlayingTimeline",value:function RemovePlayingTimeline(timeline){_C90.arrayFindRemove(this._playingTimelines,timeline);this._MaybeDisableRuntimeListeners();}},{key:"ScheduleTimeline",value:function ScheduleTimeline(timeline){if(this._playingTimelines.includes(timeline)){timeline.SetPlaying(true);timeline.SetScheduled(false);timeline.SetMarkedForRemoval(false);}else{timeline.SetPlaying(false);timeline.SetScheduled(true);timeline.SetMarkedForRemoval(false);if(!this._scheduledTimelines.includes(timeline))this._scheduledTimelines.push(timeline);}this._MaybeEnableRuntimeListeners();}},{key:"DeScheduleTimeline",value:function DeScheduleTimeline(timeline){timeline.SetPlaying(false);timeline.SetScheduled(false);timeline.ResolvePlayPromise();_C90.arrayFindRemove(this._scheduledTimelines,timeline);this._MaybeDisableRuntimeListeners();}},{key:"CompleteTimeline",value:function CompleteTimeline(timeline){timeline.SetPlaying(false);timeline.SetScheduled(false);if(this._playingTimelines.includes(timeline)){timeline.SetMarkedForRemoval(true);this._markedForRemovalTimelines.push(timeline);_C90.arrayFindRemove(this._playingTimelines,timeline);}}},{key:"CompleteTimelineBeforeChangeOfLayout",value:function CompleteTimelineBeforeChangeOfLayout(timeline){timeline.SetPlaying(false);timeline.SetScheduled(false);timeline.SetMarkedForRemoval(false);timeline.SetPlaybackRate(1);_C90.arrayFindRemove(this._playingTimelines,timeline);}},{key:"CompleteTimelineAndResolve",value:function CompleteTimelineAndResolve(timeline){this.CompleteTimeline(timeline);timeline.ResolvePlayPromise();}},{key:"_OnTick",value:function _OnTick(){if(this.GetRuntime().IsLoadingState())return;if(!this._hasRuntimeListeners)return;if(this._changingLayout)return;this._isTickingTimelines=true;while(this._scheduledTimelines.length){var t=this._scheduledTimelines.pop();t.SetInitialState();if(t.GetRenderChange()!==0)this._renderChange=1;this._playingTimelines.push(t);}var dt=this._runtime._GetDtFast();var dt1=this._runtime.GetDt1();var ts=this._runtime.GetTimeScale();for(var i=this._playingTimelines.length-1;i>=0;i--){var _t=this._playingTimelines[i];if(_t)_t.Tick(dt,ts,dt1);}this._isTickingTimelines=false;if(this._renderChange!==0)this.GetRuntime().UpdateRender();}},{key:"_OnTick2",value:function _OnTick2(){if(this.GetRuntime().IsLoadingState())return;if(!this._hasRuntimeListeners)return;if(this._changingLayout)return;var timelinesToRemove;for(var i=0,l=this._markedForRemovalTimelines.length;i<l;i++){var t=this._markedForRemovalTimelines[i];if(!timelinesToRemove)timelinesToRemove=new Set();t.Removed();this._MaybeExecuteTimelineFinishTriggers(t);timelinesToRemove.add(t);}if(timelinesToRemove){_C90.arrayRemoveAllInSet(this._markedForRemovalTimelines,timelinesToRemove);this._renderChange=0;for(var _i41=0,_l=this._playingTimelines.length;_i41<_l;_i41++){if(this._playingTimelines[_i41].GetRenderChange()!==0){this._renderChange=1;break;}}}this._MaybeDisableRuntimeListeners();}},{key:"_MaybeExecuteTimelineFinishTriggers",value:function _MaybeExecuteTimelineFinishTriggers(timeline){if(timeline.IsReleased())return;if(!timeline.HasValidTracks())return;if(timeline.IsComplete()&&timeline.InitialStateSet())timeline.FinishTriggers();}},{key:"_MaybeEnableRuntimeListeners",value:function _MaybeEnableRuntimeListeners(){if(this._hasRuntimeListeners)return;this._hasRuntimeListeners=true;}},{key:"_MaybeDisableRuntimeListeners",value:function _MaybeDisableRuntimeListeners(){if(this._markedForRemovalTimelines.length)return;if(this._playingTimelines.length)return;if(this._scheduledTimelines.length)return;if(this._isTickingTimelines)return;this._hasRuntimeListeners=false;}},{key:"_OnBeforeChangeLayout",value:function _OnBeforeChangeLayout(){this._changingLayout=true;while(this._scheduledTimelines.length){this.DeScheduleTimeline(this._scheduledTimelines.pop());}var timelinesToRemove=new Set();var _iteratorNormalCompletion207=true;var _didIteratorError207=false;var _iteratorError207=undefined;try{for(var _iterator207=this._playingTimelines[Symbol.iterator](),_step207;!(_iteratorNormalCompletion207=(_step207=_iterator207.next()).done);_iteratorNormalCompletion207=true){var t=_step207.value;var remove=t._OnBeforeChangeLayout();if(remove){t.Removed();timelinesToRemove.add(t);}}}catch(err){_didIteratorError207=true;_iteratorError207=err;}finally{try{if(!_iteratorNormalCompletion207&&_iterator207["return"]!=null){_iterator207["return"]();}}finally{if(_didIteratorError207){throw _iteratorError207;}}}_C90.arrayRemoveAllInSet(this._playingTimelines,timelinesToRemove);timelinesToRemove.clear();var _iteratorNormalCompletion208=true;var _didIteratorError208=false;var _iteratorError208=undefined;try{for(var _iterator208=this._markedForRemovalTimelines[Symbol.iterator](),_step208;!(_iteratorNormalCompletion208=(_step208=_iterator208.next()).done);_iteratorNormalCompletion208=true){var _t2=_step208.value;var _remove=_t2._OnBeforeChangeLayout();if(_remove){_t2.Removed();timelinesToRemove.add(_t2);}}}catch(err){_didIteratorError208=true;_iteratorError208=err;}finally{try{if(!_iteratorNormalCompletion208&&_iterator208["return"]!=null){_iterator208["return"]();}}finally{if(_didIteratorError208){throw _iteratorError208;}}}_C90.arrayRemoveAllInSet(this._markedForRemovalTimelines,timelinesToRemove);this._MaybeDisableRuntimeListeners();var _iteratorNormalCompletion209=true;var _didIteratorError209=false;var _iteratorError209=undefined;try{for(var _iterator209=this._timelines[Symbol.iterator](),_step209;!(_iteratorNormalCompletion209=(_step209=_iterator209.next()).done);_iteratorNormalCompletion209=true){var timeline=_step209.value;timeline.CleanCaches();}}catch(err){_didIteratorError209=true;_iteratorError209=err;}finally{try{if(!_iteratorNormalCompletion209&&_iterator209["return"]!=null){_iterator209["return"]();}}finally{if(_didIteratorError209){throw _iteratorError209;}}}}},{key:"_OnAfterChangeLayout",value:function _OnAfterChangeLayout(){this._changingLayout=false;}},{key:"_OnInstanceDestroy",value:function _OnInstanceDestroy(instance){var objectClass=instance.GetObjectClass();var timelines=this.GetTimelinesForObjectClass(objectClass);if(!timelines)return;if(this._runtime.IsLoadingState())this._destroyedWhileLoadingState.push(instance);else{var _iteratorNormalCompletion210=true;var _didIteratorError210=false;var _iteratorError210=undefined;try{for(var _iterator210=timelines[Symbol.iterator](),_step210;!(_iteratorNormalCompletion210=(_step210=_iterator210.next()).done);_iteratorNormalCompletion210=true){var timeline=_step210.value;if(timeline.IsTemplate())continue;if(timeline.IsReleased()){this.Remove(timeline);continue;}if(!timeline.HasValidTracks()){this._MaybeExecuteTimelineFinishTriggers(timeline);this.Remove(timeline);}}}catch(err){_didIteratorError210=true;_iteratorError210=err;}finally{try{if(!_iteratorNormalCompletion210&&_iterator210["return"]!=null){_iterator210["return"]();}}finally{if(_didIteratorError210){throw _iteratorError210;}}}}}},{key:"_OnBeforeLoad",value:function _OnBeforeLoad(){var _iteratorNormalCompletion211=true;var _didIteratorError211=false;var _iteratorError211=undefined;try{for(var _iterator211=this._scheduledTimelines.map(function(t){return t;})[Symbol.iterator](),_step211;!(_iteratorNormalCompletion211=(_step211=_iterator211.next()).done);_iteratorNormalCompletion211=true){var timeline=_step211.value;this._MaybeExecuteTimelineFinishTriggers(timeline);this.Remove(timeline);}}catch(err){_didIteratorError211=true;_iteratorError211=err;}finally{try{if(!_iteratorNormalCompletion211&&_iterator211["return"]!=null){_iterator211["return"]();}}finally{if(_didIteratorError211){throw _iteratorError211;}}}var _iteratorNormalCompletion212=true;var _didIteratorError212=false;var _iteratorError212=undefined;try{for(var _iterator212=this._playingTimelines.map(function(t){return t;})[Symbol.iterator](),_step212;!(_iteratorNormalCompletion212=(_step212=_iterator212.next()).done);_iteratorNormalCompletion212=true){var _timeline3=_step212.value;this._MaybeExecuteTimelineFinishTriggers(_timeline3);this.Remove(_timeline3);}}catch(err){_didIteratorError212=true;_iteratorError212=err;}finally{try{if(!_iteratorNormalCompletion212&&_iterator212["return"]!=null){_iterator212["return"]();}}finally{if(_didIteratorError212){throw _iteratorError212;}}}}},{key:"_OnAfterLoad",value:function _OnAfterLoad(){var _iteratorNormalCompletion213=true;var _didIteratorError213=false;var _iteratorError213=undefined;try{for(var _iterator213=this._destroyedWhileLoadingState[Symbol.iterator](),_step213;!(_iteratorNormalCompletion213=(_step213=_iterator213.next()).done);_iteratorNormalCompletion213=true){var destroyedInstance=_step213.value;this._OnInstanceDestroy(destroyedInstance);}}catch(err){_didIteratorError213=true;_iteratorError213=err;}finally{try{if(!_iteratorNormalCompletion213&&_iterator213["return"]!=null){_iterator213["return"]();}}finally{if(_didIteratorError213){throw _iteratorError213;}}}_C90.clearArray(this._destroyedWhileLoadingState);}},{key:"_OnAfterLayoutStart",value:function _OnAfterLayoutStart(){var layoutManager=this._runtime.GetLayoutManager();var runningLayout=layoutManager.GetMainRunningLayout();if(!runningLayout)return;var _iteratorNormalCompletion214=true;var _didIteratorError214=false;var _iteratorError214=undefined;try{for(var _iterator214=this._timelines[Symbol.iterator](),_step214;!(_iteratorNormalCompletion214=(_step214=_iterator214.next()).done);_iteratorNormalCompletion214=true){var timeline=_step214.value;var startOnLayout=timeline.GetStartOnLayout();if(!startOnLayout)continue;if(runningLayout.GetName()===startOnLayout)this.ScheduleTimeline(timeline);}}catch(err){_didIteratorError214=true;_iteratorError214=err;}finally{try{if(!_iteratorNormalCompletion214&&_iterator214["return"]!=null){_iterator214["return"]();}}finally{if(_didIteratorError214){throw _iteratorError214;}}}}},{key:"_SaveToJson",value:function _SaveToJson(){return{"timelinesJson":this._SaveTimelinesToJson(),"scheduledTimelinesJson":this._SaveScheduledTimelinesToJson(),"playingTimelinesJson":this._SavePlayingTimelinesToJson(),"markedForRemovalTimelinesJson":this._SaveMarkedForRemovalTimelinesToJson(),"hasRuntimeListeners":this._hasRuntimeListeners,"changingLayout":this._changingLayout,"isTickingTimelines":this._isTickingTimelines};}},{key:"_LoadFromJson",value:function _LoadFromJson(o){if(!o)return;this._ClearCreatedTemplateTimelinesCount();this._LoadTimelinesFromJson(o["timelinesJson"]);this._LoadScheduledTimelinesFromJson(o["scheduledTimelinesJson"]);this._LoadPlayingTimelinesFromJson(o["playingTimelinesJson"]);this._LoadMarkedForRemovalTimelinesFromJson(o["markedForRemovalTimelinesJson"]);this._hasRuntimeListeners=!o["hasRuntimeListeners"];this._changingLayout=!!o["changingLayout"];this._isTickingTimelines=!!o["isTickingTimelines"];this._SetCreatedTemplateTimelinesCount();this._MaybeEnableRuntimeListeners();this._MaybeDisableRuntimeListeners();}},{key:"_SaveTimelinesToJson",value:function _SaveTimelinesToJson(){return this._timelines.map(function(timelineState){return timelineState._SaveToJson();});}},{key:"_LoadTimelinesFromJson",value:function _LoadTimelinesFromJson(timelinesJson){var _iteratorNormalCompletion215=true;var _didIteratorError215=false;var _iteratorError215=undefined;try{for(var _iterator215=timelinesJson[Symbol.iterator](),_step215;!(_iteratorNormalCompletion215=(_step215=_iterator215.next()).done);_iteratorNormalCompletion215=true){var timelineJson=_step215.value;var timeline=this.GetTimelineByName(timelineJson["name"]);if(timeline)timeline._LoadFromJson(timelineJson);else{var templateName=this._GetTemplateNameFromJson(timelineJson);if(!templateName)continue;var templateTimeline=this.GetTimelineByName(templateName);timeline=this.CreateFromTemplate(templateTimeline);timeline._LoadFromJson(timelineJson);}if(!timeline.HasTracks())this.Remove(timeline);}}catch(err){_didIteratorError215=true;_iteratorError215=err;}finally{try{if(!_iteratorNormalCompletion215&&_iterator215["return"]!=null){_iterator215["return"]();}}finally{if(_didIteratorError215){throw _iteratorError215;}}}}},{key:"_GetTemplateNameFromJson",value:function _GetTemplateNameFromJson(timelineJson){var name=timelineJson["name"];var nameParts=name.split(":");if(!nameParts||nameParts.length!==2)return null;return nameParts[0];}},{key:"_SaveScheduledTimelinesToJson",value:function _SaveScheduledTimelinesToJson(){return this._SaveTimelines(this._scheduledTimelines);}},{key:"_LoadScheduledTimelinesFromJson",value:function _LoadScheduledTimelinesFromJson(scheduledTimelinesJson){this._LoadTimelines(scheduledTimelinesJson,this._scheduledTimelines);}},{key:"_SavePlayingTimelinesToJson",value:function _SavePlayingTimelinesToJson(){return this._SaveTimelines(this._playingTimelines);}},{key:"_LoadPlayingTimelinesFromJson",value:function _LoadPlayingTimelinesFromJson(playingTimelinesJson){this._LoadTimelines(playingTimelinesJson,this._playingTimelines);}},{key:"_SaveMarkedForRemovalTimelinesToJson",value:function _SaveMarkedForRemovalTimelinesToJson(){return this._SaveTimelines(this._markedForRemovalTimelines);}},{key:"_LoadMarkedForRemovalTimelinesFromJson",value:function _LoadMarkedForRemovalTimelinesFromJson(markedForRemovalTimelinesJson){this._LoadTimelines(markedForRemovalTimelinesJson,this._markedForRemovalTimelines);}},{key:"_IsTimelineInJson",value:function _IsTimelineInJson(timeline,json){if(!json)return false;var _iteratorNormalCompletion216=true;var _didIteratorError216=false;var _iteratorError216=undefined;try{for(var _iterator216=json[Symbol.iterator](),_step216;!(_iteratorNormalCompletion216=(_step216=_iterator216.next()).done);_iteratorNormalCompletion216=true){var name=_step216.value;if(name===timeline.GetName())return true;}}catch(err){_didIteratorError216=true;_iteratorError216=err;}finally{try{if(!_iteratorNormalCompletion216&&_iterator216["return"]!=null){_iterator216["return"]();}}finally{if(_didIteratorError216){throw _iteratorError216;}}}return false;}},{key:"_SaveTimelines",value:function _SaveTimelines(collection){return collection.map(function(t){return t.GetName();});}},{key:"_LoadTimelines",value:function _LoadTimelines(timelinesJson,collection){var timelinesToRemove=new Set();var _iteratorNormalCompletion217=true;var _didIteratorError217=false;var _iteratorError217=undefined;try{for(var _iterator217=collection[Symbol.iterator](),_step217;!(_iteratorNormalCompletion217=(_step217=_iterator217.next()).done);_iteratorNormalCompletion217=true){var _timeline4=_step217.value;if(!this._IsTimelineInJson(_timeline4,timelinesJson))timelinesToRemove.add(_timeline4);}}catch(err){_didIteratorError217=true;_iteratorError217=err;}finally{try{if(!_iteratorNormalCompletion217&&_iterator217["return"]!=null){_iterator217["return"]();}}finally{if(_didIteratorError217){throw _iteratorError217;}}}_C90.arrayRemoveAllInSet(collection,timelinesToRemove);if(timelinesJson){var ff=function ff(tn){return function(t){return t.GetName()===tn;};};var _iteratorNormalCompletion218=true;var _didIteratorError218=false;var _iteratorError218=undefined;try{for(var _iterator218=timelinesJson[Symbol.iterator](),_step218;!(_iteratorNormalCompletion218=(_step218=_iterator218.next()).done);_iteratorNormalCompletion218=true){var name=_step218.value;var timeline=this.GetTimelineByName(name);if(timeline){var t=collection.find(ff(name));if(!t)collection.push(timeline);}}}catch(err){_didIteratorError218=true;_iteratorError218=err;}finally{try{if(!_iteratorNormalCompletion218&&_iterator218["return"]!=null){_iterator218["return"]();}}finally{if(_didIteratorError218){throw _iteratorError218;}}}}}}]);return TimelineManager;}(_C90.DefendedBase);}// timelines/timelineInfo.js
{'use strict';var _C91=self.C3;var STEPS=100;var LENGTH_STEP_SIZE=.01;var BEZIER_STEP_SIZE=30;var TANGENT_RESULT=[0,0];var MAP_RESULT=[0,0];var PROJECTION_RESULT=[0,0,0,0,0];_C91.TimelineInfo=/*#__PURE__*/function(){function TimelineInfo(timeline,trackId){_classCallCheck(this,TimelineInfo);this._initialized=false;this._timeline=timeline;this._segments=[];var trackState=null;if(trackId)trackState=this._timeline.GetTrackById(trackId);else trackState=_C91.first(this._timeline.GetTracks());if(!trackState)return;var xTrack=trackState.GetPropertyTrack("offsetX");var yTrack=trackState.GetPropertyTrack("offsetY");if(!xTrack||!yTrack)return;this._xTrack=xTrack;this._yTrack=yTrack;var xPropertyKeyframes=xTrack.GetPropertyKeyframeDataItemArrayIncludingDisabled();var yPropertyKeyframes=yTrack.GetPropertyKeyframeDataItemArrayIncludingDisabled();for(var i=1,len=Math.min(xPropertyKeyframes.length,yPropertyKeyframes.length);i<len;++i){var startX=xPropertyKeyframes[i];var endX=startX.GetNext();var prevX=startX.GetPrevious();var startY=yPropertyKeyframes[i];var endY=startY.GetNext();var prevY=startY.GetPrevious();if(prevX&&prevX.GetPathMode()==="cubic-bezier"&&prevY&&prevY.GetPathMode()==="cubic-bezier")this._segments.push(_C91.New(_C91.TimelineCubicBezierSegmentInfo,prevX,prevY,startX,startY,this._segments.length));else if(prevX&&prevX.GetPathMode()==="line"&&prevY&&prevY.GetPathMode()==="line")this._segments.push(_C91.New(_C91.TimelineLineSegmentInfo,startX,startY,this._segments.length));else this._segments.push(_C91.New(_C91.TimelineLineSegmentInfo,startX,startY,this._segments.length));}this._initialized=true;}_createClass(TimelineInfo,[{key:"Release",value:function Release(){var _iteratorNormalCompletion219=true;var _didIteratorError219=false;var _iteratorError219=undefined;try{for(var _iterator219=this._segments[Symbol.iterator](),_step219;!(_iteratorNormalCompletion219=(_step219=_iterator219.next()).done);_iteratorNormalCompletion219=true){var segment=_step219.value;segment.Release();}}catch(err){_didIteratorError219=true;_iteratorError219=err;}finally{try{if(!_iteratorNormalCompletion219&&_iterator219["return"]!=null){_iterator219["return"]();}}finally{if(_didIteratorError219){throw _iteratorError219;}}}_C91.clearArray(this._segments);this._segments=null;this._timeline=null;this._xTrack=null;this._yTrack=null;}},{key:"WasInitialized",value:function WasInitialized(){return this._initialized;}},{key:"segments",value:function segments(){return this._segments;}},{key:"SetOrigin",value:function SetOrigin(wi){var ox=this._xTrack.GetResultMode()==="relative"?wi.GetX():0;var oy=this._yTrack.GetResultMode()==="relative"?wi.GetY():0;var _iteratorNormalCompletion220=true;var _didIteratorError220=false;var _iteratorError220=undefined;try{for(var _iterator220=this._segments[Symbol.iterator](),_step220;!(_iteratorNormalCompletion220=(_step220=_iterator220.next()).done);_iteratorNormalCompletion220=true){var segment=_step220.value;segment.SetOrigin(ox,oy);}}catch(err){_didIteratorError220=true;_iteratorError220=err;}finally{try{if(!_iteratorNormalCompletion220&&_iterator220["return"]!=null){_iterator220["return"]();}}finally{if(_didIteratorError220){throw _iteratorError220;}}}}},{key:"Project",value:function Project(x,y,opts){if(opts&&opts.tRange){if(!_C91.IsFiniteNumber(opts.tRange[0]))opts.tRange[0]=0;if(!_C91.IsFiniteNumber(opts.tRange[1]))opts.tRange[1]=1;}var ret=[];var _iteratorNormalCompletion221=true;var _didIteratorError221=false;var _iteratorError221=undefined;try{for(var _iterator221=this._segments[Symbol.iterator](),_step221;!(_iteratorNormalCompletion221=(_step221=_iterator221.next()).done);_iteratorNormalCompletion221=true){var segment=_step221.value;if(segment.GetType()==="cubic-bezier"){var p=segment.Project(x,y,opts?opts.tRange:null);p[4]=segment.GetIndex();ret.push(JSON.parse(JSON.stringify(p)));}}}catch(err){_didIteratorError221=true;_iteratorError221=err;}finally{try{if(!_iteratorNormalCompletion221&&_iterator221["return"]!=null){_iterator221["return"]();}}finally{if(_didIteratorError221){throw _iteratorError221;}}}ret.sort(function(f,s){return f[3]-s[3];});return ret[0];}},{key:"Tangent",value:function Tangent(t,segmentIndex){return this._segments[segmentIndex].Tangent(t);}},{key:"TangentAngle",value:function TangentAngle(x,y,t,segmentIndex){return this._segments[segmentIndex].TangentAngle(x,y,t);}}]);return TimelineInfo;}();_C91.TimelineCubicBezierSegmentInfo=/*#__PURE__*/function(){function TimelineCubicBezierSegmentInfo(startX,startY,endX,endY,index){_classCallCheck(this,TimelineCubicBezierSegmentInfo);this._index=index;var startXAddon=startX.GetAddOn("cubic-bezier");var endXAddon=endX.GetAddOn("cubic-bezier");var startYAddon=startY.GetAddOn("cubic-bezier");var endYAddon=endY.GetAddOn("cubic-bezier");this._aX=startX.GetValueWithResultMode();this._aY=startY.GetValueWithResultMode();this._bX=startX.GetValueWithResultMode()+startXAddon.GetStartAnchor();this._bY=startY.GetValueWithResultMode()+startYAddon.GetStartAnchor();this._cX=endX.GetValueWithResultMode()+endXAddon.GetEndAnchor();this._cY=endY.GetValueWithResultMode()+endYAddon.GetEndAnchor();this._dX=endX.GetValueWithResultMode();this._dY=endY.GetValueWithResultMode();this._initialized=false;this._len=STEPS;this._arcLengths=new Array(this._len+1);this._arcLengths[0]=0;this._length=0;this._lut=[];this._CalculateLength();}_createClass(TimelineCubicBezierSegmentInfo,[{key:"Release",value:function Release(){_C91.clearArray(this._arcLengths);this._arcLengths=null;_C91.clearArray(this._lut);this._lut=null;}},{key:"GetType",value:function GetType(){return"cubic-bezier";}},{key:"GetIndex",value:function GetIndex(){return this._index;}},{key:"GetStepCount",value:function GetStepCount(){return Math.floor(this._length/BEZIER_STEP_SIZE);}},{key:"GetStepIncrement",value:function GetStepIncrement(){return 1/this.GetStepCount();}},{key:"SetOrigin",value:function SetOrigin(ox,oy){this._originX=ox;this._originY=oy;this._arcLengths=new Array(this._len+1);this._arcLengths[0]=0;this._CalculateLength();}},{key:"Map",value:function Map(u){if(!this._initialized)return NaN;var mt=this._Map(u);MAP_RESULT[0]=this._X(mt);MAP_RESULT[1]=this._Y(mt);return MAP_RESULT;}},{key:"Project",value:function Project(x,y,tRange){var lut=this._GenerateLUT(STEPS);var i=this._FindClosestFromLUT(x,y,lut,tRange);var p=this._RefineProjection(x,y,lut,i);PROJECTION_RESULT[0]=p.x;PROJECTION_RESULT[1]=p.y;PROJECTION_RESULT[2]=p.t;PROJECTION_RESULT[3]=p.distance;return PROJECTION_RESULT;}},{key:"Tangent",value:function Tangent(t){var mt=1-t;var a=mt*mt;var b=2*mt*t;var c=t*t;var d0x=3*(this._bX+this._originX-(this._aX+this._originX));var d0y=3*(this._bY+this._originY-(this._aY+this._originY));var d1x=3*(this._cX+this._originX-(this._bX+this._originX));var d1y=3*(this._cY+this._originY-(this._bY+this._originY));var d2x=3*(this._dX+this._originX-(this._cX+this._originX));var d2y=3*(this._dY+this._originY-(this._cY+this._originY));var dx=a*d0x+b*d1x+c*d2x;var dy=a*d0y+b*d1y+c*d2y;var m=Math.hypot(dx,dy);TANGENT_RESULT[0]=dx/m;TANGENT_RESULT[1]=dy/m;return TANGENT_RESULT;}},{key:"TangentAngle",value:function TangentAngle(x,y,t){var tanget=this.Tangent(t);var angle=_C91.angleTo(x,y,x+tanget[0],y+tanget[1]);return angle;}},{key:"_Map",value:function _Map(u){if(!this._initialized)return;var targetLength=u*this._arcLengths[this._len];var low=0;var high=this._len;var index=0;while(low<high){index=low+((high-low)/2|0);if(this._arcLengths[index]<targetLength)low=index+1;else high=index;}if(this._arcLengths[index]>targetLength)index--;var lengthBefore=this._arcLengths[index];if(lengthBefore===targetLength)return index/this._len;else return(index+(targetLength-lengthBefore)/(this._arcLengths[index+1]-lengthBefore))/this._len;}},{key:"_X",value:function _X(t){if(!this._initialized)return NaN;return self.Ease.GetRuntimeEase("cubicbezier")(t,this._aX+this._originX,this._bX+this._originX,this._cX+this._originX,this._dX+this._originX);}},{key:"_Y",value:function _Y(t){if(!this._initialized)return NaN;return self.Ease.GetRuntimeEase("cubicbezier")(t,this._aY+this._originY,this._bY+this._originY,this._cY+this._originY,this._dY+this._originY);}},{key:"_GenerateLUT",value:function _GenerateLUT(steps){steps=steps||STEPS;if(this._lut.length===steps)return this._lut;this._lut=[];steps++;for(var i=0;i<steps;i++){var t=i/(steps-1);var x=this._X(t);var y=this._Y(t);this._lut.push({x:x,y:y,t:t,distance:0});}return this._lut;}},{key:"_FindClosestFromLUT",value:function _FindClosestFromLUT(x,y,LUT){var tRange=arguments.length>3&&arguments[3]!==undefined?arguments[3]:null;var distance=arguments.length>4&&arguments[4]!==undefined?arguments[4]:Number.MAX_SAFE_INTEGER;var i=0;LUT.forEach(function(p,index){p.t=index/(LUT.length-1);p.distance=_C91.distanceTo(x,y,p.x,p.y);if(tRange&&_C91.IsArray(tRange)&&_C91.IsFiniteNumber(tRange[0])&&_C91.IsFiniteNumber(tRange[1])){if(p.t>=tRange[0]&&p.t<=tRange[1])if(p.distance<distance){distance=p.distance;i=index;}}else if(p.distance<distance){distance=p.distance;i=index;}});return i;}},{key:"_RefineProjection",value:function _RefineProjection(x,y,LUT,i){var targetDistance=arguments.length>4&&arguments[4]!==undefined?arguments[4]:0;var epsilon=arguments.length>5&&arguments[5]!==undefined?arguments[5]:1;var q=LUT[i];var count=1;var distance=Number.MAX_SAFE_INTEGER;do{var i1=i===0?0:i-1;var i2=i===LUT.length-1?LUT.length-1:i+1;var t1=LUT[i1].t;var t2=LUT[i2].t;var lut=[];var step=(t2-t1)/4;if(step<.001)break;lut.push(LUT[i1]);for(var j=1;j<=3;j++){var t=t1+j*step;var pathX=this._X(t);var pathY=this._Y(t);var pathDistance=Math.abs(_C91.distanceTo(pathX,pathY,x,y)-targetDistance);if(pathDistance<distance){distance=pathDistance;q={x:pathX,y:pathY,t:t,distance:pathDistance};i=j;}lut.push({x:pathX,y:pathY,t:t,distance:pathDistance});}lut.push(LUT[i2]);LUT=lut;}while(count++<25);if(targetDistance&&distance>epsilon)q=null;return q;}},{key:"_CalculateLength",value:function _CalculateLength(){this._initialized=true;var ox=this._X(0);var oy=this._Y(0);var clen=0;for(var i=1;i<=this._len;i++){var x=this._X(i*LENGTH_STEP_SIZE);var y=this._Y(i*LENGTH_STEP_SIZE);var dx=ox-x;var dy=oy-y;clen+=Math.hypot(dx,dy);this._arcLengths[i]=clen;ox=x;oy=y;}this._length=clen;}}]);return TimelineCubicBezierSegmentInfo;}();_C91.TimelineLineSegmentInfo=/*#__PURE__*/function(){function TimelineLineSegmentInfo(startX,startY,index){_classCallCheck(this,TimelineLineSegmentInfo);this._index=index;this._targetX=startX.GetValueWithResultMode();this._targetY=startY.GetValueWithResultMode();this._originX=0;this._originY=0;}_createClass(TimelineLineSegmentInfo,[{key:"Release",value:function Release(){}},{key:"GetType",value:function GetType(){return"line";}},{key:"GetIndex",value:function GetIndex(){return this._index;}},{key:"SetOrigin",value:function SetOrigin(ox,oy){this._originX=ox;this._originY=oy;}},{key:"GetX",value:function GetX(){return this._targetX+this._originX;}},{key:"GetY",value:function GetY(){return this._targetY+this._originY;}}]);return TimelineLineSegmentInfo;}();}// timelines/state/timelineState.js
{'use strict';var _C92=self.C3;var PING_PONG_BEGIN=0;var PING_PONG_END=1;_C92.TimelineState=/*#__PURE__*/function(_C92$DefendedBase){_inherits(Timeline,_C92$DefendedBase);function Timeline(name,timelineDataItem,timelineManager){var _this46;_classCallCheck(this,Timeline);_this46=_possibleConstructorReturn(this,_getPrototypeOf(Timeline).call(this));_this46._runtime=timelineManager.GetRuntime();_this46._timelineManager=timelineManager;_this46._timelineDataItem=timelineDataItem;_this46._name=name;_this46._tracks=[];_this46._tracksLength=0;_this46._beforeAndAfterTracks=null;_this46._beforeAndAfterTracksLength=0;_this46.CreateTrackStates();_this46._playPromise=null;_this46._playResolve=null;_this46._playheadTime=0;_this46._playbackRate=1;_this46._pingPongState=PING_PONG_BEGIN;_this46._currentRepeatCount=1;_this46._isPlaying=false;_this46._isScheduled=false;_this46._initialStateSet=false;_this46._complete=true;_this46._released=false;_this46._markedForRemoval=false;_this46._completedTick=-1;_this46._implicitPause=false;_this46._isTemplate=false;_this46._finishedTriggers=false;_this46._firstTick=false;_this46._lastDelta=NaN;_this46._tags=[""];_this46._stringTags="";_this46._tagsChanged=false;_this46._renderChange=0;_this46._hasNestedContent=0;_this46._iTimelineState=null;return _this46;}_createClass(Timeline,[{key:"Release",value:function Release(){if(this.IsReleased())return;var dispatcher=this._runtime.Dispatcher();this._timelineManager.DeScheduleTimeline(this);this._timelineManager.CompleteTimelineAndResolve(this);var _iteratorNormalCompletion222=true;var _didIteratorError222=false;var _iteratorError222=undefined;try{for(var _iterator222=this._tracks[Symbol.iterator](),_step222;!(_iteratorNormalCompletion222=(_step222=_iterator222.next()).done);_iteratorNormalCompletion222=true){var track=_step222.value;track.Release();}}catch(err){_didIteratorError222=true;_iteratorError222=err;}finally{try{if(!_iteratorNormalCompletion222&&_iterator222["return"]!=null){_iterator222["return"]();}}finally{if(_didIteratorError222){throw _iteratorError222;}}}_C92.clearArray(this._tracks);this._tracks=null;this._runtime=null;this._timelineManager=null;this._timelineDataItem=null;this._released=true;this._playPromise=null;this._playResolve=null;this.FireReleaseEvent(dispatcher);}},{key:"FireReleaseEvent",value:function FireReleaseEvent(dispatcher){var event=_C92.New(_C92.Event,"timelinestatereleased");event.timelineState=this;dispatcher.dispatchEvent(event);}},{key:"GetType",value:function GetType(){return 0;}},{key:"CreateTrackStates",value:function CreateTrackStates(){var _iteratorNormalCompletion223=true;var _didIteratorError223=false;var _iteratorError223=undefined;try{for(var _iterator223=this._timelineDataItem.GetTrackData().trackDataItems()[Symbol.iterator](),_step223;!(_iteratorNormalCompletion223=(_step223=_iterator223.next()).done);_iteratorNormalCompletion223=true){var trackDataItem=_step223.value;this._tracksLength=this._tracks.push(_C92.TrackState.Create(this,trackDataItem));}}catch(err){_didIteratorError223=true;_iteratorError223=err;}finally{try{if(!_iteratorNormalCompletion223&&_iterator223["return"]!=null){_iterator223["return"]();}}finally{if(_didIteratorError223){throw _iteratorError223;}}}}},{key:"GetTimelineManager",value:function GetTimelineManager(){return this._timelineManager;}},{key:"GetRuntime",value:function GetRuntime(){return this._runtime;}},{key:"GetTracks",value:function GetTracks(){return this._tracks;}},{key:"GetSimilarPropertyTracks",value:function GetSimilarPropertyTracks(instance,sourceAdapter,propertyName,propertyTrack){if(!this._hasNestedContent)return;var ret;for(var i=0;i<this._tracks.length;i++){var track=this._tracks[i];if(instance!==track.GetInstance())continue;var pt=track.GetPropertyTrack(propertyName);if(!pt)continue;if(sourceAdapter.constructor!==pt.GetSourceAdapter().constructor)continue;if(pt.GetResultMode()!==propertyTrack.GetResultMode())continue;if(!ret)ret=[];ret.push(pt);}return ret;}},{key:"HasTracks",value:function HasTracks(){return!!this._tracks.length;}},{key:"GetTrackById",value:function GetTrackById(trackId){var _iteratorNormalCompletion224=true;var _didIteratorError224=false;var _iteratorError224=undefined;try{for(var _iterator224=this._tracks[Symbol.iterator](),_step224;!(_iteratorNormalCompletion224=(_step224=_iterator224.next()).done);_iteratorNormalCompletion224=true){var track=_step224.value;if(_C92.equalsNoCase(track.GetId(),trackId))return track;}}catch(err){_didIteratorError224=true;_iteratorError224=err;}finally{try{if(!_iteratorNormalCompletion224&&_iterator224["return"]!=null){_iterator224["return"]();}}finally{if(_didIteratorError224){throw _iteratorError224;}}}return null;}},{key:"GetTrackByName",value:function GetTrackByName(name){var _iteratorNormalCompletion225=true;var _didIteratorError225=false;var _iteratorError225=undefined;try{for(var _iterator225=this._tracks[Symbol.iterator](),_step225;!(_iteratorNormalCompletion225=(_step225=_iterator225.next()).done);_iteratorNormalCompletion225=true){var track=_step225.value;if(track.IsInstanceTrack())continue;if(_C92.equalsNoCase(track.GetName(),name))return track;}}catch(err){_didIteratorError225=true;_iteratorError225=err;}finally{try{if(!_iteratorNormalCompletion225&&_iterator225["return"]!=null){_iterator225["return"]();}}finally{if(_didIteratorError225){throw _iteratorError225;}}}return null;}},{key:"SetName",value:function SetName(name){this._name=name;}},{key:"GetName",value:function GetName(){return this._name;}},{key:"GetTimelineDataItem",value:function GetTimelineDataItem(){return this._timelineDataItem;}},{key:"GetTemplateName",value:function GetTemplateName(){return this._timelineDataItem.GetName();}},{key:"GetTotalTime",value:function GetTotalTime(){return this._timelineDataItem.GetTotalTime();}},{key:"SetTotalTime",value:function SetTotalTime(tt){this._timelineDataItem.SetTotalTime(tt);}},{key:"GetStep",value:function GetStep(){return this._timelineDataItem.GetStep();}},{key:"SetStep",value:function SetStep(s){this._timelineDataItem.SetStep(s);}},{key:"GetInterpolationMode",value:function GetInterpolationMode(){return this._timelineDataItem.GetInterpolationMode();}},{key:"SetInterpolationMode",value:function SetInterpolationMode(im){this._timelineDataItem.SetInterpolationMode(im);}},{key:"GetResultMode",value:function GetResultMode(){return this._timelineDataItem.GetResultMode();}},{key:"SetResultMode",value:function SetResultMode(rm){this._timelineDataItem.GetResultMode(rm);}},{key:"SetEase",value:function SetEase(e){var _iteratorNormalCompletion226=true;var _didIteratorError226=false;var _iteratorError226=undefined;try{for(var _iterator226=this.GetTracks()[Symbol.iterator](),_step226;!(_iteratorNormalCompletion226=(_step226=_iterator226.next()).done);_iteratorNormalCompletion226=true){var track=_step226.value;track.SetEase(e);}}catch(err){_didIteratorError226=true;_iteratorError226=err;}finally{try{if(!_iteratorNormalCompletion226&&_iterator226["return"]!=null){_iterator226["return"]();}}finally{if(_didIteratorError226){throw _iteratorError226;}}}}},{key:"GetLoop",value:function GetLoop(){return this._timelineDataItem.GetLoop();}},{key:"SetLoop",value:function SetLoop(l){return this._timelineDataItem.SetLoop(l);}},{key:"GetPingPong",value:function GetPingPong(){return this._timelineDataItem.GetPingPong();}},{key:"SetPingPong",value:function SetPingPong(p){return this._timelineDataItem.SetPingPong(p);}},{key:"GetRepeatCount",value:function GetRepeatCount(){return this._timelineDataItem.GetRepeatCount();}},{key:"SetRepeatCount",value:function SetRepeatCount(rc){return this._timelineDataItem.SetRepeatCount(rc);}},{key:"SetPlaybackRate",value:function SetPlaybackRate(r){return this._playbackRate=r;}},{key:"GetPlaybackRate",value:function GetPlaybackRate(){return this._playbackRate;}},{key:"GetStartOnLayout",value:function GetStartOnLayout(){return this._timelineDataItem.GetStartOnLayout();}},{key:"GetTransformWithSceneGraph",value:function GetTransformWithSceneGraph(){return this._timelineDataItem.GetTransformWithSceneGraph();}},{key:"GetUseSystemTimescale",value:function GetUseSystemTimescale(){return this._timelineDataItem.GetUseSystemTimescale();}},{key:"IsForwardPlayBack",value:function IsForwardPlayBack(){if(!this.IsPlaying())return true;return this._playbackRate>0;}},{key:"GetPlayPromise",value:function GetPlayPromise(){var _this47=this;if(this._playPromise)return this._playPromise;this._playPromise=new Promise(function(resolve){_this47._playResolve=resolve;});return this._playPromise;}},{key:"ResolvePlayPromise",value:function ResolvePlayPromise(){if(!this._playPromise)return;this._playResolve();this._playPromise=null;this._playResolve=null;}},{key:"SetTags",value:function SetTags(tags){this._tags=_C92.TimelineState._GetTagArray(tags);this._tagsChanged=true;}},{key:"GetTags",value:function GetTags(){return this._tags;}},{key:"GetStringTags",value:function GetStringTags(){if(this._tagsChanged)this._stringTags=this._tags.join(" ");this._tagsChanged=false;return this._stringTags;}},{key:"HasTags",value:function HasTags(tags){if(!this._tags)return false;if(!this._tags.length)return false;var t=_C92.TimelineState._GetTagArray(tags);if(!t)return false;if(!t.length)return false;return t.every(_C92.TimelineState._HasTag,this);}},{key:"OnStarted",value:function OnStarted(){if(!_C92.Plugins.Timeline||this.constructor!==_C92.TimelineState)return;_C92.Plugins.Timeline.Cnds.PushTriggerTimeline(this);this._timelineManager.Trigger(_C92.Plugins.Timeline.Cnds.OnTimelineStarted);this._timelineManager.Trigger(_C92.Plugins.Timeline.Cnds.OnTimelineStartedByName);this._timelineManager.Trigger(_C92.Plugins.Timeline.Cnds.OnTimelineStartedByTags);this._timelineManager.Trigger(_C92.Plugins.Timeline.Cnds.OnAnyTimelineStarted);_C92.Plugins.Timeline.Cnds.PopTriggerTimeline();}},{key:"OnCompleted",value:function OnCompleted(){this._completedTick=this._runtime.GetTickCount();}},{key:"FinishTriggers",value:function FinishTriggers(){if(this._finishedTriggers)return;this._finishedTriggers=true;if(!_C92.Plugins.Timeline||this.constructor!==_C92.TimelineState)return;_C92.Plugins.Timeline.Cnds.PushTriggerTimeline(this);this._timelineManager.Trigger(_C92.Plugins.Timeline.Cnds.OnTimelineFinished);this._timelineManager.Trigger(_C92.Plugins.Timeline.Cnds.OnTimelineFinishedByName);this._timelineManager.Trigger(_C92.Plugins.Timeline.Cnds.OnTimelineFinishedByTags);this._timelineManager.Trigger(_C92.Plugins.Timeline.Cnds.OnAnyTimelineFinished);_C92.Plugins.Timeline.Cnds.PopTriggerTimeline();}},{key:"SetPlaying",value:function SetPlaying(p){this._isPlaying=p;}},{key:"IsCompletedTick",value:function IsCompletedTick(){return this._completedTick===this._runtime.GetTickCount();}},{key:"IsPlaying",value:function IsPlaying(){var playingOnly=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(this.IsCompletedTick())return true;if(this.IsScheduled()&&!playingOnly)return true;return this._isPlaying;}},{key:"_IsPlaying",value:function _IsPlaying(){return this.IsPlaying(true);}},{key:"IsPaused",value:function IsPaused(){return this._IsPaused();}},{key:"_IsPaused",value:function _IsPaused(){if(this.IsReleased())return false;if(this.IsScheduled())return false;if(this._IsPlaying())return false;if(this.IsComplete())return false;return true;}},{key:"SetScheduled",value:function SetScheduled(s){this._isScheduled=s;}},{key:"IsScheduled",value:function IsScheduled(){return this._isScheduled;}},{key:"SetComplete",value:function SetComplete(c){this._complete=c;var t=this.GetTime();if(t<=0||t>=this.GetTotalTime())this._complete=true;}},{key:"IsComplete",value:function IsComplete(){return this._complete;}},{key:"IsReleased",value:function IsReleased(){return this._released;}},{key:"SetMarkedForRemoval",value:function SetMarkedForRemoval(mfr){this._markedForRemoval=mfr;}},{key:"IsMarkedForRemoval",value:function IsMarkedForRemoval(){return this._markedForRemoval;}},{key:"SetImplicitPause",value:function SetImplicitPause(ip){this._implicitPause=ip;}},{key:"IsImplicitPause",value:function IsImplicitPause(){return this._implicitPause;}},{key:"SetIsTemplate",value:function SetIsTemplate(it){this._isTemplate=!!it;}},{key:"IsTemplate",value:function IsTemplate(){return this._isTemplate;}},{key:"InitialStateSet",value:function InitialStateSet(){return this._initialStateSet;}},{key:"GetTime",value:function GetTime(){return this._playheadTime;}},{key:"SetTime",value:function SetTime(time){var lastGlobalTime=this.GetTime();this._SetTime(time);this.SetComplete(false);if(!this.IsComplete())this.SetImplicitPause(true);if(!this._IsPlaying()&&!this.IsScheduled()&&this._initialStateSet);else if(!this._IsPlaying()&&!this.IsScheduled()&&!this._initialStateSet)this.SetInitialStateFromSetTime();else if(this._IsPlaying())this.Stop();else if(this.IsScheduled()){this._timelineManager.DeScheduleTimeline(this);this.SetInitialStateFromSetTime();}this._SetUpdateStateBefore();this._Interpolate(this.GetTime(),false,true,true,lastGlobalTime);this._SetUpdateStateAfter();if(this._renderChange)this.GetRuntime().UpdateRender();this._OnSetTime();}},{key:"_SetTime",value:function _SetTime(time){if(!_C92.IsFiniteNumber(time))time=this.GetTotalTime();if(time<0)this._playheadTime=0;else if(time>=this.GetTotalTime())this._playheadTime=this.GetTotalTime();else this._playheadTime=time;}},{key:"_SetTimeAndReset",value:function _SetTimeAndReset(time){if(!_C92.IsFiniteNumber(time))time=this.GetTotalTime();if(time<0)this._playheadTime=0;else if(time>=this.GetTotalTime())this._playheadTime=this.GetTotalTime();else this._playheadTime=time;var _iteratorNormalCompletion227=true;var _didIteratorError227=false;var _iteratorError227=undefined;try{for(var _iterator227=this._tracks[Symbol.iterator](),_step227;!(_iteratorNormalCompletion227=(_step227=_iterator227.next()).done);_iteratorNormalCompletion227=true){var track=_step227.value;track.SetResetState();}}catch(err){_didIteratorError227=true;_iteratorError227=err;}finally{try{if(!_iteratorNormalCompletion227&&_iterator227["return"]!=null){_iterator227["return"]();}}finally{if(_didIteratorError227){throw _iteratorError227;}}}}},{key:"_OnSetTime",value:function _OnSetTime(){if(!_C92.Plugins.Timeline||this.constructor!==_C92.TimelineState)return;_C92.Plugins.Timeline.Cnds.PushTriggerTimeline(this);this._timelineManager.Trigger(_C92.Plugins.Timeline.Cnds.OnTimeSet);this._timelineManager.Trigger(_C92.Plugins.Timeline.Cnds.OnTimeSetByName);this._timelineManager.Trigger(_C92.Plugins.Timeline.Cnds.OnTimeSetByTags);_C92.Plugins.Timeline.Cnds.PopTriggerTimeline();}},{key:"_CanResume",value:function _CanResume(){if(this.GetLoop())return true;else if(this.GetPingPong()&&this._pingPongState===PING_PONG_END){if(this.IsForwardPlayBack()){if(this.GetTime()>=this.GetTotalTime())return false;}else{if(this.GetTime()<=0)return false;}}else if(!this.GetLoop()&&!this.GetPingPong())if(this.IsForwardPlayBack()){if(this.GetTime()>=this.GetTotalTime())return false;}else if(this.GetTime()<=0)return false;return true;}},{key:"Resume",value:function Resume(){if(this.IsReleased())return;if(this._CanResume())this.Play(true);}},{key:"Play",value:function Play(){var resume=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(this.IsReleased())return false;if(this.IsScheduled())return false;if(this._IsPlaying()&&this.IsCompletedTick())return this._SchedulePlayingTimeline();if(this._IsPlaying())return false;if(!this.IsComplete()&&!resume&&!this.IsImplicitPause())return false;return this._ScheduleStoppedTimeline();}},{key:"_SchedulePlayingTimeline",value:function _SchedulePlayingTimeline(){this.SetImplicitPause(false);this._timelineManager.RemovePlayingTimeline(this);this._timelineManager.ScheduleTimeline(this);this.GetPlayPromise();return true;}},{key:"_ScheduleStoppedTimeline",value:function _ScheduleStoppedTimeline(){this.SetImplicitPause(false);this._timelineManager.ScheduleTimeline(this);this.GetPlayPromise();return true;}},{key:"Stop",value:function Stop(){var completed=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;if(this.IsReleased())return;this.SetComplete(completed);this._timelineManager.CompleteTimeline(this);if(this.IsComplete())this.ResolvePlayPromise();}},{key:"Reset",value:function Reset(){var render=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var beforeChangeLayout=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(this.IsReleased())return;if(!this._IsPlaying()&&this.IsScheduled())return this._timelineManager.DeScheduleTimeline(this);if(this.IsComplete())return;this.Stop(true);if(this.IsForwardPlayBack())this._SetTime(0);else this._SetTime(this.GetTotalTime());var time=this.GetTime();this._SetUpdateStateBefore();if(beforeChangeLayout)this._InterpolateBeforeChangeLayout(time);else this._Interpolate(time,false,false,true);if(render)this._OnSetTime();this._SetUpdateStateAfter();if(this._renderChange&&render)this.GetRuntime().UpdateRender();}},{key:"ResetBeforeChangeLayout",value:function ResetBeforeChangeLayout(){this.Reset(false,true);}},{key:"_InterpolateBeforeChangeLayout",value:function _InterpolateBeforeChangeLayout(time){this._Interpolate(time,false,false,true,NaN,false,true);}},{key:"_OnBeforeChangeLayout",value:function _OnBeforeChangeLayout(){if(this.IsReleased())return true;if(!this.GetRuntime().IsLoadingState())if(this.HasValidGlobalTracks())return false;this._timelineManager.CompleteTimelineBeforeChangeOfLayout(this);if(!this.GetRuntime().IsLoadingState())this.ResetBeforeChangeLayout();return true;}},{key:"SetInitialStateFromSetTime",value:function SetInitialStateFromSetTime(){this.SetInitialState(true);}},{key:"SetInitialState",value:function SetInitialState(fromSetTime){if(this.IsMarkedForRemoval())return;if(fromSetTime){this._finishedTriggers=false;this._initialStateSet=true;this._firstTick=true;this._SetUpdateStateBefore();var _iteratorNormalCompletion228=true;var _didIteratorError228=false;var _iteratorError228=undefined;try{for(var _iterator228=this._tracks[Symbol.iterator](),_step228;!(_iteratorNormalCompletion228=(_step228=_iterator228.next()).done);_iteratorNormalCompletion228=true){var track=_step228.value;track.SetInitialState();}}catch(err){_didIteratorError228=true;_iteratorError228=err;}finally{try{if(!_iteratorNormalCompletion228&&_iterator228["return"]!=null){_iterator228["return"]();}}finally{if(_didIteratorError228){throw _iteratorError228;}}}this._SetUpdateStateAfter();}else{this.SetPlaying(true);this.SetScheduled(false);this.OnStarted();if(this.IsComplete()){this._completedTick=-1;if(this._pingPongState!==PING_PONG_BEGIN)this._playbackRate=Math.abs(this._playbackRate);this._pingPongState=PING_PONG_BEGIN;this._currentRepeatCount=1;this._complete=false;this._finishedTriggers=false;this._initialStateSet=true;this._firstTick=true;if(this.IsForwardPlayBack())this._SetTime(0);else this._SetTime(this.GetTotalTime());this._SetUpdateStateBefore();var _iteratorNormalCompletion229=true;var _didIteratorError229=false;var _iteratorError229=undefined;try{for(var _iterator229=this._tracks[Symbol.iterator](),_step229;!(_iteratorNormalCompletion229=(_step229=_iterator229.next()).done);_iteratorNormalCompletion229=true){var _track=_step229.value;_track.SetInitialState();}}catch(err){_didIteratorError229=true;_iteratorError229=err;}finally{try{if(!_iteratorNormalCompletion229&&_iterator229["return"]!=null){_iterator229["return"]();}}finally{if(_didIteratorError229){throw _iteratorError229;}}}this._SetUpdateStateAfter();}else{this._firstTick=true;this._finishedTriggers=false;this._SetUpdateStateBefore();var _iteratorNormalCompletion230=true;var _didIteratorError230=false;var _iteratorError230=undefined;try{for(var _iterator230=this._tracks[Symbol.iterator](),_step230;!(_iteratorNormalCompletion230=(_step230=_iterator230.next()).done);_iteratorNormalCompletion230=true){var _track2=_step230.value;_track2.SetResumeState();}}catch(err){_didIteratorError230=true;_iteratorError230=err;}finally{try{if(!_iteratorNormalCompletion230&&_iterator230["return"]!=null){_iterator230["return"]();}}finally{if(_didIteratorError230){throw _iteratorError230;}}}this._SetUpdateStateAfter();}}}},{key:"GetRenderChange",value:function GetRenderChange(){return this._renderChange;}},{key:"_SetUpdateStateBefore",value:function _SetUpdateStateBefore(){this._hasNestedContent=0;var _iteratorNormalCompletion231=true;var _didIteratorError231=false;var _iteratorError231=undefined;try{for(var _iterator231=this._tracks[Symbol.iterator](),_step231;!(_iteratorNormalCompletion231=(_step231=_iterator231.next()).done);_iteratorNormalCompletion231=true){var track=_step231.value;if(track.IsNested())this._hasNestedContent=1;}}catch(err){_didIteratorError231=true;_iteratorError231=err;}finally{try{if(!_iteratorNormalCompletion231&&_iterator231["return"]!=null){_iterator231["return"]();}}finally{if(_didIteratorError231){throw _iteratorError231;}}}}},{key:"_SetUpdateStateAfter",value:function _SetUpdateStateAfter(){this._renderChange=0;var _iteratorNormalCompletion232=true;var _didIteratorError232=false;var _iteratorError232=undefined;try{for(var _iterator232=this._tracks[Symbol.iterator](),_step232;!(_iteratorNormalCompletion232=(_step232=_iterator232.next()).done);_iteratorNormalCompletion232=true){var track=_step232.value;track._SetUpdateState();if(this._renderChange===0&&track.GetRenderChange()===1)this._renderChange=1;if(!this._beforeAndAfterTracks&&track.GetNeedsBeforeAndAfter()===1){if(!this._beforeAndAfterTracks)this._beforeAndAfterTracks=[];this._beforeAndAfterTracksLength=this._beforeAndAfterTracks.push(track);}}}catch(err){_didIteratorError232=true;_iteratorError232=err;}finally{try{if(!_iteratorNormalCompletion232&&_iterator232["return"]!=null){_iterator232["return"]();}}finally{if(_didIteratorError232){throw _iteratorError232;}}}}},{key:"Tick",value:function Tick(deltaTime,timeScale,deltaTime1){if(this.GetUseSystemTimescale()){if(deltaTime===0&&this._lastDelta===0)return;this._lastDelta=deltaTime;deltaTime=deltaTime1;}else{if(deltaTime1===0&&this._lastDelta===0)return;this._lastDelta=deltaTime1;deltaTime=deltaTime1;timeScale=1;}var lastTime=this._playheadTime;var newDeltaTime=deltaTime*timeScale*this._playbackRate;var newTime=lastTime+newDeltaTime;var totalTime=this._timelineDataItem._totalTime;if(newTime<0)this._playheadTime=0;else if(newTime>=totalTime)this._playheadTime=totalTime;else this._playheadTime=newTime;var complete=false;var ensureValue=false;var loop=this.GetLoop();var pingPong=this.GetPingPong();if(!loop&&!pingPong){if(this._playbackRate>0){if(this._playheadTime>=totalTime)if(this._currentRepeatCount<this.GetRepeatCount()){this._currentRepeatCount++;this._SetTimeAndReset(0);ensureValue=true;}else{this._SetTime(totalTime);complete=true;}}else{if(this._playheadTime<=0)if(this._currentRepeatCount<this.GetRepeatCount()){this._currentRepeatCount++;this._SetTimeAndReset(totalTime);ensureValue=true;}else{this._SetTime(0);complete=true;}}}else if(loop&&!pingPong){if(this._playbackRate>0){if(this._playheadTime>=totalTime){this._SetTimeAndReset(0);ensureValue=true;}}else{if(this._playheadTime<=0){this._SetTimeAndReset(totalTime);ensureValue=true;}}}else if(!loop&&pingPong){if(this._playbackRate>0){if(this._playheadTime>=totalTime){this._SetTime(totalTime);this.SetPlaybackRate(this.GetPlaybackRate()*-1);ensureValue=true;if(this._pingPongState===PING_PONG_END){if(this._currentRepeatCount<this.GetRepeatCount()){this._currentRepeatCount++;this._pingPongState=PING_PONG_BEGIN;}else complete=true;}else if(this._pingPongState===PING_PONG_BEGIN)this._pingPongState=PING_PONG_END;}}else{if(this._playheadTime<=0){this._SetTime(0);this.SetPlaybackRate(this.GetPlaybackRate()*-1);ensureValue=true;if(this._pingPongState===PING_PONG_END){if(this._currentRepeatCount<this.GetRepeatCount()){this._currentRepeatCount++;this._pingPongState=PING_PONG_BEGIN;}else complete=true;}else if(this._pingPongState===PING_PONG_BEGIN)this._pingPongState=PING_PONG_END;}}}else if(loop&&pingPong)if(this._playbackRate>0){if(this._playheadTime>=totalTime){this._SetTime(totalTime);this.SetPlaybackRate(this.GetPlaybackRate()*-1);ensureValue=true;this._pingPongState++;_C92.wrap(this._pingPongState,0,2);}}else if(this._playheadTime<=0){this._SetTime(0);this.SetPlaybackRate(this.GetPlaybackRate()*-1);ensureValue=true;this._pingPongState++;_C92.wrap(this._pingPongState,0,2);}var i;var l=this._tracksLength;if(complete){for(i=0;i<l;i++){this._tracks[i].SetEndState();}this.Stop(true);this.OnCompleted();return;}var bal=this._beforeAndAfterTracksLength;for(i=0;i<bal;i++){this._beforeAndAfterTracks[i].BeforeInterpolate();}if(this._hasNestedContent===1)for(i=0;i<l;i++){var track=this._tracks[i];var startOffset=track.GetStartOffset();var localTime=this._playheadTime-startOffset;var lastLocalTime=lastTime-startOffset;if(localTime<0&&lastLocalTime>0){if(startOffset<0)this._playheadTime=0;else if(startOffset>=totalTime)this._playheadTime=totalTime;else this._playheadTime=startOffset;track.Interpolate(startOffset,true,false,ensureValue,this._firstTick,false);}else track.Interpolate(this._playheadTime,true,false,ensureValue,this._firstTick,false);}else for(i=0;i<l;i++){this._tracks[i].Interpolate(this._playheadTime,true,false,ensureValue,this._firstTick,false);}for(i=0;i<bal;i++){this._beforeAndAfterTracks[i].AfterInterpolate();}if(this._firstTick)this._firstTick=false;}},{key:"_Interpolate",value:function _Interpolate(time){var isTicking=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var setTime=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var ensureValue=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var lastTime=arguments.length>4&&arguments[4]!==undefined?arguments[4]:NaN;var onTickCall=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;var ignoreGlobals=arguments.length>6&&arguments[6]!==undefined?arguments[6]:false;var _iteratorNormalCompletion233=true;var _didIteratorError233=false;var _iteratorError233=undefined;try{for(var _iterator233=this._tracks[Symbol.iterator](),_step233;!(_iteratorNormalCompletion233=(_step233=_iterator233.next()).done);_iteratorNormalCompletion233=true){var track=_step233.value;track.BeforeInterpolate();}}catch(err){_didIteratorError233=true;_iteratorError233=err;}finally{try{if(!_iteratorNormalCompletion233&&_iterator233["return"]!=null){_iterator233["return"]();}}finally{if(_didIteratorError233){throw _iteratorError233;}}}var _iteratorNormalCompletion234=true;var _didIteratorError234=false;var _iteratorError234=undefined;try{for(var _iterator234=this._tracks[Symbol.iterator](),_step234;!(_iteratorNormalCompletion234=(_step234=_iterator234.next()).done);_iteratorNormalCompletion234=true){var _track3=_step234.value;var t=time;if(typeof lastTime==="number"&&!isNaN(lastTime)){var globalTime=this.GetTime();var localTime=globalTime-_track3.GetStartOffset();var lastLocalTime=lastTime-_track3.GetStartOffset();if(localTime<0&&lastLocalTime>0){t=_track3.GetStartOffset();this._SetTime(t);}}_track3.Interpolate(t,isTicking,setTime,ensureValue,this._firstTick,ignoreGlobals);}}catch(err){_didIteratorError234=true;_iteratorError234=err;}finally{try{if(!_iteratorNormalCompletion234&&_iterator234["return"]!=null){_iterator234["return"]();}}finally{if(_didIteratorError234){throw _iteratorError234;}}}var _iteratorNormalCompletion235=true;var _didIteratorError235=false;var _iteratorError235=undefined;try{for(var _iterator235=this._tracks[Symbol.iterator](),_step235;!(_iteratorNormalCompletion235=(_step235=_iterator235.next()).done);_iteratorNormalCompletion235=true){var _track4=_step235.value;_track4.AfterInterpolate();}}catch(err){_didIteratorError235=true;_iteratorError235=err;}finally{try{if(!_iteratorNormalCompletion235&&_iterator235["return"]!=null){_iterator235["return"]();}}finally{if(_didIteratorError235){throw _iteratorError235;}}}if(this._firstTick&&onTickCall)this._firstTick=false;}},{key:"AddTrack",value:function AddTrack(){var trackDataItem=this._timelineDataItem.GetTrackData().AddEmptyTrackDataItem();var track=_C92.TrackState.Create(this,trackDataItem);this._tracksLength=this._tracks.push(track);return track;}},{key:"Removed",value:function Removed(){if(this.IsReleased())return;var _iteratorNormalCompletion236=true;var _didIteratorError236=false;var _iteratorError236=undefined;try{for(var _iterator236=this._tracks[Symbol.iterator](),_step236;!(_iteratorNormalCompletion236=(_step236=_iterator236.next()).done);_iteratorNormalCompletion236=true){var track=_step236.value;track.TimelineRemoved();}}catch(err){_didIteratorError236=true;_iteratorError236=err;}finally{try{if(!_iteratorNormalCompletion236&&_iterator236["return"]!=null){_iterator236["return"]();}}finally{if(_didIteratorError236){throw _iteratorError236;}}}}},{key:"CleanCaches",value:function CleanCaches(){var _iteratorNormalCompletion237=true;var _didIteratorError237=false;var _iteratorError237=undefined;try{for(var _iterator237=this._tracks[Symbol.iterator](),_step237;!(_iteratorNormalCompletion237=(_step237=_iterator237.next()).done);_iteratorNormalCompletion237=true){var track=_step237.value;track.CleanCaches();}}catch(err){_didIteratorError237=true;_iteratorError237=err;}finally{try{if(!_iteratorNormalCompletion237&&_iterator237["return"]!=null){_iterator237["return"]();}}finally{if(_didIteratorError237){throw _iteratorError237;}}}}},{key:"ClearTrackInstances",value:function ClearTrackInstances(){var _iteratorNormalCompletion238=true;var _didIteratorError238=false;var _iteratorError238=undefined;try{for(var _iterator238=this._tracks[Symbol.iterator](),_step238;!(_iteratorNormalCompletion238=(_step238=_iterator238.next()).done);_iteratorNormalCompletion238=true){var track=_step238.value;track.ClearInstance();}}catch(err){_didIteratorError238=true;_iteratorError238=err;}finally{try{if(!_iteratorNormalCompletion238&&_iterator238["return"]!=null){_iterator238["return"]();}}finally{if(_didIteratorError238){throw _iteratorError238;}}}}},{key:"SetTrackInstance",value:function SetTrackInstance(trackId,instance){if(!instance)return;var _iteratorNormalCompletion239=true;var _didIteratorError239=false;var _iteratorError239=undefined;try{for(var _iterator239=this._tracks[Symbol.iterator](),_step239;!(_iteratorNormalCompletion239=(_step239=_iterator239.next()).done);_iteratorNormalCompletion239=true){var track=_step239.value;if(!track.IsInstanceTrack())continue;if(trackId){if(track.GetId()!==trackId)continue;track.SetInstance(instance);this._timelineManager.SetTimelineObjectClassToMap(instance.GetObjectClass(),this);break;}else{if(track.HasInstance())continue;track.SetInstance(instance);this._timelineManager.SetTimelineObjectClassToMap(instance.GetObjectClass(),this);break;}}}catch(err){_didIteratorError239=true;_iteratorError239=err;}finally{try{if(!_iteratorNormalCompletion239&&_iterator239["return"]!=null){_iterator239["return"]();}}finally{if(_didIteratorError239){throw _iteratorError239;}}}}},{key:"HasTrackInstance",value:function HasTrackInstance(instance,trackId){var _iteratorNormalCompletion240=true;var _didIteratorError240=false;var _iteratorError240=undefined;try{for(var _iterator240=this._tracks[Symbol.iterator](),_step240;!(_iteratorNormalCompletion240=(_step240=_iterator240.next()).done);_iteratorNormalCompletion240=true){var track=_step240.value;if(!track.IsInstanceTrack())continue;if(trackId){if(trackId===track.GetId()&&instance===track.GetInstance())return true;}else if(instance===track.GetInstance())return true;}}catch(err){_didIteratorError240=true;_iteratorError240=err;}finally{try{if(!_iteratorNormalCompletion240&&_iterator240["return"]!=null){_iterator240["return"]();}}finally{if(_didIteratorError240){throw _iteratorError240;}}}return false;}},{key:"HasValidTracks",value:function HasValidTracks(){return this._tracks.some(function(t){if(t.IsInstanceTrack())return t.CanInstanceBeValid();else return true;});}},{key:"HasValidGlobalTracks",value:function HasValidGlobalTracks(){return this._tracks.some(function(t){if(t.IsInstanceTrack()){if(!t.CanInstanceBeValid())return false;var objectClass=t.GetObjectClass();if(!objectClass)return false;return objectClass.IsGlobal();}else return false;});}},{key:"GetPropertyTrack",value:function GetPropertyTrack(propertyName){var _iteratorNormalCompletion241=true;var _didIteratorError241=false;var _iteratorError241=undefined;try{for(var _iterator241=this.GetTracks()[Symbol.iterator](),_step241;!(_iteratorNormalCompletion241=(_step241=_iterator241.next()).done);_iteratorNormalCompletion241=true){var track=_step241.value;var _iteratorNormalCompletion242=true;var _didIteratorError242=false;var _iteratorError242=undefined;try{for(var _iterator242=track.GetPropertyTracks()[Symbol.iterator](),_step242;!(_iteratorNormalCompletion242=(_step242=_iterator242.next()).done);_iteratorNormalCompletion242=true){var propertyTrack=_step242.value;if(propertyTrack.GetPropertyName()===propertyName)return propertyTrack;}}catch(err){_didIteratorError242=true;_iteratorError242=err;}finally{try{if(!_iteratorNormalCompletion242&&_iterator242["return"]!=null){_iterator242["return"]();}}finally{if(_didIteratorError242){throw _iteratorError242;}}}}}catch(err){_didIteratorError241=true;_iteratorError241=err;}finally{try{if(!_iteratorNormalCompletion241&&_iterator241["return"]!=null){_iterator241["return"]();}}finally{if(_didIteratorError241){throw _iteratorError241;}}}}},{key:"GetTrackFromInstance",value:function GetTrackFromInstance(instance){var _iteratorNormalCompletion243=true;var _didIteratorError243=false;var _iteratorError243=undefined;try{for(var _iterator243=this._tracks[Symbol.iterator](),_step243;!(_iteratorNormalCompletion243=(_step243=_iterator243.next()).done);_iteratorNormalCompletion243=true){var track=_step243.value;if(instance===track.GetInstance())return track;}}catch(err){_didIteratorError243=true;_iteratorError243=err;}finally{try{if(!_iteratorNormalCompletion243&&_iterator243["return"]!=null){_iterator243["return"]();}}finally{if(_didIteratorError243){throw _iteratorError243;}}}return null;}},{key:"GetKeyframeWithTags",value:function GetKeyframeWithTags(tags){var tagsArray=tags?tags.split(" "):[];var tagsSet=new Set(tagsArray.map(function(t){return t.toLowerCase().trim();}));tagsArray=_toConsumableArray(tagsSet.values());var _iteratorNormalCompletion244=true;var _didIteratorError244=false;var _iteratorError244=undefined;try{for(var _iterator244=this.GetTracks()[Symbol.iterator](),_step244;!(_iteratorNormalCompletion244=(_step244=_iterator244.next()).done);_iteratorNormalCompletion244=true){var track=_step244.value;var _iteratorNormalCompletion245=true;var _didIteratorError245=false;var _iteratorError245=undefined;try{var _loop9=function _loop9(){var keyframeDataItem=_step245.value;var hasAllTags=tagsArray.every(function(t){return keyframeDataItem.HasTag(t);});if(hasAllTags)return{v:keyframeDataItem};};for(var _iterator245=track.GetKeyframeDataItems()[Symbol.iterator](),_step245;!(_iteratorNormalCompletion245=(_step245=_iterator245.next()).done);_iteratorNormalCompletion245=true){var _ret5=_loop9();if(_typeof(_ret5)==="object")return _ret5.v;}}catch(err){_didIteratorError245=true;_iteratorError245=err;}finally{try{if(!_iteratorNormalCompletion245&&_iterator245["return"]!=null){_iterator245["return"]();}}finally{if(_didIteratorError245){throw _iteratorError245;}}}}}catch(err){_didIteratorError244=true;_iteratorError244=err;}finally{try{if(!_iteratorNormalCompletion244&&_iterator244["return"]!=null){_iterator244["return"]();}}finally{if(_didIteratorError244){throw _iteratorError244;}}}}},{key:"GetObjectClasses",value:function GetObjectClasses(){var ret=[];var _iteratorNormalCompletion246=true;var _didIteratorError246=false;var _iteratorError246=undefined;try{for(var _iterator246=this.GetTracks()[Symbol.iterator](),_step246;!(_iteratorNormalCompletion246=(_step246=_iterator246.next()).done);_iteratorNormalCompletion246=true){var track=_step246.value;ret.push(track.GetObjectClass());}}catch(err){_didIteratorError246=true;_iteratorError246=err;}finally{try{if(!_iteratorNormalCompletion246&&_iterator246["return"]!=null){_iterator246["return"]();}}finally{if(_didIteratorError246){throw _iteratorError246;}}}return ret.filter(function(oc){return oc;});}},{key:"_SaveToJson",value:function _SaveToJson(){return{"tracksJson":this._SaveTracksToJson(),"name":this._name,"playheadTime":this.GetTime(),"playbackRate":this._playbackRate,"pingPongState":this._pingPongState,"currentRepeatCount":this._currentRepeatCount,"isPlaying":this._isPlaying,"isScheduled":this._isScheduled,"initialStateSet":this._initialStateSet,"finishedTriggers":this._finishedTriggers,"complete":this._complete,"released":this._released,"markedForRemoval":this._markedForRemoval,"completedTick":this._completedTick,"implicitPause":this._implicitPause,"isTemplate":this._isTemplate,"tags":this._tags.join(" "),"stringTags":this._stringTags,"tagsChanged":this._tagsChanged,"firstTick":this._firstTick};}},{key:"_LoadFromJson",value:function _LoadFromJson(o){if(!o)return;this._LoadTracksFromJson(o["tracksJson"]);this._name=o["name"];this._playheadTime=o["playheadTime"];this._playbackRate=o["playbackRate"];this._pingPongState=o["pingPongState"];this._currentRepeatCount=o["currentRepeatCount"];this._isPlaying=!!o["isPlaying"];this._isScheduled=!!o["isScheduled"];this._initialStateSet=!!o["initialStateSet"];this._finishedTriggers=o.hasOwnProperty("finishedTriggers")?!!o["finishedTriggers"]:false;this._complete=!!o["complete"];this._released=!!o["released"];this._markedForRemoval=!!o["markedForRemoval"];this._completedTick=o["completedTick"];this._implicitPause=!!o["implicitPause"];this._isTemplate=!!o["isTemplate"];this._tags=o["tags"].split(" ");this._stringTags=o["stringTags"];this._tagsChanged=!!o["tagsChanged"];this._firstTick=!!o["firstTick"];}},{key:"_SaveTracksToJson",value:function _SaveTracksToJson(){return this._tracks.map(function(trackState){return trackState._SaveToJson();});}},{key:"_LoadTracksFromJson",value:function _LoadTracksFromJson(tracksJson){var _this48=this;this.ClearTrackInstances();tracksJson.forEach(function(trackJson,i){var track=_this48._tracks[i];track._LoadFromJson(trackJson);});this._tracks.filter(function(track){return track.CanInstanceBeValid();});}},{key:"GetITimelineState",value:function GetITimelineState(){if(!this._iTimelineState)this._iTimelineState=_C92.New(self.ITimelineState,this);return this._iTimelineState;}}],[{key:"CreateInitial",value:function CreateInitial(timelineDataJson,timelineManager){var timelineDataManager=timelineManager.GetTimelineDataManager();var nameId=timelineDataManager.GetNameId();var timelineDataItem=timelineDataManager.Get(timelineDataJson[nameId]);var timeline=_C92.New(_C92.TimelineState,timelineDataJson[nameId],timelineDataItem,timelineManager);timeline.SetIsTemplate(true);return timeline;}},{key:"CreateFromTemplate",value:function CreateFromTemplate(name,timelineDataItem,timelineManager){return _C92.New(_C92.TimelineState,name,timelineDataItem,timelineManager);}},{key:"_HasTag",value:function _HasTag(tag){var tags=this.GetTags();if(tag==="")return tags.length===1&&tags[0]==="";return tags.map(function(t){return t.toLowerCase();}).includes(tag.toLowerCase());}},{key:"_GetTagArray",value:function _GetTagArray(tags){if(_C92.IsArray(tags))return tags.slice(0);if(_C92.IsString(tags))return tags.split(" ");throw new Error("invalid tags");}}]);return Timeline;}(_C92.DefendedBase);}// timelines/state/trackState.js
{'use strict';var _C93=self.C3;var INSTANCE_TRACK=0;var VALUE_TRACK=1;var AUDIO_TRACK=2;_C93.TrackState=/*#__PURE__*/function(_C93$DefendedBase){_inherits(Track,_C93$DefendedBase);function Track(timeline,trackDataItem){var _this49;_classCallCheck(this,Track);_this49=_possibleConstructorReturn(this,_getPrototypeOf(Track).call(this));_this49._timeline=timeline;_this49._trackDataItem=trackDataItem;_this49._trackData=trackDataItem.GetTrackData();_this49._instanceUid=NaN;_this49._objectClassIndex=NaN;_this49._instance=null;_this49._worldInfo=null;_this49._isNested=trackDataItem.GetStartOffset()>0;_this49._initialStateOfNestedSet=false;_this49._endStateOfNestedSet=false;_this49._lastKeyframeDataItem=null;_this49._keyframeDataItems=_this49._trackDataItem.GetKeyframeData().GetKeyframeDataItemArray();_this49._propertyTracks=[];_this49.CreatePropertyTrackStates();_this49._worldInfoChange=0;_this49._renderChange=0;_this49._needsBeforeAndAfter=0;return _this49;}_createClass(Track,[{key:"Release",value:function Release(){this._keyframeDataItems=null;var _iteratorNormalCompletion247=true;var _didIteratorError247=false;var _iteratorError247=undefined;try{for(var _iterator247=this._propertyTracks[Symbol.iterator](),_step247;!(_iteratorNormalCompletion247=(_step247=_iterator247.next()).done);_iteratorNormalCompletion247=true){var propertyTrack=_step247.value;propertyTrack.Release();}}catch(err){_didIteratorError247=true;_iteratorError247=err;}finally{try{if(!_iteratorNormalCompletion247&&_iterator247["return"]!=null){_iterator247["return"]();}}finally{if(_didIteratorError247){throw _iteratorError247;}}}_C93.clearArray(this._propertyTracks);this._propertyTracks=null;this._timeline=null;this._instance=null;this._worldInfo=null;this._trackDataItem=null;this._lastKeyframeDataItem=null;}},{key:"CreatePropertyTrackStates",value:function CreatePropertyTrackStates(){var _iteratorNormalCompletion248=true;var _didIteratorError248=false;var _iteratorError248=undefined;try{for(var _iterator248=this._trackDataItem.GetPropertyTrackData().propertyTrackDataItems()[Symbol.iterator](),_step248;!(_iteratorNormalCompletion248=(_step248=_iterator248.next()).done);_iteratorNormalCompletion248=true){var propertyTrackDataItem=_step248.value;this._propertyTracks.push(_C93.PropertyTrackState.Create(this,propertyTrackDataItem));}}catch(err){_didIteratorError248=true;_iteratorError248=err;}finally{try{if(!_iteratorNormalCompletion248&&_iterator248["return"]!=null){_iterator248["return"]();}}finally{if(_didIteratorError248){throw _iteratorError248;}}}}},{key:"TimelineRemoved",value:function TimelineRemoved(){var _iteratorNormalCompletion249=true;var _didIteratorError249=false;var _iteratorError249=undefined;try{for(var _iterator249=this._propertyTracks[Symbol.iterator](),_step249;!(_iteratorNormalCompletion249=(_step249=_iterator249.next()).done);_iteratorNormalCompletion249=true){var propertyTrack=_step249.value;propertyTrack.TimelineRemoved();}}catch(err){_didIteratorError249=true;_iteratorError249=err;}finally{try{if(!_iteratorNormalCompletion249&&_iterator249["return"]!=null){_iterator249["return"]();}}finally{if(_didIteratorError249){throw _iteratorError249;}}}}},{key:"CleanCaches",value:function CleanCaches(){var _iteratorNormalCompletion250=true;var _didIteratorError250=false;var _iteratorError250=undefined;try{for(var _iterator250=this._propertyTracks[Symbol.iterator](),_step250;!(_iteratorNormalCompletion250=(_step250=_iterator250.next()).done);_iteratorNormalCompletion250=true){var propertyTrack=_step250.value;propertyTrack.CleanCaches();}}catch(err){_didIteratorError250=true;_iteratorError250=err;}finally{try{if(!_iteratorNormalCompletion250&&_iterator250["return"]!=null){_iterator250["return"]();}}finally{if(_didIteratorError250){throw _iteratorError250;}}}this._instance=null;this._worldInfo=null;}},{key:"GetTimeline",value:function GetTimeline(){return this._timeline;}},{key:"GetRuntime",value:function GetRuntime(){return this._timeline.GetRuntime();}},{key:"GetKeyframeDataItems",value:function GetKeyframeDataItems(){if(this._keyframeDataItems)return this._keyframeDataItems;this._keyframeDataItems=this._trackDataItem.GetKeyframeData().GetKeyframeDataItemArray();return this._keyframeDataItems;}},{key:"GetPropertyTracks",value:function GetPropertyTracks(){return this._propertyTracks;}},{key:"GetPropertyTrack",value:function GetPropertyTrack(propertyName){for(var i=0;i<this._propertyTracks.length;i++){var propertyTrack=this._propertyTracks[i];if(propertyTrack.GetPropertyName()===propertyName)return propertyTrack;}}},{key:"MaybeGetInstance",value:function MaybeGetInstance(){if(!this._instance)this.GetInstance();}},{key:"IsInstanceValid",value:function IsInstanceValid(){if(!this._instance)return false;return!this._instance.IsDestroyed();}},{key:"CanInstanceBeValid",value:function CanInstanceBeValid(){if(!this.IsInstanceTrack())return false;var uid=this.GetInstanceUID();var instance=this.GetRuntime().GetInstanceByUID(uid);if(!instance)return false;return!instance.IsDestroyed();}},{key:"GetObjectClass",value:function GetObjectClass(){if(!this.IsInstanceTrack())return;var index=this.GetObjectClassIndex();if(index===-1)return;return this.GetRuntime().GetObjectClassByIndex(index);}},{key:"ClearInstance",value:function ClearInstance(){this._instance=null;this._instanceUid=NaN;this._worldInfo=null;this._objectClassIndex=NaN;}},{key:"HasInstance",value:function HasInstance(){return!!this._instance;}},{key:"GetInstance",value:function GetInstance(){if(this._instance&&this.IsInstanceValid())return this._instance;var uid=this.GetInstanceUID();this._instance=this.GetRuntime().GetInstanceByUID(uid);return this._instance;}},{key:"SetInstance",value:function SetInstance(instance){if(this._instance===instance)return;this.CleanCaches();this._instance=instance;this._objectClassIndex=instance.GetObjectClass().GetIndex();this._instanceUid=instance.GetUID();this._worldInfo=instance.GetWorldInfo();var _iteratorNormalCompletion251=true;var _didIteratorError251=false;var _iteratorError251=undefined;try{for(var _iterator251=this.propertyTrackItems()[Symbol.iterator](),_step251;!(_iteratorNormalCompletion251=(_step251=_iterator251.next()).done);_iteratorNormalCompletion251=true){var item=_step251.value;var propertyTrack=item.propertyTrack;var sourceAdapter=item.sourceAdapter;var id=propertyTrack.GetSourceAdapterId();switch(id){case"instance-variable":{var index=sourceAdapter.GetEditorIndex();var objectClass=instance.GetObjectClass();var i=objectClass.GetInstanceVariableIndexByName(item.name);var name=objectClass.GetInstanceVariableName(i);var type=objectClass.GetInstanceVariableType(i);if(name===item.name&&type===item.type)sourceAdapter.UpdateInstanceVariableIndex(i);break;}case"behavior":{var timelineBehaviorType=item.behaviorType;var trackObjectClass=this.GetObjectClass();var _objectClass3=instance.GetObjectClass();var instanceBehaviorType=sourceAdapter.GetBehaviorType(_objectClass3);if(timelineBehaviorType&&instanceBehaviorType){var _name3=timelineBehaviorType.GetName();var templateBehaviorIndex=trackObjectClass.GetBehaviorIndexByName(_name3);var instanceBehaviorIndex=_objectClass3.GetBehaviorIndexByName(_name3);var propertyIndex=sourceAdapter.GetEditorIndex();sourceAdapter.UpdateBehaviorTypeSid(instanceBehaviorType.GetSID());}break;}}}}catch(err){_didIteratorError251=true;_iteratorError251=err;}finally{try{if(!_iteratorNormalCompletion251&&_iterator251["return"]!=null){_iterator251["return"]();}}finally{if(_didIteratorError251){throw _iteratorError251;}}}}},{key:"propertyTrackItems",value:/*#__PURE__*/regeneratorRuntime.mark(function propertyTrackItems(){var _iteratorNormalCompletion252,_didIteratorError252,_iteratorError252,_iterator252,_step252,propertyTrack,sourceAdapter,objectClass,ret,index,_effectList,effectType,behaviorType;return regeneratorRuntime.wrap(function propertyTrackItems$(_context89){while(1){switch(_context89.prev=_context89.next){case 0:_iteratorNormalCompletion252=true;_didIteratorError252=false;_iteratorError252=undefined;_context89.prev=3;_iterator252=this._propertyTracks[Symbol.iterator]();case 5:if(_iteratorNormalCompletion252=(_step252=_iterator252.next()).done){_context89.next=34;break;}propertyTrack=_step252.value;sourceAdapter=propertyTrack.GetSourceAdapter();objectClass=this.GetObjectClass();ret={propertyTrack:propertyTrack,sourceAdapter:sourceAdapter};_context89.t0=propertyTrack.GetSourceAdapterId();_context89.next=_context89.t0==="world-instance"?13:_context89.t0==="instance-variable"?15:_context89.t0==="effect"?19:_context89.t0==="behavior"?23:_context89.t0==="plugin"?26:_context89.t0==="value"?28:29;break;case 13:ret.property=propertyTrack.GetPropertyName();return _context89.abrupt("break",29);case 15:index=sourceAdapter.GetEditorIndex();ret.name=objectClass.GetInstanceVariableName(index);ret.type=objectClass.GetInstanceVariableType(index);return _context89.abrupt("break",29);case 19:_effectList=objectClass.GetEffectList();effectType=sourceAdapter.GetEffectType(_effectList);ret.effectType=effectType;return _context89.abrupt("break",29);case 23:behaviorType=sourceAdapter.GetBehaviorType(objectClass);ret.behaviorType=behaviorType;return _context89.abrupt("break",29);case 26:ret.plugin=objectClass.GetPlugin();return _context89.abrupt("break",29);case 28:return _context89.abrupt("break",29);case 29:_context89.next=31;return ret;case 31:_iteratorNormalCompletion252=true;_context89.next=5;break;case 34:_context89.next=40;break;case 36:_context89.prev=36;_context89.t1=_context89["catch"](3);_didIteratorError252=true;_iteratorError252=_context89.t1;case 40:_context89.prev=40;_context89.prev=41;if(!_iteratorNormalCompletion252&&_iterator252["return"]!=null){_iterator252["return"]();}case 43:_context89.prev=43;if(!_didIteratorError252){_context89.next=46;break;}throw _iteratorError252;case 46:return _context89.finish(43);case 47:return _context89.finish(40);case 48:case"end":return _context89.stop();}}},propertyTrackItems,this,[[3,36,40,48],[41,,43,47]]);})},{key:"GetWorldInfo",value:function GetWorldInfo(){if(this._worldInfo&&this.IsInstanceValid())return this._worldInfo;var instance=this.GetInstance();if(instance)this._worldInfo=instance.GetWorldInfo();return this._worldInfo;}},{key:"GetTrackDataItem",value:function GetTrackDataItem(){return this._trackDataItem;}},{key:"GetInstanceUID",value:function GetInstanceUID(){if(!isNaN(this._instanceUid))return this._instanceUid;return this._trackDataItem.GetInstanceUID();}},{key:"SetInstanceUID",value:function SetInstanceUID(uid){this._trackDataItem.SetInstanceUID(uid);}},{key:"GetInterpolationMode",value:function GetInterpolationMode(){return this._trackDataItem.GetInterpolationMode();}},{key:"SetInterpolationMode",value:function SetInterpolationMode(im){this._trackDataItem.SetInterpolationMode(im);}},{key:"GetResultMode",value:function GetResultMode(){return this._trackDataItem.GetResultMode();}},{key:"GetId",value:function GetId(){return this._trackDataItem.GetId();}},{key:"GetStartOffset",value:function GetStartOffset(){return this._trackDataItem.GetStartOffset();}},{key:"GetLocalTotalTime",value:function GetLocalTotalTime(){return this._trackDataItem.GetLocalTotalTime();}},{key:"SetLocalTotalTime",value:function SetLocalTotalTime(t){this._trackDataItem.SetLocalTotalTime(t);}},{key:"SetResultMode",value:function SetResultMode(rm){this._trackDataItem.SetResultMode(rm);}},{key:"SetEase",value:function SetEase(e){var _iteratorNormalCompletion253=true;var _didIteratorError253=false;var _iteratorError253=undefined;try{for(var _iterator253=this.GetKeyframeDataItems()[Symbol.iterator](),_step253;!(_iteratorNormalCompletion253=(_step253=_iterator253.next()).done);_iteratorNormalCompletion253=true){var keyframeDataItem=_step253.value;keyframeDataItem.SetEase(e);}}catch(err){_didIteratorError253=true;_iteratorError253=err;}finally{try{if(!_iteratorNormalCompletion253&&_iterator253["return"]!=null){_iterator253["return"]();}}finally{if(_didIteratorError253){throw _iteratorError253;}}}var _iteratorNormalCompletion254=true;var _didIteratorError254=false;var _iteratorError254=undefined;try{for(var _iterator254=this.GetPropertyTracks()[Symbol.iterator](),_step254;!(_iteratorNormalCompletion254=(_step254=_iterator254.next()).done);_iteratorNormalCompletion254=true){var propertyTrack=_step254.value;propertyTrack.SetEase(e);}}catch(err){_didIteratorError254=true;_iteratorError254=err;}finally{try{if(!_iteratorNormalCompletion254&&_iterator254["return"]!=null){_iterator254["return"]();}}finally{if(_didIteratorError254){throw _iteratorError254;}}}}},{key:"GetEnable",value:function GetEnable(){return this._trackDataItem.GetEnable();}},{key:"SetEnable",value:function SetEnable(e){this._trackDataItem.SetEnable(e);}},{key:"GetObjectClassIndex",value:function GetObjectClassIndex(){if(!isNaN(this._objectClassIndex))return this._objectClassIndex;return this._trackDataItem.GetObjectClassIndex();}},{key:"SetObjectClassIndex",value:function SetObjectClassIndex(objectClassIndex){this._trackDataItem.SetObjectClassIndex(objectClassIndex);}},{key:"SetOriginalWidth",value:function SetOriginalWidth(w){this._trackDataItem.SetOriginalWidth(w);}},{key:"GetOriginalWidth",value:function GetOriginalWidth(){var instance=this.GetInstance();if(instance){var sdkIntance=instance.GetSdkInstance();if(sdkIntance.IsOriginalSizeKnown())return instance.GetSdkInstance().GetOriginalWidth();}return this._trackDataItem.GetOriginalWidth();}},{key:"SetOriginalHeight",value:function SetOriginalHeight(h){this._trackDataItem.SetOriginalHeight(h);}},{key:"GetOriginalHeight",value:function GetOriginalHeight(){var instance=this.GetInstance();if(instance){var sdkIntance=instance.GetSdkInstance();if(sdkIntance.IsOriginalSizeKnown())return instance.GetSdkInstance().GetOriginalHeight();}return this._trackDataItem.GetOriginalHeight();}},{key:"GetType",value:function GetType(){return this._trackDataItem.GetType();}},{key:"GetName",value:function GetName(){return this._trackDataItem.GetName();}},{key:"IsInstanceTrack",value:function IsInstanceTrack(){return this.GetType()===INSTANCE_TRACK;}},{key:"IsValueTrack",value:function IsValueTrack(){return this.GetType()===VALUE_TRACK;}},{key:"IsAudioTrack",value:function IsAudioTrack(){return this.GetType()===AUDIO_TRACK;}},{key:"GetWorldInfoChange",value:function GetWorldInfoChange(){return this._worldInfoChange;}},{key:"GetRenderChange",value:function GetRenderChange(){return this._renderChange;}},{key:"GetNeedsBeforeAndAfter",value:function GetNeedsBeforeAndAfter(){return this._needsBeforeAndAfter;}},{key:"IsNested",value:function IsNested(){return this._isNested;}},{key:"SetResetState",value:function SetResetState(){var _iteratorNormalCompletion255=true;var _didIteratorError255=false;var _iteratorError255=undefined;try{for(var _iterator255=this._propertyTracks[Symbol.iterator](),_step255;!(_iteratorNormalCompletion255=(_step255=_iterator255.next()).done);_iteratorNormalCompletion255=true){var propertyTrack=_step255.value;propertyTrack.SetResetState();}}catch(err){_didIteratorError255=true;_iteratorError255=err;}finally{try{if(!_iteratorNormalCompletion255&&_iterator255["return"]!=null){_iterator255["return"]();}}finally{if(_didIteratorError255){throw _iteratorError255;}}}}},{key:"SetInitialState",value:function SetInitialState(){this.MaybeGetInstance();if(!this.IsInstanceValid()&&this.IsInstanceTrack())return;var timeline=this.GetTimeline();var isForwardPlayBack=timeline.IsForwardPlayBack();var time=isForwardPlayBack?0:this.GetLocalTotalTime();var _iteratorNormalCompletion256=true;var _didIteratorError256=false;var _iteratorError256=undefined;try{for(var _iterator256=this._propertyTracks[Symbol.iterator](),_step256;!(_iteratorNormalCompletion256=(_step256=_iterator256.next()).done);_iteratorNormalCompletion256=true){var propertyTrack=_step256.value;propertyTrack.SetInitialState(time);if(this._worldInfoChange===0&&propertyTrack.GetWorldInfoChange()===1)this._worldInfoChange=1;if(this._renderChange===0&&propertyTrack.GetRenderChange()===1)this._renderChange=1;}}catch(err){_didIteratorError256=true;_iteratorError256=err;}finally{try{if(!_iteratorNormalCompletion256&&_iterator256["return"]!=null){_iterator256["return"]();}}finally{if(_didIteratorError256){throw _iteratorError256;}}}this._needsBeforeAndAfter=0;var nba=this._propertyTracks.some(function(pt){return pt.GetNeedsBeforeAndAfter();});if(nba)this._needsBeforeAndAfter=1;this._lastKeyframeDataItem=this._GetLastKeyFrameBeforeTime(time);this._initialStateOfNestedSet=false;this._endStateOfNestedSet=false;this.Interpolate(time);this.OnKeyframeReached(this._GetLastKeyFrameBeforeTime(time));}},{key:"SetResumeState",value:function SetResumeState(){this.MaybeGetInstance();if(!this.IsInstanceValid()&&this.IsInstanceTrack())return;var playbackDirection=this._timeline.IsForwardPlayBack();var time=this._timeline.GetTime()-this.GetStartOffset();this._lastKeyframeDataItem=this._GetLastKeyFrameBeforeTime(time);var _iteratorNormalCompletion257=true;var _didIteratorError257=false;var _iteratorError257=undefined;try{for(var _iterator257=this._propertyTracks[Symbol.iterator](),_step257;!(_iteratorNormalCompletion257=(_step257=_iterator257.next()).done);_iteratorNormalCompletion257=true){var propertyTrack=_step257.value;propertyTrack.SetResumeState(time);}}catch(err){_didIteratorError257=true;_iteratorError257=err;}finally{try{if(!_iteratorNormalCompletion257&&_iterator257["return"]!=null){_iterator257["return"]();}}finally{if(_didIteratorError257){throw _iteratorError257;}}}}},{key:"SetEndState",value:function SetEndState(){if(this.GetTimeline().IsComplete())return;this.MaybeGetInstance();if(!this.IsInstanceValid()&&this.IsInstanceTrack())return;if(!this._isNested){var time=this._timeline.GetTime();var totalTime=this.GetStartOffset()+this.GetLocalTotalTime();if(time>=totalTime)this.Interpolate(this.GetLocalTotalTime(),true,false,true,false,false,true);else if(time<=0)this.Interpolate(0,true,false,true,false,false,true);}}},{key:"_SetUpdateState",value:function _SetUpdateState(){for(var i=0,l=this._propertyTracks.length;i<l;i++){var propertyTrack=this._propertyTracks[i];propertyTrack._SetUpdateState();if(this._worldInfoChange===0&&propertyTrack.GetWorldInfoChange()===1)this._worldInfoChange=1;if(this._renderChange===0&&propertyTrack.GetRenderChange()===1)this._renderChange=1;}}},{key:"BeforeInterpolate",value:function BeforeInterpolate(){var l=this._propertyTracks.length;for(var i=0;i<l;i++){this._propertyTracks[i].BeforeInterpolate();}}},{key:"Interpolate",value:function Interpolate(time){var isTicking=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var setTime=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var ensureValue=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var firstTick=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;var ignoreGlobals=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;var endState=arguments.length>6&&arguments[6]!==undefined?arguments[6]:false;if(!this._instance)this.GetInstance();var instanceValid=this._instance&&!this._instance.IsDestroyed();var isInstanceTrack=this._trackDataItem._type===INSTANCE_TRACK;if(!instanceValid&&isInstanceTrack)return;if(ignoreGlobals&&isInstanceTrack&&this.GetObjectClass().IsGlobal())return;time=time-this.GetStartOffset();if(time<0)return;this.MaybeSetInitialStateOfNestedTrack(time,isTicking);this.MaybeTriggerKeyframeReachedConditions(time,isTicking,firstTick);for(var i=0,l=this._propertyTracks.length;i<l;i++){this._propertyTracks[i].Interpolate(time,setTime,ensureValue,endState);}this.MaybeSetEndStateOfNestedTrack(time,isTicking);if(this._worldInfoChange!==0){if(!this._worldInfo)this._worldInfo=this._instance.GetWorldInfo();if(this._worldInfo)this._worldInfo.SetBboxChanged();}}},{key:"AfterInterpolate",value:function AfterInterpolate(){var l=this._propertyTracks.length;for(var i=0;i<l;i++){this._propertyTracks[i].AfterInterpolate();}}},{key:"MaybeSetInitialStateOfNestedTrack",value:function MaybeSetInitialStateOfNestedTrack(time,isTicking){if(!isTicking)return;if(!this._isNested)return;if(this._initialStateOfNestedSet)return;var timeline=this.GetTimeline();if(timeline.IsForwardPlayBack()){if(time<0)return;}else if(time>this.GetLocalTotalTime())return;var _iteratorNormalCompletion258=true;var _didIteratorError258=false;var _iteratorError258=undefined;try{for(var _iterator258=this._propertyTracks[Symbol.iterator](),_step258;!(_iteratorNormalCompletion258=(_step258=_iterator258.next()).done);_iteratorNormalCompletion258=true){var propertyTrack=_step258.value;propertyTrack.SetInitialState();}}catch(err){_didIteratorError258=true;_iteratorError258=err;}finally{try{if(!_iteratorNormalCompletion258&&_iterator258["return"]!=null){_iterator258["return"]();}}finally{if(_didIteratorError258){throw _iteratorError258;}}}this._initialStateOfNestedSet=true;}},{key:"MaybeSetEndStateOfNestedTrack",value:function MaybeSetEndStateOfNestedTrack(time,isTicking){if(!isTicking)return;if(!this._isNested)return;if(this._endStateOfNestedSet)return;var timeline=this.GetTimeline();if(timeline.IsForwardPlayBack()){if(time>=this.GetLocalTotalTime()){var _iteratorNormalCompletion259=true;var _didIteratorError259=false;var _iteratorError259=undefined;try{for(var _iterator259=this._propertyTracks[Symbol.iterator](),_step259;!(_iteratorNormalCompletion259=(_step259=_iterator259.next()).done);_iteratorNormalCompletion259=true){var propertyTrack=_step259.value;propertyTrack.Interpolate(this.GetLocalTotalTime(),false,true);}}catch(err){_didIteratorError259=true;_iteratorError259=err;}finally{try{if(!_iteratorNormalCompletion259&&_iterator259["return"]!=null){_iterator259["return"]();}}finally{if(_didIteratorError259){throw _iteratorError259;}}}this._endStateOfNestedSet=true;}}else if(time<=0){var _iteratorNormalCompletion260=true;var _didIteratorError260=false;var _iteratorError260=undefined;try{for(var _iterator260=this._propertyTracks[Symbol.iterator](),_step260;!(_iteratorNormalCompletion260=(_step260=_iterator260.next()).done);_iteratorNormalCompletion260=true){var _propertyTrack=_step260.value;_propertyTrack.Interpolate(0,false,true);}}catch(err){_didIteratorError260=true;_iteratorError260=err;}finally{try{if(!_iteratorNormalCompletion260&&_iterator260["return"]!=null){_iterator260["return"]();}}finally{if(_didIteratorError260){throw _iteratorError260;}}}this._endStateOfNestedSet=true;}}},{key:"MaybeTriggerKeyframeReachedConditions",value:function MaybeTriggerKeyframeReachedConditions(time,isTicking,firstTick){if(firstTick)return;if(!isTicking)return;if(!_C93.Plugins.Timeline)return;var timeline=this.GetTimeline();var nextKeyframe=this._lastKeyframeDataItem.GetNext();var lastTime=this._lastKeyframeDataItem.GetTime();var nextTime=nextKeyframe?nextKeyframe.GetTime():timeline.GetTotalTime();if(time<=lastTime||time>=nextTime){this._lastKeyframeDataItem=this._trackData.GetFirstKeyFrameDataItemLowerOrEqualThan(time,this._trackDataItem);if(timeline.IsForwardPlayBack()){if(nextKeyframe)this.OnKeyframeReached(this._lastKeyframeDataItem);}else{var _nextKeyframe=this._lastKeyframeDataItem.GetNext();if(_nextKeyframe)this.OnKeyframeReached(_nextKeyframe);}}}},{key:"_GetLastKeyFrameBeforeTime",value:function _GetLastKeyFrameBeforeTime(time){var keyframeDataItem=this._trackData.GetKeyFrameDataItemAtTime(time,this._trackDataItem);if(keyframeDataItem)return keyframeDataItem;else return this._trackData.GetFirstKeyFrameDataItemLowerOrEqualThan(time,this._trackDataItem);}},{key:"OnKeyframeReached",value:function OnKeyframeReached(keyframeDataItem){if(!_C93.Plugins.Timeline)return;var timeline=this.GetTimeline();var timelineManager=timeline.GetTimelineManager();_C93.Plugins.Timeline.Cnds.PushTriggerTimeline(timeline);_C93.Plugins.Timeline.Cnds.PushTriggerKeyframe(keyframeDataItem);timelineManager.Trigger(_C93.Plugins.Timeline.Cnds.OnAnyKeyframeReached);timelineManager.Trigger(_C93.Plugins.Timeline.Cnds.OnKeyframeReached);_C93.Plugins.Timeline.Cnds.PopTriggerTimeline(timeline);_C93.Plugins.Timeline.Cnds.PopTriggerKeyframe(keyframeDataItem);}},{key:"AddKeyframe",value:function AddKeyframe(){var keyframeData=this._trackDataItem.GetKeyframeData();var keyframeDataItem=keyframeData.AddEmptyKeyframeDataItem();return keyframeDataItem;}},{key:"AddPropertyTrack",value:function AddPropertyTrack(){var propertyTrackData=this._trackDataItem.GetPropertyTrackData();var propertyTrackDataItem=propertyTrackData.AddEmptyPropertyTrackDataItem();var propertyTrack=_C93.PropertyTrackState.Create(this,propertyTrackDataItem);this._propertyTracks.push(propertyTrack);return propertyTrack;}},{key:"DeleteKeyframes",value:function DeleteKeyframes(match){var keyframeData=this._trackDataItem.GetKeyframeData();keyframeData.DeleteKeyframeDataItems(match);}},{key:"DeletePropertyKeyframes",value:function DeletePropertyKeyframes(match){var _iteratorNormalCompletion261=true;var _didIteratorError261=false;var _iteratorError261=undefined;try{for(var _iterator261=this._propertyTracks[Symbol.iterator](),_step261;!(_iteratorNormalCompletion261=(_step261=_iterator261.next()).done);_iteratorNormalCompletion261=true){var propertyTrack=_step261.value;propertyTrack.DeletePropertyKeyframes(match);}}catch(err){_didIteratorError261=true;_iteratorError261=err;}finally{try{if(!_iteratorNormalCompletion261&&_iterator261["return"]!=null){_iterator261["return"]();}}finally{if(_didIteratorError261){throw _iteratorError261;}}}}},{key:"SaveState",value:function SaveState(){var _iteratorNormalCompletion262=true;var _didIteratorError262=false;var _iteratorError262=undefined;try{for(var _iterator262=this._propertyTracks[Symbol.iterator](),_step262;!(_iteratorNormalCompletion262=(_step262=_iterator262.next()).done);_iteratorNormalCompletion262=true){var propertyTrack=_step262.value;propertyTrack.SaveState();}}catch(err){_didIteratorError262=true;_iteratorError262=err;}finally{try{if(!_iteratorNormalCompletion262&&_iterator262["return"]!=null){_iterator262["return"]();}}finally{if(_didIteratorError262){throw _iteratorError262;}}}}},{key:"CompareInitialStateWithCurrent",value:function CompareInitialStateWithCurrent(){this.MaybeGetInstance();if(!this.IsInstanceValid()&&this.IsInstanceTrack())return;var _iteratorNormalCompletion263=true;var _didIteratorError263=false;var _iteratorError263=undefined;try{for(var _iterator263=this._propertyTracks[Symbol.iterator](),_step263;!(_iteratorNormalCompletion263=(_step263=_iterator263.next()).done);_iteratorNormalCompletion263=true){var propertyTrack=_step263.value;propertyTrack.CompareInitialStateWithCurrent();}}catch(err){_didIteratorError263=true;_iteratorError263=err;}finally{try{if(!_iteratorNormalCompletion263&&_iterator263["return"]!=null){_iterator263["return"]();}}finally{if(_didIteratorError263){throw _iteratorError263;}}}}},{key:"CompareSaveStateWithCurrent",value:function CompareSaveStateWithCurrent(){this.MaybeGetInstance();if(!this.IsInstanceValid()&&this.IsInstanceTrack())return;var difference=false;var _iteratorNormalCompletion264=true;var _didIteratorError264=false;var _iteratorError264=undefined;try{for(var _iterator264=this._propertyTracks[Symbol.iterator](),_step264;!(_iteratorNormalCompletion264=(_step264=_iterator264.next()).done);_iteratorNormalCompletion264=true){var propertyTrack=_step264.value;var diff=propertyTrack.CompareSaveStateWithCurrent();if(!difference&&diff)difference=true;}}catch(err){_didIteratorError264=true;_iteratorError264=err;}finally{try{if(!_iteratorNormalCompletion264&&_iterator264["return"]!=null){_iterator264["return"]();}}finally{if(_didIteratorError264){throw _iteratorError264;}}}if(difference){var keyframeDataItem=this.AddKeyframe();keyframeDataItem.SetTime(this.GetTimeline().GetTime());keyframeDataItem.SetEase("noease");keyframeDataItem.SetEnable(true);keyframeDataItem.SetTags("");}}},{key:"_SaveToJson",value:function _SaveToJson(){var instance=this.GetInstance();var uid=instance?instance.GetUID():this.GetInstanceUID();return{"propertyTracksJson":this._SavePropertyTracksToJson(),"lastKeyframeDataItemJson":this._SaveLastKeyframeDataItemToJson(),"initialStateOfNestedSet":this._initialStateOfNestedSet,"endStateOfNestedSet":this._endStateOfNestedSet,"instanceUid":uid};}},{key:"_LoadFromJson",value:function _LoadFromJson(o){if(!o)return;this._LoadPropertyTracksFromJson(o["propertyTracksJson"]);this._LoadLastKeyframeDataItemFromJson(o["lastKeyframeDataItemJson"]);this._LoadInstanceFromJson(o["instanceUid"]);this._initialStateOfNestedSet=false;if(o.hasOwnProperty["initialStateOfNestedSet"])this._initialStateOfNestedSet=o["initialStateOfNestedSet"];this._endStateOfNestedSet=false;if(o.hasOwnProperty["endStateOfNestedSet"])this._endStateOfNestedSet=o["endStateOfNestedSet"];var _iteratorNormalCompletion265=true;var _didIteratorError265=false;var _iteratorError265=undefined;try{for(var _iterator265=this._propertyTracks[Symbol.iterator](),_step265;!(_iteratorNormalCompletion265=(_step265=_iterator265.next()).done);_iteratorNormalCompletion265=true){var propertyTrack=_step265.value;if(this._worldInfoChange===0&&propertyTrack.GetWorldInfoChange()===1)this._worldInfoChange=1;if(this._renderChange===0&&propertyTrack.GetRenderChange()===1)this._renderChange=1;}}catch(err){_didIteratorError265=true;_iteratorError265=err;}finally{try{if(!_iteratorNormalCompletion265&&_iterator265["return"]!=null){_iterator265["return"]();}}finally{if(_didIteratorError265){throw _iteratorError265;}}}this._needsBeforeAndAfter=0;if(this._propertyTracks.some(function(pt){return pt.GetNeedsBeforeAndAfter();}))this._needsBeforeAndAfter=1;}},{key:"_SaveLastKeyframeDataItemToJson",value:function _SaveLastKeyframeDataItemToJson(){var keyframeData=this._trackDataItem.GetKeyframeData();return keyframeData.GetKeyframeDataItemIndex(this._lastKeyframeDataItem);}},{key:"_SavePropertyTracksToJson",value:function _SavePropertyTracksToJson(){return this._propertyTracks.map(function(propertyTrackState){return propertyTrackState._SaveToJson();});}},{key:"_LoadPropertyTracksFromJson",value:function _LoadPropertyTracksFromJson(propertyTracksJson){var _this50=this;propertyTracksJson.forEach(function(propertyTrackJson,i){var propertyTrack=_this50._propertyTracks[i];propertyTrack._LoadFromJson(propertyTrackJson);});}},{key:"_LoadInstanceFromJson",value:function _LoadInstanceFromJson(uid){if(!_C93.IsFiniteNumber(uid))return;var instance=this.GetRuntime().GetInstanceByUID(uid);if(!instance)return;var timeline=this.GetTimeline();timeline.SetTrackInstance(this._trackDataItem.GetId(),instance);}},{key:"_LoadLastKeyframeDataItemFromJson",value:function _LoadLastKeyframeDataItemFromJson(lastKeyframeDataItemIndex){var keyframeData=this._trackDataItem.GetKeyframeData();this._lastKeyframeDataItem=keyframeData.GetKeyframeDataItemFromIndex(lastKeyframeDataItemIndex);}}],[{key:"Create",value:function Create(timeline,trackDataItem){return _C93.New(_C93.TrackState,timeline,trackDataItem);}}]);return Track;}(_C93.DefendedBase);}// timelines/state/propertyTrackState.js
{'use strict';var _C94=self.C3;_C94.PropertyTrackState=/*#__PURE__*/function(_C94$DefendedBase){_inherits(PropertyTrack,_C94$DefendedBase);function PropertyTrack(track,propertyTrackDataItem){var _this51;_classCallCheck(this,PropertyTrack);_this51=_possibleConstructorReturn(this,_getPrototypeOf(PropertyTrack).call(this));_this51._track=track;_this51._propertyTrackDataItem=propertyTrackDataItem;_this51._propertyTrackData=propertyTrackDataItem.GetPropertyTrackData();_this51._worldInfoChange=0;_this51._renderChange=0;_this51._needsBeforeAndAfter=0;_this51._sourceAdapter=_this51.GetSourceAdapter();_this51._propertyKeyframeDataItems=_this51._propertyTrackDataItem.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray();_this51._lastPropertyKeyframeDataItem=null;_this51._absoluteValueObject=null;return _this51;}_createClass(PropertyTrack,[{key:"Release",value:function Release(){this._track=null;if(this._sourceAdapter){this._sourceAdapter.Release();this._sourceAdapter=null;}this._propertyKeyframeDataItems=null;this._propertyTrackDataItem=null;this._propertyTrackData=null;}},{key:"GetWorldInfoChange",value:function GetWorldInfoChange(){return this._worldInfoChange;}},{key:"GetRenderChange",value:function GetRenderChange(){return this._renderChange;}},{key:"GetNeedsBeforeAndAfter",value:function GetNeedsBeforeAndAfter(){return this._needsBeforeAndAfter;}},{key:"HasAbsoluteValueObject",value:function HasAbsoluteValueObject(){return!!this._absoluteValueObject;}},{key:"SetAbsoluteValueObject",value:function SetAbsoluteValueObject(avo){this._absoluteValueObject=avo;}},{key:"GetAbsoluteValueObject",value:function GetAbsoluteValueObject(){return this._absoluteValueObject;}},{key:"GetTrack",value:function GetTrack(){return this._track;}},{key:"GetPropertyTrackDataItem",value:function GetPropertyTrackDataItem(){return this._propertyTrackDataItem;}},{key:"GetPropertyTrackData",value:function GetPropertyTrackData(){return this._propertyTrackData;}},{key:"GetTimeline",value:function GetTimeline(){return this._track.GetTimeline();}},{key:"GetRuntime",value:function GetRuntime(){return this._track.GetRuntime();}},{key:"GetInstance",value:function GetInstance(){return this._track.GetInstance();}},{key:"GetSourceAdapter",value:function GetSourceAdapter(){if(this._sourceAdapter)return this._sourceAdapter;var id=this._propertyTrackDataItem.GetSourceAdapterId();var ret;switch(id){case"behavior":ret=new _C94.PropertyTrackState.BehaviorSourceAdapter(this);break;case"effect":ret=new _C94.PropertyTrackState.EffectSourceAdapter(this);this._renderChange=1;break;case"instance-variable":ret=new _C94.PropertyTrackState.InstanceVariableSourceAdapter(this);break;case"plugin":ret=new _C94.PropertyTrackState.PluginSourceAdapter(this);this._renderChange=1;break;case"world-instance":ret=new _C94.PropertyTrackState.PropertySourceAdapter(this);this._renderChange=1;this._worldInfoChange=1;break;case"value":ret=new _C94.PropertyTrackState.ValueSourceAdapter(this);break;case"audio":ret=new _C94.PropertyTrackState.AudioSourceAdapter(this);break;}this._sourceAdapter=ret;return this._sourceAdapter;}},{key:"GetSourceAdapterId",value:function GetSourceAdapterId(){return this._propertyTrackDataItem.GetSourceAdapterId();}},{key:"SetSourceAdapterId",value:function SetSourceAdapterId(said){this._propertyTrackDataItem.SetSourceAdapterId(said);}},{key:"GetSourceAdapterArgs",value:function GetSourceAdapterArgs(){return this._propertyTrackDataItem.GetSourceAdapterArguments();}},{key:"SetSourceAdapterArgs",value:function SetSourceAdapterArgs(sargs){this._propertyTrackDataItem.SetSourceAdapterArguments(sargs);}},{key:"GetSourceAdapterValue",value:function GetSourceAdapterValue(){return this.GetSourceAdapter().GetValue();}},{key:"GetPropertyName",value:function GetPropertyName(){return this._propertyTrackDataItem.GetProperty();}},{key:"SetPropertyName",value:function SetPropertyName(pn){this._propertyTrackDataItem.SetProperty(pn);}},{key:"GetPropertyType",value:function GetPropertyType(){return this._propertyTrackDataItem.GetType();}},{key:"SetPropertyType",value:function SetPropertyType(pt){this._propertyTrackDataItem.SetType(pt);}},{key:"GetPropertyKeyframeType",value:function GetPropertyKeyframeType(){return this.GetPropertyTrackData().GetFirstPropertyKeyframeDataItem(this._propertyTrackDataItem).GetType();}},{key:"GetMin",value:function GetMin(){return this._propertyTrackDataItem.GetMin();}},{key:"SetMin",value:function SetMin(min){this._propertyTrackDataItem.SetMin(min);}},{key:"GetMax",value:function GetMax(){return this._propertyTrackDataItem.GetMax();}},{key:"SetMax",value:function SetMax(max){this._propertyTrackDataItem.SetMax(max);}},{key:"GetEnable",value:function GetEnable(){return this._propertyTrackDataItem.GetEnable();}},{key:"SetEnable",value:function SetEnable(e){this._propertyTrackDataItem.SetEnable(e);}},{key:"GetInterpolationMode",value:function GetInterpolationMode(){return this._propertyTrackDataItem.GetInterpolationMode();}},{key:"SetInterpolationMode",value:function SetInterpolationMode(im){this._propertyTrackDataItem.SetInterpolationMode(im);}},{key:"GetResultMode",value:function GetResultMode(){return this._propertyTrackDataItem.GetResultMode();}},{key:"SetResultMode",value:function SetResultMode(rm){this._propertyTrackDataItem.SetResultMode(rm);}},{key:"SetEase",value:function SetEase(e){var _iteratorNormalCompletion266=true;var _didIteratorError266=false;var _iteratorError266=undefined;try{for(var _iterator266=this.GetPropertyKeyframeDataItems()[Symbol.iterator](),_step266;!(_iteratorNormalCompletion266=(_step266=_iterator266.next()).done);_iteratorNormalCompletion266=true){var propertyKeyframeDataItem=_step266.value;propertyKeyframeDataItem.SetEase(e);}}catch(err){_didIteratorError266=true;_iteratorError266=err;}finally{try{if(!_iteratorNormalCompletion266&&_iterator266["return"]!=null){_iterator266["return"]();}}finally{if(_didIteratorError266){throw _iteratorError266;}}}}},{key:"CanHavePropertyKeyframes",value:function CanHavePropertyKeyframes(){return this._propertyTrackDataItem.CanHavePropertyKeyframes();}},{key:"GetPropertyKeyframeDataItems",value:function GetPropertyKeyframeDataItems(){if(this._propertyKeyframeDataItems)return this._propertyKeyframeDataItems;this._propertyKeyframeDataItems=this._propertyTrackDataItem.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArray();return this._propertyKeyframeDataItems;}},{key:"GetPropertyKeyframeDataItemArrayIncludingDisabled",value:function GetPropertyKeyframeDataItemArrayIncludingDisabled(){return this._propertyTrackDataItem.GetPropertyKeyframeData().GetPropertyKeyframeDataItemArrayIncludingDisabled();}},{key:"GetPropertyKeyFrameDataItemAtTime",value:function GetPropertyKeyFrameDataItemAtTime(time){return this._propertyTrackData.GetPropertyKeyFrameDataItemAtTime(time,this._propertyTrackDataItem);}},{key:"GetFirstPropertyKeyFrameDataItemLowerOrEqualThan",value:function GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(time){return this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(time,this._propertyTrackDataItem);}},{key:"GetPropertyKeyframeDataItemPairForTime",value:function GetPropertyKeyframeDataItemPairForTime(time){var start=this._propertyTrackData.GetPropertyKeyFrameDataItemAtTime(time,this._propertyTrackDataItem);var end;if(start)end=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemHigherThan(time,this._propertyTrackDataItem);else{start=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(time,this._propertyTrackDataItem);end=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(time,this._propertyTrackDataItem);}return{start:start,end:end};}},{key:"GetPropertyKeyframeValues",value:/*#__PURE__*/regeneratorRuntime.mark(function GetPropertyKeyframeValues(){var _iteratorNormalCompletion267,_didIteratorError267,_iteratorError267,_iterator267,_step267,propertyKeyframeDataItem;return regeneratorRuntime.wrap(function GetPropertyKeyframeValues$(_context90){while(1){switch(_context90.prev=_context90.next){case 0:_iteratorNormalCompletion267=true;_didIteratorError267=false;_iteratorError267=undefined;_context90.prev=3;_iterator267=this.GetPropertyKeyframeDataItems()[Symbol.iterator]();case 5:if(_iteratorNormalCompletion267=(_step267=_iterator267.next()).done){_context90.next=12;break;}propertyKeyframeDataItem=_step267.value;_context90.next=9;return propertyKeyframeDataItem.GetValueWithResultMode();case 9:_iteratorNormalCompletion267=true;_context90.next=5;break;case 12:_context90.next=18;break;case 14:_context90.prev=14;_context90.t0=_context90["catch"](3);_didIteratorError267=true;_iteratorError267=_context90.t0;case 18:_context90.prev=18;_context90.prev=19;if(!_iteratorNormalCompletion267&&_iterator267["return"]!=null){_iterator267["return"]();}case 21:_context90.prev=21;if(!_didIteratorError267){_context90.next=24;break;}throw _iteratorError267;case 24:return _context90.finish(21);case 25:return _context90.finish(18);case 26:case"end":return _context90.stop();}}},GetPropertyKeyframeValues,this,[[3,14,18,26],[19,,21,25]]);})},{key:"GetPropertyKeyframeTimes",value:/*#__PURE__*/regeneratorRuntime.mark(function GetPropertyKeyframeTimes(){var _iteratorNormalCompletion268,_didIteratorError268,_iteratorError268,_iterator268,_step268,propertyKeyframeDataItem;return regeneratorRuntime.wrap(function GetPropertyKeyframeTimes$(_context91){while(1){switch(_context91.prev=_context91.next){case 0:_iteratorNormalCompletion268=true;_didIteratorError268=false;_iteratorError268=undefined;_context91.prev=3;_iterator268=this.GetPropertyKeyframeDataItems()[Symbol.iterator]();case 5:if(_iteratorNormalCompletion268=(_step268=_iterator268.next()).done){_context91.next=12;break;}propertyKeyframeDataItem=_step268.value;_context91.next=9;return propertyKeyframeDataItem.GetTime();case 9:_iteratorNormalCompletion268=true;_context91.next=5;break;case 12:_context91.next=18;break;case 14:_context91.prev=14;_context91.t0=_context91["catch"](3);_didIteratorError268=true;_iteratorError268=_context91.t0;case 18:_context91.prev=18;_context91.prev=19;if(!_iteratorNormalCompletion268&&_iterator268["return"]!=null){_iterator268["return"]();}case 21:_context91.prev=21;if(!_didIteratorError268){_context91.next=24;break;}throw _iteratorError268;case 24:return _context91.finish(21);case 25:return _context91.finish(18);case 26:case"end":return _context91.stop();}}},GetPropertyKeyframeTimes,this,[[3,14,18,26],[19,,21,25]]);})},{key:"TimelineRemoved",value:function TimelineRemoved(){this.GetSourceAdapter().TimelineRemoved();}},{key:"CleanCaches",value:function CleanCaches(){this.GetSourceAdapter().CleanCaches();}},{key:"GetCurrentState",value:function GetCurrentState(){return this.GetSourceAdapter().GetCurrentState();}},{key:"SetResetState",value:function SetResetState(){this.GetSourceAdapter().SetResetState();}},{key:"SetInitialState",value:function SetInitialState(time){this.GetSourceAdapter().SetInitialState();this._lastPropertyKeyframeDataItem=this._GetLastPropertyKeyFrameBeforeTime(time);this._SetUpdateState();}},{key:"SetResumeState",value:function SetResumeState(time){this.GetSourceAdapter().SetResumeState();this._lastPropertyKeyframeDataItem=this._GetLastPropertyKeyFrameBeforeTime(time);}},{key:"_SetUpdateState",value:function _SetUpdateState(){var track=this.GetTrack();this._needsBeforeAndAfter=0;if(track.IsInstanceTrack()){var timeline=this.GetTimeline();var instance=track.GetInstance();var sourceAdapter=this.GetSourceAdapter();var propertyName=this.GetPropertyName();var mayNeedBeforeAndAfterInterpolate=sourceAdapter.MayNeedBeforeAndAfterInterpolate();if(mayNeedBeforeAndAfterInterpolate){var similarPropertyTracks=timeline.GetSimilarPropertyTracks(instance,sourceAdapter,propertyName,this);if(similarPropertyTracks&&similarPropertyTracks.length)this._needsBeforeAndAfter=1;}else this._needsBeforeAndAfter=0;}}},{key:"_GetLastPropertyKeyFrameBeforeTime",value:function _GetLastPropertyKeyFrameBeforeTime(time){var timeline=this.GetTimeline();var propertyKeyframeDataItem=this._propertyTrackData.GetPropertyKeyFrameDataItemAtTime(time,this._propertyTrackDataItem);if(propertyKeyframeDataItem)return propertyKeyframeDataItem;else if(timeline.IsForwardPlayBack())return this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(time,this._propertyTrackDataItem);else return this._propertyTrackData.GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(time,this._propertyTrackDataItem);}},{key:"BeforeInterpolate",value:function BeforeInterpolate(){this._sourceAdapter.BeforeInterpolate();}},{key:"Interpolate",value:function Interpolate(time){var setTime=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var ensureValue=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var endState=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var start;var end;var propertyKeyframeReached=false;if(setTime)start=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(time,this._propertyTrackDataItem);else{if(this._lastPropertyKeyframeDataItem){var timeline=this.GetTimeline();var nextPropertyKeyframe=this._lastPropertyKeyframeDataItem.GetNext();var lastTime=this._lastPropertyKeyframeDataItem.GetTime();var nextTime=nextPropertyKeyframe?nextPropertyKeyframe.GetTime():timeline.GetTotalTime();if(time<=lastTime||time>=nextTime){this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(time,this._propertyTrackDataItem);propertyKeyframeReached=true;}}else{this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(time,this._propertyTrackDataItem);propertyKeyframeReached=true;}start=this._lastPropertyKeyframeDataItem;}if(start)end=start.GetNext();this._sourceAdapter.Interpolate(time,start,end,setTime,ensureValue,endState,propertyKeyframeReached);}},{key:"GetInterpolatedValue",value:function GetInterpolatedValue(time){if(this._lastPropertyKeyframeDataItem){var timeline=this.GetTimeline();var nextPropertyKeyframe=this._lastPropertyKeyframeDataItem.GetNext();var lastTime=this._lastPropertyKeyframeDataItem.GetTime();var nextTime=nextPropertyKeyframe?nextPropertyKeyframe.GetTime():timeline.GetTotalTime();if(time<=lastTime||time>=nextTime)this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(time,this._propertyTrackDataItem);}else this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(time,this._propertyTrackDataItem);var start=this._lastPropertyKeyframeDataItem;var end=start.GetNext();return this._sourceAdapter.GetInterpolatedValue(time,start,end);}},{key:"GetInterpolatedValueFast",value:function GetInterpolatedValueFast(time,start,end){return this._sourceAdapter.GetInterpolatedValue(time,start,end);}},{key:"AfterInterpolate",value:function AfterInterpolate(){this._sourceAdapter.AfterInterpolate();}},{key:"AddPropertyKeyframe",value:function AddPropertyKeyframe(){var propertyKeyframeData=this._propertyTrackDataItem.GetPropertyKeyframeData();var propertyKeyframeDataItem=propertyKeyframeData.AddEmptyPropertyKeyframeDataItem();this._lastPropertyKeyframeDataItem=null;return propertyKeyframeDataItem;}},{key:"DeletePropertyKeyframes",value:function DeletePropertyKeyframes(match){this._lastPropertyKeyframeDataItem=null;var propertyKeyframeData=this._propertyTrackDataItem.GetPropertyKeyframeData();propertyKeyframeData.DeletePropertyKeyframeDataItems(match);}},{key:"SaveState",value:function SaveState(){this.GetSourceAdapter().SaveState();}},{key:"CompareInitialStateWithCurrent",value:function CompareInitialStateWithCurrent(){var difference=this.GetSourceAdapter().CompareInitialStateWithCurrent();if(difference){var propertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyframeDataItem(this._propertyTrackDataItem);var currentState=this.GetSourceAdapter().GetCurrentState();propertyKeyframeDataItem.SetAbsoluteValue(currentState);}}},{key:"CompareSaveStateWithCurrent",value:function CompareSaveStateWithCurrent(){var difference=this.GetSourceAdapter().CompareSaveStateWithCurrent();if(difference)this.AddPropertyKeyframeAtCurrentTime();this.GetSourceAdapter().ClearSaveState();return difference;}},{key:"AddPropertyKeyframeAtCurrentTime",value:function AddPropertyKeyframeAtCurrentTime(){var time=this.GetTimeline().GetTime();var sourceAdapter=this.GetSourceAdapter();var startPropertyKeyframe=_C94.PropertyTrackState.GetStartPropertyKeyframeForTime(time,this);var propertyKeyframeDataItem=this.AddPropertyKeyframe();propertyKeyframeDataItem.SetType(startPropertyKeyframe.GetType());propertyKeyframeDataItem.SetTime(time);propertyKeyframeDataItem.SetEase(startPropertyKeyframe.GetEase());propertyKeyframeDataItem.SetEnable(true);propertyKeyframeDataItem.SetValue(sourceAdapter.GetValueAtTime());propertyKeyframeDataItem.SetAbsoluteValue(sourceAdapter.GetCurrentState());}},{key:"_SaveToJson",value:function _SaveToJson(){return{"sourceAdapterJson":this.GetSourceAdapter()._SaveToJson()};}},{key:"_LoadFromJson",value:function _LoadFromJson(o){if(!o)return;this.GetSourceAdapter()._LoadFromJson(o["sourceAdapterJson"]);}}],[{key:"Create",value:function Create(track,propertyTrackDataItem){return _C94.New(_C94.PropertyTrackState,track,propertyTrackDataItem);}},{key:"GetStartPropertyKeyframeForTime",value:function GetStartPropertyKeyframeForTime(time,propertyTrack){var propertyTrackDataItem=propertyTrack.GetPropertyTrackDataItem();var propertyTrackData=propertyTrack._propertyTrackData;return propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(time,propertyTrackDataItem);}},{key:"GetEndPropertyKeyframeForTime",value:function GetEndPropertyKeyframeForTime(time,propertyTrack){var propertyTrackDataItem=propertyTrack.GetPropertyTrackDataItem();var propertyTrackData=propertyTrack._propertyTrackData;return propertyTrackData.GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(time,propertyTrackDataItem);}}]);return PropertyTrack;}(_C94.DefendedBase);}// timelines/state/propertySourceAdapters/propertySourceAdapter.js
{'use strict';var _C95=self.C3;var NS=_C95.PropertyTrackState;NS.PropertySourceAdapter=/*#__PURE__*/function(){function PropertySourceAdapter(propertyTrack){_classCallCheck(this,PropertySourceAdapter);this._propertyTrack=propertyTrack;this._propertyAdapter=null;this.GetPropertyAdapter();}_createClass(PropertySourceAdapter,[{key:"Release",value:function Release(){if(this._propertyAdapter){this._propertyAdapter.Release();this._propertyAdapter=null;}this._propertyTrack=null;}},{key:"MayNeedBeforeAndAfterInterpolate",value:function MayNeedBeforeAndAfterInterpolate(){return this._propertyAdapter.MayNeedBeforeAndAfterInterpolate();}},{key:"GetPropertyTrack",value:function GetPropertyTrack(){return this._propertyTrack;}},{key:"TimelineRemoved",value:function TimelineRemoved(){if(this._propertyAdapter)this._propertyAdapter.TimelineRemoved();}},{key:"CleanCaches",value:function CleanCaches(){if(this._propertyAdapter)this._propertyAdapter.CleanCaches();}},{key:"GetPropertyAdapter",value:function GetPropertyAdapter(){if(this._propertyAdapter)return this._propertyAdapter;this._propertyAdapter=this._CreatePropertyAdapter();return this._propertyAdapter;}},{key:"GetEditorIndex",value:function GetEditorIndex(){}},{key:"GetIndex",value:function GetIndex(){return this.GetEditorIndex();}},{key:"GetTarget",value:function GetTarget(){}},{key:"SetResetState",value:function SetResetState(){this.GetPropertyAdapter().SetResetState();}},{key:"SetInitialState",value:function SetInitialState(){this.GetPropertyAdapter().SetInitialState();}},{key:"SetResumeState",value:function SetResumeState(){this.GetPropertyAdapter().SetResumeState();}},{key:"BeforeInterpolate",value:function BeforeInterpolate(){this._propertyAdapter.BeforeChangeProperty();}},{key:"Interpolate",value:function Interpolate(time,start,end,setTime,ensureValue,endState,propertyKeyframeReached){var type=this._propertyTrack.GetPropertyKeyframeType();var value;switch(type){case"numeric":{value=NS.NumericTypeAdapter.Interpolate(time,start,end,this._propertyTrack);break;}case"angle":{value=NS.AngleTypeAdapter.Interpolate(time,start,end,this._propertyTrack);break;}case"boolean":{value=NS.BooleanTypeAdapter.Interpolate(time,start,end,this._propertyTrack);break;}case"color":{value=NS.ColorTypeAdapter.Interpolate(time,start,end,this._propertyTrack);break;}case"text":{value=NS.TextTypeAdapter.Interpolate(time,start,end,this._propertyTrack);break;}}this._propertyAdapter.ChangeProperty(time,value,start,end,setTime,ensureValue,endState,propertyKeyframeReached);}},{key:"GetInterpolatedValue",value:function GetInterpolatedValue(time,start,end){switch(this._propertyTrack.GetPropertyKeyframeType()){case"numeric":return NS.NumericTypeAdapter.Interpolate(time,start,end,this._propertyTrack);case"angle":return NS.AngleTypeAdapter.Interpolate(time,start,end,this._propertyTrack);case"boolean":return NS.BooleanTypeAdapter.Interpolate(time,start,end,this._propertyTrack);case"color":return NS.ColorTypeAdapter.Interpolate(time,start,end,this._propertyTrack);case"text":return NS.TextTypeAdapter.Interpolate(time,start,end,this._propertyTrack);}}},{key:"AfterInterpolate",value:function AfterInterpolate(){this._propertyAdapter.AfterChangeProperty();}},{key:"SaveState",value:function SaveState(){this.GetPropertyAdapter().SetSaveState();}},{key:"ClearSaveState",value:function ClearSaveState(){this.GetPropertyAdapter().ClearSaveState();}},{key:"GetCurrentState",value:function GetCurrentState(){return this.GetPropertyAdapter().GetCurrentState();}},{key:"CompareInitialStateWithCurrent",value:function CompareInitialStateWithCurrent(){return this.GetPropertyAdapter().CompareInitialStateWithCurrent();}},{key:"CompareSaveStateWithCurrent",value:function CompareSaveStateWithCurrent(){return this.GetPropertyAdapter().CompareSaveStateWithCurrent();}},{key:"GetValueAtTime",value:function GetValueAtTime(){var propertyTrack=this._propertyTrack;var track=propertyTrack.GetTrack();var time=track.GetTimeline().GetTime();var start=NS.GetStartPropertyKeyframeForTime(time,propertyTrack);var end=start.GetNext();var type=propertyTrack.GetPropertyKeyframeType();switch(type){case"numeric":{return NS.NumericTypeAdapter.Interpolate(time,start,end,propertyTrack);}case"angle":{return NS.AngleTypeAdapter.Interpolate(time,start,end,propertyTrack);}case"boolean":{return NS.BooleanTypeAdapter.Interpolate(time,start,end,propertyTrack);}case"color":{return NS.ColorTypeAdapter.Interpolate(time,start,end,propertyTrack);}case"text":{return NS.TextTypeAdapter.Interpolate(time,start,end,propertyTrack);}}}},{key:"_CreatePropertyAdapter",value:function _CreatePropertyAdapter(){var pt=this._propertyTrack;var type=pt.CanHavePropertyKeyframes()?pt.GetPropertyKeyframeType():"";switch(type){case"combo":case"boolean":case"text":case"string":{return new NS.PropertyInterpolationAdapter.NoInterpolationAdapter(this);}case"numeric":case"number":case"angle":{if(this._propertyTrack.GetPropertyType()==="combo")return new NS.PropertyInterpolationAdapter.NoInterpolationAdapter(this);return new NS.PropertyInterpolationAdapter.NumericInterpolationAdapter(this);}case"color":case"offsetColor":{return new NS.PropertyInterpolationAdapter.ColorInterpolationAdapter(this);}default:{return new NS.PropertyInterpolationAdapter.NumericInterpolationAdapter(this);}}}},{key:"_SaveToJson",value:function _SaveToJson(){return{"propertyAdapterJson":this.GetPropertyAdapter()._SaveToJson()};}},{key:"_LoadFromJson",value:function _LoadFromJson(o){if(!o)return;this.GetPropertyAdapter()._LoadFromJson(o["propertyAdapterJson"]);}}]);return PropertySourceAdapter;}();}// timelines/state/propertySourceAdapters/instanceVariableSourceAdapter.js
{'use strict';var _C96=self.C3;var INDEX=0;var InstanceVariableSourceAdapter=/*#__PURE__*/function(_C96$PropertyTrackSta){_inherits(InstanceVariableSourceAdapter,_C96$PropertyTrackSta);function InstanceVariableSourceAdapter(propertyTrack){var _this52;_classCallCheck(this,InstanceVariableSourceAdapter);_this52=_possibleConstructorReturn(this,_getPrototypeOf(InstanceVariableSourceAdapter).call(this,propertyTrack));_this52._updatedIndex=NaN;return _this52;}_createClass(InstanceVariableSourceAdapter,[{key:"GetEditorIndex",value:function GetEditorIndex(){return this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[INDEX];}},{key:"GetIndex",value:function GetIndex(){if(this._updatedIndex)return this._updatedIndex;return _get(_getPrototypeOf(InstanceVariableSourceAdapter.prototype),"GetIndex",this).call(this);}},{key:"GetTarget",value:function GetTarget(){return this._propertyTrack.GetTrack().GetInstance();}},{key:"UpdateInstanceVariableIndex",value:function UpdateInstanceVariableIndex(index){var i=this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[INDEX];if(i===index)return;this._updatedIndex=index;}},{key:"Interpolate",value:function Interpolate(time,start,end,setTime,ensureValue,endState,propertyKeyframeReached){if(!this.GetPropertyAdapter().CanChange(start.GetValue()))return;_get(_getPrototypeOf(InstanceVariableSourceAdapter.prototype),"Interpolate",this).call(this,time,start,end,setTime,ensureValue,endState,propertyKeyframeReached);}},{key:"GetInterpolatedValue",value:function GetInterpolatedValue(time,start,end){if(!this.GetPropertyAdapter().CanChange(start.GetValue()))return;return _get(_getPrototypeOf(InstanceVariableSourceAdapter.prototype),"GetInterpolatedValue",this).call(this,time,start,end);}},{key:"_SaveToJson",value:function _SaveToJson(){return Object.assign(_get(_getPrototypeOf(InstanceVariableSourceAdapter.prototype),"_SaveToJson",this).call(this),{"index":this._updatedIndex});}},{key:"_LoadFromJson",value:function _LoadFromJson(o){if(!o)return;_get(_getPrototypeOf(InstanceVariableSourceAdapter.prototype),"_LoadFromJson",this).call(this,o);this._updatedIndex=o["index"];}}]);return InstanceVariableSourceAdapter;}(_C96.PropertyTrackState.PropertySourceAdapter);_C96.PropertyTrackState.InstanceVariableSourceAdapter=InstanceVariableSourceAdapter;}// timelines/state/propertySourceAdapters/behaviorSourceAdapter.js
{'use strict';var _C97=self.C3;var SID=0;var _INDEX=1;var NAME=2;var BehaviorSourceAdapter=/*#__PURE__*/function(_C97$PropertyTrackSta){_inherits(BehaviorSourceAdapter,_C97$PropertyTrackSta);function BehaviorSourceAdapter(propertyTrack){var _this53;_classCallCheck(this,BehaviorSourceAdapter);_this53=_possibleConstructorReturn(this,_getPrototypeOf(BehaviorSourceAdapter).call(this,propertyTrack));_this53._sid=NaN;return _this53;}_createClass(BehaviorSourceAdapter,[{key:"GetEditorIndex",value:function GetEditorIndex(){var dataItem=this._propertyTrack.GetPropertyTrackDataItem();return dataItem.GetSourceAdapterArguments()[_INDEX];}},{key:"GetTarget",value:function GetTarget(){var dataItem=this._propertyTrack.GetPropertyTrackDataItem();var track=this._propertyTrack.GetTrack();var sid=this._sid?this._sid:dataItem.GetSourceAdapterArguments()[SID];var instance=track.GetInstance();var index=instance.GetBehaviorIndexBySID(sid);var behaviorInstance=instance.GetBehaviorInstances()[index];return behaviorInstance.GetSdkInstance();}},{key:"GetBehaviorType",value:function GetBehaviorType(objectClass){var dataItem=this._propertyTrack.GetPropertyTrackDataItem();var name=dataItem.GetSourceAdapterArguments()[NAME];return objectClass.GetBehaviorTypeByName(name);}},{key:"UpdateBehaviorTypeSid",value:function UpdateBehaviorTypeSid(sid){var dataItem=this._propertyTrack.GetPropertyTrackDataItem();if(dataItem.GetSourceAdapterArguments()[SID]===sid)return;this._sid=sid;}},{key:"Interpolate",value:function Interpolate(time,start,end,setTime,ensureValue,endState,propertyKeyframeReached){var track=this._propertyTrack.GetTrack();var instance=track.GetInstance();if(!this.GetBehaviorType(instance.GetObjectClass()))return;_get(_getPrototypeOf(BehaviorSourceAdapter.prototype),"Interpolate",this).call(this,time,start,end,setTime,ensureValue,endState,propertyKeyframeReached);}},{key:"GetInterpolatedValue",value:function GetInterpolatedValue(time,start,end){var track=this._propertyTrack.GetTrack();var instance=track.GetInstance();if(!this.GetBehaviorType(instance.GetObjectClass()))return;return _get(_getPrototypeOf(BehaviorSourceAdapter.prototype),"GetInterpolatedValue",this).call(this,time,start,end);}},{key:"_SaveToJson",value:function _SaveToJson(){return Object.assign(_get(_getPrototypeOf(BehaviorSourceAdapter.prototype),"_SaveToJson",this).call(this),{"sid":this._sid});}},{key:"_LoadFromJson",value:function _LoadFromJson(o){if(!o)return;_get(_getPrototypeOf(BehaviorSourceAdapter.prototype),"_LoadFromJson",this).call(this,o);this._sid=o["sid"];}}]);return BehaviorSourceAdapter;}(_C97.PropertyTrackState.PropertySourceAdapter);_C97.PropertyTrackState.BehaviorSourceAdapter=BehaviorSourceAdapter;}// timelines/state/propertySourceAdapters/effectSourceAdapter.js
{'use strict';var _C98=self.C3;var _NAME=0;var _INDEX2=1;var EffectSourceAdapter=/*#__PURE__*/function(_C98$PropertyTrackSta){_inherits(EffectSourceAdapter,_C98$PropertyTrackSta);function EffectSourceAdapter(propertyTrack){_classCallCheck(this,EffectSourceAdapter);return _possibleConstructorReturn(this,_getPrototypeOf(EffectSourceAdapter).call(this,propertyTrack));}_createClass(EffectSourceAdapter,[{key:"GetEditorIndex",value:function GetEditorIndex(){return this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[_INDEX2];}},{key:"GetTarget",value:function GetTarget(){var pTrack=this._propertyTrack;var track=pTrack.GetTrack();var worldInfo=track.GetWorldInfo();var instanceEffectList=worldInfo.GetInstanceEffectList();var effectList=instanceEffectList.GetEffectList();var effectType=this.GetEffectType(effectList);var effectIndex=effectType.GetIndex();if(instanceEffectList.IsEffectIndexActive(effectIndex))return instanceEffectList.GetEffectParametersForIndex(effectIndex);return null;}},{key:"GetEffectType",value:function GetEffectType(effectList){var pTrack=this._propertyTrack;var name=pTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[_NAME];return effectList.GetEffectTypeByName(name);}},{key:"Interpolate",value:function Interpolate(time,start,end,setTime,ensureValue,endState,propertyKeyframeReached){if(!this._IsEffectActive())return;_get(_getPrototypeOf(EffectSourceAdapter.prototype),"Interpolate",this).call(this,time,start,end,setTime,ensureValue,endState,propertyKeyframeReached);}},{key:"GetInterpolatedValue",value:function GetInterpolatedValue(time,start,end){if(!this._IsEffectActive())return;return _get(_getPrototypeOf(EffectSourceAdapter.prototype),"GetInterpolatedValue",this).call(this,time,start,end);}},{key:"_IsEffectActive",value:function _IsEffectActive(){var pTrack=this._propertyTrack;var track=pTrack.GetTrack();var worldInfo=track.GetWorldInfo();var instanceEffectList=worldInfo.GetInstanceEffectList();var effectList=instanceEffectList.GetEffectList();var effectType=this.GetEffectType(effectList);if(!effectType)return;var effectIndex=effectType.GetIndex();return instanceEffectList.IsEffectIndexActive(effectIndex);}}]);return EffectSourceAdapter;}(_C98.PropertyTrackState.PropertySourceAdapter);_C98.PropertyTrackState.EffectSourceAdapter=EffectSourceAdapter;}// timelines/state/propertySourceAdapters/pluginSourceAdapter.js
{'use strict';var _C99=self.C3;var _INDEX3=0;var PluginSourceAdapter=/*#__PURE__*/function(_C99$PropertyTrackSta){_inherits(PluginSourceAdapter,_C99$PropertyTrackSta);function PluginSourceAdapter(propertyTrack){_classCallCheck(this,PluginSourceAdapter);return _possibleConstructorReturn(this,_getPrototypeOf(PluginSourceAdapter).call(this,propertyTrack));}_createClass(PluginSourceAdapter,[{key:"GetEditorIndex",value:function GetEditorIndex(){return this._propertyTrack.GetPropertyTrackDataItem().GetSourceAdapterArguments()[_INDEX3];}},{key:"GetTarget",value:function GetTarget(){return this._propertyTrack.GetTrack().GetInstance().GetSdkInstance();}},{key:"Interpolate",value:function Interpolate(time,start,end,setTime,ensureValue,endState,propertyKeyframeReached){var track=this._propertyTrack.GetTrack();var templatePlugin=track.GetObjectClass().GetPlugin();var currentPlugin=track.GetInstance().GetObjectClass().GetPlugin();if(templatePlugin!==currentPlugin)return;_get(_getPrototypeOf(PluginSourceAdapter.prototype),"Interpolate",this).call(this,time,start,end,setTime,ensureValue,endState,propertyKeyframeReached);}},{key:"GetInterpolatedValue",value:function GetInterpolatedValue(time,start,end){var track=this._propertyTrack.GetTrack();var templatePlugin=track.GetObjectClass().GetPlugin();var currentPlugin=track.GetInstance().GetObjectClass().GetPlugin();if(templatePlugin!==currentPlugin)return;return _get(_getPrototypeOf(PluginSourceAdapter.prototype),"GetInterpolatedValue",this).call(this,time,start,end);}},{key:"GetOptionalCallbacks",value:function GetOptionalCallbacks(){var track=this._propertyTrack.GetTrack();var plugin=track.GetObjectClass().GetPlugin();if(_C99.Plugins.Sprite&&plugin instanceof _C99.Plugins.Sprite)if(this._propertyTrack.GetPropertyName()==="initial-frame"||this._propertyTrack.GetPropertyName()==="initial-animation")switch(this._propertyTrack.GetResultMode()){case"relative":{return null;}case"absolute":{return null;}}}}]);return PluginSourceAdapter;}(_C99.PropertyTrackState.PropertySourceAdapter);_C99.PropertyTrackState.PluginSourceAdapter=PluginSourceAdapter;}// timelines/state/propertySourceAdapters/valueSourceAdapter.js
{'use strict';var _C100=self.C3;var ValueSourceAdapter=/*#__PURE__*/function(_C100$PropertyTrackSt){_inherits(ValueSourceAdapter,_C100$PropertyTrackSt);function ValueSourceAdapter(propertyTrack){var _this54;_classCallCheck(this,ValueSourceAdapter);_this54=_possibleConstructorReturn(this,_getPrototypeOf(ValueSourceAdapter).call(this,propertyTrack));_this54._value=0;_this54._init=false;return _this54;}_createClass(ValueSourceAdapter,[{key:"MayNeedBeforeAndAfterInterpolate",value:function MayNeedBeforeAndAfterInterpolate(){return false;}},{key:"SetInitialState",value:function SetInitialState(){var propertyTrackData=this._propertyTrack.GetPropertyTrackData();var propertyTrackDataItem=this._propertyTrack.GetPropertyTrackDataItem();propertyTrackDataItem=propertyTrackData.GetFirstPropertyKeyframeDataItem(propertyTrackDataItem);this._value=propertyTrackDataItem.GetValueWithResultMode();}},{key:"SetResumeState",value:function SetResumeState(){}},{key:"GetValue",value:function GetValue(){if(!this._init)this._propertyTrack.Interpolate(0);return this._value;}},{key:"Interpolate",value:function Interpolate(time,start,end,setTime,ensureValue,endState,propertyKeyframeReached){this._value=_C100.PropertyTrackState.NumericTypeAdapter.Interpolate(time,start,end,this._propertyTrack);this._init=true;}},{key:"SaveState",value:function SaveState(){}},{key:"ClearSaveState",value:function ClearSaveState(){}},{key:"GetCurrentState",value:function GetCurrentState(){return this._value;}},{key:"CompareInitialStateWithCurrent",value:function CompareInitialStateWithCurrent(){return false;}},{key:"CompareSaveStateWithCurrent",value:function CompareSaveStateWithCurrent(){return false;}},{key:"_SaveToJson",value:function _SaveToJson(){return{"value":this._value,"init":this._init};}},{key:"_LoadFromJson",value:function _LoadFromJson(o){if(!o)return;this._value=o["value"];this._init=o.hasOwnProperty("init")?o["init"]:true;}}]);return ValueSourceAdapter;}(_C100.PropertyTrackState.PropertySourceAdapter);_C100.PropertyTrackState.ValueSourceAdapter=ValueSourceAdapter;}// timelines/state/propertySourceAdapters/audioSourceAdapter.js
{'use strict';var _C101=self.C3;var PROJECT_FILE=0;var PROJECT_FILE_NAME=0;var PROJECT_FILE_TYPE=1;var START_OFFSET=1;var AUDIO_DURATION=2;var AUDIO_TAG=3;var AudioSourceAdapter=/*#__PURE__*/function(_C101$PropertyTrackSt){_inherits(AudioSourceAdapter,_C101$PropertyTrackSt);function AudioSourceAdapter(propertyTrack){var _this55;_classCallCheck(this,AudioSourceAdapter);_this55=_possibleConstructorReturn(this,_getPrototypeOf(AudioSourceAdapter).call(this,propertyTrack));_this55._audioPlaybackStarted=false;_this55._sdkInstance=null;_this55._actions=null;_this55._expressions=null;_this55._timeline=_this55._propertyTrack.GetTimeline();_this55._track=_this55._propertyTrack.GetTrack();_this55._sourceAdapterArgs=_this55._propertyTrack.GetSourceAdapterArgs();_this55._fileArgs=_this55._sourceAdapterArgs[PROJECT_FILE];_this55._startOffsetTime=_this55._sourceAdapterArgs[START_OFFSET];if(_this55._sourceAdapterArgs[AUDIO_TAG])_this55._audioTag=_this55._sourceAdapterArgs[AUDIO_TAG];else _this55._audioTag=Math.random().toString(36).slice(2);_this55._pauseTime=NaN;_this55._pauseVolume=NaN;_this55._volume=NaN;_this55._audioSource=null;_this55._Initialize();return _this55;}_createClass(AudioSourceAdapter,[{key:"Release",value:function Release(){_get(_getPrototypeOf(AudioSourceAdapter.prototype),"Release",this).call(this);this._sdkInstance=null;this._actions=null;this._expressions=null;this._timeline=null;this._track=null;this._sourceAdapterArgs=null;this._fileArgs=null;this._audioSource=null;}},{key:"_Initialize",value:function _Initialize(){if(!self.C3.Plugins.Audio)return;var runtime=this._propertyTrack.GetRuntime();var audioObjectClass=runtime.GetSingleGlobalObjectClassByCtor(self.C3.Plugins.Audio);if(audioObjectClass)this._sdkInstance=audioObjectClass.GetSingleGlobalInstance().GetSdkInstance();this._actions=self.C3.Plugins.Audio.Acts;this._expressions=self.C3.Plugins.Audio.Exps;}},{key:"_MaybeSetAudioSource",value:function _MaybeSetAudioSource(){if(this._audioSource)return;var track=this._propertyTrack.GetTrack();var audioSourcePropertyTrack=track.GetPropertyTrack("audioSource");if(audioSourcePropertyTrack)this._audioSource=audioSourcePropertyTrack.GetSourceAdapter();}},{key:"_GetPauseVolume",value:function _GetPauseVolume(){var track=this._propertyTrack.GetTrack();var volumePropertyTrack=track.GetPropertyTrack("volume");if(volumePropertyTrack)return volumePropertyTrack.GetSourceAdapter()._pauseVolume;else return this._pauseVolume;}},{key:"TimelineRemoved",value:function TimelineRemoved(){_get(_getPrototypeOf(AudioSourceAdapter.prototype),"TimelineRemoved",this).call(this);this._audioPlaybackStarted=false;if(this._sdkInstance){if(this._expressions){this._pauseTime=this._expressions.PlaybackTime.call(this._sdkInstance,this._audioTag);this._pauseVolume=this._expressions.Volume.call(this._sdkInstance,this._audioTag);}if(this._actions)this._actions.Stop.call(this._sdkInstance,this._audioTag);}}},{key:"GetAudioTag",value:function GetAudioTag(){return this._audioTag;}},{key:"GetVolume",value:function GetVolume(){return this._volume;}},{key:"SetVolume",value:function SetVolume(v){this._volume=v;}},{key:"SetInitialState",value:function SetInitialState(){_get(_getPrototypeOf(AudioSourceAdapter.prototype),"SetInitialState",this).call(this);this._pauseTime=NaN;this._audioPlaybackStarted=false;}},{key:"SetResumeState",value:function SetResumeState(){_get(_getPrototypeOf(AudioSourceAdapter.prototype),"SetResumeState",this).call(this);var timeline=this._propertyTrack.GetTimeline();var time=timeline.GetTime();this._pauseTime=time-this._startOffsetTime;switch(this._propertyTrack.GetPropertyName()){case"audioSource":{break;}case"volume":{this._pauseVolume=this._propertyTrack.GetInterpolatedValue(time);break;}}this._audioPlaybackStarted=false;}},{key:"Interpolate",value:function Interpolate(time,start,end,setTime,ensureValue,endState,propertyKeyframeReached){if(!this._sdkInstance)return;switch(this._propertyTrack.GetPropertyName()){case"audioSource":{if(!this._timeline.IsForwardPlayBack())return;if(setTime){if(this._actions)this._actions.Stop.call(this._sdkInstance,this._audioTag);return;}if(time<this._startOffsetTime){this._audioPlaybackStarted=false;return;}var aPlaybackRate=this._expressions.PlaybackRate.call(this._sdkInstance,this._audioTag);var tPlaybackRate=this._timeline.GetPlaybackRate();if(tPlaybackRate!==aPlaybackRate)this._actions.SetPlaybackRate.call(this._sdkInstance,this._audioTag,tPlaybackRate);if(this._audioPlaybackStarted)return;if(!this._propertyTrack.GetTimeline().IsPlaying())return;this._audioPlaybackStarted=true;if(isNaN(this._pauseTime)){var thenTime=self["performance"].now();var startDeltaTime=time-this._startOffsetTime;var state=this._sdkInstance.GetAudioContextState();if(state==="suspended"){this._audioPlaybackStarted=false;return;}var nowTime=self["performance"].now();var postToDOMDeltaTime=(nowTime-thenTime)/1E3;var startPlaybackOffset=startDeltaTime+postToDOMDeltaTime;if(this._actions){var startVolume=this.GetVolume();if(isNaN(startVolume)){this.SetVolume(0);startVolume=0;}else this.SetVolume(startVolume);this._actions.PlayFromTimeline.call(this._sdkInstance,this._fileArgs,startVolume,this._audioTag,startPlaybackOffset);}}else{var startTime=this._pauseTime;this._pauseTime=NaN;var _startVolume=this._GetPauseVolume();this._pauseVolume=NaN;var _state=this._sdkInstance.GetAudioContextState();if(_state==="suspended"){this._audioPlaybackStarted=false;return;}if(this._actions){this.SetVolume(_startVolume);this._actions.PlayFromTimeline.call(this._sdkInstance,this._fileArgs,_startVolume,this._audioTag,startTime);}}break;}case"volume":{this._MaybeSetAudioSource();_get(_getPrototypeOf(AudioSourceAdapter.prototype),"Interpolate",this).call(this,time,start,end,setTime,ensureValue,endState,propertyKeyframeReached);}}}},{key:"GetInterpolatedValue",value:function GetInterpolatedValue(time,start,end){if(!this._sdkInstance)return;switch(this._propertyTrack.GetPropertyName()){case"audioSource":{return;}case"volume":{this._MaybeSetAudioSource();return _get(_getPrototypeOf(AudioSourceAdapter.prototype),"GetInterpolatedValue",this).call(this,time,start,end);}}}},{key:"Getter",value:function Getter(wi,track){if(this._audioSource)return this._audioSource.GetVolume();return 0;}},{key:"Setter",value:function Setter(wi,value,track,interpolationAdapter){if(this._audioSource)this._audioSource.SetVolume(this.Getter()+value);if(this._actions&&this._audioSource)this._actions.SetVolume.call(this._sdkInstance,this._audioSource.GetAudioTag(),this._audioSource.GetVolume());}},{key:"AbsoluteSetter",value:function AbsoluteSetter(wi,value,track){if(this._audioSource)this._audioSource.SetVolume(value);if(this._actions&&this._audioSource)this._actions.SetVolume.call(this._sdkInstance,this._audioSource.GetAudioTag(),this._audioSource.GetVolume());}},{key:"DoesRounding",value:function DoesRounding(){return true;}},{key:"_SaveToJson",value:function _SaveToJson(){return{"audioPlaybackStarted":this._audioPlaybackStarted,"audioTag":this._audioTag,"pauseTime":this._pauseTime,"pauseVolume":this._pauseVolume,"volume":this._volume};}},{key:"_LoadFromJson",value:function _LoadFromJson(o){if(!o)return;this._audioPlaybackStarted=o["audioPlaybackStarted"];this._audioTag=o["audioTag"];this._pauseTime=o["pauseTime"];this._pauseVolume=o["pauseVolume"];this._volume=o["volume"];this._Initialize();}}]);return AudioSourceAdapter;}(_C101.PropertyTrackState.PropertySourceAdapter);_C101.PropertyTrackState.AudioSourceAdapter=AudioSourceAdapter;}// timelines/state/propertyInterpolationAdapters/propertyInterpolationAdapter.js
{'use strict';var _C102=self.C3;_C102.PropertyTrackState.PropertyInterpolationAdapter=/*#__PURE__*/function(){function PropertyInterpolationAdapter(sourceAdapter){_classCallCheck(this,PropertyInterpolationAdapter);this._sourceAdapter=sourceAdapter;this._propertyTrack=sourceAdapter.GetPropertyTrack();this._worldInfo=this._propertyTrack.GetTrack().GetWorldInfo();this._property=this._propertyTrack.GetPropertyName();this._firstAbsoluteUpdate=false;this._saveState=null;this._target=null;}_createClass(PropertyInterpolationAdapter,[{key:"Release",value:function Release(){this._sourceAdapter=null;this._propertyTrack=null;this._worldInfo=null;this._saveState=null;this._target=null;}},{key:"MayNeedBeforeAndAfterInterpolate",value:function MayNeedBeforeAndAfterInterpolate(){return false;}},{key:"TimelineRemoved",value:function TimelineRemoved(){}},{key:"CleanCaches",value:function CleanCaches(){this._worldInfo=null;this._saveState=null;this._target=null;}},{key:"GetSourceAdapter",value:function GetSourceAdapter(){return this._sourceAdapter;}},{key:"GetPropertyTrack",value:function GetPropertyTrack(){return this._propertyTrack;}},{key:"GetWorldInfo",value:function GetWorldInfo(){if(this._worldInfo)return this._worldInfo;this._worldInfo=this._propertyTrack.GetTrack().GetWorldInfo();return this._worldInfo;}},{key:"SetFirstAbsoluteUpdate",value:function SetFirstAbsoluteUpdate(f){this._firstAbsoluteUpdate=!!f;}},{key:"GetFirstAbsoluteUpdate",value:function GetFirstAbsoluteUpdate(){return this._firstAbsoluteUpdate;}},{key:"SetResetState",value:function SetResetState(){}},{key:"SetInitialState",value:function SetInitialState(){}},{key:"SetResumeState",value:function SetResumeState(){}},{key:"SetSaveState",value:function SetSaveState(){this._saveState=this.GetCurrentState();}},{key:"ClearSaveState",value:function ClearSaveState(){this._saveState=null;}},{key:"GetCurrentState",value:function GetCurrentState(){}},{key:"CompareInitialStateWithCurrent",value:function CompareInitialStateWithCurrent(){}},{key:"CompareSaveStateWithCurrent",value:function CompareSaveStateWithCurrent(){}},{key:"CanChange",value:function CanChange(value){var targetType=_typeof(this._Getter());var newType=_typeof(value);return targetType===newType;}},{key:"BeforeChangeProperty",value:function BeforeChangeProperty(){}},{key:"ChangeProperty",value:function ChangeProperty(time,value,start,end,setTime,ensureValue,endState,propertyKeyframeReached){}},{key:"AfterChangeProperty",value:function AfterChangeProperty(){}},{key:"_FirstKeyframeGetter",value:function _FirstKeyframeGetter(){var _this56=this;var propertyKeyframeDataItem=this._PickTimelinePlaybackMode(function(){var propertyTrackDataItem=_this56._propertyTrack.GetPropertyTrackDataItem();var propertyTrackData=_this56._propertyTrack.GetPropertyTrackData();return propertyTrackData.GetFirstPropertyKeyframeDataItem(propertyTrackDataItem);},function(){var propertyTrackDataItem=_this56._propertyTrack.GetPropertyTrackDataItem();var propertyTrackData=_this56._propertyTrack.GetPropertyTrackData();return propertyTrackData.GetLastPropertyKeyframeDataItem(propertyTrackDataItem);});return propertyKeyframeDataItem.GetAbsoluteValue();}},{key:"_CurrentKeyframeGetter",value:function _CurrentKeyframeGetter(){var _this57=this;var timeline=this._propertyTrack.GetTimeline();var time=timeline.GetTime()-this._propertyTrack.GetTrack().GetStartOffset();var propertyKeyframe=this._PickTimelinePlaybackMode(function(){var propertyTrackDataItem=_this57._propertyTrack.GetPropertyTrackDataItem();var propertyTrackData=_this57._propertyTrack.GetPropertyTrackData();return propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(time,propertyTrackDataItem);},function(){var propertyTrackDataItem=_this57._propertyTrack.GetPropertyTrackDataItem();var propertyTrackData=_this57._propertyTrack.GetPropertyTrackData();var ret=propertyTrackData.GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(time,propertyTrackDataItem);if(!ret)return propertyTrackData.GetLastPropertyKeyframeDataItem(propertyTrackDataItem);return ret;});return propertyKeyframe.GetAbsoluteValue();}},{key:"_PickTimelinePlaybackMode",value:function _PickTimelinePlaybackMode(forwardFunc,backwardFunc){var timeline=this._propertyTrack.GetTimeline();return timeline.IsForwardPlayBack()?forwardFunc():backwardFunc();}},{key:"_PickResultMode",value:function _PickResultMode(relativeFunc,absoluteFunc){var resultMode=this._propertyTrack.GetResultMode();return resultMode==="relative"?relativeFunc():absoluteFunc();}},{key:"_PickFirstAbsoluteUpdate",value:function _PickFirstAbsoluteUpdate(firstFunc,otherFunc){if(this.GetFirstAbsoluteUpdate()){this.SetFirstAbsoluteUpdate(false);return firstFunc();}else return otherFunc();}},{key:"_GetAbsoluteInitialValue",value:function _GetAbsoluteInitialValue(keyframeValue){}},{key:"_GetIndex",value:function _GetIndex(){return this._sourceAdapter.GetIndex();}},{key:"_GetTarget",value:function _GetTarget(){if(this._target)return this._target;this._target=this._sourceAdapter.GetTarget();return this._target;}},{key:"_PickSource",value:function _PickSource(bFunc,eFunc,ivFunc,pFunc,wiFunc,aFunc){var id=this._propertyTrack.GetSourceAdapterId();switch(id){case"behavior":return bFunc();case"effect":return eFunc();case"instance-variable":return ivFunc();case"plugin":return pFunc();case"world-instance":return wiFunc();case"audio":return aFunc();}}},{key:"_SaveToJson",value:function _SaveToJson(){return{"firstAbsoluteUpdate":this._firstAbsoluteUpdate,"saveState":this._saveState};}},{key:"_LoadFromJson",value:function _LoadFromJson(o){if(!o)return;this._firstAbsoluteUpdate=o["firstAbsoluteUpdate"];this._saveState=o["saveState"];}},{key:"_GetPropertyKeyframeStubs",value:function _GetPropertyKeyframeStubs(propertyTracks){var firstOnly=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var ret=[];var _iteratorNormalCompletion269=true;var _didIteratorError269=false;var _iteratorError269=undefined;try{for(var _iterator269=propertyTracks[Symbol.iterator](),_step269;!(_iteratorNormalCompletion269=(_step269=_iterator269.next()).done);_iteratorNormalCompletion269=true){var propertyTrack=_step269.value;var startOffset=propertyTrack.GetTrack().GetStartOffset();var _iteratorNormalCompletion270=true;var _didIteratorError270=false;var _iteratorError270=undefined;try{for(var _iterator270=propertyTrack.GetPropertyKeyframeDataItems()[Symbol.iterator](),_step270;!(_iteratorNormalCompletion270=(_step270=_iterator270.next()).done);_iteratorNormalCompletion270=true){var propertyKeyframeDataItem=_step270.value;if(firstOnly&&propertyKeyframeDataItem.GetTime()===0)ret.push({time:startOffset+propertyKeyframeDataItem.GetTime(),value:propertyKeyframeDataItem.GetAbsoluteValue()});else if(!firstOnly)ret.push({time:startOffset+propertyKeyframeDataItem.GetTime(),value:propertyKeyframeDataItem.GetAbsoluteValue()});}}catch(err){_didIteratorError270=true;_iteratorError270=err;}finally{try{if(!_iteratorNormalCompletion270&&_iterator270["return"]!=null){_iterator270["return"]();}}finally{if(_didIteratorError270){throw _iteratorError270;}}}}}catch(err){_didIteratorError269=true;_iteratorError269=err;}finally{try{if(!_iteratorNormalCompletion269&&_iterator269["return"]!=null){_iterator269["return"]();}}finally{if(_didIteratorError269){throw _iteratorError269;}}}return ret.sort(function(f,s){return f.time-s.time;});}},{key:"_GetLastPropertyKeyframeStub",value:function _GetLastPropertyKeyframeStub(timeline,time,propertyKeyframeStubs){return this._GetPropertyKeyframeStubLowerThanPlayhead(time,propertyKeyframeStubs);}},{key:"_GetPropertyKeyframeStubLowerThanPlayhead",value:function _GetPropertyKeyframeStubLowerThanPlayhead(time,propertyKeyframeStubs){for(var i=propertyKeyframeStubs.length-1;i>=0;i--){var stubTime=propertyKeyframeStubs[i].time;if(stubTime<=time)return propertyKeyframeStubs[i];}return null;}}]);return PropertyInterpolationAdapter;}();}// timelines/state/propertyInterpolationAdapters/colorInterpolationAdapter.js
{'use strict';var _C103=self.C3;var TMP_COLORS_MAP=new Map();var TMP_COLOR=[0,0,0];var ColorInterpolationAdapter=/*#__PURE__*/function(_C103$PropertyTrackSt){_inherits(ColorInterpolationAdapter,_C103$PropertyTrackSt);function ColorInterpolationAdapter(sourceAdapter){_classCallCheck(this,ColorInterpolationAdapter);return _possibleConstructorReturn(this,_getPrototypeOf(ColorInterpolationAdapter).call(this,sourceAdapter));}_createClass(ColorInterpolationAdapter,[{key:"SetResetState",value:function SetResetState(){}},{key:"SetInitialState",value:function SetInitialState(){}},{key:"SetResumeState",value:function SetResumeState(){}},{key:"GetCurrentState",value:function GetCurrentState(){var id=this._propertyTrack.GetSourceAdapterId();var target=this._GetTarget();var index=this._GetIndex();switch(id){case"behavior":return this._ToColorArray(target.GetPropertyValueByIndex(index));case"effect":return this._ToColorArray(target[index]);case"plugin":return this._ToColorArray(target.GetPropertyValueByIndex(index));case"world-instance":return this._ToColorArray(this._Getter());}}},{key:"CompareInitialStateWithCurrent",value:function CompareInitialStateWithCurrent(){var firstKeyframeColor=this._FirstKeyframeGetter();return!this._CompareColors(firstKeyframeColor,this._Getter());}},{key:"CompareSaveStateWithCurrent",value:function CompareSaveStateWithCurrent(){if(_C103.IsNullOrUndefined(this._saveState))return false;return!this._CompareColors(this._saveState,this._Getter());}},{key:"_CompareColors",value:function _CompareColors(fColor,sColor){fColor=this._GetColorFromArray(fColor);sColor=this._GetColorFromArray(sColor);return fColor.equalsIgnoringAlpha(sColor);}},{key:"_FirstKeyframeGetter",value:function _FirstKeyframeGetter(){var color=_get(_getPrototypeOf(ColorInterpolationAdapter.prototype),"_FirstKeyframeGetter",this).call(this);return this._GetColorFromArray(color);}},{key:"_CurrentKeyframeGetter",value:function _CurrentKeyframeGetter(){var color=_get(_getPrototypeOf(ColorInterpolationAdapter.prototype),"_CurrentKeyframeGetter",this).call(this);return this._GetColorFromArray(color);}},{key:"_GetAbsoluteInitialValue",value:function _GetAbsoluteInitialValue(value){}},{key:"_ToColorArray",value:function _ToColorArray(color){if(_C103.IsInstanceOf(color,_C103.Color))return color.toArray().slice(0,3);return color.slice(0,3);}},{key:"_GetColorFromArray",value:function _GetColorFromArray(color){if(_C103.IsInstanceOf(color,_C103.Color))return color;return new _C103.Color(color[0],color[1],color[2],1);}},{key:"CanChange",value:function CanChange(value){return true;}},{key:"MayNeedBeforeAndAfterInterpolate",value:function MayNeedBeforeAndAfterInterpolate(){return true;}},{key:"BeforeChangeProperty",value:function BeforeChangeProperty(){var timeline=this._propertyTrack.GetTimeline();var instance=this._propertyTrack.GetInstance();var sourceAdapter=this._propertyTrack.GetSourceAdapter();var propertyTracks=timeline.GetSimilarPropertyTracks(instance,sourceAdapter,this._property,this._propertyTrack);if(propertyTracks&&propertyTracks.length>1){if(!TMP_COLORS_MAP.has(instance))TMP_COLORS_MAP.set(instance,new Map());var instanceMap=TMP_COLORS_MAP.get(instance);var id=this._propertyTrack.GetSourceAdapterId();if(!instanceMap.has(id))instanceMap.set(id,new Map());var sourceMap=instanceMap.get(id);if(!sourceMap.has(this._property))sourceMap.set(this._property,{used:false,color:new _C103.Color(0,0,0,1)});}}},{key:"_GetTmpColor",value:function _GetTmpColor(instance,sourceId,propertyName){var tmpColorObj=TMP_COLORS_MAP.get(instance).get(sourceId).get(propertyName);tmpColorObj.used=true;return tmpColorObj.color;}},{key:"ChangeProperty",value:function ChangeProperty(time,value,start,end,setTime,ensureValue,endState,propertyKeyframeReached){var timeline=this._propertyTrack.GetTimeline();var track=this._propertyTrack.GetTrack();var instance=this._propertyTrack.GetInstance();var sourceAdapter=this._propertyTrack.GetSourceAdapter();var sourceAdapterId=this._propertyTrack.GetSourceAdapterId();var property=this._property;var propertyTracks=timeline.GetSimilarPropertyTracks(instance,sourceAdapter,property,this._propertyTrack);if(propertyTracks&&propertyTracks.length>1){var propertyKeyframeStubs=this._GetPropertyKeyframeStubs(propertyTracks,true);var stub=this._GetLastPropertyKeyframeStub(timeline,timeline.GetTime(),propertyKeyframeStubs);if(stub){var startOffset=track.GetStartOffset();var t=stub.time-startOffset;if(t===0)this._GetTmpColor(instance,sourceAdapterId,this._property).addRgb(value[0],value[1],value[2]);else{if(t<0)return;var r=value[0];var g=value[1];var _b5=value[2];var v=this._propertyTrack.Interpolate(t,false,true);var dr=_C103.Color.DiffChannel(r,v[0]);var dg=_C103.Color.DiffChannel(g,v[1]);var db=_C103.Color.DiffChannel(_b5,v[2]);this._GetTmpColor(instance,sourceAdapterId,this._property).addRgb(dr,dg,db);}}}else this._Setter(value[0],value[1],value[2]);}},{key:"AfterChangeProperty",value:function AfterChangeProperty(){var instance=this._propertyTrack.GetInstance();if(!TMP_COLORS_MAP.has(instance))return;var instanceMap=TMP_COLORS_MAP.get(instance);var id=this._propertyTrack.GetSourceAdapterId();if(!instanceMap.has(id))return;var sourceMap=instanceMap.get(id);if(!sourceMap.has(this._property))return;var tmpColorObj=sourceMap.get(this._property);var used=tmpColorObj.used;var color=tmpColorObj.color;if(used)this._Setter(color.getR(),color.getG(),color.getB());if(sourceMap.size===0)instanceMap["delete"](id);if(instanceMap.size===0)TMP_COLORS_MAP["delete"](instance);}},{key:"_Getter",value:function _Getter(){var id=this._propertyTrack.GetSourceAdapterId();var target=this._GetTarget();var index=this._GetIndex();switch(id){case"behavior":return this._GetColorFromArray(target.GetPropertyValueByIndex(index));case"effect":return target[index].clone();case"plugin":return this._GetColorFromArray(target.GetPropertyValueByIndex(index));case"world-instance":return this.GetWorldInfo().GetUnpremultipliedColor().clone();}}},{key:"_Setter",value:function _Setter(r,g,b){var id=this._propertyTrack.GetSourceAdapterId();var target=this._GetTarget();var index=this._GetIndex();switch(id){case"behavior":TMP_COLOR[0]=r;TMP_COLOR[1]=g;TMP_COLOR[2]=b;target.SetPropertyValueByIndex(index,TMP_COLOR);break;case"effect":target[index].setRgb(r,g,b);break;case"plugin":TMP_COLOR[0]=r;TMP_COLOR[1]=g;TMP_COLOR[2]=b;target.SetPropertyValueByIndex(index,TMP_COLOR);break;case"world-instance":this.GetWorldInfo().SetUnpremultipliedColorRGB(r,g,b);break;}}},{key:"_SaveToJson",value:function _SaveToJson(){}},{key:"_LoadFromJson",value:function _LoadFromJson(o){}}]);return ColorInterpolationAdapter;}(_C103.PropertyTrackState.PropertyInterpolationAdapter);_C103.PropertyTrackState.PropertyInterpolationAdapter.ColorInterpolationAdapter=ColorInterpolationAdapter;}// timelines/state/propertyInterpolationAdapters/noInterpolationAdapter.js
{'use strict';var _C104=self.C3;var _NS=_C104.PropertyTrackState;var NoInterpolationAdapter=/*#__PURE__*/function(_C104$PropertyTrackSt){_inherits(NoInterpolationAdapter,_C104$PropertyTrackSt);function NoInterpolationAdapter(sourceAdapter){_classCallCheck(this,NoInterpolationAdapter);return _possibleConstructorReturn(this,_getPrototypeOf(NoInterpolationAdapter).call(this,sourceAdapter));}_createClass(NoInterpolationAdapter,[{key:"SetResetState",value:function SetResetState(){}},{key:"SetInitialState",value:function SetInitialState(){}},{key:"SetResumeState",value:function SetResumeState(){}},{key:"GetCurrentState",value:function GetCurrentState(){return this._Getter();}},{key:"CompareInitialStateWithCurrent",value:function CompareInitialStateWithCurrent(){var firstKeyframeValue=this._FirstKeyframeGetter();return firstKeyframeValue!==this.GetCurrentState();}},{key:"CompareSaveStateWithCurrent",value:function CompareSaveStateWithCurrent(){if(_C104.IsNullOrUndefined(this._saveState))return false;return this._saveState!==this.GetCurrentState();}},{key:"MayNeedBeforeAndAfterInterpolate",value:function MayNeedBeforeAndAfterInterpolate(){return false;}},{key:"ChangeProperty",value:function ChangeProperty(time,value,start,end,setTime,ensureValue,endState,propertyKeyframeReached){var propertyTrack=this._propertyTrack;var track=propertyTrack.GetTrack();var id=propertyTrack.GetSourceAdapterId();var timeline=propertyTrack.GetTimeline();var instance=track.GetInstance();var sourceAdapter=propertyTrack.GetSourceAdapter();var property=this._property;var propertyTracks=timeline.GetSimilarPropertyTracks(instance,sourceAdapter,property,propertyTrack);if(propertyTracks&&propertyTracks.length>1){var propertyKeyframeStubs=this._GetPropertyKeyframeStubs(propertyTracks);var t=time+track.GetStartOffset();var stub=this._GetLastPropertyKeyframeStub(timeline,t,propertyKeyframeStubs);if(stub)value=stub.value;}var type=propertyTrack.GetPropertyKeyframeType();switch(type){case"numeric":{if(!_NS.NumericTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),value,id))return;break;}case"angle":{if(!_NS.AngleTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),value,id))return;break;}case"boolean":{if(!_NS.BooleanTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),value,id))return;break;}case"color":{if(!_NS.ColorTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),value,id))return;break;}case"text":{if(!_NS.TextTypeAdapter.WillChange(this._GetIndex(),this._GetTarget(),value,id))return;break;}}this._Setter(value);}},{key:"_Getter",value:function _Getter(){var id=this._propertyTrack.GetSourceAdapterId();var target=this._GetTarget();var index=this._GetIndex();switch(id){case"behavior":return target.GetPropertyValueByIndex(index);case"effect":return target[index];case"instance-variable":return target.GetInstanceVariableValue(index);case"plugin":return target.GetPropertyValueByIndex(index);}}},{key:"_Setter",value:function _Setter(value){var id=this._propertyTrack.GetSourceAdapterId();var target=this._GetTarget();var index=this._GetIndex();switch(id){case"behavior":target.SetPropertyValueByIndex(index,value);break;case"effect":target[index]=value;break;case"instance-variable":target.SetInstanceVariableValue(index,value);break;case"plugin":target.SetPropertyValueByIndex(index,value);break;}}}]);return NoInterpolationAdapter;}(_C104.PropertyTrackState.PropertyInterpolationAdapter);_C104.PropertyTrackState.PropertyInterpolationAdapter.NoInterpolationAdapter=NoInterpolationAdapter;}// timelines/state/propertyInterpolationAdapters/numericInterpolationAdapter.js
{'use strict';var _C105=self.C3;var _NS2=_C105.PropertyTrackState.PropertyInterpolationAdapter;var INSTANCE_FUNC_MAP=new Map();var add=function add(prop,setter,absolute_setter,getter,round){var fRound=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;var init=arguments.length>6&&arguments[6]!==undefined?arguments[6]:null;var reset=arguments.length>7&&arguments[7]!==undefined?arguments[7]:null;INSTANCE_FUNC_MAP.set(prop,{setter:setter,absolute_setter:absolute_setter,getter:getter,round:round,fRound:fRound,init:init,reset:reset});};add("offsetX",function(wi,v,t,a){if(a._propertyTrack.GetResultMode()==="relative")wi.OffsetX(v,t.GetTimeline().GetTransformWithSceneGraph());else wi.OffsetX(v);},function(wi,v){return wi.SetX(v);},function(wi){return wi.GetX();},true);add("offsetY",function(wi,v,t,a){if(a._propertyTrack.GetResultMode()==="relative")wi.OffsetY(v,t.GetTimeline().GetTransformWithSceneGraph());else wi.OffsetY(v);},function(wi,v){return wi.SetY(v);},function(wi){return wi.GetY();},true);add("offsetWidth",function(wi,v,t,a,noChanges){if(v===0)return;var isRelative=a._propertyTrack.GetResultMode()==="relative";var isTween=a._typeAdapter.GetType()===1;if((isRelative||isTween)&&wi.HasParent()&&wi.GetTransformWithParentWidth()){if(isNaN(a._absoluteToFactor)){var _parents=[];var parent=wi.GetParent();while(parent){_parents.push(parent);parent=parent.GetParent();}_parents.reverse();var get_track=function get_track(wi,t){return t.GetTimeline().GetTrackFromInstance(wi.GetInstance());};var get_original_size=function get_original_size(wi,t){var track=get_track(wi,t);if(track)return track.GetOriginalWidth();var sdki=wi.GetInstance().GetSdkInstance();if(sdki.IsOriginalSizeKnown())return sdki.GetOriginalWidth();return wi._GetSceneGraphInfo()._GetStartWidth();};var get_last_property_keyframe_value=function get_last_property_keyframe_value(wi,t,propertyName){var defaultValue=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var track=get_track(wi,t);if(!track)return defaultValue;var propertyTrack=track.GetPropertyTrack(propertyName);if(!propertyTrack)return defaultValue;var parentPropertyKeyframeData=propertyTrack.GetPropertyTrackDataItem().GetPropertyKeyframeData();if(!parentPropertyKeyframeData)return defaultValue;var parentLastPropertyKeyframeDataItem=parentPropertyKeyframeData.GetLastPropertyKeyframeDataItem();if(!parentLastPropertyKeyframeDataItem)return defaultValue;return parentLastPropertyKeyframeDataItem.GetValue();};var absoluteToFactor;if(isTween){var p=_parents[_parents.length-1];absoluteToFactor=p.GetWidth();}else{var _p=_parents[0];var ownStartSize=_p._GetSceneGraphInfo()._GetStartWidth();var ownStartScale=_p._GetSceneGraphInfo().GetStartScaleX();absoluteToFactor=ownStartSize*ownStartScale;absoluteToFactor+=get_last_property_keyframe_value(_p,t,"offsetWidth");absoluteToFactor+=get_original_size(_p,t)*get_last_property_keyframe_value(_p,t,"offsetScaleX");for(var i=1;i<_parents.length;i++){_p=_parents[i];var _ownStartScale=_p._GetSceneGraphInfo().GetStartScaleX();absoluteToFactor*=_ownStartScale;absoluteToFactor+=get_last_property_keyframe_value(_p,t,"offsetWidth");absoluteToFactor+=get_original_size(_p,t)*get_last_property_keyframe_value(_p,t,"offsetScaleX");}}a._absoluteToFactor=absoluteToFactor===0?Number.EPSILON:absoluteToFactor;}if(noChanges)return;wi.OffsetWidth(v/a._absoluteToFactor,true);}else wi.OffsetWidth(v);},function(wi,v){return wi.SetWidth(v);},function(wi){return wi.GetWidth();},true);add("offsetHeight",function(wi,v,t,a,noChanges){if(v===0)return;var isRelative=a._propertyTrack.GetResultMode()==="relative";var isTween=a._typeAdapter.GetType()===1;if((isRelative||isTween)&&wi.HasParent()&&wi.GetTransformWithParentHeight()){if(isNaN(a._absoluteToFactor)){var _parents2=[];var parent=wi.GetParent();while(parent){_parents2.push(parent);parent=parent.GetParent();}_parents2.reverse();var get_track=function get_track(wi,t){return t.GetTimeline().GetTrackFromInstance(wi.GetInstance());};var get_original_size=function get_original_size(wi,t){var track=get_track(wi,t);if(track)return track.GetOriginalHeight();var sdki=wi.GetInstance().GetSdkInstance();if(sdki.IsOriginalSizeKnown())return sdki.GetOriginalHeight();return wi._GetSceneGraphInfo()._GetStartHeight();};var get_last_property_keyframe_value=function get_last_property_keyframe_value(wi,t,propertyName){var defaultValue=arguments.length>3&&arguments[3]!==undefined?arguments[3]:0;var track=t.GetTimeline().GetTrackFromInstance(wi.GetInstance());if(!track)return defaultValue;var propertyTrack=track.GetPropertyTrack(propertyName);if(!propertyTrack)return defaultValue;var parentPropertyKeyframeData=propertyTrack.GetPropertyTrackDataItem().GetPropertyKeyframeData();if(!parentPropertyKeyframeData)return defaultValue;var parentLastPropertyKeyframeDataItem=parentPropertyKeyframeData.GetLastPropertyKeyframeDataItem();if(!parentLastPropertyKeyframeDataItem)return defaultValue;return parentLastPropertyKeyframeDataItem.GetValue();};var absoluteToFactor;if(isTween){var p=_parents2[_parents2.length-1];absoluteToFactor=p.GetHeight();}else{var _p2=_parents2[0];var ownStartSize=_p2._GetSceneGraphInfo()._GetStartHeight();var ownStartScale=_p2._GetSceneGraphInfo().GetStartScaleY();absoluteToFactor=ownStartSize*ownStartScale;absoluteToFactor+=get_last_property_keyframe_value(_p2,t,"offsetHeight");absoluteToFactor+=get_original_size(_p2,t)*get_last_property_keyframe_value(_p2,t,"offsetScaleY");for(var i=1;i<_parents2.length;i++){_p2=_parents2[i];var _ownStartScale2=_p2._GetSceneGraphInfo().GetStartScaleY();absoluteToFactor*=_ownStartScale2;absoluteToFactor+=get_last_property_keyframe_value(_p2,t);absoluteToFactor+=get_original_size(_p2,t)*get_last_property_keyframe_value(_p2,t,"offsetScaleY");}}a._absoluteToFactor=absoluteToFactor===0?Number.EPSILON:absoluteToFactor;}if(noChanges)return;wi.OffsetHeight(v/a._absoluteToFactor,true);}else wi.OffsetHeight(v);},function(wi,v){return wi.SetHeight(v);},function(wi){return wi.GetHeight();},true);add("offsetAngle",function(wi,v){return wi.OffsetAngle(v);},function(wi,v){return wi.SetAngle(v);},function(wi){return wi.GetAngle();},false,true);add("offsetOpacity",function(wi,v,t,a,noChanges){var opacityFactor=a._opacityFactor?a._opacityFactor:1;v/=opacityFactor;var o=wi.GetOpacity();var nv=o+v;var min=0;var max=1;if(a._clampAccumulator===0){if(nv>max)a._clampAccumulator+=nv-max;else if(nv<min)a._clampAccumulator+=nv;wi.OffsetOpacity(v);}else{var _nv=wi.GetOpacity()+v;if(v>0&&a._clampAccumulator>0){if(_nv>max)a._clampAccumulator+=_nv-max;}else if(v>0&&a._clampAccumulator<0){a._clampAccumulator+=v;if(a._clampAccumulator>0)a._clampAccumulator=0;}else if(v<0&&a._clampAccumulator>0){a._clampAccumulator+=v;if(a._clampAccumulator<0)a._clampAccumulator=0;}else if(v<0&&a._clampAccumulator<0)if(_nv<min)a._clampAccumulator+=_nv;}},function(wi,v){wi.SetOpacity(v);},function(wi){return wi.GetOpacity();},false,true,function(a,wi,t){a._clampAccumulator=0;switch(a._propertyTrack.GetResultMode()){case"relative":{var propertyTrackData=a._propertyTrack.GetPropertyTrackData();var propertyTrackDataItem=a._propertyTrack.GetPropertyTrackDataItem();var propertyKeyframeData=propertyTrackDataItem.GetPropertyKeyframeData();var propertyKeyframeDataItems=propertyKeyframeData.GetPropertyKeyframeDataItemArray();var startingAbsoluteOpacity=a.GetWorldInfo().GetOpacity();var currentAbsoluteOpacity=startingAbsoluteOpacity;var _iteratorNormalCompletion271=true;var _didIteratorError271=false;var _iteratorError271=undefined;try{for(var _iterator271=propertyKeyframeDataItems[Symbol.iterator](),_step271;!(_iteratorNormalCompletion271=(_step271=_iterator271.next()).done);_iteratorNormalCompletion271=true){var propertyKeyframeDataItem=_step271.value;var _time=propertyKeyframeDataItem.GetTime();var _currentRelativeOpacity=a._propertyTrack.GetInterpolatedValue(_time);currentAbsoluteOpacity=startingAbsoluteOpacity+_currentRelativeOpacity;currentAbsoluteOpacity=_C105.clamp(currentAbsoluteOpacity,0,1);}}catch(err){_didIteratorError271=true;_iteratorError271=err;}finally{try{if(!_iteratorNormalCompletion271&&_iterator271["return"]!=null){_iterator271["return"]();}}finally{if(_didIteratorError271){throw _iteratorError271;}}}a._totalForewardOpacityDelta=startingAbsoluteOpacity-currentAbsoluteOpacity;a._totalForewardOpacityDelta=Math.round((a._totalForewardOpacityDelta+Number.EPSILON)*100)/100;currentAbsoluteOpacity=startingAbsoluteOpacity;for(var i=propertyKeyframeDataItems.length-1;i>=0;i--){var time=propertyKeyframeDataItems[i].GetTime();var currentRelativeOpacity=a._propertyTrack.GetInterpolatedValue(time);currentAbsoluteOpacity-=currentRelativeOpacity;currentAbsoluteOpacity=_C105.clamp(currentAbsoluteOpacity,0,1);}a._totalBackwardOpacityDelta=currentAbsoluteOpacity;a._totalBackwardOpacityDelta=Math.round((a._totalBackwardOpacityDelta+Number.EPSILON)*100)/100;break;}case"absolute":{break;}}var isRelative=a._propertyTrack.GetResultMode()==="relative";var isTween=a._typeAdapter.GetType()===1;if((isRelative||isTween)&&wi.HasParent()&&wi.GetTransformWithParentOpacity()){var _parents3=[];var parent=wi.GetParent();while(parent){_parents3.push(parent);parent=parent.GetParent();}_parents3.reverse();var get_last_property_keyframe_value=function get_last_property_keyframe_value(wi,t,propertyName){var track=t.GetTimeline().GetTrackFromInstance(wi.GetInstance());if(!track)return 0;var propertyTrack=track.GetPropertyTrack(propertyName);if(!propertyTrack)return 0;var parentPropertyKeyframeData=propertyTrack.GetPropertyTrackDataItem().GetPropertyKeyframeData();if(!parentPropertyKeyframeData)return 0;var parentLastPropertyKeyframeDataItem=parentPropertyKeyframeData.GetLastPropertyKeyframeDataItem();if(!parentLastPropertyKeyframeDataItem)return 0;return parentLastPropertyKeyframeDataItem.GetValue();};var opacityFactor=_parents3[0]._GetSceneGraphInfo().GetStartOpacity();opacityFactor+=get_last_property_keyframe_value(_parents3[0],t,"offsetOpacity");for(var _i42=1;_i42<_parents3.length;_i42++){opacityFactor+=get_last_property_keyframe_value(_parents3[_i42],t,"offsetOpacity");}a._opacityFactor=opacityFactor===0?1:opacityFactor;}},function(a){switch(a._propertyTrack.GetResultMode()){case"relative":{a._clampAccumulator=0;var wi=a.GetWorldInfo();var currentOpacity=wi.GetOpacity();currentOpacity=Math.round((currentOpacity+Number.EPSILON)*100)/100;if(a._propertyTrack.GetTimeline().IsForwardPlayBack()){wi.SetOpacity(currentOpacity+a._totalForewardOpacityDelta);a._lastValue=0;}else{wi.SetOpacity(currentOpacity-a._totalBackwardOpacityDelta);a._lastValue=a.GetSourceAdapter().GetValueAtTime();}break;}case"absolute":{break;}}});add("offsetOriginX",function(wi,v){return wi.OffsetOriginX(v);},function(wi,v){return wi.SetOriginX(v);},function(wi){return wi.GetOriginX();},false);add("offsetOriginY",function(wi,v){return wi.OffsetOriginY(v);},function(wi,v){return wi.SetOriginY(v);},function(wi){return wi.GetOriginY();},false);add("offsetZElevation",function(wi,v){return wi.OffsetZElevation(v);},function(wi,v){return wi.SetZElevation(v);},function(wi){return wi.GetZElevation();},true);add("offsetScaleX",function(wi,v,t,a){if(v===0)return;var mirrorFactor=wi.GetWidth()<0?-1:1;if(a._propertyTrack.GetResultMode()==="relative"&&wi.HasParent()&&wi.GetTransformWithParentWidth()){var value=t.GetOriginalWidth()*mirrorFactor*v;if(isNaN(a._absoluteToFactor))INSTANCE_FUNC_MAP.get("offsetWidth").setter(wi,1,t,a,true);wi.OffsetWidth(value/a._absoluteToFactor,true);}else wi.OffsetWidth(t.GetOriginalWidth()*mirrorFactor*v);},function(wi,v,t){wi.SetWidth(t.GetOriginalWidth()*v);},function(wi,t){var mirrorFactor=wi.GetWidth()<0?-1:1;if(wi.GetTransformWithParentWidth()){var parentWi=wi.GetParent();var parentTrack=t.GetTimeline().GetTrackFromInstance(parentWi.GetInstance());var parentScale=NaN;if(parentTrack)parentScale=parentWi.GetWidth()/parentTrack.GetOriginalWidth();else{var sdki=parentWi.GetInstance().GetSdkInstance();if(sdki.IsOriginalSizeKnown())parentScale=parentWi.GetWidth()/sdki.GetOriginalWidth();else parentScale=1;}return wi.GetWidth()*mirrorFactor/(t.GetOriginalWidth()*parentScale);}else return wi.GetWidth()*mirrorFactor/t.GetOriginalWidth();},false);add("offsetScaleY",function(wi,v,t,a){if(v===0)return;var flipFactor=wi.GetHeight()<0?-1:1;if(a._propertyTrack.GetResultMode()==="relative"&&wi.HasParent()&&wi.GetTransformWithParentHeight()){var value=t.GetOriginalHeight()*flipFactor*v;if(isNaN(a._absoluteToFactor))INSTANCE_FUNC_MAP.get("offsetHeight").setter(wi,1,t,a,true);wi.OffsetHeight(value/a._absoluteToFactor,true);}else wi.OffsetHeight(t.GetOriginalHeight()*flipFactor*v);},function(wi,v,t){wi.SetHeight(t.GetOriginalHeight()*v);},function(wi,t){var flipFactor=wi.GetHeight()<0?-1:1;if(wi.GetTransformWithParentHeight()){var parentWi=wi.GetParent();var parentTrack=t.GetTimeline().GetTrackFromInstance(parentWi.GetInstance());var parentScale=NaN;if(parentTrack)parentScale=parentWi.GetHeight()/parentTrack.GetOriginalHeight();else{var sdki=parentWi.GetInstance().GetSdkInstance();if(sdki.IsOriginalSizeKnown())parentScale=parentWi.GetHeight()/sdki.GetOriginalHeight();else parentScale=1;}return wi.GetHeight()*flipFactor/(t.GetOriginalHeight()*parentScale);}else return wi.GetHeight()*flipFactor/t.GetOriginalHeight();},false);var NumericInterpolationAdapter=/*#__PURE__*/function(_C105$PropertyTrackSt){_inherits(NumericInterpolationAdapter,_C105$PropertyTrackSt);function NumericInterpolationAdapter(sourceAdapter){var _this58;_classCallCheck(this,NumericInterpolationAdapter);_this58=_possibleConstructorReturn(this,_getPrototypeOf(NumericInterpolationAdapter).call(this,sourceAdapter));_this58._lastValue=0;_this58._clampAccumulator=0;_this58._totalForewardOpacityDelta=0;_this58._totalBackwardOpacityDelta=0;_this58._opacityFactor=NaN;_this58._absoluteToFactor=NaN;_this58._instance_getter=null;_this58._instance_setter=null;_this58._instance_absolute_setter=null;_this58._reset_action=null;_this58._init_action=null;_this58._source_adapter_getter=null;_this58._source_adapter_setter=null;_this58._source_adapter_absolute_setter=null;_this58._round=false;_this58._fRound=false;if(_C105.IsInstanceOf(_this58._propertyTrack.GetTimeline(),_C105.TweenState))_this58._typeAdapter=new _C105.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapterForTween(_assertThisInitialized(_this58));else _this58._typeAdapter=new _C105.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapterForTimeline(_assertThisInitialized(_this58));var property=_this58._propertyTrack.GetPropertyName();switch(_this58._propertyTrack.GetSourceAdapterId()){case"world-instance":{var p=INSTANCE_FUNC_MAP.get(property);_this58._instance_getter=p.getter;_this58._instance_setter=p.setter;_this58._instance_absolute_setter=p.absolute_setter;_this58._round=p.round;_this58._fRound=p.fRound;_this58._init_action=p.init;_this58._reset_action=p.reset;break;}case"audio":{_this58._source_adapter_getter=sourceAdapter.Getter;_this58._source_adapter_setter=sourceAdapter.Setter;_this58._source_adapter_absolute_setter=sourceAdapter.AbsoluteSetter;_this58._round=!!sourceAdapter.DoesRounding();_this58._fRound=false;break;}}return _this58;}_createClass(NumericInterpolationAdapter,[{key:"Release",value:function Release(){this._typeAdapter=null;this._instance_getter=null;this._instance_setter=null;this._instance_absolute_setter=null;this._absoluteToFactor=NaN;_get(_getPrototypeOf(NumericInterpolationAdapter.prototype),"Release",this).call(this);}},{key:"MayNeedBeforeAndAfterInterpolate",value:function MayNeedBeforeAndAfterInterpolate(){return this._typeAdapter.MayNeedBeforeAndAfterInterpolate();}},{key:"GetLastValue",value:function GetLastValue(){return this._lastValue;}},{key:"SetLastValue",value:function SetLastValue(v){this._lastValue=v;}},{key:"SetResetState",value:function SetResetState(){if(this._reset_action)this._reset_action(this);}},{key:"SetInitialState",value:function SetInitialState(){var initValue=this._typeAdapter.SetInitialState();if(typeof initValue==="number")this._lastValue=initValue;if(this._init_action){var wi=this.GetWorldInfo();var track=this._propertyTrack.GetTrack();this._init_action(this,wi,track);}}},{key:"SetResumeState",value:function SetResumeState(){var resumeValue=this._typeAdapter.SetResumeState();if(typeof resumeValue==="number")this._lastValue=resumeValue;}},{key:"GetCurrentState",value:function GetCurrentState(){return this._Getter();}},{key:"CompareInitialStateWithCurrent",value:function CompareInitialStateWithCurrent(){var firstKeyframeValue=this._FirstKeyframeGetter();return firstKeyframeValue!==this.GetCurrentState();}},{key:"CompareSaveStateWithCurrent",value:function CompareSaveStateWithCurrent(){if(_C105.IsNullOrUndefined(this._saveState))return false;return this._saveState!==this.GetCurrentState();}},{key:"BeforeChangeProperty",value:function BeforeChangeProperty(){this._typeAdapter.BeforeChangeProperty();}},{key:"ChangeProperty",value:function ChangeProperty(time,value,start,end,setTime,ensureValue,endState,propertyKeyframeReached){return this._typeAdapter.ChangeProperty(time,value,start,end,setTime,ensureValue,endState,propertyKeyframeReached);}},{key:"AfterChangeProperty",value:function AfterChangeProperty(){this._typeAdapter.AfterChangeProperty();}},{key:"_Getter",value:function _Getter(){var target=this._GetTarget();var index=this._GetIndex();var wi=this.GetWorldInfo();var track=this._propertyTrack.GetTrack();var id=this._propertyTrack.GetSourceAdapterId();switch(id){case"behavior":return target.GetPropertyValueByIndex(index);case"effect":return target[index];case"instance-variable":return target.GetInstanceVariableValue(index);case"plugin":return target.GetPropertyValueByIndex(index);case"world-instance":return this._instance_getter(wi,track);case"audio":return this._source_adapter_getter.call(this.GetSourceAdapter(),wi,track);}}},{key:"_Setter",value:function _Setter(value,start,end){var target=this._GetTarget();var index=this._GetIndex();var wi=this.GetWorldInfo();var track=this._propertyTrack.GetTrack();var id=this._propertyTrack.GetSourceAdapterId();switch(id){case"behavior":target.OffsetPropertyValueByIndex(index,value);break;case"effect":target[index]+=value;break;case"instance-variable":target.SetInstanceVariableOffset(index,value);break;case"plugin":target.OffsetPropertyValueByIndex(index,value,this.GetSourceAdapter().GetOptionalCallbacks());break;case"world-instance":this._instance_setter(wi,value,track,this);break;case"audio":this._source_adapter_setter.call(this.GetSourceAdapter(),wi,value,track,this);break;}}},{key:"_SetterAbsolute",value:function _SetterAbsolute(value,propertyKeyframeReached,endState){var mode=this._propertyTrack.GetInterpolationMode();mode=mode==="default"?"continuous":mode;if(mode==="discrete"&&!propertyKeyframeReached)return;if(mode==="discrete"&&endState){var timeline=this._propertyTrack.GetTimeline();var time=timeline.GetTime();var propertyKeyframeDataItem=this._propertyTrack.GetPropertyKeyFrameDataItemAtTime(time);if(!propertyKeyframeDataItem)return;}var target=this._GetTarget();var index=this._GetIndex();var wi=this.GetWorldInfo();var track=this._propertyTrack.GetTrack();var id=this._propertyTrack.GetSourceAdapterId();switch(id){case"behavior":target.SetPropertyValueByIndex(index,value);break;case"effect":target[index]=value;break;case"instance-variable":target.SetInstanceVariableValue(index,value);break;case"plugin":target.SetPropertyValueByIndex(index,value,this.GetSourceAdapter().GetOptionalCallbacks());break;case"world-instance":this._instance_absolute_setter(wi,value,track);break;case"audio":this._source_adapter_absolute_setter.call(this.GetSourceAdapter(),wi,value,track);break;}}},{key:"_MaybeEnsureValue",value:function _MaybeEnsureValue(time,start,end,setTime,lastValue,currentValue,forceEndValue,endState){this._typeAdapter._MaybeEnsureValue(time,start,end,setTime,lastValue,currentValue,forceEndValue,endState);}},{key:"_AddDelta",value:function _AddDelta(value,start,end,forceEndValue,endState){switch(this._propertyTrack.GetPropertyType()){case"angle":{value=_C105.toDegrees(value);break;}default:{value=value;break;}}var stringValue=value.toString();var decimalsString=stringValue.split(".")[1]||"";var decimalPlaces=decimalsString.length;var v=this._Getter();var rv;if(decimalPlaces===0){if(this._round)rv=Math.round(v);else if(this._fRound)switch(this._propertyTrack.GetPropertyType()){case"angle":{rv=_C105.toRadians(Math.round(_C105.toDegrees(v)));break;}default:{rv=Math.round((v+Number.EPSILON)*100)/100;break;}}else rv=v;}else if(this._round)rv=Number(_C105.toFixed(v,decimalPlaces));else if(this._fRound)rv=v;else rv=v;this._Setter(rv-v,start,end);}},{key:"_SaveToJson",value:function _SaveToJson(){return Object.assign(_get(_getPrototypeOf(NumericInterpolationAdapter.prototype),"_SaveToJson",this).call(this),{"v":this._lastValue,"a":this._clampAccumulator,"fod":this._totalForewardOpacityDelta,"bod":this._totalBackwardOpacityDelta});}},{key:"_LoadFromJson",value:function _LoadFromJson(o){if(!o)return;_get(_getPrototypeOf(NumericInterpolationAdapter.prototype),"_LoadFromJson",this).call(this,o);this._lastValue=o["v"];this._clampAccumulator=o["a"];this._totalForewardOpacityDelta=_C105.IsFiniteNumber(o["fod"])?o["fod"]:0;this._totalBackwardOpacityDelta=_C105.IsFiniteNumber(o["bod"])?o["bod"]:0;}}]);return NumericInterpolationAdapter;}(_C105.PropertyTrackState.PropertyInterpolationAdapter);_C105.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapter=NumericInterpolationAdapter;}// timelines/state/propertyInterpolationAdapters/numericInterpolationAdapterForTimeline.js
{'use strict';var _C106=self.C3;var AbsoluteValueObject=/*#__PURE__*/function(){function AbsoluteValueObject(propertyTracks){_classCallCheck(this,AbsoluteValueObject);this._used=false;this._value=0;this._propertyKeyframeReached=false;this._endState=false;this._propertyTracks=propertyTracks;for(var i=0,l=this._propertyTracks.length;i<l;i++){this._propertyTracks[i].SetAbsoluteValueObject(this);}}_createClass(AbsoluteValueObject,[{key:"GetPropertyTracks",value:function GetPropertyTracks(){return this._propertyTracks;}},{key:"SetUsed",value:function SetUsed(){this._used=true;}},{key:"GetUsed",value:function GetUsed(){return this._used;}},{key:"SetValue",value:function SetValue(v){this._value=v;}},{key:"GetValue",value:function GetValue(){return this._value;}},{key:"SetPropertyKeyframeReached",value:function SetPropertyKeyframeReached(v){this._propertyKeyframeReached=v;}},{key:"GetPropertyKeyframeReached",value:function GetPropertyKeyframeReached(){return this._propertyKeyframeReached;}},{key:"SetEndState",value:function SetEndState(v){this._endState=v;}},{key:"GetEndState",value:function GetEndState(){return this._endState;}},{key:"Reset",value:function Reset(){this._used=false;this._value=0;this._propertyKeyframeReached=false;this._endState=false;}}]);return AbsoluteValueObject;}();var NumericInterpolationAdapterForTimeline=/*#__PURE__*/function(){function NumericInterpolationAdapterForTimeline(numericInterpolationAdapter){_classCallCheck(this,NumericInterpolationAdapterForTimeline);this._numericInterpolationAdapter=numericInterpolationAdapter;}_createClass(NumericInterpolationAdapterForTimeline,[{key:"Release",value:function Release(){this._numericInterpolationAdapter=null;}},{key:"GetType",value:function GetType(){return 0;}},{key:"SetInitialState",value:function SetInitialState(){var adapter=this._numericInterpolationAdapter;var propertyTrack=this._numericInterpolationAdapter.GetPropertyTrack();return adapter._PickResultMode(function(){return adapter._PickTimelinePlaybackMode(function(){return 0;},function(){return adapter.GetSourceAdapter().GetValueAtTime();});},function(){});}},{key:"SetResumeState",value:function SetResumeState(){}},{key:"MayNeedBeforeAndAfterInterpolate",value:function MayNeedBeforeAndAfterInterpolate(){var adapter=this._numericInterpolationAdapter;var propertyTrack=this._numericInterpolationAdapter.GetPropertyTrack();switch(propertyTrack.GetResultMode()){case"relative":{return false;}case"absolute":{return true;}}}},{key:"BeforeChangeProperty",value:function BeforeChangeProperty(){var adapter=this._numericInterpolationAdapter;var propertyTrack=this._numericInterpolationAdapter.GetPropertyTrack();var property=propertyTrack.GetPropertyName();switch(propertyTrack.GetResultMode()){case"relative":{break;}case"absolute":{if(propertyTrack.HasAbsoluteValueObject()){var valueObj=propertyTrack.GetAbsoluteValueObject();valueObj.Reset();}else{var timeline=propertyTrack.GetTimeline();var instance=propertyTrack.GetInstance();var sourceAdapter=propertyTrack.GetSourceAdapter();var similarPropertyTracks=timeline.GetSimilarPropertyTracks(instance,sourceAdapter,property,propertyTrack);if(similarPropertyTracks&&similarPropertyTracks.length>1)new AbsoluteValueObject(similarPropertyTracks);}break;}}}},{key:"ChangeProperty",value:function ChangeProperty(time,value,start,end,setTime,ensureValue,endState,propertyKeyframeReached){var adapter=this._numericInterpolationAdapter;var propertyTrack=this._numericInterpolationAdapter.GetPropertyTrack();switch(propertyTrack.GetResultMode()){case"relative":{var lastValue=adapter.GetLastValue();adapter._Setter(value-lastValue,start,end);if(ensureValue)this._MaybeEnsureValue(time,start,end,setTime,lastValue,value);adapter.SetLastValue(value);break;}case"absolute":{var timeline=propertyTrack.GetTimeline();var track=propertyTrack.GetTrack();var instance=propertyTrack.GetInstance();var sourceAdapter=propertyTrack.GetSourceAdapter();if(propertyTrack.HasAbsoluteValueObject()){var absoluteValueObject=propertyTrack.GetAbsoluteValueObject();var similarpropertyTracks=absoluteValueObject.GetPropertyTracks();var propertyKeyframeStubs=adapter._GetPropertyKeyframeStubs(similarpropertyTracks,true);var stub=adapter._GetLastPropertyKeyframeStub(timeline,timeline.GetTime(),propertyKeyframeStubs);if(stub){var startOffset=track.GetStartOffset();var t=stub.time-startOffset;if(t===0){absoluteValueObject.SetEndState(endState);absoluteValueObject.SetPropertyKeyframeReached(propertyKeyframeReached);absoluteValueObject.SetUsed();absoluteValueObject.SetValue(absoluteValueObject.GetValue()+value);}else{if(t<0)return;var v=propertyTrack.GetInterpolatedValue(t);absoluteValueObject.SetEndState(endState);absoluteValueObject.SetPropertyKeyframeReached(propertyKeyframeReached);absoluteValueObject.SetUsed();absoluteValueObject.SetValue(absoluteValueObject.GetValue()+(value-v));}}}else adapter._SetterAbsolute(value,propertyKeyframeReached,endState);break;}}}},{key:"AfterChangeProperty",value:function AfterChangeProperty(){var adapter=this._numericInterpolationAdapter;var propertyTrack=this._numericInterpolationAdapter.GetPropertyTrack();switch(propertyTrack.GetResultMode()){case"relative":{break;}case"absolute":{if(propertyTrack.HasAbsoluteValueObject()){var absoluteValueObject=propertyTrack.GetAbsoluteValueObject();if(absoluteValueObject.GetUsed())adapter._SetterAbsolute(absoluteValueObject.GetValue(),absoluteValueObject.GetPropertyKeyframeReached(),absoluteValueObject.GetEndState());}break;}}}},{key:"_MaybeEnsureValue",value:function _MaybeEnsureValue(time,start,end,setTime,lastValue,currentValue){var adapter=this._numericInterpolationAdapter;if(setTime)return;if(start&&time===start.GetTime())adapter._AddDelta(start.GetValueWithResultMode(),start,end);else if(end&&time===end.GetTime())adapter._AddDelta(end.GetValueWithResultMode(),start,end);else if(currentValue-lastValue===0)adapter._AddDelta(start.GetValueWithResultMode(),start,end);}}]);return NumericInterpolationAdapterForTimeline;}();_C106.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapterForTimeline=NumericInterpolationAdapterForTimeline;}// timelines/state/propertyInterpolationAdapters/numericInterpolationAdapterForTween.js
{'use strict';var _C107=self.C3;var NumericInterpolationAdapterForTween=/*#__PURE__*/function(){function NumericInterpolationAdapterForTween(numericInterpolationAdapter){_classCallCheck(this,NumericInterpolationAdapterForTween);this._numericInterpolationAdapter=numericInterpolationAdapter;}_createClass(NumericInterpolationAdapterForTween,[{key:"Release",value:function Release(){this._numericInterpolationAdapter=null;}},{key:"GetType",value:function GetType(){return 1;}},{key:"SetInitialState",value:function SetInitialState(){var adapter=this._numericInterpolationAdapter;adapter.SetFirstAbsoluteUpdate(true);return this._GetAbsoluteInitialValue(adapter._FirstKeyframeGetter());}},{key:"SetResumeState",value:function SetResumeState(){var adapter=this._numericInterpolationAdapter;if(adapter._FirstKeyframeGetter()===adapter._CurrentKeyframeGetter())return;adapter.SetFirstAbsoluteUpdate(true);return this._GetAbsoluteInitialValue(adapter._CurrentKeyframeGetter());}},{key:"MayNeedBeforeAndAfterInterpolate",value:function MayNeedBeforeAndAfterInterpolate(){return false;}},{key:"BeforeChangeProperty",value:function BeforeChangeProperty(){}},{key:"ChangeProperty",value:function ChangeProperty(time,value,start,end,setTime,ensureValue,endState,propertyKeyframeReached){var adapter=this._numericInterpolationAdapter;var lastValue=adapter.GetLastValue();switch(adapter.GetPropertyTrack().GetResultMode()){case"relative":{adapter._Setter(value-lastValue,start,end);if(ensureValue)this._MaybeEnsureValue(time,start,end,setTime,lastValue,value,false,endState);break;}case"absolute":{if(adapter.GetFirstAbsoluteUpdate()){adapter.SetFirstAbsoluteUpdate(false);adapter._Setter(lastValue,start,end);}else if(time===0&&adapter.GetPropertyTrack().GetTimeline().GetTotalTime()===0)adapter._SetterAbsolute(value,true,false);else{adapter._Setter(value-lastValue,start,end);if(ensureValue)this._MaybeEnsureValue(time,start,end,setTime,lastValue,value,this._ForceEndValue(),endState);}break;}}adapter.SetLastValue(value);}},{key:"AfterChangeProperty",value:function AfterChangeProperty(){}},{key:"_GetAbsoluteInitialValue",value:function _GetAbsoluteInitialValue(keyframeValue){var adapter=this._numericInterpolationAdapter;return keyframeValue-adapter.GetCurrentState();}},{key:"_ForceEndValue",value:function _ForceEndValue(){var adapter=this._numericInterpolationAdapter;var inst=adapter.GetWorldInfo().GetInstance();var runtime=adapter.GetPropertyTrack().GetRuntime();var timelineManager=runtime.GetTimelineManager();var activeTimelineCount=0;var _iteratorNormalCompletion272=true;var _didIteratorError272=false;var _iteratorError272=undefined;try{for(var _iterator272=timelineManager.GetPlayingTimelines()[Symbol.iterator](),_step272;!(_iteratorNormalCompletion272=(_step272=_iterator272.next()).done);_iteratorNormalCompletion272=true){var timeline=_step272.value;if(timeline.GetType()===0){if(timeline.HasTrackInstance(inst))activeTimelineCount++;}else if(timeline.GetType()===1)if(timeline.GetInstance()===inst)activeTimelineCount++;}}catch(err){_didIteratorError272=true;_iteratorError272=err;}finally{try{if(!_iteratorNormalCompletion272&&_iterator272["return"]!=null){_iterator272["return"]();}}finally{if(_didIteratorError272){throw _iteratorError272;}}}return activeTimelineCount<=1;}},{key:"_MaybeEnsureValue",value:function _MaybeEnsureValue(time,start,end,setTime,lastValue,currentValue,forceEndValue,endState){var adapter=this._numericInterpolationAdapter;if(setTime){if(start&&time===start.GetTime())adapter._AddDelta(start.GetValueWithResultMode(),start,end,forceEndValue,endState);else if(end&&time===end.GetTime())adapter._AddDelta(end.GetValueWithResultMode(),start,end,forceEndValue,endState);else{if(!end)adapter._AddDelta(start.GetValueWithResultMode(),start,end,forceEndValue,endState);}}else if(start&&time===start.GetTime())adapter._AddDelta(start.GetValueWithResultMode(),start,end,forceEndValue,endState);else if(end&&time===end.GetTime())adapter._AddDelta(end.GetValueWithResultMode(),start,end,forceEndValue,endState);else if(currentValue-lastValue===0)adapter._AddDelta(start.GetValueWithResultMode(),start,end,forceEndValue,endState);}}]);return NumericInterpolationAdapterForTween;}();_C107.PropertyTrackState.PropertyInterpolationAdapter.NumericInterpolationAdapterForTween=NumericInterpolationAdapterForTween;}// timelines/state/propertyTypeAdapters/numericTypeAdapter.js
{'use strict';var _C108=self.C3;var _Ease=self.Ease;_C108.PropertyTrackState.NumericTypeAdapter=/*#__PURE__*/function(){function NumericTypeAdapter(){_classCallCheck(this,NumericTypeAdapter);}_createClass(NumericTypeAdapter,null,[{key:"WillChange",value:function WillChange(index,source,newValue,type){var oldValue;switch(type){case"behavior":oldValue=source.GetPropertyValueByIndex(index);break;case"effect":oldValue=source[index];break;case"instance-variable":oldValue=source.GetInstanceVariableValue(index);break;case"plugin":oldValue=source.GetPropertyValueByIndex(index);break;}if(oldValue===newValue)return false;return true;}},{key:"Interpolate",value:function Interpolate(time,start,end,propertyTrack){if(!end){var propertyTrackDataItem=propertyTrack.GetPropertyTrackDataItem();var propertyTrackData=propertyTrack.GetPropertyTrackData();propertyTrackDataItem=propertyTrackData.GetLastPropertyKeyframeDataItem(propertyTrackDataItem);return propertyTrackDataItem.GetValueWithResultMode();}var mode=propertyTrack.GetInterpolationMode();if(mode==="default")mode="continuous";if(propertyTrack.GetPropertyType()==="combo")mode="discrete";if(mode==="discrete")return start.GetValueWithResultMode();else if(mode==="continuous"||mode==="step"){var step=propertyTrack.GetTimeline().GetStep();if(mode==="step"&&step!==0){var s=1/step;time=Math.floor(time*s)/s;}var sv=start.GetValueWithResultMode();var ev=end.GetValueWithResultMode();var startAddon=start.GetAddOn("cubic-bezier");var endAddon=end.GetAddOn("cubic-bezier");var doCubicBezier=startAddon&&startAddon.GetStartEnable()&&endAddon&&endAddon.GetEndEnable();if(!doCubicBezier&&sv===ev)return sv;var st=start.GetTime();var et=end.GetTime();if(mode==="step"&&step!==0)time=_C108.clamp(time,st,et);var n=_C108.normalize(time,st,et);var e=start.GetEase();var ret;if(doCubicBezier){var dt=et-st;ret=_Ease.GetRuntimeEase(e)(dt*n,0,1,dt);ret=_Ease.GetRuntimeEase("cubicbezier")(ret,sv,sv+startAddon.GetStartAnchor(),ev+endAddon.GetEndAnchor(),ev);}else ret=_Ease.GetRuntimeEase(e)((et-st)*n,sv,ev-sv,et-st);if(propertyTrack.GetPropertyType()==="integer")return Math.floor(ret);return ret;}}}]);return NumericTypeAdapter;}();}// timelines/state/propertyTypeAdapters/angleTypeAdapter.js
{'use strict';var _C109=self.C3;_C109.PropertyTrackState.AngleTypeAdapter=/*#__PURE__*/function(){function AngleTypeAdapter(){_classCallCheck(this,AngleTypeAdapter);}_createClass(AngleTypeAdapter,null,[{key:"WillChange",value:function WillChange(index,source,newValue,type){var oldValue;switch(type){case"behavior":oldValue=source.GetPropertyValueByIndex(index);break;case"effect":oldValue=source[index];break;case"instance-variable":oldValue=source.GetInstanceVariableValue(index);break;case"plugin":oldValue=source.GetPropertyValueByIndex(index);break;}if(oldValue===newValue)return false;return true;}},{key:"Interpolate",value:function Interpolate(time,start,end,propertyTrack){if(!end){var propertyTrackDataItem=propertyTrack.GetPropertyTrackDataItem();var propertyTrackData=propertyTrack.GetPropertyTrackData();propertyTrackDataItem=propertyTrackData.GetLastPropertyKeyframeDataItem(propertyTrackDataItem);return propertyTrackDataItem.GetValueWithResultMode();}var mode=propertyTrack.GetInterpolationMode();if(mode==="default")mode="continuous";if(propertyTrack.GetPropertyType()==="combo")mode="discrete";if(mode==="discrete")return start.GetValueWithResultMode();else if(mode==="continuous"||mode==="step"){var step=propertyTrack.GetTimeline().GetStep();if(mode==="step"&&step!==0){var s=1/step;time=Math.floor(time*s)/s;}var st=start.GetTime();var et=end.GetTime();var sv=start.GetValueWithResultMode();var ev=end.GetValueWithResultMode();if(mode==="step"&&step!==0)time=_C109.clamp(time,st,et);var angleAddon=start.GetAddOn("angle");if(angleAddon){var revolutions=angleAddon.GetRevolutions();if(sv===ev&&revolutions===0)return sv;var n=_C109.normalize(time,st,et);var easeFunc=self.Ease.GetRuntimeEase(start.GetEase());var easeRes=easeFunc(n,0,1,1);switch(angleAddon.GetDirection()){case"closest":return _C109.angleLerp(sv,ev,easeRes,revolutions);case"clockwise":return _C109.angleLerpClockwise(sv,ev,easeRes,revolutions);case"anti-clockwise":return _C109.angleLerpAntiClockwise(sv,ev,easeRes,revolutions);}}else{if(sv===ev)return sv;var _n2=_C109.normalize(time,st,et);var _easeFunc=self.Ease.GetRuntimeEase(start.GetEase());return _C109.angleLerp(sv,ev,_easeFunc(_n2,0,1,1));}}}}]);return AngleTypeAdapter;}();}// timelines/state/propertyTypeAdapters/booleanTypeAdapter.js
{'use strict';var _C110=self.C3;_C110.PropertyTrackState.BooleanTypeAdapter=/*#__PURE__*/function(){function BooleanTypeAdapter(){_classCallCheck(this,BooleanTypeAdapter);}_createClass(BooleanTypeAdapter,null,[{key:"WillChange",value:function WillChange(index,source,newValue,type){var oldValue;switch(type){case"behavior":oldValue=source.GetPropertyValueByIndex(index);break;case"effect":oldValue=source[index];break;case"instance-variable":oldValue=source.GetInstanceVariableValue(index);break;case"plugin":oldValue=source.GetPropertyValueByIndex(index);break;}if(!!oldValue===!!newValue)return false;return true;}},{key:"Interpolate",value:function Interpolate(time,start,end,propertyTrack){if(!end){var propertyTrackDataItem=propertyTrack.GetPropertyTrackDataItem();var propertyTrackData=propertyTrack.GetPropertyTrackData();propertyTrackDataItem=propertyTrackData.GetLastPropertyKeyframeDataItem(propertyTrackDataItem);return propertyTrackDataItem.GetValueWithResultMode()?1:0;}return start.GetValueWithResultMode()?1:0;}}]);return BooleanTypeAdapter;}();}// timelines/state/propertyTypeAdapters/colorTypeAdapter.js
{'use strict';var _C111=self.C3;var TEMP_COLOR_ARRAY=[0,0,0];var TEMP_COLOR_ARRAY_2=[0,0,0];var TEMP_COLOR_ARRAY_3=[0,0,0];_C111.PropertyTrackState.ColorTypeAdapter=/*#__PURE__*/function(){function ColorTypeAdapter(){_classCallCheck(this,ColorTypeAdapter);}_createClass(ColorTypeAdapter,null,[{key:"WillChange",value:function WillChange(index,source,newValue,type){var oldValue;switch(type){case"behavior":oldValue=source.GetPropertyValueByIndex(index);break;case"effect":oldValue=source[index];break;case"instance-variable":oldValue=source.GetInstanceVariableValue(index);break;case"plugin":oldValue=source.GetPropertyValueByIndex(index);break;}if(Array.isArray(newValue)){TEMP_COLOR_ARRAY[0]=newValue[0];TEMP_COLOR_ARRAY[1]=newValue[1];TEMP_COLOR_ARRAY[2]=newValue[2];}else{TEMP_COLOR_ARRAY_3.parseCommaSeparatedRgb(newValue);TEMP_COLOR_ARRAY[0]=Math.floor(TEMP_COLOR_ARRAY_3.getR()*255);TEMP_COLOR_ARRAY[1]=Math.floor(TEMP_COLOR_ARRAY_3.getG()*255);TEMP_COLOR_ARRAY[2]=Math.floor(TEMP_COLOR_ARRAY_3.getB()*255);}if(Array.isArray(oldValue)){TEMP_COLOR_ARRAY_2[0]=oldValue[0];TEMP_COLOR_ARRAY_2[1]=oldValue[1];TEMP_COLOR_ARRAY_2[2]=oldValue[2];}else{TEMP_COLOR_ARRAY_3.parseCommaSeparatedRgb(oldValue);TEMP_COLOR_ARRAY_2[0]=Math.floor(TEMP_COLOR_ARRAY_3.getR()*255);TEMP_COLOR_ARRAY_2[1]=Math.floor(TEMP_COLOR_ARRAY_3.getG()*255);TEMP_COLOR_ARRAY_2[2]=Math.floor(TEMP_COLOR_ARRAY_3.getB()*255);}if(TEMP_COLOR_ARRAY[0]!==TEMP_COLOR_ARRAY_2[0])return true;if(TEMP_COLOR_ARRAY[1]!==TEMP_COLOR_ARRAY_2[1])return true;if(TEMP_COLOR_ARRAY[2]!==TEMP_COLOR_ARRAY_2[2])return true;return false;}},{key:"Interpolate",value:function Interpolate(time,start,end,propertyTrack){if(!end){var propertyTrackDataItem=propertyTrack.GetPropertyTrackDataItem();var propertyTrackData=propertyTrack.GetPropertyTrackData();propertyTrackDataItem=propertyTrackData.GetLastPropertyKeyframeDataItem(propertyTrackDataItem);var color=propertyTrackDataItem.GetValueWithResultMode();TEMP_COLOR_ARRAY[0]=color[0];TEMP_COLOR_ARRAY[1]=color[1];TEMP_COLOR_ARRAY[2]=color[2];return TEMP_COLOR_ARRAY;}var mode=propertyTrack.GetInterpolationMode();if(mode==="default")mode="continuous";if(mode==="discrete"){var _color=start.GetValueWithResultMode();TEMP_COLOR_ARRAY[0]=_color[0];TEMP_COLOR_ARRAY[1]=_color[1];TEMP_COLOR_ARRAY[2]=_color[2];return TEMP_COLOR_ARRAY;}else if(mode==="continuous"||mode==="step"){var step=propertyTrack.GetTimeline().GetStep();if(mode==="step"&&step!==0){var s=1/step;time=Math.floor(time*s)/s;}var st=start.GetTime();var et=end.GetTime();var sv=start.GetValueWithResultMode();var ev=end.GetValueWithResultMode();if(mode==="step"&&step!==0)time=_C111.clamp(time,st,et);var n=_C111.normalize(time,st,et);var e=start.GetEase();var sr=sv[0];var sg=sv[1];var sb=sv[2];var er=ev[0];var eg=ev[1];var eb=ev[2];var easeFunc=self.Ease.GetRuntimeEase(e);var d=et-st;var dn=d*n;if(sr===er)TEMP_COLOR_ARRAY[0]=sr;else TEMP_COLOR_ARRAY[0]=easeFunc(dn,sr,er-sr,d);if(sg===eg)TEMP_COLOR_ARRAY[1]=sg;else TEMP_COLOR_ARRAY[1]=easeFunc(dn,sg,eg-sg,d);if(sb===eb)TEMP_COLOR_ARRAY[2]=sb;else TEMP_COLOR_ARRAY[2]=easeFunc(dn,sb,eb-sb,d);return TEMP_COLOR_ARRAY;}}}]);return ColorTypeAdapter;}();}// timelines/state/propertyTypeAdapters/textTypeAdapter.js
{'use strict';var _C112=self.C3;_C112.PropertyTrackState.TextTypeAdapter=/*#__PURE__*/function(){function TextTypeAdapter(){_classCallCheck(this,TextTypeAdapter);}_createClass(TextTypeAdapter,null,[{key:"WillChange",value:function WillChange(index,source,newValue,type){var oldValue;switch(type){case"behavior":oldValue=source.GetPropertyValueByIndex(index);break;case"effect":oldValue=source[index];break;case"instance-variable":oldValue=source.GetInstanceVariableValue(index);break;case"plugin":oldValue=source.GetPropertyValueByIndex(index);break;}if(oldValue===newValue)return false;return true;}},{key:"Interpolate",value:function Interpolate(time,start,end,propertyTrack){if(!end){var propertyTrackDataItem=propertyTrack.GetPropertyTrackDataItem();var propertyTrackData=propertyTrack.GetPropertyTrackData();propertyTrackDataItem=propertyTrackData.GetLastPropertyKeyframeDataItem(propertyTrackDataItem);return propertyTrackDataItem.GetValueWithResultMode();}return start.GetValueWithResultMode();}}]);return TextTypeAdapter;}();}// timelines/data/timelineDataManager.js
{'use strict';var _C113=self.C3;_C113.TimelineDataManager=/*#__PURE__*/function(){function TimelineDataManager(){_classCallCheck(this,TimelineDataManager);this._timelineDataItems=new Map();}_createClass(TimelineDataManager,[{key:"Release",value:function Release(){var _iteratorNormalCompletion273=true;var _didIteratorError273=false;var _iteratorError273=undefined;try{for(var _iterator273=this._timelineDataItems.values()[Symbol.iterator](),_step273;!(_iteratorNormalCompletion273=(_step273=_iterator273.next()).done);_iteratorNormalCompletion273=true){var timelineDataItem=_step273.value;timelineDataItem.Release();}}catch(err){_didIteratorError273=true;_iteratorError273=err;}finally{try{if(!_iteratorNormalCompletion273&&_iterator273["return"]!=null){_iterator273["return"]();}}finally{if(_didIteratorError273){throw _iteratorError273;}}}this._timelineDataItems.clear();this._timelineDataItems=null;}},{key:"Add",value:function Add(data){var timelineDataItem=new _C113.TimelineDataItem(data);var name=timelineDataItem.GetName();this._timelineDataItems.set(name,timelineDataItem);}},{key:"Get",value:function Get(name){return this._timelineDataItems.get(name);}},{key:"GetNameId",value:function GetNameId(){return 0;}}],[{key:"_CreateDataItems",value:function _CreateDataItems(items,jsonItems,dataItemConstructor,dataContainer){if(!jsonItems)return;var _iteratorNormalCompletion274=true;var _didIteratorError274=false;var _iteratorError274=undefined;try{for(var _iterator274=jsonItems[Symbol.iterator](),_step274;!(_iteratorNormalCompletion274=(_step274=_iterator274.next()).done);_iteratorNormalCompletion274=true){var jsonItem=_step274.value;_C113.TimelineDataManager._CreateDataItem("create",jsonItem,items,dataItemConstructor,dataContainer);}}catch(err){_didIteratorError274=true;_iteratorError274=err;}finally{try{if(!_iteratorNormalCompletion274&&_iterator274["return"]!=null){_iterator274["return"]();}}finally{if(_didIteratorError274){throw _iteratorError274;}}}}},{key:"_CreateDataItemsIncludingDisabled",value:function _CreateDataItemsIncludingDisabled(items,jsonItems,dataItemConstructor,dataContainer){if(!jsonItems)return;var _iteratorNormalCompletion275=true;var _didIteratorError275=false;var _iteratorError275=undefined;try{for(var _iterator275=jsonItems[Symbol.iterator](),_step275;!(_iteratorNormalCompletion275=(_step275=_iterator275.next()).done);_iteratorNormalCompletion275=true){var jsonItem=_step275.value;_C113.TimelineDataManager._CreateDataItem("create-including-disabled",jsonItem,items,dataItemConstructor,dataContainer);}}catch(err){_didIteratorError275=true;_iteratorError275=err;}finally{try{if(!_iteratorNormalCompletion275&&_iterator275["return"]!=null){_iterator275["return"]();}}finally{if(_didIteratorError275){throw _iteratorError275;}}}}},{key:"_LoadDataItemsFromJson",value:function _LoadDataItemsFromJson(items,jsonItems,dataItemConstructor,dataContainer){if(items.length)jsonItems.forEach(function(jsonItem,index){items[index]._LoadFromJson(jsonItem);});else jsonItems.forEach(function(jsonItem){_C113.TimelineDataManager._CreateDataItem("load",jsonItem,items,dataItemConstructor,dataContainer);});}},{key:"_CreateDataItem",value:function _CreateDataItem(mode,json,items,dataItemConstructor,dataContainer){var dataItem;if(typeof dataItemConstructor==="function")switch(mode){case"load":dataItem=new dataItemConstructor(null,dataContainer);break;case"create":dataItem=new dataItemConstructor(json,dataContainer);break;case"create-including-disabled":dataItem=new dataItemConstructor(json,dataContainer);break;}else if(_typeof(dataItemConstructor)==="object"){var prop=dataItemConstructor.prop;var value=json[prop];var cnstrctr=dataItemConstructor.map.get(value);switch(mode){case"load":dataItem=new cnstrctr(null,dataContainer);break;case"create":dataItem=new cnstrctr(json,dataContainer);break;case"create-including-disabled":dataItem=new cnstrctr(json,dataContainer);break;}}switch(mode){case"load":dataItem._LoadFromJson(json);items.push(dataItem);break;case"create":if(typeof dataItem.GetEnable==="function"&&!dataItem.GetEnable())return dataItem.Release();items.push(dataItem);break;case"create-including-disabled":items.push(dataItem);break;}}}]);return TimelineDataManager;}();}// timelines/data/timelineData.js
{'use strict';var _C114=self.C3;var _NAME2=0;var TOTAL_TIME=1;var STEP=2;var INTERPOLATION_MODE=3;var RESULT_MODE=4;var TRACKS=5;var LOOP=6;var PING_PONG=7;var REPEAT_COUNT=8;var START_ON_LAYOUT=9;var TRANSFORM_WITH_SCENE_GRAPH=10;var USE_SYSTEM_TIMESCALE=11;_C114.TimelineDataItem=/*#__PURE__*/function(){function TimelineDataItem(timelineDataJson){_classCallCheck(this,TimelineDataItem);this._name="";this._totalTime=NaN;this._step=0;this._interpolationMode="default";this._resultMode="default";this._loop=false;this._pingPong=false;this._repeatCount=1;this._trackData=null;this._startOnLayout="";this._transformWithSceneGraph=false;this._useSystemTimescale=true;if(!timelineDataJson)return;this._name=timelineDataJson[_NAME2];this._totalTime=timelineDataJson[TOTAL_TIME];this._step=timelineDataJson[STEP];this._interpolationMode=timelineDataJson[INTERPOLATION_MODE];this._resultMode=timelineDataJson[RESULT_MODE];this._loop=!!timelineDataJson[LOOP];this._pingPong=!!timelineDataJson[PING_PONG];this._repeatCount=timelineDataJson[REPEAT_COUNT];this._startOnLayout=timelineDataJson[START_ON_LAYOUT];this._transformWithSceneGraph=!!timelineDataJson[TRANSFORM_WITH_SCENE_GRAPH];this._useSystemTimescale=!!timelineDataJson[USE_SYSTEM_TIMESCALE];this._trackData=new _C114.TrackData(timelineDataJson[TRACKS],this);}_createClass(TimelineDataItem,[{key:"Release",value:function Release(){this._trackData.Release();this._trackData=null;}},{key:"GetTrackData",value:function GetTrackData(){if(!this._trackData)this._trackData=new _C114.TrackData(null,this);return this._trackData;}},{key:"GetName",value:function GetName(){return this._name;}},{key:"SetName",value:function SetName(n){this._name=n;}},{key:"GetTotalTime",value:function GetTotalTime(){return this._totalTime;}},{key:"SetTotalTime",value:function SetTotalTime(tt){this._totalTime=tt;}},{key:"GetStep",value:function GetStep(){return this._step;}},{key:"SetStep",value:function SetStep(s){this._step=s;}},{key:"GetInterpolationMode",value:function GetInterpolationMode(){return this._interpolationMode;}},{key:"SetInterpolationMode",value:function SetInterpolationMode(im){this._interpolationMode=im;}},{key:"GetResultMode",value:function GetResultMode(){return this._resultMode;}},{key:"SetResultMode",value:function SetResultMode(rm){this._resultMode=rm;}},{key:"GetLoop",value:function GetLoop(){return this._loop;}},{key:"SetLoop",value:function SetLoop(l){this._loop=l;}},{key:"GetPingPong",value:function GetPingPong(){return this._pingPong;}},{key:"SetPingPong",value:function SetPingPong(p){this._pingPong=p;}},{key:"GetRepeatCount",value:function GetRepeatCount(){return this._repeatCount;}},{key:"SetRepeatCount",value:function SetRepeatCount(rc){this._repeatCount=rc;}},{key:"GetStartOnLayout",value:function GetStartOnLayout(){return this._startOnLayout;}},{key:"GetTransformWithSceneGraph",value:function GetTransformWithSceneGraph(){return this._transformWithSceneGraph;}},{key:"GetUseSystemTimescale",value:function GetUseSystemTimescale(){return this._useSystemTimescale;}},{key:"_SaveToJson",value:function _SaveToJson(){return{"trackDataJson":this._trackData._SaveToJson(),"name":this._name,"totalTime":this._totalTime,"step":this._step,"interpolationMode":this._interpolationMode,"resultMode":this._resultMode,"loop":this._loop,"pingPong":this._pingPong,"repeatCount":this._repeatCount,"startOnLayout":this._startOnLayout,"transformWithSceneGraph":!!this._transformWithSceneGraph,"useSystemTimescale":this._useSystemTimescale};}},{key:"_LoadFromJson",value:function _LoadFromJson(o){if(!o)return;this.GetTrackData()._LoadFromJson(o["trackDataJson"]);this._name=o["name"];this._totalTime=o["totalTime"];this._step=o["step"];this._interpolationMode=o["interpolationMode"];this._resultMode=o["resultMode"];this._loop=o["loop"];this._pingPong=o["pingPong"];this._repeatCount=o["repeatCount"];this._startOnLayout=o["startOnLayout"];this._transformWithSceneGraph=!!o["transformWithSceneGraph"];this._useSystemTimescale=!!o["useSystemTimescale"];}}]);return TimelineDataItem;}();}// timelines/data/trackData.js
{'use strict';var _C115=self.C3;var WI_DATA=0;var OC_INDEX=1;var WI_UID=2;var _INTERPOLATION_MODE=1;var _RESULT_MODE=2;var ENABLED=3;var KEYFRAMES=4;var PROPERTY_TRACKS=5;var ID=6;var NESTED_DATA=7;var _START_OFFSET=0;var LOCAL_TOTAL_TIME=1;var WI_ADDITIONAL_DATA=8;var ORIGINAL_WIDTH=0;var ORIGINAL_HEIGHT=1;var TRACK_TYPE=9;var TRACK_NAME=10;var TrackDataItem=/*#__PURE__*/function(){function TrackDataItem(trackDataJson,trackData){_classCallCheck(this,TrackDataItem);this._trackData=trackData;this._instanceData=null;this._additionalInstanceData=null;this._instanceUid=NaN;this._objectClassIndex=NaN;this._interpolationMode="default";this._resultMode="default";this._enabled=false;this._keyframeData=null;this._propertyTrackData=null;this._id="";this._nestedData=null;this._startOffset=0;this._localTotalTime=this._trackData.GetTimelineDataItem().GetTotalTime();this._type=0;this._name="";if(!trackDataJson)return;if(trackDataJson[WI_DATA]){this._instanceData=trackDataJson[WI_DATA];this._instanceUid=trackDataJson[WI_DATA][WI_UID];this._objectClassIndex=trackDataJson[WI_DATA][OC_INDEX];}this._interpolationMode=trackDataJson[_INTERPOLATION_MODE];this._resultMode=trackDataJson[_RESULT_MODE];this._enabled=!!trackDataJson[ENABLED];if(trackDataJson[ID])this._id=trackDataJson[ID];if(trackDataJson[NESTED_DATA]){this._nestedData=trackDataJson[NESTED_DATA];this._startOffset=trackDataJson[NESTED_DATA][_START_OFFSET];this._localTotalTime=trackDataJson[NESTED_DATA][LOCAL_TOTAL_TIME];}if(trackDataJson[WI_ADDITIONAL_DATA])this._additionalInstanceData=trackDataJson[WI_ADDITIONAL_DATA];if(trackDataJson[WI_ADDITIONAL_DATA])this._additionalInstanceData=trackDataJson[WI_ADDITIONAL_DATA];if(trackDataJson[TRACK_TYPE])this._type=trackDataJson[TRACK_TYPE];if(trackDataJson[TRACK_NAME])this._name=trackDataJson[TRACK_NAME];this._keyframeData=new _C115.KeyframeData(trackDataJson[KEYFRAMES],this);this._propertyTrackData=new _C115.PropertyTrackData(trackDataJson[PROPERTY_TRACKS],this);}_createClass(TrackDataItem,[{key:"Release",value:function Release(){this._instanceData=null;this._trackData=null;if(this._keyframeData){this._keyframeData.Release();this._keyframeData=null;}if(this._propertyTrackData){this._propertyTrackData.Release();this._propertyTrackData=null;}this._nestedData=null;}},{key:"GetTrackData",value:function GetTrackData(){return this._trackData;}},{key:"GetKeyframeData",value:function GetKeyframeData(){if(!this._keyframeData)this._keyframeData=new _C115.KeyframeData(null,this);return this._keyframeData;}},{key:"GetPropertyTrackData",value:function GetPropertyTrackData(){if(!this._propertyTrackData)this._propertyTrackData=new _C115.PropertyTrackData(null,this);return this._propertyTrackData;}},{key:"GetInstanceData",value:function GetInstanceData(){return this._instanceData;}},{key:"GetObjectClassIndex",value:function GetObjectClassIndex(){return this._objectClassIndex;}},{key:"SetObjectClassIndex",value:function SetObjectClassIndex(index){this._objectClassIndex=index;}},{key:"GetInstanceUID",value:function GetInstanceUID(){return this._instanceUid;}},{key:"SetInstanceUID",value:function SetInstanceUID(uid){this._instanceUid=uid;}},{key:"GetInterpolationMode",value:function GetInterpolationMode(){return this._interpolationMode;}},{key:"SetInterpolationMode",value:function SetInterpolationMode(im){this._interpolationMode=im;}},{key:"GetResultMode",value:function GetResultMode(){return this._resultMode;}},{key:"SetResultMode",value:function SetResultMode(rm){this._resultMode=rm;}},{key:"GetEnable",value:function GetEnable(){return this._enabled;}},{key:"SetEnable",value:function SetEnable(e){this._enabled=!!e;}},{key:"GetId",value:function GetId(){return this._id;}},{key:"GetStartOffset",value:function GetStartOffset(){return this._startOffset;}},{key:"GetLocalTotalTime",value:function GetLocalTotalTime(){return this._localTotalTime;}},{key:"SetLocalTotalTime",value:function SetLocalTotalTime(t){this._localTotalTime=t;}},{key:"GetOriginalWidth",value:function GetOriginalWidth(){return this._additionalInstanceData[ORIGINAL_WIDTH];}},{key:"SetOriginalWidth",value:function SetOriginalWidth(w){if(!this._additionalInstanceData)this._additionalInstanceData=[];this._additionalInstanceData[ORIGINAL_WIDTH]=w;}},{key:"GetOriginalHeight",value:function GetOriginalHeight(){if(!this._additionalInstanceData)this._additionalInstanceData=[];return this._additionalInstanceData[ORIGINAL_HEIGHT];}},{key:"SetOriginalHeight",value:function SetOriginalHeight(h){if(!this._additionalInstanceData)this._additionalInstanceData=[];this._additionalInstanceData[ORIGINAL_HEIGHT]=h;}},{key:"GetType",value:function GetType(){return this._type;}},{key:"GetName",value:function GetName(){return this._name;}},{key:"_SaveToJson",value:function _SaveToJson(){return{"keyframeDataJson":this._keyframeData._SaveToJson(),"propertyTrackDataJson":this._propertyTrackData._SaveToJson(),"instanceData":this._instanceData,"additionalInstanceData":this._additionalInstanceData,"instanceUid":this._instanceUid,"objectClassIndex":this._objectClassIndex,"interpolationMode":this._interpolationMode,"resultMode":this._resultMode,"enabled":this._enabled,"id":this._id,"nestedData":this._nestedData,"type":this._type,"name":this._name};}},{key:"_LoadFromJson",value:function _LoadFromJson(o){if(!o)return;this._instanceData=o["instanceData"];this._instanceUid=o["instanceUid"];this._objectClassIndex=o["objectClassIndex"];this._interpolationMode=o["interpolationMode"];this._resultMode=o["resultMode"];this._enabled=o["enabled"];this._id=o["id"];this._type=o["type"]?o["type"]:0;this._name=o["name"]?o["name"]:"";this._localTotalTime=this._trackData.GetTimelineDataItem().GetTotalTime();if(o["nestedData"]){this._nestedData=o["nestedData"];this._startOffset=this._nestedData[_START_OFFSET];this._localTotalTime=this._nestedData[LOCAL_TOTAL_TIME];}if(o["additionalInstanceData"])this._additionalInstanceData=o["additionalInstanceData"];this.GetKeyframeData()._LoadFromJson(o["keyframeDataJson"]);this.GetPropertyTrackData()._LoadFromJson(o["propertyTrackDataJson"]);}}]);return TrackDataItem;}();_C115.TrackData=/*#__PURE__*/function(){function TrackData(tracksDataJson,timelineDataItem){_classCallCheck(this,TrackData);this._timelineDataItem=timelineDataItem;this._trackDataItems=[];_C115.TimelineDataManager._CreateDataItems(this._trackDataItems,tracksDataJson,TrackDataItem,this);}_createClass(TrackData,[{key:"Release",value:function Release(){this._timelineDataItem=null;var _iteratorNormalCompletion276=true;var _didIteratorError276=false;var _iteratorError276=undefined;try{for(var _iterator276=this._trackDataItems[Symbol.iterator](),_step276;!(_iteratorNormalCompletion276=(_step276=_iterator276.next()).done);_iteratorNormalCompletion276=true){var trackDataItem=_step276.value;trackDataItem.Release();}}catch(err){_didIteratorError276=true;_iteratorError276=err;}finally{try{if(!_iteratorNormalCompletion276&&_iterator276["return"]!=null){_iterator276["return"]();}}finally{if(_didIteratorError276){throw _iteratorError276;}}}_C115.clearArray(this._trackDataItems);this._trackDataItems=null;}},{key:"GetTimelineDataItem",value:function GetTimelineDataItem(){return this._timelineDataItem;}},{key:"AddEmptyTrackDataItem",value:function AddEmptyTrackDataItem(){var trackDataItem=new TrackDataItem(null,this);this._trackDataItems.push(trackDataItem);return trackDataItem;}},{key:"GetFirstKeyframeDataItem",value:function GetFirstKeyframeDataItem(trackDataItem){return trackDataItem.GetKeyframeData().GetKeyframeDataItemArray()[0];}},{key:"GetLastKeyframeDataItem",value:function GetLastKeyframeDataItem(trackDataItem){var keyframeDataItems=trackDataItem.GetKeyframeData().GetKeyframeDataItemArray();return keyframeDataItems.at(-1);}},{key:"GetKeyFrameDataItemAtTime",value:function GetKeyFrameDataItemAtTime(time,trackDataItem){var keyframeDataItems=trackDataItem.GetKeyframeData().GetKeyframeDataItemArray();var l=keyframeDataItems.length;for(var i=0;i<l;i++){var keyframeDataItem=keyframeDataItems[i];if(keyframeDataItem.GetTime()===time)return keyframeDataItem;}}},{key:"GetFirstKeyFrameDataItemHigherThan",value:function GetFirstKeyFrameDataItemHigherThan(time,trackDataItem){var keyframeDataItems=trackDataItem.GetKeyframeData().GetKeyframeDataItemArray();var l=keyframeDataItems.length;for(var i=0;i<l;i++){var keyframeDataItem=keyframeDataItems[i];if(keyframeDataItem.GetTime()>time)return keyframeDataItem;}}},{key:"GetFirstKeyFrameDataItemHigherOrEqualThan",value:function GetFirstKeyFrameDataItemHigherOrEqualThan(time,trackDataItem){var keyframeDataItems=trackDataItem.GetKeyframeData().GetKeyframeDataItemArray();var l=keyframeDataItems.length;for(var i=0;i<l;i++){var keyframeDataItem=keyframeDataItems[i];if(keyframeDataItem.GetTime()>=time)return keyframeDataItem;}}},{key:"GetFirstKeyFrameDataItemLowerOrEqualThan",value:function GetFirstKeyFrameDataItemLowerOrEqualThan(time,trackDataItem){var keyframeDataItems=trackDataItem.GetKeyframeData().GetKeyframeDataItemArray();for(var i=keyframeDataItems.length-1;i>=0;i--){var keyframeDataItem=keyframeDataItems[i];if(keyframeDataItem.GetTime()<=time)return keyframeDataItem;}}},{key:"trackDataItems",value:/*#__PURE__*/regeneratorRuntime.mark(function trackDataItems(){var _iteratorNormalCompletion277,_didIteratorError277,_iteratorError277,_iterator277,_step277,trackDataItem;return regeneratorRuntime.wrap(function trackDataItems$(_context92){while(1){switch(_context92.prev=_context92.next){case 0:_iteratorNormalCompletion277=true;_didIteratorError277=false;_iteratorError277=undefined;_context92.prev=3;_iterator277=this._trackDataItems[Symbol.iterator]();case 5:if(_iteratorNormalCompletion277=(_step277=_iterator277.next()).done){_context92.next=12;break;}trackDataItem=_step277.value;_context92.next=9;return trackDataItem;case 9:_iteratorNormalCompletion277=true;_context92.next=5;break;case 12:_context92.next=18;break;case 14:_context92.prev=14;_context92.t0=_context92["catch"](3);_didIteratorError277=true;_iteratorError277=_context92.t0;case 18:_context92.prev=18;_context92.prev=19;if(!_iteratorNormalCompletion277&&_iterator277["return"]!=null){_iterator277["return"]();}case 21:_context92.prev=21;if(!_didIteratorError277){_context92.next=24;break;}throw _iteratorError277;case 24:return _context92.finish(21);case 25:return _context92.finish(18);case 26:case"end":return _context92.stop();}}},trackDataItems,this,[[3,14,18,26],[19,,21,25]]);})},{key:"_SaveToJson",value:function _SaveToJson(){return{"trackDataItemsJson":this._trackDataItems.map(function(trackDataItem){return trackDataItem._SaveToJson();})};}},{key:"_LoadFromJson",value:function _LoadFromJson(o){if(!o)return;_C115.TimelineDataManager._LoadDataItemsFromJson(this._trackDataItems,o["trackDataItemsJson"],TrackDataItem,this);}}]);return TrackData;}();}// timelines/data/propertyTrackData.js
{'use strict';var _C116=self.C3;var SOURCE_DATA=0;var SOURCE=0;var PROPERTY=1;var TYPE=2;var MIN=3;var MAX=4;var _INTERPOLATION_MODE2=5;var _RESULT_MODE2=6;var _ENABLED=7;var PROPERTY_KEYFRAMES=8;var CAN_HAVE_PROPERTY_KEYFRAMES=9;var PropertyTrackDataItem=/*#__PURE__*/function(){function PropertyTrackDataItem(propertyTrackDataJson,propertyTrackData){_classCallCheck(this,PropertyTrackDataItem);this._propertyTrackData=propertyTrackData;this._sourceAdapterId="";this._sourceAdapterArguments=null;this._property=null;this._type=null;this._min=NaN;this._max=NaN;this._interpolationMode="default";this._resultMode="default";this._enabled=false;this._propertyKeyframeData=null;this._canHavePropertyKeyframes=true;if(!propertyTrackDataJson)return;this._sourceAdapterId=propertyTrackDataJson[SOURCE_DATA][SOURCE];this._sourceAdapterArguments=propertyTrackDataJson[SOURCE_DATA].slice(1);this._property=propertyTrackDataJson[PROPERTY];this._type=propertyTrackDataJson[TYPE];this._min=propertyTrackDataJson[MIN];this._max=propertyTrackDataJson[MAX];this._interpolationMode=propertyTrackDataJson[_INTERPOLATION_MODE2];this._resultMode=propertyTrackDataJson[_RESULT_MODE2];this._enabled=!!propertyTrackDataJson[_ENABLED];this._propertyKeyframeData=new _C116.PropertyKeyframeData(propertyTrackDataJson[PROPERTY_KEYFRAMES],this);this._canHavePropertyKeyframes=propertyTrackDataJson[CAN_HAVE_PROPERTY_KEYFRAMES];}_createClass(PropertyTrackDataItem,[{key:"Release",value:function Release(){this._propertyKeyframeData.Release();this._propertyKeyframeData=null;this._propertyTrackData=null;this._sourceAdapterArguments=null;}},{key:"GetPropertyTrackData",value:function GetPropertyTrackData(){return this._propertyTrackData;}},{key:"GetPropertyKeyframeData",value:function GetPropertyKeyframeData(){if(!this._propertyKeyframeData)this._propertyKeyframeData=new _C116.PropertyKeyframeData(null,this);return this._propertyKeyframeData;}},{key:"GetSourceAdapterId",value:function GetSourceAdapterId(){return this._sourceAdapterId;}},{key:"SetSourceAdapterId",value:function SetSourceAdapterId(said){this._sourceAdapterId=said;}},{key:"GetSourceAdapterArguments",value:function GetSourceAdapterArguments(){return this._sourceAdapterArguments;}},{key:"SetSourceAdapterArguments",value:function SetSourceAdapterArguments(sargs){this._sourceAdapterArguments=sargs;}},{key:"GetProperty",value:function GetProperty(){return this._property;}},{key:"SetProperty",value:function SetProperty(p){this._property=p;}},{key:"GetType",value:function GetType(){return this._type;}},{key:"SetType",value:function SetType(t){this._type=t;}},{key:"GetMin",value:function GetMin(){return this._min;}},{key:"SetMin",value:function SetMin(min){this._min=min;}},{key:"GetMax",value:function GetMax(){return this._max;}},{key:"SetMax",value:function SetMax(max){this._max=max;}},{key:"GetInterpolationMode",value:function GetInterpolationMode(){return this._interpolationMode;}},{key:"SetInterpolationMode",value:function SetInterpolationMode(im){this._interpolationMode=im;}},{key:"GetResultMode",value:function GetResultMode(){return this._resultMode;}},{key:"SetResultMode",value:function SetResultMode(rm){this._resultMode=rm;}},{key:"GetEnable",value:function GetEnable(){return this._enabled;}},{key:"SetEnable",value:function SetEnable(e){this._enabled=!!e;}},{key:"CanHavePropertyKeyframes",value:function CanHavePropertyKeyframes(){return!!this._canHavePropertyKeyframes;}},{key:"_SaveToJson",value:function _SaveToJson(){return{"propertyKeyframeDataJson":this._propertyKeyframeData._SaveToJson(),"sourceAdapterId":this._sourceAdapterId,"sourceAdapterArguments":this._sourceAdapterArguments,"property":this._property,"type":this._type,"min":this._min,"max":this._max,"interpolationMode":this._interpolationMode,"resultMode":this._resultMode,"enabled":this._enabled,"canHavePropertyKeyframes":this._canHavePropertyKeyframes};}},{key:"_LoadFromJson",value:function _LoadFromJson(o){if(!o)return;this._sourceAdapterId=o["sourceAdapterId"];this._sourceAdapterArguments=o["sourceAdapterArguments"];this._property=o["property"];this._type=o["type"];this._min=o["min"];this._max=o["max"];this._interpolationMode=o["interpolationMode"];this._resultMode=o["resultMode"];this._enabled=o["enabled"];this._canHavePropertyKeyframes=o["canHavePropertyKeyframes"];this.GetPropertyKeyframeData()._LoadFromJson(o["propertyKeyframeDataJson"]);}}]);return PropertyTrackDataItem;}();_C116.PropertyTrackData=/*#__PURE__*/function(){function PropertyTrackData(propertyTracksDataJson,trackDataItem){_classCallCheck(this,PropertyTrackData);this._trackDataItem=trackDataItem;this._propertyTrackDataItems=[];_C116.TimelineDataManager._CreateDataItems(this._propertyTrackDataItems,propertyTracksDataJson,PropertyTrackDataItem,this);}_createClass(PropertyTrackData,[{key:"Release",value:function Release(){this._trackDataItem=null;var _iteratorNormalCompletion278=true;var _didIteratorError278=false;var _iteratorError278=undefined;try{for(var _iterator278=this._propertyTrackDataItems[Symbol.iterator](),_step278;!(_iteratorNormalCompletion278=(_step278=_iterator278.next()).done);_iteratorNormalCompletion278=true){var propertyTrackDataItem=_step278.value;propertyTrackDataItem.Release();}}catch(err){_didIteratorError278=true;_iteratorError278=err;}finally{try{if(!_iteratorNormalCompletion278&&_iterator278["return"]!=null){_iterator278["return"]();}}finally{if(_didIteratorError278){throw _iteratorError278;}}}_C116.clearArray(this._propertyTrackDataItems);this._propertyTrackDataItems=null;}},{key:"GetTrackDataItem",value:function GetTrackDataItem(){return this._trackDataItem;}},{key:"AddEmptyPropertyTrackDataItem",value:function AddEmptyPropertyTrackDataItem(){var propertyTrackDataItem=new PropertyTrackDataItem(null,this);this._propertyTrackDataItems.push(propertyTrackDataItem);return propertyTrackDataItem;}},{key:"GetFirstPropertyKeyframeDataItem",value:function GetFirstPropertyKeyframeDataItem(propertyTrackDataItem){var propertyKeyframeData=propertyTrackDataItem.GetPropertyKeyframeData();return propertyKeyframeData.GetPropertyKeyframeDataItemArray()[0];}},{key:"GetLastPropertyKeyframeDataItem",value:function GetLastPropertyKeyframeDataItem(propertyTrackDataItem){var propertyKeyframeData=propertyTrackDataItem.GetPropertyKeyframeData();var propertyKeyframeDataItems=propertyKeyframeData.GetPropertyKeyframeDataItemArray();return propertyKeyframeDataItems.at(-1);}},{key:"GetPropertyKeyFrameDataItemAtTime",value:function GetPropertyKeyFrameDataItemAtTime(time,propertyTrackDataItem){var propertyKeyframeData=propertyTrackDataItem.GetPropertyKeyframeData();var propertyKeyframeDataItems=propertyKeyframeData.GetPropertyKeyframeDataItemArray();var l=propertyKeyframeDataItems.length;for(var i=0;i<l;i++){var propertyKeyframeDataItem=propertyKeyframeDataItems[i];if(propertyKeyframeDataItem.GetTime()===time)return propertyKeyframeDataItem;}}},{key:"GetFirstPropertyKeyFrameDataItemHigherThan",value:function GetFirstPropertyKeyFrameDataItemHigherThan(time,propertyTrackDataItem){var propertyKeyframeData=propertyTrackDataItem.GetPropertyKeyframeData();var propertyKeyframeDataItems=propertyKeyframeData.GetPropertyKeyframeDataItemArray();var l=propertyKeyframeDataItems.length;for(var i=0;i<l;i++){var propertyKeyframeDataItem=propertyKeyframeDataItems[i];if(propertyKeyframeDataItem.GetTime()>time)return propertyKeyframeDataItem;}}},{key:"GetFirstPropertyKeyFrameDataItemHigherOrEqualThan",value:function GetFirstPropertyKeyFrameDataItemHigherOrEqualThan(time,propertyTrackDataItem){var propertyKeyframeData=propertyTrackDataItem.GetPropertyKeyframeData();var propertyKeyframeDataItems=propertyKeyframeData.GetPropertyKeyframeDataItemArray();var l=propertyKeyframeDataItems.length;for(var i=0;i<l;i++){var propertyKeyframeDataItem=propertyKeyframeDataItems[i];if(propertyKeyframeDataItem.GetTime()>=time)return propertyKeyframeDataItem;}}},{key:"GetFirstPropertyKeyFrameDataItemLowerOrEqualThan",value:function GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(time,propertyTrackDataItem){var propertyKeyframeData=propertyTrackDataItem.GetPropertyKeyframeData();var propertyKeyframeDataItems=propertyKeyframeData.GetPropertyKeyframeDataItemArray();for(var i=propertyKeyframeDataItems.length-1;i>=0;i--){var propertyKeyframeDataItem=propertyKeyframeDataItems[i];if(propertyKeyframeDataItem.GetTime()<=time)return propertyKeyframeDataItem;}}},{key:"propertyTrackDataItems",value:/*#__PURE__*/regeneratorRuntime.mark(function propertyTrackDataItems(){var _iteratorNormalCompletion279,_didIteratorError279,_iteratorError279,_iterator279,_step279,propertyTrackDataItem;return regeneratorRuntime.wrap(function propertyTrackDataItems$(_context93){while(1){switch(_context93.prev=_context93.next){case 0:_iteratorNormalCompletion279=true;_didIteratorError279=false;_iteratorError279=undefined;_context93.prev=3;_iterator279=this._propertyTrackDataItems[Symbol.iterator]();case 5:if(_iteratorNormalCompletion279=(_step279=_iterator279.next()).done){_context93.next=12;break;}propertyTrackDataItem=_step279.value;_context93.next=9;return propertyTrackDataItem;case 9:_iteratorNormalCompletion279=true;_context93.next=5;break;case 12:_context93.next=18;break;case 14:_context93.prev=14;_context93.t0=_context93["catch"](3);_didIteratorError279=true;_iteratorError279=_context93.t0;case 18:_context93.prev=18;_context93.prev=19;if(!_iteratorNormalCompletion279&&_iterator279["return"]!=null){_iterator279["return"]();}case 21:_context93.prev=21;if(!_didIteratorError279){_context93.next=24;break;}throw _iteratorError279;case 24:return _context93.finish(21);case 25:return _context93.finish(18);case 26:case"end":return _context93.stop();}}},propertyTrackDataItems,this,[[3,14,18,26],[19,,21,25]]);})},{key:"_SaveToJson",value:function _SaveToJson(){return{"propertyTrackDataItemsJson":this._propertyTrackDataItems.map(function(propertyTrackDataItem){return propertyTrackDataItem._SaveToJson();})};}},{key:"_LoadFromJson",value:function _LoadFromJson(o){if(!o)return;_C116.TimelineDataManager._LoadDataItemsFromJson(this._propertyTrackDataItems,o["propertyTrackDataItemsJson"],PropertyTrackDataItem,this);}}]);return PropertyTrackData;}();}// timelines/data/keyframeData.js
{'use strict';var _C117=self.C3;var TIME=0;var EASE=1;var ENABLE=2;var TAGS=3;var KeyframeDataItem=/*#__PURE__*/function(){function KeyframeDataItem(keyframeDataJson,keyframeData){_classCallCheck(this,KeyframeDataItem);this._keyframeData=keyframeData;this._time=-1;this._ease="noease";this._enable=false;this._tags=null;this._lowerTags=null;if(!keyframeDataJson)return;this._time=keyframeDataJson[TIME];this._ease=keyframeDataJson[EASE];this._enable=!!keyframeDataJson[ENABLE];var tagStr=keyframeDataJson[TAGS];this._tags=tagStr?tagStr.split(" "):[];this._lowerTags=new Set(this._tags.map(function(t){return t.toLowerCase();}));this._next=null;}_createClass(KeyframeDataItem,[{key:"Release",value:function Release(){this._keyframeData=null;_C117.clearArray(this._tags);this._tags=null;this._lowerTags.clear();this._lowerTags=null;this._next=null;}},{key:"GetKeyframeData",value:function GetKeyframeData(){return this._keyframeData;}},{key:"GetNext",value:function GetNext(){return this._next;}},{key:"SetNext",value:function SetNext(next){this._next=next;}},{key:"GetTime",value:function GetTime(){return this._time;}},{key:"SetTime",value:function SetTime(t){this._time=t;this._keyframeData._LinkKeyframeDataItems();}},{key:"GetEase",value:function GetEase(){return this._ease;}},{key:"SetEase",value:function SetEase(e){this._ease=e;}},{key:"GetEnable",value:function GetEnable(){return this._enable;}},{key:"SetEnable",value:function SetEnable(e){this._enable=!!e;}},{key:"GetTags",value:function GetTags(){return this._tags;}},{key:"SetTags",value:function SetTags(t){this._tags=t?t.split(" "):[];this._lowerTags=new Set(this._tags.map(function(t){return t.toLowerCase();}));}},{key:"GetLowerTags",value:function GetLowerTags(){return this._lowerTags;}},{key:"HasTag",value:function HasTag(tag){return this._lowerTags.has(tag.toLowerCase());}},{key:"_SaveToJson",value:function _SaveToJson(){return{"time":this._time,"ease":this._ease,"enable":this._enable,"tags":this._tags};}},{key:"_LoadFromJson",value:function _LoadFromJson(o){if(!o)return;this._time=o["time"];this._ease=o["ease"];this._enable=o["enable"];this._tags=o["tags"];this._lowerTags=new Set(this._tags.map(function(t){return t.toLowerCase();}));}}]);return KeyframeDataItem;}();_C117.KeyframeData=/*#__PURE__*/function(){function KeyframeData(keyframesDataJson,trackDataItem){_classCallCheck(this,KeyframeData);this._trackDataItem=trackDataItem;this._keyframeDataItems=[];_C117.TimelineDataManager._CreateDataItems(this._keyframeDataItems,keyframesDataJson,KeyframeDataItem,this);this._LinkKeyframeDataItems();}_createClass(KeyframeData,[{key:"Release",value:function Release(){this._trackDataItem=null;var _iteratorNormalCompletion280=true;var _didIteratorError280=false;var _iteratorError280=undefined;try{for(var _iterator280=this._keyframeDataItems[Symbol.iterator](),_step280;!(_iteratorNormalCompletion280=(_step280=_iterator280.next()).done);_iteratorNormalCompletion280=true){var keyframeDataItem=_step280.value;keyframeDataItem.Release();}}catch(err){_didIteratorError280=true;_iteratorError280=err;}finally{try{if(!_iteratorNormalCompletion280&&_iterator280["return"]!=null){_iterator280["return"]();}}finally{if(_didIteratorError280){throw _iteratorError280;}}}_C117.clearArray(this._keyframeDataItems);this._keyframeDataItems=null;}},{key:"_LinkKeyframeDataItems",value:function _LinkKeyframeDataItems(){this._keyframeDataItems.sort(function(first,second){return first.GetTime()-second.GetTime();});for(var i=0;i<this._keyframeDataItems.length;i++){var current=this._keyframeDataItems[i];current.SetNext(this._keyframeDataItems[i+1]);}}},{key:"GetTrackDataItem",value:function GetTrackDataItem(){return this._trackDataItem;}},{key:"GetKeyframeDataItemCount",value:function GetKeyframeDataItemCount(){return this._keyframeDataItems.length;}},{key:"GetKeyframeDataItemArray",value:function GetKeyframeDataItemArray(){return this._keyframeDataItems;}},{key:"AddEmptyKeyframeDataItem",value:function AddEmptyKeyframeDataItem(){var keyframeDataItem=new KeyframeDataItem(null,this);this._keyframeDataItems.push(keyframeDataItem);this._LinkKeyframeDataItems();return keyframeDataItem;}},{key:"DeleteKeyframeDataItems",value:function DeleteKeyframeDataItems(match){var _iteratorNormalCompletion281=true;var _didIteratorError281=false;var _iteratorError281=undefined;try{for(var _iterator281=this._keyframeDataItems[Symbol.iterator](),_step281;!(_iteratorNormalCompletion281=(_step281=_iterator281.next()).done);_iteratorNormalCompletion281=true){var keyframeDataItem=_step281.value;if(!match(keyframeDataItem))continue;var index=this._keyframeDataItems.indexOf(keyframeDataItem);if(index===-1)continue;keyframeDataItem.Release();this._keyframeDataItems.splice(index,1);}}catch(err){_didIteratorError281=true;_iteratorError281=err;}finally{try{if(!_iteratorNormalCompletion281&&_iterator281["return"]!=null){_iterator281["return"]();}}finally{if(_didIteratorError281){throw _iteratorError281;}}}this.SortKeyframeDataItems();this._LinkKeyframeDataItems();}},{key:"SortKeyframeDataItems",value:function SortKeyframeDataItems(){this._keyframeDataItems.sort(function(a,b){return a.GetTime()-b.GetTime();});}},{key:"GetKeyframeDataItemIndex",value:function GetKeyframeDataItemIndex(keyframeDataItem){return this._keyframeDataItems.indexOf(keyframeDataItem);}},{key:"GetKeyframeDataItemFromIndex",value:function GetKeyframeDataItemFromIndex(index){return this._keyframeDataItems[index];}},{key:"keyframeDataItems",value:/*#__PURE__*/regeneratorRuntime.mark(function keyframeDataItems(){var _iteratorNormalCompletion282,_didIteratorError282,_iteratorError282,_iterator282,_step282,keyframeDataItem;return regeneratorRuntime.wrap(function keyframeDataItems$(_context94){while(1){switch(_context94.prev=_context94.next){case 0:_iteratorNormalCompletion282=true;_didIteratorError282=false;_iteratorError282=undefined;_context94.prev=3;_iterator282=this._keyframeDataItems[Symbol.iterator]();case 5:if(_iteratorNormalCompletion282=(_step282=_iterator282.next()).done){_context94.next=12;break;}keyframeDataItem=_step282.value;_context94.next=9;return keyframeDataItem;case 9:_iteratorNormalCompletion282=true;_context94.next=5;break;case 12:_context94.next=18;break;case 14:_context94.prev=14;_context94.t0=_context94["catch"](3);_didIteratorError282=true;_iteratorError282=_context94.t0;case 18:_context94.prev=18;_context94.prev=19;if(!_iteratorNormalCompletion282&&_iterator282["return"]!=null){_iterator282["return"]();}case 21:_context94.prev=21;if(!_didIteratorError282){_context94.next=24;break;}throw _iteratorError282;case 24:return _context94.finish(21);case 25:return _context94.finish(18);case 26:case"end":return _context94.stop();}}},keyframeDataItems,this,[[3,14,18,26],[19,,21,25]]);})},{key:"keyframeDataItemsReverse",value:/*#__PURE__*/regeneratorRuntime.mark(function keyframeDataItemsReverse(){var i;return regeneratorRuntime.wrap(function keyframeDataItemsReverse$(_context95){while(1){switch(_context95.prev=_context95.next){case 0:i=this._keyframeDataItems.length-1;case 1:if(!(i>=0)){_context95.next=7;break;}_context95.next=4;return this._keyframeDataItems[i];case 4:i--;_context95.next=1;break;case 7:case"end":return _context95.stop();}}},keyframeDataItemsReverse,this);})},{key:"_SaveToJson",value:function _SaveToJson(){return{"keyframeDataItemsJson":this._keyframeDataItems.map(function(keyframeDataItem){return keyframeDataItem._SaveToJson();})};}},{key:"_LoadFromJson",value:function _LoadFromJson(o){if(!o)return;_C117.TimelineDataManager._LoadDataItemsFromJson(this._keyframeDataItems,o["keyframeDataItemsJson"],KeyframeDataItem,this);this._LinkKeyframeDataItems();}}]);return KeyframeData;}();}// timelines/data/propertyKeyframeData.js
{'use strict';var _C118=self.C3;var VALUE_DATA=0;var VALUE_DATA_VALUE=0;var VALUE_DATA_ABSOLUTE_VALUE=1;var VALUE_DATA_TYPE=2;var _TIME=1;var _EASE=2;var _ENABLE=3;var ADDONS=4;var PATH_MODE=5;var PropertyKeyframeDataItem=/*#__PURE__*/function(){function PropertyKeyframeDataItem(propertyKeyframeDataJson,propertyKeyframeData){_classCallCheck(this,PropertyKeyframeDataItem);this._propertyKeyframeData=propertyKeyframeData;this._value=null;this._aValue=null;this._type="";this._time=NaN;this._ease="noease";this._enable=false;this._addonData=null;this._addonInstance=undefined;this._pathMode="line";if(!propertyKeyframeDataJson)return;this._value=propertyKeyframeDataJson[VALUE_DATA][VALUE_DATA_VALUE];this._aValue=propertyKeyframeDataJson[VALUE_DATA][VALUE_DATA_ABSOLUTE_VALUE];this._type=propertyKeyframeDataJson[VALUE_DATA][VALUE_DATA_TYPE];this._time=propertyKeyframeDataJson[_TIME];this._ease=propertyKeyframeDataJson[_EASE];this._enable=!!propertyKeyframeDataJson[_ENABLE];this._pathMode=propertyKeyframeDataJson[PATH_MODE];this._addonData=null;if(!!propertyKeyframeDataJson[ADDONS])this._addonData=new _C118.AddonData(propertyKeyframeDataJson[ADDONS],this);this._next=null;this._prev=null;}_createClass(PropertyKeyframeDataItem,[{key:"Release",value:function Release(){this._propertyKeyframeData=null;if(this._addonData){this._addonData.Release();this._addonData=null;}this._next=null;this._prev=null;}},{key:"GetAddonData",value:function GetAddonData(){return this._addonData;}},{key:"SetNext",value:function SetNext(next){this._next=next;}},{key:"GetNext",value:function GetNext(){return this._next;}},{key:"SetPrevious",value:function SetPrevious(prev){this._prev=prev;}},{key:"GetPrevious",value:function GetPrevious(){return this._prev;}},{key:"GetValue",value:function GetValue(){return this._value;}},{key:"SetValue",value:function SetValue(value){if(this._type==="color"&&_C118.IsFiniteNumber(value)){this._value[0]=_C118.GetRValue(value);this._value[1]=_C118.GetGValue(value);this._value[2]=_C118.GetBValue(value);}else this._value=value;}},{key:"GetAbsoluteValue",value:function GetAbsoluteValue(){return this._aValue;}},{key:"SetAbsoluteValue",value:function SetAbsoluteValue(aValue){if(this._type==="color"&&_C118.IsFiniteNumber(aValue)){this._aValue[0]=_C118.GetRValue(aValue);this._aValue[1]=_C118.GetGValue(aValue);this._aValue[2]=_C118.GetBValue(aValue);}else this._aValue=aValue;}},{key:"GetValueWithResultMode",value:function GetValueWithResultMode(){var rm=this._propertyKeyframeData.GetPropertyTrackDataItem().GetResultMode();if(rm==="relative")return this.GetValue();else if(rm==="absolute")return this.GetAbsoluteValue();}},{key:"GetType",value:function GetType(){return this._type;}},{key:"SetType",value:function SetType(t){this._type=t;}},{key:"GetTime",value:function GetTime(){return this._time;}},{key:"SetTime",value:function SetTime(t){this._time=t;this._propertyKeyframeData._LinkPropertyKeyframeDataItems();}},{key:"GetEase",value:function GetEase(){return this._ease;}},{key:"SetEase",value:function SetEase(e){this._ease=e;}},{key:"GetEnable",value:function GetEnable(){return this._enable;}},{key:"SetEnable",value:function SetEnable(e){this._enable=!!e;}},{key:"GetPathMode",value:function GetPathMode(){return this._pathMode;}},{key:"GetAddOn",value:function GetAddOn(id){if(!this._addonData)return;if(this._addonInstance||this._addonInstance===null)return this._addonInstance;var addonArray=this._addonData.GetAddDataItemArray();if(!addonArray){this._addonInstance=null;return this._addonInstance;}var len=addonArray.length;for(var i=0;i<len;i++){var addon=addonArray[i];if(addon.GetId()===id){this._addonInstance=addon;return this._addonInstance;}}this._addonInstance=null;return this._addonInstance;}},{key:"_SaveToJson",value:function _SaveToJson(){var aData=this._addonData;return{"addonDataJson":aData?aData._SaveToJson():aData,"value":this._value,"aValue":this._aValue,"type":this._type,"time":this._time,"ease":this._ease,"enable":this._enable};}},{key:"_LoadFromJson",value:function _LoadFromJson(o){if(!o)return;if(o["addonDataJson"])this._addonData._SetFromJson(o["addonDataJson"]);this._value=o["value"];this._aValue=o["aValue"];this._type=o["type"];this._time=o["time"];this._ease=o["ease"];this._enable=o["enable"];}}]);return PropertyKeyframeDataItem;}();_C118.PropertyKeyframeData=/*#__PURE__*/function(){function PropertyKeyframeData(propertyKeyframesDataJson,propertyTrackDataItem){_classCallCheck(this,PropertyKeyframeData);this._propertyTrackDataItem=propertyTrackDataItem;this._propertyKeyframeDataItems=[];this._propertyKeyframeDataItemsIncludingDisabled=[];_C118.TimelineDataManager._CreateDataItems(this._propertyKeyframeDataItems,propertyKeyframesDataJson,PropertyKeyframeDataItem,this);_C118.TimelineDataManager._CreateDataItemsIncludingDisabled(this._propertyKeyframeDataItemsIncludingDisabled,propertyKeyframesDataJson,PropertyKeyframeDataItem,this);this._LinkPropertyKeyframeDataItems();}_createClass(PropertyKeyframeData,[{key:"Release",value:function Release(){this._propertyTrackDataItem=null;var _iteratorNormalCompletion283=true;var _didIteratorError283=false;var _iteratorError283=undefined;try{for(var _iterator283=this._propertyKeyframeDataItems[Symbol.iterator](),_step283;!(_iteratorNormalCompletion283=(_step283=_iterator283.next()).done);_iteratorNormalCompletion283=true){var propertyKeyframeDataItem=_step283.value;propertyKeyframeDataItem.Release();}}catch(err){_didIteratorError283=true;_iteratorError283=err;}finally{try{if(!_iteratorNormalCompletion283&&_iterator283["return"]!=null){_iterator283["return"]();}}finally{if(_didIteratorError283){throw _iteratorError283;}}}_C118.clearArray(this._propertyKeyframeDataItems);this._propertyKeyframeDataItems=null;var _iteratorNormalCompletion284=true;var _didIteratorError284=false;var _iteratorError284=undefined;try{for(var _iterator284=this._propertyKeyframeDataItemsIncludingDisabled[Symbol.iterator](),_step284;!(_iteratorNormalCompletion284=(_step284=_iterator284.next()).done);_iteratorNormalCompletion284=true){var _propertyKeyframeDataItem=_step284.value;_propertyKeyframeDataItem.Release();}}catch(err){_didIteratorError284=true;_iteratorError284=err;}finally{try{if(!_iteratorNormalCompletion284&&_iterator284["return"]!=null){_iterator284["return"]();}}finally{if(_didIteratorError284){throw _iteratorError284;}}}_C118.clearArray(this._propertyKeyframeDataItemsIncludingDisabled);this._propertyKeyframeDataItemsIncludingDisabled=null;}},{key:"_LinkPropertyKeyframeDataItems",value:function _LinkPropertyKeyframeDataItems(){var dataItems=this._propertyKeyframeDataItems;dataItems.sort(function(first,second){return first.GetTime()-second.GetTime();});for(var i=0;i<dataItems.length;i++){var current=dataItems[i];if(i+1<dataItems.length)current.SetNext(dataItems[i+1]);if(i-1>=0)current.SetPrevious(dataItems[i-1]);}dataItems=this._propertyKeyframeDataItemsIncludingDisabled;dataItems.sort(function(first,second){return first.GetTime()-second.GetTime();});for(var _i43=0;_i43<dataItems.length;_i43++){var _current=dataItems[_i43];if(_i43+1<dataItems.length)_current.SetNext(dataItems[_i43+1]);if(_i43-1>=0)_current.SetPrevious(dataItems[_i43-1]);}}},{key:"AddEmptyPropertyKeyframeDataItem",value:function AddEmptyPropertyKeyframeDataItem(){var propertyKeyframeDataItem=new PropertyKeyframeDataItem(null,this);this._propertyKeyframeDataItems.push(propertyKeyframeDataItem);this._LinkPropertyKeyframeDataItems();return propertyKeyframeDataItem;}},{key:"DeletePropertyKeyframeDataItems",value:function DeletePropertyKeyframeDataItems(match){var _iteratorNormalCompletion285=true;var _didIteratorError285=false;var _iteratorError285=undefined;try{for(var _iterator285=this._propertyKeyframeDataItems[Symbol.iterator](),_step285;!(_iteratorNormalCompletion285=(_step285=_iterator285.next()).done);_iteratorNormalCompletion285=true){var propertyKeyframeDataItem=_step285.value;if(!match(propertyKeyframeDataItem))continue;var index=this._propertyKeyframeDataItems.indexOf(propertyKeyframeDataItem);if(index===-1)continue;propertyKeyframeDataItem.Release();this._propertyKeyframeDataItems.splice(index,1);}}catch(err){_didIteratorError285=true;_iteratorError285=err;}finally{try{if(!_iteratorNormalCompletion285&&_iterator285["return"]!=null){_iterator285["return"]();}}finally{if(_didIteratorError285){throw _iteratorError285;}}}this.SortPropertyKeyFrameDataItems();this._LinkPropertyKeyframeDataItems();}},{key:"SortPropertyKeyFrameDataItems",value:function SortPropertyKeyFrameDataItems(){this._propertyKeyframeDataItems.sort(function(a,b){return a.GetTime()-b.GetTime();});}},{key:"GetPropertyTrackDataItem",value:function GetPropertyTrackDataItem(){return this._propertyTrackDataItem;}},{key:"GetPropertyKeyframeDataItemCount",value:function GetPropertyKeyframeDataItemCount(){return this._propertyKeyframeDataItems.length;}},{key:"GetLastPropertyKeyframeDataItem",value:function GetLastPropertyKeyframeDataItem(){return this._propertyKeyframeDataItems[this._propertyKeyframeDataItems.length-1];}},{key:"GetPropertyKeyframeDataItemArray",value:function GetPropertyKeyframeDataItemArray(){return this._propertyKeyframeDataItems;}},{key:"GetPropertyKeyframeDataItemArrayIncludingDisabled",value:function GetPropertyKeyframeDataItemArrayIncludingDisabled(){return this._propertyKeyframeDataItemsIncludingDisabled;}},{key:"propertyKeyframeDataItems",value:/*#__PURE__*/regeneratorRuntime.mark(function propertyKeyframeDataItems(){var _iteratorNormalCompletion286,_didIteratorError286,_iteratorError286,_iterator286,_step286,propertyKeyframeDataItem;return regeneratorRuntime.wrap(function propertyKeyframeDataItems$(_context96){while(1){switch(_context96.prev=_context96.next){case 0:_iteratorNormalCompletion286=true;_didIteratorError286=false;_iteratorError286=undefined;_context96.prev=3;_iterator286=this._propertyKeyframeDataItems[Symbol.iterator]();case 5:if(_iteratorNormalCompletion286=(_step286=_iterator286.next()).done){_context96.next=12;break;}propertyKeyframeDataItem=_step286.value;_context96.next=9;return propertyKeyframeDataItem;case 9:_iteratorNormalCompletion286=true;_context96.next=5;break;case 12:_context96.next=18;break;case 14:_context96.prev=14;_context96.t0=_context96["catch"](3);_didIteratorError286=true;_iteratorError286=_context96.t0;case 18:_context96.prev=18;_context96.prev=19;if(!_iteratorNormalCompletion286&&_iterator286["return"]!=null){_iterator286["return"]();}case 21:_context96.prev=21;if(!_didIteratorError286){_context96.next=24;break;}throw _iteratorError286;case 24:return _context96.finish(21);case 25:return _context96.finish(18);case 26:case"end":return _context96.stop();}}},propertyKeyframeDataItems,this,[[3,14,18,26],[19,,21,25]]);})},{key:"propertyKeyframeDataItemsReverse",value:/*#__PURE__*/regeneratorRuntime.mark(function propertyKeyframeDataItemsReverse(){var i;return regeneratorRuntime.wrap(function propertyKeyframeDataItemsReverse$(_context97){while(1){switch(_context97.prev=_context97.next){case 0:i=this._propertyKeyframeDataItems.length-1;case 1:if(!(i>=0)){_context97.next=7;break;}_context97.next=4;return this._propertyKeyframeDataItems[i];case 4:i--;_context97.next=1;break;case 7:case"end":return _context97.stop();}}},propertyKeyframeDataItemsReverse,this);})},{key:"_SaveToJson",value:function _SaveToJson(){var propertyKeyframeDataItems=this._propertyKeyframeDataItems;var propertyKeyframeDataItemsIncludingDisabled=this._propertyKeyframeDataItemsIncludingDisabled;return{"propertyKeyframeDataItemsJson":propertyKeyframeDataItems.map(function(propertyTrackDataItem){return propertyTrackDataItem._SaveToJson();}),"propertyKeyframeDataItemsIncludingDisabledJson":propertyKeyframeDataItemsIncludingDisabled.map(function(propertyTrackDataItem){return propertyTrackDataItem._SaveToJson();})};}},{key:"_LoadFromJson",value:function _LoadFromJson(o){if(!o)return;_C118.TimelineDataManager._LoadDataItemsFromJson(this._propertyKeyframeDataItems,o["propertyKeyframeDataItemsJson"],PropertyKeyframeDataItem,this);_C118.TimelineDataManager._LoadDataItemsFromJson(this._propertyKeyframeDataItemsIncludingDisabled,o["propertyKeyframeDataItemsIncludingDisabledJson"],PropertyKeyframeDataItem,this);this._LinkPropertyKeyframeDataItems();}}]);return PropertyKeyframeData;}();}// timelines/data/propertyKeyframeAddonData.js
{'use strict';var _C119=self.C3;var ADDON_ID=0;var ADDON_DATA=1;var AddonDataItem=/*#__PURE__*/function(){function AddonDataItem(addonDataJson,addonData){_classCallCheck(this,AddonDataItem);this._addonData=addonData;this._id=addonDataJson[ADDON_ID];this._data=addonDataJson[ADDON_DATA];}_createClass(AddonDataItem,[{key:"Release",value:function Release(){this._addonData=null;this._data=null;}},{key:"GetAddonData",value:function GetAddonData(){return this._addonData;}},{key:"GetId",value:function GetId(){return this._id;}},{key:"_SaveToJson",value:function _SaveToJson(){return{"id":this._id,"data":this._data};}},{key:"_LoadFromJson",value:function _LoadFromJson(o){if(!o)return;this._id=o["id"];this._data=o["data"];}}]);return AddonDataItem;}();var START_ANCHOR=0;var START_ENABLE=1;var END_ANCHOR=2;var END_ENABLE=3;var AddonDataCubicBezierItem=/*#__PURE__*/function(_AddonDataItem){_inherits(AddonDataCubicBezierItem,_AddonDataItem);function AddonDataCubicBezierItem(addonDataJson,addonData){var _this59;_classCallCheck(this,AddonDataCubicBezierItem);_this59=_possibleConstructorReturn(this,_getPrototypeOf(AddonDataCubicBezierItem).call(this,addonDataJson,addonData));_this59._startAnchor=_this59._data[START_ANCHOR];_this59._startEnable=!!_this59._data[START_ENABLE];_this59._endAnchor=_this59._data[END_ANCHOR];_this59._endEnable=!!_this59._data[END_ENABLE];return _this59;}_createClass(AddonDataCubicBezierItem,[{key:"Release",value:function Release(){_get(_getPrototypeOf(AddonDataCubicBezierItem.prototype),"Release",this).call(this);}},{key:"GetStartAnchor",value:function GetStartAnchor(){return this._startAnchor;}},{key:"GetStartEnable",value:function GetStartEnable(){return this._startEnable;}},{key:"GetEndAnchor",value:function GetEndAnchor(){return this._endAnchor;}},{key:"GetEndEnable",value:function GetEndEnable(){return this._endEnable;}},{key:"_SaveToJson",value:function _SaveToJson(){return Object.assign(_get(_getPrototypeOf(AddonDataCubicBezierItem.prototype),"_SaveToJson",this).call(this),{"startAnchor":this._startAnchor,"startEnable":!!this._startEnable,"endAnchor":this._endAnchor,"endEnable":!!this._endEnable});}},{key:"_LoadFromJson",value:function _LoadFromJson(o){if(!o)return;_get(_getPrototypeOf(AddonDataCubicBezierItem.prototype),"_LoadFromJson",this).call(this,o);this._startAnchor=o["startAnchor"];this._startEnable=!!o["startEnable"];this._endAnchor=o["endAnchor"];this._endEnable=!!o["endEnable"];}}]);return AddonDataCubicBezierItem;}(AddonDataItem);var DIRECTION=0;var REVOLUTIONS=1;var AddonDataAngleItem=/*#__PURE__*/function(_AddonDataItem2){_inherits(AddonDataAngleItem,_AddonDataItem2);function AddonDataAngleItem(addonDataJson,addonData){var _this60;_classCallCheck(this,AddonDataAngleItem);_this60=_possibleConstructorReturn(this,_getPrototypeOf(AddonDataAngleItem).call(this,addonDataJson,addonData));_this60._direction=_this60._data[DIRECTION];_this60._revolutions=_this60._data[REVOLUTIONS];return _this60;}_createClass(AddonDataAngleItem,[{key:"Release",value:function Release(){_get(_getPrototypeOf(AddonDataAngleItem.prototype),"Release",this).call(this);}},{key:"GetDirection",value:function GetDirection(){return this._direction;}},{key:"GetRevolutions",value:function GetRevolutions(){return this._revolutions;}},{key:"_SaveToJson",value:function _SaveToJson(){return Object.assign(_get(_getPrototypeOf(AddonDataAngleItem.prototype),"_SaveToJson",this).call(this),{"direction":this._direction,"revolutions":this._revolutions});}},{key:"_LoadFromJson",value:function _LoadFromJson(o){if(!o)return;_get(_getPrototypeOf(AddonDataAngleItem.prototype),"_LoadFromJson",this).call(this,o);this._direction=o["direction"];this._revolutions=o["revolutions"];}}]);return AddonDataAngleItem;}(AddonDataItem);_C119.AddonData=/*#__PURE__*/function(){function AddonData(addonsDataJson,propertyKeyframeDataItem){_classCallCheck(this,AddonData);this._propertyKeyframeDataItem=propertyKeyframeDataItem;this._addonDataItems=[];_C119.TimelineDataManager._CreateDataItems(this._addonDataItems,addonsDataJson,{prop:0,map:new Map([["cubic-bezier",AddonDataCubicBezierItem],["angle",AddonDataAngleItem]])},this);}_createClass(AddonData,[{key:"Release",value:function Release(){this._propertyKeyframeDataItem=null;var _iteratorNormalCompletion287=true;var _didIteratorError287=false;var _iteratorError287=undefined;try{for(var _iterator287=this._addonDataItems[Symbol.iterator](),_step287;!(_iteratorNormalCompletion287=(_step287=_iterator287.next()).done);_iteratorNormalCompletion287=true){var addonDataItem=_step287.value;addonDataItem.Release();}}catch(err){_didIteratorError287=true;_iteratorError287=err;}finally{try{if(!_iteratorNormalCompletion287&&_iterator287["return"]!=null){_iterator287["return"]();}}finally{if(_didIteratorError287){throw _iteratorError287;}}}_C119.clearArray(this._addonDataItems);this._addonDataItems=null;}},{key:"GetPropertyKeyframeDataItem",value:function GetPropertyKeyframeDataItem(){return this._propertyKeyframeDataItem;}},{key:"GetAddDataItemArray",value:function GetAddDataItemArray(){return this._addonDataItems;}},{key:"addonDataItems",value:/*#__PURE__*/regeneratorRuntime.mark(function addonDataItems(){var _iteratorNormalCompletion288,_didIteratorError288,_iteratorError288,_iterator288,_step288,addonDataItem;return regeneratorRuntime.wrap(function addonDataItems$(_context98){while(1){switch(_context98.prev=_context98.next){case 0:_iteratorNormalCompletion288=true;_didIteratorError288=false;_iteratorError288=undefined;_context98.prev=3;_iterator288=this._addonDataItems[Symbol.iterator]();case 5:if(_iteratorNormalCompletion288=(_step288=_iterator288.next()).done){_context98.next=12;break;}addonDataItem=_step288.value;_context98.next=9;return addonDataItem;case 9:_iteratorNormalCompletion288=true;_context98.next=5;break;case 12:_context98.next=18;break;case 14:_context98.prev=14;_context98.t0=_context98["catch"](3);_didIteratorError288=true;_iteratorError288=_context98.t0;case 18:_context98.prev=18;_context98.prev=19;if(!_iteratorNormalCompletion288&&_iterator288["return"]!=null){_iterator288["return"]();}case 21:_context98.prev=21;if(!_didIteratorError288){_context98.next=24;break;}throw _iteratorError288;case 24:return _context98.finish(21);case 25:return _context98.finish(18);case 26:case"end":return _context98.stop();}}},addonDataItems,this,[[3,14,18,26],[19,,21,25]]);})},{key:"_SaveToJson",value:function _SaveToJson(){return{"addonDataItemsJson":this._addonDataItems.map(function(addonDataItem){return addonDataItem._SaveToJson();})};}},{key:"_LoadFromJson",value:function _LoadFromJson(o){if(!o)return;_C119.TimelineDataManager._LoadDataItemsFromJson(this._addonDataItems,o["addonDataItemsJson"],{prop:"id",map:new Map([["cubic-bezier",AddonDataCubicBezierItem],["angle",AddonDataAngleItem]])},this);}}]);return AddonData;}();}// timelines/tweens/tweenState.js
{'use strict';var _C120=self.C3;var INITIAL_VALUE_MODE_START_VALUE="start-value";var INITIAL_VALUE_MODE_CURRENT_STATE="current-state";var _PING_PONG_BEGIN=0;var _PING_PONG_END=1;var createdTweens=0;_C120.TweenState=/*#__PURE__*/function(_C120$TimelineState){_inherits(Tween,_C120$TimelineState);function Tween(tweenDataItem,timelineManager){var _this61;_classCallCheck(this,Tween);_this61=_possibleConstructorReturn(this,_getPrototypeOf(Tween).call(this,"tween-".concat(createdTweens++),tweenDataItem,timelineManager));_this61._id="";_this61._destroyInstanceOnComplete=false;_this61._initialValueMode=INITIAL_VALUE_MODE_START_VALUE;_this61._instance=null;_this61._on_completed_callbacks=null;_this61._on_started_callbacks=null;_this61._track=null;_this61._iTweenState=null;return _this61;}_createClass(Tween,[{key:"FireReleaseEvent",value:function FireReleaseEvent(dispatcher){var event=_C120.New(_C120.Event,"tweenstatereleased");event.tweenState=this;dispatcher.dispatchEvent(event);}},{key:"GetType",value:function GetType(){return 1;}},{key:"CreateTrackStates",value:function CreateTrackStates(){var _iteratorNormalCompletion289=true;var _didIteratorError289=false;var _iteratorError289=undefined;try{for(var _iterator289=this._timelineDataItem.GetTrackData().trackDataItems()[Symbol.iterator](),_step289;!(_iteratorNormalCompletion289=(_step289=_iterator289.next()).done);_iteratorNormalCompletion289=true){var trackDataItem=_step289.value;this._tracks.push(_C120.TweenTrackState.Create(this,trackDataItem));}}catch(err){_didIteratorError289=true;_iteratorError289=err;}finally{try{if(!_iteratorNormalCompletion289&&_iterator289["return"]!=null){_iterator289["return"]();}}finally{if(_didIteratorError289){throw _iteratorError289;}}}this._track=this._tracks[0];}},{key:"AddTrack",value:function AddTrack(){var trackDataItem=this._timelineDataItem.GetTrackData().AddEmptyTrackDataItem();var track=_C120.TweenTrackState.Create(this,trackDataItem);this._tracks.push(track);this._track=this._tracks[0];return track;}},{key:"GetPropertyTrack",value:function GetPropertyTrack(propertyName){return this._track.GetPropertyTracks()[0];}},{key:"SetPropertyType",value:function SetPropertyType(type){this._propertyType=type;}},{key:"GetInstance",value:function GetInstance(){var tracks=this.GetTracks();if(!tracks||!tracks.length)return;var track=tracks[0];this._track=track;if(!track)return;var instance=track.GetInstance();return track.IsInstanceValid()?instance:undefined;}},{key:"AddStartedCallback",value:function AddStartedCallback(c){if(!this._on_started_callbacks)this._on_started_callbacks=[];this._on_started_callbacks.push(c);}},{key:"AddCompletedCallback",value:function AddCompletedCallback(c){if(!this._on_completed_callbacks)this._on_completed_callbacks=[];this._on_completed_callbacks.push(c);}},{key:"RemoveStartedCallback",value:function RemoveStartedCallback(c){if(!this._on_started_callbacks)return;var index=this._on_started_callbacks.indexOf(c);if(index!==-1)this._on_started_callbacks.splice(index,1);}},{key:"RemoveCompletedCallback",value:function RemoveCompletedCallback(c){if(!this._on_completed_callbacks)return;var index=this._on_completed_callbacks.indexOf(c);if(index!==-1)this._on_completed_callbacks.splice(index,1);}},{key:"SetStartValue",value:function SetStartValue(startValue,propertyName){var _iteratorNormalCompletion290=true;var _didIteratorError290=false;var _iteratorError290=undefined;try{for(var _iterator290=this._tracks[Symbol.iterator](),_step290;!(_iteratorNormalCompletion290=(_step290=_iterator290.next()).done);_iteratorNormalCompletion290=true){var track=_step290.value;var _iteratorNormalCompletion291=true;var _didIteratorError291=false;var _iteratorError291=undefined;try{for(var _iterator291=track._propertyTracks[Symbol.iterator](),_step291;!(_iteratorNormalCompletion291=(_step291=_iterator291.next()).done);_iteratorNormalCompletion291=true){var propertyTrack=_step291.value;if(propertyTrack.GetPropertyName()!==propertyName)continue;var propertyTrackData=propertyTrack.GetPropertyTrackData();var propertyTrackDataItem=propertyTrack.GetPropertyTrackDataItem();var propertyKeyframeDataItem=propertyTrackData.GetFirstPropertyKeyframeDataItem(propertyTrackDataItem);propertyKeyframeDataItem.SetValue(startValue);propertyKeyframeDataItem.SetAbsoluteValue(startValue);}}catch(err){_didIteratorError291=true;_iteratorError291=err;}finally{try{if(!_iteratorNormalCompletion291&&_iterator291["return"]!=null){_iterator291["return"]();}}finally{if(_didIteratorError291){throw _iteratorError291;}}}}}catch(err){_didIteratorError290=true;_iteratorError290=err;}finally{try{if(!_iteratorNormalCompletion290&&_iterator290["return"]!=null){_iterator290["return"]();}}finally{if(_didIteratorError290){throw _iteratorError290;}}}}},{key:"_GetPropertyTrackState",value:function _GetPropertyTrackState(propertyName){var _iteratorNormalCompletion292=true;var _didIteratorError292=false;var _iteratorError292=undefined;try{for(var _iterator292=this._tracks[Symbol.iterator](),_step292;!(_iteratorNormalCompletion292=(_step292=_iterator292.next()).done);_iteratorNormalCompletion292=true){var track=_step292.value;var _iteratorNormalCompletion293=true;var _didIteratorError293=false;var _iteratorError293=undefined;try{for(var _iterator293=track._propertyTracks[Symbol.iterator](),_step293;!(_iteratorNormalCompletion293=(_step293=_iterator293.next()).done);_iteratorNormalCompletion293=true){var propertyTrack=_step293.value;if(propertyTrack.GetPropertyName()===propertyName)return propertyTrack;}}catch(err){_didIteratorError293=true;_iteratorError293=err;}finally{try{if(!_iteratorNormalCompletion293&&_iterator293["return"]!=null){_iterator293["return"]();}}finally{if(_didIteratorError293){throw _iteratorError293;}}}}}catch(err){_didIteratorError292=true;_iteratorError292=err;}finally{try{if(!_iteratorNormalCompletion292&&_iterator292["return"]!=null){_iterator292["return"]();}}finally{if(_didIteratorError292){throw _iteratorError292;}}}}},{key:"BeforeSetEndValues",value:function BeforeSetEndValues(properties){var _iteratorNormalCompletion294=true;var _didIteratorError294=false;var _iteratorError294=undefined;try{for(var _iterator294=properties[Symbol.iterator](),_step294;!(_iteratorNormalCompletion294=(_step294=_iterator294.next()).done);_iteratorNormalCompletion294=true){var propertyName=_step294.value;var propertyTrackState=this._GetPropertyTrackState(propertyName);this.SetStartValue(propertyTrackState.GetCurrentState(),propertyName);}}catch(err){_didIteratorError294=true;_iteratorError294=err;}finally{try{if(!_iteratorNormalCompletion294&&_iterator294["return"]!=null){_iterator294["return"]();}}finally{if(_didIteratorError294){throw _iteratorError294;}}}if(this.IsForwardPlayBack()){var newTotalTime=this.GetTotalTime()-this.GetTime();this.SetTotalTime(newTotalTime);var _iteratorNormalCompletion295=true;var _didIteratorError295=false;var _iteratorError295=undefined;try{for(var _iterator295=this._tracks[Symbol.iterator](),_step295;!(_iteratorNormalCompletion295=(_step295=_iterator295.next()).done);_iteratorNormalCompletion295=true){var track=_step295.value;track.SetLocalTotalTime(newTotalTime);}}catch(err){_didIteratorError295=true;_iteratorError295=err;}finally{try{if(!_iteratorNormalCompletion295&&_iterator295["return"]!=null){_iterator295["return"]();}}finally{if(_didIteratorError295){throw _iteratorError295;}}}this._SetTime(0);}else{var _newTotalTime=this.GetTime();this.SetTotalTime(_newTotalTime);var _iteratorNormalCompletion296=true;var _didIteratorError296=false;var _iteratorError296=undefined;try{for(var _iterator296=this._tracks[Symbol.iterator](),_step296;!(_iteratorNormalCompletion296=(_step296=_iterator296.next()).done);_iteratorNormalCompletion296=true){var _track5=_step296.value;_track5.SetLocalTotalTime(_newTotalTime);}}catch(err){_didIteratorError296=true;_iteratorError296=err;}finally{try{if(!_iteratorNormalCompletion296&&_iterator296["return"]!=null){_iterator296["return"]();}}finally{if(_didIteratorError296){throw _iteratorError296;}}}this._SetTime(_newTotalTime);}this.SetInitialStateFromSetTime();}},{key:"SetEndValue",value:function SetEndValue(endValue,propertyName){var propertyTrackState=this._GetPropertyTrackState(propertyName);var propertyTrackData=propertyTrackState.GetPropertyTrackData();var propertyTrackDataItem=propertyTrackState.GetPropertyTrackDataItem();var propertyKeyframeDataItem=propertyTrackData.GetLastPropertyKeyframeDataItem(propertyTrackDataItem);propertyKeyframeDataItem.SetTime(this.GetTotalTime());propertyKeyframeDataItem.SetValue(endValue);propertyKeyframeDataItem.SetAbsoluteValue(endValue);}},{key:"SetId",value:function SetId(id){this._id=id;}},{key:"GetId",value:function GetId(){return this._id;}},{key:"SetInitialValueMode",value:function SetInitialValueMode(initialValueMode){this._initialValueMode=initialValueMode;}},{key:"GetInitialValueMode",value:function GetInitialValueMode(){return this._initialValueMode;}},{key:"SetDestroyInstanceOnComplete",value:function SetDestroyInstanceOnComplete(releaseOnComplete){this._destroyInstanceOnComplete=releaseOnComplete;}},{key:"GetDestroyInstanceOnComplete",value:function GetDestroyInstanceOnComplete(){return this._destroyInstanceOnComplete;}},{key:"OnStarted",value:function OnStarted(){if(this._on_started_callbacks){var _iteratorNormalCompletion297=true;var _didIteratorError297=false;var _iteratorError297=undefined;try{for(var _iterator297=this._on_started_callbacks[Symbol.iterator](),_step297;!(_iteratorNormalCompletion297=(_step297=_iterator297.next()).done);_iteratorNormalCompletion297=true){var _c4=_step297.value;_c4(this);}}catch(err){_didIteratorError297=true;_iteratorError297=err;}finally{try{if(!_iteratorNormalCompletion297&&_iterator297["return"]!=null){_iterator297["return"]();}}finally{if(_didIteratorError297){throw _iteratorError297;}}}}if(this.IsComplete())return;var _iteratorNormalCompletion298=true;var _didIteratorError298=false;var _iteratorError298=undefined;try{for(var _iterator298=this._tracks[Symbol.iterator](),_step298;!(_iteratorNormalCompletion298=(_step298=_iterator298.next()).done);_iteratorNormalCompletion298=true){var track=_step298.value;track.CompareSaveStateWithCurrent();}}catch(err){_didIteratorError298=true;_iteratorError298=err;}finally{try{if(!_iteratorNormalCompletion298&&_iterator298["return"]!=null){_iterator298["return"]();}}finally{if(_didIteratorError298){throw _iteratorError298;}}}}},{key:"OnCompleted",value:function OnCompleted(){this._completedTick=this._runtime.GetTickCount();}},{key:"FinishTriggers",value:function FinishTriggers(){if(this._finishedTriggers)return;this._finishedTriggers=true;if(this._on_completed_callbacks){var _iteratorNormalCompletion299=true;var _didIteratorError299=false;var _iteratorError299=undefined;try{for(var _iterator299=this._on_completed_callbacks[Symbol.iterator](),_step299;!(_iteratorNormalCompletion299=(_step299=_iterator299.next()).done);_iteratorNormalCompletion299=true){var _c5=_step299.value;_c5(this);}}catch(err){_didIteratorError299=true;_iteratorError299=err;}finally{try{if(!_iteratorNormalCompletion299&&_iterator299["return"]!=null){_iterator299["return"]();}}finally{if(_didIteratorError299){throw _iteratorError299;}}}}}},{key:"SetTime",value:function SetTime(time){this._DeleteIntermediateKeyframes();_get(_getPrototypeOf(Tween.prototype),"SetTime",this).call(this,time);}},{key:"_SetTimeAndReset",value:function _SetTimeAndReset(time){if(!_C120.IsFiniteNumber(time))time=this.GetTotalTime();if(time<0)this._playheadTime=0;else if(time>=this.GetTotalTime())this._playheadTime=this.GetTotalTime();else this._playheadTime=time;this._track.SetResetState();}},{key:"SetInitialState",value:function SetInitialState(fromSetTime){if(!this.InitialStateSet()&&this.GetInitialValueMode()===INITIAL_VALUE_MODE_CURRENT_STATE){var _iteratorNormalCompletion300=true;var _didIteratorError300=false;var _iteratorError300=undefined;try{for(var _iterator300=this._tracks[Symbol.iterator](),_step300;!(_iteratorNormalCompletion300=(_step300=_iterator300.next()).done);_iteratorNormalCompletion300=true){var track=_step300.value;track.CompareInitialStateWithCurrent();}}catch(err){_didIteratorError300=true;_iteratorError300=err;}finally{try{if(!_iteratorNormalCompletion300&&_iterator300["return"]!=null){_iterator300["return"]();}}finally{if(_didIteratorError300){throw _iteratorError300;}}}}_get(_getPrototypeOf(Tween.prototype),"SetInitialState",this).call(this,fromSetTime);}},{key:"Stop",value:function Stop(){var completed=arguments.length>0&&arguments[0]!==undefined?arguments[0]:false;_get(_getPrototypeOf(Tween.prototype),"Stop",this).call(this,completed);if(this.IsComplete())return;var _iteratorNormalCompletion301=true;var _didIteratorError301=false;var _iteratorError301=undefined;try{for(var _iterator301=this._tracks[Symbol.iterator](),_step301;!(_iteratorNormalCompletion301=(_step301=_iterator301.next()).done);_iteratorNormalCompletion301=true){var track=_step301.value;track.SaveState();}}catch(err){_didIteratorError301=true;_iteratorError301=err;}finally{try{if(!_iteratorNormalCompletion301&&_iterator301["return"]!=null){_iterator301["return"]();}}finally{if(_didIteratorError301){throw _iteratorError301;}}}}},{key:"Reset",value:function Reset(){var render=arguments.length>0&&arguments[0]!==undefined?arguments[0]:true;var beforeChangeLayout=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;this._DeleteIntermediateKeyframes();_get(_getPrototypeOf(Tween.prototype),"Reset",this).call(this,render,beforeChangeLayout);}},{key:"_DeleteIntermediateKeyframes",value:function _DeleteIntermediateKeyframes(){var _this62=this;var _iteratorNormalCompletion302=true;var _didIteratorError302=false;var _iteratorError302=undefined;try{for(var _iterator302=this._tracks[Symbol.iterator](),_step302;!(_iteratorNormalCompletion302=(_step302=_iterator302.next()).done);_iteratorNormalCompletion302=true){var track=_step302.value;var del=function del(kf){var time=kf.GetTime();var totalTime=_this62.GetTotalTime();return time!==0&&time!==totalTime;};track.DeleteKeyframes(del);track.DeletePropertyKeyframes(del);}}catch(err){_didIteratorError302=true;_iteratorError302=err;}finally{try{if(!_iteratorNormalCompletion302&&_iterator302["return"]!=null){_iterator302["return"]();}}finally{if(_didIteratorError302){throw _iteratorError302;}}}}},{key:"_OnBeforeChangeLayout",value:function _OnBeforeChangeLayout(){if(this.IsReleased())return true;var instance=this.GetInstance();if(instance&&instance.GetObjectClass().IsGlobal())return false;this._timelineManager.CompleteTimelineBeforeChangeOfLayout(this);this.ResetBeforeChangeLayout();return true;}},{key:"Tick",value:function Tick(deltaTime,timeScale,deltaTime1){if(!this._instance)this._instance=this.GetInstance();if(!this._instance||this._instance.IsDestroyed()){this.Stop(true);this.OnCompleted();return;}var instanceTimeScale=this._instance.GetTimeScale();if(instanceTimeScale!==-1)deltaTime=deltaTime1*instanceTimeScale;if(deltaTime===0&&this._lastDelta===0)return;this._lastDelta=deltaTime;var lastTime=this._playheadTime;var newDeltaTime=deltaTime*this._playbackRate;var newTime=lastTime+newDeltaTime;var totalTime=this._timelineDataItem._totalTime;if(newTime<0)this._playheadTime=0;else if(newTime>=totalTime)this._playheadTime=totalTime;else this._playheadTime=newTime;var complete=false;var ensureValue=false;var loop=this.GetLoop();var pingPong=this.GetPingPong();if(!loop&&!pingPong){if(this._playbackRate>0){if(this._playheadTime>=totalTime)if(this._currentRepeatCount<this.GetRepeatCount()){this._currentRepeatCount++;this._SetTimeAndReset(0);ensureValue=true;}else{this._SetTime(totalTime);complete=true;}}else{if(this._playheadTime<=0)if(this._currentRepeatCount<this.GetRepeatCount()){this._currentRepeatCount++;this._SetTimeAndReset(totalTime);ensureValue=true;}else{this._SetTime(0);complete=true;}}}else if(loop&&!pingPong){if(this._playbackRate>0){if(this._playheadTime>=totalTime){this._SetTimeAndReset(0);ensureValue=true;}}else{if(this._playheadTime<=0){this._SetTimeAndReset(totalTime);ensureValue=true;}}}else if(!loop&&pingPong){if(this._playbackRate>0){if(this._playheadTime>=totalTime){this._SetTime(totalTime);this.SetPlaybackRate(this.GetPlaybackRate()*-1);ensureValue=true;if(this._pingPongState===_PING_PONG_END){if(this._currentRepeatCount<this.GetRepeatCount()){this._currentRepeatCount++;this._pingPongState=_PING_PONG_BEGIN;}else complete=true;}else if(this._pingPongState===_PING_PONG_BEGIN)this._pingPongState=_PING_PONG_END;}}else{if(this._playheadTime<=0){this._SetTime(0);this.SetPlaybackRate(this.GetPlaybackRate()*-1);ensureValue=true;if(this._pingPongState===_PING_PONG_END){if(this._currentRepeatCount<this.GetRepeatCount()){this._currentRepeatCount++;this._pingPongState=_PING_PONG_BEGIN;}else complete=true;}else if(this._pingPongState===_PING_PONG_BEGIN)this._pingPongState=_PING_PONG_END;}}}else if(loop&&pingPong)if(this._playbackRate>0){if(this._playheadTime>=totalTime){this._SetTime(totalTime);this.SetPlaybackRate(this.GetPlaybackRate()*-1);ensureValue=true;this._pingPongState++;_C120.wrap(this._pingPongState,0,2);}}else if(this._playheadTime<=0){this._SetTime(0);this.SetPlaybackRate(this.GetPlaybackRate()*-1);ensureValue=true;this._pingPongState++;_C120.wrap(this._pingPongState,0,2);}if(complete){this._track.SetEndState();this.Stop(true);this.OnCompleted();return;}this._track.Interpolate(this._playheadTime,true,false,ensureValue,this._firstTick,false);if(this._firstTick)this._firstTick=false;}},{key:"_SaveToJson",value:function _SaveToJson(){var ret=_get(_getPrototypeOf(Tween.prototype),"_SaveToJson",this).call(this);var tweenDataItem=this.GetTimelineDataItem();return Object.assign(ret,{"tweenDataItemJson":tweenDataItem._SaveToJson(),"id":this._id,"destroyInstanceOnComplete":this._destroyInstanceOnComplete,"initialValueMode":this._initialValueMode});}},{key:"_LoadFromJson",value:function _LoadFromJson(o){if(!o)return;var tweenDataItem=this.GetTimelineDataItem();tweenDataItem._LoadFromJson(o["tweenDataItemJson"]);_get(_getPrototypeOf(Tween.prototype),"_LoadFromJson",this).call(this,o);this._id=o["id"];this._destroyInstanceOnComplete=o["destroyInstanceOnComplete"];this._initialValueMode=o["initialValueMode"];}},{key:"GetITweenState",value:function GetITweenState(behInst,opts){if(!this._iTweenState)this._iTweenState=_C120.New(self.ITweenState,this,behInst,opts);return this._iTweenState;}}],[{key:"IsPlaying",value:function IsPlaying(tween){return tween.IsPlaying();}},{key:"IsPaused",value:function IsPaused(tween){return tween.IsPaused();}},{key:"Build",value:function Build(config){var timelineManager=config.runtime.GetTimelineManager();var tweenDataItem=new _C120.TimelineDataItem();if(config.json){tweenDataItem._LoadFromJson(config.json["tweenDataItemJson"]);var tween=new _C120.TweenState(tweenDataItem,timelineManager);tween._LoadFromJson(config.json);return tween;}else{var _tween=new _C120.TweenState(tweenDataItem,timelineManager);if(!_C120.IsArray(config.propertyTracksConfig))config.propertyTracksConfig=[config.propertyTracksConfig];_tween.SetId(config.id);_tween.SetTags(config.tags);_tween.SetInitialValueMode(config.initialValueMode);_tween.SetDestroyInstanceOnComplete(config.releaseOnComplete);_tween.SetLoop(config.loop);_tween.SetPingPong(config.pingPong);_tween.SetTotalTime(config.time);_tween.SetStep(0);_tween.SetInterpolationMode("default");_tween.SetResultMode(config.propertyTracksConfig[0].resultMode);_tween.SetRepeatCount(config.repeatCount);var track=_tween.AddTrack();track.SetInstanceUID(config.instance.GetUID());track.SetInterpolationMode("default");track.SetResultMode(config.propertyTracksConfig[0].resultMode);track.SetEnable(true);track.SetObjectClassIndex(config.instance.GetObjectClass().GetIndex());var sdkIntance=config.instance.GetSdkInstance();var w=sdkIntance.IsOriginalSizeKnown()?sdkIntance.GetOriginalWidth():config.instance.GetWorldInfo().GetWidth();var h=sdkIntance.IsOriginalSizeKnown()?sdkIntance.GetOriginalHeight():config.instance.GetWorldInfo().GetHeight();track.SetOriginalWidth(w);track.SetOriginalHeight(h);var startKeyframeDataItem=track.AddKeyframe();startKeyframeDataItem.SetTime(0);startKeyframeDataItem.SetEase("noease");startKeyframeDataItem.SetEnable(true);startKeyframeDataItem.SetTags("");var endKeyframeDataItem=track.AddKeyframe();endKeyframeDataItem.SetTime(config.time);endKeyframeDataItem.SetEase("noease");endKeyframeDataItem.SetEnable(true);endKeyframeDataItem.SetTags("");var _iteratorNormalCompletion303=true;var _didIteratorError303=false;var _iteratorError303=undefined;try{for(var _iterator303=config.propertyTracksConfig[Symbol.iterator](),_step303;!(_iteratorNormalCompletion303=(_step303=_iterator303.next()).done);_iteratorNormalCompletion303=true){var propertyTrackConfig=_step303.value;var propertyTrack=track.AddPropertyTrack();propertyTrack.SetSourceAdapterId(propertyTrackConfig.sourceId);propertyTrack.SetSourceAdapterArgs(propertyTrackConfig.sourceArgs);propertyTrack.SetPropertyName(propertyTrackConfig.property);propertyTrack.SetPropertyType(propertyTrackConfig.type);propertyTrack.SetMin(NaN);propertyTrack.SetMax(NaN);propertyTrack.SetInterpolationMode("default");propertyTrack.SetResultMode(propertyTrackConfig.resultMode);propertyTrack.SetEnable(true);var startPropertyKeyframeDataItem=propertyTrack.AddPropertyKeyframe();startPropertyKeyframeDataItem.SetType(propertyTrackConfig.valueType);startPropertyKeyframeDataItem.SetTime(0);startPropertyKeyframeDataItem.SetEase(propertyTrackConfig.ease);startPropertyKeyframeDataItem.SetEnable(true);startPropertyKeyframeDataItem.SetValue(propertyTrackConfig.startValue);startPropertyKeyframeDataItem.SetAbsoluteValue(propertyTrackConfig.startValue);var endPropertyKeyframeDataItem=propertyTrack.AddPropertyKeyframe();endPropertyKeyframeDataItem.SetType(propertyTrackConfig.valueType);endPropertyKeyframeDataItem.SetTime(config.time);endPropertyKeyframeDataItem.SetEase(propertyTrackConfig.ease);endPropertyKeyframeDataItem.SetEnable(true);endPropertyKeyframeDataItem.SetValue(propertyTrackConfig.endValue);endPropertyKeyframeDataItem.SetAbsoluteValue(propertyTrackConfig.endValue);propertyTrack.GetSourceAdapter();}}catch(err){_didIteratorError303=true;_iteratorError303=err;}finally{try{if(!_iteratorNormalCompletion303&&_iterator303["return"]!=null){_iterator303["return"]();}}finally{if(_didIteratorError303){throw _iteratorError303;}}}return _tween;}}}]);return Tween;}(_C120.TimelineState);}// timelines/tweens/tweenTrackState.js
{'use strict';var _C121=self.C3;_C121.TweenTrackState=/*#__PURE__*/function(_C121$TrackState){_inherits(TweenTrack,_C121$TrackState);function TweenTrack(timeline,trackDataItem){var _this63;_classCallCheck(this,TweenTrack);_this63=_possibleConstructorReturn(this,_getPrototypeOf(TweenTrack).call(this,timeline,trackDataItem));_this63._firstPropertyTrack=null;_this63._secondPropertyTrack=null;return _this63;}_createClass(TweenTrack,[{key:"_CachePropertyTracks",value:function _CachePropertyTracks(){if(this._propertyTracks.length===1)this._firstPropertyTrack=this._propertyTracks[0];else{this._firstPropertyTrack=this._propertyTracks[0];this._secondPropertyTrack=this._propertyTracks[1];}}},{key:"CreatePropertyTrackStates",value:function CreatePropertyTrackStates(){var _iteratorNormalCompletion304=true;var _didIteratorError304=false;var _iteratorError304=undefined;try{for(var _iterator304=this._trackDataItem.GetPropertyTrackData().propertyTrackDataItems()[Symbol.iterator](),_step304;!(_iteratorNormalCompletion304=(_step304=_iterator304.next()).done);_iteratorNormalCompletion304=true){var propertyTrackDataItem=_step304.value;this._propertyTracks.push(_C121.TweenPropertyTrackState.Create(this,propertyTrackDataItem));}}catch(err){_didIteratorError304=true;_iteratorError304=err;}finally{try{if(!_iteratorNormalCompletion304&&_iterator304["return"]!=null){_iterator304["return"]();}}finally{if(_didIteratorError304){throw _iteratorError304;}}}this._CachePropertyTracks();}},{key:"AddPropertyTrack",value:function AddPropertyTrack(){var propertyTrackData=this._trackDataItem.GetPropertyTrackData();var propertyTrackDataItem=propertyTrackData.AddEmptyPropertyTrackDataItem();var propertyTrack=_C121.TweenPropertyTrackState.Create(this,propertyTrackDataItem);this._propertyTracks.push(propertyTrack);this._CachePropertyTracks();return propertyTrack;}},{key:"SetInitialState",value:function SetInitialState(){this.MaybeGetInstance();if(!this.IsInstanceValid()&&this.IsInstanceTrack())return;var timeline=this.GetTimeline();var isForwardPlayBack=timeline.IsForwardPlayBack();var time=isForwardPlayBack?0:this.GetLocalTotalTime();var _iteratorNormalCompletion305=true;var _didIteratorError305=false;var _iteratorError305=undefined;try{for(var _iterator305=this._propertyTracks[Symbol.iterator](),_step305;!(_iteratorNormalCompletion305=(_step305=_iterator305.next()).done);_iteratorNormalCompletion305=true){var propertyTrack=_step305.value;propertyTrack.SetInitialState(time);if(this._worldInfoChange===0&&propertyTrack.GetWorldInfoChange()===1)this._worldInfoChange=1;if(this._renderChange===0&&propertyTrack.GetRenderChange()===1)this._renderChange=1;}}catch(err){_didIteratorError305=true;_iteratorError305=err;}finally{try{if(!_iteratorNormalCompletion305&&_iterator305["return"]!=null){_iterator305["return"]();}}finally{if(_didIteratorError305){throw _iteratorError305;}}}this._needsBeforeAndAfter=0;var nba=this._propertyTracks.some(function(pt){return pt.GetNeedsBeforeAndAfter();});if(nba)this._needsBeforeAndAfter=1;this._lastKeyframeDataItem=this._GetLastKeyFrameBeforeTime(time);this._initialStateOfNestedSet=false;this._endStateOfNestedSet=false;this.Interpolate(time);}},{key:"BeforeInterpolate",value:function BeforeInterpolate(){}},{key:"Interpolate",value:function Interpolate(time){var isTicking=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var setTime=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var ensureValue=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var firstTick=arguments.length>4&&arguments[4]!==undefined?arguments[4]:false;var ignoreGlobals=arguments.length>5&&arguments[5]!==undefined?arguments[5]:false;var endState=arguments.length>6&&arguments[6]!==undefined?arguments[6]:false;if(!this._instance)this.GetInstance();if(!this._instance)return;var instanceValid=!this._instance.IsDestroyed();if(!instanceValid)return false;if(ignoreGlobals&&this.GetObjectClass().IsGlobal())return false;if(this._secondPropertyTrack){this._firstPropertyTrack.Interpolate(time,setTime,ensureValue,endState);this._secondPropertyTrack.Interpolate(time,setTime,ensureValue,endState);}else this._firstPropertyTrack.Interpolate(time,setTime,ensureValue,endState);if(this._firstPropertyTrack.GetWorldInfoChange()!==0){if(!this._worldInfo)this._worldInfo=this._instance.GetWorldInfo();if(this._worldInfo)this._worldInfo.SetBboxChanged();}}},{key:"AfterInterpolate",value:function AfterInterpolate(){}},{key:"_LoadFromJson",value:function _LoadFromJson(o){_get(_getPrototypeOf(TweenTrack.prototype),"_LoadFromJson",this).call(this,o);this._CachePropertyTracks();}}],[{key:"Create",value:function Create(timeline,trackDataItem){return _C121.New(_C121.TweenTrackState,timeline,trackDataItem);}}]);return TweenTrack;}(_C121.TrackState);}// timelines/tweens/tweenPropertyTrackState.js
{'use strict';var _C122=self.C3;_C122.TweenPropertyTrackState=/*#__PURE__*/function(_C122$PropertyTrackSt){_inherits(TweenPropertyTrackState,_C122$PropertyTrackSt);function TweenPropertyTrackState(track,propertyTrackDataItem){var _this64;_classCallCheck(this,TweenPropertyTrackState);_this64=_possibleConstructorReturn(this,_getPrototypeOf(TweenPropertyTrackState).call(this,track,propertyTrackDataItem));_this64._basic=false;return _this64;}_createClass(TweenPropertyTrackState,[{key:"Interpolate",value:function Interpolate(time){var setTime=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;var ensureValue=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;var endState=arguments.length>3&&arguments[3]!==undefined?arguments[3]:false;var start;var end;if(this._basic){start=this._propertyKeyframeDataItems[0];end=this._propertyKeyframeDataItems[1];}else if(setTime){start=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(time,this._propertyTrackDataItem);end=start.GetNext();}else{if(this._lastPropertyKeyframeDataItem){var timeline=this.GetTimeline();var nextPropertyKeyframe=this._lastPropertyKeyframeDataItem.GetNext();var lastTime=this._lastPropertyKeyframeDataItem.GetTime();var nextTime=nextPropertyKeyframe?nextPropertyKeyframe.GetTime():timeline.GetTotalTime();if(time<=lastTime||time>=nextTime)this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(time,this._propertyTrackDataItem);}else this._lastPropertyKeyframeDataItem=this._propertyTrackData.GetFirstPropertyKeyFrameDataItemLowerOrEqualThan(time,this._propertyTrackDataItem);start=this._lastPropertyKeyframeDataItem;end=start.GetNext();}this._sourceAdapter.Interpolate(time,start,end,setTime,ensureValue,endState);}},{key:"AddPropertyKeyframe",value:function AddPropertyKeyframe(){var propertyKeyframeData=this._propertyTrackDataItem.GetPropertyKeyframeData();var propertyKeyframeDataItem=propertyKeyframeData.AddEmptyPropertyKeyframeDataItem();this._lastPropertyKeyframeDataItem=null;this._basic=this.GetPropertyKeyframeDataItems().length<=2;return propertyKeyframeDataItem;}},{key:"DeletePropertyKeyframes",value:function DeletePropertyKeyframes(match){this._lastPropertyKeyframeDataItem=null;var propertyKeyframeData=this._propertyTrackDataItem.GetPropertyKeyframeData();propertyKeyframeData.DeletePropertyKeyframeDataItems(match);this._basic=this.GetPropertyKeyframeDataItems().length<=2;}},{key:"_SaveToJson",value:function _SaveToJson(){return{"sourceAdapterJson":this.GetSourceAdapter()._SaveToJson(),"basic":this._basic};}},{key:"_LoadFromJson",value:function _LoadFromJson(o){if(!o)return;this.GetSourceAdapter()._LoadFromJson(o["sourceAdapterJson"]);this._basic=o["basic"];}}],[{key:"Create",value:function Create(track,propertyTrackDataItem){return _C122.New(_C122.TweenPropertyTrackState,track,propertyTrackDataItem);}}]);return TweenPropertyTrackState;}(_C122.PropertyTrackState);}// timelines/transitions/transition.js
{'use strict';var _C123=self.C3;var _Ease2=self.Ease;var _NAME3=0;var TRANSITION_KEYFRAMES=1;_C123.Transition=/*#__PURE__*/function(_C123$DefendedBase){_inherits(Transition,_C123$DefendedBase);function Transition(data){var _this65;var addCustomEase=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;_classCallCheck(this,Transition);_this65=_possibleConstructorReturn(this,_getPrototypeOf(Transition).call(this));_this65._name=data[_NAME3];_this65._linear=false;_this65._transitionKeyframes=[];var _iteratorNormalCompletion306=true;var _didIteratorError306=false;var _iteratorError306=undefined;try{for(var _iterator306=data[TRANSITION_KEYFRAMES][Symbol.iterator](),_step306;!(_iteratorNormalCompletion306=(_step306=_iterator306.next()).done);_iteratorNormalCompletion306=true){var transitionKeyframeData=_step306.value;var transitionKeyframe=_C123.TransitionKeyframe.Create(_assertThisInitialized(_this65),transitionKeyframeData);_this65._transitionKeyframes.push(transitionKeyframe);}}catch(err){_didIteratorError306=true;_iteratorError306=err;}finally{try{if(!_iteratorNormalCompletion306&&_iterator306["return"]!=null){_iterator306["return"]();}}finally{if(_didIteratorError306){throw _iteratorError306;}}}for(var i=0;i<_this65._transitionKeyframes.length;i++){var current=_this65._transitionKeyframes[i];current.SetNext(_this65._transitionKeyframes[i+1]);}_this65._precalculatedSamples=new Map();_this65._transitionKeyframeCache=new Map();_this65._PreCalcSamples();if(addCustomEase)_Ease2.AddCustomEase(_this65._name,function(t,sv,dv,tt){return _this65.Interpolate(t,sv,dv,tt);});return _this65;}_createClass(Transition,[{key:"Release",value:function Release(){var _iteratorNormalCompletion307=true;var _didIteratorError307=false;var _iteratorError307=undefined;try{for(var _iterator307=this._transitionKeyframes[Symbol.iterator](),_step307;!(_iteratorNormalCompletion307=(_step307=_iterator307.next()).done);_iteratorNormalCompletion307=true){var transitionKeyframe=_step307.value;transitionKeyframe.Release();}}catch(err){_didIteratorError307=true;_iteratorError307=err;}finally{try{if(!_iteratorNormalCompletion307&&_iterator307["return"]!=null){_iterator307["return"]();}}finally{if(_didIteratorError307){throw _iteratorError307;}}}_C123.clearArray(this._transitionKeyframes);this._transitionKeyframes=null;this._precalculatedSamples.clear();this._precalculatedSamples=null;this._transitionKeyframeCache.clear();this._transitionKeyframeCache=null;}},{key:"MakeLinear",value:function MakeLinear(linear){this._linear=!!linear;}},{key:"GetTransitionKeyFrameAt",value:function GetTransitionKeyFrameAt(x){var transitionKeyframe=this._transitionKeyframeCache.get(x);if(transitionKeyframe)return transitionKeyframe;var _iteratorNormalCompletion308=true;var _didIteratorError308=false;var _iteratorError308=undefined;try{for(var _iterator308=this._transitionKeyframes[Symbol.iterator](),_step308;!(_iteratorNormalCompletion308=(_step308=_iterator308.next()).done);_iteratorNormalCompletion308=true){var _transitionKeyframe=_step308.value;if(_transitionKeyframe.GetValueX()===x){this._transitionKeyframeCache.set(x,_transitionKeyframe);return _transitionKeyframe;}}}catch(err){_didIteratorError308=true;_iteratorError308=err;}finally{try{if(!_iteratorNormalCompletion308&&_iterator308["return"]!=null){_iterator308["return"]();}}finally{if(_didIteratorError308){throw _iteratorError308;}}}}},{key:"GetFirstTransitionKeyFrameHigherThan",value:function GetFirstTransitionKeyFrameHigherThan(x){var _iteratorNormalCompletion309=true;var _didIteratorError309=false;var _iteratorError309=undefined;try{for(var _iterator309=this._transitionKeyframes[Symbol.iterator](),_step309;!(_iteratorNormalCompletion309=(_step309=_iterator309.next()).done);_iteratorNormalCompletion309=true){var transitionKeyframe=_step309.value;if(transitionKeyframe.GetValueX()>x)return transitionKeyframe;}}catch(err){_didIteratorError309=true;_iteratorError309=err;}finally{try{if(!_iteratorNormalCompletion309&&_iterator309["return"]!=null){_iterator309["return"]();}}finally{if(_didIteratorError309){throw _iteratorError309;}}}}},{key:"GetFirstTransitionKeyFrameHigherOrEqualThan",value:function GetFirstTransitionKeyFrameHigherOrEqualThan(x){var _iteratorNormalCompletion310=true;var _didIteratorError310=false;var _iteratorError310=undefined;try{for(var _iterator310=this._transitionKeyframes[Symbol.iterator](),_step310;!(_iteratorNormalCompletion310=(_step310=_iterator310.next()).done);_iteratorNormalCompletion310=true){var transitionKeyframe=_step310.value;if(transitionKeyframe.GetValueX()>=x)return transitionKeyframe;}}catch(err){_didIteratorError310=true;_iteratorError310=err;}finally{try{if(!_iteratorNormalCompletion310&&_iterator310["return"]!=null){_iterator310["return"]();}}finally{if(_didIteratorError310){throw _iteratorError310;}}}}},{key:"GetFirstTransitionKeyFrameLowerThan",value:function GetFirstTransitionKeyFrameLowerThan(x){for(var i=this._transitionKeyframes.length-1;i>=0;i--){var transitionKeyframe=this._transitionKeyframes[i];if(transitionKeyframe.GetValueX()<x)return transitionKeyframe;}}},{key:"GetFirstTransitionKeyFrameLowerOrEqualThan",value:function GetFirstTransitionKeyFrameLowerOrEqualThan(x){for(var i=this._transitionKeyframes.length-1;i>=0;i--){var transitionKeyframe=this._transitionKeyframes[i];if(transitionKeyframe.GetValueX()<=x)return transitionKeyframe;}}},{key:"Interpolate",value:function Interpolate(time,startValue,deltaValue,totalTime){var n=time/totalTime;if(this._linear){if(totalTime===0)return startValue+deltaValue;return _Ease2.NoEase(time,startValue,deltaValue,totalTime);}if(totalTime===0)n=1;var start=this.GetFirstTransitionKeyFrameLowerOrEqualThan(n);var end=start.GetNext();if(!end){start=this.GetFirstTransitionKeyFrameLowerThan(n);end=start.GetNext();}var delta=end.GetValueX()-start.GetValueX();var nn=_C123.mapToRange(n,start.GetValueX(),end.GetValueX(),0,delta);var startX=start.GetValueX();var startY=start.GetValueY();var anchor1X=start.GetValueX()+start.GetStartAnchorX();var anchor1Y=start.GetValueY()+start.GetStartAnchorY();var anchor2X=end.GetValueX()+end.GetEndAnchorX();var anchor2Y=end.GetValueY()+end.GetEndAnchorY();var endX=end.GetValueX();var endY=end.GetValueY();var ret=_Ease2.GetRuntimeEase("spline")(nn,startX,startY,anchor1X,anchor1Y,anchor2X,anchor2Y,endX,endY,this._precalculatedSamples.get(start));ret+=start.GetValueY();return(1-ret)*startValue+ret*(startValue+deltaValue);}},{key:"_PreCalcSamples",value:function _PreCalcSamples(){this._precalculatedSamples.clear();for(var i=0;i<this._transitionKeyframes.length-1;i++){var transitionKeyframe=this._transitionKeyframes[i];if(!transitionKeyframe.GetStartEnable())continue;var start=transitionKeyframe;var end=this._transitionKeyframes[i+1];var startValue=start.GetValueX();var anchor1Value=start.GetValueX()+start.GetStartAnchorX();var anchor2Value=end.GetValueX()+end.GetEndAnchorX();var endValue=end.GetValueX();this._precalculatedSamples.set(start,_Ease2.GetBezierSamples(startValue,anchor1Value,anchor2Value,endValue));}}}],[{key:"Create",value:function Create(data){return _C123.New(_C123.Transition,data);}}]);return Transition;}(_C123.DefendedBase);}// timelines/transitions/transitionKeyframe.js
{'use strict';var _C124=self.C3;var VALUE_X=0;var VALUE_Y=1;var START_ANCHOR_X=2;var START_ANCHOR_Y=3;var END_ANCHOR_X=4;var END_ANCHOR_Y=5;var _START_ENABLE=6;var _END_ENABLE=7;_C124.TransitionKeyframe=/*#__PURE__*/function(_C124$DefendedBase){_inherits(TransitionKeyframe,_C124$DefendedBase);function TransitionKeyframe(transition,data){var _this66;_classCallCheck(this,TransitionKeyframe);_this66=_possibleConstructorReturn(this,_getPrototypeOf(TransitionKeyframe).call(this));_this66._transition=transition;_this66._valueX=data[VALUE_X];_this66._valueY=data[VALUE_Y];_this66._startAnchorX=data[START_ANCHOR_X];_this66._startAnchorY=data[START_ANCHOR_Y];_this66._endAnchorX=data[END_ANCHOR_X];_this66._endAnchorY=data[END_ANCHOR_Y];_this66._startEnable=data[_START_ENABLE];_this66._endEnable=data[_END_ENABLE];_this66._next=null;return _this66;}_createClass(TransitionKeyframe,[{key:"Release",value:function Release(){this._transition=null;}},{key:"SetNext",value:function SetNext(transitionKeyframe){this._next=transitionKeyframe;}},{key:"GetNext",value:function GetNext(){return this._next;}},{key:"GetValueX",value:function GetValueX(){return this._valueX;}},{key:"GetValueY",value:function GetValueY(){return this._valueY;}},{key:"GetStartAnchorX",value:function GetStartAnchorX(){return this._startAnchorX;}},{key:"GetStartAnchorY",value:function GetStartAnchorY(){return this._startAnchorY;}},{key:"GetEndAnchorX",value:function GetEndAnchorX(){return this._endAnchorX;}},{key:"GetEndAnchorY",value:function GetEndAnchorY(){return this._endAnchorY;}},{key:"GetStartEnable",value:function GetStartEnable(){return this._startEnable;}},{key:"GetEndEnable",value:function GetEndEnable(){return this._endEnable;}}],[{key:"Create",value:function Create(transition,data){return _C124.New(_C124.TransitionKeyframe,transition,data);}}]);return TransitionKeyframe;}(_C124.DefendedBase);}// timelines/transitions/transitionManager.js
{'use strict';var _C125=self.C3;_C125.TransitionManager=/*#__PURE__*/function(_C125$DefendedBase){_inherits(TransitionManager,_C125$DefendedBase);function TransitionManager(runtime){var _this67;_classCallCheck(this,TransitionManager);_this67=_possibleConstructorReturn(this,_getPrototypeOf(TransitionManager).call(this));_this67._runtime=runtime;_this67._transitions=[];return _this67;}_createClass(TransitionManager,[{key:"Release",value:function Release(){var _iteratorNormalCompletion311=true;var _didIteratorError311=false;var _iteratorError311=undefined;try{for(var _iterator311=this._transitions[Symbol.iterator](),_step311;!(_iteratorNormalCompletion311=(_step311=_iterator311.next()).done);_iteratorNormalCompletion311=true){var transition=_step311.value;transition.Release();}}catch(err){_didIteratorError311=true;_iteratorError311=err;}finally{try{if(!_iteratorNormalCompletion311&&_iterator311["return"]!=null){_iterator311["return"]();}}finally{if(_didIteratorError311){throw _iteratorError311;}}}_C125.clearArray(this._transitions);this._transitions=null;}},{key:"Create",value:function Create(transitionData){this._transitions.push(_C125.Transition.Create(transitionData));}}]);return TransitionManager;}(_C125.DefendedBase);}// templates/templateManager.js
{'use strict';var _C126=self.C3;_C126.TemplateManager=/*#__PURE__*/function(_C126$DefendedBase){_inherits(TemplateManager,_C126$DefendedBase);function TemplateManager(runtime){var _this68;_classCallCheck(this,TemplateManager);_this68=_possibleConstructorReturn(this,_getPrototypeOf(TemplateManager).call(this));_this68._runtime=runtime;_this68._templateDataMap=null;_this68._instanceToTemplateNameMap=null;_this68._instanceDestroy=function(e){return _this68._OnInstanceDestroy(e.instance);};return _this68;}_createClass(TemplateManager,[{key:"Release",value:function Release(){this.RemoveRuntimeListeners();if(this._templateDataMap){var _iteratorNormalCompletion312=true;var _didIteratorError312=false;var _iteratorError312=undefined;try{for(var _iterator312=this._templateDataMap.values()[Symbol.iterator](),_step312;!(_iteratorNormalCompletion312=(_step312=_iterator312.next()).done);_iteratorNormalCompletion312=true){var objectClassTemplatesMap=_step312.value;objectClassTemplatesMap.clear();}}catch(err){_didIteratorError312=true;_iteratorError312=err;}finally{try{if(!_iteratorNormalCompletion312&&_iterator312["return"]!=null){_iterator312["return"]();}}finally{if(_didIteratorError312){throw _iteratorError312;}}}this._templateDataMap.clear();}this._templateDataMap=null;this._runtime=null;}},{key:"Create",value:function Create(templateInstanceData){if(!this._templateDataMap)this._templateDataMap=new Map();if(!templateInstanceData)return;var templateData=templateInstanceData[0][16];var templateName=templateData[0];var objectClassIndex=templateInstanceData[1];if(!this._templateDataMap.has(objectClassIndex))this._templateDataMap.set(objectClassIndex,new Map());var objectClassTemplatesMap=this._templateDataMap.get(objectClassIndex);objectClassTemplatesMap.set(templateName,templateInstanceData);}},{key:"AddRuntimeListeners",value:function AddRuntimeListeners(){var dispatcher=this._runtime.Dispatcher();if(dispatcher)dispatcher.addEventListener("instancedestroy",this._instanceDestroy);}},{key:"RemoveRuntimeListeners",value:function RemoveRuntimeListeners(){var dispatcher=this._runtime.Dispatcher();if(dispatcher)dispatcher.removeEventListener("instancedestroy",this._instanceDestroy);}},{key:"HasTemplates",value:function HasTemplates(){if(!this._templateDataMap)return false;return this._templateDataMap.size!==0;}},{key:"GetTemplateData",value:function GetTemplateData(objectClass_or_index,templateName){var index=0;if(objectClass_or_index instanceof _C126.ObjectClass)index=objectClass_or_index.GetIndex();else index=objectClass_or_index;if(!this._templateDataMap.has(index))return;var ret=this._templateDataMap.get(index).get(templateName);if(ret)return JSON.parse(JSON.stringify(ret));return undefined;}},{key:"MapInstanceToTemplateName",value:function MapInstanceToTemplateName(inst,templateName){if(!this._instanceToTemplateNameMap)this._instanceToTemplateNameMap=new WeakMap();if(this._instanceToTemplateNameMap.has(inst))return;this._instanceToTemplateNameMap.set(inst,templateName);}},{key:"GetInstanceTemplateName",value:function GetInstanceTemplateName(inst){if(!this._instanceToTemplateNameMap)return"";var ret=this._instanceToTemplateNameMap.get(inst);if(ret)return ret;return"";}},{key:"_OnInstanceDestroy",value:function _OnInstanceDestroy(inst){if(!this._instanceToTemplateNameMap)return;if(!this._instanceToTemplateNameMap.has(inst))return;this._instanceToTemplateNameMap["delete"](inst);}}]);return TemplateManager;}(_C126.DefendedBase);}// flowcharts/flowchartManager.js
{'use strict';var _C127=self.C3;_C127.FlowchartManager=/*#__PURE__*/function(){function FlowchartManager(runtime){_classCallCheck(this,FlowchartManager);this._runtime=runtime;this._flowchartDataManager=new _C127.FlowchartDataManager();this._flowchartStates=new Map();this._currentFlowchartState=null;this._flowchartStateStack=[];}_createClass(FlowchartManager,[{key:"Release",value:function Release(){this._flowchartDataManager.Release();this._flowchartDataManager=null;_C127.clearArray(this._flowchartStateStack);this._flowchartStateStack=null;this._flowchartStates.clear();this._flowchartStates=null;this._currentFlowchartState=null;this._runtime=null;}},{key:"GetRuntime",value:function GetRuntime(){return this._runtime;}},{key:"Create",value:function Create(flowchartData){this._flowchartDataManager.Add(flowchartData);}},{key:"GetFlowchartDataItemByName",value:function GetFlowchartDataItemByName(flowchartName){return this._flowchartDataManager.Get(flowchartName);}},{key:"HasFlowcharts",value:function HasFlowcharts(){return this._flowchartDataManager.HasFlowcharts();}},{key:"AddFlowchartState",value:function AddFlowchartState(flowchartName,startNodeTag,flowchartTag,pluginInstance,setAsCurrent,pluginUID){var flowchartDataItem=this._flowchartDataManager.Get(flowchartName);if(!flowchartDataItem){console.warn("[Flowcharts] no flowchart found with name '".concat(flowchartName,"'"));return;}if(this._flowchartStates.has(flowchartTag)){console.warn("[Flowcharts] there already is a flowchart with the tag '".concat(flowchartTag,"'"));return;}var flowchartState=new _C127.FlowchartState(flowchartName,flowchartTag,startNodeTag,flowchartDataItem,this,pluginInstance,pluginUID);this._flowchartStates.set(flowchartTag,flowchartState);if(setAsCurrent)this.SetCurrentFlowchartState(flowchartState,true);return flowchartState;}},{key:"RemoveFlowchartState",value:function RemoveFlowchartState(flowchartState){flowchartState.MarkForRelease();if(flowchartState.IsInTriggerState())return;var flowchartTag=flowchartState.GetTag();this._flowchartStates["delete"](flowchartTag);flowchartState.Release();if(this._currentFlowchartState===flowchartState)this._currentFlowchartState=null;}},{key:"ResetFlowchartState",value:function ResetFlowchartState(flowchartState){flowchartState.Reset();}},{key:"GetFlowchartState",value:function GetFlowchartState(flowchartTag){return this._flowchartStates.get(flowchartTag);}},{key:"PushFlowchartState",value:function PushFlowchartState(flowchartState){this._flowchartStateStack.push(flowchartState);}},{key:"PopFlowchartState",value:function PopFlowchartState(){this._flowchartStateStack.pop();}},{key:"SetCurrentFlowchartState",value:function SetCurrentFlowchartState(flowchartState){var triggerNodeChange=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;if(flowchartState===this._currentFlowchartState)return;this._TriggerBeforeFlowchartChange();this._TriggerAfterFlowchartChange(flowchartState,triggerNodeChange);}},{key:"GetCurrentFlowchartState",value:function GetCurrentFlowchartState(tag){if(typeof tag==="string")return this.GetFlowchartState(tag);else if(this._flowchartStateStack.length)return this._flowchartStateStack[this._flowchartStateStack.length-1];else return this._currentFlowchartState;}},{key:"_TriggerBeforeFlowchartChange",value:function _TriggerBeforeFlowchartChange(){if(!this._currentFlowchartState)return;if(this._currentFlowchartState.WasReleased())return;var inst=this._currentFlowchartState.GetPluginInstance().GetInstance();this._currentFlowchartState.PushIsTriggerState();this.PushFlowchartState(this._currentFlowchartState);this._runtime.Trigger(_C127.Plugins.Flowchart.Cnds.OnBeforeFlowchartChange,inst);this.PopFlowchartState();this._currentFlowchartState.PopIsTriggerState();}},{key:"_TriggerAfterFlowchartChange",value:function _TriggerAfterFlowchartChange(flowchartState){var triggerNodeChange=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;this._currentFlowchartState=flowchartState;if(!this._currentFlowchartState)return;if(this._currentFlowchartState.WasReleased())return;var inst=this._currentFlowchartState.GetPluginInstance().GetInstance();this._currentFlowchartState.PushIsTriggerState();this.PushFlowchartState(this._currentFlowchartState);this._runtime.Trigger(_C127.Plugins.Flowchart.Cnds.OnFlowchartChange,inst);if(triggerNodeChange){this._runtime.Trigger(_C127.Plugins.Flowchart.Cnds.OnAnyNodeChange,inst);this._runtime.Trigger(_C127.Plugins.Flowchart.Cnds.OnTaggedNodeChange,inst);}this.PopFlowchartState();this._currentFlowchartState.PopIsTriggerState();}},{key:"_SaveToJson",value:function _SaveToJson(){return{"flowchartJsonObjects":_toConsumableArray(this._flowchartStates.values()).map(function(fs){return fs._SaveToJson();}),"currentFlowchartTag":this._currentFlowchartState?this._currentFlowchartState.GetTag():null};}},{key:"_LoadFromJson",value:function _LoadFromJson(o){if(!o)return;var newFlowchartStates=new Map();var _iteratorNormalCompletion313=true;var _didIteratorError313=false;var _iteratorError313=undefined;try{for(var _iterator313=o["flowchartJsonObjects"][Symbol.iterator](),_step313;!(_iteratorNormalCompletion313=(_step313=_iterator313.next()).done);_iteratorNormalCompletion313=true){var flowchartJsonObject=_step313.value;var flowchartTag=flowchartJsonObject["flowchartTag"];if(this._flowchartStates.has(flowchartTag)){var flowchartState=this._flowchartStates.get(flowchartTag);flowchartState._LoadFromJson(flowchartJsonObject);newFlowchartStates.set(flowchartTag,flowchartState);}else{var _flowchartState=this.AddFlowchartState(flowchartJsonObject["flowchartName"],flowchartJsonObject["startNodeTag"],flowchartJsonObject["flowchartTag"],null,false,flowchartJsonObject["pluginUID"]);newFlowchartStates.set(flowchartJsonObject["flowchartTag"],_flowchartState);}}}catch(err){_didIteratorError313=true;_iteratorError313=err;}finally{try{if(!_iteratorNormalCompletion313&&_iterator313["return"]!=null){_iterator313["return"]();}}finally{if(_didIteratorError313){throw _iteratorError313;}}}var _iteratorNormalCompletion314=true;var _didIteratorError314=false;var _iteratorError314=undefined;try{for(var _iterator314=this._flowchartStates.entries()[Symbol.iterator](),_step314;!(_iteratorNormalCompletion314=(_step314=_iterator314.next()).done);_iteratorNormalCompletion314=true){var _step314$value=_slicedToArray(_step314.value,2),tag=_step314$value[0],state=_step314$value[1];if(newFlowchartStates.has(tag))continue;state.Release();}}catch(err){_didIteratorError314=true;_iteratorError314=err;}finally{try{if(!_iteratorNormalCompletion314&&_iterator314["return"]!=null){_iterator314["return"]();}}finally{if(_didIteratorError314){throw _iteratorError314;}}}this._flowchartStates.clear();this._flowchartStates=newFlowchartStates;var currentFlowchartTag=this._flowchartStates.get(o["currentFlowchartTag"]);if(currentFlowchartTag)this.SetCurrentFlowchartState(currentFlowchartTag,true);}}]);return FlowchartManager;}();}// flowcharts/state/flowchartState.js
{'use strict';var _C128=self.C3;_C128.FlowchartState=/*#__PURE__*/function(){function Flowchart(flowchartName,tag,startNodeTag,flowchartDataItem,flowchartManager,pluginInstance,pluginUID){_classCallCheck(this,Flowchart);this._runtime=flowchartManager.GetRuntime();this._flowchartManager=flowchartManager;this._flowchartName=flowchartName;this._startNodeTag=startNodeTag;this._flowchartDataItem=flowchartDataItem;this._tag=tag;this._pluginInstance=pluginInstance;this._pluginUID=pluginUID?pluginUID:pluginInstance.GetInstance().GetUID();this._SetStartFlowchartNode();this._currentFlowchartNodeId=this._startFlowchartNode.GetFlowchartId();this._previousFlowchartNodeIds=[];this._triggerCount=0;this._markForRelease=false;this._released=false;}_createClass(Flowchart,[{key:"Release",value:function Release(){if(this._released)return;_C128.clearArray(this._previousFlowchartNodeIds);this._previousFlowchartNodeIds=null;this._runtime=null;this._flowchartManager=null;this._flowchartDataItem=null;this._pluginInstance=null;this._released=true;}},{key:"WasReleased",value:function WasReleased(){return this._released;}},{key:"GetFlowchartManager",value:function GetFlowchartManager(){return this._flowchartManager;}},{key:"GetRuntime",value:function GetRuntime(){return this._runtime;}},{key:"GetFlowchartDataItem",value:function GetFlowchartDataItem(){return this._flowchartDataItem;}},{key:"GetTag",value:function GetTag(){return this._tag;}},{key:"GetPluginInstance",value:function GetPluginInstance(){if(!this._pluginInstance)this._pluginInstance=this._runtime.GetInstanceByUID(this._pluginUID).GetPlugin();return this._pluginInstance;}},{key:"GetCurrentNode",value:function GetCurrentNode(){return this.GetFlowchartElementById(this._currentFlowchartNodeId);}},{key:"GetCurrentNodeTag",value:function GetCurrentNodeTag(){var currentFlowchartNode=this.GetCurrentNode();if(!currentFlowchartNode)return"";return currentFlowchartNode.GetTag();}},{key:"GetCurrentNodeParent",value:function GetCurrentNodeParent(indexOrTag){var currentFlowchartNode=this.GetCurrentNode();if(_C128.IsFiniteNumber(indexOrTag)){var parentFlowchartIds=currentFlowchartNode.GetParentFlowchartIds();var newFlowchartNodeId=parentFlowchartIds?parentFlowchartIds[indexOrTag]:undefined;if(_C128.IsFiniteNumber(newFlowchartNodeId))return this.GetFlowchartElementById(newFlowchartNodeId);}if(typeof indexOrTag==="string"){var _iteratorNormalCompletion315=true;var _didIteratorError315=false;var _iteratorError315=undefined;try{for(var _iterator315=currentFlowchartNode.GetParentFlowchartIds()[Symbol.iterator](),_step315;!(_iteratorNormalCompletion315=(_step315=_iterator315.next()).done);_iteratorNormalCompletion315=true){var parentFlowchartId=_step315.value;var parentFlowchartNode=this.GetFlowchartElementById(parentFlowchartId);if(parentFlowchartNode.GetTag()===indexOrTag)return this.GetFlowchartElementById(parentFlowchartNode.GetFlowchartId());}}catch(err){_didIteratorError315=true;_iteratorError315=err;}finally{try{if(!_iteratorNormalCompletion315&&_iterator315["return"]!=null){_iterator315["return"]();}}finally{if(_didIteratorError315){throw _iteratorError315;}}}}}},{key:"GetCurrentNodeParentTag",value:function GetCurrentNodeParentTag(index){var currentParentFlowchartNode=this.GetCurrentNodeParent(index);if(!currentParentFlowchartNode)return"";return currentParentFlowchartNode.GetTag();}},{key:"GetCurrentNodeParentIndex",value:function GetCurrentNodeParentIndex(tag){var currentParentFlowchartNode=this.GetCurrentNodeParent(tag);if(!currentParentFlowchartNode)return-1;var parentFlowchartIds=currentParentFlowchartNode.GetParentFlowchartIds();if(!parentFlowchartIds)return-1;return parentFlowchartIds.indexOf(currentParentFlowchartNode.GetFlowchartId());}},{key:"GetFlowchartElementById",value:function GetFlowchartElementById(flowchartElementId){return this._flowchartDataItem.GetFlowchartElementById(flowchartElementId);}},{key:"Reset",value:function Reset(){this._previousFlowchartNodeIds=[];var startFlowchartId=this._startFlowchartNode.GetFlowchartId();if(startFlowchartId!==this._currentFlowchartNodeId)this._GotoFlowchartNode(startFlowchartId);}},{key:"GetCurrentNodeOutputCount",value:function GetCurrentNodeOutputCount(){var flowchartNodeDataItem=this._flowchartDataItem.GetFlowchartElementById(this._currentFlowchartNodeId);return flowchartNodeDataItem.GetFlowchartNodeOutputData().GetFlowchartNodeOutputDataItemCount();}},{key:"GetCurrentNodeOutputNameAt",value:function GetCurrentNodeOutputNameAt(index){var flowchartNodeOutputDataItem=this._GetFlowchartNodeOutputAt(index);if(!flowchartNodeOutputDataItem)return"";return flowchartNodeOutputDataItem.GetName();}},{key:"GetCurrentNodeOutputValueAt",value:function GetCurrentNodeOutputValueAt(indexOrName){var flowchartNodeOutputDataItem;if(_C128.IsFiniteNumber(indexOrName))flowchartNodeOutputDataItem=this._GetFlowchartNodeOutputAt(indexOrName);if(typeof indexOrName==="string")flowchartNodeOutputDataItem=this._GetFlowchartNodeOutputByName(indexOrName);if(typeof indexOrName!=="number"&&typeof indexOrName!=="string")console.warn("[Flowcharts] unexpected argument type in GetCurrentNodeOutputValueAt expression");if(!flowchartNodeOutputDataItem)return"";return flowchartNodeOutputDataItem.GetValue();}},{key:"GotoNextFlowchartNode",value:function GotoNextFlowchartNode(indexOrName){var flowchartNodeOutputDataItem;if(_C128.IsFiniteNumber(indexOrName))flowchartNodeOutputDataItem=this._GetFlowchartNodeOutputAt(indexOrName);if(typeof indexOrName==="string")flowchartNodeOutputDataItem=this._GetFlowchartNodeOutputByName(indexOrName);var newFlowchartNodeId=flowchartNodeOutputDataItem.GetConnectedFlowchartNodeFlowchartId();if(!_C128.IsFiniteNumber(newFlowchartNodeId))return;this._previousFlowchartNodeIds.push(this._currentFlowchartNodeId);this._GotoFlowchartNode(newFlowchartNodeId);}},{key:"GotoAnyFlowchartNode",value:function GotoAnyFlowchartNode(nodeTag){var flowchartNodeDataItem=this._flowchartDataItem.GetFlowchartNodeByTag(nodeTag);if(!flowchartNodeDataItem)return;var newFlowchartNodeDataItem=this._flowchartDataItem.GetFlowchartElementById(flowchartNodeDataItem.GetFlowchartId());if(!newFlowchartNodeDataItem)return;this._previousFlowchartNodeIds.push(this._currentFlowchartNodeId);this._GotoFlowchartNode(newFlowchartNodeDataItem.GetFlowchartId());}},{key:"GotoPreviousFlowchartNode",value:function GotoPreviousFlowchartNode(){var previousFlowchartNodeId=this._previousFlowchartNodeIds.pop(this._currentFlowchartNodeId);if(_C128.IsFiniteNumber(previousFlowchartNodeId))this._GotoFlowchartNode(previousFlowchartNodeId);}},{key:"GotoParentFlowchartNode",value:function GotoParentFlowchartNode(indexOrTag){var currentFlowchartNode=this.GetCurrentNode();var flowchartNodeId=currentFlowchartNode.GetFlowchartId();var parentFlowchartNode=this.GetCurrentNodeParent(indexOrTag);if(parentFlowchartNode){this._previousFlowchartNodeIds.push(this._currentFlowchartNodeId);this._GotoFlowchartNode(parentFlowchartNode.GetFlowchartId());}}},{key:"HasOutput",value:function HasOutput(outputIndexOrName){if(_C128.IsFiniteNumber(outputIndexOrName)){var flowchartNodeDataItem=this._flowchartDataItem.GetFlowchartElementById(this._currentFlowchartNodeId);var flowchartNodeOutputDataItems=flowchartNodeDataItem.GetFlowchartNodeOutputData().GetFlowchartNodeOutputDataItems();return!!flowchartNodeOutputDataItems[outputIndexOrName];}if(typeof outputIndexOrName==="string"){var _flowchartNodeDataItem=this._flowchartDataItem.GetFlowchartElementById(this._currentFlowchartNodeId);var _flowchartNodeOutputDataItems=_flowchartNodeDataItem.GetFlowchartNodeOutputData().GetFlowchartNodeOutputDataItems();for(var i=0;i<_flowchartNodeOutputDataItems.length;i++){if(_flowchartNodeOutputDataItems[i].GetName()===outputIndexOrName)return true;}return false;}return false;}},{key:"MarkForRelease",value:function MarkForRelease(){this._markForRelease=true;}},{key:"IsInTriggerState",value:function IsInTriggerState(){return this._triggerCount>0;}},{key:"PushIsTriggerState",value:function PushIsTriggerState(){this._triggerCount++;}},{key:"PopIsTriggerState",value:function PopIsTriggerState(){this._triggerCount--;if(this._triggerCount===0&&this._markForRelease)this._flowchartManager.RemoveFlowchartState(this);}},{key:"_GotoFlowchartNode",value:function _GotoFlowchartNode(newFlowchartNodeId){var inst=this.GetPluginInstance().GetInstance();this.PushIsTriggerState();this._flowchartManager.PushFlowchartState(this);this._runtime.Trigger(_C128.Plugins.Flowchart.Cnds.OnBeforeAnyNodeChange,inst);this._runtime.Trigger(_C128.Plugins.Flowchart.Cnds.OnBeforeTaggedNodeChange,inst);this._runtime.Trigger(_C128.Plugins.Flowchart.Cnds.OnBeforeAnyNodeChangeInFlowchart,inst);this._runtime.Trigger(_C128.Plugins.Flowchart.Cnds.OnBeforeTaggedNodeChangeInFlowchart,inst);this._currentFlowchartNodeId=newFlowchartNodeId;this._runtime.Trigger(_C128.Plugins.Flowchart.Cnds.OnAnyNodeChange,inst);this._runtime.Trigger(_C128.Plugins.Flowchart.Cnds.OnTaggedNodeChange,inst);this._runtime.Trigger(_C128.Plugins.Flowchart.Cnds.OnAnyNodeChangeInFlowchart,inst);this._runtime.Trigger(_C128.Plugins.Flowchart.Cnds.OnTaggedNodeChangeInFlowchart,inst);this._flowchartManager.PopFlowchartState();this.PopIsTriggerState();}},{key:"_GetFlowchartNodeOutputAt",value:function _GetFlowchartNodeOutputAt(index){var flowchartNodeDataItem=this._flowchartDataItem.GetFlowchartElementById(this._currentFlowchartNodeId);if(!flowchartNodeDataItem)return null;var flowchartNodeOutputDataItems=flowchartNodeDataItem.GetFlowchartNodeOutputData().GetFlowchartNodeOutputDataItems();if(!flowchartNodeOutputDataItems)return null;var flowchartNodeOutputDataItem=flowchartNodeOutputDataItems[index];if(!flowchartNodeOutputDataItem)return null;return flowchartNodeOutputDataItem;}},{key:"_GetFlowchartNodeOutputByName",value:function _GetFlowchartNodeOutputByName(outputName){var flowchartNodeDataItem=this._flowchartDataItem.GetFlowchartElementById(this._currentFlowchartNodeId);if(!flowchartNodeDataItem)return null;var flowchartNodeOutputDataItem=flowchartNodeDataItem.GetFlowchartNodeOutputData().GetFlowchartNodeOutputDataItemByName(outputName);if(!flowchartNodeOutputDataItem)return null;return flowchartNodeOutputDataItem;}},{key:"_SetStartFlowchartNode",value:function _SetStartFlowchartNode(){var startFlowchartNode=this._flowchartDataItem.GetFlowchartNodeByTag(this._startNodeTag);if(!startFlowchartNode)startFlowchartNode=this._flowchartDataItem.GetFlowchartStartNode();this._startFlowchartNode=startFlowchartNode;}},{key:"_SaveToJson",value:function _SaveToJson(){if(this._markForRelease)return null;return{"flowchartName":this._flowchartName,"flowchartTag":this._tag,"startNodeTag":this._startNodeTag,"currentNodeId":this._currentFlowchartNodeId,"previousNodeIds":this._previousFlowchartNodeIds,"pluginUID":this._pluginInstance.GetInstance().GetUID()};}},{key:"_LoadFromJson",value:function _LoadFromJson(o){if(!o)return;this._flowchartName=o["flowchartName"];this._tag=o["flowchartTag"];this._startNodeTag=o["startNodeTag"];this._currentFlowchartNodeId=o["currentNodeId"];this._previousFlowchartNodeIds=o["previousNodeIds"];this._pluginUID=o["pluginUID"];this._SetStartFlowchartNode();}}]);return Flowchart;}();}// flowcharts/data/flowchartDataManager.js
{'use strict';var _C129=self.C3;_C129.FlowchartDataManager=/*#__PURE__*/function(){function FlowchartDataManager(){_classCallCheck(this,FlowchartDataManager);this._flowchartDataItems=new Map();}_createClass(FlowchartDataManager,[{key:"Release",value:function Release(){var _iteratorNormalCompletion316=true;var _didIteratorError316=false;var _iteratorError316=undefined;try{for(var _iterator316=this._flowchartDataItems.values()[Symbol.iterator](),_step316;!(_iteratorNormalCompletion316=(_step316=_iterator316.next()).done);_iteratorNormalCompletion316=true){var flowchartDataItem=_step316.value;flowchartDataItem.Release();}}catch(err){_didIteratorError316=true;_iteratorError316=err;}finally{try{if(!_iteratorNormalCompletion316&&_iterator316["return"]!=null){_iterator316["return"]();}}finally{if(_didIteratorError316){throw _iteratorError316;}}}this._flowchartDataItems.clear();this._flowchartDataItems=null;}},{key:"Add",value:function Add(data){var flowchartDataItem=new _C129.FlowchartDataItem(data);var name=flowchartDataItem.GetName();this._flowchartDataItems.set(name,flowchartDataItem);}},{key:"Get",value:function Get(name){return this._flowchartDataItems.get(name);}},{key:"HasFlowcharts",value:function HasFlowcharts(){return!!this._flowchartDataItems.size;}}],[{key:"CreateDataItems",value:function CreateDataItems(items,jsonItems,dataItemConstructor,dataContainer){if(!jsonItems)return;var _iteratorNormalCompletion317=true;var _didIteratorError317=false;var _iteratorError317=undefined;try{for(var _iterator317=jsonItems[Symbol.iterator](),_step317;!(_iteratorNormalCompletion317=(_step317=_iterator317.next()).done);_iteratorNormalCompletion317=true){var jsonItem=_step317.value;var dataItem=new dataItemConstructor(jsonItem,dataContainer);items.push(dataItem);}}catch(err){_didIteratorError317=true;_iteratorError317=err;}finally{try{if(!_iteratorNormalCompletion317&&_iterator317["return"]!=null){_iterator317["return"]();}}finally{if(_didIteratorError317){throw _iteratorError317;}}}}}]);return FlowchartDataManager;}();}// flowcharts/data/flowchartData.js
{'use strict';var _C130=self.C3;var _NAME4=0;var NODES=1;_C130.FlowchartDataItem=/*#__PURE__*/function(){function FlowchartDataItem(flowchartDataJson){_classCallCheck(this,FlowchartDataItem);this._name=flowchartDataJson[_NAME4];this._flowchartNodeData=new _C130.FlowchartNodeData(flowchartDataJson[NODES],this);}_createClass(FlowchartDataItem,[{key:"Release",value:function Release(){this._flowchartNodeData.Release();this._flowchartNodeData=null;}},{key:"GetFlowchartNodeData",value:function GetFlowchartNodeData(){return this._flowchartNodeData;}},{key:"GetFlowchartElementById",value:function GetFlowchartElementById(id){return this._flowchartNodeData.GetFlowchartElementById(id);}},{key:"GetFlowchartNodeByTag",value:function GetFlowchartNodeByTag(tag){return this._flowchartNodeData.GetFlowchartNodeByTag(tag);}},{key:"GetFlowchartStartNode",value:function GetFlowchartStartNode(){return this._flowchartNodeData.GetFlowchartStartNode();}},{key:"GetName",value:function GetName(){return this._name;}}]);return FlowchartDataItem;}();}// flowcharts/data/flowchartNodeData.js
{'use strict';var _C131=self.C3;var FLOWCHART_ID=0;var TAG=1;var PARENT_FLOWCHART_IDS=2;var PARENT_OUTPUT_FLOWCHART_IDS=3;var CHILDREN_FLOWCHART_IDS=4;var OUTPUTS=5;var IS_START=6;var FlowchartNodeDataItem=/*#__PURE__*/function(){function FlowchartNodeDataItem(flowchartNodeJson,flowchartNodeData){_classCallCheck(this,FlowchartNodeDataItem);this._flowchartNodeData=flowchartNodeData;this._flowchartId=flowchartNodeJson[FLOWCHART_ID];this._tag=flowchartNodeJson[TAG];this._parentFlowchartIds=flowchartNodeJson[PARENT_FLOWCHART_IDS];this._parentOutputFlowchartIds=flowchartNodeJson[PARENT_OUTPUT_FLOWCHART_IDS];this._childrenFlowchartIds=flowchartNodeJson[CHILDREN_FLOWCHART_IDS];this._isStart=flowchartNodeJson[IS_START];this._flowchartNodeOutputData=new _C131.FlowchartNodeOutputData(flowchartNodeJson[OUTPUTS],this);}_createClass(FlowchartNodeDataItem,[{key:"Release",value:function Release(){this._flowchartNodeData=null;}},{key:"GetFlowchartNodeData",value:function GetFlowchartNodeData(){return this._flowchartNodeData;}},{key:"GetFlowchartNodeOutputData",value:function GetFlowchartNodeOutputData(){return this._flowchartNodeOutputData;}},{key:"GetFlowchartId",value:function GetFlowchartId(){return this._flowchartId;}},{key:"GetTag",value:function GetTag(){return this._tag;}},{key:"GetIsStart",value:function GetIsStart(){return this._isStart;}},{key:"GetParentFlowchartIds",value:function GetParentFlowchartIds(){return this._parentFlowchartIds;}},{key:"GetParentOutputFlowchartIds",value:function GetParentOutputFlowchartIds(){return this._parentOutputFlowchartIds;}},{key:"GetChildrenFlowchartIds",value:function GetChildrenFlowchartIds(){return this._childrenFlowchartIds;}}]);return FlowchartNodeDataItem;}();_C131.FlowchartNodeData=/*#__PURE__*/function(){function FlowchartNodeData(flowchartNodesDataJson,flowchartDataItem){_classCallCheck(this,FlowchartNodeData);this._flowchartDataItem=flowchartDataItem;this._flowchartNodeItems=[];this._flowchartNodeItemsIdMap=new Map();this._flowchartNodeItemsTagMap=new Map();this._flowchartNodeStartItem=null;_C131.FlowchartDataManager.CreateDataItems(this._flowchartNodeItems,flowchartNodesDataJson,FlowchartNodeDataItem,this);var _iteratorNormalCompletion318=true;var _didIteratorError318=false;var _iteratorError318=undefined;try{for(var _iterator318=this._flowchartNodeItems[Symbol.iterator](),_step318;!(_iteratorNormalCompletion318=(_step318=_iterator318.next()).done);_iteratorNormalCompletion318=true){var flowchartNodeItem=_step318.value;var flowchartId=flowchartNodeItem.GetFlowchartId();var tag=flowchartNodeItem.GetTag();var isStart=flowchartNodeItem.GetIsStart();this._flowchartNodeItemsIdMap.set(flowchartId,flowchartNodeItem);if(tag)this._flowchartNodeItemsTagMap.set(tag,flowchartNodeItem);if(isStart)this._flowchartNodeStartItem=flowchartNodeItem;var flowchartNodeOutputData=flowchartNodeItem.GetFlowchartNodeOutputData();var _iteratorNormalCompletion319=true;var _didIteratorError319=false;var _iteratorError319=undefined;try{for(var _iterator319=flowchartNodeOutputData.flowchartNodeOutputDataItems()[Symbol.iterator](),_step319;!(_iteratorNormalCompletion319=(_step319=_iterator319.next()).done);_iteratorNormalCompletion319=true){var flowchartNodeOutputDataItem=_step319.value;var _flowchartId=flowchartNodeOutputDataItem.GetFlowchartId();this._flowchartNodeItemsIdMap.set(_flowchartId,flowchartNodeOutputDataItem);}}catch(err){_didIteratorError319=true;_iteratorError319=err;}finally{try{if(!_iteratorNormalCompletion319&&_iterator319["return"]!=null){_iterator319["return"]();}}finally{if(_didIteratorError319){throw _iteratorError319;}}}}}catch(err){_didIteratorError318=true;_iteratorError318=err;}finally{try{if(!_iteratorNormalCompletion318&&_iterator318["return"]!=null){_iterator318["return"]();}}finally{if(_didIteratorError318){throw _iteratorError318;}}}}_createClass(FlowchartNodeData,[{key:"Release",value:function Release(){this._flowchartDataItem=null;var _iteratorNormalCompletion320=true;var _didIteratorError320=false;var _iteratorError320=undefined;try{for(var _iterator320=this._flowchartNodeItems[Symbol.iterator](),_step320;!(_iteratorNormalCompletion320=(_step320=_iterator320.next()).done);_iteratorNormalCompletion320=true){var flowchartNodeDataItem=_step320.value;flowchartNodeDataItem.Release();}}catch(err){_didIteratorError320=true;_iteratorError320=err;}finally{try{if(!_iteratorNormalCompletion320&&_iterator320["return"]!=null){_iterator320["return"]();}}finally{if(_didIteratorError320){throw _iteratorError320;}}}_C131.clearArray(this._flowchartNodeItems);this._flowchartNodeItems=null;}},{key:"GetFlowchartDataItem",value:function GetFlowchartDataItem(){return this._flowchartDataItem;}},{key:"GetFlowchartElementById",value:function GetFlowchartElementById(id){return this._flowchartNodeItemsIdMap.get(id);}},{key:"GetFlowchartNodeByTag",value:function GetFlowchartNodeByTag(tag){return this._flowchartNodeItemsTagMap.get(tag);}},{key:"GetFlowchartStartNode",value:function GetFlowchartStartNode(){return this._flowchartNodeStartItem;}},{key:"flowchartNodeDataItems",value:/*#__PURE__*/regeneratorRuntime.mark(function flowchartNodeDataItems(){var _iteratorNormalCompletion321,_didIteratorError321,_iteratorError321,_iterator321,_step321,flowchartNodeDataItem;return regeneratorRuntime.wrap(function flowchartNodeDataItems$(_context99){while(1){switch(_context99.prev=_context99.next){case 0:_iteratorNormalCompletion321=true;_didIteratorError321=false;_iteratorError321=undefined;_context99.prev=3;_iterator321=this._flowchartNodeItems[Symbol.iterator]();case 5:if(_iteratorNormalCompletion321=(_step321=_iterator321.next()).done){_context99.next=12;break;}flowchartNodeDataItem=_step321.value;_context99.next=9;return flowchartNodeDataItem;case 9:_iteratorNormalCompletion321=true;_context99.next=5;break;case 12:_context99.next=18;break;case 14:_context99.prev=14;_context99.t0=_context99["catch"](3);_didIteratorError321=true;_iteratorError321=_context99.t0;case 18:_context99.prev=18;_context99.prev=19;if(!_iteratorNormalCompletion321&&_iterator321["return"]!=null){_iterator321["return"]();}case 21:_context99.prev=21;if(!_didIteratorError321){_context99.next=24;break;}throw _iteratorError321;case 24:return _context99.finish(21);case 25:return _context99.finish(18);case 26:case"end":return _context99.stop();}}},flowchartNodeDataItems,this,[[3,14,18,26],[19,,21,25]]);})}]);return FlowchartNodeData;}();}// flowcharts/data/flowchartNodeOutputData.js
{'use strict';var _C132=self.C3;var _FLOWCHART_ID=0;var _NAME5=1;var VALUE=2;var CONNECTED_FLOWCHART_NODE_FLOWCHART_ID=3;var FlowchartNodeDataOutputItem=/*#__PURE__*/function(){function FlowchartNodeDataOutputItem(flowchartNodeOutputJson,flowchartNodeOutputData){_classCallCheck(this,FlowchartNodeDataOutputItem);this._flowchartNodeOutputData=flowchartNodeOutputData;this._flowchartId=flowchartNodeOutputJson[_FLOWCHART_ID];this._name=flowchartNodeOutputJson[_NAME5];this._value=flowchartNodeOutputJson[VALUE];this._connectedFlowchartNodeFlowchartId=flowchartNodeOutputJson[CONNECTED_FLOWCHART_NODE_FLOWCHART_ID];}_createClass(FlowchartNodeDataOutputItem,[{key:"Release",value:function Release(){this._flowchartNodeOutputData=null;}},{key:"GetFlowchartNodeOutputData",value:function GetFlowchartNodeOutputData(){return this._flowchartNodeOutputData;}},{key:"GetFlowchartId",value:function GetFlowchartId(){return this._flowchartId;}},{key:"GetName",value:function GetName(){return this._name;}},{key:"GetValue",value:function GetValue(){return this._value;}},{key:"GetConnectedFlowchartNodeFlowchartId",value:function GetConnectedFlowchartNodeFlowchartId(){return this._connectedFlowchartNodeFlowchartId;}}]);return FlowchartNodeDataOutputItem;}();_C132.FlowchartNodeOutputData=/*#__PURE__*/function(){function FlowchartNodeOutputData(flowchartNodeOuputsDataJson,flowchartDataNodeItem){_classCallCheck(this,FlowchartNodeOutputData);this._flowchartDataNodeItem=flowchartDataNodeItem;this._flowchartNodeOutputItems=[];this._flowchartNodeOutputItemsNameMap=new Map();_C132.FlowchartDataManager.CreateDataItems(this._flowchartNodeOutputItems,flowchartNodeOuputsDataJson,FlowchartNodeDataOutputItem,this);var _iteratorNormalCompletion322=true;var _didIteratorError322=false;var _iteratorError322=undefined;try{for(var _iterator322=this._flowchartNodeOutputItems[Symbol.iterator](),_step322;!(_iteratorNormalCompletion322=(_step322=_iterator322.next()).done);_iteratorNormalCompletion322=true){var flowchartNodeOutputItem=_step322.value;this._flowchartNodeOutputItemsNameMap.set(flowchartNodeOutputItem.GetName(),flowchartNodeOutputItem);}}catch(err){_didIteratorError322=true;_iteratorError322=err;}finally{try{if(!_iteratorNormalCompletion322&&_iterator322["return"]!=null){_iterator322["return"]();}}finally{if(_didIteratorError322){throw _iteratorError322;}}}}_createClass(FlowchartNodeOutputData,[{key:"Release",value:function Release(){this._flowchartDataNodeItem=null;var _iteratorNormalCompletion323=true;var _didIteratorError323=false;var _iteratorError323=undefined;try{for(var _iterator323=this._flowchartNodeOutputItems[Symbol.iterator](),_step323;!(_iteratorNormalCompletion323=(_step323=_iterator323.next()).done);_iteratorNormalCompletion323=true){var flowchartNodeDataItem=_step323.value;flowchartNodeDataItem.Release();}}catch(err){_didIteratorError323=true;_iteratorError323=err;}finally{try{if(!_iteratorNormalCompletion323&&_iterator323["return"]!=null){_iterator323["return"]();}}finally{if(_didIteratorError323){throw _iteratorError323;}}}_C132.clearArray(this._flowchartNodeOutputItems);this._flowchartNodeOutputItems=null;}},{key:"GetFlowchartNodeDataItem",value:function GetFlowchartNodeDataItem(){return this._flowchartDataNodeItem;}},{key:"GetFlowchartNodeOutputDataItemCount",value:function GetFlowchartNodeOutputDataItemCount(){return this._flowchartNodeOutputItems.length;}},{key:"GetFlowchartNodeOutputDataItems",value:function GetFlowchartNodeOutputDataItems(){return this._flowchartNodeOutputItems;}},{key:"GetFlowchartNodeOutputDataItemByName",value:function GetFlowchartNodeOutputDataItemByName(outputName){return this._flowchartNodeOutputItemsNameMap.get(outputName);}},{key:"flowchartNodeOutputDataItems",value:/*#__PURE__*/regeneratorRuntime.mark(function flowchartNodeOutputDataItems(){var _iteratorNormalCompletion324,_didIteratorError324,_iteratorError324,_iterator324,_step324,flowchartNodeDataItem;return regeneratorRuntime.wrap(function flowchartNodeOutputDataItems$(_context100){while(1){switch(_context100.prev=_context100.next){case 0:_iteratorNormalCompletion324=true;_didIteratorError324=false;_iteratorError324=undefined;_context100.prev=3;_iterator324=this._flowchartNodeOutputItems[Symbol.iterator]();case 5:if(_iteratorNormalCompletion324=(_step324=_iterator324.next()).done){_context100.next=12;break;}flowchartNodeDataItem=_step324.value;_context100.next=9;return flowchartNodeDataItem;case 9:_iteratorNormalCompletion324=true;_context100.next=5;break;case 12:_context100.next=18;break;case 14:_context100.prev=14;_context100.t0=_context100["catch"](3);_didIteratorError324=true;_iteratorError324=_context100.t0;case 18:_context100.prev=18;_context100.prev=19;if(!_iteratorNormalCompletion324&&_iterator324["return"]!=null){_iterator324["return"]();}case 21:_context100.prev=21;if(!_didIteratorError324){_context100.next=24;break;}throw _iteratorError324;case 24:return _context100.finish(21);case 25:return _context100.finish(18);case 26:case"end":return _context100.stop();}}},flowchartNodeOutputDataItems,this,[[3,14,18,26],[19,,21,25]]);})}]);return FlowchartNodeOutputData;}();}// events/stacks/solStack.js
{'use strict';var _C133=self.C3;_C133.SolStack=/*#__PURE__*/function(_C133$DefendedBase){_inherits(SolStack,_C133$DefendedBase);function SolStack(objectClass){var _this69;_classCallCheck(this,SolStack);_this69=_possibleConstructorReturn(this,_getPrototypeOf(SolStack).call(this));_this69._objectClass=objectClass;_this69._stack=[];_this69._stack.push(_C133.New(_C133.Sol,_assertThisInitialized(_this69)));_this69._index=0;_this69._current=_this69._stack[0];return _this69;}_createClass(SolStack,[{key:"Release",value:function Release(){var _iteratorNormalCompletion325=true;var _didIteratorError325=false;var _iteratorError325=undefined;try{for(var _iterator325=this._stack[Symbol.iterator](),_step325;!(_iteratorNormalCompletion325=(_step325=_iterator325.next()).done);_iteratorNormalCompletion325=true){var s=_step325.value;s.Release();}}catch(err){_didIteratorError325=true;_iteratorError325=err;}finally{try{if(!_iteratorNormalCompletion325&&_iterator325["return"]!=null){_iterator325["return"]();}}finally{if(_didIteratorError325){throw _iteratorError325;}}}_C133.clearArray(this._stack);this._current=null;this._objectClass=null;}},{key:"GetObjectClass",value:function GetObjectClass(){return this._objectClass;}},{key:"GetCurrentSol",value:function GetCurrentSol(){return this._current;}},{key:"GetOneBelowCurrentSol",value:function GetOneBelowCurrentSol(){return this._stack[this._index-1];}},{key:"Clear",value:function Clear(){this.GetCurrentSol().Clear();}},{key:"PushClean",value:function PushClean(){var stack=this._stack;var index=++this._index;if(index===stack.length){var sol=_C133.New(_C133.Sol,this);stack.push(sol);this._current=sol;}else{var _sol=stack[index];_sol.Reset();this._current=_sol;}}},{key:"PushCopy",value:function PushCopy(){var stack=this._stack;var index=++this._index;if(index===stack.length)stack.push(_C133.New(_C133.Sol,this));var sol=stack[index];sol.Copy(stack[index-1]);this._current=sol;}},{key:"Pop",value:function Pop(){this._current=this._stack[--this._index];}},{key:"RemoveInstances",value:function RemoveInstances(s){var stack=this._stack;for(var i=0,len=stack.length;i<len;++i){stack[i].RemoveInstances(s);}}}]);return SolStack;}(_C133.DefendedBase);}// events/stacks/sol.js
{'use strict';var _C134=self.C3;_C134.Sol=/*#__PURE__*/function(_C134$DefendedBase){_inherits(Sol,_C134$DefendedBase);function Sol(stack){var _this70;_classCallCheck(this,Sol);_this70=_possibleConstructorReturn(this,_getPrototypeOf(Sol).call(this));_this70._stack=stack;_this70._objectClass=_this70._stack.GetObjectClass();_this70._eventStack=_this70._objectClass.GetRuntime().GetEventStack();_this70._selectAll=true;_this70._instances=[];_this70._elseInstances=[];return _this70;}_createClass(Sol,[{key:"Release",value:function Release(){this.ClearArrays();this._stack=null;this._objectClass=null;this._eventStack=null;}},{key:"ClearArrays",value:function ClearArrays(){_C134.clearArray(this._instances);_C134.clearArray(this._elseInstances);}},{key:"GetObjectClass",value:function GetObjectClass(){return this._objectClass;}},{key:"IsSelectAll",value:function IsSelectAll(){return this._selectAll;}},{key:"HasAnyInstances",value:function HasAnyInstances(){if(this._selectAll)return!!this._objectClass.GetInstanceCount();else return!!this._instances.length;}},{key:"GetInstances",value:function GetInstances(){if(this._selectAll)return this._objectClass.GetInstances();else return this._instances;}},{key:"HasAnyElseInstances",value:function HasAnyElseInstances(){return!!this._elseInstances.length;}},{key:"GetElseInstances",value:function GetElseInstances(){return this._elseInstances;}},{key:"GetExpressionInstances",value:function GetExpressionInstances(){var ret=this.GetInstances();if(ret.length)return ret;else return this._elseInstances;}},{key:"Reset",value:function Reset(){this._selectAll=true;_C134.clearArray(this._elseInstances);}},{key:"Clear",value:function Clear(){this._selectAll=true;}},{key:"Copy",value:function Copy(sol){if(sol.IsSelectAll())this.Reset();else{this._selectAll=false;_C134.shallowAssignArray(this._instances,sol._instances);_C134.clearArray(this._elseInstances);}}},{key:"_PushInstance",value:function _PushInstance(inst){this._instances.push(inst);}},{key:"_PushElseInstance",value:function _PushElseInstance(inst){this._elseInstances.push(inst);}},{key:"_SetSelectAll",value:function _SetSelectAll(s){this._selectAll=!!s;}},{key:"_GetOwnInstances",value:function _GetOwnInstances(){return this._instances;}},{key:"_GetOwnElseInstances",value:function _GetOwnElseInstances(){return this._elseInstances;}},{key:"SetSinglePicked",value:function SetSinglePicked(inst){this._selectAll=false;_C134.clearArray(this._instances);this._instances.push(inst);}},{key:"SetArrayPicked",value:function SetArrayPicked(arr){this._selectAll=false;_C134.shallowAssignArray(this._instances,arr);}},{key:"SetSetPicked",value:function SetSetPicked(set){this._selectAll=false;_C134.clearArray(this._instances);var _iteratorNormalCompletion326=true;var _didIteratorError326=false;var _iteratorError326=undefined;try{for(var _iterator326=set[Symbol.iterator](),_step326;!(_iteratorNormalCompletion326=(_step326=_iterator326.next()).done);_iteratorNormalCompletion326=true){var item=_step326.value;this._instances.push(item);}}catch(err){_didIteratorError326=true;_iteratorError326=err;}finally{try{if(!_iteratorNormalCompletion326&&_iterator326["return"]!=null){_iterator326["return"]();}}finally{if(_didIteratorError326){throw _iteratorError326;}}}}},{key:"AddElseInstances",value:function AddElseInstances(setOfPicked,arrayOfAllPicked){var _iteratorNormalCompletion327=true;var _didIteratorError327=false;var _iteratorError327=undefined;try{for(var _iterator327=arrayOfAllPicked[Symbol.iterator](),_step327;!(_iteratorNormalCompletion327=(_step327=_iterator327.next()).done);_iteratorNormalCompletion327=true){var inst=_step327.value;if(!setOfPicked.has(inst))this._elseInstances.push(inst);}}catch(err){_didIteratorError327=true;_iteratorError327=err;}finally{try{if(!_iteratorNormalCompletion327&&_iterator327["return"]!=null){_iterator327["return"]();}}finally{if(_didIteratorError327){throw _iteratorError327;}}}}},{key:"TransferElseInstancesToOwn",value:function TransferElseInstancesToOwn(setOfPicked){var _iteratorNormalCompletion328=true;var _didIteratorError328=false;var _iteratorError328=undefined;try{for(var _iterator328=setOfPicked[Symbol.iterator](),_step328;!(_iteratorNormalCompletion328=(_step328=_iterator328.next()).done);_iteratorNormalCompletion328=true){var inst=_step328.value;this._instances.push(inst);}}catch(err){_didIteratorError328=true;_iteratorError328=err;}finally{try{if(!_iteratorNormalCompletion328&&_iterator328["return"]!=null){_iterator328["return"]();}}finally{if(_didIteratorError328){throw _iteratorError328;}}}_C134.arrayRemoveAllInSet(this._elseInstances,setOfPicked);}},{key:"ClearElseInstances",value:function ClearElseInstances(){_C134.clearArray(this._elseInstances);}},{key:"PickOne",value:function PickOne(inst){if(!inst)return;if(this._eventStack.GetCurrentStackFrame().GetCurrentEvent().IsOrBlock()){if(this.IsSelectAll()){_C134.clearArray(this._instances);_C134.shallowAssignArray(this._elseInstances,inst.GetObjectClass().GetInstances());this._selectAll=false;}var i=this._elseInstances.indexOf(inst);if(i!==-1){this._instances.push(this._elseInstances[i]);this._elseInstances.splice(i,1);}}else this.SetSinglePicked(inst);}},{key:"RemoveInstances",value:function RemoveInstances(s){_C134.arrayRemoveAllInSet(this._instances,s);_C134.arrayRemoveAllInSet(this._elseInstances,s);}}]);return Sol;}(_C134.DefendedBase);}// events/stacks/eventStack.js
{'use strict';var _C135=self.C3;_C135.EventStack=/*#__PURE__*/function(_C135$DefendedBase){_inherits(EventStack,_C135$DefendedBase);function EventStack(eventSheetManager){var _this71;_classCallCheck(this,EventStack);_this71=_possibleConstructorReturn(this,_getPrototypeOf(EventStack).call(this));_this71._eventSheetManager=eventSheetManager;_this71._runtime=_this71._eventSheetManager.GetRuntime();_this71._stack=[];_this71._stack.push(_C135.New(_C135.EventStackFrame,_assertThisInitialized(_this71),null));_this71._index=0;_this71._expFuncStack=[];return _this71;}_createClass(EventStack,[{key:"Release",value:function Release(){var _iteratorNormalCompletion329=true;var _didIteratorError329=false;var _iteratorError329=undefined;try{for(var _iterator329=this._stack[Symbol.iterator](),_step329;!(_iteratorNormalCompletion329=(_step329=_iterator329.next()).done);_iteratorNormalCompletion329=true){var e=_step329.value;e.Release();}}catch(err){_didIteratorError329=true;_iteratorError329=err;}finally{try{if(!_iteratorNormalCompletion329&&_iterator329["return"]!=null){_iterator329["return"]();}}finally{if(_didIteratorError329){throw _iteratorError329;}}}_C135.clearArray(this._stack);_C135.clearArray(this._expFuncStack);this._eventSheetManager=null;this._runtime=null;}},{key:"GetEventSheetManager",value:function GetEventSheetManager(){return this._eventSheetManager;}},{key:"GetRuntime",value:function GetRuntime(){return this._runtime;}},{key:"GetCurrentStackFrame",value:function GetCurrentStackFrame(){return this._stack[this._index];}},{key:"GetAllStackFrames",value:function GetAllStackFrames(){return this._stack;}},{key:"GetCurrentStackFrameIndex",value:function GetCurrentStackFrameIndex(){return this._index;}},{key:"Push",value:function Push(currentEvent){var stack=this._stack;var index=++this._index;if(index===stack.length){var ret=_C135.New(_C135.EventStackFrame,this,currentEvent);stack.push(ret);return ret;}else{var _ret6=stack[index];_ret6.Reset(currentEvent);return _ret6;}}},{key:"Pop",value:function Pop(){--this._index;}},{key:"PushExpFunc",value:function PushExpFunc(frame){this._expFuncStack.push(frame);}},{key:"PopExpFunc",value:function PopExpFunc(){this._expFuncStack.pop();}},{key:"GetCurrentExpFuncStackFrame",value:function GetCurrentExpFuncStackFrame(){var expFuncStack=this._expFuncStack;if(expFuncStack.length===0)return null;else return expFuncStack.at(-1);}}]);return EventStack;}(_C135.DefendedBase);}// events/stacks/eventStackFrame.js
{'use strict';var _C136=self.C3;_C136.EventStackFrame=/*#__PURE__*/function(_C136$DefendedBase){_inherits(EventStackFrame,_C136$DefendedBase);function EventStackFrame(stack,currentEvent){var _this72;_classCallCheck(this,EventStackFrame);_this72=_possibleConstructorReturn(this,_getPrototypeOf(EventStackFrame).call(this));_this72._stack=stack;_this72._runtime=_this72._stack.GetRuntime();_this72._currentEvent=currentEvent;_this72._cndIndex=0;_this72._actIndex=0;_this72._lastEventTrue=false;_this72._elseBranchRan=false;_this72._expressionObjectClass=null;_this72._functionReturnType=0;_this72._functionReturnValue=0;_this72._dynamicSolModifiers=null;return _this72;}_createClass(EventStackFrame,[{key:"Release",value:function Release(){this.Reset(null);this._stack=null;this._runtime=null;}},{key:"Reset",value:function Reset(currentEvent){this._currentEvent=currentEvent;this._cndIndex=0;this._actIndex=0;this._lastEventTrue=false;this._elseBranchRan=false;this._dynamicSolModifiers=null;}},{key:"_Restore",value:function _Restore(currentEvent,actIndex){this._currentEvent=currentEvent;this._cndIndex=0;this._actIndex=actIndex;}},{key:"ResetQuick",value:function ResetQuick(){this._cndIndex=0;this._actIndex=0;}},{key:"GetCurrentEvent",value:function GetCurrentEvent(){return this._currentEvent;}},{key:"SetCurrentEvent",value:function SetCurrentEvent(currentEvent){this._currentEvent=currentEvent;}},{key:"GetConditionIndex",value:function GetConditionIndex(){return this._cndIndex;}},{key:"SetConditionIndex",value:function SetConditionIndex(i){this._cndIndex=i;}},{key:"GetActionIndex",value:function GetActionIndex(){return this._actIndex;}},{key:"SetActionIndex",value:function SetActionIndex(i){this._actIndex=i;}},{key:"SetLastEventTrue",value:function SetLastEventTrue(t){this._lastEventTrue=!!t;}},{key:"GetLastEventTrue",value:function GetLastEventTrue(){return this._lastEventTrue;}},{key:"SetElseBranchRan",value:function SetElseBranchRan(r){this._elseBranchRan=!!r;}},{key:"GetElseBranchRan",value:function GetElseBranchRan(){return this._elseBranchRan;}},{key:"SetExpressionObjectClass",value:function SetExpressionObjectClass(objectClass){this._expressionObjectClass=objectClass;}},{key:"GetExpressionObjectClass",value:function GetExpressionObjectClass(){return this._expressionObjectClass;}},{key:"InitCallFunctionExpression",value:function InitCallFunctionExpression(returnType,defaultReturnValue){this._functionReturnType=returnType;this._functionReturnValue=defaultReturnValue;}},{key:"GetFunctionReturnType",value:function GetFunctionReturnType(){return this._functionReturnType;}},{key:"SetFunctionReturnValue",value:function SetFunctionReturnValue(v){this._functionReturnValue=v;}},{key:"GetFunctionReturnValue",value:function GetFunctionReturnValue(){return this._functionReturnValue;}},{key:"IsSolModifierAfterCnds",value:function IsSolModifierAfterCnds(){var currentEvent=this._currentEvent;if(currentEvent.IsSolWriterAfterCnds())return true;if(this._cndIndex<currentEvent.GetConditionCount()-1)return!!currentEvent.GetSolModifiers().length;return false;}},{key:"SetDynamicSolModifiers",value:function SetDynamicSolModifiers(solModifiers){this._dynamicSolModifiers=solModifiers;}},{key:"GetDynamicSolModifiers",value:function GetDynamicSolModifiers(){return this._dynamicSolModifiers;}}]);return EventStackFrame;}(_C136.DefendedBase);}// events/stacks/localVarStack.js
{'use strict';var _C137=self.C3;_C137.LocalVarStack=/*#__PURE__*/function(_C137$DefendedBase){_inherits(LocalVarStack,_C137$DefendedBase);function LocalVarStack(eventSheetManager){var _this73;_classCallCheck(this,LocalVarStack);_this73=_possibleConstructorReturn(this,_getPrototypeOf(LocalVarStack).call(this));_this73._eventSheetManager=eventSheetManager;_this73._runtime=_this73._eventSheetManager.GetRuntime();_this73._stack=[];_this73._index=-1;_this73._current=null;_this73._initialValues=[];return _this73;}_createClass(LocalVarStack,[{key:"Release",value:function Release(){_C137.clearArray(this._stack);this._eventSheetManager=null;this._runtime=null;}},{key:"_SetInitialValues",value:function _SetInitialValues(initialValues){this._initialValues=initialValues;var arr=this._initialValues.slice(0);this._stack.push(arr);this._index=0;this._current=arr;}},{key:"GetEventSheetManager",value:function GetEventSheetManager(){return this._eventSheetManager;}},{key:"GetRuntime",value:function GetRuntime(){return this._runtime;}},{key:"GetCurrent",value:function GetCurrent(){return this._current;}},{key:"Push",value:function Push(){var index=++this._index;var stack=this._stack;if(index===stack.length)stack.push(this._initialValues.slice(0));else _C137.shallowAssignArray(stack[index],this._initialValues);this._current=stack[index];}},{key:"Pop",value:function Pop(){this._current=this._stack[--this._index];}}]);return LocalVarStack;}(_C137.DefendedBase);}// events/stacks/loopStack.js
{'use strict';var _C138=self.C3;_C138.LoopStack=/*#__PURE__*/function(_C138$DefendedBase){_inherits(LoopStack,_C138$DefendedBase);function LoopStack(eventSheetManager){var _this74;_classCallCheck(this,LoopStack);_this74=_possibleConstructorReturn(this,_getPrototypeOf(LoopStack).call(this));_this74._eventSheetManager=eventSheetManager;_this74._runtime=_this74._eventSheetManager.GetRuntime();_this74._stack=[];_this74._index=-1;return _this74;}_createClass(LoopStack,[{key:"Release",value:function Release(){_C138.clearArray(this._stack);this._eventSheetManager=null;this._runtime=null;}},{key:"GetEventSheetManager",value:function GetEventSheetManager(){return this._eventSheetManager;}},{key:"GetRuntime",value:function GetRuntime(){return this._runtime;}},{key:"IsInLoop",value:function IsInLoop(){return this._index>=0;}},{key:"GetCurrent",value:function GetCurrent(){return this._stack[this._index];}},{key:"Push",value:function Push(){++this._index;if(this._index===this._stack.length){var ret=_C138.New(_C138.Loop,this);this._stack.push(ret);return ret;}else{var _ret7=this._stack[this._index];_ret7.Reset();return _ret7;}}},{key:"Pop",value:function Pop(){--this._index;}},{key:"FindByName",value:function FindByName(name){var stack=this._stack;for(var i=this._index;i>=0;--i){var loop=stack[i];if(loop.GetName()===name)return loop;}return null;}},{key:"_GetStack",value:function _GetStack(){return this._stack.slice(0,this._index+1);}}]);return LoopStack;}(_C138.DefendedBase);}// events/stacks/loop.js
{'use strict';var _C139=self.C3;_C139.Loop=/*#__PURE__*/function(_C139$DefendedBase){_inherits(Loop,_C139$DefendedBase);function Loop(loopStack){var _this75;_classCallCheck(this,Loop);_this75=_possibleConstructorReturn(this,_getPrototypeOf(Loop).call(this));_this75._loopStack=loopStack;_this75._name="";_this75._index=0;_this75._isStopped=false;_this75._end=NaN;return _this75;}_createClass(Loop,[{key:"Reset",value:function Reset(){this._name="";this._index=0;this._isStopped=false;this._end=NaN;}},{key:"SetName",value:function SetName(name){this._name=name;}},{key:"GetName",value:function GetName(){return this._name;}},{key:"SetIndex",value:function SetIndex(i){this._index=i;}},{key:"GetIndex",value:function GetIndex(){return this._index;}},{key:"Stop",value:function Stop(){this._isStopped=true;}},{key:"IsStopped",value:function IsStopped(){return this._isStopped;}},{key:"SetEnd",value:function SetEnd(e){this._end=e;}},{key:"GetEnd",value:function GetEnd(){return this._end;}}]);return Loop;}(_C139.DefendedBase);}// events/stacks/arrayStack.js
{'use strict';var _C140=self.C3;_C140.ArrayStack=/*#__PURE__*/function(_C140$DefendedBase){_inherits(ArrayStack,_C140$DefendedBase);function ArrayStack(){var _this76;_classCallCheck(this,ArrayStack);_this76=_possibleConstructorReturn(this,_getPrototypeOf(ArrayStack).call(this));_this76._stack=[];_this76._index=-1;return _this76;}_createClass(ArrayStack,[{key:"Release",value:function Release(){_C140.clearArray(this._stack);}},{key:"GetCurrent",value:function GetCurrent(){return this._stack[this._index];}},{key:"Push",value:function Push(){++this._index;if(this._index===this._stack.length){var ret=[];this._stack.push(ret);return ret;}else return this._stack[this._index];}},{key:"Pop",value:function Pop(){--this._index;}}]);return ArrayStack;}(_C140.DefendedBase);}// events/eventSheetManager.js
{var SortSolArray=function SortSolArray(a,b){return a.GetIndex()-b.GetIndex();};var IsSolArrayIdentical=function IsSolArrayIdentical(a,b){for(var i=0,len=a.length;i<len;++i){if(a[i]!==b[i])return false;}return true;};'use strict';var _C141=self.C3;var _assert9=self.assert;_C141.EventSheetManager=/*#__PURE__*/function(_C141$DefendedBase){_inherits(EventSheetManager,_C141$DefendedBase);function EventSheetManager(runtime){var _this77;_classCallCheck(this,EventSheetManager);_this77=_possibleConstructorReturn(this,_getPrototypeOf(EventSheetManager).call(this));_this77._runtime=runtime;_this77._allSheets=[];_this77._sheetsByName=new Map();_this77._allGroups=[];_this77._groupsByName=new Map();_this77._blocksBySid=new Map();_this77._cndsBySid=new Map();_this77._actsBySid=new Map();_this77._allUniqueSolModifiers=new Map();_this77._eventVarsBySid=new Map();_this77._nextLocalVarIndex=0;_this77._allGlobalVars=[];_this77._allLocalVars=[];_this77._localVarInitialValues=[];_this77._functionBlocksByName=new Map();_this77._customActionBlocksMap=new Map();_this77._eventStack=_C141.New(_C141.EventStack,_assertThisInitialized(_this77));_this77._localVarStack=_C141.New(_C141.LocalVarStack,_assertThisInitialized(_this77));_this77._loopStack=_C141.New(_C141.LoopStack,_assertThisInitialized(_this77));_this77._triggersToPostInit=[];_this77._queuedTriggers=[];_this77._queuedDebugTriggers=[];_this77._runningEventsDepth=0;_this77._executingTriggerDepth=0;_this77._blockFlushingDepth=0;_this77._scheduledWaits=[];_this77._asyncActionPromises=[];self["c3_callFunction"]=function(name,params){return _this77._InvokeFunctionFromJS(name,params);};return _this77;}_createClass(EventSheetManager,[{key:"Release",value:function Release(){this.ClearAllScheduledWaits();this._eventStack.Release();this._eventStack=null;this._localVarStack.Release();this._localVarStack=null;_C141.clearArray(this._queuedTriggers);_C141.clearArray(this._queuedDebugTriggers);this._runtime=null;_C141.clearArray(this._allSheets);this._sheetsByName.clear();}},{key:"Create",value:function Create(eventSheetData){var eventSheet=_C141.New(_C141.EventSheet,this,eventSheetData);this._allSheets.push(eventSheet);this._sheetsByName.set(eventSheet.GetName().toLowerCase(),eventSheet);}},{key:"_AddTriggerToPostInit",value:function _AddTriggerToPostInit(trig){this._triggersToPostInit.push(trig);}},{key:"_PostInit",value:function _PostInit(){var _iteratorNormalCompletion330=true;var _didIteratorError330=false;var _iteratorError330=undefined;try{for(var _iterator330=this._customActionBlocksMap.values()[Symbol.iterator](),_step330;!(_iteratorNormalCompletion330=(_step330=_iterator330.next()).done);_iteratorNormalCompletion330=true){var customActionBlock=_step330.value;customActionBlock._CheckOverrideState();}}catch(err){_didIteratorError330=true;_iteratorError330=err;}finally{try{if(!_iteratorNormalCompletion330&&_iterator330["return"]!=null){_iterator330["return"]();}}finally{if(_didIteratorError330){throw _iteratorError330;}}}var _iteratorNormalCompletion331=true;var _didIteratorError331=false;var _iteratorError331=undefined;try{for(var _iterator331=this._functionBlocksByName.values()[Symbol.iterator](),_step331;!(_iteratorNormalCompletion331=(_step331=_iterator331.next()).done);_iteratorNormalCompletion331=true){var functionBlock=_step331.value;functionBlock._PostInit();}}catch(err){_didIteratorError331=true;_iteratorError331=err;}finally{try{if(!_iteratorNormalCompletion331&&_iterator331["return"]!=null){_iterator331["return"]();}}finally{if(_didIteratorError331){throw _iteratorError331;}}}var _iteratorNormalCompletion332=true;var _didIteratorError332=false;var _iteratorError332=undefined;try{for(var _iterator332=this._customActionBlocksMap.values()[Symbol.iterator](),_step332;!(_iteratorNormalCompletion332=(_step332=_iterator332.next()).done);_iteratorNormalCompletion332=true){var _customActionBlock=_step332.value;_customActionBlock._PostInit();}}catch(err){_didIteratorError332=true;_iteratorError332=err;}finally{try{if(!_iteratorNormalCompletion332&&_iterator332["return"]!=null){_iterator332["return"]();}}finally{if(_didIteratorError332){throw _iteratorError332;}}}var _iteratorNormalCompletion333=true;var _didIteratorError333=false;var _iteratorError333=undefined;try{for(var _iterator333=this._allSheets[Symbol.iterator](),_step333;!(_iteratorNormalCompletion333=(_step333=_iterator333.next()).done);_iteratorNormalCompletion333=true){var sheet=_step333.value;sheet._PostInit();}}catch(err){_didIteratorError333=true;_iteratorError333=err;}finally{try{if(!_iteratorNormalCompletion333&&_iterator333["return"]!=null){_iterator333["return"]();}}finally{if(_didIteratorError333){throw _iteratorError333;}}}var _iteratorNormalCompletion334=true;var _didIteratorError334=false;var _iteratorError334=undefined;try{for(var _iterator334=this._allSheets[Symbol.iterator](),_step334;!(_iteratorNormalCompletion334=(_step334=_iterator334.next()).done);_iteratorNormalCompletion334=true){var _sheet=_step334.value;_sheet._UpdateDeepIncludes();}}catch(err){_didIteratorError334=true;_iteratorError334=err;}finally{try{if(!_iteratorNormalCompletion334&&_iterator334["return"]!=null){_iterator334["return"]();}}finally{if(_didIteratorError334){throw _iteratorError334;}}}var _iteratorNormalCompletion335=true;var _didIteratorError335=false;var _iteratorError335=undefined;try{for(var _iterator335=this._triggersToPostInit[Symbol.iterator](),_step335;!(_iteratorNormalCompletion335=(_step335=_iterator335.next()).done);_iteratorNormalCompletion335=true){var trig=_step335.value;trig._PostInit(false);}}catch(err){_didIteratorError335=true;_iteratorError335=err;}finally{try{if(!_iteratorNormalCompletion335&&_iterator335["return"]!=null){_iterator335["return"]();}}finally{if(_didIteratorError335){throw _iteratorError335;}}}_C141.clearArray(this._triggersToPostInit);this._localVarStack._SetInitialValues(this._localVarInitialValues);}},{key:"GetRuntime",value:function GetRuntime(){return this._runtime;}},{key:"GetEventSheetByName",value:function GetEventSheetByName(name){return this._sheetsByName.get(name.toLowerCase())||null;}},{key:"_RegisterGroup",value:function _RegisterGroup(group){this._allGroups.push(group);this._groupsByName.set(group.GetGroupName(),group);}},{key:"_RegisterEventBlock",value:function _RegisterEventBlock(eventBlock){this._blocksBySid.set(eventBlock.GetSID(),eventBlock);}},{key:"_RegisterCondition",value:function _RegisterCondition(condition){this._cndsBySid.set(condition.GetSID(),condition);}},{key:"_RegisterAction",value:function _RegisterAction(action){this._actsBySid.set(action.GetSID(),action);}},{key:"_RegisterFunctionBlock",value:function _RegisterFunctionBlock(functionBlock){switch(functionBlock.GetFunctionType()){case 0:this._functionBlocksByName.set(functionBlock.GetFunctionName().toLowerCase(),functionBlock);break;case 1:this._customActionBlocksMap.set(functionBlock.GetFunctionName().toLowerCase(),functionBlock);break;default:}}},{key:"_RegisterEventVariable",value:function _RegisterEventVariable(ev){this._eventVarsBySid.set(ev.GetSID(),ev);if(ev.IsGlobal())this._allGlobalVars.push(ev);else this._allLocalVars.push(ev);}},{key:"_DeduplicateSolModifierList",value:function _DeduplicateSolModifierList(arr){if(arr.length>=2)arr.sort(SortSolArray);var candidateList=this._allUniqueSolModifiers.get(arr.length);if(!candidateList){candidateList=[];this._allUniqueSolModifiers.set(arr.length,candidateList);}for(var i=0,len=candidateList.length;i<len;++i){var candidate=candidateList[i];if(IsSolArrayIdentical(arr,candidate))return candidate;}candidateList.push(arr);return arr;}},{key:"_GetNextLocalVarIndex",value:function _GetNextLocalVarIndex(eventVar){this._localVarInitialValues.push(eventVar.GetInitialValue());return this._nextLocalVarIndex++;}},{key:"GetEventStack",value:function GetEventStack(){return this._eventStack;}},{key:"GetCurrentEventStackFrame",value:function GetCurrentEventStackFrame(){return this.GetEventStack().GetCurrentStackFrame();}},{key:"GetCurrentEvent",value:function GetCurrentEvent(){return this.GetCurrentEventStackFrame().GetCurrentEvent();}},{key:"GetCurrentCondition",value:function GetCurrentCondition(){var frame=this.GetCurrentEventStackFrame();var event=frame.GetCurrentEvent();return event.GetConditionAt(frame.GetConditionIndex());}},{key:"GetCurrentAction",value:function GetCurrentAction(){var frame=this.GetCurrentEventStackFrame();var event=frame.GetCurrentEvent();return event.GetActionAt(frame.GetActionIndex());}},{key:"GetLocalVarStack",value:function GetLocalVarStack(){return this._localVarStack;}},{key:"GetLoopStack",value:function GetLoopStack(){return this._loopStack;}},{key:"GetAllLocalVariablesInScope",value:function GetAllLocalVariablesInScope(fromRow){var ret=[];fromRow=fromRow.GetScopeParent();while(fromRow){_C141.appendArray(ret,fromRow._GetAllLocalVariablesInScope());fromRow=fromRow.GetScopeParent();}return ret;}},{key:"_GetLocalVariablesScriptInterface",value:function _GetLocalVariablesScriptInterface(fromRow){var localVarDescriptors={};var _iteratorNormalCompletion336=true;var _didIteratorError336=false;var _iteratorError336=undefined;try{for(var _iterator336=this.GetAllLocalVariablesInScope(fromRow)[Symbol.iterator](),_step336;!(_iteratorNormalCompletion336=(_step336=_iterator336.next()).done);_iteratorNormalCompletion336=true){var v=_step336.value;localVarDescriptors[v.GetJsPropName()]=v._GetScriptInterfaceDescriptor();}}catch(err){_didIteratorError336=true;_iteratorError336=err;}finally{try{if(!_iteratorNormalCompletion336&&_iterator336["return"]!=null){_iterator336["return"]();}}finally{if(_didIteratorError336){throw _iteratorError336;}}}return Object.create(Object.prototype,localVarDescriptors);}},{key:"GetEventVariableBySID",value:function GetEventVariableBySID(sid){return this._eventVarsBySid.get(sid)||null;}},{key:"GetEventBlockBySID",value:function GetEventBlockBySID(sid){return this._blocksBySid.get(sid)||null;}},{key:"GetConditionBySID",value:function GetConditionBySID(sid){return this._cndsBySid.get(sid)||null;}},{key:"GetActionBySID",value:function GetActionBySID(sid){return this._actsBySid.get(sid)||null;}},{key:"GetFunctionBlockByName",value:function GetFunctionBlockByName(name){return this._functionBlocksByName.get(name.toLowerCase())||null;}},{key:"GetCustomActionBlockByName",value:function GetCustomActionBlockByName(objectClass,name){var ret=this._customActionBlocksMap.get((objectClass.GetName()+"."+name).toLowerCase());if(ret)return ret;if(!objectClass.IsFamily()){var _iteratorNormalCompletion337=true;var _didIteratorError337=false;var _iteratorError337=undefined;try{for(var _iterator337=objectClass.GetFamilies()[Symbol.iterator](),_step337;!(_iteratorNormalCompletion337=(_step337=_iterator337.next()).done);_iteratorNormalCompletion337=true){var family=_step337.value;ret=this._customActionBlocksMap.get((family.GetName()+"."+name).toLowerCase());if(ret)return ret;}}catch(err){_didIteratorError337=true;_iteratorError337=err;}finally{try{if(!_iteratorNormalCompletion337&&_iterator337["return"]!=null){_iterator337["return"]();}}finally{if(_didIteratorError337){throw _iteratorError337;}}}}return null;}},{key:"GetAllGlobalVariables",value:function GetAllGlobalVariables(){return this._allGlobalVars;}},{key:"GetAllLocalVariables",value:function GetAllLocalVariables(){return this._allLocalVars;}},{key:"ResetAllGlobalsToInitialValue",value:function ResetAllGlobalsToInitialValue(){var _iteratorNormalCompletion338=true;var _didIteratorError338=false;var _iteratorError338=undefined;try{for(var _iterator338=this._allGlobalVars[Symbol.iterator](),_step338;!(_iteratorNormalCompletion338=(_step338=_iterator338.next()).done);_iteratorNormalCompletion338=true){var ev=_step338.value;ev.ResetToInitialValue();}}catch(err){_didIteratorError338=true;_iteratorError338=err;}finally{try{if(!_iteratorNormalCompletion338&&_iterator338["return"]!=null){_iterator338["return"]();}}finally{if(_didIteratorError338){throw _iteratorError338;}}}}},{key:"GetEventGroupByName",value:function GetEventGroupByName(name){return this._groupsByName.get(name.toLowerCase())||null;}},{key:"GetEventGroupBySID",value:function GetEventGroupBySID(sid){var group=this._blocksBySid.get(sid);if(group&&group.IsGroup())return group;else return null;}},{key:"GetAllGroups",value:function GetAllGroups(){return this._allGroups;}},{key:"ResetAllGroupsInitialActivation",value:function ResetAllGroupsInitialActivation(){var _iteratorNormalCompletion339=true;var _didIteratorError339=false;var _iteratorError339=undefined;try{for(var _iterator339=this._allGroups[Symbol.iterator](),_step339;!(_iteratorNormalCompletion339=(_step339=_iterator339.next()).done);_iteratorNormalCompletion339=true){var group=_step339.value;group.ResetInitialActivation();}}catch(err){_didIteratorError339=true;_iteratorError339=err;}finally{try{if(!_iteratorNormalCompletion339&&_iterator339["return"]!=null){_iterator339["return"]();}}finally{if(_didIteratorError339){throw _iteratorError339;}}}}},{key:"_ResetAllHasRunFlags",value:function _ResetAllHasRunFlags(){var _iteratorNormalCompletion340=true;var _didIteratorError340=false;var _iteratorError340=undefined;try{for(var _iterator340=this._allSheets[Symbol.iterator](),_step340;!(_iteratorNormalCompletion340=(_step340=_iterator340.next()).done);_iteratorNormalCompletion340=true){var sheet=_step340.value;sheet._ResetHasRunFlag();}}catch(err){_didIteratorError340=true;_iteratorError340=err;}finally{try{if(!_iteratorNormalCompletion340&&_iterator340["return"]!=null){_iterator340["return"]();}}finally{if(_didIteratorError340){throw _iteratorError340;}}}}},{key:"RunEvents",value:function RunEvents(layoutManager){this._ResetAllHasRunFlags();this._runningEventsDepth++;var _iteratorNormalCompletion341=true;var _didIteratorError341=false;var _iteratorError341=undefined;try{for(var _iterator341=layoutManager.runningLayouts()[Symbol.iterator](),_step341;!(_iteratorNormalCompletion341=(_step341=_iterator341.next()).done);_iteratorNormalCompletion341=true){var layout=_step341.value;var eventSheet=layout.GetEventSheet();if(!eventSheet)continue;this._runtime.PushCurrentLayout(layout);eventSheet.Run();this._runtime.PopCurrentLayout();}}catch(err){_didIteratorError341=true;_iteratorError341=err;}finally{try{if(!_iteratorNormalCompletion341&&_iterator341["return"]!=null){_iterator341["return"]();}}finally{if(_didIteratorError341){throw _iteratorError341;}}}this._runningEventsDepth--;}},{key:"DebugRunEvents",value:function DebugRunEvents(layoutManager){var _iteratorNormalCompletion342,_didIteratorError342,_iteratorError342,_iterator342,_step342,breakEventObject;return regeneratorRuntime.async(function DebugRunEvents$(_context101){while(1){switch(_context101.prev=_context101.next){case 0:this._ResetAllHasRunFlags();this._runningEventsDepth++;_iteratorNormalCompletion342=true;_didIteratorError342=false;_iteratorError342=undefined;_context101.prev=5;_iterator342=this._DebugRunEventsGen(layoutManager)[Symbol.iterator]();case 7:if(_iteratorNormalCompletion342=(_step342=_iterator342.next()).done){_context101.next=14;break;}breakEventObject=_step342.value;_context101.next=11;return regeneratorRuntime.awrap(this._runtime.DebugBreak(breakEventObject));case 11:_iteratorNormalCompletion342=true;_context101.next=7;break;case 14:_context101.next=20;break;case 16:_context101.prev=16;_context101.t0=_context101["catch"](5);_didIteratorError342=true;_iteratorError342=_context101.t0;case 20:_context101.prev=20;_context101.prev=21;if(!_iteratorNormalCompletion342&&_iterator342["return"]!=null){_iterator342["return"]();}case 23:_context101.prev=23;if(!_didIteratorError342){_context101.next=26;break;}throw _iteratorError342;case 26:return _context101.finish(23);case 27:return _context101.finish(20);case 28:this._runningEventsDepth--;case 29:case"end":return _context101.stop();}}},null,this,[[5,16,20,28],[21,,23,27]]);}},{key:"_DebugRunEventsGen",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugRunEventsGen(layoutManager){var _iteratorNormalCompletion343,_didIteratorError343,_iteratorError343,_iterator343,_step343,layout,eventSheet;return regeneratorRuntime.wrap(function _DebugRunEventsGen$(_context102){while(1){switch(_context102.prev=_context102.next){case 0:_iteratorNormalCompletion343=true;_didIteratorError343=false;_iteratorError343=undefined;_context102.prev=3;_iterator343=layoutManager.runningLayouts()[Symbol.iterator]();case 5:if(_iteratorNormalCompletion343=(_step343=_iterator343.next()).done){_context102.next=16;break;}layout=_step343.value;eventSheet=layout.GetEventSheet();if(eventSheet){_context102.next=10;break;}return _context102.abrupt("continue",13);case 10:this._runtime.PushCurrentLayout(layout);return _context102.delegateYield(eventSheet.DebugRun(),"t0",12);case 12:this._runtime.PopCurrentLayout();case 13:_iteratorNormalCompletion343=true;_context102.next=5;break;case 16:_context102.next=22;break;case 18:_context102.prev=18;_context102.t1=_context102["catch"](3);_didIteratorError343=true;_iteratorError343=_context102.t1;case 22:_context102.prev=22;_context102.prev=23;if(!_iteratorNormalCompletion343&&_iterator343["return"]!=null){_iterator343["return"]();}case 25:_context102.prev=25;if(!_didIteratorError343){_context102.next=28;break;}throw _iteratorError343;case 28:return _context102.finish(25);case 29:return _context102.finish(22);case 30:case"end":return _context102.stop();}}},_DebugRunEventsGen,this,[[3,18,22,30],[23,,25,29]]);})},{key:"_Trigger",value:function _Trigger(layoutManager,method,inst,behaviorType){var ret=false;if(!layoutManager.GetMainRunningLayout())return this.QueueTrigger(method,inst,behaviorType);this._executingTriggerDepth++;var _iteratorNormalCompletion344=true;var _didIteratorError344=false;var _iteratorError344=undefined;try{for(var _iterator344=layoutManager.runningLayouts()[Symbol.iterator](),_step344;!(_iteratorNormalCompletion344=(_step344=_iterator344.next()).done);_iteratorNormalCompletion344=true){var layout=_step344.value;var eventSheet=layout.GetEventSheet();if(!eventSheet)continue;this._runtime.PushCurrentLayout(layout);var _iteratorNormalCompletion345=true;var _didIteratorError345=false;var _iteratorError345=undefined;try{for(var _iterator345=eventSheet.deepIncludes()[Symbol.iterator](),_step345;!(_iteratorNormalCompletion345=(_step345=_iterator345.next()).done);_iteratorNormalCompletion345=true){var includeSheet=_step345.value;var result=includeSheet._Trigger(method,inst,behaviorType);ret=ret||result;}}catch(err){_didIteratorError345=true;_iteratorError345=err;}finally{try{if(!_iteratorNormalCompletion345&&_iterator345["return"]!=null){_iterator345["return"]();}}finally{if(_didIteratorError345){throw _iteratorError345;}}}var result2=eventSheet._Trigger(method,inst,behaviorType);ret=ret||result2;this._runtime.PopCurrentLayout();}}catch(err){_didIteratorError344=true;_iteratorError344=err;}finally{try{if(!_iteratorNormalCompletion344&&_iterator344["return"]!=null){_iterator344["return"]();}}finally{if(_didIteratorError344){throw _iteratorError344;}}}this._executingTriggerDepth--;return ret;}},{key:"_DebugTrigger",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugTrigger(layoutManager,method,inst,behaviorType){var ret,_iteratorNormalCompletion346,_didIteratorError346,_iteratorError346,_iterator346,_step346,layout,eventSheet,_iteratorNormalCompletion347,_didIteratorError347,_iteratorError347,_iterator347,_step347,includeSheet,result,result2;return regeneratorRuntime.wrap(function _DebugTrigger$(_context103){while(1){switch(_context103.prev=_context103.next){case 0:ret=false;if(layoutManager.GetMainRunningLayout()){_context103.next=3;break;}return _context103.abrupt("return",this.QueueTrigger(method,inst,behaviorType));case 3:this._executingTriggerDepth++;_iteratorNormalCompletion346=true;_didIteratorError346=false;_iteratorError346=undefined;_context103.prev=7;_iterator346=layoutManager.runningLayouts()[Symbol.iterator]();case 9:if(_iteratorNormalCompletion346=(_step346=_iterator346.next()).done){_context103.next=49;break;}layout=_step346.value;eventSheet=layout.GetEventSheet();if(eventSheet){_context103.next=14;break;}return _context103.abrupt("continue",46);case 14:this._runtime.PushCurrentLayout(layout);_iteratorNormalCompletion347=true;_didIteratorError347=false;_iteratorError347=undefined;_context103.prev=18;_iterator347=eventSheet.deepIncludes()[Symbol.iterator]();case 20:if(_iteratorNormalCompletion347=(_step347=_iterator347.next()).done){_context103.next=28;break;}includeSheet=_step347.value;return _context103.delegateYield(includeSheet._DebugTrigger(method,inst,behaviorType),"t0",23);case 23:result=_context103.t0;ret=ret||result;case 25:_iteratorNormalCompletion347=true;_context103.next=20;break;case 28:_context103.next=34;break;case 30:_context103.prev=30;_context103.t1=_context103["catch"](18);_didIteratorError347=true;_iteratorError347=_context103.t1;case 34:_context103.prev=34;_context103.prev=35;if(!_iteratorNormalCompletion347&&_iterator347["return"]!=null){_iterator347["return"]();}case 37:_context103.prev=37;if(!_didIteratorError347){_context103.next=40;break;}throw _iteratorError347;case 40:return _context103.finish(37);case 41:return _context103.finish(34);case 42:return _context103.delegateYield(eventSheet._DebugTrigger(method,inst,behaviorType),"t2",43);case 43:result2=_context103.t2;ret=ret||result2;this._runtime.PopCurrentLayout();case 46:_iteratorNormalCompletion346=true;_context103.next=9;break;case 49:_context103.next=55;break;case 51:_context103.prev=51;_context103.t3=_context103["catch"](7);_didIteratorError346=true;_iteratorError346=_context103.t3;case 55:_context103.prev=55;_context103.prev=56;if(!_iteratorNormalCompletion346&&_iterator346["return"]!=null){_iterator346["return"]();}case 58:_context103.prev=58;if(!_didIteratorError346){_context103.next=61;break;}throw _iteratorError346;case 61:return _context103.finish(58);case 62:return _context103.finish(55);case 63:this._executingTriggerDepth--;return _context103.abrupt("return",ret);case 65:case"end":return _context103.stop();}}},_DebugTrigger,this,[[7,51,55,63],[18,30,34,42],[35,,37,41],[56,,58,62]]);})},{key:"QueueTrigger",value:function QueueTrigger(method,inst,behaviorType){this._queuedTriggers.push([method,inst,behaviorType]);return false;}},{key:"QueueDebugTrigger",value:function QueueDebugTrigger(method,inst,behaviorType){var resolve=null;var ret=new Promise(function(r){return resolve=r;});this._queuedDebugTriggers.push([method,inst,behaviorType,resolve]);return ret;}},{key:"_RunQueuedDebugTriggersGen",value:/*#__PURE__*/regeneratorRuntime.mark(function _RunQueuedDebugTriggersGen(){var layoutManager,_this$_queuedDebugTri,_this$_queuedDebugTri2,method,inst,behaviorType,resolve,ret;return regeneratorRuntime.wrap(function _RunQueuedDebugTriggersGen$(_context104){while(1){switch(_context104.prev=_context104.next){case 0:if(!this._runtime.HitBreakpoint()){_context104.next=2;break;}throw new Error("should not be in breakpoint");case 2:layoutManager=this._runtime.GetLayoutManager();case 3:if(!this._queuedDebugTriggers.length){_context104.next=10;break;}_this$_queuedDebugTri=this._queuedDebugTriggers.shift(),_this$_queuedDebugTri2=_slicedToArray(_this$_queuedDebugTri,4),method=_this$_queuedDebugTri2[0],inst=_this$_queuedDebugTri2[1],behaviorType=_this$_queuedDebugTri2[2],resolve=_this$_queuedDebugTri2[3];return _context104.delegateYield(this._DebugTrigger(layoutManager,method,inst,behaviorType),"t0",6);case 6:ret=_context104.t0;resolve(ret);_context104.next=3;break;case 10:case"end":return _context104.stop();}}},_RunQueuedDebugTriggersGen,this);})},{key:"RunQueuedDebugTriggersAsync",value:function RunQueuedDebugTriggersAsync(){var _iteratorNormalCompletion348,_didIteratorError348,_iteratorError348,_iterator348,_step348,breakEventObject;return regeneratorRuntime.async(function RunQueuedDebugTriggersAsync$(_context105){while(1){switch(_context105.prev=_context105.next){case 0:_iteratorNormalCompletion348=true;_didIteratorError348=false;_iteratorError348=undefined;_context105.prev=3;_iterator348=this._RunQueuedDebugTriggersGen()[Symbol.iterator]();case 5:if(_iteratorNormalCompletion348=(_step348=_iterator348.next()).done){_context105.next=12;break;}breakEventObject=_step348.value;_context105.next=9;return regeneratorRuntime.awrap(this._runtime.DebugBreak(breakEventObject));case 9:_iteratorNormalCompletion348=true;_context105.next=5;break;case 12:_context105.next=18;break;case 14:_context105.prev=14;_context105.t0=_context105["catch"](3);_didIteratorError348=true;_iteratorError348=_context105.t0;case 18:_context105.prev=18;_context105.prev=19;if(!_iteratorNormalCompletion348&&_iterator348["return"]!=null){_iterator348["return"]();}case 21:_context105.prev=21;if(!_didIteratorError348){_context105.next=24;break;}throw _iteratorError348;case 24:return _context105.finish(21);case 25:return _context105.finish(18);case 26:case"end":return _context105.stop();}}},null,this,[[3,14,18,26],[19,,21,25]]);}},{key:"_FastTrigger",value:function _FastTrigger(layoutManager,method,inst,value){var ret=false;var layout=layoutManager.GetMainRunningLayout();var eventSheet=layout.GetEventSheet();if(!eventSheet)return;this._executingTriggerDepth++;this._runtime.PushCurrentLayout(layout);var deepIncludes=eventSheet.deepIncludes();for(var i=0,len=deepIncludes.length;i<len;++i){var result=deepIncludes[i]._FastTrigger(method,inst,value);ret=ret||result;}var result2=eventSheet._FastTrigger(method,inst,value);ret=ret||result2;this._runtime.PopCurrentLayout();this._executingTriggerDepth--;return ret;}},{key:"_DebugFastTrigger",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugFastTrigger(layoutManager,method,inst,value){var ret,layout,eventSheet,deepIncludes,i,len,result,result2;return regeneratorRuntime.wrap(function _DebugFastTrigger$(_context106){while(1){switch(_context106.prev=_context106.next){case 0:ret=false;layout=layoutManager.GetMainRunningLayout();eventSheet=layout.GetEventSheet();if(eventSheet){_context106.next=5;break;}return _context106.abrupt("return");case 5:this._executingTriggerDepth++;this._runtime.PushCurrentLayout(layout);deepIncludes=eventSheet.deepIncludes();i=0,len=deepIncludes.length;case 9:if(!(i<len)){_context106.next=16;break;}return _context106.delegateYield(deepIncludes[i]._DebugFastTrigger(method,inst,value),"t0",11);case 11:result=_context106.t0;ret=ret||result;case 13:++i;_context106.next=9;break;case 16:return _context106.delegateYield(eventSheet._DebugFastTrigger(method,inst,value),"t1",17);case 17:result2=_context106.t1;ret=ret||result2;this._runtime.PopCurrentLayout();this._executingTriggerDepth--;return _context106.abrupt("return",ret);case 22:case"end":return _context106.stop();}}},_DebugFastTrigger,this);})},{key:"GetTriggerDepth",value:function GetTriggerDepth(){return this._executingTriggerDepth;}},{key:"IsInTrigger",value:function IsInTrigger(){return this.GetTriggerDepth()>0;}},{key:"_IncTriggerDepth",value:function _IncTriggerDepth(){return++this._executingTriggerDepth;}},{key:"_DecTriggerDepth",value:function _DecTriggerDepth(){--this._executingTriggerDepth;}},{key:"IsRunningEvents",value:function IsRunningEvents(){return this._runningEventsDepth>0;}},{key:"IsInEventEngine",value:function IsInEventEngine(){return this.IsRunningEvents()||this.IsInTrigger();}},{key:"_RunQueuedTriggers",value:function _RunQueuedTriggers(layoutManager){var _iteratorNormalCompletion349=true;var _didIteratorError349=false;var _iteratorError349=undefined;try{for(var _iterator349=this._queuedTriggers[Symbol.iterator](),_step349;!(_iteratorNormalCompletion349=(_step349=_iterator349.next()).done);_iteratorNormalCompletion349=true){var _step349$value=_slicedToArray(_step349.value,3),method=_step349$value[0],inst=_step349$value[1],behaviorType=_step349$value[2];this._Trigger(layoutManager,method,inst,behaviorType);}}catch(err){_didIteratorError349=true;_iteratorError349=err;}finally{try{if(!_iteratorNormalCompletion349&&_iterator349["return"]!=null){_iterator349["return"]();}}finally{if(_didIteratorError349){throw _iteratorError349;}}}_C141.clearArray(this._queuedTriggers);}},{key:"BlockFlushingInstances",value:function BlockFlushingInstances(e){if(e)this._blockFlushingDepth++;else this._blockFlushingDepth--;}},{key:"IsFlushingBlocked",value:function IsFlushingBlocked(){return this._blockFlushingDepth>0;}},{key:"ClearSol",value:function ClearSol(solModifiers){for(var i=0,len=solModifiers.length;i<len;++i){solModifiers[i].GetSolStack().Clear();}}},{key:"PushCleanSol",value:function PushCleanSol(solModifiers){for(var i=0,len=solModifiers.length;i<len;++i){solModifiers[i].GetSolStack().PushClean();}}},{key:"PushCopySol",value:function PushCopySol(solModifiers){for(var i=0,len=solModifiers.length;i<len;++i){solModifiers[i].GetSolStack().PushCopy();}}},{key:"PopSol",value:function PopSol(solModifiers){for(var i=0,len=solModifiers.length;i<len;++i){solModifiers[i].GetSolStack().Pop();}}},{key:"GetDynamicSolModifiersSet",value:function GetDynamicSolModifiersSet(skipSet){var ret=new Set();var allStackFrames=this._eventStack.GetAllStackFrames();var stackIndex=this._eventStack.GetCurrentStackFrameIndex();for(var i=0;i<=stackIndex;++i){var dynamicSolModifiers=allStackFrames[i].GetDynamicSolModifiers();if(dynamicSolModifiers){var _iteratorNormalCompletion350=true;var _didIteratorError350=false;var _iteratorError350=undefined;try{for(var _iterator350=dynamicSolModifiers[Symbol.iterator](),_step350;!(_iteratorNormalCompletion350=(_step350=_iterator350.next()).done);_iteratorNormalCompletion350=true){var t=_step350.value;if(!skipSet||!skipSet.has(t))ret.add(t);}}catch(err){_didIteratorError350=true;_iteratorError350=err;}finally{try{if(!_iteratorNormalCompletion350&&_iterator350["return"]!=null){_iterator350["return"]();}}finally{if(_didIteratorError350){throw _iteratorError350;}}}}}return ret;}},{key:"PushCleanSolDynamic",value:function PushCleanSolDynamic(existingSolModifiers){var existingSet=new Set(_toConsumableArray(existingSolModifiers));var pushSet=this.GetDynamicSolModifiersSet(existingSet);if(pushSet.size>0){var _iteratorNormalCompletion351=true;var _didIteratorError351=false;var _iteratorError351=undefined;try{for(var _iterator351=pushSet[Symbol.iterator](),_step351;!(_iteratorNormalCompletion351=(_step351=_iterator351.next()).done);_iteratorNormalCompletion351=true){var t=_step351.value;t.GetSolStack().PushClean();}}catch(err){_didIteratorError351=true;_iteratorError351=err;}finally{try{if(!_iteratorNormalCompletion351&&_iterator351["return"]!=null){_iterator351["return"]();}}finally{if(_didIteratorError351){throw _iteratorError351;}}}return _toConsumableArray(pushSet);}else return null;}},{key:"AddScheduledWait",value:function AddScheduledWait(){var w=_C141.New(_C141.ScheduledWait,this);this._scheduledWaits.push(w);return w;}},{key:"scheduledWaits",value:function scheduledWaits(){return this._scheduledWaits;}},{key:"RunScheduledWaits",value:function RunScheduledWaits(){if(!this._scheduledWaits.length)return;var frame=this.GetCurrentEventStackFrame();var didAnyRun=false;this._runningEventsDepth++;for(var i=0,len=this._scheduledWaits.length;i<len;++i){var w=this._scheduledWaits[i];if(w._ShouldRun())w._Run(frame);if(w.ShouldRelease())didAnyRun=true;}if(didAnyRun){this._FilterScheduledWaitsToRelease();frame.Reset(null);}this._runningEventsDepth--;}},{key:"DebugRunScheduledWaits",value:function DebugRunScheduledWaits(){var frame,didAnyRun,i,len,w;return regeneratorRuntime.async(function DebugRunScheduledWaits$(_context107){while(1){switch(_context107.prev=_context107.next){case 0:if(this._scheduledWaits.length){_context107.next=2;break;}return _context107.abrupt("return");case 2:frame=this.GetCurrentEventStackFrame();didAnyRun=false;this._runningEventsDepth++;i=0,len=this._scheduledWaits.length;case 6:if(!(i<len)){_context107.next=15;break;}w=this._scheduledWaits[i];if(!w._ShouldRun()){_context107.next=11;break;}_context107.next=11;return regeneratorRuntime.awrap(w._DebugRun(frame));case 11:if(w.ShouldRelease())didAnyRun=true;case 12:++i;_context107.next=6;break;case 15:if(didAnyRun){this._FilterScheduledWaitsToRelease();frame.Reset(null);}this._runningEventsDepth--;case 17:case"end":return _context107.stop();}}},null,this);}},{key:"_FilterScheduledWaitsToRelease",value:function _FilterScheduledWaitsToRelease(){var toRelease=_C141.arrayFilterOut(this._scheduledWaits,function(w){return w.ShouldRelease();});var _iteratorNormalCompletion352=true;var _didIteratorError352=false;var _iteratorError352=undefined;try{for(var _iterator352=toRelease[Symbol.iterator](),_step352;!(_iteratorNormalCompletion352=(_step352=_iterator352.next()).done);_iteratorNormalCompletion352=true){var w=_step352.value;w.Release();}}catch(err){_didIteratorError352=true;_iteratorError352=err;}finally{try{if(!_iteratorNormalCompletion352&&_iterator352["return"]!=null){_iterator352["return"]();}}finally{if(_didIteratorError352){throw _iteratorError352;}}}}},{key:"ClearAllScheduledWaits",value:function ClearAllScheduledWaits(){var _iteratorNormalCompletion353=true;var _didIteratorError353=false;var _iteratorError353=undefined;try{for(var _iterator353=this._scheduledWaits[Symbol.iterator](),_step353;!(_iteratorNormalCompletion353=(_step353=_iterator353.next()).done);_iteratorNormalCompletion353=true){var w=_step353.value;w.Release();}}catch(err){_didIteratorError353=true;_iteratorError353=err;}finally{try{if(!_iteratorNormalCompletion353&&_iterator353["return"]!=null){_iterator353["return"]();}}finally{if(_didIteratorError353){throw _iteratorError353;}}}_C141.clearArray(this._scheduledWaits);}},{key:"RemoveInstancesFromScheduledWaits",value:function RemoveInstancesFromScheduledWaits(s){var _iteratorNormalCompletion354=true;var _didIteratorError354=false;var _iteratorError354=undefined;try{for(var _iterator354=this._scheduledWaits[Symbol.iterator](),_step354;!(_iteratorNormalCompletion354=(_step354=_iterator354.next()).done);_iteratorNormalCompletion354=true){var w=_step354.value;w.RemoveInstances(s);}}catch(err){_didIteratorError354=true;_iteratorError354=err;}finally{try{if(!_iteratorNormalCompletion354&&_iterator354["return"]!=null){_iterator354["return"]();}}finally{if(_didIteratorError354){throw _iteratorError354;}}}}},{key:"AddAsyncActionPromise",value:function AddAsyncActionPromise(p){this._asyncActionPromises.push(p);}},{key:"ClearAsyncActionPromises",value:function ClearAsyncActionPromises(){_C141.clearArray(this._asyncActionPromises);}},{key:"GetPromiseForAllAsyncActions",value:function GetPromiseForAllAsyncActions(){var ret=Promise.all(this._asyncActionPromises);this._asyncActionPromises=[];return ret;}},{key:"_SaveToJson",value:function _SaveToJson(){return{"groups":this._SaveGroupsToJson(),"cnds":this._SaveCndsToJson(),"acts":this._SaveActsToJson(),"vars":this._SaveVarsToJson(),"waits":this._SaveScheduledWaitsToJson()};}},{key:"_LoadFromJson",value:function _LoadFromJson(o){this._LoadGroupsFromJson(o["groups"]);this._LoadCndsFromJson(o["cnds"]);this._LoadActsFromJson(o["acts"]);this._LoadVarsFromJson(o["vars"]);this._LoadScheduledWaitsFromJson(o["waits"]);}},{key:"_SaveGroupsToJson",value:function _SaveGroupsToJson(){var o={};var _iteratorNormalCompletion355=true;var _didIteratorError355=false;var _iteratorError355=undefined;try{for(var _iterator355=this.GetAllGroups()[Symbol.iterator](),_step355;!(_iteratorNormalCompletion355=(_step355=_iterator355.next()).done);_iteratorNormalCompletion355=true){var group=_step355.value;o[group.GetSID().toString()]=group.IsGroupActive();}}catch(err){_didIteratorError355=true;_iteratorError355=err;}finally{try{if(!_iteratorNormalCompletion355&&_iterator355["return"]!=null){_iterator355["return"]();}}finally{if(_didIteratorError355){throw _iteratorError355;}}}return o;}},{key:"_LoadGroupsFromJson",value:function _LoadGroupsFromJson(o){for(var _i44=0,_Object$entries10=Object.entries(o);_i44<_Object$entries10.length;_i44++){var _Object$entries10$_i=_slicedToArray(_Object$entries10[_i44],2),sidStr=_Object$entries10$_i[0],data=_Object$entries10$_i[1];var sid=parseInt(sidStr,10);var group=this.GetEventGroupBySID(sid);if(group)group.SetGroupActive(data);}}},{key:"_SaveCndsToJson",value:function _SaveCndsToJson(){var o={};var _iteratorNormalCompletion356=true;var _didIteratorError356=false;var _iteratorError356=undefined;try{for(var _iterator356=this._cndsBySid[Symbol.iterator](),_step356;!(_iteratorNormalCompletion356=(_step356=_iterator356.next()).done);_iteratorNormalCompletion356=true){var _step356$value=_slicedToArray(_step356.value,2),sid=_step356$value[0],cnd=_step356$value[1];var data=cnd._SaveToJson();if(data)o[sid.toString()]=data;}}catch(err){_didIteratorError356=true;_iteratorError356=err;}finally{try{if(!_iteratorNormalCompletion356&&_iterator356["return"]!=null){_iterator356["return"]();}}finally{if(_didIteratorError356){throw _iteratorError356;}}}return o;}},{key:"_LoadCndsFromJson",value:function _LoadCndsFromJson(o){var map=new Map();for(var _i45=0,_Object$entries11=Object.entries(o);_i45<_Object$entries11.length;_i45++){var _Object$entries11$_i=_slicedToArray(_Object$entries11[_i45],2),sidStr=_Object$entries11$_i[0],data=_Object$entries11$_i[1];map.set(parseInt(sidStr,10),data);}var _iteratorNormalCompletion357=true;var _didIteratorError357=false;var _iteratorError357=undefined;try{for(var _iterator357=this._cndsBySid[Symbol.iterator](),_step357;!(_iteratorNormalCompletion357=(_step357=_iterator357.next()).done);_iteratorNormalCompletion357=true){var _step357$value=_slicedToArray(_step357.value,2),sid=_step357$value[0],cnd=_step357$value[1];cnd._LoadFromJson(map.get(sid)||null);}}catch(err){_didIteratorError357=true;_iteratorError357=err;}finally{try{if(!_iteratorNormalCompletion357&&_iterator357["return"]!=null){_iterator357["return"]();}}finally{if(_didIteratorError357){throw _iteratorError357;}}}}},{key:"_SaveActsToJson",value:function _SaveActsToJson(){var o={};var _iteratorNormalCompletion358=true;var _didIteratorError358=false;var _iteratorError358=undefined;try{for(var _iterator358=this._actsBySid[Symbol.iterator](),_step358;!(_iteratorNormalCompletion358=(_step358=_iterator358.next()).done);_iteratorNormalCompletion358=true){var _step358$value=_slicedToArray(_step358.value,2),sid=_step358$value[0],act=_step358$value[1];var data=act._SaveToJson();if(data)o[sid.toString()]=data;}}catch(err){_didIteratorError358=true;_iteratorError358=err;}finally{try{if(!_iteratorNormalCompletion358&&_iterator358["return"]!=null){_iterator358["return"]();}}finally{if(_didIteratorError358){throw _iteratorError358;}}}return o;}},{key:"_LoadActsFromJson",value:function _LoadActsFromJson(o){var map=new Map();for(var _i46=0,_Object$entries12=Object.entries(o);_i46<_Object$entries12.length;_i46++){var _Object$entries12$_i=_slicedToArray(_Object$entries12[_i46],2),sidStr=_Object$entries12$_i[0],data=_Object$entries12$_i[1];map.set(parseInt(sidStr,10),data);}var _iteratorNormalCompletion359=true;var _didIteratorError359=false;var _iteratorError359=undefined;try{for(var _iterator359=this._actsBySid[Symbol.iterator](),_step359;!(_iteratorNormalCompletion359=(_step359=_iterator359.next()).done);_iteratorNormalCompletion359=true){var _step359$value=_slicedToArray(_step359.value,2),sid=_step359$value[0],act=_step359$value[1];act._LoadFromJson(map.get(sid)||null);}}catch(err){_didIteratorError359=true;_iteratorError359=err;}finally{try{if(!_iteratorNormalCompletion359&&_iterator359["return"]!=null){_iterator359["return"]();}}finally{if(_didIteratorError359){throw _iteratorError359;}}}}},{key:"_SaveVarsToJson",value:function _SaveVarsToJson(){var o={};var _iteratorNormalCompletion360=true;var _didIteratorError360=false;var _iteratorError360=undefined;try{for(var _iterator360=this._eventVarsBySid[Symbol.iterator](),_step360;!(_iteratorNormalCompletion360=(_step360=_iterator360.next()).done);_iteratorNormalCompletion360=true){var _step360$value=_slicedToArray(_step360.value,2),sid=_step360$value[0],eventVar=_step360$value[1];if(!eventVar.IsConstant()&&(eventVar.IsGlobal()||eventVar.IsStatic()))o[sid.toString()]=eventVar.GetValue();}}catch(err){_didIteratorError360=true;_iteratorError360=err;}finally{try{if(!_iteratorNormalCompletion360&&_iterator360["return"]!=null){_iterator360["return"]();}}finally{if(_didIteratorError360){throw _iteratorError360;}}}return o;}},{key:"_LoadVarsFromJson",value:function _LoadVarsFromJson(o){for(var _i47=0,_Object$entries13=Object.entries(o);_i47<_Object$entries13.length;_i47++){var _Object$entries13$_i=_slicedToArray(_Object$entries13[_i47],2),sidStr=_Object$entries13$_i[0],data=_Object$entries13$_i[1];var sid=parseInt(sidStr,10);var eventVar=this.GetEventVariableBySID(sid);if(eventVar)eventVar.SetValue(data);}}},{key:"_SaveScheduledWaitsToJson",value:function _SaveScheduledWaitsToJson(){return this._scheduledWaits.filter(function(w){return!w.IsPromise();}).map(function(w){return w._SaveToJson();});}},{key:"_LoadScheduledWaitsFromJson",value:function _LoadScheduledWaitsFromJson(arr){this.ClearAllScheduledWaits();var _iteratorNormalCompletion361=true;var _didIteratorError361=false;var _iteratorError361=undefined;try{for(var _iterator361=arr[Symbol.iterator](),_step361;!(_iteratorNormalCompletion361=(_step361=_iterator361.next()).done);_iteratorNormalCompletion361=true){var data=_step361.value;var sw=_C141.ScheduledWait._CreateFromJson(this,data);if(sw)this._scheduledWaits.push(sw);}}catch(err){_didIteratorError361=true;_iteratorError361=err;}finally{try{if(!_iteratorNormalCompletion361&&_iterator361["return"]!=null){_iterator361["return"]();}}finally{if(_didIteratorError361){throw _iteratorError361;}}}}},{key:"_GetPerfRecords",value:function _GetPerfRecords(){return _toConsumableArray(this._runtime.GetLayoutManager().runningLayouts()).map(function(l){return l.GetEventSheet();}).filter(function(eventSheet){return eventSheet;}).map(function(e){return e._GetPerfRecord();});}},{key:"FindFirstFunctionBlockParent",value:function FindFirstFunctionBlockParent(parent){while(parent){var scopeParent=parent.GetScopeParent();if(scopeParent instanceof _C141.FunctionBlock)return scopeParent;parent=scopeParent;}return null;}},{key:"_InvokeFunctionFromJS",value:function _InvokeFunctionFromJS(name,params){if(!Array.isArray(params))params=[];var functionBlock=this.GetFunctionBlockByName(name.toLowerCase());if(!functionBlock)return null;if(!functionBlock.IsEnabled())return functionBlock.GetDefaultReturnValue();var functionParameters=functionBlock.GetFunctionParameters();if(params.length<functionParameters.length){params=params.slice(0);do{params.push(functionParameters[params.length].GetInitialValue());}while(params.length<functionParameters.length);}var callEventBlock=functionBlock.GetEventBlock();return callEventBlock.RunAsExpressionFunctionCall.apply(callEventBlock,[callEventBlock.GetSolModifiersIncludingParents(),false,functionBlock.GetReturnType(),functionBlock.GetDefaultReturnValue()].concat(_toConsumableArray(params)));}}]);return EventSheetManager;}(_C141.DefendedBase);}// events/eventSheet.js
{'use strict';var _C142=self.C3;_C142.EventSheet=/*#__PURE__*/function(_C142$DefendedBase){_inherits(EventSheet,_C142$DefendedBase);function EventSheet(eventSheetManager,data){var _this78;_classCallCheck(this,EventSheet);_this78=_possibleConstructorReturn(this,_getPrototypeOf(EventSheet).call(this));_this78._eventSheetManager=eventSheetManager;_this78._runtime=eventSheetManager.GetRuntime();_this78._name=data[0];_this78._events=[];_this78._triggers=new Map();_this78._fastTriggers=new Map();_this78._eventsByDisplayNumber=new Map();_this78._hasRun=false;_this78._shallowIncludes=[];_this78._deepIncludes=[];_this78._alreadyIncludedSheets=new Set();var _iteratorNormalCompletion362=true;var _didIteratorError362=false;var _iteratorError362=undefined;try{for(var _iterator362=data[1][Symbol.iterator](),_step362;!(_iteratorNormalCompletion362=(_step362=_iterator362.next()).done);_iteratorNormalCompletion362=true){var eventData=_step362.value;_this78._CreateEvent(eventData,null,_this78._events);}}catch(err){_didIteratorError362=true;_iteratorError362=err;}finally{try{if(!_iteratorNormalCompletion362&&_iterator362["return"]!=null){_iterator362["return"]();}}finally{if(_didIteratorError362){throw _iteratorError362;}}}_this78._perfRecord=_this78._runtime.IsDebug()?{type:"sheet",name:_this78._name,totalTimeCounter:0,children:[]}:null;return _this78;}_createClass(EventSheet,[{key:"Release",value:function Release(){this._eventSheetManager=null;this._runtime=null;}},{key:"_CreateEvent",value:function _CreateEvent(eventData,parent,nontriggers){switch(eventData[0]){case 0:case 3:this._CreateEventBlock(eventData,parent,nontriggers);break;case 1:this._CreateEventVariable(eventData,parent,nontriggers);break;case 2:this._CreateInclude(eventData,parent,nontriggers);break;case 4:this._CreateFunctionBlock(eventData,parent);break;case 5:this._CreateScriptBlock(eventData,parent,nontriggers);break;case 6:this._CreateCustomACEBlock(eventData,parent);break;default:throw new Error("invalid event type");}}},{key:"_CreateEventBlock",value:function _CreateEventBlock(data,parent,nontriggers){var eventBlock=_C142.EventBlock.Create(this,parent,data);if(eventBlock.IsOrBlock()){nontriggers.push(eventBlock);var conditions=eventBlock.GetConditions();for(var i=0,len=conditions.length;i<len;++i){if(conditions[i].IsTrigger())this._InitTrigger(eventBlock,i);}}else if(eventBlock.IsTrigger())this._InitTrigger(eventBlock,0);else nontriggers.push(eventBlock);}},{key:"_CreateFunctionBlock",value:function _CreateFunctionBlock(data,parent){var functionBlock=_C142.FunctionBlock.CreateFunctionBlock(this,parent,data);this._eventSheetManager._RegisterFunctionBlock(functionBlock);}},{key:"_CreateCustomACEBlock",value:function _CreateCustomACEBlock(data,parent){var customAceBlock=_C142.FunctionBlock.CreateCustomACEBlock(this,parent,data);this._eventSheetManager._RegisterFunctionBlock(customAceBlock);}},{key:"_CreateEventVariable",value:function _CreateEventVariable(data,parent,nontriggers){var v=_C142.EventVariable.Create(this,parent,data);nontriggers.push(v);}},{key:"_CreateInclude",value:function _CreateInclude(data,parent,nontriggers){var include=_C142.EventInclude.Create(this,parent,data);nontriggers.push(include);}},{key:"_CreateScriptBlock",value:function _CreateScriptBlock(data,parent,nontriggers){var scriptBlock=_C142.EventScript.Create(this,parent,data);nontriggers.push(scriptBlock);}},{key:"_InitTrigger",value:function _InitTrigger(eventBlock,i){if(!eventBlock.IsOrBlock())this._eventSheetManager._AddTriggerToPostInit(eventBlock);var cnd=eventBlock.GetConditionAt(i);var func=cnd._GetFunc();var objectClass=cnd.GetObjectClass();if(cnd.IsFastTrigger()){var methodMap=this._fastTriggers.get(objectClass);if(!methodMap){methodMap=new Map();this._fastTriggers.set(objectClass,methodMap);}var value=cnd.GetFastTriggerValue().toLowerCase();var valueMap=methodMap.get(func);if(!valueMap){valueMap=new Map();methodMap.set(func,valueMap);}var triggerArr=valueMap.get(value);if(!triggerArr){triggerArr=[];valueMap.set(value,triggerArr);}triggerArr.push([eventBlock,i]);}else{var ocInfo=this._triggers.get(objectClass);if(!ocInfo){ocInfo={methodMap:new Map(),behaviors:new Map()};this._triggers.set(objectClass,ocInfo);}var behaviorType=cnd.GetBehaviorType();var _methodMap;if(behaviorType){_methodMap=ocInfo.behaviors.get(behaviorType);if(!_methodMap){_methodMap=new Map();ocInfo.behaviors.set(behaviorType,_methodMap);}}else _methodMap=ocInfo.methodMap;var _triggerArr=_methodMap.get(func);if(!_triggerArr){_triggerArr=[];_methodMap.set(func,_triggerArr);}_triggerArr.push([eventBlock,i]);}}},{key:"_PostInit",value:function _PostInit(){var events=this._events;for(var i=0,len=events.length;i<len;++i){var hasElseBlock=i<len-1&&events[i+1]instanceof _C142.EventBlock&&events[i+1].IsElseBlock();events[i]._PostInit(hasElseBlock);}}},{key:"_AddShallowInclude",value:function _AddShallowInclude(include){this._shallowIncludes.push(include);}},{key:"_UpdateDeepIncludes",value:function _UpdateDeepIncludes(){_C142.clearArray(this._deepIncludes);this._AddDeepIncludes(this);this._alreadyIncludedSheets.clear();}},{key:"_AddDeepIncludes",value:function _AddDeepIncludes(rootSheet){var deepIncludes=rootSheet._deepIncludes;var alreadyIncludedSheets=rootSheet._alreadyIncludedSheets;var _iteratorNormalCompletion363=true;var _didIteratorError363=false;var _iteratorError363=undefined;try{for(var _iterator363=this._shallowIncludes[Symbol.iterator](),_step363;!(_iteratorNormalCompletion363=(_step363=_iterator363.next()).done);_iteratorNormalCompletion363=true){var include=_step363.value;var sheet=include.GetIncludeSheet();if(!include.IsActive()||rootSheet===sheet||alreadyIncludedSheets.has(sheet))continue;alreadyIncludedSheets.add(sheet);sheet._AddDeepIncludes(rootSheet);deepIncludes.push(sheet);}}catch(err){_didIteratorError363=true;_iteratorError363=err;}finally{try{if(!_iteratorNormalCompletion363&&_iterator363["return"]!=null){_iterator363["return"]();}}finally{if(_didIteratorError363){throw _iteratorError363;}}}}},{key:"deepIncludes",value:function deepIncludes(){return this._deepIncludes;}},{key:"GetEventSheetManager",value:function GetEventSheetManager(){return this._eventSheetManager;}},{key:"GetRuntime",value:function GetRuntime(){return this._runtime;}},{key:"GetName",value:function GetName(){return this._name;}},{key:"_RegisterEventByDisplayNumber",value:function _RegisterEventByDisplayNumber(eventBlock,displayNumber){this._eventsByDisplayNumber.set(displayNumber,eventBlock);}},{key:"_GetEventByDisplayNumber",value:function _GetEventByDisplayNumber(displayNumber){return this._eventsByDisplayNumber.get(displayNumber)||null;}},{key:"_ResetHasRunFlag",value:function _ResetHasRunFlag(){this._hasRun=false;}},{key:"Run",value:function Run(){if(this._hasRun)return;var runtime=this._runtime;var profile=runtime.IsCPUProfiling();var startTime=profile?performance.now():0;this._hasRun=true;var eventSheetManager=this.GetEventSheetManager();var frame=eventSheetManager.GetCurrentEventStackFrame();var _iteratorNormalCompletion364=true;var _didIteratorError364=false;var _iteratorError364=undefined;try{for(var _iterator364=this._events[Symbol.iterator](),_step364;!(_iteratorNormalCompletion364=(_step364=_iterator364.next()).done);_iteratorNormalCompletion364=true){var e=_step364.value;e.Run(frame);eventSheetManager.ClearSol(e.GetSolModifiers());eventSheetManager.ClearAsyncActionPromises();runtime.FlushPendingInstances();}}catch(err){_didIteratorError364=true;_iteratorError364=err;}finally{try{if(!_iteratorNormalCompletion364&&_iterator364["return"]!=null){_iterator364["return"]();}}finally{if(_didIteratorError364){throw _iteratorError364;}}}frame.Reset(null);if(profile)this._perfRecord.totalTimeCounter+=performance.now()-startTime;}},{key:"DebugRun",value:/*#__PURE__*/regeneratorRuntime.mark(function DebugRun(){var runtime,eventSheetManager,frame,_iteratorNormalCompletion365,_didIteratorError365,_iteratorError365,_iterator365,_step365,e;return regeneratorRuntime.wrap(function DebugRun$(_context108){while(1){switch(_context108.prev=_context108.next){case 0:if(!this._hasRun){_context108.next=2;break;}return _context108.abrupt("return");case 2:this._hasRun=true;runtime=this._runtime;eventSheetManager=this.GetEventSheetManager();frame=eventSheetManager.GetCurrentEventStackFrame();_iteratorNormalCompletion365=true;_didIteratorError365=false;_iteratorError365=undefined;_context108.prev=9;_iterator365=this._events[Symbol.iterator]();case 11:if(_iteratorNormalCompletion365=(_step365=_iterator365.next()).done){_context108.next=20;break;}e=_step365.value;return _context108.delegateYield(e.DebugRun(frame),"t0",14);case 14:eventSheetManager.ClearSol(e.GetSolModifiers());eventSheetManager.ClearAsyncActionPromises();runtime.FlushPendingInstances();case 17:_iteratorNormalCompletion365=true;_context108.next=11;break;case 20:_context108.next=26;break;case 22:_context108.prev=22;_context108.t1=_context108["catch"](9);_didIteratorError365=true;_iteratorError365=_context108.t1;case 26:_context108.prev=26;_context108.prev=27;if(!_iteratorNormalCompletion365&&_iterator365["return"]!=null){_iterator365["return"]();}case 29:_context108.prev=29;if(!_didIteratorError365){_context108.next=32;break;}throw _iteratorError365;case 32:return _context108.finish(29);case 33:return _context108.finish(26);case 34:frame.Reset(null);case 35:case"end":return _context108.stop();}}},DebugRun,this,[[9,22,26,34],[27,,29,33]]);})},{key:"_Trigger",value:function _Trigger(method,inst,behaviorType){if(inst){var objectClass=inst.GetObjectClass();var ret=false;var r=this._TriggerForClass(method,inst,objectClass,behaviorType);ret=ret||r;var _iteratorNormalCompletion366=true;var _didIteratorError366=false;var _iteratorError366=undefined;try{for(var _iterator366=objectClass.GetFamilies()[Symbol.iterator](),_step366;!(_iteratorNormalCompletion366=(_step366=_iterator366.next()).done);_iteratorNormalCompletion366=true){var family=_step366.value;r=this._TriggerForClass(method,inst,family,behaviorType);ret=ret||r;}}catch(err){_didIteratorError366=true;_iteratorError366=err;}finally{try{if(!_iteratorNormalCompletion366&&_iterator366["return"]!=null){_iterator366["return"]();}}finally{if(_didIteratorError366){throw _iteratorError366;}}}}else return this._TriggerForClass(method,inst,null,null);}},{key:"_TriggerForClass",value:function _TriggerForClass(method,inst,objectClass,behaviorType){var ocInfo=this._triggers.get(objectClass);if(!ocInfo)return false;var methodMap=behaviorType?ocInfo.behaviors.get(behaviorType):ocInfo.methodMap;if(!methodMap)return false;var triggerList=methodMap.get(method);if(!triggerList)return false;var ret=false;var _iteratorNormalCompletion367=true;var _didIteratorError367=false;var _iteratorError367=undefined;try{for(var _iterator367=triggerList[Symbol.iterator](),_step367;!(_iteratorNormalCompletion367=(_step367=_iterator367.next()).done);_iteratorNormalCompletion367=true){var _step367$value=_slicedToArray(_step367.value,2),trigger=_step367$value[0],index=_step367$value[1];var r=this._ExecuteTrigger(inst,trigger,index);ret=ret||r;}}catch(err){_didIteratorError367=true;_iteratorError367=err;}finally{try{if(!_iteratorNormalCompletion367&&_iterator367["return"]!=null){_iterator367["return"]();}}finally{if(_didIteratorError367){throw _iteratorError367;}}}return ret;}},{key:"_DebugTrigger",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugTrigger(method,inst,behaviorType){var objectClass,ret,r,_iteratorNormalCompletion368,_didIteratorError368,_iteratorError368,_iterator368,_step368,family;return regeneratorRuntime.wrap(function _DebugTrigger$(_context109){while(1){switch(_context109.prev=_context109.next){case 0:if(!inst){_context109.next=35;break;}objectClass=inst.GetObjectClass();ret=false;return _context109.delegateYield(this._DebugTriggerForClass(method,inst,objectClass,behaviorType),"t0",4);case 4:r=_context109.t0;ret=ret||r;_iteratorNormalCompletion368=true;_didIteratorError368=false;_iteratorError368=undefined;_context109.prev=9;_iterator368=objectClass.GetFamilies()[Symbol.iterator]();case 11:if(_iteratorNormalCompletion368=(_step368=_iterator368.next()).done){_context109.next=19;break;}family=_step368.value;return _context109.delegateYield(this._DebugTriggerForClass(method,inst,family,behaviorType),"t1",14);case 14:r=_context109.t1;ret=ret||r;case 16:_iteratorNormalCompletion368=true;_context109.next=11;break;case 19:_context109.next=25;break;case 21:_context109.prev=21;_context109.t2=_context109["catch"](9);_didIteratorError368=true;_iteratorError368=_context109.t2;case 25:_context109.prev=25;_context109.prev=26;if(!_iteratorNormalCompletion368&&_iterator368["return"]!=null){_iterator368["return"]();}case 28:_context109.prev=28;if(!_didIteratorError368){_context109.next=31;break;}throw _iteratorError368;case 31:return _context109.finish(28);case 32:return _context109.finish(25);case 33:_context109.next=37;break;case 35:return _context109.delegateYield(this._DebugTriggerForClass(method,inst,null,null),"t3",36);case 36:return _context109.abrupt("return",_context109.t3);case 37:case"end":return _context109.stop();}}},_DebugTrigger,this,[[9,21,25,33],[26,,28,32]]);})},{key:"_DebugTriggerForClass",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugTriggerForClass(method,inst,objectClass,behaviorType){var ocInfo,methodMap,triggerList,ret,_iteratorNormalCompletion369,_didIteratorError369,_iteratorError369,_iterator369,_step369,_step369$value,trigger,index,r;return regeneratorRuntime.wrap(function _DebugTriggerForClass$(_context110){while(1){switch(_context110.prev=_context110.next){case 0:ocInfo=this._triggers.get(objectClass);if(ocInfo){_context110.next=3;break;}return _context110.abrupt("return",false);case 3:methodMap=behaviorType?ocInfo.behaviors.get(behaviorType):ocInfo.methodMap;if(methodMap){_context110.next=6;break;}return _context110.abrupt("return",false);case 6:triggerList=methodMap.get(method);if(triggerList){_context110.next=9;break;}return _context110.abrupt("return",false);case 9:ret=false;_iteratorNormalCompletion369=true;_didIteratorError369=false;_iteratorError369=undefined;_context110.prev=13;_iterator369=triggerList[Symbol.iterator]();case 15:if(_iteratorNormalCompletion369=(_step369=_iterator369.next()).done){_context110.next=28;break;}_step369$value=_slicedToArray(_step369.value,2),trigger=_step369$value[0],index=_step369$value[1];r=void 0;if(!trigger.DebugCanRunFast()){_context110.next=22;break;}r=this._ExecuteTrigger(inst,trigger,index);_context110.next=24;break;case 22:return _context110.delegateYield(this._DebugExecuteTrigger(inst,trigger,index),"t0",23);case 23:r=_context110.t0;case 24:ret=ret||r;case 25:_iteratorNormalCompletion369=true;_context110.next=15;break;case 28:_context110.next=34;break;case 30:_context110.prev=30;_context110.t1=_context110["catch"](13);_didIteratorError369=true;_iteratorError369=_context110.t1;case 34:_context110.prev=34;_context110.prev=35;if(!_iteratorNormalCompletion369&&_iterator369["return"]!=null){_iterator369["return"]();}case 37:_context110.prev=37;if(!_didIteratorError369){_context110.next=40;break;}throw _iteratorError369;case 40:return _context110.finish(37);case 41:return _context110.finish(34);case 42:return _context110.abrupt("return",ret);case 43:case"end":return _context110.stop();}}},_DebugTriggerForClass,this,[[13,30,34,42],[35,,37,41]]);})},{key:"_FastTrigger",value:function _FastTrigger(method,inst,value){var objectClass=inst.GetObjectClass();var methodMap=this._fastTriggers.get(objectClass);if(!methodMap)return false;var valueMap=methodMap.get(method);if(!valueMap)return false;var triggerList=valueMap.get(value);if(!triggerList)return false;var ret=false;for(var i=0,len=triggerList.length;i<len;++i){var t=triggerList[i];var r=this._ExecuteTrigger(null,t[0],t[1]);ret=ret||r;}return ret;}},{key:"_DebugFastTrigger",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugFastTrigger(method,inst,value){var objectClass,methodMap,valueMap,triggerList,ret,i,len,t,trigger,index,r;return regeneratorRuntime.wrap(function _DebugFastTrigger$(_context111){while(1){switch(_context111.prev=_context111.next){case 0:objectClass=inst.GetObjectClass();methodMap=this._fastTriggers.get(objectClass);if(methodMap){_context111.next=4;break;}return _context111.abrupt("return",false);case 4:valueMap=methodMap.get(method);if(valueMap){_context111.next=7;break;}return _context111.abrupt("return",false);case 7:triggerList=valueMap.get(value);if(triggerList){_context111.next=10;break;}return _context111.abrupt("return",false);case 10:ret=false;i=0,len=triggerList.length;case 12:if(!(i<len)){_context111.next=27;break;}t=triggerList[i];trigger=t[0];index=t[1];r=void 0;if(!trigger.DebugCanRunFast()){_context111.next=21;break;}r=this._ExecuteTrigger(null,trigger,index);_context111.next=23;break;case 21:return _context111.delegateYield(this._DebugExecuteTrigger(null,trigger,index),"t0",22);case 22:r=_context111.t0;case 23:ret=ret||r;case 24:++i;_context111.next=12;break;case 27:return _context111.abrupt("return",ret);case 28:case"end":return _context111.stop();}}},_DebugFastTrigger,this);})},{key:"_ExecuteTrigger",value:function _ExecuteTrigger(inst,trigger,index){var runtime=this._runtime;var eventSheetManager=this._eventSheetManager;var currentEvent=eventSheetManager.GetCurrentEvent();var eventStack=eventSheetManager.GetEventStack();var triggerDepth=eventSheetManager.GetTriggerDepth();var ret=false;if(currentEvent)eventSheetManager.PushCleanSol(currentEvent.GetSolModifiersIncludingParents());eventSheetManager.PushCleanSol(trigger.GetSolModifiersIncludingParents());var isRecursive=triggerDepth>1;if(isRecursive)eventSheetManager.GetLocalVarStack().Push();var frame=eventStack.Push(trigger);if(inst){var objectClass=trigger.GetConditions()[index].GetObjectClass();var sol=objectClass.GetCurrentSol();sol.SetSinglePicked(inst);if(inst.IsInContainer())inst.SetSiblingsSinglePicked();}var okToRun=true;if(trigger.GetParent()){var _parents4=trigger.GetTriggerParents();for(var i=0,len=_parents4.length;i<len;++i){if(!_parents4[i].RunPreTrigger(frame)){okToRun=false;break;}}}if(okToRun){if(trigger.IsOrBlock())trigger.RunOrBlockTrigger(frame,index);else trigger.Run(frame);ret=frame.GetLastEventTrue();}eventStack.Pop();if(isRecursive)eventSheetManager.GetLocalVarStack().Pop();eventSheetManager.PopSol(trigger.GetSolModifiersIncludingParents());if(currentEvent)eventSheetManager.PopSol(currentEvent.GetSolModifiersIncludingParents());if(!currentEvent&&triggerDepth===1){eventSheetManager.ClearAsyncActionPromises();if(!eventSheetManager.IsFlushingBlocked())runtime.FlushPendingInstances();}return ret;}},{key:"_DebugExecuteTrigger",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugExecuteTrigger(inst,trigger,index){var runtime,eventSheetManager,currentEvent,eventStack,triggerDepth,ret,isRecursive,frame,objectClass,sol,okToRun,_parents5,i,len;return regeneratorRuntime.wrap(function _DebugExecuteTrigger$(_context112){while(1){switch(_context112.prev=_context112.next){case 0:runtime=this._runtime;eventSheetManager=this._eventSheetManager;currentEvent=eventSheetManager.GetCurrentEvent();eventStack=eventSheetManager.GetEventStack();triggerDepth=eventSheetManager.GetTriggerDepth();ret=false;if(currentEvent)eventSheetManager.PushCleanSol(currentEvent.GetSolModifiersIncludingParents());eventSheetManager.PushCleanSol(trigger.GetSolModifiersIncludingParents());isRecursive=triggerDepth>1;if(isRecursive)eventSheetManager.GetLocalVarStack().Push();frame=eventStack.Push(trigger);if(inst){objectClass=trigger.GetConditions()[index].GetObjectClass();sol=objectClass.GetCurrentSol();sol.SetSinglePicked(inst);if(inst.IsInContainer())inst.SetSiblingsSinglePicked();}okToRun=true;if(!trigger.GetParent()){_context112.next=24;break;}_parents5=trigger.GetTriggerParents();i=0,len=_parents5.length;case 16:if(!(i<len)){_context112.next=24;break;}return _context112.delegateYield(_parents5[i].DebugRunPreTrigger(frame),"t0",18);case 18:if(_context112.t0){_context112.next=21;break;}okToRun=false;return _context112.abrupt("break",24);case 21:++i;_context112.next=16;break;case 24:if(!okToRun){_context112.next=31;break;}if(!trigger.IsOrBlock()){_context112.next=29;break;}return _context112.delegateYield(trigger.DebugRunOrBlockTrigger(frame,index),"t1",27);case 27:_context112.next=30;break;case 29:return _context112.delegateYield(trigger.DebugRun(frame),"t2",30);case 30:ret=frame.GetLastEventTrue();case 31:eventStack.Pop();if(isRecursive)eventSheetManager.GetLocalVarStack().Pop();eventSheetManager.PopSol(trigger.GetSolModifiersIncludingParents());if(currentEvent)eventSheetManager.PopSol(currentEvent.GetSolModifiersIncludingParents());if(!currentEvent&&triggerDepth===1){eventSheetManager.ClearAsyncActionPromises();if(!eventSheetManager.IsFlushingBlocked())runtime.FlushPendingInstances();}return _context112.abrupt("return",ret);case 37:case"end":return _context112.stop();}}},_DebugExecuteTrigger,this);})},{key:"_GetPerfRecord",value:function _GetPerfRecord(){return this._perfRecord;}}]);return EventSheet;}(_C142.DefendedBase);}// events/eventBlock.js
{var NoActions=function NoActions(frame,index){return true;};var DebugNoActions=/*#__PURE__*/regeneratorRuntime.mark(function DebugNoActions(frame,index){return regeneratorRuntime.wrap(function DebugNoActions$(_context113){while(1){switch(_context113.prev=_context113.next){case 0:return _context113.abrupt("return",true);case 1:case"end":return _context113.stop();}}},DebugNoActions);});'use strict';var _C143=self.C3;var EMPTY_ARRAY=[];_C143.EventBlock=/*#__PURE__*/function(_C143$DefendedBase){_inherits(EventBlock,_C143$DefendedBase);function EventBlock(eventSheet,parent,data){var _this79;_classCallCheck(this,EventBlock);_this79=_possibleConstructorReturn(this,_getPrototypeOf(EventBlock).call(this));_this79._eventSheet=eventSheet;_this79._runtime=eventSheet.GetRuntime();_this79._parent=parent;_this79._scopeParent=null;_this79._eventStack=_this79._runtime.GetEventSheetManager().GetEventStack();_this79._solModifiers=[];_this79._solModifiersIncludingParents=[];_this79._hasGotSolModifiersIncludingParents=false;_this79._isSolWriterAfterCnds=false;_this79._isTopLevelGroup=false;_this79._hasElseBlock=false;_this79._isOrBlock=!!data[2];_this79._isElseBlock=false;_this79._triggerParents=null;_this79._conditions=[];_this79._actions=[];_this79._subEvents=[];_this79._RunActions=NoActions;_this79._DebugRunActions=DebugNoActions;_this79._isGroup=false;_this79._isInitiallyActive=false;_this79._groupName="";_this79._isGroupActive=false;_this79._containedIncludes=null;_this79._perfRecord=null;_this79._sid=data[4];_this79._displayNumber=data[5];_this79._eventSheet._RegisterEventByDisplayNumber(_assertThisInitialized(_this79),_this79._displayNumber);_this79._debugData=_this79._runtime.IsDebug()?{isBreakpoint:data[3][0],isBreakable:data[3][1],canRunAllConditionsFast:false,canRunAllActionsFast:false,canRunAllSubEventsFast:false,canRunSelfFast:false}:null;_this79.GetEventSheetManager()._RegisterEventBlock(_assertThisInitialized(_this79));if(data[0]===3)_this79._InitGroup(data[1]);var index=0;var _iteratorNormalCompletion370=true;var _didIteratorError370=false;var _iteratorError370=undefined;try{for(var _iterator370=data[6][Symbol.iterator](),_step370;!(_iteratorNormalCompletion370=(_step370=_iterator370.next()).done);_iteratorNormalCompletion370=true){var cndData=_step370.value;var condition=_C143.Condition.Create(_assertThisInitialized(_this79),cndData,index++);_this79._conditions.push(condition);_this79._AddSolModifier(condition.GetObjectClass());}}catch(err){_didIteratorError370=true;_iteratorError370=err;}finally{try{if(!_iteratorNormalCompletion370&&_iterator370["return"]!=null){_iterator370["return"]();}}finally{if(_didIteratorError370){throw _iteratorError370;}}}index=0;var _iteratorNormalCompletion371=true;var _didIteratorError371=false;var _iteratorError371=undefined;try{for(var _iterator371=data[7][Symbol.iterator](),_step371;!(_iteratorNormalCompletion371=(_step371=_iterator371.next()).done);_iteratorNormalCompletion371=true){var actData=_step371.value;var action=_C143.Action.Create(_assertThisInitialized(_this79),actData,index++);_this79._actions.push(action);}}catch(err){_didIteratorError371=true;_iteratorError371=err;}finally{try{if(!_iteratorNormalCompletion371&&_iterator371["return"]!=null){_iterator371["return"]();}}finally{if(_didIteratorError371){throw _iteratorError371;}}}if(data.length===9){var subEventsData=data[8];var _iteratorNormalCompletion372=true;var _didIteratorError372=false;var _iteratorError372=undefined;try{for(var _iterator372=subEventsData[Symbol.iterator](),_step372;!(_iteratorNormalCompletion372=(_step372=_iterator372.next()).done);_iteratorNormalCompletion372=true){var eventData=_step372.value;_this79._eventSheet._CreateEvent(eventData,_assertThisInitialized(_this79),_this79._subEvents);}}catch(err){_didIteratorError372=true;_iteratorError372=err;}finally{try{if(!_iteratorNormalCompletion372&&_iterator372["return"]!=null){_iterator372["return"]();}}finally{if(_didIteratorError372){throw _iteratorError372;}}}}if(_this79._conditions.length)_this79._isElseBlock=_this79._conditions[0].GetObjectClass()===null&&_this79._conditions[0]._GetFunc()===_C143.Plugins.System.Cnds.Else;if(_this79._conditions.length===0)_this79._conditions=EMPTY_ARRAY;if(_this79._actions.length===0)_this79._actions=EMPTY_ARRAY;if(_this79._subEvents.length===0)_this79._subEvents=EMPTY_ARRAY;return _this79;}_createClass(EventBlock,[{key:"_InitGroup",value:function _InitGroup(groupData){this._isGroup=true;this._isInitiallyActive=!!groupData[0];this._isGroupActive=this._isInitiallyActive;this._groupName=groupData[1].toLowerCase();this._containedIncludes=[];this.GetEventSheetManager()._RegisterGroup(this);if(this._runtime.IsDebug())this._perfRecord={type:"group",name:groupData[1],totalTimeCounter:0,children:[]};}},{key:"_AddContainedInclude",value:function _AddContainedInclude(include){this._containedIncludes.push(include);}},{key:"_AddContainerSolModifierToList",value:function _AddContainerSolModifierToList(objectClass,arr){var _iteratorNormalCompletion373=true;var _didIteratorError373=false;var _iteratorError373=undefined;try{for(var _iterator373=objectClass.GetContainer().objectTypes()[Symbol.iterator](),_step373;!(_iteratorNormalCompletion373=(_step373=_iterator373.next()).done);_iteratorNormalCompletion373=true){var containerType=_step373.value;if(!arr.includes(containerType))arr.push(containerType);}}catch(err){_didIteratorError373=true;_iteratorError373=err;}finally{try{if(!_iteratorNormalCompletion373&&_iterator373["return"]!=null){_iterator373["return"]();}}finally{if(_didIteratorError373){throw _iteratorError373;}}}}},{key:"_AddSolModifierToList",value:function _AddSolModifierToList(objectClass,arr){if(!objectClass)return;if(!arr.includes(objectClass))arr.push(objectClass);if(objectClass.IsFamily()){var _iteratorNormalCompletion374=true;var _didIteratorError374=false;var _iteratorError374=undefined;try{for(var _iterator374=objectClass.GetFamilyMembers()[Symbol.iterator](),_step374;!(_iteratorNormalCompletion374=(_step374=_iterator374.next()).done);_iteratorNormalCompletion374=true){var familyMember=_step374.value;if(familyMember.IsInContainer())this._AddContainerSolModifierToList(familyMember,arr);}}catch(err){_didIteratorError374=true;_iteratorError374=err;}finally{try{if(!_iteratorNormalCompletion374&&_iterator374["return"]!=null){_iterator374["return"]();}}finally{if(_didIteratorError374){throw _iteratorError374;}}}}else if(objectClass.IsInContainer())this._AddContainerSolModifierToList(objectClass,arr);}},{key:"_AddSolModifier",value:function _AddSolModifier(objectClass){this._AddSolModifierToList(objectClass,this._solModifiers);}},{key:"_AddParentSolModifier",value:function _AddParentSolModifier(objectClass){this._AddSolModifierToList(objectClass,this._solModifiersIncludingParents);}},{key:"SetAllSolModifiers",value:function SetAllSolModifiers(){this._solModifiers=this._runtime.GetAllObjectClasses();}},{key:"_PostInit",value:function _PostInit(hasElse){this._hasElseBlock=!!hasElse;this._IdentifyTopLevelGroup();this._IdentifyTriggerParents();var _iteratorNormalCompletion375=true;var _didIteratorError375=false;var _iteratorError375=undefined;try{for(var _iterator375=this._conditions[Symbol.iterator](),_step375;!(_iteratorNormalCompletion375=(_step375=_iterator375.next()).done);_iteratorNormalCompletion375=true){var _c6=_step375.value;_c6._PostInit();}}catch(err){_didIteratorError375=true;_iteratorError375=err;}finally{try{if(!_iteratorNormalCompletion375&&_iterator375["return"]!=null){_iterator375["return"]();}}finally{if(_didIteratorError375){throw _iteratorError375;}}}if(this._actions.length>0){var hasAnyActionWithReturnType=false;var _iteratorNormalCompletion376=true;var _didIteratorError376=false;var _iteratorError376=undefined;try{for(var _iterator376=this._actions[Symbol.iterator](),_step376;!(_iteratorNormalCompletion376=(_step376=_iterator376.next()).done);_iteratorNormalCompletion376=true){var _a5=_step376.value;_a5._PostInit();if(_a5.HasReturnType())hasAnyActionWithReturnType=true;}}catch(err){_didIteratorError376=true;_iteratorError376=err;}finally{try{if(!_iteratorNormalCompletion376&&_iterator376["return"]!=null){_iterator376["return"]();}}finally{if(_didIteratorError376){throw _iteratorError376;}}}if(hasAnyActionWithReturnType){this._RunActions=this._RunActions_ReturnValue;this._DebugRunActions=this._DebugRunActions_ReturnValue;}else{this._RunActions=this._RunActions_Fast;this._DebugRunActions=this._DebugRunActions_Fast;}}var subEvents=this._subEvents;for(var i=0,len=subEvents.length;i<len;++i){var hasElseBlock=i<len-1&&subEvents[i+1]instanceof _C143.EventBlock&&subEvents[i+1].IsElseBlock();subEvents[i]._PostInit(hasElseBlock);}if(this._debugData)this._UpdateCanRunFast();if(this._perfRecord)this._GetPerfRecordParent()._GetPerfRecord().children.push(this._perfRecord);}},{key:"_GetPerfRecord",value:function _GetPerfRecord(){return this._perfRecord;}},{key:"_GetPerfRecordParent",value:function _GetPerfRecordParent(){var p=this.GetParent();while(p){if(p.IsGroup())return p;p=p.GetParent();}return this._eventSheet;}},{key:"_UpdateCanRunFast",value:function _UpdateCanRunFast(){var dd=this._debugData;dd.canRunAllConditionsFast=this._conditions.every(function(c){return c.DebugCanRunFast();});dd.canRunAllActionsFast=this._actions.every(function(a){return a.DebugCanRunFast();});dd.canRunAllSubEventsFast=this._subEvents.every(function(s){return s.DebugCanRunFast();});dd.canRunSelfFast=dd.canRunAllConditionsFast&&dd.canRunAllActionsFast&&dd.canRunAllSubEventsFast;}},{key:"_UpdateCanRunFastRecursive",value:function _UpdateCanRunFastRecursive(){var e=this;do{e._UpdateCanRunFast();e=e.GetParent();}while(e);}},{key:"_IdentifyTopLevelGroup",value:function _IdentifyTopLevelGroup(){if(!this.IsGroup())return;var p=this.GetParent();this._isTopLevelGroup=true;while(p){if(!p.IsGroup()){this._isTopLevelGroup=false;break;}p=p.GetParent();}}},{key:"_IdentifySolModifiersIncludingParents",value:function _IdentifySolModifiersIncludingParents(){var allObjectClasses=this._runtime.GetAllObjectClasses();if(this._solModifiers===allObjectClasses)this._solModifiersIncludingParents=allObjectClasses;else{this._solModifiersIncludingParents=_C143.cloneArray(this._solModifiers);var p=this.GetParent();while(p){var _iteratorNormalCompletion377=true;var _didIteratorError377=false;var _iteratorError377=undefined;try{for(var _iterator377=p._solModifiers[Symbol.iterator](),_step377;!(_iteratorNormalCompletion377=(_step377=_iterator377.next()).done);_iteratorNormalCompletion377=true){var o=_step377.value;this._AddParentSolModifier(o);}}catch(err){_didIteratorError377=true;_iteratorError377=err;}finally{try{if(!_iteratorNormalCompletion377&&_iterator377["return"]!=null){_iterator377["return"]();}}finally{if(_didIteratorError377){throw _iteratorError377;}}}p=p.GetParent();}var eventSheetManager=this.GetEventSheetManager();this._solModifiers=eventSheetManager._DeduplicateSolModifierList(this._solModifiers);this._solModifiersIncludingParents=eventSheetManager._DeduplicateSolModifierList(this._solModifiersIncludingParents);}}},{key:"_IdentifyTriggerParents",value:function _IdentifyTriggerParents(){if(!this.HasAnyTriggeredCondition())return;this._triggerParents=[];var p=this.GetParent();while(p){this._triggerParents.push(p);p=p.GetParent();}this._triggerParents.reverse();}},{key:"SetSolWriterAfterCnds",value:function SetSolWriterAfterCnds(){this._isSolWriterAfterCnds=true;if(this._parent)this._parent.SetSolWriterAfterCnds();}},{key:"IsSolWriterAfterCnds",value:function IsSolWriterAfterCnds(){return this._isSolWriterAfterCnds;}},{key:"GetSolModifiers",value:function GetSolModifiers(){return this._solModifiers;}},{key:"GetSolModifiersIncludingParents",value:function GetSolModifiersIncludingParents(){if(!this._hasGotSolModifiersIncludingParents){this._hasGotSolModifiersIncludingParents=true;this._IdentifySolModifiersIncludingParents();}return this._solModifiersIncludingParents;}},{key:"HasSolModifier",value:function HasSolModifier(objectClass){return this._solModifiers.includes(objectClass);}},{key:"GetTriggerParents",value:function GetTriggerParents(){return this._triggerParents;}},{key:"GetEventSheet",value:function GetEventSheet(){return this._eventSheet;}},{key:"GetEventSheetManager",value:function GetEventSheetManager(){return this._eventSheet.GetEventSheetManager();}},{key:"GetRuntime",value:function GetRuntime(){return this._runtime;}},{key:"GetParent",value:function GetParent(){return this._parent;}},{key:"_SetScopeParent",value:function _SetScopeParent(p){this._scopeParent=p;}},{key:"GetScopeParent",value:function GetScopeParent(){return this._scopeParent||this._parent;}},{key:"GetDisplayNumber",value:function GetDisplayNumber(){return this._displayNumber;}},{key:"IsDebugBreakable",value:function IsDebugBreakable(){return this._debugData&&this._debugData.isBreakable;}},{key:"IsDebugBreakpoint",value:function IsDebugBreakpoint(){return this.IsDebugBreakable()&&this._debugData.isBreakpoint;}},{key:"_SetDebugBreakpoint",value:function _SetDebugBreakpoint(b){this._debugData.isBreakpoint=!!b;this._UpdateCanRunFastRecursive();}},{key:"IsGroup",value:function IsGroup(){return this._isGroup;}},{key:"IsTopLevelGroup",value:function IsTopLevelGroup(){return this._isTopLevelGroup;}},{key:"IsElseBlock",value:function IsElseBlock(){return this._isElseBlock;}},{key:"HasElseBlock",value:function HasElseBlock(){return this._hasElseBlock;}},{key:"GetGroupName",value:function GetGroupName(){return this._groupName;}},{key:"IsGroupActive",value:function IsGroupActive(){return this._isGroupActive;}},{key:"ResetInitialActivation",value:function ResetInitialActivation(){this.SetGroupActive(this._isInitiallyActive);}},{key:"SetGroupActive",value:function SetGroupActive(a){a=!!a;if(!this._isGroup)throw new Error("not a group");if(this._isGroupActive===a)return;this._isGroupActive=a;var _iteratorNormalCompletion378=true;var _didIteratorError378=false;var _iteratorError378=undefined;try{for(var _iterator378=this._containedIncludes[Symbol.iterator](),_step378;!(_iteratorNormalCompletion378=(_step378=_iterator378.next()).done);_iteratorNormalCompletion378=true){var include=_step378.value;include.UpdateActive();}}catch(err){_didIteratorError378=true;_iteratorError378=err;}finally{try{if(!_iteratorNormalCompletion378&&_iterator378["return"]!=null){_iterator378["return"]();}}finally{if(_didIteratorError378){throw _iteratorError378;}}}if(this._containedIncludes.length){var currentLayout=this._runtime.GetCurrentLayout();var mainEventSheet=currentLayout.GetEventSheet();if(mainEventSheet)mainEventSheet._UpdateDeepIncludes();}}},{key:"GetSID",value:function GetSID(){return this._sid;}},{key:"IsOrBlock",value:function IsOrBlock(){return this._isOrBlock;}},{key:"IsTrigger",value:function IsTrigger(){return this._conditions.length&&this._conditions[0].IsTrigger();}},{key:"IsForFunctionBlock",value:function IsForFunctionBlock(){return this._scopeParent&&this._scopeParent instanceof _C143.FunctionBlock;}},{key:"HasAnyTriggeredCondition",value:function HasAnyTriggeredCondition(){return this.IsForFunctionBlock()||this._conditions.some(function(c){return c.IsTrigger();});}},{key:"GetConditions",value:function GetConditions(){return this._conditions;}},{key:"GetConditionCount",value:function GetConditionCount(){return this._conditions.length;}},{key:"GetConditionAt",value:function GetConditionAt(i){i=Math.floor(i);if(i<0||i>=this._conditions.length)throw new RangeError("invalid condition index");return this._conditions[i];}},{key:"GetConditionByDebugIndex",value:function GetConditionByDebugIndex(i){return this.GetConditionAt(i);}},{key:"IsFirstConditionOfType",value:function IsFirstConditionOfType(cnd){var i=cnd.GetIndex();if(i===0)return true;--i;var cndObjectClass=cnd.GetObjectClass();for(;i>=0;--i){var _c7=this._conditions[i];if(_c7.GetObjectClass()===cndObjectClass||_c7.IsSystemCondition()&&_c7.GetFirstObjectParameterObjectClass()===cndObjectClass)return false;}return true;}},{key:"GetActions",value:function GetActions(){return this._actions;}},{key:"GetActionCount",value:function GetActionCount(){return this._actions.length;}},{key:"GetActionAt",value:function GetActionAt(i){i=Math.floor(i);if(i<0||i>=this._actions.length)throw new RangeError("invalid action index");return this._actions[i];}},{key:"GetActionByDebugIndex",value:function GetActionByDebugIndex(i){i=Math.floor(i);var ret=this._actions.find(function(a){return a.GetDebugIndex()===i;});if(!ret)throw new RangeError("invalid action debug index");return ret;}},{key:"_HasActionIndex",value:function _HasActionIndex(i){i=Math.floor(i);return i>=0&&i<this._actions.length;}},{key:"GetSubEvents",value:function GetSubEvents(){return this._subEvents;}},{key:"_GetAllLocalVariablesInScope",value:function _GetAllLocalVariablesInScope(){return this._subEvents.filter(function(e){return e instanceof _C143.EventVariable;});}},{key:"RunPreTrigger",value:function RunPreTrigger(frame){frame.SetCurrentEvent(this);var conditions=this._conditions;var isAnyTrue=conditions.length===0;for(var i=0,len=conditions.length;i<len;++i){var _c8=conditions[i];frame.SetConditionIndex(i);if(_c8.IsLooping())throw new Error("trigger cannot be used as sub-event to a loop");if(_c8.Run())isAnyTrue=true;else if(!this._isOrBlock)return false;}return this._isOrBlock?isAnyTrue:true;}},{key:"RunOrBlockTrigger",value:function RunOrBlockTrigger(frame,index){frame.SetCurrentEvent(this);if(this._conditions[index].Run()){if(this._RunActions(frame,0))this._RunSubEvents(frame);frame.SetLastEventTrue(true);}}},{key:"DebugRunPreTrigger",value:/*#__PURE__*/regeneratorRuntime.mark(function DebugRunPreTrigger(frame){var conditions,isAnyTrue,i,len,_c9,ret;return regeneratorRuntime.wrap(function DebugRunPreTrigger$(_context114){while(1){switch(_context114.prev=_context114.next){case 0:frame.SetCurrentEvent(this);conditions=this._conditions;isAnyTrue=conditions.length===0;i=0,len=conditions.length;case 4:if(!(i<len)){_context114.next=25;break;}_c9=conditions[i];frame.SetConditionIndex(i);if(!_c9.IsLooping()){_context114.next=9;break;}throw new Error("trigger cannot be used as sub-event to a loop");case 9:ret=void 0;if(!_c9.DebugCanRunFast()){_context114.next=14;break;}ret=_c9.Run();_context114.next=16;break;case 14:return _context114.delegateYield(_c9.DebugRun(),"t0",15);case 15:ret=_context114.t0;case 16:if(!ret){_context114.next=20;break;}isAnyTrue=true;_context114.next=22;break;case 20:if(this._isOrBlock){_context114.next=22;break;}return _context114.abrupt("return",false);case 22:++i;_context114.next=4;break;case 25:return _context114.abrupt("return",this._isOrBlock?isAnyTrue:true);case 26:case"end":return _context114.stop();}}},DebugRunPreTrigger,this);})},{key:"DebugRunOrBlockTrigger",value:/*#__PURE__*/regeneratorRuntime.mark(function DebugRunOrBlockTrigger(frame,index){var c,ret,actRet;return regeneratorRuntime.wrap(function DebugRunOrBlockTrigger$(_context115){while(1){switch(_context115.prev=_context115.next){case 0:frame.SetCurrentEvent(this);c=this._conditions[index];if(!c.DebugCanRunFast()){_context115.next=6;break;}ret=c.Run();_context115.next=8;break;case 6:return _context115.delegateYield(c.DebugRun(),"t0",7);case 7:ret=_context115.t0;case 8:if(!ret){_context115.next=22;break;}if(!this.DebugCanRunActionsFast()){_context115.next=13;break;}actRet=this._RunActions(frame,0);_context115.next=15;break;case 13:return _context115.delegateYield(this._DebugRunActions(frame,0),"t1",14);case 14:actRet=_context115.t1;case 15:if(!actRet){_context115.next=21;break;}if(!this.DebugCanRunSubEventsFast()){_context115.next=20;break;}this._RunSubEvents();_context115.next=21;break;case 20:return _context115.delegateYield(this._DebugRunSubEvents(),"t2",21);case 21:frame.SetLastEventTrue(true);case 22:case"end":return _context115.stop();}}},DebugRunOrBlockTrigger,this);})},{key:"Run",value:function Run(frame){frame.SetCurrentEvent(this);if(!this._isElseBlock)frame.SetElseBranchRan(false);if(this._isOrBlock)this._RunOrBlock(frame);else this._RunAndBlock(frame);}},{key:"DebugRun",value:/*#__PURE__*/regeneratorRuntime.mark(function DebugRun(frame){return regeneratorRuntime.wrap(function DebugRun$(_context116){while(1){switch(_context116.prev=_context116.next){case 0:if(!(this.IsDebugBreakpoint()||this._runtime.DebugBreakNext())){_context116.next=3;break;}_context116.next=3;return this;case 3:frame.SetCurrentEvent(this);if(!this._isElseBlock)frame.SetElseBranchRan(false);if(!this._isOrBlock){_context116.next=9;break;}return _context116.delegateYield(this._DebugRunOrBlock(frame),"t0",7);case 7:_context116.next=10;break;case 9:return _context116.delegateYield(this._DebugRunAndBlock(frame),"t1",10);case 10:case"end":return _context116.stop();}}},DebugRun,this);})},{key:"_RunOrBlock",value:function _RunOrBlock(frame){var conditions=this._conditions;var isAnyTrue=conditions.length===0;for(var i=0,len=conditions.length;i<len;++i){var _c10=conditions[i];if(_c10.IsTrigger())continue;frame.SetConditionIndex(i);var result=_c10.Run();isAnyTrue=isAnyTrue||result;}frame.SetLastEventTrue(isAnyTrue);if(isAnyTrue){if(this._RunActions(frame,0))this._RunSubEvents(frame);if(this._hasElseBlock)frame.SetElseBranchRan(true);}}},{key:"_DebugRunOrBlock",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugRunOrBlock(frame){var conditions,isAnyTrue,i,len,_c11,ret,actRet;return regeneratorRuntime.wrap(function _DebugRunOrBlock$(_context117){while(1){switch(_context117.prev=_context117.next){case 0:conditions=this._conditions;isAnyTrue=conditions.length===0;i=0,len=conditions.length;case 3:if(!(i<len)){_context117.next=19;break;}_c11=conditions[i];if(!_c11.IsTrigger()){_context117.next=7;break;}return _context117.abrupt("continue",16);case 7:frame.SetConditionIndex(i);ret=void 0;if(!_c11.DebugCanRunFast()){_context117.next=13;break;}ret=_c11.Run();_context117.next=15;break;case 13:return _context117.delegateYield(_c11.DebugRun(),"t0",14);case 14:ret=_context117.t0;case 15:isAnyTrue=isAnyTrue||ret;case 16:++i;_context117.next=3;break;case 19:frame.SetLastEventTrue(isAnyTrue);if(!isAnyTrue){_context117.next=34;break;}if(!this.DebugCanRunActionsFast()){_context117.next=25;break;}actRet=this._RunActions(frame,0);_context117.next=27;break;case 25:return _context117.delegateYield(this._DebugRunActions(frame,0),"t1",26);case 26:actRet=_context117.t1;case 27:if(!actRet){_context117.next=33;break;}if(!this.DebugCanRunSubEventsFast()){_context117.next=32;break;}this._RunSubEvents();_context117.next=33;break;case 32:return _context117.delegateYield(this._DebugRunSubEvents(),"t2",33);case 33:if(this._hasElseBlock)frame.SetElseBranchRan(true);case 34:case"end":return _context117.stop();}}},_DebugRunOrBlock,this);})},{key:"_RunAndBlock",value:function _RunAndBlock(frame){var conditions=this._conditions;for(var i=0,len=conditions.length;i<len;++i){var _c12=conditions[i];frame.SetConditionIndex(i);var result=_c12.Run();if(!result){frame.SetLastEventTrue(false);return;}}frame.SetLastEventTrue(true);if(this._RunActions(frame,0))this._RunSubEvents(frame);if(frame.GetLastEventTrue()&&this._hasElseBlock)frame.SetElseBranchRan(true);}},{key:"_DebugRunAndBlock",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugRunAndBlock(frame){var conditions,i,len,_c13,ret,actRet;return regeneratorRuntime.wrap(function _DebugRunAndBlock$(_context118){while(1){switch(_context118.prev=_context118.next){case 0:conditions=this._conditions;i=0,len=conditions.length;case 2:if(!(i<len)){_context118.next=18;break;}_c13=conditions[i];frame.SetConditionIndex(i);ret=void 0;if(!_c13.DebugCanRunFast()){_context118.next=10;break;}ret=_c13.Run();_context118.next=12;break;case 10:return _context118.delegateYield(_c13.DebugRun(),"t0",11);case 11:ret=_context118.t0;case 12:if(ret){_context118.next=15;break;}frame.SetLastEventTrue(false);return _context118.abrupt("return");case 15:++i;_context118.next=2;break;case 18:frame.SetLastEventTrue(true);if(!this.DebugCanRunActionsFast()){_context118.next=23;break;}actRet=this._RunActions(frame,0);_context118.next=25;break;case 23:return _context118.delegateYield(this._DebugRunActions(frame,0),"t1",24);case 24:actRet=_context118.t1;case 25:if(!actRet){_context118.next=31;break;}if(!this.DebugCanRunSubEventsFast()){_context118.next=30;break;}this._RunSubEvents();_context118.next=31;break;case 30:return _context118.delegateYield(this._DebugRunSubEvents(),"t2",31);case 31:if(frame.GetLastEventTrue()&&this._hasElseBlock)frame.SetElseBranchRan(true);case 32:case"end":return _context118.stop();}}},_DebugRunAndBlock,this);})},{key:"_RunActions_Fast",value:function _RunActions_Fast(frame,startIndex){var actions=this._actions;for(var i=startIndex,len=actions.length;i<len;++i){var _a6=actions[i];frame.SetActionIndex(i);_a6.Run();}return true;}},{key:"_DebugRunActions_Fast",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugRunActions_Fast(frame,startIndex){var actions,i,len,_a7;return regeneratorRuntime.wrap(function _DebugRunActions_Fast$(_context119){while(1){switch(_context119.prev=_context119.next){case 0:actions=this._actions;i=startIndex,len=actions.length;case 2:if(!(i<len)){_context119.next=13;break;}_a7=actions[i];frame.SetActionIndex(i);if(!_a7.DebugCanRunFast()){_context119.next=9;break;}_a7.Run();_context119.next=10;break;case 9:return _context119.delegateYield(_a7.DebugRun(),"t0",10);case 10:++i;_context119.next=2;break;case 13:return _context119.abrupt("return",true);case 14:case"end":return _context119.stop();}}},_DebugRunActions_Fast,this);})},{key:"_RunActions_ReturnValue",value:function _RunActions_ReturnValue(frame,startIndex){var eventSheetManager=this.GetEventSheetManager();var actions=this._actions;for(var i=startIndex,len=actions.length;i<len;++i){var _a8=actions[i];frame.SetActionIndex(i);var ret=_a8.Run();if(_a8.CanBailOut()&&ret===true)return false;else if(_a8.IsAsync()&&ret instanceof Promise)eventSheetManager.AddAsyncActionPromise(ret);}return true;}},{key:"_DebugRunActions_ReturnValue",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugRunActions_ReturnValue(frame,startIndex){var eventSheetManager,actions,i,len,_a9,ret;return regeneratorRuntime.wrap(function _DebugRunActions_ReturnValue$(_context120){while(1){switch(_context120.prev=_context120.next){case 0:eventSheetManager=this.GetEventSheetManager();actions=this._actions;i=startIndex,len=actions.length;case 3:if(!(i<len)){_context120.next=21;break;}_a9=actions[i];frame.SetActionIndex(i);ret=void 0;if(!_a9.DebugCanRunFast()){_context120.next=11;break;}ret=_a9.Run();_context120.next=13;break;case 11:return _context120.delegateYield(_a9.DebugRun(),"t0",12);case 12:ret=_context120.t0;case 13:if(!(_a9.CanBailOut()&&ret===true)){_context120.next=17;break;}return _context120.abrupt("return",false);case 17:if(_a9.IsAsync()&&ret instanceof Promise)eventSheetManager.AddAsyncActionPromise(ret);case 18:++i;_context120.next=3;break;case 21:return _context120.abrupt("return",true);case 22:case"end":return _context120.stop();}}},_DebugRunActions_ReturnValue,this);})},{key:"_ResumeActionsAndSubEvents",value:function _ResumeActionsAndSubEvents(frame){if(this._RunActions(frame,frame.GetActionIndex()))this._RunSubEvents();}},{key:"_DebugResumeActionsAndSubEvents",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugResumeActionsAndSubEvents(frame){return regeneratorRuntime.wrap(function _DebugResumeActionsAndSubEvents$(_context121){while(1){switch(_context121.prev=_context121.next){case 0:return _context121.delegateYield(this._DebugRunActions(frame,frame.GetActionIndex()),"t0",1);case 1:if(!_context121.t0){_context121.next=3;break;}return _context121.delegateYield(this._DebugRunSubEvents(),"t1",3);case 3:case"end":return _context121.stop();}}},_DebugResumeActionsAndSubEvents,this);})},{key:"_RunSubEvents",value:function _RunSubEvents(){if(!this._subEvents.length)return;var profile=this.IsGroup()&&this._runtime.IsCPUProfiling();var startTime=profile?performance.now():0;var eventStack=this._eventStack;var frame=eventStack.Push(this);if(this._isSolWriterAfterCnds)this._RunSubEvents_SolWriterAfterCnds(frame);else this._RunSubEvents_Fast(frame);eventStack.Pop();if(profile)this._perfRecord.totalTimeCounter+=performance.now()-startTime;}},{key:"_RunSubEvents_SolWriterAfterCnds",value:function _RunSubEvents_SolWriterAfterCnds(frame){var isGroup=this._isGroup;var isTopLevelGroup=this._isTopLevelGroup;var eventSheetManager=this.GetEventSheetManager();var subEvents=this._subEvents;for(var i=0,len=subEvents.length,last=len-1;i<len;++i){var e=subEvents[i];var solModifiers=e.GetSolModifiers();var copySol=!isTopLevelGroup||!isGroup&&i<last;if(copySol)eventSheetManager.PushCopySol(solModifiers);e.Run(frame);if(copySol)eventSheetManager.PopSol(solModifiers);else eventSheetManager.ClearSol(solModifiers);}}},{key:"_RunSubEvents_Fast",value:function _RunSubEvents_Fast(frame){var subEvents=this._subEvents;for(var i=0,len=subEvents.length;i<len;++i){subEvents[i].Run(frame);}}},{key:"_DebugRunSubEvents",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugRunSubEvents(){var eventStack,frame;return regeneratorRuntime.wrap(function _DebugRunSubEvents$(_context122){while(1){switch(_context122.prev=_context122.next){case 0:if(this._subEvents.length){_context122.next=2;break;}return _context122.abrupt("return");case 2:eventStack=this._eventStack;frame=eventStack.Push(this);if(!this._isSolWriterAfterCnds){_context122.next=8;break;}return _context122.delegateYield(this._DebugRunSubEvents_SolWriterAfterCnds(frame),"t0",6);case 6:_context122.next=9;break;case 8:return _context122.delegateYield(this._DebugRunSubEvents_Fast(frame),"t1",9);case 9:eventStack.Pop();case 10:case"end":return _context122.stop();}}},_DebugRunSubEvents,this);})},{key:"_DebugRunSubEvents_SolWriterAfterCnds",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugRunSubEvents_SolWriterAfterCnds(frame){var isGroup,isTopLevelGroup,eventSheetManager,subEvents,i,len,last,e,solModifiers,copySol;return regeneratorRuntime.wrap(function _DebugRunSubEvents_SolWriterAfterCnds$(_context123){while(1){switch(_context123.prev=_context123.next){case 0:isGroup=this._isGroup;isTopLevelGroup=this._isTopLevelGroup;eventSheetManager=this.GetEventSheetManager();subEvents=this._subEvents;i=0,len=subEvents.length,last=len-1;case 5:if(!(i<len)){_context123.next=15;break;}e=subEvents[i];solModifiers=e.GetSolModifiers();copySol=!isTopLevelGroup||!isGroup&&i<last;if(copySol)eventSheetManager.PushCopySol(solModifiers);return _context123.delegateYield(e.DebugRun(frame),"t0",11);case 11:if(copySol)eventSheetManager.PopSol(solModifiers);else eventSheetManager.ClearSol(solModifiers);case 12:++i;_context123.next=5;break;case 15:case"end":return _context123.stop();}}},_DebugRunSubEvents_SolWriterAfterCnds,this);})},{key:"_DebugRunSubEvents_Fast",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugRunSubEvents_Fast(frame){var subEvents,i,len;return regeneratorRuntime.wrap(function _DebugRunSubEvents_Fast$(_context124){while(1){switch(_context124.prev=_context124.next){case 0:subEvents=this._subEvents;i=0,len=subEvents.length;case 2:if(!(i<len)){_context124.next=7;break;}return _context124.delegateYield(subEvents[i].DebugRun(frame),"t0",4);case 4:++i;_context124.next=2;break;case 7:case"end":return _context124.stop();}}},_DebugRunSubEvents_Fast,this);})},{key:"Retrigger",value:function Retrigger(oldFrame,newFrame){newFrame.ResetQuick();var conditions=this._conditions;if(!this.IsOrBlock())for(var i=oldFrame.GetConditionIndex()+1,len=conditions.length;i<len;++i){var _c14=conditions[i];newFrame.SetConditionIndex(i);var result=_c14.Run();if(!result)return false;}if(this._RunActions(newFrame,0))this._RunSubEvents(newFrame);return true;}},{key:"DebugRetrigger",value:/*#__PURE__*/regeneratorRuntime.mark(function DebugRetrigger(oldFrame,newFrame){var conditions,i,len,_c15,ret,actRet;return regeneratorRuntime.wrap(function DebugRetrigger$(_context125){while(1){switch(_context125.prev=_context125.next){case 0:newFrame.ResetQuick();conditions=this._conditions;if(this.IsOrBlock()){_context125.next=19;break;}i=oldFrame.GetConditionIndex()+1,len=conditions.length;case 4:if(!(i<len)){_context125.next=19;break;}_c15=conditions[i];newFrame.SetConditionIndex(i);ret=void 0;if(!_c15.DebugCanRunFast()){_context125.next=12;break;}ret=_c15.Run();_context125.next=14;break;case 12:return _context125.delegateYield(_c15.DebugRun(),"t0",13);case 13:ret=_context125.t0;case 14:if(ret){_context125.next=16;break;}return _context125.abrupt("return",false);case 16:++i;_context125.next=4;break;case 19:if(!this.DebugCanRunActionsFast()){_context125.next=23;break;}actRet=this._RunActions(newFrame,0);_context125.next=25;break;case 23:return _context125.delegateYield(this._DebugRunActions(newFrame,0),"t1",24);case 24:actRet=_context125.t1;case 25:if(!actRet){_context125.next=31;break;}if(!this.DebugCanRunSubEventsFast()){_context125.next=30;break;}this._RunSubEvents();_context125.next=31;break;case 30:return _context125.delegateYield(this._DebugRunSubEvents(),"t2",31);case 31:return _context125.abrupt("return",true);case 32:case"end":return _context125.stop();}}},DebugRetrigger,this);})},{key:"DebugCanRunFast",value:function DebugCanRunFast(){return!this.IsDebugBreakpoint()&&!this._runtime.DebugBreakNext()&&this._debugData.canRunSelfFast;}},{key:"DebugCanRunActionsFast",value:function DebugCanRunActionsFast(){return!this._runtime.DebugBreakNext()&&this._debugData.canRunAllActionsFast;}},{key:"DebugCanRunSubEventsFast",value:function DebugCanRunSubEventsFast(){return!this._runtime.DebugBreakNext()&&this._debugData.canRunAllSubEventsFast;}},{key:"_CheckParentsOKToRun",value:function _CheckParentsOKToRun(frame){if(this.GetParent()){var _parents6=this.GetTriggerParents();for(var i=0,len=_parents6.length;i<len;++i){if(!_parents6[i].RunPreTrigger(frame))return false;}}return true;}},{key:"_DebugCheckParentsOKToRun",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugCheckParentsOKToRun(frame){var _parents7,i,len;return regeneratorRuntime.wrap(function _DebugCheckParentsOKToRun$(_context126){while(1){switch(_context126.prev=_context126.next){case 0:if(!this.GetParent()){_context126.next=10;break;}_parents7=this.GetTriggerParents();i=0,len=_parents7.length;case 3:if(!(i<len)){_context126.next=10;break;}return _context126.delegateYield(_parents7[i].DebugRunPreTrigger(frame),"t0",5);case 5:if(_context126.t0){_context126.next=7;break;}return _context126.abrupt("return",false);case 7:++i;_context126.next=3;break;case 10:return _context126.abrupt("return",true);case 11:case"end":return _context126.stop();}}},_DebugCheckParentsOKToRun,this);})},{key:"_EvaluateFunctionCallParameters",value:function _EvaluateFunctionCallParameters(eventSheetManager,parameters,isRecursive){if(parameters.length>0){if(isRecursive){var paramResults=parameters.map(function(p){return p.Get(0);});eventSheetManager.GetLocalVarStack().Push();this._scopeParent.SetFunctionParameters(paramResults);}else this._scopeParent.EvaluateFunctionParameters(parameters);}else if(isRecursive)eventSheetManager.GetLocalVarStack().Push();}},{key:"RunAsFunctionCall",value:function RunAsFunctionCall(combinedSolModifiers,parameters,isCopyPicked,pickInfo){var ret;var asyncId;var hasAnySolModifiers=combinedSolModifiers.length>0;var extraPopSolModifiers=null;var runtime=this._runtime;var eventStack=this._eventStack;var eventSheetManager=runtime.GetEventSheetManager();var triggerDepth=eventSheetManager._IncTriggerDepth();var isRecursive=triggerDepth>1;this._EvaluateFunctionCallParameters(eventSheetManager,parameters,isRecursive);if(hasAnySolModifiers)if(isCopyPicked)eventSheetManager.PushCopySol(combinedSolModifiers);else eventSheetManager.PushCleanSol(combinedSolModifiers);if(pickInfo!==null){if(pickInfo.copyFromObjectClass){var copyFromSol=isCopyPicked?pickInfo.copyFromObjectClass.GetCurrentSol():pickInfo.copyFromObjectClass.GetSolStack().GetOneBelowCurrentSol();var copyToSol=pickInfo.copyToObjectClass.GetCurrentSol();copyToSol.SetArrayPicked(copyFromSol.GetInstances());copyToSol.ClearElseInstances();if(!isCopyPicked)pickInfo.copyToObjectClass.ApplySolToContainer();}else if(pickInfo.pickObjectClass){var objectClassSol=pickInfo.pickObjectClass.GetCurrentSol();objectClassSol.SetArrayPicked(pickInfo.pickInstances);objectClassSol.ClearElseInstances();}if(pickInfo.pushCleanSolDynamic)extraPopSolModifiers=eventSheetManager.PushCleanSolDynamic(combinedSolModifiers);}var frame=eventStack.Push(this);if(isCopyPicked)frame.SetDynamicSolModifiers(combinedSolModifiers);if(this._CheckParentsOKToRun(frame)){frame.SetCurrentEvent(this);var isAsync=this._scopeParent.IsAsync();if(isAsync){var _this$_scopeParent$St=this._scopeParent.StartAsyncFunctionCall();var _this$_scopeParent$St2=_slicedToArray(_this$_scopeParent$St,2);asyncId=_this$_scopeParent$St2[0];ret=_this$_scopeParent$St2[1];}this._RunAndBlock(frame);if(isAsync)this._scopeParent.MaybeFinishAsyncFunctionCall(asyncId);}eventStack.Pop();if(isRecursive)eventSheetManager.GetLocalVarStack().Pop();if(extraPopSolModifiers!==null)eventSheetManager.PopSol(extraPopSolModifiers);if(hasAnySolModifiers)eventSheetManager.PopSol(combinedSolModifiers);eventSheetManager._DecTriggerDepth();return ret;}},{key:"DebugRunAsFunctionCall",value:/*#__PURE__*/regeneratorRuntime.mark(function DebugRunAsFunctionCall(combinedSolModifiers,parameters,isCopyPicked,pickInfo){var ret,asyncId,hasAnySolModifiers,extraPopSolModifiers,runtime,eventStack,eventSheetManager,triggerDepth,isRecursive,copyFromSol,copyToSol,objectClassSol,frame,isAsync,_this$_scopeParent$St3,_this$_scopeParent$St4;return regeneratorRuntime.wrap(function DebugRunAsFunctionCall$(_context127){while(1){switch(_context127.prev=_context127.next){case 0:if(!(this.IsDebugBreakpoint()||this._runtime.DebugBreakNext())){_context127.next=3;break;}_context127.next=3;return this;case 3:hasAnySolModifiers=combinedSolModifiers.length>0;extraPopSolModifiers=null;runtime=this._runtime;eventStack=this._eventStack;eventSheetManager=runtime.GetEventSheetManager();triggerDepth=eventSheetManager._IncTriggerDepth();isRecursive=triggerDepth>1;this._EvaluateFunctionCallParameters(eventSheetManager,parameters,isRecursive);if(hasAnySolModifiers)if(isCopyPicked)eventSheetManager.PushCopySol(combinedSolModifiers);else eventSheetManager.PushCleanSol(combinedSolModifiers);if(pickInfo!==null){if(pickInfo.copyFromObjectClass){copyFromSol=isCopyPicked?pickInfo.copyFromObjectClass.GetCurrentSol():pickInfo.copyFromObjectClass.GetSolStack().GetOneBelowCurrentSol();copyToSol=pickInfo.copyToObjectClass.GetCurrentSol();copyToSol.SetArrayPicked(copyFromSol.GetInstances());copyToSol.ClearElseInstances();if(!isCopyPicked)pickInfo.copyToObjectClass.ApplySolToContainer();}else if(pickInfo.pickObjectClass){objectClassSol=pickInfo.pickObjectClass.GetCurrentSol();objectClassSol.SetArrayPicked(pickInfo.pickInstances);objectClassSol.ClearElseInstances();}if(pickInfo.pushCleanSolDynamic)extraPopSolModifiers=eventSheetManager.PushCleanSolDynamic(combinedSolModifiers);}frame=eventStack.Push(this);if(isCopyPicked)frame.SetDynamicSolModifiers(combinedSolModifiers);return _context127.delegateYield(this._DebugCheckParentsOKToRun(frame),"t0",16);case 16:if(!_context127.t0){_context127.next=22;break;}frame.SetCurrentEvent(this);isAsync=this._scopeParent.IsAsync();if(isAsync){_this$_scopeParent$St3=this._scopeParent.StartAsyncFunctionCall();_this$_scopeParent$St4=_slicedToArray(_this$_scopeParent$St3,2);asyncId=_this$_scopeParent$St4[0];ret=_this$_scopeParent$St4[1];}return _context127.delegateYield(this._DebugRunAndBlock(frame),"t1",21);case 21:if(isAsync)this._scopeParent.MaybeFinishAsyncFunctionCall(asyncId);case 22:eventStack.Pop();if(isRecursive)eventSheetManager.GetLocalVarStack().Pop();if(extraPopSolModifiers!==null)eventSheetManager.PopSol(extraPopSolModifiers);if(hasAnySolModifiers)eventSheetManager.PopSol(combinedSolModifiers);eventSheetManager._DecTriggerDepth();return _context127.abrupt("return",ret);case 28:case"end":return _context127.stop();}}},DebugRunAsFunctionCall,this);})},{key:"RunAsMappedFunctionCall",value:function RunAsMappedFunctionCall(paramResults,isCopyPicked){var solModifiers=this.GetSolModifiersIncludingParents();var hasAnySolModifiers=solModifiers.length>0;var runtime=this._runtime;var eventStack=this._eventStack;var eventSheetManager=runtime.GetEventSheetManager();var triggerDepth=eventSheetManager._IncTriggerDepth();var isRecursive=triggerDepth>1;if(isRecursive)eventSheetManager.GetLocalVarStack().Push();this._scopeParent.SetFunctionParameters(paramResults);if(hasAnySolModifiers)if(isCopyPicked)eventSheetManager.PushCopySol(solModifiers);else eventSheetManager.PushCleanSol(solModifiers);var frame=eventStack.Push(this);if(this._CheckParentsOKToRun(frame)){frame.SetCurrentEvent(this);this._RunAndBlock(frame);}eventStack.Pop();if(isRecursive)eventSheetManager.GetLocalVarStack().Pop();if(hasAnySolModifiers)eventSheetManager.PopSol(solModifiers);eventSheetManager._DecTriggerDepth();}},{key:"DebugRunAsMappedFunctionCall",value:/*#__PURE__*/regeneratorRuntime.mark(function DebugRunAsMappedFunctionCall(paramResults,isCopyPicked){var solModifiers,hasAnySolModifiers,runtime,eventStack,eventSheetManager,triggerDepth,isRecursive,frame;return regeneratorRuntime.wrap(function DebugRunAsMappedFunctionCall$(_context128){while(1){switch(_context128.prev=_context128.next){case 0:if(!(this.IsDebugBreakpoint()||this._runtime.DebugBreakNext())){_context128.next=3;break;}_context128.next=3;return this;case 3:solModifiers=this.GetSolModifiersIncludingParents();hasAnySolModifiers=solModifiers.length>0;runtime=this._runtime;eventStack=this._eventStack;eventSheetManager=runtime.GetEventSheetManager();triggerDepth=eventSheetManager._IncTriggerDepth();isRecursive=triggerDepth>1;if(isRecursive)eventSheetManager.GetLocalVarStack().Push();this._scopeParent.SetFunctionParameters(paramResults);if(hasAnySolModifiers)if(isCopyPicked)eventSheetManager.PushCopySol(solModifiers);else eventSheetManager.PushCleanSol(solModifiers);frame=eventStack.Push(this);return _context128.delegateYield(this._DebugCheckParentsOKToRun(frame),"t0",15);case 15:if(!_context128.t0){_context128.next=18;break;}frame.SetCurrentEvent(this);return _context128.delegateYield(this._DebugRunAndBlock(frame),"t1",18);case 18:eventStack.Pop();if(isRecursive)eventSheetManager.GetLocalVarStack().Pop();if(hasAnySolModifiers)eventSheetManager.PopSol(solModifiers);eventSheetManager._DecTriggerDepth();case 22:case"end":return _context128.stop();}}},DebugRunAsMappedFunctionCall,this);})},{key:"RunAsExpressionFunctionCall",value:function RunAsExpressionFunctionCall(combinedSolModifiers,isCopyPicked,returnType,defaultReturnValue){var ret;var asyncId;var hasAnySolModifiers=combinedSolModifiers.length>0;var runtime=this._runtime;var eventStack=this._eventStack;var eventSheetManager=runtime.GetEventSheetManager();var triggerDepth=eventSheetManager._IncTriggerDepth();var isRecursive=triggerDepth>1;if(isRecursive)eventSheetManager.GetLocalVarStack().Push();for(var _len37=arguments.length,paramResults=new Array(_len37>4?_len37-4:0),_key27=4;_key27<_len37;_key27++){paramResults[_key27-4]=arguments[_key27];}if(paramResults.length>0)this._scopeParent.SetFunctionParameters(paramResults);if(hasAnySolModifiers)if(isCopyPicked)eventSheetManager.PushCopySol(combinedSolModifiers);else eventSheetManager.PushCleanSol(combinedSolModifiers);var frame=eventStack.Push(this);frame.InitCallFunctionExpression(returnType,defaultReturnValue);eventStack.PushExpFunc(frame);runtime.SetDebuggingEnabled(false);if(this._CheckParentsOKToRun(frame)){frame.SetCurrentEvent(this);var isAsync=this._scopeParent.IsAsync();if(isAsync){var _this$_scopeParent$St5=this._scopeParent.StartAsyncFunctionCall();var _this$_scopeParent$St6=_slicedToArray(_this$_scopeParent$St5,2);asyncId=_this$_scopeParent$St6[0];ret=_this$_scopeParent$St6[1];}this._RunAndBlock(frame);if(isAsync)this._scopeParent.MaybeFinishAsyncFunctionCall(asyncId);}runtime.SetDebuggingEnabled(true);eventStack.Pop();eventStack.PopExpFunc();if(isRecursive)eventSheetManager.GetLocalVarStack().Pop();if(hasAnySolModifiers)eventSheetManager.PopSol(combinedSolModifiers);eventSheetManager._DecTriggerDepth();return ret||frame.GetFunctionReturnValue();}}],[{key:"Create",value:function Create(eventSheet,parent,data){return _C143.New(_C143.EventBlock,eventSheet,parent,data);}}]);return EventBlock;}(_C143.DefendedBase);}// events/eventScript.js
{'use strict';var _C144=self.C3;var EMPTY_SOL_MODIFIERS=[];var hadUserScriptException=false;_C144.EventScript=/*#__PURE__*/function(_C144$DefendedBase){_inherits(EventScript,_C144$DefendedBase);function EventScript(eventSheet,parent,data){var _this80;_classCallCheck(this,EventScript);_this80=_possibleConstructorReturn(this,_getPrototypeOf(EventScript).call(this));var runtime=eventSheet.GetRuntime();var eventSheetManager=eventSheet.GetEventSheetManager();_this80._eventSheet=eventSheet;_this80._eventSheetManager=eventSheetManager;_this80._runtime=eventSheet.GetRuntime();_this80._parent=parent;var userMethod=runtime.GetObjectReference(data[1]);_this80._func=userMethod;_this80._displayNumber=data[2];_this80._eventSheet._RegisterEventByDisplayNumber(_assertThisInitialized(_this80),_this80._displayNumber);_this80._debugData=runtime.IsDebug()?{isBreakpoint:data[3][0],isBreakable:data[3][1]}:null;return _this80;}_createClass(EventScript,[{key:"_PostInit",value:function _PostInit(){var userMethod=this._func;var localVars=this._runtime.GetEventSheetManager()._GetLocalVariablesScriptInterface(this);this._func=userMethod.bind(null,this._runtime.GetIRuntime(),localVars);}},{key:"GetParent",value:function GetParent(){return this._parent;}},{key:"GetScopeParent",value:function GetScopeParent(){return this._parent;}},{key:"GetEventSheet",value:function GetEventSheet(){return this._eventSheet;}},{key:"GetDisplayNumber",value:function GetDisplayNumber(){return this._displayNumber;}},{key:"IsDebugBreakable",value:function IsDebugBreakable(){return this._debugData&&this._debugData.isBreakable;}},{key:"IsDebugBreakpoint",value:function IsDebugBreakpoint(){return this.IsDebugBreakable()&&this._debugData.isBreakpoint;}},{key:"_SetDebugBreakpoint",value:function _SetDebugBreakpoint(b){this._debugData.isBreakpoint=!!b;}},{key:"IsElseBlock",value:function IsElseBlock(){return false;}},{key:"GetSolModifiers",value:function GetSolModifiers(){return EMPTY_SOL_MODIFIERS;}},{key:"GetSolModifiersIncludingParents",value:function GetSolModifiersIncludingParents(){if(this._parent)return this._parent.GetSolModifiersIncludingParents();else return EMPTY_SOL_MODIFIERS;}},{key:"Run",value:function Run(frame){frame.SetCurrentEvent(this);this._eventSheetManager.AddAsyncActionPromise(this._RunUserScript());}},{key:"_RunUserScript",value:function _RunUserScript(){return regeneratorRuntime.async(function _RunUserScript$(_context129){while(1){switch(_context129.prev=_context129.next){case 0:_context129.prev=0;_context129.next=3;return regeneratorRuntime.awrap(this._func());case 3:_context129.next=10;break;case 5:_context129.prev=5;_context129.t0=_context129["catch"](0);console.error("Unhandled exception running script %c".concat(this.GetEventSheet().GetName(),", event ").concat(this.GetDisplayNumber(),":"),"font-size: 1.2em; font-weight: bold;",_context129.t0);if(self.C3Debugger)self.C3Debugger._SetLastErrorScript(this);if(!hadUserScriptException){console.info("%cTip:%c run this to highlight in Construct the last script that had an error: %cgoToLastErrorScript()","font-weight: bold; text-decoration: underline","","font-weight: bold");hadUserScriptException=true;}case 10:case"end":return _context129.stop();}}},null,this,[[0,5]]);}},{key:"DebugRun",value:/*#__PURE__*/regeneratorRuntime.mark(function DebugRun(frame){return regeneratorRuntime.wrap(function DebugRun$(_context130){while(1){switch(_context130.prev=_context130.next){case 0:frame.SetCurrentEvent(this);if(!(this.IsDebugBreakpoint()||this._runtime.DebugBreakNext())){_context130.next=4;break;}_context130.next=4;return this;case 4:this.Run(frame);case 5:case"end":return _context130.stop();}}},DebugRun,this);})},{key:"DebugCanRunFast",value:function DebugCanRunFast(){return!this.IsDebugBreakpoint()&&!this._runtime.DebugBreakNext();}}],[{key:"Create",value:function Create(eventSheet,parent,data){return _C144.New(_C144.EventScript,eventSheet,parent,data);}},{key:"HadUserScriptException",value:function HadUserScriptException(){return hadUserScriptException;}},{key:"SetHadUserScriptException",value:function SetHadUserScriptException(){hadUserScriptException=true;}}]);return EventScript;}(_C144.DefendedBase);}// events/functionBlock.js
{'use strict';var _C145=self.C3;var _assert10=self.assert;_C145.FunctionBlock=/*#__PURE__*/function(_C145$DefendedBase){_inherits(FunctionBlock,_C145$DefendedBase);function FunctionBlock(eventSheet,parent,data){var _this81;_classCallCheck(this,FunctionBlock);_this81=_possibleConstructorReturn(this,_getPrototypeOf(FunctionBlock).call(this));_this81._eventSheet=eventSheet;_this81._runtime=eventSheet.GetRuntime();_this81._parent=parent;_this81._functionType=0;_this81._functionName="";_this81._returnType=0;_this81._functionParameters=[];_this81._isEnabled=true;_this81._aceName="";_this81._objectClass=null;_this81._hasOverrides=false;_this81._innerLocalVariables=[];_this81._isCopyPicked=false;_this81._isAsync=false;_this81._nextAsyncId=0;_this81._currentAsyncId=-1;_this81._asyncMap=new Map();_this81._eventBlock=_C145.EventBlock.Create(eventSheet,parent,data);_this81._eventBlock._SetScopeParent(_assertThisInitialized(_this81));return _this81;}_createClass(FunctionBlock,[{key:"InitFunctionBlock",value:function InitFunctionBlock(funcData){var _this82=this;this._functionType=0;this._functionName=funcData[0];this._returnType=funcData[1];this._functionParameters=funcData[2].map(function(paramData){return _C145.EventVariable.Create(_this82._eventSheet,_this82,paramData);});this._isEnabled=funcData[3];this._isAsync=funcData[4];this._isCopyPicked=funcData[5];}},{key:"InitCustomACEBlock",value:function InitCustomACEBlock(funcData){var _this83=this;this._functionType=1;this._aceName=funcData[1];this._objectClass=this._runtime.GetObjectClassByIndex(funcData[2]);this._eventBlock._AddSolModifier(this._objectClass);this._functionName=this._objectClass.GetName()+"."+this._aceName;this._returnType=funcData[3];this._functionParameters=funcData[4].map(function(paramData){return _C145.EventVariable.Create(_this83._eventSheet,_this83,paramData);});this._isEnabled=funcData[5];this._isAsync=funcData[6];this._isCopyPicked=funcData[7];this._objectClass.AddCustomAction(this);}},{key:"_CheckOverrideState",value:function _CheckOverrideState(){if(this._objectClass&&this._objectClass.IsFamily()){var _iteratorNormalCompletion379=true;var _didIteratorError379=false;var _iteratorError379=undefined;try{for(var _iterator379=this._objectClass.GetFamilyMembers()[Symbol.iterator](),_step379;!(_iteratorNormalCompletion379=(_step379=_iterator379.next()).done);_iteratorNormalCompletion379=true){var objectType=_step379.value;if(objectType.HasOwnCustomActionByName(this._aceName)){this._hasOverrides=true;break;}}}catch(err){_didIteratorError379=true;_iteratorError379=err;}finally{try{if(!_iteratorNormalCompletion379&&_iterator379["return"]!=null){_iterator379["return"]();}}finally{if(_didIteratorError379){throw _iteratorError379;}}}}}},{key:"_PostInit",value:function _PostInit(){var _iteratorNormalCompletion380=true;var _didIteratorError380=false;var _iteratorError380=undefined;try{for(var _iterator380=this._functionParameters[Symbol.iterator](),_step380;!(_iteratorNormalCompletion380=(_step380=_iterator380.next()).done);_iteratorNormalCompletion380=true){var fp=_step380.value;fp._PostInit();}}catch(err){_didIteratorError380=true;_iteratorError380=err;}finally{try{if(!_iteratorNormalCompletion380&&_iterator380["return"]!=null){_iterator380["return"]();}}finally{if(_didIteratorError380){throw _iteratorError380;}}}this._eventBlock._PostInit(false);}},{key:"GetFunctionType",value:function GetFunctionType(){return this._functionType;}},{key:"_GetAllLocalVariablesInScope",value:function _GetAllLocalVariablesInScope(){return this._functionParameters;}},{key:"GetFunctionParameters",value:function GetFunctionParameters(){return this._functionParameters;}},{key:"GetFunctionParameterCount",value:function GetFunctionParameterCount(){return this._functionParameters.length;}},{key:"_RegisterLocalVariable",value:function _RegisterLocalVariable(localVariable){this._innerLocalVariables.push(localVariable);}},{key:"_GetAllInnerLocalVariables",value:function _GetAllInnerLocalVariables(){return this._innerLocalVariables;}},{key:"EvaluateFunctionParameters",value:function EvaluateFunctionParameters(parameters){var functionParameters=this._functionParameters;for(var i=0,len=functionParameters.length;i<len;++i){functionParameters[i].SetValue(parameters[i].Get(0));}}},{key:"SetFunctionParameters",value:function SetFunctionParameters(paramResults){var functionParameters=this._functionParameters;for(var i=0,len=functionParameters.length;i<len;++i){functionParameters[i].SetValue(paramResults[i]);}}},{key:"CaptureFunctionParameters",value:function CaptureFunctionParameters(){return this._functionParameters.map(function(p){return p.GetValue();});}},{key:"GetParent",value:function GetParent(){return this._parent;}},{key:"GetScopeParent",value:function GetScopeParent(){return this._parent;}},{key:"GetFunctionName",value:function GetFunctionName(){return this._functionName;}},{key:"GetACEName",value:function GetACEName(){return this._aceName;}},{key:"HasCustomACEOverrides",value:function HasCustomACEOverrides(){return this._hasOverrides;}},{key:"GetReturnType",value:function GetReturnType(){return this._returnType;}},{key:"GetObjectClass",value:function GetObjectClass(){return this._objectClass;}},{key:"IsEnabled",value:function IsEnabled(){return this._isEnabled;}},{key:"GetDefaultReturnValue",value:function GetDefaultReturnValue(){switch(this._returnType){case 0:return null;case 2:return"";default:return 0;}}},{key:"GetEventBlock",value:function GetEventBlock(){return this._eventBlock;}},{key:"IsCopyPicked",value:function IsCopyPicked(){return this._isCopyPicked;}},{key:"IsAsync",value:function IsAsync(){return this._isAsync;}},{key:"StartAsyncFunctionCall",value:function StartAsyncFunctionCall(){var asyncId=this._nextAsyncId++;this._currentAsyncId=asyncId;var resolve;var promise=new Promise(function(r){return resolve=r;});this._asyncMap.set(asyncId,{resolve:resolve,pauseCount:0});return[asyncId,promise];}},{key:"MaybeFinishAsyncFunctionCall",value:function MaybeFinishAsyncFunctionCall(asyncId){var info=this._asyncMap.get(asyncId);if(info.pauseCount===0){info.resolve();this._asyncMap["delete"](asyncId);}this._currentAsyncId=-1;}},{key:"PauseCurrentAsyncFunction",value:function PauseCurrentAsyncFunction(){var info=this._asyncMap.get(this._currentAsyncId);info.pauseCount++;return this._currentAsyncId;}},{key:"ResumeAsyncFunction",value:function ResumeAsyncFunction(asyncId){this._currentAsyncId=asyncId;var info=this._asyncMap.get(asyncId);info.pauseCount--;}},{key:"RunAsFamilyCustomActionWithOverrides",value:function RunAsFamilyCustomActionWithOverrides(combinedSolModifiers,parameters){var objectTypeMap=new Map();var familyInstances=[];var _iteratorNormalCompletion381=true;var _didIteratorError381=false;var _iteratorError381=undefined;try{for(var _iterator381=this._objectClass.GetCurrentSol().GetInstances()[Symbol.iterator](),_step381;!(_iteratorNormalCompletion381=(_step381=_iterator381.next()).done);_iteratorNormalCompletion381=true){var inst=_step381.value;var _objectType=inst.GetObjectClass();if(_objectType.HasOwnCustomActionByName(this._aceName)){var _arr2=objectTypeMap.get(_objectType);if(Array.isArray(_arr2))_arr2.push(inst);else objectTypeMap.set(_objectType,[inst]);}else familyInstances.push(inst);}}catch(err){_didIteratorError381=true;_iteratorError381=err;}finally{try{if(!_iteratorNormalCompletion381&&_iterator381["return"]!=null){_iterator381["return"]();}}finally{if(_didIteratorError381){throw _iteratorError381;}}}if(familyInstances.length>0)this._eventBlock.RunAsFunctionCall(combinedSolModifiers,parameters,this._isCopyPicked,{pickObjectClass:this._objectClass,pickInstances:familyInstances});if(objectTypeMap.size>0){var _iteratorNormalCompletion382=true;var _didIteratorError382=false;var _iteratorError382=undefined;try{for(var _iterator382=objectTypeMap[Symbol.iterator](),_step382;!(_iteratorNormalCompletion382=(_step382=_iterator382.next()).done);_iteratorNormalCompletion382=true){var _step382$value=_slicedToArray(_step382.value,2),objectType=_step382$value[0],arr=_step382$value[1];var eventBlock=objectType.GetOwnCustomActionByName(this._aceName).GetEventBlock();var allCombinedSolModifiers=_toConsumableArray(new Set([].concat(_toConsumableArray(combinedSolModifiers),_toConsumableArray(eventBlock.GetSolModifiers()))));eventBlock.RunAsFunctionCall(allCombinedSolModifiers,parameters,this._isCopyPicked,{pickObjectClass:objectType,pickInstances:arr});}}catch(err){_didIteratorError382=true;_iteratorError382=err;}finally{try{if(!_iteratorNormalCompletion382&&_iterator382["return"]!=null){_iterator382["return"]();}}finally{if(_didIteratorError382){throw _iteratorError382;}}}}}},{key:"DebugRunAsFamilyCustomActionWithOverrides",value:/*#__PURE__*/regeneratorRuntime.mark(function DebugRunAsFamilyCustomActionWithOverrides(combinedSolModifiers,parameters){var objectTypeMap,familyInstances,_iteratorNormalCompletion383,_didIteratorError383,_iteratorError383,_iterator383,_step383,inst,_objectType2,_arr3,_iteratorNormalCompletion384,_didIteratorError384,_iteratorError384,_iterator384,_step384,_step384$value,objectType,arr,eventBlock,allCombinedSolModifiers;return regeneratorRuntime.wrap(function DebugRunAsFamilyCustomActionWithOverrides$(_context131){while(1){switch(_context131.prev=_context131.next){case 0:objectTypeMap=new Map();familyInstances=[];_iteratorNormalCompletion383=true;_didIteratorError383=false;_iteratorError383=undefined;_context131.prev=5;for(_iterator383=this._objectClass.GetCurrentSol().GetInstances()[Symbol.iterator]();!(_iteratorNormalCompletion383=(_step383=_iterator383.next()).done);_iteratorNormalCompletion383=true){inst=_step383.value;_objectType2=inst.GetObjectClass();if(_objectType2.HasOwnCustomActionByName(this._aceName)){_arr3=objectTypeMap.get(_objectType2);if(Array.isArray(_arr3))_arr3.push(inst);else objectTypeMap.set(_objectType2,[inst]);}else familyInstances.push(inst);}_context131.next=13;break;case 9:_context131.prev=9;_context131.t0=_context131["catch"](5);_didIteratorError383=true;_iteratorError383=_context131.t0;case 13:_context131.prev=13;_context131.prev=14;if(!_iteratorNormalCompletion383&&_iterator383["return"]!=null){_iterator383["return"]();}case 16:_context131.prev=16;if(!_didIteratorError383){_context131.next=19;break;}throw _iteratorError383;case 19:return _context131.finish(16);case 20:return _context131.finish(13);case 21:if(!(familyInstances.length>0)){_context131.next=23;break;}return _context131.delegateYield(this._eventBlock.DebugRunAsFunctionCall(combinedSolModifiers,parameters,this._isCopyPicked,{pickObjectClass:this._objectClass,pickInstances:familyInstances}),"t1",23);case 23:if(!(objectTypeMap.size>0)){_context131.next=51;break;}_iteratorNormalCompletion384=true;_didIteratorError384=false;_iteratorError384=undefined;_context131.prev=27;_iterator384=objectTypeMap[Symbol.iterator]();case 29:if(_iteratorNormalCompletion384=(_step384=_iterator384.next()).done){_context131.next=37;break;}_step384$value=_slicedToArray(_step384.value,2),objectType=_step384$value[0],arr=_step384$value[1];eventBlock=objectType.GetOwnCustomActionByName(this._aceName).GetEventBlock();allCombinedSolModifiers=_toConsumableArray(new Set([].concat(_toConsumableArray(combinedSolModifiers),_toConsumableArray(eventBlock.GetSolModifiers()))));return _context131.delegateYield(eventBlock.DebugRunAsFunctionCall(allCombinedSolModifiers,parameters,this._isCopyPicked,{pickObjectClass:objectType,pickInstances:arr}),"t2",34);case 34:_iteratorNormalCompletion384=true;_context131.next=29;break;case 37:_context131.next=43;break;case 39:_context131.prev=39;_context131.t3=_context131["catch"](27);_didIteratorError384=true;_iteratorError384=_context131.t3;case 43:_context131.prev=43;_context131.prev=44;if(!_iteratorNormalCompletion384&&_iterator384["return"]!=null){_iterator384["return"]();}case 46:_context131.prev=46;if(!_didIteratorError384){_context131.next=49;break;}throw _iteratorError384;case 49:return _context131.finish(46);case 50:return _context131.finish(43);case 51:case"end":return _context131.stop();}}},DebugRunAsFamilyCustomActionWithOverrides,this,[[5,9,13,21],[14,,16,20],[27,39,43,51],[44,,46,50]]);})}],[{key:"CreateFunctionBlock",value:function CreateFunctionBlock(eventSheet,parent,data){var ret=_C145.New(_C145.FunctionBlock,eventSheet,parent,data);var funcData=data[1];ret.InitFunctionBlock(funcData);return ret;}},{key:"CreateCustomACEBlock",value:function CreateCustomACEBlock(eventSheet,parent,data){var ret=_C145.New(_C145.FunctionBlock,eventSheet,parent,data);var funcData=data[1];ret.InitCustomACEBlock(funcData);return ret;}}]);return FunctionBlock;}(_C145.DefendedBase);}// events/eventVariable.js
{'use strict';var _C146=self.C3;var _EMPTY_SOL_MODIFIERS=[];_C146.EventVariable=/*#__PURE__*/function(_C146$DefendedBase){_inherits(EventVariable,_C146$DefendedBase);function EventVariable(eventSheet,parent,data){var _this84;_classCallCheck(this,EventVariable);_this84=_possibleConstructorReturn(this,_getPrototypeOf(EventVariable).call(this));var eventSheetManager=eventSheet.GetEventSheetManager();_this84._eventSheet=eventSheet;_this84._eventSheetManager=eventSheetManager;_this84._runtime=eventSheet.GetRuntime();_this84._parent=parent;_this84._localVarStack=eventSheetManager.GetLocalVarStack();_this84._name=data[1];_this84._type=data[2];_this84._initialValue=data[3];_this84._isStatic=!!data[4];_this84._isConstant=!!data[5];_this84._isFunctionParameter=parent instanceof _C146.FunctionBlock;_this84._sid=data[6];_this84._jsPropName=_this84._runtime.GetJsPropName(data[8]);_this84._scriptSetter=function(v){return _this84.SetValue(v);};_this84._scriptGetter=function(){return _this84.GetValue();};_this84._hasSingleValue=!_this84._parent||_this84._isStatic||_this84._isConstant;_this84._value=_this84._initialValue;_this84._localIndex=-1;if(_this84.IsBoolean())_this84._value=_this84._value?1:0;if(_this84.IsLocal()&&!_this84.IsStatic()&&!_this84.IsConstant())_this84._localIndex=eventSheetManager._GetNextLocalVarIndex(_assertThisInitialized(_this84));eventSheetManager._RegisterEventVariable(_assertThisInitialized(_this84));return _this84;}_createClass(EventVariable,[{key:"_PostInit",value:function _PostInit(){if(this.IsLocal()&&!this.IsStatic()&&!this.IsConstant()&&!this.IsFunctionParameter()){var functionBlock=this._eventSheetManager.FindFirstFunctionBlockParent(this);if(functionBlock)functionBlock._RegisterLocalVariable(this);}}},{key:"GetName",value:function GetName(){return this._name;}},{key:"GetJsPropName",value:function GetJsPropName(){return this._jsPropName;}},{key:"GetParent",value:function GetParent(){return this._parent;}},{key:"GetScopeParent",value:function GetScopeParent(){return this.GetParent();}},{key:"IsGlobal",value:function IsGlobal(){return!this.GetParent();}},{key:"IsLocal",value:function IsLocal(){return!this.IsGlobal();}},{key:"IsFunctionParameter",value:function IsFunctionParameter(){return this._isFunctionParameter;}},{key:"IsStatic",value:function IsStatic(){return this._isStatic;}},{key:"IsConstant",value:function IsConstant(){return this._isConstant;}},{key:"IsNumber",value:function IsNumber(){return this._type===0;}},{key:"IsString",value:function IsString(){return this._type===1;}},{key:"IsBoolean",value:function IsBoolean(){return this._type===2;}},{key:"IsElseBlock",value:function IsElseBlock(){return false;}},{key:"GetSID",value:function GetSID(){return this._sid;}},{key:"GetInitialValue",value:function GetInitialValue(){return this._initialValue;}},{key:"GetSolModifiers",value:function GetSolModifiers(){return _EMPTY_SOL_MODIFIERS;}},{key:"Run",value:function Run(frame){if(this.IsLocal()&&!this.IsStatic()&&!this.IsConstant())this.SetValue(this.GetInitialValue());}},{key:"DebugCanRunFast",value:function DebugCanRunFast(){return true;}},{key:"DebugRun",value:/*#__PURE__*/regeneratorRuntime.mark(function DebugRun(frame){return regeneratorRuntime.wrap(function DebugRun$(_context132){while(1){switch(_context132.prev=_context132.next){case 0:this.Run(frame);case 1:case"end":return _context132.stop();}}},DebugRun,this);})},{key:"SetValue",value:function SetValue(v){if(this.IsNumber()){if(typeof v!=="number")v=parseFloat(v);}else if(this.IsString()){if(typeof v!=="string")v=v.toString();}else if(this.IsBoolean())v=v?1:0;if(this._hasSingleValue)this._value=v;else this._localVarStack.GetCurrent()[this._localIndex]=v;}},{key:"GetValue",value:function GetValue(){return this._hasSingleValue?this._value:this._localVarStack.GetCurrent()[this._localIndex];}},{key:"GetTypedValue",value:function GetTypedValue(){var ret=this.GetValue();if(this.IsBoolean())ret=!!ret;return ret;}},{key:"ResetToInitialValue",value:function ResetToInitialValue(){this._value=this._initialValue;}},{key:"_GetScriptInterfaceDescriptor",value:function _GetScriptInterfaceDescriptor(){return{configurable:false,enumerable:true,get:this._scriptGetter,set:this._scriptSetter};}}],[{key:"Create",value:function Create(eventSheet,parent,data){return _C146.New(_C146.EventVariable,eventSheet,parent,data);}}]);return EventVariable;}(_C146.DefendedBase);}// events/eventInclude.js
{'use strict';var _C147=self.C3;var _assert11=self.assert;var _EMPTY_SOL_MODIFIERS2=[];_C147.EventInclude=/*#__PURE__*/function(_C147$DefendedBase){_inherits(EventInclude,_C147$DefendedBase);function EventInclude(eventSheet,parent,data){var _this85;_classCallCheck(this,EventInclude);_this85=_possibleConstructorReturn(this,_getPrototypeOf(EventInclude).call(this));var eventSheetManager=eventSheet.GetEventSheetManager();_this85._eventSheet=eventSheet;_this85._eventSheetManager=eventSheetManager;_this85._runtime=eventSheet.GetRuntime();_this85._parent=parent;_this85._includeSheet=null;_this85._includeSheetName=data[1];_this85._isActive=true;return _this85;}_createClass(EventInclude,[{key:"_PostInit",value:function _PostInit(){this._includeSheet=this._eventSheetManager.GetEventSheetByName(this._includeSheetName);this._eventSheet._AddShallowInclude(this);var p=this.GetParent();while(p){if(p instanceof _C147.EventBlock&&p.IsGroup())p._AddContainedInclude(this);p=p.GetParent();}this.UpdateActive();if(this._runtime.IsDebug())this._eventSheet._GetPerfRecord().children.push(this._includeSheet._GetPerfRecord());}},{key:"GetParent",value:function GetParent(){return this._parent;}},{key:"GetSolModifiers",value:function GetSolModifiers(){return _EMPTY_SOL_MODIFIERS2;}},{key:"GetIncludeSheet",value:function GetIncludeSheet(){return this._includeSheet;}},{key:"Run",value:function Run(frame){var pushSol=!!this.GetParent();var allObjectClasses=this._runtime.GetAllObjectClasses();if(pushSol)this._eventSheetManager.PushCleanSol(allObjectClasses);this._includeSheet.Run();if(pushSol)this._eventSheetManager.PopSol(allObjectClasses);}},{key:"DebugRun",value:/*#__PURE__*/regeneratorRuntime.mark(function DebugRun(frame){var pushSol,allObjectClasses;return regeneratorRuntime.wrap(function DebugRun$(_context133){while(1){switch(_context133.prev=_context133.next){case 0:pushSol=!!this.GetParent();allObjectClasses=this._runtime.GetAllObjectClasses();if(pushSol)this._eventSheetManager.PushCleanSol(allObjectClasses);return _context133.delegateYield(this._includeSheet.DebugRun(),"t0",4);case 4:if(pushSol)this._eventSheetManager.PopSol(allObjectClasses);case 5:case"end":return _context133.stop();}}},DebugRun,this);})},{key:"DebugCanRunFast",value:function DebugCanRunFast(){return false;}},{key:"IsActive",value:function IsActive(){return this._isActive;}},{key:"UpdateActive",value:function UpdateActive(){var p=this.GetParent();while(p){if(p instanceof _C147.EventBlock&&p.IsGroup()&&!p.IsGroupActive()){this._isActive=false;return;}p=p.GetParent();}this._isActive=true;}}],[{key:"Create",value:function Create(eventSheet,parent,data){return _C147.New(_C147.EventInclude,eventSheet,parent,data);}}]);return EventInclude;}(_C147.DefendedBase);}// events/expNode.js
{var WrapIndex=function WrapIndex(index,len){if(index>=len)return index%len;else if(index<0){if(index<=-len)index%=len;if(index<0)index+=len;return index;}else return index;};'use strict';var _C148=self.C3;var _assert12=self.assert;_C148.ExpNode=/*#__PURE__*/function(_C148$DefendedBase){_inherits(ExpNode,_C148$DefendedBase);function ExpNode(owner){var _this86;_classCallCheck(this,ExpNode);_this86=_possibleConstructorReturn(this,_getPrototypeOf(ExpNode).call(this));_this86._owner=owner;_this86._runtime=owner.GetRuntime();return _this86;}_createClass(ExpNode,[{key:"_PostInit",value:function _PostInit(){}}],[{key:"CreateNode",value:function CreateNode(owner,data){var type=data[0];var Classes=[BehaviorExpressionNode,ObjectExpressionNode,InstVarExpressionNode,EventVarExpNode,SystemExpressionExpNode,CallFunctionExpressionExpNode];return _C148.New(Classes[type],owner,data);}}]);return ExpNode;}(_C148.DefendedBase);var SystemExpressionExpNode=/*#__PURE__*/function(_C148$ExpNode){_inherits(SystemExpressionExpNode,_C148$ExpNode);function SystemExpressionExpNode(owner,data){var _this87;_classCallCheck(this,SystemExpressionExpNode);_this87=_possibleConstructorReturn(this,_getPrototypeOf(SystemExpressionExpNode).call(this,owner));_this87._systemPlugin=_this87._runtime.GetSystemPlugin();_this87._func=_this87._runtime.GetObjectReference(data[1]);if(_this87._func===_C148.Plugins.System.Exps.random||_this87._func===_C148.Plugins.System.Exps.choose)_this87._owner.SetVariesPerInstance();return _this87;}_createClass(SystemExpressionExpNode,[{key:"GetBoundMethod",value:function GetBoundMethod(){return this._systemPlugin._GetBoundACEMethod(this._func,this._systemPlugin);}}]);return SystemExpressionExpNode;}(_C148.ExpNode);var CallFunctionExpressionExpNode=/*#__PURE__*/function(_C148$ExpNode2){_inherits(CallFunctionExpressionExpNode,_C148$ExpNode2);function CallFunctionExpressionExpNode(owner,data){var _this88;_classCallCheck(this,CallFunctionExpressionExpNode);_this88=_possibleConstructorReturn(this,_getPrototypeOf(CallFunctionExpressionExpNode).call(this,owner));_this88._functionBlock=null;_this88._functionName=data[1];_this88._owner.SetVariesPerInstance();return _this88;}_createClass(CallFunctionExpressionExpNode,[{key:"_PostInit",value:function _PostInit(){var eventSheetManager=this._runtime.GetEventSheetManager();this._functionBlock=eventSheetManager.GetFunctionBlockByName(this._functionName);this._functionName=null;var myEventBlock=this._owner.GetEventBlock();var callEventBlock=this._functionBlock.GetEventBlock();this._combinedSolModifiers=_toConsumableArray(new Set([].concat(_toConsumableArray(myEventBlock.GetSolModifiersIncludingParents()),_toConsumableArray(callEventBlock.GetSolModifiersIncludingParents()))));this._combinedSolModifiers=eventSheetManager._DeduplicateSolModifierList(this._combinedSolModifiers);}},{key:"GetBoundMethod",value:function GetBoundMethod(){var functionBlock=this._functionBlock;if(functionBlock.IsEnabled()){var callEventBlock=functionBlock.GetEventBlock();return _C148.EventBlock.prototype.RunAsExpressionFunctionCall.bind(callEventBlock,this._combinedSolModifiers,functionBlock.IsCopyPicked(),functionBlock.GetReturnType(),functionBlock.GetDefaultReturnValue());}else{var defaultReturnValue=functionBlock.GetDefaultReturnValue();return function(){return defaultReturnValue;};}}}]);return CallFunctionExpressionExpNode;}(_C148.ExpNode);var ObjectExpressionNode=/*#__PURE__*/function(_C148$ExpNode3){_inherits(ObjectExpressionNode,_C148$ExpNode3);function ObjectExpressionNode(owner,data){var _this89;_classCallCheck(this,ObjectExpressionNode);_this89=_possibleConstructorReturn(this,_getPrototypeOf(ObjectExpressionNode).call(this,owner));_this89._objectClass=_this89._runtime.GetObjectClassByIndex(data[1]);_this89._func=_this89._runtime.GetObjectReference(data[2]);_this89._returnsString=!!data[3];_this89._eventStack=_this89._runtime.GetEventSheetManager().GetEventStack();_this89._owner._MaybeVaryFor(_this89._objectClass);return _this89;}_createClass(ObjectExpressionNode,[{key:"GetBoundMethod",value:function GetBoundMethod(){return this._objectClass.GetPlugin()._GetBoundACEMethod(this._func,this._objectClass.GetSingleGlobalInstance().GetSdkInstance());}},{key:"ExpObject",value:function ExpObject(){var objectClass=this._objectClass;var instances=objectClass.GetCurrentSol().GetExpressionInstances();var len=instances.length;if(len===0)return this._returnsString?"":0;var index=WrapIndex(this._owner.GetSolIndex(),len);this._eventStack.GetCurrentStackFrame().SetExpressionObjectClass(objectClass);for(var _len38=arguments.length,args=new Array(_len38),_key28=0;_key28<_len38;_key28++){args[_key28]=arguments[_key28];}return this._func.apply(instances[index].GetSdkInstance(),args);}},{key:"ExpObject_InstExpr",value:function ExpObject_InstExpr(instIndex){var objectClass=this._objectClass;var instances=objectClass.GetInstances();var len=instances.length;if(len===0)return this._returnsString?"":0;var index=WrapIndex(instIndex,len);this._eventStack.GetCurrentStackFrame().SetExpressionObjectClass(objectClass);for(var _len39=arguments.length,args=new Array(_len39>1?_len39-1:0),_key29=1;_key29<_len39;_key29++){args[_key29-1]=arguments[_key29];}return this._func.apply(instances[index].GetSdkInstance(),args);}}]);return ObjectExpressionNode;}(_C148.ExpNode);var InstVarExpressionNode=/*#__PURE__*/function(_C148$ExpNode4){_inherits(InstVarExpressionNode,_C148$ExpNode4);function InstVarExpressionNode(owner,data){var _this90;_classCallCheck(this,InstVarExpressionNode);_this90=_possibleConstructorReturn(this,_getPrototypeOf(InstVarExpressionNode).call(this,owner));_this90._objectClass=_this90._runtime.GetObjectClassByIndex(data[1]);_this90._varIndex=data[3];_this90._returnsString=!!data[2];_this90._owner._MaybeVaryFor(_this90._objectClass);return _this90;}_createClass(InstVarExpressionNode,[{key:"ExpInstVar",value:function ExpInstVar(){var instances=this._objectClass.GetCurrentSol().GetExpressionInstances();var len=instances.length;if(len===0)return this._returnsString?"":0;var index=WrapIndex(this._owner.GetSolIndex(),len);return instances[index]._GetInstanceVariableValueUnchecked(this._varIndex);}},{key:"ExpInstVar_Family",value:function ExpInstVar_Family(){var objectClass=this._objectClass;var instances=objectClass.GetCurrentSol().GetExpressionInstances();var len=instances.length;if(len===0)return this._returnsString?"":0;var index=WrapIndex(this._owner.GetSolIndex(),len);var inst=instances[index];var offset=inst.GetObjectClass().GetFamilyInstanceVariableOffset(objectClass.GetFamilyIndex());return inst._GetInstanceVariableValueUnchecked(this._varIndex+offset);}},{key:"ExpInstVar_InstExpr",value:function ExpInstVar_InstExpr(instIndex){var objectClass=this._objectClass;var instances=objectClass.GetInstances();var len=instances.length;if(len===0)return this._returnsString?"":0;var index=WrapIndex(instIndex,len);var inst=instances[index];var offset=0;if(objectClass.IsFamily())offset=inst.GetObjectClass().GetFamilyInstanceVariableOffset(objectClass.GetFamilyIndex());return inst._GetInstanceVariableValueUnchecked(this._varIndex+offset);}}]);return InstVarExpressionNode;}(_C148.ExpNode);var BehaviorExpressionNode=/*#__PURE__*/function(_C148$ExpNode5){_inherits(BehaviorExpressionNode,_C148$ExpNode5);function BehaviorExpressionNode(owner,data){var _this91;_classCallCheck(this,BehaviorExpressionNode);_this91=_possibleConstructorReturn(this,_getPrototypeOf(BehaviorExpressionNode).call(this,owner));_this91._objectClass=_this91._runtime.GetObjectClassByIndex(data[1]);_this91._behaviorType=_this91._objectClass.GetBehaviorTypeByName(data[2]);_this91._behaviorIndex=_this91._objectClass.GetBehaviorIndexByName(data[2]);_this91._func=_this91._runtime.GetObjectReference(data[3]);_this91._returnsString=!!data[4];_this91._eventStack=_this91._runtime.GetEventSheetManager().GetEventStack();_this91._owner._MaybeVaryFor(_this91._objectClass);return _this91;}_createClass(BehaviorExpressionNode,[{key:"ExpBehavior",value:function ExpBehavior(){var objectClass=this._objectClass;var instances=objectClass.GetCurrentSol().GetExpressionInstances();var len=instances.length;if(len===0)return this._returnsString?"":0;var index=WrapIndex(this._owner.GetSolIndex(),len);this._eventStack.GetCurrentStackFrame().SetExpressionObjectClass(objectClass);var inst=instances[index];var offset=0;if(objectClass.IsFamily())offset=inst.GetObjectClass().GetFamilyBehaviorOffset(objectClass.GetFamilyIndex());for(var _len40=arguments.length,args=new Array(_len40),_key30=0;_key30<_len40;_key30++){args[_key30]=arguments[_key30];}return this._func.apply(inst.GetBehaviorInstances()[this._behaviorIndex+offset].GetSdkInstance(),args);}},{key:"ExpBehavior_InstExpr",value:function ExpBehavior_InstExpr(instIndex){var objectClass=this._objectClass;var instances=objectClass.GetInstances();var len=instances.length;if(len===0)return this._returnsString?"":0;var index=WrapIndex(instIndex,len);this._eventStack.GetCurrentStackFrame().SetExpressionObjectClass(objectClass);var inst=instances[index];var offset=0;if(objectClass.IsFamily())offset=inst.GetObjectClass().GetFamilyBehaviorOffset(objectClass.GetFamilyIndex());for(var _len41=arguments.length,args=new Array(_len41>1?_len41-1:0),_key31=1;_key31<_len41;_key31++){args[_key31-1]=arguments[_key31];}return this._func.apply(inst.GetBehaviorInstances()[this._behaviorIndex+offset].GetSdkInstance(),args);}}]);return BehaviorExpressionNode;}(_C148.ExpNode);var EventVarExpNode=/*#__PURE__*/function(_C148$ExpNode6){_inherits(EventVarExpNode,_C148$ExpNode6);function EventVarExpNode(owner,data){var _this92;_classCallCheck(this,EventVarExpNode);_this92=_possibleConstructorReturn(this,_getPrototypeOf(EventVarExpNode).call(this,owner));_this92._eventVar=null;_this92._eventVarSid=data[1];return _this92;}_createClass(EventVarExpNode,[{key:"_PostInit",value:function _PostInit(){this._eventVar=this._runtime.GetEventSheetManager().GetEventVariableBySID(this._eventVarSid);}},{key:"GetVar",value:function GetVar(){return this._eventVar;}}]);return EventVarExpNode;}(_C148.ExpNode);;}// events/parameter.js
{var GetExpressionFunc=function GetExpressionFunc(number){var ret=self.C3_ExpressionFuncs[number];if(!ret)throw new Error("invalid expression number");return ret;};'use strict';var _C149=self.C3;var _assert13=self.assert;_C149.Parameter=/*#__PURE__*/function(_C149$DefendedBase){_inherits(Parameter,_C149$DefendedBase);function Parameter(owner,type,index){var _this93;_classCallCheck(this,Parameter);_this93=_possibleConstructorReturn(this,_getPrototypeOf(Parameter).call(this));_this93._owner=owner;_this93._index=index;_this93._type=type;_this93.Get=null;_this93._variesPerInstance=false;_this93._isConstant=false;return _this93;}_createClass(Parameter,[{key:"_PostInit",value:function _PostInit(){}},{key:"SetVariesPerInstance",value:function SetVariesPerInstance(){this._variesPerInstance=true;}},{key:"_MaybeVaryFor",value:function _MaybeVaryFor(objectClass){if(this._variesPerInstance)return;if(!objectClass)return;if(!objectClass.GetPlugin().IsSingleGlobal())this._variesPerInstance=true;}},{key:"VariesPerInstance",value:function VariesPerInstance(){return this._variesPerInstance;}},{key:"GetIndex",value:function GetIndex(){return this._index;}},{key:"GetRuntime",value:function GetRuntime(){return this._owner.GetRuntime();}},{key:"GetEventBlock",value:function GetEventBlock(){return this._owner.GetEventBlock();}},{key:"IsConstant",value:function IsConstant(){return this._isConstant;}},{key:"IsObjectParameter",value:function IsObjectParameter(){return this._type===4;}}],[{key:"Create",value:function Create(owner,data,index){var type=data[0];var Classes=[ExpressionParameter,StringExpressionParameter,FileParameter,ComboParameter,ObjectParameter,LayerExpressionParameter,LayoutParameter,ExpressionParameter,ComboParameter,ComboParameter,InstVarParameter,EventVarParameter,FileParameter,VariadicParameter,StringExpressionParameter,TimelineParameter,BooleanParameter,FunctionParameter,EaseParameter,TilemapBrushParameter,TemplateExpressionParameter,FlowchartParameter];return _C149.New(Classes[type],owner,type,index,data);}}]);return Parameter;}(_C149.DefendedBase);var ExpressionParameter=/*#__PURE__*/function(_C149$Parameter){_inherits(ExpressionParameter,_C149$Parameter);function ExpressionParameter(owner,type,index,data){var _this94;_classCallCheck(this,ExpressionParameter);_this94=_possibleConstructorReturn(this,_getPrototypeOf(ExpressionParameter).call(this,owner,type,index));_this94._solIndex=0;var expData=data[1];_this94._expressionNumber=expData[0];_this94._numberedNodes=[];_this94._expressionFunc=null;for(var i=1,len=expData.length;i<len;++i){_this94._numberedNodes.push(_C149.ExpNode.CreateNode(_assertThisInitialized(_this94),expData[i]));}if(_this94._numberedNodes.length)_this94.Get=_this94.GetExpression;else{_this94.Get=GetExpressionFunc(_this94._expressionNumber);_this94._isConstant=true;}return _this94;}_createClass(ExpressionParameter,[{key:"_GetNode",value:function _GetNode(i){if(i<0||i>=this._numberedNodes.length)throw new RangeError("invalid numbered node");return this._numberedNodes[i];}},{key:"_PostInit",value:function _PostInit(){var _iteratorNormalCompletion385=true;var _didIteratorError385=false;var _iteratorError385=undefined;try{for(var _iterator385=this._numberedNodes[Symbol.iterator](),_step385;!(_iteratorNormalCompletion385=(_step385=_iterator385.next()).done);_iteratorNormalCompletion385=true){var node=_step385.value;node._PostInit();}}catch(err){_didIteratorError385=true;_iteratorError385=err;}finally{try{if(!_iteratorNormalCompletion385&&_iterator385["return"]!=null){_iterator385["return"]();}}finally{if(_didIteratorError385){throw _iteratorError385;}}}var func=GetExpressionFunc(this._expressionNumber);if(this._numberedNodes.length)this._expressionFunc=func(this);else this._expressionFunc=func;}},{key:"GetSolIndex",value:function GetSolIndex(){return this._solIndex;}},{key:"GetExpression",value:function GetExpression(solIndex){this._solIndex=solIndex;return this._expressionFunc();}}]);return ExpressionParameter;}(_C149.Parameter);var StringExpressionParameter=/*#__PURE__*/function(_ExpressionParameter){_inherits(StringExpressionParameter,_ExpressionParameter);function StringExpressionParameter(owner,type,index,data){var _this95;_classCallCheck(this,StringExpressionParameter);_this95=_possibleConstructorReturn(this,_getPrototypeOf(StringExpressionParameter).call(this,owner,type,index,data));_this95.Get=_this95.GetStringExpression;if(type===14){_this95.GetEventBlock().SetAllSolModifiers();if(_this95._owner instanceof _C149.Action)_this95.GetEventBlock().SetSolWriterAfterCnds();}return _this95;}_createClass(StringExpressionParameter,[{key:"GetStringExpression",value:function GetStringExpression(solIndex){this._solIndex=solIndex;var ret=this._expressionFunc();if(typeof ret==="string")return ret;else return"";}},{key:"_GetFastTriggerValue",value:function _GetFastTriggerValue(){return GetExpressionFunc(this._expressionNumber)();}}]);return StringExpressionParameter;}(ExpressionParameter);var LayerExpressionParameter=/*#__PURE__*/function(_ExpressionParameter2){_inherits(LayerExpressionParameter,_ExpressionParameter2);function LayerExpressionParameter(owner,type,index,data){var _this96;_classCallCheck(this,LayerExpressionParameter);_this96=_possibleConstructorReturn(this,_getPrototypeOf(LayerExpressionParameter).call(this,owner,type,index,data));_this96.Get=_this96.GetLayer;_this96._isConstant=false;return _this96;}_createClass(LayerExpressionParameter,[{key:"GetLayer",value:function GetLayer(solIndex){this._solIndex=solIndex;var ret=this._expressionFunc();var layout=this.GetRuntime().GetCurrentLayout();return layout.GetLayer(ret);}}]);return LayerExpressionParameter;}(ExpressionParameter);var ComboParameter=/*#__PURE__*/function(_C149$Parameter2){_inherits(ComboParameter,_C149$Parameter2);function ComboParameter(owner,type,index,data){var _this97;_classCallCheck(this,ComboParameter);_this97=_possibleConstructorReturn(this,_getPrototypeOf(ComboParameter).call(this,owner,type,index));_this97._combo=data[1];_this97.Get=_this97.GetCombo;_this97._isConstant=true;return _this97;}_createClass(ComboParameter,[{key:"GetCombo",value:function GetCombo(){return this._combo;}}]);return ComboParameter;}(_C149.Parameter);var BooleanParameter=/*#__PURE__*/function(_C149$Parameter3){_inherits(BooleanParameter,_C149$Parameter3);function BooleanParameter(owner,type,index,data){var _this98;_classCallCheck(this,BooleanParameter);_this98=_possibleConstructorReturn(this,_getPrototypeOf(BooleanParameter).call(this,owner,type,index));_this98._bool=data[1];_this98.Get=_this98.GetBoolean;_this98._isConstant=true;return _this98;}_createClass(BooleanParameter,[{key:"GetBoolean",value:function GetBoolean(){return this._bool;}}]);return BooleanParameter;}(_C149.Parameter);var ObjectParameter=/*#__PURE__*/function(_C149$Parameter4){_inherits(ObjectParameter,_C149$Parameter4);function ObjectParameter(owner,type,index,data){var _this99;_classCallCheck(this,ObjectParameter);_this99=_possibleConstructorReturn(this,_getPrototypeOf(ObjectParameter).call(this,owner,type,index));_this99._objectClass=_this99.GetRuntime().GetObjectClassByIndex(data[1]);_this99.Get=_this99.GetObjectClass;var eventBlock=_this99.GetEventBlock();eventBlock._AddSolModifier(_this99._objectClass);if(_this99._owner instanceof _C149.Action)eventBlock.SetSolWriterAfterCnds();else if(eventBlock.GetParent())eventBlock.GetParent().SetSolWriterAfterCnds();_this99._isConstant=true;return _this99;}_createClass(ObjectParameter,[{key:"GetObjectClass",value:function GetObjectClass(){return this._objectClass;}}]);return ObjectParameter;}(_C149.Parameter);var LayoutParameter=/*#__PURE__*/function(_C149$Parameter5){_inherits(LayoutParameter,_C149$Parameter5);function LayoutParameter(owner,type,index,data){var _this100;_classCallCheck(this,LayoutParameter);_this100=_possibleConstructorReturn(this,_getPrototypeOf(LayoutParameter).call(this,owner,type,index));_this100._layout=_this100.GetRuntime().GetLayoutManager().GetLayoutByName(data[1]);_this100.Get=_this100.GetLayout;_this100._isConstant=true;return _this100;}_createClass(LayoutParameter,[{key:"GetLayout",value:function GetLayout(){return this._layout;}}]);return LayoutParameter;}(_C149.Parameter);var TimelineParameter=/*#__PURE__*/function(_C149$Parameter6){_inherits(TimelineParameter,_C149$Parameter6);function TimelineParameter(owner,type,index,data){var _this101;_classCallCheck(this,TimelineParameter);_this101=_possibleConstructorReturn(this,_getPrototypeOf(TimelineParameter).call(this,owner,type,index));_this101._timeline=_this101.GetRuntime().GetTimelineManager().GetTimelineByName(data[1]);_this101.Get=_this101.GetTimeline;_this101._isConstant=true;return _this101;}_createClass(TimelineParameter,[{key:"GetTimeline",value:function GetTimeline(){return this._timeline;}}]);return TimelineParameter;}(_C149.Parameter);var FileParameter=/*#__PURE__*/function(_C149$Parameter7){_inherits(FileParameter,_C149$Parameter7);function FileParameter(owner,type,index,data){var _this102;_classCallCheck(this,FileParameter);_this102=_possibleConstructorReturn(this,_getPrototypeOf(FileParameter).call(this,owner,type,index));_this102._fileInfo=data[1];_this102.Get=_this102.GetFile;_this102._isConstant=true;return _this102;}_createClass(FileParameter,[{key:"GetFile",value:function GetFile(){return this._fileInfo;}}]);return FileParameter;}(_C149.Parameter);var InstVarParameter=/*#__PURE__*/function(_C149$Parameter8){_inherits(InstVarParameter,_C149$Parameter8);function InstVarParameter(owner,type,index,data){var _this103;_classCallCheck(this,InstVarParameter);_this103=_possibleConstructorReturn(this,_getPrototypeOf(InstVarParameter).call(this,owner,type,index));_this103._instVarIndex=data[1];var ownerObjectClass=_this103._owner.GetObjectClass();if(_this103._owner instanceof _C149.Condition&&_this103._owner.IsStatic()){_this103.Get=_this103.GetInstanceVariable;_this103._isConstant=true;}else if(ownerObjectClass&&ownerObjectClass.IsFamily()){_this103.Get=_this103.GetFamilyInstanceVariable;_this103.SetVariesPerInstance();}else{_this103.Get=_this103.GetInstanceVariable;_this103._isConstant=true;}return _this103;}_createClass(InstVarParameter,[{key:"GetInstanceVariable",value:function GetInstanceVariable(){return this._instVarIndex;}},{key:"GetFamilyInstanceVariable",value:function GetFamilyInstanceVariable(solIndex){solIndex=solIndex||0;var familyType=this._owner.GetObjectClass();var sol=familyType.GetCurrentSol();var instances=sol.GetInstances();var realType=null;if(instances.length)realType=instances[solIndex%instances.length].GetObjectClass();else if(sol.HasAnyElseInstances()){var elseInstances=sol.GetElseInstances();realType=elseInstances[solIndex%elseInstances.length].GetObjectClass();}else if(familyType.GetInstanceCount()>0){var familyInstances=familyType.GetInstances();realType=familyInstances[solIndex%familyInstances.length].GetObjectClass();}else return 0;return this._instVarIndex+realType.GetFamilyInstanceVariableOffset(familyType.GetFamilyIndex());}}]);return InstVarParameter;}(_C149.Parameter);var EventVarParameter=/*#__PURE__*/function(_C149$Parameter9){_inherits(EventVarParameter,_C149$Parameter9);function EventVarParameter(owner,type,index,data){var _this104;_classCallCheck(this,EventVarParameter);_this104=_possibleConstructorReturn(this,_getPrototypeOf(EventVarParameter).call(this,owner,type,index));_this104._eventVarSid=data[1];_this104._eventVar=null;_this104.Get=_this104.GetEventVariable;_this104._isConstant=true;return _this104;}_createClass(EventVarParameter,[{key:"_PostInit",value:function _PostInit(){this._eventVar=this.GetRuntime().GetEventSheetManager().GetEventVariableBySID(this._eventVarSid);}},{key:"GetEventVariable",value:function GetEventVariable(){return this._eventVar;}}]);return EventVarParameter;}(_C149.Parameter);var FunctionParameter=/*#__PURE__*/function(_C149$Parameter10){_inherits(FunctionParameter,_C149$Parameter10);function FunctionParameter(owner,type,index,data){var _this105;_classCallCheck(this,FunctionParameter);_this105=_possibleConstructorReturn(this,_getPrototypeOf(FunctionParameter).call(this,owner,type,index));_this105._functionBlockName=data[1];_this105._functionBlock=null;_this105.Get=_this105.GetFunction;_this105._isConstant=true;return _this105;}_createClass(FunctionParameter,[{key:"_PostInit",value:function _PostInit(){this._functionBlock=this.GetRuntime().GetEventSheetManager().GetFunctionBlockByName(this._functionBlockName);this._functionBlockName=null;}},{key:"GetFunction",value:function GetFunction(){return this._functionBlock;}}]);return FunctionParameter;}(_C149.Parameter);var VariadicParameter=/*#__PURE__*/function(_C149$Parameter11){_inherits(VariadicParameter,_C149$Parameter11);function VariadicParameter(owner,type,index,data){var _this106;_classCallCheck(this,VariadicParameter);_this106=_possibleConstructorReturn(this,_getPrototypeOf(VariadicParameter).call(this,owner,type,index));_this106._subParams=[];_this106._variadicRet=[];_this106._isConstant=true;for(var i=1,len=data.length;i<len;++i){var subParam=_C149.Parameter.Create(_this106._owner,data[i],0);_this106._subParams.push(subParam);_this106._variadicRet.push(0);if(!subParam.IsConstant())_this106._isConstant=false;}_this106.Get=_this106.GetVariadic;return _this106;}_createClass(VariadicParameter,[{key:"_PostInit",value:function _PostInit(){var _iteratorNormalCompletion386=true;var _didIteratorError386=false;var _iteratorError386=undefined;try{for(var _iterator386=this._subParams[Symbol.iterator](),_step386;!(_iteratorNormalCompletion386=(_step386=_iterator386.next()).done);_iteratorNormalCompletion386=true){var subParam=_step386.value;subParam._PostInit();}}catch(err){_didIteratorError386=true;_iteratorError386=err;}finally{try{if(!_iteratorNormalCompletion386&&_iterator386["return"]!=null){_iterator386["return"]();}}finally{if(_didIteratorError386){throw _iteratorError386;}}}}},{key:"GetVariadic",value:function GetVariadic(){var subParams=this._subParams;var variadicRet=this._variadicRet;for(var i=0,len=subParams.length;i<len;++i){variadicRet[i]=subParams[i].Get(0);}return variadicRet;}}]);return VariadicParameter;}(_C149.Parameter);var EaseParameter=/*#__PURE__*/function(_C149$Parameter12){_inherits(EaseParameter,_C149$Parameter12);function EaseParameter(owner,type,index,data){var _this107;_classCallCheck(this,EaseParameter);_this107=_possibleConstructorReturn(this,_getPrototypeOf(EaseParameter).call(this,owner,type,index));_this107._easeIndex=data[1];_this107.Get=_this107.GetEase;_this107._isConstant=true;return _this107;}_createClass(EaseParameter,[{key:"GetEase",value:function GetEase(){return this._easeIndex;}}]);return EaseParameter;}(_C149.Parameter);var TilemapBrushParameter=/*#__PURE__*/function(_C149$Parameter13){_inherits(TilemapBrushParameter,_C149$Parameter13);function TilemapBrushParameter(owner,type,index,data){var _this108;_classCallCheck(this,TilemapBrushParameter);_this108=_possibleConstructorReturn(this,_getPrototypeOf(TilemapBrushParameter).call(this,owner,type,index));_this108._brushIndex=data[1];_this108.Get=_this108.GetTilemapBrush;_this108._isConstant=true;return _this108;}_createClass(TilemapBrushParameter,[{key:"GetTilemapBrush",value:function GetTilemapBrush(){return this._brushIndex;}}]);return TilemapBrushParameter;}(_C149.Parameter);var TemplateExpressionParameter=/*#__PURE__*/function(_ExpressionParameter3){_inherits(TemplateExpressionParameter,_ExpressionParameter3);function TemplateExpressionParameter(owner,type,index,data){var _this109;_classCallCheck(this,TemplateExpressionParameter);_this109=_possibleConstructorReturn(this,_getPrototypeOf(TemplateExpressionParameter).call(this,owner,type,index,data));_this109.Get=_this109.GetTemplateName;_this109._isConstant=false;return _this109;}_createClass(TemplateExpressionParameter,[{key:"GetTemplateName",value:function GetTemplateName(){return this._expressionFunc();}}]);return TemplateExpressionParameter;}(ExpressionParameter);var FlowchartParameter=/*#__PURE__*/function(_C149$Parameter14){_inherits(FlowchartParameter,_C149$Parameter14);function FlowchartParameter(owner,type,index,data){var _this110;_classCallCheck(this,FlowchartParameter);_this110=_possibleConstructorReturn(this,_getPrototypeOf(FlowchartParameter).call(this,owner,type,index));_this110._flowchartDataItem=_this110.GetRuntime().GetFlowchartManager().GetFlowchartDataItemByName(data[1]);_this110.Get=_this110.GetFlowchartName;_this110._isConstant=true;return _this110;}_createClass(FlowchartParameter,[{key:"GetFlowchartName",value:function GetFlowchartName(){return this._flowchartDataItem.GetName();}}]);return FlowchartParameter;}(_C149.Parameter);;}// events/condition.js
{var EvalParams=function EvalParams(parameters,results){for(var i=0,len=parameters.length;i<len;++i){results[i]=parameters[i].Get(0);}};'use strict';var _C150=self.C3;var _assert14=self.assert;var EMPTY_PARAMS_ARRAY=[];var noop=function noop(){};_C150.Condition=/*#__PURE__*/function(_C150$DefendedBase){_inherits(Condition,_C150$DefendedBase);function Condition(eventBlock,data,index){var _this111;_classCallCheck(this,Condition);_this111=_possibleConstructorReturn(this,_getPrototypeOf(Condition).call(this));_this111._eventBlock=eventBlock;_this111._runtime=eventBlock.GetRuntime();_this111._index=index;_this111._func=_this111._runtime.GetObjectReference(data[1]);_this111._isTrigger=data[3]>0;_this111._isFastTrigger=data[3]===2;_this111._isLooping=!!data[4];_this111._isInverted=!!data[5];_this111._isStatic=!!data[6];_this111._sid=data[7];_this111._isInOrBlock=_this111._eventBlock.IsOrBlock();_this111._objectClass=null;_this111._behaviorType=null;_this111._behaviorIndex=-1;_this111._systemPlugin=null;_this111.Run=noop;_this111.DebugRun=noop;_this111._parameters=[];_this111._results=[];_this111._anyParamVariesPerInstance=false;_this111._savedData=null;_this111._unsavedData=null;_this111._debugData=_this111._runtime.IsDebug()?{isBreakpoint:data[8][0],canDebug:data[8][1]}:null;if(data[0]===-1)_this111._systemPlugin=_this111._runtime.GetSystemPlugin();else{_this111._objectClass=_this111._runtime.GetObjectClassByIndex(data[0]);if(data[2]){_this111._behaviorType=_this111._objectClass.GetBehaviorTypeByName(data[2]);_this111._behaviorIndex=_this111._objectClass.GetBehaviorIndexByName(data[2]);}if(_this111._eventBlock.GetParent())_this111._eventBlock.GetParent().SetSolWriterAfterCnds();}if(data.length===10){var paramData=data[9];var _iteratorNormalCompletion387=true;var _didIteratorError387=false;var _iteratorError387=undefined;try{for(var _iterator387=paramData[Symbol.iterator](),_step387;!(_iteratorNormalCompletion387=(_step387=_iterator387.next()).done);_iteratorNormalCompletion387=true){var _data=_step387.value;_this111._parameters.push(_C150.Parameter.Create(_assertThisInitialized(_this111),_data,_this111._parameters.length));_this111._results.push(0);}}catch(err){_didIteratorError387=true;_iteratorError387=err;}finally{try{if(!_iteratorNormalCompletion387&&_iterator387["return"]!=null){_iterator387["return"]();}}finally{if(_didIteratorError387){throw _iteratorError387;}}}}if(_this111._parameters.length===0){_this111._parameters=EMPTY_PARAMS_ARRAY;_this111._results=EMPTY_PARAMS_ARRAY;}_this111._eventBlock.GetEventSheetManager()._RegisterCondition(_assertThisInitialized(_this111));return _this111;}_createClass(Condition,[{key:"_PostInit",value:function _PostInit(){var _iteratorNormalCompletion388=true;var _didIteratorError388=false;var _iteratorError388=undefined;try{for(var _iterator388=this._parameters[Symbol.iterator](),_step388;!(_iteratorNormalCompletion388=(_step388=_iterator388.next()).done);_iteratorNormalCompletion388=true){var param=_step388.value;param._PostInit();if(param.VariesPerInstance())this._anyParamVariesPerInstance=true;}}catch(err){_didIteratorError388=true;_iteratorError388=err;}finally{try{if(!_iteratorNormalCompletion388&&_iterator388["return"]!=null){_iterator388["return"]();}}finally{if(_didIteratorError388){throw _iteratorError388;}}}if(this._isFastTrigger){this.Run=this._RunFastTrigger;this.DebugRun=this._DebugRunFastTrigger;}else if(this._systemPlugin){this._SetSystemRunMethod();this.DebugRun=this._DebugRunSystem;}else if(this._objectClass.GetPlugin().IsSingleGlobal()){this._SetSingleGlobalRunMethod();this.DebugRun=this._DebugRunSingleGlobal;}else if(this._isStatic){this.Run=this._RunStatic;this.DebugRun=this._DebugRunStatic;}else{this.Run=this._RunObject;this.DebugRun=this._DebugRunObject;}}},{key:"_SetSystemRunMethod",value:function _SetSystemRunMethod(){var plugin=this._systemPlugin;var bindThis=this._systemPlugin;this._SetRunMethodForBoundFunc(plugin,bindThis,this._RunSystem);}},{key:"_SetSingleGlobalRunMethod",value:function _SetSingleGlobalRunMethod(){var plugin=this._objectClass.GetPlugin();var bindThis=this._objectClass.GetSingleGlobalInstance().GetSdkInstance();this._SetRunMethodForBoundFunc(plugin,bindThis,this._RunSingleGlobal);}},{key:"_SetRunMethodForBoundFunc",value:function _SetRunMethodForBoundFunc(plugin,bindThis,fallbackMethod){var func=this._func;var isInverted=this._isInverted;var parameters=this._parameters;if(parameters.length===0){var boundFunc=plugin._GetBoundACEMethod(func,bindThis);if(isInverted)this.Run=function RunSingleCnd_0param(){return _C150.xor(boundFunc(),isInverted);};else this.Run=boundFunc;}else if(parameters.length===1){var param0=parameters[0];if(!isInverted&&param0.IsConstant())this.Run=plugin._GetBoundACEMethod_1param(func,bindThis,param0.Get(0));else{var _boundFunc=plugin._GetBoundACEMethod(func,bindThis);this.Run=function RunSingleCnd_1param(){return _C150.xor(_boundFunc(param0.Get(0)),isInverted);};}}else if(parameters.length===2){var _param=parameters[0];var param1=parameters[1];if(!isInverted&&_param.IsConstant()&&param1.IsConstant())this.Run=plugin._GetBoundACEMethod_2params(func,bindThis,_param.Get(0),param1.Get(0));else{var _boundFunc2=plugin._GetBoundACEMethod(func,bindThis);this.Run=function RunSingleCnd_2params(){return _C150.xor(_boundFunc2(_param.Get(0),param1.Get(0)),isInverted);};}}else if(parameters.length===3){var _param2=parameters[0];var _param3=parameters[1];var param2=parameters[2];if(!isInverted&&_param2.IsConstant()&&_param3.IsConstant()&&param2.IsConstant())this.Run=plugin._GetBoundACEMethod_3params(func,bindThis,_param2.Get(0),_param3.Get(0),param2.Get(0));else{var _boundFunc3=plugin._GetBoundACEMethod(func,bindThis);this.Run=function RunSingleCnd_3params(){return _C150.xor(_boundFunc3(_param2.Get(0),_param3.Get(0),param2.Get(0)),isInverted);};}}else this.Run=fallbackMethod;}},{key:"GetSID",value:function GetSID(){return this._sid;}},{key:"_GetFunc",value:function _GetFunc(){return this._func;}},{key:"GetObjectClass",value:function GetObjectClass(){return this._objectClass;}},{key:"GetBehaviorType",value:function GetBehaviorType(){return this._behaviorType;}},{key:"GetEventBlock",value:function GetEventBlock(){return this._eventBlock;}},{key:"GetRuntime",value:function GetRuntime(){return this._runtime;}},{key:"GetIndex",value:function GetIndex(){return this._index;}},{key:"GetDebugIndex",value:function GetDebugIndex(){return this.GetIndex();}},{key:"IsTrigger",value:function IsTrigger(){return this._isTrigger;}},{key:"IsFastTrigger",value:function IsFastTrigger(){return this._isFastTrigger;}},{key:"IsInverted",value:function IsInverted(){return this._isInverted;}},{key:"IsLooping",value:function IsLooping(){return this._isLooping;}},{key:"IsStatic",value:function IsStatic(){return this._isStatic;}},{key:"IsBreakpoint",value:function IsBreakpoint(){return this._debugData.isBreakpoint;}},{key:"IsSystemCondition",value:function IsSystemCondition(){return!!this._systemPlugin;}},{key:"GetFirstObjectParameterObjectClass",value:function GetFirstObjectParameterObjectClass(){var _iteratorNormalCompletion389=true;var _didIteratorError389=false;var _iteratorError389=undefined;try{for(var _iterator389=this._parameters[Symbol.iterator](),_step389;!(_iteratorNormalCompletion389=(_step389=_iterator389.next()).done);_iteratorNormalCompletion389=true){var p=_step389.value;if(p.IsObjectParameter())return p.GetObjectClass();}}catch(err){_didIteratorError389=true;_iteratorError389=err;}finally{try{if(!_iteratorNormalCompletion389&&_iterator389["return"]!=null){_iterator389["return"]();}}finally{if(_didIteratorError389){throw _iteratorError389;}}}return null;}},{key:"_SetBreakpoint",value:function _SetBreakpoint(b){this._debugData.isBreakpoint=!!b;this._eventBlock._UpdateCanRunFastRecursive();}},{key:"_DebugReturnsGenerator",value:function _DebugReturnsGenerator(){return this._debugData.canDebug;}},{key:"DebugCanRunFast",value:function DebugCanRunFast(){return!this.IsBreakpoint()&&!this._runtime.DebugBreakNext()&&!this._DebugReturnsGenerator();}},{key:"GetSavedDataMap",value:function GetSavedDataMap(){if(!this._savedData)this._savedData=new Map();return this._savedData;}},{key:"GetUnsavedDataMap",value:function GetUnsavedDataMap(){if(!this._unsavedData)this._unsavedData=new Map();return this._unsavedData;}},{key:"_RunSystem",value:function _RunSystem(){var results=this._results;EvalParams(this._parameters,results);return _C150.xor(this._func.apply(this._systemPlugin,results),this._isInverted);}},{key:"_DebugRunSystem",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugRunSystem(){var _results,ret;return regeneratorRuntime.wrap(function _DebugRunSystem$(_context134){while(1){switch(_context134.prev=_context134.next){case 0:if(!(this.IsBreakpoint()||this._runtime.DebugBreakNext())){_context134.next=3;break;}_context134.next=3;return this;case 3:if(!this._DebugReturnsGenerator()){_context134.next=13;break;}_results=this._results;EvalParams(this._parameters,_results);ret=this._func.apply(this._systemPlugin,_results);if(!_C150.IsIterator(ret)){_context134.next=10;break;}return _context134.delegateYield(ret,"t0",9);case 9:ret=_context134.t0;case 10:return _context134.abrupt("return",_C150.xor(ret,this._isInverted));case 13:return _context134.abrupt("return",this.Run());case 14:case"end":return _context134.stop();}}},_DebugRunSystem,this);})},{key:"_RunSingleGlobal",value:function _RunSingleGlobal(){var results=this._results;EvalParams(this._parameters,results);var inst=this._objectClass.GetSingleGlobalInstance().GetSdkInstance();return _C150.xor(this._func.apply(inst,results),this._isInverted);}},{key:"_DebugRunSingleGlobal",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugRunSingleGlobal(){var _results2,inst,ret;return regeneratorRuntime.wrap(function _DebugRunSingleGlobal$(_context135){while(1){switch(_context135.prev=_context135.next){case 0:if(!(this.IsBreakpoint()||this._runtime.DebugBreakNext())){_context135.next=3;break;}_context135.next=3;return this;case 3:if(!this._DebugReturnsGenerator()){_context135.next=14;break;}_results2=this._results;EvalParams(this._parameters,_results2);inst=this._objectClass.GetSingleGlobalInstance().GetSdkInstance();ret=this._func.apply(inst,_results2);if(!_C150.IsIterator(ret)){_context135.next=11;break;}return _context135.delegateYield(ret,"t0",10);case 10:ret=_context135.t0;case 11:return _context135.abrupt("return",_C150.xor(ret,this._isInverted));case 14:return _context135.abrupt("return",this.Run());case 15:case"end":return _context135.stop();}}},_DebugRunSingleGlobal,this);})},{key:"_RunFastTrigger",value:function _RunFastTrigger(){return true;}},{key:"_DebugRunFastTrigger",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugRunFastTrigger(){return regeneratorRuntime.wrap(function _DebugRunFastTrigger$(_context136){while(1){switch(_context136.prev=_context136.next){case 0:if(!(this.IsBreakpoint()||this._runtime.DebugBreakNext())){_context136.next=3;break;}_context136.next=3;return this;case 3:return _context136.abrupt("return",true);case 4:case"end":return _context136.stop();}}},_DebugRunFastTrigger,this);})},{key:"_RunStatic",value:function _RunStatic(){var results=this._results;EvalParams(this._parameters,results);var ret=this._func.apply(this._behaviorType||this._objectClass,results);this._objectClass.ApplySolToContainer();return ret;}},{key:"_DebugRunStatic",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugRunStatic(){var _results3,ret;return regeneratorRuntime.wrap(function _DebugRunStatic$(_context137){while(1){switch(_context137.prev=_context137.next){case 0:if(!(this.IsBreakpoint()||this._runtime.DebugBreakNext())){_context137.next=3;break;}_context137.next=3;return this;case 3:if(!this._DebugReturnsGenerator()){_context137.next=14;break;}_results3=this._results;EvalParams(this._parameters,_results3);ret=this._func.apply(this._behaviorType||this._objectClass,_results3);if(!_C150.IsIterator(ret)){_context137.next=10;break;}return _context137.delegateYield(ret,"t0",9);case 9:ret=_context137.t0;case 10:this._objectClass.ApplySolToContainer();return _context137.abrupt("return",ret);case 14:return _context137.abrupt("return",this.Run());case 15:case"end":return _context137.stop();}}},_DebugRunStatic,this);})},{key:"_RunObject",value:function _RunObject(){var parameters=this._parameters;var results=this._results;var sol=this._objectClass.GetCurrentSol();for(var i=0,len=parameters.length;i<len;++i){var p=parameters[i];if(!p.VariesPerInstance())results[i]=p.Get(0);}if(sol.IsSelectAll())return this._RunObject_FirstFilter(sol);else return this._RunObject_NextFilter(sol);}},{key:"_DebugRunObject",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugRunObject(){return regeneratorRuntime.wrap(function _DebugRunObject$(_context138){while(1){switch(_context138.prev=_context138.next){case 0:if(!(this.IsBreakpoint()||this._runtime.DebugBreakNext())){_context138.next=3;break;}_context138.next=3;return this;case 3:return _context138.abrupt("return",this._RunObject());case 4:case"end":return _context138.stop();}}},_DebugRunObject,this);})},{key:"_EvaluateVaryingParameters",value:function _EvaluateVaryingParameters(solIndex){var parameters=this._parameters;var results=this._results;for(var i=0,len=parameters.length;i<len;++i){var p=parameters[i];if(p.VariesPerInstance())results[i]=p.Get(solIndex);}}},{key:"_RunObject_FirstFilter",value:function _RunObject_FirstFilter(sol){var objectClass=this._objectClass;var isFamily=objectClass.IsFamily();var familyIndex=objectClass.GetFamilyIndex();var behaviorIndex=this._behaviorIndex;var isBehavior=behaviorIndex>=0;var allInstances=objectClass.GetInstances();var paramsVary=this._anyParamVariesPerInstance;var results=this._results;var func=this._func;var isInverted=this._isInverted;var isInOrBlock=this._isInOrBlock&&!this._isTrigger;sol.ClearArrays();for(var i=0,len=allInstances.length;i<len;++i){var inst=allInstances[i];if(paramsVary)this._EvaluateVaryingParameters(i);var ret=void 0;if(isBehavior){var offset=isFamily?inst.GetObjectClass().GetFamilyBehaviorOffset(familyIndex):0;ret=func.apply(inst.GetBehaviorInstances()[behaviorIndex+offset].GetSdkInstance(),results);}else ret=func.apply(inst.GetSdkInstance(),results);if(_C150.xor(ret,isInverted))sol._PushInstance(inst);else if(isInOrBlock)sol._PushElseInstance(inst);}objectClass.FinishCondition(true);sol._SetSelectAll(false);objectClass.ApplySolToContainer();return sol.HasAnyInstances();}},{key:"_RunObject_NextFilter",value:function _RunObject_NextFilter(sol){var objectClass=this._objectClass;var isFamily=objectClass.IsFamily();var familyIndex=objectClass.GetFamilyIndex();var isInContainer=objectClass.IsInContainer();var behaviorIndex=this._behaviorIndex;var isBehavior=behaviorIndex>=0;var paramsVary=this._anyParamVariesPerInstance;var results=this._results;var func=this._func;var isInverted=this._isInverted;var isInOrBlock=this._isInOrBlock&&!this._isTrigger;var solInstances=sol._GetOwnInstances();var solElseInstances=sol._GetOwnElseInstances();var isUsingElseInstances=isInOrBlock&&!this._eventBlock.IsFirstConditionOfType(this);var arr=isUsingElseInstances?solElseInstances:solInstances;var k=0;var isAnyTrue=false;for(var i=0,len=arr.length;i<len;++i){var inst=arr[i];if(paramsVary)this._EvaluateVaryingParameters(i);var ret=void 0;if(isBehavior){var offset=isFamily?inst.GetObjectClass().GetFamilyBehaviorOffset(familyIndex):0;ret=func.apply(inst.GetBehaviorInstances()[behaviorIndex+offset].GetSdkInstance(),results);}else ret=func.apply(inst.GetSdkInstance(),results);if(_C150.xor(ret,isInverted)){isAnyTrue=true;if(isUsingElseInstances){solInstances.push(inst);if(isInContainer)inst._PushSiblingsToSolInstances();}else{arr[k]=inst;if(isInContainer)inst._SetSiblingsToSolInstancesIndex(k);++k;}}else if(isUsingElseInstances){arr[k]=inst;if(isInContainer)inst._SetSiblingsToSolElseInstancesIndex(k);++k;}else if(isInOrBlock){solElseInstances.push(inst);if(isInContainer)inst._PushSiblingsToSolElseInstances();}}_C150.truncateArray(arr,k);if(isInContainer)objectClass._TruncateContainerSols(isUsingElseInstances,k);var pickInFinish=isAnyTrue;if(isUsingElseInstances&&!isAnyTrue)isAnyTrue=this._OrBlockCheckInstances(solInstances);objectClass.FinishCondition(pickInFinish||isInOrBlock);return isInOrBlock?isAnyTrue:sol.HasAnyInstances();}},{key:"_OrBlockCheckInstances",value:function _OrBlockCheckInstances(solInstances){var objectClass=this._objectClass;var isFamily=objectClass.IsFamily();var familyIndex=objectClass.GetFamilyIndex();var paramsVary=this._anyParamVariesPerInstance;var behaviorIndex=this._behaviorIndex;var isBehavior=behaviorIndex>=0;var results=this._results;var func=this._func;var isInverted=this._isInverted;for(var i=0,len=solInstances.length;i<len;++i){var inst=solInstances[i];if(paramsVary)this._EvaluateVaryingParameters(i);var ret=void 0;if(isBehavior){var offset=isFamily?inst.GetObjectClass().GetFamilyBehaviorOffset(familyIndex):0;ret=func.apply(inst.GetBehaviorInstances()[behaviorIndex+offset].GetSdkInstance(),results);}else ret=func.apply(inst.GetSdkInstance(),results);if(_C150.xor(ret,isInverted))return true;}return false;}},{key:"ReevaluateParameter",value:function ReevaluateParameter(paramIndex,solIndex){return this._parameters[paramIndex].Get(solIndex);}},{key:"GetFastTriggerValue",value:function GetFastTriggerValue(){var parameters=this._parameters;if(!parameters.length)throw new Error("no parameters");return parameters[0]._GetFastTriggerValue();}},{key:"_SaveToJson",value:function _SaveToJson(){if(!this._savedData||!this._savedData.size)return null;var ex={};var _iteratorNormalCompletion390=true;var _didIteratorError390=false;var _iteratorError390=undefined;try{for(var _iterator390=this._savedData.entries()[Symbol.iterator](),_step390;!(_iteratorNormalCompletion390=(_step390=_iterator390.next()).done);_iteratorNormalCompletion390=true){var _step390$value=_slicedToArray(_step390.value,2),k=_step390$value[0],v=_step390$value[1];var saveVal=v;if(k==="collmemory")saveVal=_toConsumableArray(v.entries()).map(function(arr){return[arr[0].GetUID(),arr[1].GetUID(),arr[2]];});ex[k]=saveVal;}}catch(err){_didIteratorError390=true;_iteratorError390=err;}finally{try{if(!_iteratorNormalCompletion390&&_iterator390["return"]!=null){_iterator390["return"]();}}finally{if(_didIteratorError390){throw _iteratorError390;}}}return{"ex":ex};}},{key:"_LoadFromJson",value:function _LoadFromJson(o){if(this._savedData){this._savedData.clear();this._savedData=null;}if(!o)return;var runtime=this._runtime;var ex=o["ex"];if(ex){var _map14=this.GetSavedDataMap();_map14.clear();for(var _i48=0,_Object$entries14=Object.entries(ex);_i48<_Object$entries14.length;_i48++){var _Object$entries14$_i=_slicedToArray(_Object$entries14[_i48],2),k=_Object$entries14$_i[0],v=_Object$entries14$_i[1];var loadVal=v;if(k==="collmemory")loadVal=_C150.New(_C150.PairMap,v.map(function(arr){return[runtime.GetInstanceByUID(arr[0]),runtime.GetInstanceByUID(arr[1]),arr[2]];}).filter(function(arr){return arr[0]&&arr[1];}));_map14.set(k,loadVal);}}}}],[{key:"Create",value:function Create(eventBlock,data,index){return _C150.New(_C150.Condition,eventBlock,data,index);}}]);return Condition;}(_C150.DefendedBase);}// events/action.js
{var _EvalParams=function _EvalParams(parameters,results){for(var i=0,len=parameters.length;i<len;++i){results[i]=parameters[i].Get(0);}};'use strict';var _C151=self.C3;var _assert15=self.assert;var _EMPTY_PARAMS_ARRAY=[];var _noop=function _noop(){};var noopGenerator=/*#__PURE__*/regeneratorRuntime.mark(function noopGenerator(){return regeneratorRuntime.wrap(function noopGenerator$(_context139){while(1){switch(_context139.prev=_context139.next){case 0:case"end":return _context139.stop();}}},noopGenerator);});var FLAG_CANPICKANYOBJECTCLASS=1;var FLAG_COPYPICKED=2;var FLAG_CUSTOM_ACE=4;_C151.Action=/*#__PURE__*/function(_C151$DefendedBase){_inherits(Action,_C151$DefendedBase);function Action(eventBlock,data,index){var _this112;_classCallCheck(this,Action);_this112=_possibleConstructorReturn(this,_getPrototypeOf(Action).call(this));_this112._eventBlock=eventBlock;var runtime=eventBlock.GetRuntime();_this112._runtime=runtime;_this112._index=index;_this112._sid=data.length>=4?data[3]:-1;_this112._actionType=data.length>=5?data[4]&255:0;_this112._flags=data.length>=5?data[4]>>8:0;_this112._func=null;_this112._objectClass=null;_this112._behaviorType=null;_this112._behaviorIndex=-1;_this112._systemPlugin=null;_this112._callFunctionName="";_this112._callCustomAceObjectClass=null;_this112._callEventBlock=null;_this112.Run=_noop;_this112.DebugRun=_noop;_this112._parameters=[];_this112._results=[];_this112._anyParamVariesPerInstance=false;_this112._savedData=null;_this112._unsavedData=null;var isScript=data[0]===-3;var debugInfo=isScript?data[2]:data[5];_this112._debugData=runtime.IsDebug()||isScript?{isBreakpoint:debugInfo[0],canDebug:debugInfo[1],index:debugInfo[2]}:null;if(data[0]===-1){_this112._systemPlugin=runtime.GetSystemPlugin();_this112._func=runtime.GetObjectReference(data[1]);}else if(data[0]===-2)_this112._callFunctionName=data[1];else if(isScript){var userMethod=runtime.GetObjectReference(data[1]);_this112._func=userMethod;_this112.Run=_this112.RunUserScript;_this112.DebugRun=_this112.DebugRunUserScript;_this112._actionType=1;}else{_this112._objectClass=runtime.GetObjectClassByIndex(data[0]);if(_this112._flags&FLAG_CUSTOM_ACE){_this112._callFunctionName=data[1];_this112._callCustomAceObjectClass=runtime.GetObjectClassByIndex(data[2]);}else{if(data[2]){_this112._behaviorType=_this112._objectClass.GetBehaviorTypeByName(data[2]);_this112._behaviorIndex=_this112._objectClass.GetBehaviorIndexByName(data[2]);}_this112._func=runtime.GetObjectReference(data[1]);}}if(data.length===7){var paramData=data[6];var _iteratorNormalCompletion391=true;var _didIteratorError391=false;var _iteratorError391=undefined;try{for(var _iterator391=paramData[Symbol.iterator](),_step391;!(_iteratorNormalCompletion391=(_step391=_iterator391.next()).done);_iteratorNormalCompletion391=true){var _data2=_step391.value;_this112._parameters.push(_C151.Parameter.Create(_assertThisInitialized(_this112),_data2,_this112._parameters.length));_this112._results.push(0);}}catch(err){_didIteratorError391=true;_iteratorError391=err;}finally{try{if(!_iteratorNormalCompletion391&&_iterator391["return"]!=null){_iterator391["return"]();}}finally{if(_didIteratorError391){throw _iteratorError391;}}}}if(_this112._parameters.length===0){_this112._parameters=_EMPTY_PARAMS_ARRAY;_this112._results=_EMPTY_PARAMS_ARRAY;}if(_this112.CanPickAnyObjectClass()){_this112._eventBlock.SetAllSolModifiers();_this112._eventBlock.SetSolWriterAfterCnds();}_this112._eventBlock.GetEventSheetManager()._RegisterAction(_assertThisInitialized(_this112));return _this112;}_createClass(Action,[{key:"_PostInit",value:function _PostInit(){var _iteratorNormalCompletion392=true;var _didIteratorError392=false;var _iteratorError392=undefined;try{for(var _iterator392=this._parameters[Symbol.iterator](),_step392;!(_iteratorNormalCompletion392=(_step392=_iterator392.next()).done);_iteratorNormalCompletion392=true){var param=_step392.value;param._PostInit();if(param.VariesPerInstance())this._anyParamVariesPerInstance=true;}}catch(err){_didIteratorError392=true;_iteratorError392=err;}finally{try{if(!_iteratorNormalCompletion392&&_iterator392["return"]!=null){_iterator392["return"]();}}finally{if(_didIteratorError392){throw _iteratorError392;}}}if(this._systemPlugin){this._SetSystemRunMethod();this.DebugRun=this._DebugRunSystem;}else if(this._callFunctionName){if(this._flags&FLAG_CUSTOM_ACE)this._SetCallCustomActionRunMethod();else this._SetCallFunctionRunMethod();this._callFunctionName="";this._callCustomAceObjectClass=null;}else if(this.Run===this.RunUserScript){var userMethod=this._func;var localVars=this._runtime.GetEventSheetManager()._GetLocalVariablesScriptInterface(this._eventBlock);this._func=userMethod.bind(null,this._runtime.GetIRuntime(),localVars);}else if(this._behaviorType){if(this.IsAsync()){this.Run=this._RunBehavior_Async;this.DebugRun=this._DebugRunBehavior_Async;}else{this.Run=this._RunBehavior;this.DebugRun=this._DebugRunBehavior;}}else if(this._objectClass.GetPlugin().IsSingleGlobal()){this._SetSingleGlobalRunMethod();this.DebugRun=this._DebugRunSingleGlobal;}else if(this.IsAsync()){this.Run=this._RunObject_Async;this.DebugRun=this._DebugRunObject_Async;}else if(this.CallBeforeAfterHooks()){this.Run=this._RunObject_BeforeAfterHooks;this.DebugRun=this._DebugRunObject_BeforeAfterHooks;}else if(!this._parameters.length){this.Run=this._RunObject_ParamsConst;this.DebugRun=this._DebugRunObject_ParamsConst;}else if(this._parameters.every(function(p){return p.VariesPerInstance();})){this.Run=this._RunObject_AllParamsVary;this.DebugRun=this._DebugRunObject_AllParamsVary;}else if(this._anyParamVariesPerInstance){this.Run=this._RunObject_SomeParamsVary;this.DebugRun=this._DebugRunObject_SomeParamsVary;}else if(this._parameters.every(function(p){return p.IsConstant();})){_EvalParams(this._parameters,this._results);this.Run=this._RunObject_ParamsConst;this.DebugRun=this._DebugRunObject_ParamsConst;}else{this.Run=this._RunObject_ParamsDontVary;this.DebugRun=this._DebugRunObject_ParamsDontVary;}}},{key:"_SetSystemRunMethod",value:function _SetSystemRunMethod(){var plugin=this._systemPlugin;var bindThis=this._systemPlugin;this._SetRunMethodForBoundFunc(plugin,bindThis,this._RunSystem);}},{key:"_SetSingleGlobalRunMethod",value:function _SetSingleGlobalRunMethod(){var plugin=this._objectClass.GetPlugin();var bindThis=this._objectClass.GetSingleGlobalInstance().GetSdkInstance();this._SetRunMethodForBoundFunc(plugin,bindThis,this._RunSingleGlobal);}},{key:"_SetCallFunctionRunMethod",value:function _SetCallFunctionRunMethod(){var eventSheetManager=this._eventBlock.GetEventSheetManager();var functionBlock=eventSheetManager.GetFunctionBlockByName(this._callFunctionName);if(functionBlock.IsEnabled()){var isCopyPicked=(this._flags&FLAG_COPYPICKED)!==0;this._callEventBlock=functionBlock.GetEventBlock();var combinedSolModifiers=_toConsumableArray(new Set([].concat(_toConsumableArray(this._eventBlock.GetSolModifiersIncludingParents()),_toConsumableArray(this._callEventBlock.GetSolModifiersIncludingParents()))));combinedSolModifiers=eventSheetManager._DeduplicateSolModifierList(combinedSolModifiers);var pickInfo=!functionBlock.IsCopyPicked()&&this._HasCopyPickedParent()?{pushCleanSolDynamic:true}:null;this.Run=_C151.EventBlock.prototype.RunAsFunctionCall.bind(this._callEventBlock,combinedSolModifiers,this._parameters,isCopyPicked,pickInfo);if(this._runtime.IsDebug()){var thiz=this;this.DebugRun=/*#__PURE__*/regeneratorRuntime.mark(function DebugRunCallFunction(){var ret;return regeneratorRuntime.wrap(function DebugRunCallFunction$(_context140){while(1){switch(_context140.prev=_context140.next){case 0:if(!(thiz.IsBreakpoint()||thiz._runtime.DebugBreakNext())){_context140.next=3;break;}_context140.next=3;return thiz;case 3:return _context140.delegateYield(thiz._callEventBlock.DebugRunAsFunctionCall(combinedSolModifiers,thiz._parameters,isCopyPicked,pickInfo),"t0",4);case 4:ret=_context140.t0;return _context140.abrupt("return",ret);case 6:case"end":return _context140.stop();}}},DebugRunCallFunction);});}else this.DebugRun=noopGenerator;}else{this.Run=_noop;this.DebugRun=noopGenerator;}}},{key:"_SetCallCustomActionRunMethod",value:function _SetCallCustomActionRunMethod(){var eventSheetManager=this._eventBlock.GetEventSheetManager();var customAceBlock=eventSheetManager.GetCustomActionBlockByName(this._callCustomAceObjectClass,this._callFunctionName);if(customAceBlock.IsEnabled()){var isCopyPicked=(this._flags&FLAG_COPYPICKED)!==0;this._callEventBlock=customAceBlock.GetEventBlock();var combinedSolModifiers=_toConsumableArray(new Set([].concat(_toConsumableArray(this._eventBlock.GetSolModifiersIncludingParents()),_toConsumableArray(this._callEventBlock.GetSolModifiersIncludingParents()),[this._objectClass,customAceBlock.GetObjectClass()])));combinedSolModifiers=eventSheetManager._DeduplicateSolModifierList(combinedSolModifiers);var isOTtoOT=!this._objectClass.IsFamily()&&!customAceBlock.GetObjectClass().IsFamily();var isOTtoFamily=!this._objectClass.IsFamily()&&customAceBlock.GetObjectClass().IsFamily();var isFamilyToFamily=this._objectClass.IsFamily();var pickInfo=null;if(!customAceBlock.IsCopyPicked()&&this._HasCopyPickedParent()){pickInfo=pickInfo||{};pickInfo.pushCleanSolDynamic=true;}if(isOTtoFamily||!isCopyPicked){pickInfo=pickInfo||{};pickInfo.copyFromObjectClass=this._objectClass;pickInfo.copyToObjectClass=customAceBlock.GetObjectClass();}if(isOTtoOT||isOTtoFamily||isFamilyToFamily&&!customAceBlock.HasCustomACEOverrides())this.Run=_C151.EventBlock.prototype.RunAsFunctionCall.bind(this._callEventBlock,combinedSolModifiers,this._parameters,isCopyPicked,pickInfo);else if(isFamilyToFamily)this.Run=_C151.FunctionBlock.prototype.RunAsFamilyCustomActionWithOverrides.bind(customAceBlock,combinedSolModifiers,this._parameters);else;if(this._runtime.IsDebug()){var thiz=this;if(isOTtoOT||isOTtoFamily||isFamilyToFamily&&!customAceBlock.HasCustomACEOverrides())this.DebugRun=/*#__PURE__*/regeneratorRuntime.mark(function DebugRunCustomAction(){var ret;return regeneratorRuntime.wrap(function DebugRunCustomAction$(_context141){while(1){switch(_context141.prev=_context141.next){case 0:if(!(thiz.IsBreakpoint()||thiz._runtime.DebugBreakNext())){_context141.next=3;break;}_context141.next=3;return thiz;case 3:return _context141.delegateYield(thiz._callEventBlock.DebugRunAsFunctionCall(combinedSolModifiers,thiz._parameters,isCopyPicked,pickInfo),"t0",4);case 4:ret=_context141.t0;return _context141.abrupt("return",ret);case 6:case"end":return _context141.stop();}}},DebugRunCustomAction);});else if(isFamilyToFamily)this.DebugRun=/*#__PURE__*/regeneratorRuntime.mark(function DebugRunCustomAction(){var ret;return regeneratorRuntime.wrap(function DebugRunCustomAction$(_context142){while(1){switch(_context142.prev=_context142.next){case 0:if(!(thiz.IsBreakpoint()||thiz._runtime.DebugBreakNext())){_context142.next=3;break;}_context142.next=3;return thiz;case 3:return _context142.delegateYield(customAceBlock.DebugRunAsFamilyCustomActionWithOverrides(combinedSolModifiers,thiz._parameters),"t0",4);case 4:ret=_context142.t0;return _context142.abrupt("return",ret);case 6:case"end":return _context142.stop();}}},DebugRunCustomAction);});}else this.DebugRun=noopGenerator;}else{this.Run=_noop;this.DebugRun=noopGenerator;}}},{key:"_SetRunMethodForBoundFunc",value:function _SetRunMethodForBoundFunc(plugin,bindThis,fallbackMethod){var func=this._func;var parameters=this._parameters;if(parameters.length===0)this.Run=plugin._GetBoundACEMethod(func,bindThis);else if(parameters.length===1){var param0=parameters[0];if(param0.IsConstant())this.Run=plugin._GetBoundACEMethod_1param(func,bindThis,param0.Get(0));else{var boundFunc=plugin._GetBoundACEMethod(func,bindThis);this.Run=function RunSingleAct_1param(){return boundFunc(param0.Get(0));};}}else if(parameters.length===2){var _param4=parameters[0];var param1=parameters[1];if(_param4.IsConstant()&&param1.IsConstant())this.Run=plugin._GetBoundACEMethod_2params(func,bindThis,_param4.Get(0),param1.Get(0));else{var _boundFunc4=plugin._GetBoundACEMethod(func,bindThis);this.Run=function RunSingleAct_2params(){return _boundFunc4(_param4.Get(0),param1.Get(0));};}}else if(parameters.length===3){var _param5=parameters[0];var _param6=parameters[1];var param2=parameters[2];if(_param5.IsConstant()&&_param6.IsConstant()&&param2.IsConstant())this.Run=plugin._GetBoundACEMethod_3params(func,bindThis,_param5.Get(0),_param6.Get(0),param2.Get(0));else{var _boundFunc5=plugin._GetBoundACEMethod(func,bindThis);this.Run=function RunSingleAct_3params(){return _boundFunc5(_param5.Get(0),_param6.Get(0),param2.Get(0));};}}else this.Run=fallbackMethod;}},{key:"GetSID",value:function GetSID(){return this._sid;}},{key:"IsAsync",value:function IsAsync(){return this._actionType===1;}},{key:"CanBailOut",value:function CanBailOut(){return this._actionType===2;}},{key:"CallBeforeAfterHooks",value:function CallBeforeAfterHooks(){return this._actionType===3;}},{key:"CanPickAnyObjectClass",value:function CanPickAnyObjectClass(){return(this._flags&FLAG_CANPICKANYOBJECTCLASS)!==0;}},{key:"HasReturnType",value:function HasReturnType(){return this.IsAsync()||this.CanBailOut();}},{key:"GetObjectClass",value:function GetObjectClass(){return this._objectClass;}},{key:"GetEventBlock",value:function GetEventBlock(){return this._eventBlock;}},{key:"_HasCopyPickedParent",value:function _HasCopyPickedParent(){var parent=this._eventBlock;do{if(parent instanceof _C151.FunctionBlock&&parent.IsCopyPicked())return true;parent=parent.GetScopeParent();}while(parent);return false;}},{key:"GetRuntime",value:function GetRuntime(){return this._runtime;}},{key:"GetIndex",value:function GetIndex(){return this._index;}},{key:"GetDebugIndex",value:function GetDebugIndex(){return this._debugData.index;}},{key:"IsBreakpoint",value:function IsBreakpoint(){return this._debugData.isBreakpoint;}},{key:"_SetBreakpoint",value:function _SetBreakpoint(b){this._debugData.isBreakpoint=!!b;this._eventBlock._UpdateCanRunFastRecursive();}},{key:"_DebugReturnsGenerator",value:function _DebugReturnsGenerator(){return this._debugData.canDebug;}},{key:"DebugCanRunFast",value:function DebugCanRunFast(){return!this.IsBreakpoint()&&!this._runtime.DebugBreakNext()&&!this._DebugReturnsGenerator();}},{key:"GetSavedDataMap",value:function GetSavedDataMap(){if(!this._savedData)this._savedData=new Map();return this._savedData;}},{key:"GetUnsavedDataMap",value:function GetUnsavedDataMap(){if(!this._unsavedData)this._unsavedData=new Map();return this._unsavedData;}},{key:"_RunSystem",value:function _RunSystem(){var results=this._results;_EvalParams(this._parameters,results);return this._func.apply(this._systemPlugin,results);}},{key:"_DebugRunSystem",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugRunSystem(){var _results4,ret;return regeneratorRuntime.wrap(function _DebugRunSystem$(_context143){while(1){switch(_context143.prev=_context143.next){case 0:if(!(this.IsBreakpoint()||this._runtime.DebugBreakNext())){_context143.next=3;break;}_context143.next=3;return this;case 3:if(!this._DebugReturnsGenerator()){_context143.next=11;break;}_results4=this._results;_EvalParams(this._parameters,_results4);return _context143.delegateYield(this._func.apply(this._systemPlugin,_results4),"t0",7);case 7:ret=_context143.t0;return _context143.abrupt("return",ret);case 11:return _context143.abrupt("return",this.Run());case 12:case"end":return _context143.stop();}}},_DebugRunSystem,this);})},{key:"_RunSingleGlobal",value:function _RunSingleGlobal(){var results=this._results;_EvalParams(this._parameters,results);return this._func.apply(this._objectClass.GetSingleGlobalInstance().GetSdkInstance(),results);}},{key:"_DebugRunSingleGlobal",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugRunSingleGlobal(){var _results5,ret;return regeneratorRuntime.wrap(function _DebugRunSingleGlobal$(_context144){while(1){switch(_context144.prev=_context144.next){case 0:if(!(this.IsBreakpoint()||this._runtime.DebugBreakNext())){_context144.next=3;break;}_context144.next=3;return this;case 3:if(!this._DebugReturnsGenerator()){_context144.next=11;break;}_results5=this._results;_EvalParams(this._parameters,_results5);return _context144.delegateYield(this._func.apply(this._objectClass.GetSingleGlobalInstance().GetSdkInstance(),_results5),"t0",7);case 7:ret=_context144.t0;return _context144.abrupt("return",ret);case 11:return _context144.abrupt("return",this.Run());case 12:case"end":return _context144.stop();}}},_DebugRunSingleGlobal,this);})},{key:"_RunObject_ParamsConst",value:function _RunObject_ParamsConst(){var results=this._results;var instances=this._objectClass.GetCurrentSol().GetInstances();for(var i=0,len=instances.length;i<len;++i){this._func.apply(instances[i].GetSdkInstance(),results);}}},{key:"_DebugRunObject_ParamsConst",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugRunObject_ParamsConst(){var _results6,_instances3,i,len;return regeneratorRuntime.wrap(function _DebugRunObject_ParamsConst$(_context145){while(1){switch(_context145.prev=_context145.next){case 0:if(!(this.IsBreakpoint()||this._runtime.DebugBreakNext())){_context145.next=3;break;}_context145.next=3;return this;case 3:if(!this._DebugReturnsGenerator()){_context145.next=14;break;}_results6=this._results;_instances3=this._objectClass.GetCurrentSol().GetInstances();i=0,len=_instances3.length;case 7:if(!(i<len)){_context145.next=12;break;}return _context145.delegateYield(this._func.apply(_instances3[i].GetSdkInstance(),_results6),"t0",9);case 9:++i;_context145.next=7;break;case 12:_context145.next=15;break;case 14:this._RunObject_ParamsConst();case 15:case"end":return _context145.stop();}}},_DebugRunObject_ParamsConst,this);})},{key:"_RunObject_ParamsDontVary",value:function _RunObject_ParamsDontVary(){var results=this._results;_EvalParams(this._parameters,results);var instances=this._objectClass.GetCurrentSol().GetInstances();for(var i=0,len=instances.length;i<len;++i){this._func.apply(instances[i].GetSdkInstance(),results);}}},{key:"_DebugRunObject_ParamsDontVary",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugRunObject_ParamsDontVary(){var _results7,_instances4,i,len;return regeneratorRuntime.wrap(function _DebugRunObject_ParamsDontVary$(_context146){while(1){switch(_context146.prev=_context146.next){case 0:if(!(this.IsBreakpoint()||this._runtime.DebugBreakNext())){_context146.next=3;break;}_context146.next=3;return this;case 3:if(!this._DebugReturnsGenerator()){_context146.next=15;break;}_results7=this._results;_EvalParams(this._parameters,_results7);_instances4=this._objectClass.GetCurrentSol().GetInstances();i=0,len=_instances4.length;case 8:if(!(i<len)){_context146.next=13;break;}return _context146.delegateYield(this._func.apply(_instances4[i].GetSdkInstance(),_results7),"t0",10);case 10:++i;_context146.next=8;break;case 13:_context146.next=16;break;case 15:this._RunObject_ParamsDontVary();case 16:case"end":return _context146.stop();}}},_DebugRunObject_ParamsDontVary,this);})},{key:"_RunObject_AllParamsVary",value:function _RunObject_AllParamsVary(){var parameters=this._parameters;var results=this._results;var func=this._func;var instances=this._objectClass.GetCurrentSol().GetInstances();for(var i=0,len=instances.length;i<len;++i){var inst=instances[i];for(var j=0,lenj=parameters.length;j<lenj;++j){results[j]=parameters[j].Get(i);}func.apply(inst.GetSdkInstance(),results);}}},{key:"_DebugRunObject_AllParamsVary",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugRunObject_AllParamsVary(){var parameters,_results8,func,_instances5,i,len,inst,j,lenj;return regeneratorRuntime.wrap(function _DebugRunObject_AllParamsVary$(_context147){while(1){switch(_context147.prev=_context147.next){case 0:if(!(this.IsBreakpoint()||this._runtime.DebugBreakNext())){_context147.next=3;break;}_context147.next=3;return this;case 3:if(!this._DebugReturnsGenerator()){_context147.next=18;break;}parameters=this._parameters;_results8=this._results;func=this._func;_instances5=this._objectClass.GetCurrentSol().GetInstances();i=0,len=_instances5.length;case 9:if(!(i<len)){_context147.next=16;break;}inst=_instances5[i];for(j=0,lenj=parameters.length;j<lenj;++j){_results8[j]=parameters[j].Get(i);}return _context147.delegateYield(func.apply(inst.GetSdkInstance(),_results8),"t0",13);case 13:++i;_context147.next=9;break;case 16:_context147.next=19;break;case 18:this._RunObject_AllParamsVary();case 19:case"end":return _context147.stop();}}},_DebugRunObject_AllParamsVary,this);})},{key:"_RunObject_SomeParamsVary",value:function _RunObject_SomeParamsVary(){var parameters=this._parameters;var results=this._results;var func=this._func;var instances=this._objectClass.GetCurrentSol().GetInstances();for(var i=0,len=parameters.length;i<len;++i){var p=parameters[i];if(!p.VariesPerInstance())results[i]=p.Get(0);}for(var _i49=0,_len42=instances.length;_i49<_len42;++_i49){var inst=instances[_i49];for(var j=0,lenj=parameters.length;j<lenj;++j){var _p3=parameters[j];if(_p3.VariesPerInstance())results[j]=_p3.Get(_i49);}func.apply(inst.GetSdkInstance(),results);}}},{key:"_DebugRunObject_SomeParamsVary",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugRunObject_SomeParamsVary(){var parameters,_results9,func,_instances6,i,len,p,_i50,_len43,inst,j,lenj,_p4;return regeneratorRuntime.wrap(function _DebugRunObject_SomeParamsVary$(_context148){while(1){switch(_context148.prev=_context148.next){case 0:if(!(this.IsBreakpoint()||this._runtime.DebugBreakNext())){_context148.next=3;break;}_context148.next=3;return this;case 3:if(!this._DebugReturnsGenerator()){_context148.next=19;break;}parameters=this._parameters;_results9=this._results;func=this._func;_instances6=this._objectClass.GetCurrentSol().GetInstances();for(i=0,len=parameters.length;i<len;++i){p=parameters[i];if(!p.VariesPerInstance())_results9[i]=p.Get(0);}_i50=0,_len43=_instances6.length;case 10:if(!(_i50<_len43)){_context148.next=17;break;}inst=_instances6[_i50];for(j=0,lenj=parameters.length;j<lenj;++j){_p4=parameters[j];if(_p4.VariesPerInstance())_results9[j]=_p4.Get(_i50);}return _context148.delegateYield(func.apply(inst.GetSdkInstance(),_results9),"t0",14);case 14:++_i50;_context148.next=10;break;case 17:_context148.next=20;break;case 19:this._RunObject_SomeParamsVary();case 20:case"end":return _context148.stop();}}},_DebugRunObject_SomeParamsVary,this);})},{key:"_RunObject_BeforeAfterHooks",value:function _RunObject_BeforeAfterHooks(){var parameters=this._parameters;var results=this._results;var func=this._func;var objectClass=this._objectClass;var sdkType=objectClass.GetSdkType();var instances=objectClass.GetCurrentSol().GetInstances();sdkType.BeforeRunAction(func);for(var i=0,len=instances.length;i<len;++i){var inst=instances[i];for(var j=0,lenj=parameters.length;j<lenj;++j){results[j]=parameters[j].Get(i);}func.apply(inst.GetSdkInstance(),results);}sdkType.AfterRunAction(func);}},{key:"_DebugRunObject_BeforeAfterHooks",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugRunObject_BeforeAfterHooks(){var parameters,_results10,func,objectClass,sdkType,_instances7,i,len,inst,j,lenj;return regeneratorRuntime.wrap(function _DebugRunObject_BeforeAfterHooks$(_context149){while(1){switch(_context149.prev=_context149.next){case 0:if(!(this.IsBreakpoint()||this._runtime.DebugBreakNext())){_context149.next=3;break;}_context149.next=3;return this;case 3:if(!this._DebugReturnsGenerator()){_context149.next=22;break;}parameters=this._parameters;_results10=this._results;func=this._func;objectClass=this._objectClass;sdkType=objectClass.GetSdkType();_instances7=objectClass.GetCurrentSol().GetInstances();sdkType.BeforeRunAction(func);i=0,len=_instances7.length;case 12:if(!(i<len)){_context149.next=19;break;}inst=_instances7[i];for(j=0,lenj=parameters.length;j<lenj;++j){_results10[j]=parameters[j].Get(i);}return _context149.delegateYield(func.apply(inst.GetSdkInstance(),_results10),"t0",16);case 16:++i;_context149.next=12;break;case 19:sdkType.AfterRunAction(func);_context149.next=23;break;case 22:this._RunObject_BeforeAfterHooks();case 23:case"end":return _context149.stop();}}},_DebugRunObject_BeforeAfterHooks,this);})},{key:"_RunBehavior",value:function _RunBehavior(){var objectClass=this._objectClass;var isFamily=objectClass.IsFamily();var familyIndex=objectClass.GetFamilyIndex();var parameters=this._parameters;var paramsVary=this._anyParamVariesPerInstance;var results=this._results;var func=this._func;var behaviorIndex=this._behaviorIndex;var instances=objectClass.GetCurrentSol().GetInstances();for(var i=0,len=parameters.length;i<len;++i){var p=parameters[i];if(!p.VariesPerInstance())results[i]=p.Get(0);}for(var _i51=0,_len44=instances.length;_i51<_len44;++_i51){var inst=instances[_i51];if(paramsVary)for(var j=0,lenj=parameters.length;j<lenj;++j){var _p5=parameters[j];if(_p5.VariesPerInstance())results[j]=_p5.Get(_i51);}var offset=isFamily?inst.GetObjectClass().GetFamilyBehaviorOffset(familyIndex):0;func.apply(inst.GetBehaviorInstances()[behaviorIndex+offset].GetSdkInstance(),results);}}},{key:"_DebugRunBehavior",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugRunBehavior(){var objectClass,isFamily,familyIndex,parameters,paramsVary,_results11,func,behaviorIndex,_instances8,i,len,p,_i52,_len45,inst,j,lenj,_p6,offset;return regeneratorRuntime.wrap(function _DebugRunBehavior$(_context150){while(1){switch(_context150.prev=_context150.next){case 0:if(!(this.IsBreakpoint()||this._runtime.DebugBreakNext())){_context150.next=3;break;}_context150.next=3;return this;case 3:if(!this._DebugReturnsGenerator()){_context150.next=25;break;}objectClass=this._objectClass;isFamily=objectClass.IsFamily();familyIndex=objectClass.GetFamilyIndex();parameters=this._parameters;paramsVary=this._anyParamVariesPerInstance;_results11=this._results;func=this._func;behaviorIndex=this._behaviorIndex;_instances8=objectClass.GetCurrentSol().GetInstances();for(i=0,len=parameters.length;i<len;++i){p=parameters[i];if(!p.VariesPerInstance())_results11[i]=p.Get(0);}_i52=0,_len45=_instances8.length;case 15:if(!(_i52<_len45)){_context150.next=23;break;}inst=_instances8[_i52];if(paramsVary)for(j=0,lenj=parameters.length;j<lenj;++j){_p6=parameters[j];if(_p6.VariesPerInstance())_results11[j]=_p6.Get(_i52);}offset=isFamily?inst.GetObjectClass().GetFamilyBehaviorOffset(familyIndex):0;return _context150.delegateYield(func.apply(inst.GetBehaviorInstances()[behaviorIndex+offset].GetSdkInstance(),_results11),"t0",20);case 20:++_i52;_context150.next=15;break;case 23:_context150.next=26;break;case 25:this._RunBehavior();case 26:case"end":return _context150.stop();}}},_DebugRunBehavior,this);})},{key:"_RunObject_Async",value:function _RunObject_Async(){var parameters=this._parameters;var results=this._results;var func=this._func;var instances=this._objectClass.GetCurrentSol().GetInstances();var promises=[];for(var i=0,len=instances.length;i<len;++i){var inst=instances[i];for(var j=0,lenj=parameters.length;j<lenj;++j){results[j]=parameters[j].Get(i);}promises.push(func.apply(inst.GetSdkInstance(),results));}return Promise.all(promises);}},{key:"_DebugRunObject_Async",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugRunObject_Async(){var parameters,_results12,func,_instances9,_promises,i,len,inst,j,lenj;return regeneratorRuntime.wrap(function _DebugRunObject_Async$(_context151){while(1){switch(_context151.prev=_context151.next){case 0:if(!(this.IsBreakpoint()||this._runtime.DebugBreakNext())){_context151.next=3;break;}_context151.next=3;return this;case 3:if(!this._DebugReturnsGenerator()){_context151.next=23;break;}parameters=this._parameters;_results12=this._results;func=this._func;_instances9=this._objectClass.GetCurrentSol().GetInstances();_promises=[];i=0,len=_instances9.length;case 10:if(!(i<len)){_context151.next=20;break;}inst=_instances9[i];for(j=0,lenj=parameters.length;j<lenj;++j){_results12[j]=parameters[j].Get(i);}_context151.t0=_promises;return _context151.delegateYield(func.apply(inst.GetSdkInstance(),_results12),"t1",15);case 15:_context151.t2=_context151.t1;_context151.t0.push.call(_context151.t0,_context151.t2);case 17:++i;_context151.next=10;break;case 20:return _context151.abrupt("return",Promise.all(_promises));case 23:return _context151.abrupt("return",this._RunObject_Async());case 24:case"end":return _context151.stop();}}},_DebugRunObject_Async,this);})},{key:"_RunBehavior_Async",value:function _RunBehavior_Async(){var objectClass=this._objectClass;var isFamily=objectClass.IsFamily();var familyIndex=objectClass.GetFamilyIndex();var parameters=this._parameters;var results=this._results;var func=this._func;var behaviorIndex=this._behaviorIndex;var instances=objectClass.GetCurrentSol().GetInstances();var promises=[];for(var i=0,len=instances.length;i<len;++i){var inst=instances[i];for(var j=0,lenj=parameters.length;j<lenj;++j){results[j]=parameters[j].Get(i);}var offset=isFamily?inst.GetObjectClass().GetFamilyBehaviorOffset(familyIndex):0;promises.push(func.apply(inst.GetBehaviorInstances()[behaviorIndex+offset].GetSdkInstance(),results));}return Promise.all(promises);}},{key:"_DebugRunBehavior_Async",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugRunBehavior_Async(){var objectClass,isFamily,familyIndex,parameters,_results13,func,behaviorIndex,_instances10,_promises2,i,len,inst,j,lenj,offset;return regeneratorRuntime.wrap(function _DebugRunBehavior_Async$(_context152){while(1){switch(_context152.prev=_context152.next){case 0:if(!(this.IsBreakpoint()||this._runtime.DebugBreakNext())){_context152.next=3;break;}_context152.next=3;return this;case 3:if(!this._DebugReturnsGenerator()){_context152.next=28;break;}objectClass=this._objectClass;isFamily=objectClass.IsFamily();familyIndex=objectClass.GetFamilyIndex();parameters=this._parameters;_results13=this._results;func=this._func;behaviorIndex=this._behaviorIndex;_instances10=objectClass.GetCurrentSol().GetInstances();_promises2=[];i=0,len=_instances10.length;case 14:if(!(i<len)){_context152.next=25;break;}inst=_instances10[i];for(j=0,lenj=parameters.length;j<lenj;++j){_results13[j]=parameters[j].Get(i);}offset=isFamily?inst.GetObjectClass().GetFamilyBehaviorOffset(familyIndex):0;_context152.t0=_promises2;return _context152.delegateYield(func.apply(inst.GetBehaviorInstances()[behaviorIndex+offset].GetSdkInstance(),_results13),"t1",20);case 20:_context152.t2=_context152.t1;_context152.t0.push.call(_context152.t0,_context152.t2);case 22:++i;_context152.next=14;break;case 25:return _context152.abrupt("return",Promise.all(_promises2));case 28:return _context152.abrupt("return",this._RunBehavior_Async());case 29:case"end":return _context152.stop();}}},_DebugRunBehavior_Async,this);})},{key:"RunUserScript",value:function RunUserScript(){return regeneratorRuntime.async(function RunUserScript$(_context153){while(1){switch(_context153.prev=_context153.next){case 0:_context153.prev=0;_context153.next=3;return regeneratorRuntime.awrap(this._func());case 3:_context153.next=10;break;case 5:_context153.prev=5;_context153.t0=_context153["catch"](0);console.error("Unhandled exception running script %c".concat(this._eventBlock.GetEventSheet().GetName(),", event ").concat(this._eventBlock.GetDisplayNumber(),", action ").concat(this.GetDebugIndex()+1,":"),"font-size: 1.2em; font-weight: bold;",_context153.t0);if(self.C3Debugger)self.C3Debugger._SetLastErrorScript(this);if(!_C151.EventScript.HadUserScriptException()){console.info("%cTip:%c run this to highlight in Construct the last script that had an error: %cgoToLastErrorScript()","font-weight: bold; text-decoration: underline","","font-weight: bold");_C151.EventScript.SetHadUserScriptException();}case 10:case"end":return _context153.stop();}}},null,this,[[0,5]]);}},{key:"DebugRunUserScript",value:/*#__PURE__*/regeneratorRuntime.mark(function DebugRunUserScript(){return regeneratorRuntime.wrap(function DebugRunUserScript$(_context154){while(1){switch(_context154.prev=_context154.next){case 0:if(!(this.IsBreakpoint()||this._runtime.DebugBreakNext())){_context154.next=3;break;}_context154.next=3;return this;case 3:return _context154.abrupt("return",this.RunUserScript());case 4:case"end":return _context154.stop();}}},DebugRunUserScript,this);})},{key:"_SaveToJson",value:function _SaveToJson(){if(!this._savedData||!this._savedData.size)return null;return{"ex":_C151.ToSuperJSON(this._savedData)};}},{key:"_LoadFromJson",value:function _LoadFromJson(o){if(this._savedData){this._savedData.clear();this._savedData=null;}if(!o)return;var ex=o["ex"];if(ex)this._savedData=_C151.FromSuperJSON(ex);}}],[{key:"Create",value:function Create(eventBlock,data,index){return _C151.New(_C151.Action,eventBlock,data,index);}}]);return Action;}(_C151.DefendedBase);}// events/commonACEs.js
{var CompareX=function CompareX(cmp,x){return _C152.compare(this.GetWorldInfo().GetX(),cmp,x);};var CompareY=function CompareY(cmp,y){return _C152.compare(this.GetWorldInfo().GetY(),cmp,y);};var IsOnScreen=function IsOnScreen(){return this.GetWorldInfo().IsInViewport2();};var IsOutsideLayout=function IsOutsideLayout(){var wi=this.GetWorldInfo();var layout=wi.GetLayout();var bbox=wi.GetBoundingBox();return bbox.getRight()<0||bbox.getBottom()<0||bbox.getLeft()>layout.GetWidth()||bbox.getTop()>layout.GetHeight();};var PickDistance=function PickDistance(which,x,y){var sol=this.GetCurrentSol();var instances=sol.GetInstances();if(!instances.length)return false;var inst=instances[0];var wi=inst.GetWorldInfo();var pickme=inst;var dist2=_C152.distanceSquared(wi.GetX(),wi.GetY(),x,y);for(var i=1,len=instances.length;i<len;++i){inst=instances[i];wi=inst.GetWorldInfo();var d2=_C152.distanceSquared(wi.GetX(),wi.GetY(),x,y);if(which===0&&d2<dist2||which===1&&d2>dist2){dist2=d2;pickme=inst;}}sol.PickOne(pickme);return true;};var SetX=function SetX(x){var wi=this.GetWorldInfo();if(wi.GetX()===x)return;wi.SetX(x);wi.SetBboxChanged();};var SetY=function SetY(y){var wi=this.GetWorldInfo();if(wi.GetY()===y)return;wi.SetY(y);wi.SetBboxChanged();};var SetPos=function SetPos(x,y){var wi=this.GetWorldInfo();if(wi.EqualsXY(x,y))return;wi.SetXY(x,y);wi.SetBboxChanged();};var SetPosToObject=function SetPosToObject(objectClass,imgPt){if(!objectClass)return;var inst=objectClass.GetPairedInstance(this._inst);if(!inst)return;var _inst$GetImagePoint=inst.GetImagePoint(imgPt),_inst$GetImagePoint2=_slicedToArray(_inst$GetImagePoint,2),x=_inst$GetImagePoint2[0],y=_inst$GetImagePoint2[1];var wi=this.GetWorldInfo();if(wi.GetX()===x&&wi.GetY()===y)return;wi.SetXY(x,y);wi.SetBboxChanged();};var MoveForward=function MoveForward(dist){if(dist===0)return;var wi=this.GetWorldInfo();wi.OffsetXY(wi.GetCosAngle()*dist,wi.GetSinAngle()*dist);wi.SetBboxChanged();};var MoveAtAngle=function MoveAtAngle(a,dist){if(dist===0)return;var wi=this.GetWorldInfo();a=_C152.toRadians(a);wi.OffsetXY(Math.cos(a)*dist,Math.sin(a)*dist);wi.SetBboxChanged();};var GetX=function GetX(){return this.GetWorldInfo().GetX();};var GetY=function GetY(){return this.GetWorldInfo().GetY();};var GetDt=function GetDt(){return this._runtime.GetDt(this._inst);};var CompareWidth=function CompareWidth(cmp,w){return _C152.compare(this.GetWorldInfo().GetWidth(),cmp,w);};var CompareHeight=function CompareHeight(cmp,h){return _C152.compare(this.GetWorldInfo().GetHeight(),cmp,h);};var SetWidth=function SetWidth(w){var wi=this.GetWorldInfo();if(wi.GetWidth()===w)return;wi.SetWidth(w);wi.SetBboxChanged();};var SetHeight=function SetHeight(h){var wi=this.GetWorldInfo();if(wi.GetHeight()===h)return;wi.SetHeight(h);wi.SetBboxChanged();};var SetSize=function SetSize(w,h){var wi=this.GetWorldInfo();if(wi.GetWidth()===w&&wi.GetHeight()===h)return;wi.SetSize(w,h);wi.SetBboxChanged();};var GetWidth=function GetWidth(){return this.GetWorldInfo().GetWidth();};var GetHeight=function GetHeight(){return this.GetWorldInfo().GetHeight();};var GetBboxLeft=function GetBboxLeft(){return this.GetWorldInfo().GetBoundingBox().getLeft();};var GetBboxTop=function GetBboxTop(){return this.GetWorldInfo().GetBoundingBox().getTop();};var GetBboxRight=function GetBboxRight(){return this.GetWorldInfo().GetBoundingBox().getRight();};var GetBboxBottom=function GetBboxBottom(){return this.GetWorldInfo().GetBoundingBox().getBottom();};var GetBboxMidX=function GetBboxMidX(){var bbox=this.GetWorldInfo().GetBoundingBox();return(bbox.getLeft()+bbox.getRight())/2;};var GetBboxMidY=function GetBboxMidY(){var bbox=this.GetWorldInfo().GetBoundingBox();return(bbox.getTop()+bbox.getBottom())/2;};var IsAngleWithin=function IsAngleWithin(within,a){return _C152.angleDiff(this.GetWorldInfo().GetAngle(),_C152.toRadians(a))<=_C152.toRadians(within);};var IsAngleClockwiseFrom=function IsAngleClockwiseFrom(a){return _C152.angleClockwise(this.GetWorldInfo().GetAngle(),_C152.toRadians(a));};var IsBetweenAngles=function IsBetweenAngles(a,b){var lower=_C152.toRadians(a);var upper=_C152.toRadians(b);var angle=this.GetWorldInfo().GetAngle();var obtuse=!_C152.angleClockwise(upper,lower);if(obtuse)return!(!_C152.angleClockwise(angle,lower)&&_C152.angleClockwise(angle,upper));else return _C152.angleClockwise(angle,lower)&&!_C152.angleClockwise(angle,upper);};var SetAngle=function SetAngle(a){var wi=this.GetWorldInfo();var newAngle=_C152.clampAngle(_C152.toRadians(a));if(isNaN(newAngle)||wi.GetAngle()===newAngle)return;wi.SetAngle(newAngle);wi.SetBboxChanged();};var RotateClockwise=function RotateClockwise(a){if(isNaN(a)||a===0)return;var wi=this.GetWorldInfo();wi.SetAngle(wi.GetAngle()+_C152.toRadians(a));wi.SetBboxChanged();};var RotateCounterclockwise=function RotateCounterclockwise(a){if(isNaN(a)||a===0)return;var wi=this.GetWorldInfo();wi.SetAngle(wi.GetAngle()-_C152.toRadians(a));wi.SetBboxChanged();};var RotateTowardAngle=function RotateTowardAngle(amt,target){var wi=this.GetWorldInfo();var a=wi.GetAngle();var newAngle=_C152.angleRotate(a,_C152.toRadians(target),_C152.toRadians(amt));if(isNaN(newAngle)||a===newAngle)return;wi.SetAngle(newAngle);wi.SetBboxChanged();};var RotateTowardPosition=function RotateTowardPosition(amt,x,y){var wi=this.GetWorldInfo();var a=wi.GetAngle();var dx=x-wi.GetX();var dy=y-wi.GetY();var target=Math.atan2(dy,dx);var newAngle=_C152.angleRotate(a,target,_C152.toRadians(amt));if(isNaN(newAngle)||a===newAngle)return;wi.SetAngle(newAngle);wi.SetBboxChanged();};var SetTowardPosition=function SetTowardPosition(x,y){var wi=this.GetWorldInfo();var a=wi.GetAngle();var dx=x-wi.GetX();var dy=y-wi.GetY();var newAngle=Math.atan2(dy,dx);if(isNaN(newAngle)||a===newAngle)return;wi.SetAngle(newAngle);wi.SetBboxChanged();};var GetAngle=function GetAngle(){return _C152.toDegrees(this.GetWorldInfo().GetAngle());};var CompareOpacity=function CompareOpacity(cmp,x){return _C152.compare(_C152.roundToDp(this.GetWorldInfo().GetOpacity()*100,6),cmp,x);};var IsVisible=function IsVisible(){return this.GetWorldInfo().IsVisible();};var SetVisible=function SetVisible(v){var wi=this.GetWorldInfo();if(v===2)v=!wi.IsVisible();else v=v!==0;if(wi.IsVisible()===v)return;wi.SetVisible(v);this._runtime.UpdateRender();};var SetOpacity=function SetOpacity(o){var newOpacity=_C152.clamp(o/100,0,1);var wi=this.GetWorldInfo();if(wi.GetTransformWithParentOpacity()){if(wi._GetSceneGraphInfo().GetOwnOpacity()===newOpacity)return;}else if(wi.GetOpacity()===newOpacity)return;wi.SetOpacity(newOpacity);this._runtime.UpdateRender();};var SetDefaultColor=function SetDefaultColor(rgb){_tempColor5.setFromRgbValue(rgb);var wi=this.GetWorldInfo();if(wi.GetUnpremultipliedColor().equalsIgnoringAlpha(_tempColor5))return;wi.SetUnpremultipliedColor(_tempColor5);this._runtime.UpdateRender();};var GetColor=function GetColor(){var c=this.GetWorldInfo().GetUnpremultipliedColor();return _C152.PackRGBAEx(c.getR(),c.getG(),c.getB(),c.getA());};var GetOpacity=function GetOpacity(){return _C152.roundToDp(this.GetWorldInfo().GetOpacity()*100,6);};var IsOnLayer=function IsOnLayer(layer){if(!layer)return false;return this.GetWorldInfo().GetLayer()===layer;};var PickTopBottom=function PickTopBottom(which){var sol=this.GetCurrentSol();var instances=sol.GetInstances();if(!instances.length)return false;var inst=instances[0];var pickme=inst;for(var i=1,len=instances.length;i<len;++i){var _inst9=instances[i];var instWi=_inst9.GetWorldInfo();var pickmeWi=pickme.GetWorldInfo();var instLayerIndex=instWi.GetLayer().GetIndex();var pickmeLayerIndex=pickmeWi.GetLayer().GetIndex();if(which===0){if(instLayerIndex>pickmeLayerIndex||instLayerIndex===pickmeLayerIndex&&instWi.GetZIndex()>pickmeWi.GetZIndex())pickme=_inst9;}else if(instLayerIndex<pickmeLayerIndex||instLayerIndex===pickmeLayerIndex&&instWi.GetZIndex()<pickmeWi.GetZIndex())pickme=_inst9;}sol.PickOne(pickme);return true;};var CompareZElevation=function CompareZElevation(which,cmp,value){var wi=this.GetWorldInfo();var z=which===0?wi.GetZElevation():wi.GetTotalZElevation();return _C152.compare(z,cmp,value);};var MoveToTop=function MoveToTop(){this.GetWorldInfo().ZOrderMoveToTop();};var MoveToBottom=function MoveToBottom(){this.GetWorldInfo().ZOrderMoveToBottom();};var MoveToLayer=function MoveToLayer(layerMove){if(!layerMove)return;this.GetWorldInfo().ZOrderMoveToLayer(layerMove);};var ZMoveToObject=function ZMoveToObject(where,objectClass){var isAfter=where===0;if(!objectClass)return;var otherInst=objectClass.GetFirstPicked(this.GetInstance());if(!otherInst)return;this.GetWorldInfo().ZOrderMoveAdjacentToInstance(otherInst,isAfter);};var SetZElevation=function SetZElevation(z){var wi=this.GetWorldInfo();if(wi.GetZElevation()===z)return;wi.SetZElevation(z);this._runtime.UpdateRender();};var LayerNumber=function LayerNumber(){return this.GetWorldInfo().GetLayer().GetIndex();};var LayerName=function LayerName(){return this.GetWorldInfo().GetLayer().GetName();};var ZIndex=function ZIndex(){return this.GetWorldInfo().GetZIndex();};var ZElevation=function ZElevation(){return this.GetWorldInfo().GetZElevation();};var TotalZElevation=function TotalZElevation(){return this.GetWorldInfo().GetTotalZElevation();};var IsEffectEnabled=function IsEffectEnabled(effectName){var effectType=this.GetObjectClass().GetEffectList().GetEffectTypeByName(effectName);if(!effectType)return;var effectTypeIndex=effectType.GetIndex();var instFxList=this.GetWorldInfo().GetInstanceEffectList();return instFxList.IsEffectIndexActive(effectTypeIndex);};var SetEffectEnabled=function SetEffectEnabled(enabled,effectName){var effectType=this.GetObjectClass().GetEffectList().GetEffectTypeByName(effectName);if(!effectType)return;var effectTypeIndex=effectType.GetIndex();var e=enabled===1;var instFxList=this.GetWorldInfo().GetInstanceEffectList();if(instFxList.IsEffectIndexActive(effectTypeIndex)===e)return;instFxList.SetEffectIndexActive(effectTypeIndex,e);instFxList.UpdateActiveEffects();this._runtime.UpdateRender();};var SetEffectParam=function SetEffectParam(effectName,paramIndex,value){var effectType=this.GetObjectClass().GetEffectList().GetEffectTypeByName(effectName);if(!effectType)return;paramIndex=Math.floor(paramIndex);var paramType=effectType.GetShaderProgram().GetParameterType(paramIndex);if(!paramType)return;if(paramType==="color"){_tempColor5.setFromRgbValue(value);value=_tempColor5;}else if(paramType==="percent")value/=100;var effectTypeIndex=effectType.GetIndex();var instFxList=this.GetWorldInfo().GetInstanceEffectList();var didChange=instFxList.SetEffectParameter(effectTypeIndex,paramIndex,value);if(didChange&&instFxList.IsEffectIndexActive(effectTypeIndex))this._runtime.UpdateRender();};var CollMemory_Add=function CollMemory_Add(collMemory,a,b,tickCount){var a_uid=a.GetUID();var b_uid=b.GetUID();if(a_uid<b_uid)collMemory.Set(a,b,tickCount);else collMemory.Set(b,a,tickCount);};var CollMemory_Remove=function CollMemory_Remove(collMemory,a,b){var a_uid=a.GetUID();var b_uid=b.GetUID();if(a_uid<b_uid)collMemory.Delete(a,b);else collMemory.Delete(b,a);};var CollMemory_RemoveInstance=function CollMemory_RemoveInstance(collMemory,inst){collMemory.DeleteEither(inst);};var CollMemory_Get=function CollMemory_Get(collMemory,a,b){var a_uid=a.GetUID();var b_uid=b.GetUID();if(a_uid<b_uid)return collMemory.Get(a,b);else return collMemory.Get(b,a);};var DoOverlapCondition=function DoOverlapCondition(sdkInst,rtype,offX,offY){if(!rtype)return false;var inst=sdkInst.GetInstance();var hasOffset=offX!==0||offY!==0;var wi=inst.GetWorldInfo();var runtime=inst.GetRuntime();var collisionEngine=runtime.GetCollisionEngine();var cnd=runtime.GetCurrentCondition();var isOrBlock=cnd.GetEventBlock().IsOrBlock();var ltype=cnd.GetObjectClass();var isInverted=cnd.IsInverted();var rsol=rtype.GetCurrentSol();var isDifferentTypes=ltype!==rtype;rPickType=rtype;needsCollisionFinish=isDifferentTypes&&!isInverted;rPickFromElseInstances=false;var rinstances;var oldX=0;var oldY=0;var ret=false;if(rsol.IsSelectAll()){_tempRect4.copy(wi.GetBoundingBox());_tempRect4.offset(offX,offY);collisionEngine.GetCollisionCandidates(wi.GetLayer(),rtype,_tempRect4,tempCandidates2);rinstances=tempCandidates2;}else if(isOrBlock){if(runtime.IsCurrentConditionFirst()&&!rsol._GetOwnElseInstances().length&&rsol._GetOwnInstances().length)rinstances=rsol._GetOwnInstances();else{rinstances=rsol._GetOwnElseInstances();rPickFromElseInstances=true;}}else rinstances=rsol._GetOwnInstances();if(hasOffset){oldX=wi.GetX();oldY=wi.GetY();wi.OffsetXY(offX,offY);wi.SetBboxChanged();}var _iteratorNormalCompletion393=true;var _didIteratorError393=false;var _iteratorError393=undefined;try{for(var _iterator393=rinstances[Symbol.iterator](),_step393;!(_iteratorNormalCompletion393=(_step393=_iterator393.next()).done);_iteratorNormalCompletion393=true){var rinst=_step393.value;if(collisionEngine.TestOverlap(inst,rinst)){ret=true;if(isInverted)break;if(isDifferentTypes)rToPick.add(rinst);}}}catch(err){_didIteratorError393=true;_iteratorError393=err;}finally{try{if(!_iteratorNormalCompletion393&&_iterator393["return"]!=null){_iterator393["return"]();}}finally{if(_didIteratorError393){throw _iteratorError393;}}}if(hasOffset){wi.SetXY(oldX,oldY);wi.SetBboxChanged();}_C152.clearArray(tempCandidates2);return ret;};var FinishCollisionConditionPicking=function FinishCollisionConditionPicking(type){var isOrBlock=type.GetRuntime().GetCurrentEvent().IsOrBlock();var sol=rPickType.GetCurrentSol();var solInstances=sol._GetOwnInstances();var solElseInstances=sol._GetOwnElseInstances();if(sol.IsSelectAll()){sol.SetSetPicked(rToPick);if(isOrBlock){_C152.clearArray(solElseInstances);sol.AddElseInstances(rToPick,rPickType.GetInstances());}}else if(isOrBlock){if(rPickFromElseInstances)sol.TransferElseInstancesToOwn(rToPick);else{sol.AddElseInstances(rToPick,solInstances);sol.SetSetPicked(rToPick);}}else sol.SetSetPicked(rToPick);rPickType.ApplySolToContainer();};var FinishCollisionCondition=function FinishCollisionCondition(type,doPick){if(!needsCollisionFinish)return;if(doPick)FinishCollisionConditionPicking(type);rToPick.clear();rPickType=null;needsCollisionFinish=false;};var OnCollision=function OnCollision(rtype){if(this._runtime.IsDebugging())return DebugOnCollision.call(this,rtype);if(!rtype)return false;var runtime=this._runtime;var collisionEngine=runtime.GetCollisionEngine();var eventSheetManager=runtime.GetEventSheetManager();var eventStack=eventSheetManager.GetEventStack();var cnd=eventSheetManager.GetCurrentCondition();var ltype=cnd.GetObjectClass();var savedData=cnd.GetSavedDataMap();var unsavedData=cnd.GetUnsavedDataMap();var oldFrame=eventStack.GetCurrentStackFrame();var tickCount=runtime.GetTickCount();var lastTickCount=tickCount-1;var currentEvent=oldFrame.GetCurrentEvent();var newFrame=eventStack.Push(currentEvent);var collMemory=savedData.get("collmemory");if(!collMemory){collMemory=_C152.New(_C152.PairMap);savedData.set("collmemory",collMemory);}if(!unsavedData.get("collisionCreatedDestroyCallback")){unsavedData.set("collisionCreatedDestroyCallback",true);runtime.Dispatcher().addEventListener("instancedestroy",function(e){return CollMemory_RemoveInstance(collMemory,e.instance);});}var lsol=ltype.GetCurrentSol();var rsol=rtype.GetCurrentSol();var linstances=lsol.GetInstances();var rinstances=null;for(var l=0;l<linstances.length;++l){var linst=linstances[l];if(rsol.IsSelectAll()){collisionEngine.GetCollisionCandidates(linst.GetWorldInfo().GetLayer(),rtype,linst.GetWorldInfo().GetBoundingBox(),tempCandidates1);rinstances=tempCandidates1;collisionEngine.AddRegisteredCollisionCandidates(linst,rtype,rinstances);}else rinstances=rsol.GetInstances();for(var r=0;r<rinstances.length;++r){var rinst=rinstances[r];if(collisionEngine.TestOverlap(linst,rinst)||collisionEngine.CheckRegisteredCollision(linst,rinst)){var entry=CollMemory_Get(collMemory,linst,rinst);var entryExists=false;var lastCollTickCount=-2;if(typeof entry==="number"){entryExists=true;lastCollTickCount=entry;}var shouldRun=!entryExists||lastCollTickCount<lastTickCount;CollMemory_Add(collMemory,linst,rinst,tickCount);if(shouldRun){var solModifiers=currentEvent.GetSolModifiers();eventSheetManager.PushCopySol(solModifiers);var curlsol=ltype.GetCurrentSol();var currsol=rtype.GetCurrentSol();curlsol._SetSelectAll(false);currsol._SetSelectAll(false);if(ltype===rtype){var solInstances=curlsol._GetOwnInstances();_C152.clearArray(solInstances);solInstances.push(linst);solInstances.push(rinst);ltype.ApplySolToContainer();}else{var lsolInstances=curlsol._GetOwnInstances();var rsolInstances=currsol._GetOwnInstances();_C152.clearArray(lsolInstances);_C152.clearArray(rsolInstances);lsolInstances.push(linst);rsolInstances.push(rinst);ltype.ApplySolToContainer();rtype.ApplySolToContainer();}currentEvent.Retrigger(oldFrame,newFrame);eventSheetManager.PopSol(solModifiers);}}else CollMemory_Remove(collMemory,linst,rinst);}_C152.clearArray(tempCandidates1);}eventStack.Pop();return false;};var DebugOnCollision=/*#__PURE__*/regeneratorRuntime.mark(function DebugOnCollision(rtype){var runtime,collisionEngine,eventSheetManager,eventStack,cnd,ltype,savedData,unsavedData,oldFrame,tickCount,lastTickCount,currentEvent,newFrame,collMemory,lsol,rsol,linstances,rinstances,l,linst,r,rinst,entry,entryExists,lastCollTickCount,shouldRun,solModifiers,curlsol,currsol,solInstances,lsolInstances,rsolInstances;return regeneratorRuntime.wrap(function DebugOnCollision$(_context155){while(1){switch(_context155.prev=_context155.next){case 0:if(rtype){_context155.next=2;break;}return _context155.abrupt("return",false);case 2:runtime=this._runtime;collisionEngine=runtime.GetCollisionEngine();eventSheetManager=runtime.GetEventSheetManager();eventStack=eventSheetManager.GetEventStack();cnd=eventSheetManager.GetCurrentCondition();ltype=cnd.GetObjectClass();savedData=cnd.GetSavedDataMap();unsavedData=cnd.GetUnsavedDataMap();oldFrame=eventStack.GetCurrentStackFrame();tickCount=runtime.GetTickCount();lastTickCount=tickCount-1;currentEvent=oldFrame.GetCurrentEvent();newFrame=eventStack.Push(currentEvent);collMemory=savedData.get("collmemory");if(!collMemory){collMemory=_C152.New(_C152.PairMap);savedData.set("collmemory",collMemory);}if(!unsavedData.get("collisionCreatedDestroyCallback")){unsavedData.set("collisionCreatedDestroyCallback",true);runtime.Dispatcher().addEventListener("instancedestroy",function(e){return CollMemory_RemoveInstance(collMemory,e.instance);});}lsol=ltype.GetCurrentSol();rsol=rtype.GetCurrentSol();linstances=lsol.GetInstances();rinstances=null;l=0;case 23:if(!(l<linstances.length)){_context155.next=56;break;}linst=linstances[l];if(rsol.IsSelectAll()){collisionEngine.GetCollisionCandidates(linst.GetWorldInfo().GetLayer(),rtype,linst.GetWorldInfo().GetBoundingBox(),tempCandidates1);rinstances=tempCandidates1;collisionEngine.AddRegisteredCollisionCandidates(linst,rtype,rinstances);}else rinstances=rsol.GetInstances();r=0;case 27:if(!(r<rinstances.length)){_context155.next=52;break;}rinst=rinstances[r];if(!(collisionEngine.TestOverlap(linst,rinst)||collisionEngine.CheckRegisteredCollision(linst,rinst))){_context155.next=48;break;}entry=CollMemory_Get(collMemory,linst,rinst);entryExists=false;lastCollTickCount=-2;if(typeof entry==="number"){entryExists=true;lastCollTickCount=entry;}shouldRun=!entryExists||lastCollTickCount<lastTickCount;CollMemory_Add(collMemory,linst,rinst,tickCount);if(!shouldRun){_context155.next=46;break;}solModifiers=currentEvent.GetSolModifiers();eventSheetManager.PushCopySol(solModifiers);curlsol=ltype.GetCurrentSol();currsol=rtype.GetCurrentSol();curlsol._SetSelectAll(false);currsol._SetSelectAll(false);if(ltype===rtype){solInstances=curlsol._GetOwnInstances();_C152.clearArray(solInstances);solInstances.push(linst);solInstances.push(rinst);ltype.ApplySolToContainer();}else{lsolInstances=curlsol._GetOwnInstances();rsolInstances=currsol._GetOwnInstances();_C152.clearArray(lsolInstances);_C152.clearArray(rsolInstances);lsolInstances.push(linst);rsolInstances.push(rinst);ltype.ApplySolToContainer();rtype.ApplySolToContainer();}return _context155.delegateYield(currentEvent.DebugRetrigger(oldFrame,newFrame),"t0",45);case 45:eventSheetManager.PopSol(solModifiers);case 46:_context155.next=49;break;case 48:CollMemory_Remove(collMemory,linst,rinst);case 49:++r;_context155.next=27;break;case 52:_C152.clearArray(tempCandidates1);case 53:++l;_context155.next=23;break;case 56:eventStack.Pop();return _context155.abrupt("return",false);case 58:case"end":return _context155.stop();}}},DebugOnCollision,this);});var IsOverlapping=function IsOverlapping(rtype){return DoOverlapCondition(this,rtype,0,0);};var IsOverlappingOffset=function IsOverlappingOffset(rtype,offX,offY){return DoOverlapCondition(this,rtype,offX,offY);};var HasParent=function HasParent(){return this.GetWorldInfo().HasParent();};var HasChildren=function HasChildren(){return this.GetWorldInfo().HasChildren();};var PickParent=function PickParent(parentObjectClass,which){var mySol=this.GetCurrentSol();var myInstances=mySol.GetInstances();if(myInstances.length===0)return false;var parentSol=parentObjectClass.GetCurrentSol();var parentInstances=parentSol.GetInstances();if(parentSol.IsSelectAll()){var parentInstsPendingCreate=_toConsumableArray(this._runtime.instancesPendingCreateForObjectClass(parentObjectClass));if(parentInstsPendingCreate.length>0)parentInstances=parentInstances.concat(parentInstsPendingCreate);}if(parentInstances.length===0)return false;var parentInstancesSet=new Set(parentInstances);var pickParents=new Set();for(var i=0,len=myInstances.length;i<len;++i){var myInst=myInstances[i];if(which===1){var _iteratorNormalCompletion394=true;var _didIteratorError394=false;var _iteratorError394=undefined;try{for(var _iterator394=myInst.parents()[Symbol.iterator](),_step394;!(_iteratorNormalCompletion394=(_step394=_iterator394.next()).done);_iteratorNormalCompletion394=true){var parentInst=_step394.value;if(parentInst.BelongsToObjectClass(parentObjectClass)&&parentInstancesSet.has(parentInst))pickParents.add(parentInst);}}catch(err){_didIteratorError394=true;_iteratorError394=err;}finally{try{if(!_iteratorNormalCompletion394&&_iterator394["return"]!=null){_iterator394["return"]();}}finally{if(_didIteratorError394){throw _iteratorError394;}}}}else{var _parentInst=void 0;if(which===0){_parentInst=myInst.GetParent();if(_parentInst===null)continue;}else _parentInst=myInst.GetTopParent();if(_parentInst.BelongsToObjectClass(parentObjectClass)&&parentInstancesSet.has(_parentInst))pickParents.add(_parentInst);}}if(pickParents.size===0)return false;parentSol.SetSetPicked(pickParents);parentObjectClass.ApplySolToContainer();return true;};var PickChildren=function PickChildren(childObjectClass,which){var mySol=this.GetCurrentSol();var myInstances=mySol.GetInstances();if(myInstances.length===0)return false;var childSol=childObjectClass.GetCurrentSol();var childInstances=childSol.GetInstances();if(childSol.IsSelectAll()){var childInstsPendingCreate=_toConsumableArray(this._runtime.instancesPendingCreateForObjectClass(childObjectClass));if(childInstsPendingCreate.length>0)childInstances=childInstances.concat(childInstsPendingCreate);}if(childInstances.length===0)return false;var childInstancesSet=new Set(childInstances);var pickChildren=new Set();for(var i=0,len=myInstances.length;i<len;++i){var myInst=myInstances[i];if(which===2&&!myInst.HasChildren()&&myInst.BelongsToObjectClass(childObjectClass)&&childInstancesSet.has(myInst))pickChildren.add(myInst);var _iteratorNormalCompletion395=true;var _didIteratorError395=false;var _iteratorError395=undefined;try{for(var _iterator395=(which===0?myInst.children():myInst.allChildren())[Symbol.iterator](),_step395;!(_iteratorNormalCompletion395=(_step395=_iterator395.next()).done);_iteratorNormalCompletion395=true){var childInst=_step395.value;if(which===2&&childInst.HasChildren())continue;if(childInst.BelongsToObjectClass(childObjectClass)&&childInstancesSet.has(childInst))pickChildren.add(childInst);}}catch(err){_didIteratorError395=true;_iteratorError395=err;}finally{try{if(!_iteratorNormalCompletion395&&_iterator395["return"]!=null){_iterator395["return"]();}}finally{if(_didIteratorError395){throw _iteratorError395;}}}}if(pickChildren.size===0)return false;childSol.SetSetPicked(pickChildren);childObjectClass.ApplySolToContainer();return true;};var PickNthChild=function PickNthChild(childObjectClass,index){var mySol=this.GetCurrentSol();var myInstances=mySol.GetInstances();if(myInstances.length===0)return false;var childSol=childObjectClass.GetCurrentSol();var childInstances=childSol.GetInstances();if(childSol.IsSelectAll()){var childInstsPendingCreate=_toConsumableArray(this._runtime.instancesPendingCreateForObjectClass(childObjectClass));if(childInstsPendingCreate.length>0)childInstances=childInstances.concat(childInstsPendingCreate);}if(childInstances.length===0)return false;var childInstancesSet=new Set(childInstances);var pickChildren=[];for(var i=0,len=myInstances.length;i<len;++i){var myInst=myInstances[i];var childInst=myInst.GetChildAt(index);if(childInst!==null&&childInst.BelongsToObjectClass(childObjectClass)&&childInstancesSet.has(childInst))pickChildren.push(childInst);}if(pickChildren.length===0)return false;childSol.SetArrayPicked(pickChildren);childObjectClass.ApplySolToContainer();return true;};var CompareChildCount=function CompareChildCount(which,cmp,count){switch(which){case 0:default:{return _C152.compare(this._inst.GetChildCount(),cmp,count);}case 1:{return _C152.compare(this._inst.GetAllChildCount(),cmp,count);}}};var AddChild=function AddChild(childObjectClass,transformX,transformY,transformWidth,transformHeight,transformAngle,transformOpacity,transformZElevation,transformVisibility,destroyWithParent){var inst=this._inst;var actObjectClass=this._runtime.GetCurrentAction().GetObjectClass();var _iteratorNormalCompletion396=true;var _didIteratorError396=false;var _iteratorError396=undefined;try{for(var _iterator396=childObjectClass.allCorrespondingInstances(inst,actObjectClass)[Symbol.iterator](),_step396;!(_iteratorNormalCompletion396=(_step396=_iterator396.next()).done);_iteratorNormalCompletion396=true){var child=_step396.value;if(!child.GetPlugin().SupportsSceneGraph())return;inst.AddChild(child,{transformX:transformX,transformY:transformY,transformWidth:transformWidth,transformHeight:transformHeight,transformAngle:transformAngle,transformOpacity:transformOpacity,transformZElevation:transformZElevation,transformVisibility:transformVisibility,destroyWithParent:destroyWithParent});}}catch(err){_didIteratorError396=true;_iteratorError396=err;}finally{try{if(!_iteratorNormalCompletion396&&_iterator396["return"]!=null){_iterator396["return"]();}}finally{if(_didIteratorError396){throw _iteratorError396;}}}};var RemoveChild=function RemoveChild(childObjectClass){var inst=this._inst;var actObjectClass=this._runtime.GetCurrentAction().GetObjectClass();var _iteratorNormalCompletion397=true;var _didIteratorError397=false;var _iteratorError397=undefined;try{for(var _iterator397=childObjectClass.allCorrespondingInstances(inst,actObjectClass)[Symbol.iterator](),_step397;!(_iteratorNormalCompletion397=(_step397=_iterator397.next()).done);_iteratorNormalCompletion397=true){var child=_step397.value;inst.RemoveChild(child);}}catch(err){_didIteratorError397=true;_iteratorError397=err;}finally{try{if(!_iteratorNormalCompletion397&&_iterator397["return"]!=null){_iterator397["return"]();}}finally{if(_didIteratorError397){throw _iteratorError397;}}}};var RemoveFromParent=function RemoveFromParent(){if(!this._inst.HasParent())return;var parent=this._inst.GetParent();parent.RemoveChild(this._inst);};var ChildCount=function ChildCount(){return this._inst.GetChildCount();};var AllChildCount=function AllChildCount(){return this._inst.GetAllChildCount();};var SetMeshSize=function SetMeshSize(cols,rows){cols=Math.floor(cols);rows=Math.floor(rows);var wi=this.GetWorldInfo();if(cols<2||rows<2||!isFinite(cols)||!isFinite(rows)){wi.ReleaseMesh();wi.SetBboxChanged();}else wi.CreateMesh(cols,rows);};var SetMeshPoint=function SetMeshPoint(col,row,mode,posx,posy,zElevation,texu,texv){var wi=this.GetWorldInfo();var didBboxChange=wi.SetMeshPoint(col,row,{mode:mode===0?"absolute":"relative",x:posx,y:posy,zElevation:zElevation,u:texu,v:texv});if(didBboxChange)wi.SetBboxChanged();};var MeshColumns=function MeshColumns(){var wi=this.GetWorldInfo();return wi.HasMesh()?wi.GetSourceMesh().GetHSize():0;};var MeshRows=function MeshRows(){var wi=this.GetWorldInfo();return wi.HasMesh()?wi.GetSourceMesh().GetVSize():0;};var SetElementVisible=function SetElementVisible(v){var wi=this.GetWorldInfo();if(v===2)v=!wi.IsVisible();else v=v!==0;if(wi.IsVisible()===v)return;wi.SetVisible(v);};var SetElementCSSStyle=function SetElementCSSStyle(prop,val){this.SetElementCSSStyle(prop,val);};var SetElementAttribute=function SetElementAttribute(attribName,value){this.SetElementAttribute(attribName,""+value);};var RemoveElementAttribute=function RemoveElementAttribute(attribName){this.RemoveElementAttribute(attribName);};var SetElementFocus=function SetElementFocus(){this.FocusElement();};var SetElementBlur=function SetElementBlur(){this.BlurElement();};var IsElementFocused=function IsElementFocused(){return this.IsElementFocused();};var SetElementEnabled=function SetElementEnabled(e){this._SetEnabled(e!==0);};var IsElementEnabled=function IsElementEnabled(){return this._IsEnabled();};var CompareInstanceVar=function CompareInstanceVar(iv,cmp,val){return _C152.compare(this.GetInstance().GetInstanceVariableValue(iv),cmp,val);};var IsBoolInstanceVarSet=function IsBoolInstanceVarSet(iv){return!!this.GetInstance().GetInstanceVariableValue(iv);};var TemplateName=function TemplateName(){return this.GetInstance().GetTemplateName();};var PickInstVarHiLow=function PickInstVarHiLow(which,iv){var sol=this.GetCurrentSol();var instances=sol.GetInstances();if(!instances.length)return false;var isFamily=this.IsFamily();var pickInst=null;var bestVal=0;for(var i=0,len=instances.length;i<len;++i){var inst=instances[i];var offset=isFamily?inst.GetObjectClass().GetFamilyInstanceVariableOffset(this.GetFamilyIndex()):0;var v=inst.GetInstanceVariableValue(offset+iv);if(pickInst===null||which===0&&v<bestVal||which===1&&v>bestVal){bestVal=v;pickInst=inst;}}sol.PickOne(pickInst);return true;};var PickByUID=function PickByUID(uid){if(this._runtime.GetCurrentCondition().IsInverted())return PickByUID_Inverted(this,uid);else return PickByUID_Normal(this,uid);};var PickByUID_Normal=function PickByUID_Normal(objectClass,uid){var inst=objectClass.GetRuntime().GetInstanceByUID(uid);if(!inst)return false;var sol=objectClass.GetCurrentSol();if(!sol.IsSelectAll()&&!sol._GetOwnInstances().includes(inst))return false;if(objectClass.IsFamily()){if(inst.GetObjectClass().BelongsToFamily(objectClass)){sol.PickOne(inst);objectClass.ApplySolToContainer();return true;}}else if(inst.GetObjectClass()===objectClass){sol.PickOne(inst);objectClass.ApplySolToContainer();return true;}return false;};var PickByUID_Inverted=function PickByUID_Inverted(objectClass,uid){var sol=objectClass.GetCurrentSol();if(sol.IsSelectAll()){sol._SetSelectAll(false);sol.ClearArrays();var _instances11=objectClass.GetInstances();for(var i=0,len=_instances11.length;i<len;++i){var inst=_instances11[i];if(inst.GetUID()===uid)sol._PushElseInstance(inst);else sol._PushInstance(inst);}objectClass.ApplySolToContainer();return!!sol._GetOwnInstances().length;}else{var _instances12=sol._GetOwnInstances();var j=0;for(var _i53=0,_len46=_instances12.length;_i53<_len46;++_i53){var _inst10=_instances12[_i53];_instances12[j]=_inst10;if(_inst10.GetUID()===uid)sol._PushElseInstance(_inst10);else++j;}_C152.truncateArray(_instances12,j);objectClass.ApplySolToContainer();return!!_instances12.length;}};var Destroy=function Destroy(){this._runtime.DestroyInstance(this._inst);};var OnCreated=function OnCreated(){return true;};var OnDestroyed=function OnDestroyed(){return true;};var SetInstanceVar=function SetInstanceVar(iv,value){this.GetInstance().SetInstanceVariableValue(iv,value);};var AddInstanceVar=function AddInstanceVar(iv,value){var instance=this.GetInstance();var lastValue=instance.GetInstanceVariableValue(iv);if(typeof lastValue==="number"&&typeof value!=="number")value=parseFloat(value);else if(typeof lastValue==="string"&&typeof value!=="string")value=value.toString();instance.SetInstanceVariableValue(iv,lastValue+value);};var SubInstanceVar=function SubInstanceVar(iv,value){var instance=this.GetInstance();var lastValue=instance.GetInstanceVariableValue(iv);if(typeof lastValue!=="number")return;if(typeof value!=="number")value=parseFloat(value);instance.SetInstanceVariableValue(iv,lastValue-value);};var SetBoolInstanceVar=function SetBoolInstanceVar(iv,value){this.GetInstance().SetInstanceVariableValue(iv,value?1:0);};var ToggleBoolInstanceVar=function ToggleBoolInstanceVar(iv){var instance=this.GetInstance();instance.SetInstanceVariableValue(iv,instance.GetInstanceVariableValue(iv)===0?1:0);};var LoadFromJsonString=function LoadFromJsonString(str){var o;try{o=JSON.parse(str);}catch(err){console.error("Failed to load from JSON string: ",err);return;}var inst=this.GetInstance();var mode="state";inst.GetRuntime().ClearIntancesNeedingAfterLoad();inst._OnBeforeLoad(mode);inst.LoadFromJson(o,mode);inst.GetRuntime().DoAfterLoad(mode,{ignoreMissingInstances:true});};var AsJSON=function AsJSON(){return JSON.stringify(this.GetInstance().SaveToJson("state"));};var ObjectTypeName=function ObjectTypeName(){return this.GetInstance().GetObjectClass().GetName();};var Count=function Count(){var expObjectClass=this._runtime.GetCurrentEventStackFrame().GetExpressionObjectClass();var count=expObjectClass.GetInstanceCount();var _iteratorNormalCompletion398=true;var _didIteratorError398=false;var _iteratorError398=undefined;try{for(var _iterator398=this._runtime.instancesPendingCreateForObjectClass(expObjectClass)[Symbol.iterator](),_step398;!(_iteratorNormalCompletion398=(_step398=_iterator398.next()).done);_iteratorNormalCompletion398=true){var inst=_step398.value;++count;}}catch(err){_didIteratorError398=true;_iteratorError398=err;}finally{try{if(!_iteratorNormalCompletion398&&_iterator398["return"]!=null){_iterator398["return"]();}}finally{if(_didIteratorError398){throw _iteratorError398;}}}return count;};var PickedCount=function PickedCount(){return this._runtime.GetCurrentEventStackFrame().GetExpressionObjectClass().GetCurrentSol().GetInstances().length;};var GetIID=function GetIID(){return this._inst.GetIID();};var GetUID=function GetUID(){return this._inst.GetUID();};'use strict';var _C152=self.C3;var _tempColor5=new _C152.Color();var _tempRect4=_C152.New(_C152.Rect);var tempCandidates1=[];var tempCandidates2=[];var needsCollisionFinish=false;var rPickType=null;var rPickFromElseInstances=false;var rToPick=new Set();_C152.AddCommonACEs=function AddCommonACEs(pluginData,pluginCtor){var isSingleGlobal=pluginData[1];var hasPositionACEs=pluginData[3];var hasSizeACEs=pluginData[4];var hasAngleACEs=pluginData[5];var hasAppearanceACEs=pluginData[6];var hasZOrderACEs=pluginData[7];var hasEffectsACEs=pluginData[8];var hasElementACEs=pluginData[10];var hasElementFocusACEs=pluginData[11];var hasElementEnabledACEs=pluginData[12];var hasSceneGraphACEs=pluginData[13];var hasMeshACEs=pluginData[14];var hasCollisionACEs=pluginData[15];var hasTemplateACEs=pluginData[16];var Cnds=pluginCtor.Cnds;var Acts=pluginCtor.Acts;var Exps=pluginCtor.Exps;if(hasPositionACEs){Cnds.CompareX=CompareX;Cnds.CompareY=CompareY;Cnds.IsOnScreen=IsOnScreen;Cnds.IsOutsideLayout=IsOutsideLayout;Cnds.PickDistance=PickDistance;Acts.SetX=SetX;Acts.SetY=SetY;Acts.SetPos=SetPos;Acts.SetPosToObject=SetPosToObject;Acts.MoveForward=MoveForward;Acts.MoveAtAngle=MoveAtAngle;Exps.X=GetX;Exps.Y=GetY;Exps.dt=GetDt;}if(hasSizeACEs){Cnds.CompareWidth=CompareWidth;Cnds.CompareHeight=CompareHeight;Acts.SetWidth=SetWidth;Acts.SetHeight=SetHeight;Acts.SetSize=SetSize;Exps.Width=GetWidth;Exps.Height=GetHeight;Exps.BBoxLeft=GetBboxLeft;Exps.BBoxTop=GetBboxTop;Exps.BBoxRight=GetBboxRight;Exps.BBoxBottom=GetBboxBottom;Exps.BBoxMidX=GetBboxMidX;Exps.BBoxMidY=GetBboxMidY;}if(hasAngleACEs){Cnds.AngleWithin=IsAngleWithin;Cnds.IsClockwiseFrom=IsAngleClockwiseFrom;Cnds.IsBetweenAngles=IsBetweenAngles;Acts.SetAngle=SetAngle;Acts.RotateClockwise=RotateClockwise;Acts.RotateCounterclockwise=RotateCounterclockwise;Acts.RotateTowardAngle=RotateTowardAngle;Acts.RotateTowardPosition=RotateTowardPosition;Acts.SetTowardPosition=SetTowardPosition;Exps.Angle=GetAngle;}if(hasAppearanceACEs){Cnds.IsVisible=IsVisible;Cnds.CompareOpacity=CompareOpacity;Acts.SetVisible=SetVisible;Acts.SetOpacity=SetOpacity;Acts.SetDefaultColor=SetDefaultColor;Exps.Opacity=GetOpacity;Exps.ColorValue=GetColor;}if(hasZOrderACEs){Cnds.IsOnLayer=IsOnLayer;Cnds.PickTopBottom=PickTopBottom;Cnds.CompareZElevation=CompareZElevation;Acts.MoveToTop=MoveToTop;Acts.MoveToBottom=MoveToBottom;Acts.MoveToLayer=MoveToLayer;Acts.ZMoveToObject=ZMoveToObject;Acts.SetZElevation=SetZElevation;Exps.LayerNumber=LayerNumber;Exps.LayerName=LayerName;Exps.ZIndex=ZIndex;Exps.ZElevation=ZElevation;Exps.TotalZElevation=TotalZElevation;}if(hasEffectsACEs){Cnds.IsEffectEnabled=IsEffectEnabled;Acts.SetEffectEnabled=SetEffectEnabled;Acts.SetEffectParam=SetEffectParam;}if(hasSceneGraphACEs){Cnds.HasParent=HasParent;Cnds.HasChildren=HasChildren;Cnds.PickParent=PickParent;Cnds.PickChildren=PickChildren;Cnds.PickNthChild=PickNthChild;Cnds.CompareChildCount=CompareChildCount;Acts.AddChild=AddChild;Acts.RemoveChild=RemoveChild;Acts.RemoveFromParent=RemoveFromParent;Exps.ChildCount=ChildCount;Exps.AllChildCount=AllChildCount;}if(hasMeshACEs){Acts.SetMeshSize=SetMeshSize;Acts.SetMeshPoint=SetMeshPoint;Exps.MeshColumns=MeshColumns;Exps.MeshRows=MeshRows;}if(hasElementACEs){Cnds.IsVisible=IsVisible;Acts.SetVisible=SetElementVisible;Acts.SetCSSStyle=SetElementCSSStyle;Acts.SetElemAttribute=SetElementAttribute;Acts.RemoveElemAttribute=RemoveElementAttribute;}if(hasElementFocusACEs){Cnds.IsFocused=IsElementFocused;Acts.SetFocus=SetElementFocus;Acts.SetBlur=SetElementBlur;}if(hasElementEnabledACEs){Cnds.IsEnabled=IsElementEnabled;Acts.SetEnabled=SetElementEnabled;}if(hasCollisionACEs){Cnds.OnCollision=OnCollision;Cnds.IsOverlapping=IsOverlapping;Cnds.IsOverlappingOffset=IsOverlappingOffset;pluginCtor.FinishCollisionCondition=FinishCollisionCondition;}if(!isSingleGlobal){Cnds.CompareInstanceVar=CompareInstanceVar;Cnds.IsBoolInstanceVarSet=IsBoolInstanceVarSet;Cnds.PickInstVarHiLow=PickInstVarHiLow;Cnds.PickByUID=PickByUID;Acts.SetInstanceVar=SetInstanceVar;Acts.AddInstanceVar=AddInstanceVar;Acts.SubInstanceVar=SubInstanceVar;Acts.SetBoolInstanceVar=SetBoolInstanceVar;Acts.ToggleBoolInstanceVar=ToggleBoolInstanceVar;Cnds.OnCreated=OnCreated;Cnds.OnDestroyed=OnDestroyed;Acts.Destroy=Destroy;if(!Acts.LoadFromJsonString)Acts.LoadFromJsonString=LoadFromJsonString;if(!Exps.AsJSON)Exps.AsJSON=AsJSON;Exps.Count=Count;Exps.PickedCount=PickedCount;Exps.IID=GetIID;Exps.UID=GetUID;Exps.ObjectTypeName=ObjectTypeName;}if(hasTemplateACEs)Exps.TemplateName=TemplateName;};}// events/scheduledWait.js
{'use strict';var _C153=self.C3;_C153.ScheduledWait=/*#__PURE__*/function(_C153$DefendedBase){_inherits(ScheduledWait,_C153$DefendedBase);function ScheduledWait(eventSheetManager){var _this113;_classCallCheck(this,ScheduledWait);_this113=_possibleConstructorReturn(this,_getPrototypeOf(ScheduledWait).call(this));_this113._eventSheetManager=eventSheetManager;_this113._type="";_this113._time=-1;_this113._signalTag="";_this113._isSignalled=false;_this113._event=null;_this113._actIndex=0;_this113._solModifiers=[];_this113._dynamicSolModifiers=null;_this113._sols=new Map();_this113._callingFunctionBlock=null;_this113._asyncId=-1;_this113._functionParameters=null;_this113._functionInnerLocalVars=null;_this113._shouldRelease=false;return _this113;}_createClass(ScheduledWait,[{key:"Release",value:function Release(){this._type="";this._time=-1;this._signalTag="";this._event=null;this._callingFunctionBlock=null;this._functionParameters=null;this._functionInnerLocalVars=null;this._asyncId=-1;_C153.clearArray(this._solModifiers);if(this._dynamicSolModifiers){this._dynamicSolModifiers.clear();this._dynamicSolModifiers=null;}var _iteratorNormalCompletion399=true;var _didIteratorError399=false;var _iteratorError399=undefined;try{for(var _iterator399=this._sols.values()[Symbol.iterator](),_step399;!(_iteratorNormalCompletion399=(_step399=_iterator399.next()).done);_iteratorNormalCompletion399=true){var s=_step399.value;s.Release();}}catch(err){_didIteratorError399=true;_iteratorError399=err;}finally{try{if(!_iteratorNormalCompletion399&&_iterator399["return"]!=null){_iterator399["return"]();}}finally{if(_didIteratorError399){throw _iteratorError399;}}}this._sols.clear();}},{key:"_Init",value:function _Init(){var eventSheetManager=this._eventSheetManager;var allObjectClasses=eventSheetManager.GetRuntime().GetAllObjectClasses();var frame=eventSheetManager.GetCurrentEventStackFrame();this._event=frame.GetCurrentEvent();this._actIndex=frame.GetActionIndex()+1;var functionBlock=eventSheetManager.FindFirstFunctionBlockParent(this._event);if(functionBlock){this._callingFunctionBlock=functionBlock;this._functionParameters=functionBlock.CaptureFunctionParameters();this._functionInnerLocalVars=functionBlock._GetAllInnerLocalVariables().map(function(v){return v.GetValue();});if(functionBlock.IsAsync())this._asyncId=functionBlock.PauseCurrentAsyncFunction();}var _iteratorNormalCompletion400=true;var _didIteratorError400=false;var _iteratorError400=undefined;try{for(var _iterator400=allObjectClasses[Symbol.iterator](),_step400;!(_iteratorNormalCompletion400=(_step400=_iterator400.next()).done);_iteratorNormalCompletion400=true){var objectClass=_step400.value;var sol=objectClass.GetCurrentSol();if(sol.IsSelectAll()&&!this._event.HasSolModifier(objectClass))continue;this._solModifiers.push(objectClass);this._sols.set(objectClass,_C153.New(_C153.SolState,sol));}}catch(err){_didIteratorError400=true;_iteratorError400=err;}finally{try{if(!_iteratorNormalCompletion400&&_iterator400["return"]!=null){_iterator400["return"]();}}finally{if(_didIteratorError400){throw _iteratorError400;}}}var dynamicSolModifiersSet=eventSheetManager.GetDynamicSolModifiersSet();this._dynamicSolModifiers=dynamicSolModifiersSet.size>0?dynamicSolModifiersSet:null;}},{key:"InitTimer",value:function InitTimer(seconds){this._type="timer";this._Init();this._time=this._eventSheetManager.GetRuntime().GetGameTime()+seconds;}},{key:"InitSignal",value:function InitSignal(tag){this._type="signal";this._Init();this._signalTag=tag.toLowerCase();}},{key:"InitPromise",value:function InitPromise(p){var _this114=this;this._type="promise";this._Init();p.then(function(){return _this114.SetSignalled();})["catch"](function(err){console.warn("[C3 runtime] Promise rejected in 'Wait for previous actions to complete': ",err);_this114.SetSignalled();});}},{key:"IsTimer",value:function IsTimer(){return this._type==="timer";}},{key:"IsSignal",value:function IsSignal(){return this._type==="signal";}},{key:"IsPromise",value:function IsPromise(){return this._type==="promise";}},{key:"GetSignalTag",value:function GetSignalTag(){return this._signalTag;}},{key:"IsSignalled",value:function IsSignalled(){return this._isSignalled;}},{key:"SetSignalled",value:function SetSignalled(){this._isSignalled=true;}},{key:"_ShouldRun",value:function _ShouldRun(){if(this.IsTimer())return this._time<=this._eventSheetManager.GetRuntime().GetGameTime();else return this.IsSignalled();}},{key:"_RestoreState",value:function _RestoreState(frame){var _this115=this;frame._Restore(this._event,this._actIndex);var _iteratorNormalCompletion401=true;var _didIteratorError401=false;var _iteratorError401=undefined;try{for(var _iterator401=this._sols.entries()[Symbol.iterator](),_step401;!(_iteratorNormalCompletion401=(_step401=_iterator401.next()).done);_iteratorNormalCompletion401=true){var _step401$value=_slicedToArray(_step401.value,2),objectClass=_step401$value[0],solState=_step401$value[1];var sol=objectClass.GetCurrentSol();solState._Restore(sol);}}catch(err){_didIteratorError401=true;_iteratorError401=err;}finally{try{if(!_iteratorNormalCompletion401&&_iterator401["return"]!=null){_iterator401["return"]();}}finally{if(_didIteratorError401){throw _iteratorError401;}}}if(this._dynamicSolModifiers)frame.SetDynamicSolModifiers(_toConsumableArray(this._dynamicSolModifiers));var callingFunctionBlock=this._callingFunctionBlock;if(callingFunctionBlock){callingFunctionBlock.SetFunctionParameters(this._functionParameters);callingFunctionBlock._GetAllInnerLocalVariables().map(function(v,index){return v.SetValue(_this115._functionInnerLocalVars[index]);});if(callingFunctionBlock.IsAsync())callingFunctionBlock.ResumeAsyncFunction(this._asyncId);}}},{key:"_Run",value:function _Run(frame){this._RestoreState(frame);this._event._ResumeActionsAndSubEvents(frame);if(this._callingFunctionBlock&&this._callingFunctionBlock.IsAsync())this._callingFunctionBlock.MaybeFinishAsyncFunctionCall(this._asyncId);this._eventSheetManager.ClearSol(this._solModifiers);this._shouldRelease=true;}},{key:"_DebugRun",value:function _DebugRun(frame){var _iteratorNormalCompletion402,_didIteratorError402,_iteratorError402,_iterator402,_step402,breakEventObject;return regeneratorRuntime.async(function _DebugRun$(_context156){while(1){switch(_context156.prev=_context156.next){case 0:this._RestoreState(frame);_iteratorNormalCompletion402=true;_didIteratorError402=false;_iteratorError402=undefined;_context156.prev=4;_iterator402=this._event._DebugResumeActionsAndSubEvents(frame)[Symbol.iterator]();case 6:if(_iteratorNormalCompletion402=(_step402=_iterator402.next()).done){_context156.next=13;break;}breakEventObject=_step402.value;_context156.next=10;return regeneratorRuntime.awrap(this._eventSheetManager.GetRuntime().DebugBreak(breakEventObject));case 10:_iteratorNormalCompletion402=true;_context156.next=6;break;case 13:_context156.next=19;break;case 15:_context156.prev=15;_context156.t0=_context156["catch"](4);_didIteratorError402=true;_iteratorError402=_context156.t0;case 19:_context156.prev=19;_context156.prev=20;if(!_iteratorNormalCompletion402&&_iterator402["return"]!=null){_iterator402["return"]();}case 22:_context156.prev=22;if(!_didIteratorError402){_context156.next=25;break;}throw _iteratorError402;case 25:return _context156.finish(22);case 26:return _context156.finish(19);case 27:if(this._callingFunctionBlock&&this._callingFunctionBlock.IsAsync())this._callingFunctionBlock.MaybeFinishAsyncFunctionCall(this._asyncId);this._eventSheetManager.ClearSol(this._solModifiers);this._shouldRelease=true;case 30:case"end":return _context156.stop();}}},null,this,[[4,15,19,27],[20,,22,26]]);}},{key:"ShouldRelease",value:function ShouldRelease(){return this._shouldRelease;}},{key:"RemoveInstances",value:function RemoveInstances(s){var _iteratorNormalCompletion403=true;var _didIteratorError403=false;var _iteratorError403=undefined;try{for(var _iterator403=this._sols.values()[Symbol.iterator](),_step403;!(_iteratorNormalCompletion403=(_step403=_iterator403.next()).done);_iteratorNormalCompletion403=true){var solState=_step403.value;solState.RemoveInstances(s);}}catch(err){_didIteratorError403=true;_iteratorError403=err;}finally{try{if(!_iteratorNormalCompletion403&&_iterator403["return"]!=null){_iterator403["return"]();}}finally{if(_didIteratorError403){throw _iteratorError403;}}}}},{key:"_SaveToJson",value:function _SaveToJson(){var sols={};var o={"t":this._time,"st":this._signalTag,"s":this._isSignalled,"ev":this._event.GetSID(),"sm":this._solModifiers.map(function(oc){return oc.GetSID();}),"dsm":this._dynamicSolModifiers?_toConsumableArray(this._dynamicSolModifiers).map(function(oc){return oc.GetSID();}):null,"sols":sols};if(this._event._HasActionIndex(this._actIndex))o["act"]=this._event.GetActionAt(this._actIndex).GetSID();var _iteratorNormalCompletion404=true;var _didIteratorError404=false;var _iteratorError404=undefined;try{for(var _iterator404=this._sols[Symbol.iterator](),_step404;!(_iteratorNormalCompletion404=(_step404=_iterator404.next()).done);_iteratorNormalCompletion404=true){var _step404$value=_slicedToArray(_step404.value,2),objectClass=_step404$value[0],solState=_step404$value[1];sols[objectClass.GetSID().toString()]=solState._SaveToJson();}}catch(err){_didIteratorError404=true;_iteratorError404=err;}finally{try{if(!_iteratorNormalCompletion404&&_iterator404["return"]!=null){_iterator404["return"]();}}finally{if(_didIteratorError404){throw _iteratorError404;}}}return o;}}],[{key:"_CreateFromJson",value:function _CreateFromJson(eventSheetManager,o){var runtime=eventSheetManager.GetRuntime();var event=eventSheetManager.GetEventBlockBySID(o["ev"]);if(!event)return null;var actIndex=0;if(o.hasOwnProperty("act")){var act=eventSheetManager.GetActionBySID(o["act"]);if(!act)return null;actIndex=act.GetIndex();}var sw=_C153.New(_C153.ScheduledWait,eventSheetManager);sw._time=o["t"];sw._type=sw._time===-1?"signal":"timer";sw._signalTag=o["st"];sw._isSignalled=o["s"];sw._event=event;sw._actIndex=actIndex;var _iteratorNormalCompletion405=true;var _didIteratorError405=false;var _iteratorError405=undefined;try{for(var _iterator405=o["sm"][Symbol.iterator](),_step405;!(_iteratorNormalCompletion405=(_step405=_iterator405.next()).done);_iteratorNormalCompletion405=true){var _sid2=_step405.value;var _objectClass4=runtime.GetObjectClassBySID(_sid2);if(_objectClass4)sw._solModifiers.push(_objectClass4);}}catch(err){_didIteratorError405=true;_iteratorError405=err;}finally{try{if(!_iteratorNormalCompletion405&&_iterator405["return"]!=null){_iterator405["return"]();}}finally{if(_didIteratorError405){throw _iteratorError405;}}}if(Array.isArray(o["dsm"])){var _iteratorNormalCompletion406=true;var _didIteratorError406=false;var _iteratorError406=undefined;try{for(var _iterator406=o["dsm"][Symbol.iterator](),_step406;!(_iteratorNormalCompletion406=(_step406=_iterator406.next()).done);_iteratorNormalCompletion406=true){var sid=_step406.value;var objectClass=runtime.GetObjectClassBySID(sid);if(objectClass){if(!sw._dynamicSolModifiers)sw._dynamicSolModifiers=new Set();sw._dynamicSolModifiers.add(objectClass);}}}catch(err){_didIteratorError406=true;_iteratorError406=err;}finally{try{if(!_iteratorNormalCompletion406&&_iterator406["return"]!=null){_iterator406["return"]();}}finally{if(_didIteratorError406){throw _iteratorError406;}}}}for(var _i54=0,_Object$entries15=Object.entries(o["sols"]);_i54<_Object$entries15.length;_i54++){var _Object$entries15$_i=_slicedToArray(_Object$entries15[_i54],2),sidStr=_Object$entries15$_i[0],solData=_Object$entries15$_i[1];var _sid3=parseInt(sidStr,10);var _objectClass5=runtime.GetObjectClassBySID(_sid3);if(!_objectClass5)continue;var solState=_C153.New(_C153.SolState,null);solState._LoadFromJson(eventSheetManager,solData);sw._sols.set(_objectClass5,solState);}return sw;}}]);return ScheduledWait;}(_C153.DefendedBase);}// events/solState.js
{'use strict';var _C154=self.C3;_C154.SolState=/*#__PURE__*/function(_C154$DefendedBase){_inherits(SolState,_C154$DefendedBase);function SolState(sol){var _this116;_classCallCheck(this,SolState);_this116=_possibleConstructorReturn(this,_getPrototypeOf(SolState).call(this));_this116._objectClass=null;_this116._isSelectAll=true;_this116._instances=[];if(sol){_this116._objectClass=sol.GetObjectClass();_this116._isSelectAll=sol.IsSelectAll();_C154.shallowAssignArray(_this116._instances,sol._GetOwnInstances());}return _this116;}_createClass(SolState,[{key:"Release",value:function Release(){this._objectClass=null;_C154.clearArray(this._instances);}},{key:"_Restore",value:function _Restore(sol){sol._SetSelectAll(this._isSelectAll);_C154.shallowAssignArray(sol._GetOwnInstances(),this._instances);}},{key:"RemoveInstances",value:function RemoveInstances(s){_C154.arrayRemoveAllInSet(this._instances,s);}},{key:"_SaveToJson",value:function _SaveToJson(){return{"sa":this._isSelectAll,"insts":this._instances.map(function(inst){return inst.GetUID();})};}},{key:"_LoadFromJson",value:function _LoadFromJson(eventSheetManager,o){var runtime=eventSheetManager.GetRuntime();this._isSelectAll=!!o["sa"];_C154.clearArray(this._instances);var _iteratorNormalCompletion407=true;var _didIteratorError407=false;var _iteratorError407=undefined;try{for(var _iterator407=o["insts"][Symbol.iterator](),_step407;!(_iteratorNormalCompletion407=(_step407=_iterator407.next()).done);_iteratorNormalCompletion407=true){var uid=_step407.value;var inst=runtime.GetInstanceByUID(uid);if(inst)this._instances.push(inst);}}catch(err){_didIteratorError407=true;_iteratorError407=err;}finally{try{if(!_iteratorNormalCompletion407&&_iterator407["return"]!=null){_iterator407["return"]();}}finally{if(_didIteratorError407){throw _iteratorError407;}}}}}]);return SolState;}(_C154.DefendedBase);}// sdk/sdkPluginBase.js
{var GetNextParamMap=function GetNextParamMap(paramMap,param){var nextParamMap=paramMap.get(param);if(!nextParamMap){nextParamMap=new Map();paramMap.set(param,nextParamMap);}return nextParamMap;};'use strict';var _C155=self.C3;_C155.SDKPluginBase=/*#__PURE__*/function(_C155$DefendedBase){_inherits(SDKPluginBase,_C155$DefendedBase);function SDKPluginBase(opts){var _this117;_classCallCheck(this,SDKPluginBase);_this117=_possibleConstructorReturn(this,_getPrototypeOf(SDKPluginBase).call(this));_this117._runtime=opts.runtime;_this117._isSingleGlobal=!!opts.isSingleGlobal;_this117._isWorldType=!!opts.isWorld;_this117._isRotatable=!!opts.isRotatable;_this117._mustPredraw=!!opts.mustPredraw;_this117._hasEffects=!!opts.hasEffects;_this117._supportsSceneGraph=!!opts.supportsSceneGraph;_this117._supportsMesh=!!opts.supportsMesh;_this117._isHTMLElementType=!!opts.isHTMLElementType;_this117._singleGlobalObjectClass=null;_this117._boundACEMethodCache=new Map();_this117._boundACEMethodCache_1param=new Map();_this117._boundACEMethodCache_2params=new Map();_this117._boundACEMethodCache_3params=new Map();return _this117;}_createClass(SDKPluginBase,[{key:"Release",value:function Release(){this._runtime=null;}},{key:"GetRuntime",value:function GetRuntime(){return this._runtime;}},{key:"OnCreate",value:function OnCreate(){}},{key:"IsSingleGlobal",value:function IsSingleGlobal(){return this._isSingleGlobal;}},{key:"IsWorldType",value:function IsWorldType(){return this._isWorldType;}},{key:"IsHTMLElementType",value:function IsHTMLElementType(){return this._isHTMLElementType;}},{key:"IsRotatable",value:function IsRotatable(){return this._isRotatable;}},{key:"MustPreDraw",value:function MustPreDraw(){return this._mustPredraw;}},{key:"HasEffects",value:function HasEffects(){return this._hasEffects;}},{key:"SupportsSceneGraph",value:function SupportsSceneGraph(){return this._supportsSceneGraph;}},{key:"SupportsMesh",value:function SupportsMesh(){return this._supportsMesh;}},{key:"_GetBoundACEMethod",value:function _GetBoundACEMethod(func,bindThis){if(!bindThis)throw new Error("missing 'this' binding");var ret=this._boundACEMethodCache.get(func);if(ret)return ret;ret=func.bind(bindThis);this._boundACEMethodCache.set(func,ret);return ret;}},{key:"_GetBoundACEMethod_1param",value:function _GetBoundACEMethod_1param(func,bindThis,param0){if(!bindThis)throw new Error("missing 'this' binding");var param0map=GetNextParamMap(this._boundACEMethodCache_1param,func);var ret=param0map.get(param0);if(ret)return ret;ret=func.bind(bindThis,param0);param0map.set(param0,ret);return ret;}},{key:"_GetBoundACEMethod_2params",value:function _GetBoundACEMethod_2params(func,bindThis,param0,param1){if(!bindThis)throw new Error("missing 'this' binding");var param0map=GetNextParamMap(this._boundACEMethodCache_2params,func);var param1map=GetNextParamMap(param0map,param0);var ret=param1map.get(param1);if(ret)return ret;ret=func.bind(bindThis,param0,param1);param1map.set(param1,ret);return ret;}},{key:"_GetBoundACEMethod_3params",value:function _GetBoundACEMethod_3params(func,bindThis,param0,param1,param2){if(!bindThis)throw new Error("missing 'this' binding");var param0map=GetNextParamMap(this._boundACEMethodCache_3params,func);var param1map=GetNextParamMap(param0map,param0);var param2map=GetNextParamMap(param1map,param1);var ret=param2map.get(param2);if(ret)return ret;ret=func.bind(bindThis,param0,param1,param2);param2map.set(param2,ret);return ret;}},{key:"_SetSingleGlobalObjectClass",value:function _SetSingleGlobalObjectClass(objectClass){if(!this.IsSingleGlobal())throw new Error("must be single-global plugin");this._singleGlobalObjectClass=objectClass;}},{key:"GetSingleGlobalObjectClass",value:function GetSingleGlobalObjectClass(){if(!this.IsSingleGlobal())throw new Error("must be single-global plugin");return this._singleGlobalObjectClass;}},{key:"GetSingleGlobalInstance",value:function GetSingleGlobalInstance(){if(!this.IsSingleGlobal())throw new Error("must be single-global plugin");return this._singleGlobalObjectClass.GetSingleGlobalInstance();}}]);return SDKPluginBase;}(_C155.DefendedBase);}// sdk/sdkDOMPluginBase.js
{'use strict';var _C156=self.C3;_C156.SDKDOMPluginBase=/*#__PURE__*/function(_C156$SDKPluginBase){_inherits(SDKDOMPluginBase,_C156$SDKPluginBase);function SDKDOMPluginBase(opts,DOM_COMPONENT_ID){var _this118;_classCallCheck(this,SDKDOMPluginBase);_this118=_possibleConstructorReturn(this,_getPrototypeOf(SDKDOMPluginBase).call(this,opts));_this118._domComponentId=DOM_COMPONENT_ID;_this118._nextElementId=0;_this118._instMap=new Map();_this118.AddElementMessageHandler("elem-focused",function(sdkInst){return sdkInst._OnElemFocused();});_this118.AddElementMessageHandler("elem-blurred",function(sdkInst){if(sdkInst)sdkInst._OnElemBlurred();});return _this118;}_createClass(SDKDOMPluginBase,[{key:"Release",value:function Release(){_get(_getPrototypeOf(SDKDOMPluginBase.prototype),"Release",this).call(this);}},{key:"_AddElement",value:function _AddElement(sdkInst){var elementId=this._nextElementId++;this._instMap.set(elementId,sdkInst);return elementId;}},{key:"_RemoveElement",value:function _RemoveElement(elementId){this._instMap["delete"](elementId);}},{key:"AddElementMessageHandler",value:function AddElementMessageHandler(handler,func){var _this119=this;this._runtime.AddDOMComponentMessageHandler(this._domComponentId,handler,function(e){var sdkInst=_this119._instMap.get(e["elementId"]);func(sdkInst,e);});}}]);return SDKDOMPluginBase;}(_C156.SDKPluginBase);}// sdk/sdkTypeBase.js
{'use strict';var _C157=self.C3;_C157.SDKTypeBase=/*#__PURE__*/function(_C157$DefendedBase){_inherits(SDKTypeBase,_C157$DefendedBase);function SDKTypeBase(objectClass){var _this120;_classCallCheck(this,SDKTypeBase);_this120=_possibleConstructorReturn(this,_getPrototypeOf(SDKTypeBase).call(this));_this120._objectClass=objectClass;_this120._runtime=objectClass.GetRuntime();_this120._plugin=objectClass.GetPlugin();return _this120;}_createClass(SDKTypeBase,[{key:"Release",value:function Release(){this._objectClass=null;this._runtime=null;this._plugin=null;}},{key:"GetObjectClass",value:function GetObjectClass(){return this._objectClass;}},{key:"GetRuntime",value:function GetRuntime(){return this._runtime;}},{key:"GetPlugin",value:function GetPlugin(){return this._plugin;}},{key:"GetImageInfo",value:function GetImageInfo(){return this._objectClass.GetImageInfo();}},{key:"OnCreate",value:function OnCreate(){}},{key:"FinishCondition",value:function FinishCondition(f){}},{key:"BeforeRunAction",value:function BeforeRunAction(method){}},{key:"AfterRunAction",value:function AfterRunAction(method){}},{key:"LoadTextures",value:function LoadTextures(renderer){}},{key:"ReleaseTextures",value:function ReleaseTextures(){}},{key:"OnDynamicTextureLoadComplete",value:function OnDynamicTextureLoadComplete(){}},{key:"PreloadTexturesWithInstances",value:function PreloadTexturesWithInstances(renderer){}},{key:"LoadTilemapData",value:function LoadTilemapData(){}},{key:"GetScriptInterfaceClass",value:function GetScriptInterfaceClass(){return null;}},{key:"DispatchScriptEvent",value:function DispatchScriptEvent(name,cancelable,additionalProperties){var e=_C157.New(_C157.Event,name,cancelable);e.objectClass=this;if(additionalProperties)Object.assign(e,additionalProperties);this.GetObjectClass().DispatchUserScriptEvent(e);}}]);return SDKTypeBase;}(_C157.DefendedBase);}// sdk/sdkInstanceBase.js
{'use strict';var _C158=self.C3;_C158.SDKInstanceBase=/*#__PURE__*/function(_C158$DefendedBase){_inherits(SDKInstanceBase,_C158$DefendedBase);function SDKInstanceBase(inst,domComponentId){var _this121;_classCallCheck(this,SDKInstanceBase);_this121=_possibleConstructorReturn(this,_getPrototypeOf(SDKInstanceBase).call(this));_this121._inst=inst;_this121._domComponentId=domComponentId;_this121._wrapperComponentId=null;_this121._runtime=inst.GetRuntime();_this121._objectClass=_this121._inst.GetObjectClass();_this121._sdkType=_this121._objectClass.GetSdkType();_this121._tickFunc=null;_this121._tick2Func=null;_this121._isTicking=false;_this121._isTicking2=false;_this121._disposables=null;_this121._wasReleased=false;return _this121;}_createClass(SDKInstanceBase,[{key:"Release",value:function Release(){this._wasReleased=true;this._StopTicking();this._StopTicking2();this._tickFunc=null;this._tick2Func=null;if(this._disposables){this._disposables.Release();this._disposables=null;}this._inst=null;this._runtime=null;this._objectClass=null;this._sdkType=null;}},{key:"WasReleased",value:function WasReleased(){return this._wasReleased;}},{key:"GetInstance",value:function GetInstance(){return this._inst;}},{key:"GetRuntime",value:function GetRuntime(){return this._runtime;}},{key:"GetObjectClass",value:function GetObjectClass(){return this._objectClass;}},{key:"GetPlugin",value:function GetPlugin(){return this._sdkType.GetPlugin();}},{key:"GetSdkType",value:function GetSdkType(){return this._sdkType;}},{key:"GetScriptInterface",value:function GetScriptInterface(){return this._inst.GetInterfaceClass();}},{key:"Trigger",value:function Trigger(method){return this._runtime.Trigger(method,this._inst,null);}},{key:"DebugTrigger",value:function DebugTrigger(method){return this._runtime.DebugTrigger(method,this._inst,null);}},{key:"TriggerAsync",value:function TriggerAsync(method){return this._runtime.TriggerAsync(method,this._inst,null);}},{key:"FastTrigger",value:function FastTrigger(method,value){return this._runtime.FastTrigger(method,this._inst,value);}},{key:"DebugFastTrigger",value:function DebugFastTrigger(method,value){return this._runtime.DebugFastTrigger(method,this._inst,value);}},{key:"ScheduleTriggers",value:function ScheduleTriggers(f){return this._runtime.ScheduleTriggers(f);}},{key:"AddDOMMessageHandler",value:function AddDOMMessageHandler(handler,func){this._runtime.AddDOMComponentMessageHandler(this._domComponentId,handler,func);}},{key:"AddDOMMessageHandlers",value:function AddDOMMessageHandlers(list){var _iteratorNormalCompletion408=true;var _didIteratorError408=false;var _iteratorError408=undefined;try{for(var _iterator408=list[Symbol.iterator](),_step408;!(_iteratorNormalCompletion408=(_step408=_iterator408.next()).done);_iteratorNormalCompletion408=true){var _step408$value=_slicedToArray(_step408.value,2),handler=_step408$value[0],func=_step408$value[1];this.AddDOMMessageHandler(handler,func);}}catch(err){_didIteratorError408=true;_iteratorError408=err;}finally{try{if(!_iteratorNormalCompletion408&&_iterator408["return"]!=null){_iterator408["return"]();}}finally{if(_didIteratorError408){throw _iteratorError408;}}}}},{key:"PostToDOM",value:function PostToDOM(handler,data){this._runtime.PostComponentMessageToDOM(this._domComponentId,handler,data);}},{key:"PostToDOMAsync",value:function PostToDOMAsync(handler,data){return this._runtime.PostComponentMessageToDOMAsync(this._domComponentId,handler,data);}},{key:"_PostToDOMMaybeSync",value:function _PostToDOMMaybeSync(handler,data){if(this._runtime.IsInWorker())this.PostToDOM(handler,data);else return window["c3_runtimeInterface"]["_OnMessageFromRuntime"]({"type":"event","component":this._domComponentId,"handler":handler,"data":data,"responseId":null});}},{key:"SetWrapperExtensionComponentId",value:function SetWrapperExtensionComponentId(componentId){if(!componentId)throw new Error("cannot set empty component id");this._wrapperComponentId=componentId;}},{key:"IsWrapperExtensionAvailable",value:function IsWrapperExtensionAvailable(){if(!this._wrapperComponentId)throw new Error("wrapper extension component id not set");return this._runtime.HasWrapperComponentId(this._wrapperComponentId);}},{key:"AddWrapperExtensionMessageHandler",value:function AddWrapperExtensionMessageHandler(handler,func){if(!this._wrapperComponentId)throw new Error("wrapper extension component id not set");this._runtime.AddWrapperExtensionMessageHandler(this._wrapperComponentId,handler,func);}},{key:"AddWrapperExtensionMessageHandlers",value:function AddWrapperExtensionMessageHandlers(list){var _iteratorNormalCompletion409=true;var _didIteratorError409=false;var _iteratorError409=undefined;try{for(var _iterator409=list[Symbol.iterator](),_step409;!(_iteratorNormalCompletion409=(_step409=_iterator409.next()).done);_iteratorNormalCompletion409=true){var _step409$value=_slicedToArray(_step409.value,2),handler=_step409$value[0],func=_step409$value[1];this.AddWrapperExtensionMessageHandler(handler,func);}}catch(err){_didIteratorError409=true;_iteratorError409=err;}finally{try{if(!_iteratorNormalCompletion409&&_iterator409["return"]!=null){_iterator409["return"]();}}finally{if(_didIteratorError409){throw _iteratorError409;}}}}},{key:"SendWrapperExtensionMessage",value:function SendWrapperExtensionMessage(messageId,params){if(!this._wrapperComponentId)throw new Error("wrapper extension component id not set");this._runtime.SendWrapperExtensionMessage(this._wrapperComponentId,messageId,params);}},{key:"SendWrapperExtensionMessageAsync",value:function SendWrapperExtensionMessageAsync(messageId,params){if(!this._wrapperComponentId)throw new Error("wrapper extension component id not set");return this._runtime.SendWrapperExtensionMessageAsync(this._wrapperComponentId,messageId,params);}},{key:"Tick",value:function Tick(){}},{key:"Tick2",value:function Tick2(){}},{key:"_StartTicking",value:function _StartTicking(){var _this122=this;if(this._isTicking)return;if(!this._tickFunc)this._tickFunc=function(){return _this122.Tick();};this._runtime.Dispatcher().addEventListener("tick",this._tickFunc);this._isTicking=true;}},{key:"_StopTicking",value:function _StopTicking(){if(!this._isTicking)return;this._runtime.Dispatcher().removeEventListener("tick",this._tickFunc);this._isTicking=false;}},{key:"IsTicking",value:function IsTicking(){return this._isTicking;}},{key:"_StartTicking2",value:function _StartTicking2(){var _this123=this;if(this._isTicking2)return;if(!this._tick2Func)this._tick2Func=function(){return _this123.Tick2();};this._runtime.Dispatcher().addEventListener("tick2",this._tick2Func);this._isTicking2=true;}},{key:"_StopTicking2",value:function _StopTicking2(){if(!this._isTicking2)return;this._runtime.Dispatcher().removeEventListener("tick2",this._tick2Func);this._isTicking2=false;}},{key:"IsTicking2",value:function IsTicking2(){return this._isTicking2;}},{key:"GetDebuggerProperties",value:function GetDebuggerProperties(){return[];}},{key:"SaveToJson",value:function SaveToJson(){return null;}},{key:"LoadFromJson",value:function LoadFromJson(o){}},{key:"GetPropertyValueByIndex",value:function GetPropertyValueByIndex(index){}},{key:"SetPropertyValueByIndex",value:function SetPropertyValueByIndex(index,value){}},{key:"OffsetPropertyValueByIndex",value:function OffsetPropertyValueByIndex(index,offset,opts){if(offset===0)return;var value=this.GetPropertyValueByIndex(index);if(typeof value!=="number")throw new Error("expected number");this.SetPropertyValueByIndex(index,value+offset,opts);}},{key:"SetPropertyColorOffsetValueByIndex",value:function SetPropertyColorOffsetValueByIndex(offset,r,g,b){}},{key:"CallAction",value:function CallAction(actMethod){for(var _len47=arguments.length,args=new Array(_len47>1?_len47-1:0),_key32=1;_key32<_len47;_key32++){args[_key32-1]=arguments[_key32];}actMethod.call.apply(actMethod,[this].concat(args));}},{key:"CallExpression",value:function CallExpression(expMethod){for(var _len48=arguments.length,args=new Array(_len48>1?_len48-1:0),_key33=1;_key33<_len48;_key33++){args[_key33-1]=arguments[_key33];}return expMethod.call.apply(expMethod,[this].concat(args));}},{key:"GetScriptInterfaceClass",value:function GetScriptInterfaceClass(){return null;}},{key:"DispatchScriptEvent",value:function DispatchScriptEvent(name,cancelable,additionalProperties){if(!this._inst.HasScriptInterface())return;var scriptInterface=this.GetScriptInterface();var e=_C158.New(_C158.Event,name,cancelable);e.instance=scriptInterface;if(additionalProperties)Object.assign(e,additionalProperties);scriptInterface.dispatchEvent(e);}}]);return SDKInstanceBase;}(_C158.DefendedBase);}// sdk/sdkWorldInstanceBase.js
{'use strict';var _C159=self.C3;_C159.SDKWorldInstanceBase=/*#__PURE__*/function(_C159$SDKInstanceBase){_inherits(SDKWorldInstanceBase,_C159$SDKInstanceBase);function SDKWorldInstanceBase(inst,domComponentId){var _this124;_classCallCheck(this,SDKWorldInstanceBase);_this124=_possibleConstructorReturn(this,_getPrototypeOf(SDKWorldInstanceBase).call(this,inst,domComponentId));_this124._worldInfo=inst.GetWorldInfo();_this124._renderercontextlost_handler=null;_this124._renderercontextrestored_handler=null;return _this124;}_createClass(SDKWorldInstanceBase,[{key:"Release",value:function Release(){if(this._renderercontextlost_handler){var dispatcher=this._runtime.Dispatcher();dispatcher.removeEventListener("renderercontextlost",this._renderercontextlost_handler);dispatcher.removeEventListener("renderercontextrestored",this._renderercontextrestored_handler);this._renderercontextlost_handler=null;this._renderercontextrestored_handler=null;}this._worldInfo=null;_get(_getPrototypeOf(SDKWorldInstanceBase.prototype),"Release",this).call(this);}},{key:"HandleWebGLContextLoss",value:function HandleWebGLContextLoss(){this.HandleRendererContextLoss();}},{key:"OnWebGLContextLost",value:function OnWebGLContextLost(){}},{key:"OnWebGLContextRestored",value:function OnWebGLContextRestored(){}},{key:"HandleRendererContextLoss",value:function HandleRendererContextLoss(){var _this125=this;if(this._renderercontextlost_handler)return;this._renderercontextlost_handler=function(){return _this125.OnRendererContextLost();};this._renderercontextrestored_handler=function(){return _this125.OnRendererContextRestored();};var dispatcher=this._runtime.Dispatcher();dispatcher.addEventListener("renderercontextlost",this._renderercontextlost_handler);dispatcher.addEventListener("renderercontextrestored",this._renderercontextrestored_handler);}},{key:"OnRendererContextLost",value:function OnRendererContextLost(){this.OnWebGLContextLost();}},{key:"OnRendererContextRestored",value:function OnRendererContextRestored(){this.OnWebGLContextRestored();}},{key:"GetWorldInfo",value:function GetWorldInfo(){return this._worldInfo;}},{key:"IsOriginalSizeKnown",value:function IsOriginalSizeKnown(){return false;}},{key:"GetOriginalWidth",value:function GetOriginalWidth(){if(!this.IsOriginalSizeKnown())throw new Error("original size not known");var imageInfo=this.GetCurrentImageInfo();if(imageInfo)return imageInfo.GetWidth();else;}},{key:"GetOriginalHeight",value:function GetOriginalHeight(){if(!this.IsOriginalSizeKnown())throw new Error("original size not known");var imageInfo=this.GetCurrentImageInfo();if(imageInfo)return imageInfo.GetHeight();else;}},{key:"GetCurrentImageInfo",value:function GetCurrentImageInfo(){return null;}},{key:"GetCurrentSurfaceSize",value:function GetCurrentSurfaceSize(){var imageInfo=this.GetCurrentImageInfo();if(imageInfo){var texture=imageInfo.GetTexture();if(texture)return[texture.GetWidth(),texture.GetHeight()];}return[100,100];}},{key:"GetCurrentTexRect",value:function GetCurrentTexRect(){var imageInfo=this.GetCurrentImageInfo();return imageInfo?imageInfo.GetTexRect():null;}},{key:"GetCurrentTexQuad",value:function GetCurrentTexQuad(){var imageInfo=this.GetCurrentImageInfo();return imageInfo?imageInfo.GetTexQuad():null;}},{key:"IsCurrentTexRotated",value:function IsCurrentTexRotated(){var imageInfo=this.GetCurrentImageInfo();return imageInfo?imageInfo.IsRotated():false;}},{key:"GetImagePoint",value:function GetImagePoint(nameOrIndex){var wi=this._inst.GetWorldInfo();return[wi.GetX(),wi.GetY(),wi.GetTotalZElevation()];}},{key:"LoadTilemapData",value:function LoadTilemapData(data,mapWidth,mapHeight){}},{key:"TestPointOverlapTile",value:function TestPointOverlapTile(x,y){}},{key:"RendersToOwnZPlane",value:function RendersToOwnZPlane(){return true;}}]);return SDKWorldInstanceBase;}(_C159.SDKInstanceBase);}// sdk/sdkDOMInstanceBase.js
{'use strict';var _C160=self.C3;var _tempRect5=_C160.New(_C160.Rect);_C160.SDKDOMInstanceBase=/*#__PURE__*/function(_C160$SDKWorldInstanc){_inherits(SDKDOMInstanceBase,_C160$SDKWorldInstanc);function SDKDOMInstanceBase(inst,domComponentId){var _this126;_classCallCheck(this,SDKDOMInstanceBase);_this126=_possibleConstructorReturn(this,_getPrototypeOf(SDKDOMInstanceBase).call(this,inst,domComponentId));_this126._elementId=_this126.GetPlugin()._AddElement(_assertThisInitialized(_this126));_this126._isElementShowing=true;_this126._elemHasFocus=false;_this126._autoFontSize=false;_this126._autoFontSizeOffset=-.2;_this126._lastRect=_C160.New(_C160.Rect,0,0,-1,-1);var canvasManager=_this126._runtime.GetCanvasManager();_this126._lastWindowWidth=canvasManager.GetLastWidth();_this126._lastWindowHeight=canvasManager.GetLastHeight();_this126._lastHTMLIndex=-1;_this126._lastHTMLZIndex=-1;_this126._isPendingUpdateState=false;_this126._StartTicking();return _this126;}_createClass(SDKDOMInstanceBase,[{key:"Release",value:function Release(){this.GetPlugin()._RemoveElement(this._elementId);this.PostToDOMElement("destroy");this._elementId=-1;_get(_getPrototypeOf(SDKDOMInstanceBase.prototype),"Release",this).call(this);}},{key:"_GetElementInDOMMode",value:function _GetElementInDOMMode(){if(this._runtime.IsInWorker())throw new Error("not valid in worker mode");return this._PostToDOMElementMaybeSync("get-element");}},{key:"PostToDOMElement",value:function PostToDOMElement(handler,data){if(!data)data={};data["elementId"]=this._elementId;this.PostToDOM(handler,data);}},{key:"_PostToDOMElementMaybeSync",value:function _PostToDOMElementMaybeSync(handler,data){if(!data)data={};data["elementId"]=this._elementId;return this._PostToDOMMaybeSync(handler,data);}},{key:"PostToDOMElementAsync",value:function PostToDOMElementAsync(handler,data){if(!data)data={};data["elementId"]=this._elementId;return this.PostToDOMAsync(handler,data);}},{key:"CreateElement",value:function CreateElement(data){if(!data)data={};var wi=this.GetWorldInfo();data["elementId"]=this._elementId;data["isVisible"]=wi.IsVisible();data["htmlIndex"]=wi.GetLayer().GetHTMLIndex();data["htmlZIndex"]=wi.GetHTMLZIndex();Object.assign(data,this.GetElementState());this._isElementShowing=!!data["isVisible"];this._PostToDOMMaybeSync("create",data);this._UpdatePosition(true);}},{key:"SetElementVisible",value:function SetElementVisible(v){v=!!v;if(this._isElementShowing===v)return;this._isElementShowing=v;this.PostToDOMElement("set-visible",{"isVisible":v});}},{key:"Tick",value:function Tick(){this._UpdatePosition(false);}},{key:"_ShouldPreserveElement",value:function _ShouldPreserveElement(){var fullscreenMode=this._runtime.GetCanvasManager().GetFullscreenMode();return _C160.Platform.OS==="Android"&&(fullscreenMode==="scale-inner"||fullscreenMode==="scale-outer"||fullscreenMode==="crop");}},{key:"_UpdatePosition",value:function _UpdatePosition(first){if(this.GetInstance().IsDestroyed())return;var wi=this.GetWorldInfo();var layer=wi.GetLayer();var bbox=wi.GetBoundingBox();var _layer$LayerToCanvasC3=layer.LayerToCanvasCss(bbox.getLeft(),bbox.getTop()),_layer$LayerToCanvasC4=_slicedToArray(_layer$LayerToCanvasC3,2),cleft=_layer$LayerToCanvasC4[0],ctop=_layer$LayerToCanvasC4[1];var _layer$LayerToCanvasC5=layer.LayerToCanvasCss(bbox.getRight(),bbox.getBottom()),_layer$LayerToCanvasC6=_slicedToArray(_layer$LayerToCanvasC5,2),cright=_layer$LayerToCanvasC6[0],cbottom=_layer$LayerToCanvasC6[1];var canvasManager=this._runtime.GetCanvasManager();var rightEdge=canvasManager.GetCssWidth();var bottomEdge=canvasManager.GetCssHeight();if(!wi.IsVisible()||!layer.IsVisible()){this.SetElementVisible(false);return;}if(!this._ShouldPreserveElement())if(cright<=0||cbottom<=0||cleft>=rightEdge||ctop>=bottomEdge){this.SetElementVisible(false);return;}_tempRect5.set(cleft,ctop,cright,cbottom);var curWinWidth=canvasManager.GetLastWidth();var curWinHeight=canvasManager.GetLastHeight();var curHTMLIndex=layer.GetHTMLIndex();var curHTMLZIndex=wi.GetHTMLZIndex();if(!first&&_tempRect5.equals(this._lastRect)&&this._lastWindowWidth===curWinWidth&&this._lastWindowHeight===curWinHeight&&this._lastHTMLIndex===curHTMLIndex&&this._lastHTMLZIndex===curHTMLZIndex){this.SetElementVisible(true);return;}this._lastRect.copy(_tempRect5);this._lastWindowWidth=curWinWidth;this._lastWindowHeight=curWinHeight;this._lastHTMLIndex=curHTMLIndex;this._lastHTMLZIndex=curHTMLZIndex;this.SetElementVisible(true);var fontSize=null;if(this._autoFontSize)fontSize=layer.GetDisplayScale()+this._autoFontSizeOffset;this.PostToDOMElement("update-position",{"left":Math.round(this._lastRect.getLeft()),"top":Math.round(this._lastRect.getTop()),"width":Math.round(this._lastRect.width()),"height":Math.round(this._lastRect.height()),"htmlIndex":curHTMLIndex,"htmlZIndex":curHTMLZIndex,"fontSize":fontSize});}},{key:"FocusElement",value:function FocusElement(){this._PostToDOMElementMaybeSync("focus",{"focus":true});}},{key:"BlurElement",value:function BlurElement(){this._PostToDOMElementMaybeSync("focus",{"focus":false});}},{key:"_OnElemFocused",value:function _OnElemFocused(){this._elemHasFocus=true;}},{key:"_OnElemBlurred",value:function _OnElemBlurred(){this._elemHasFocus=false;}},{key:"IsElementFocused",value:function IsElementFocused(){return this._elemHasFocus;}},{key:"SetElementCSSStyle",value:function SetElementCSSStyle(prop,val){this.PostToDOMElement("set-css-style",{"prop":_C160.CSSToCamelCase(prop),"val":val});}},{key:"SetElementAttribute",value:function SetElementAttribute(attribName,value){this.PostToDOMElement("set-attribute",{"name":attribName,"val":value});}},{key:"RemoveElementAttribute",value:function RemoveElementAttribute(attribName){this.PostToDOMElement("remove-attribute",{"name":attribName});}},{key:"UpdateElementState",value:function UpdateElementState(){var _this127=this;if(this._isPendingUpdateState)return;this._isPendingUpdateState=true;Promise.resolve().then(function(){_this127._isPendingUpdateState=false;_this127.PostToDOMElement("update-state",_this127.GetElementState());});}},{key:"GetElementState",value:function GetElementState(){}},{key:"GetElementId",value:function GetElementId(){return this._elementId;}}]);return SDKDOMInstanceBase;}(_C160.SDKWorldInstanceBase);}// sdk/sdkBehaviorBase.js
{'use strict';var _C161=self.C3;var _IBehavior=self.IBehavior;_C161.SDKBehaviorBase=/*#__PURE__*/function(_C161$DefendedBase){_inherits(SDKBehaviorBase,_C161$DefendedBase);function SDKBehaviorBase(opts){var _this128;_classCallCheck(this,SDKBehaviorBase);_this128=_possibleConstructorReturn(this,_getPrototypeOf(SDKBehaviorBase).call(this));_this128._runtime=opts.runtime;_this128._myObjectClasses=_C161.New(_C161.ArraySet);_this128._myInstances=_C161.New(_C161.ArraySet);_this128._iBehavior=null;_this128._scriptInterfaceClass=opts.scriptInterfaceClass||null;return _this128;}_createClass(SDKBehaviorBase,[{key:"Release",value:function Release(){this._myInstances.Release();this._myObjectClasses.Release();this._runtime=null;}},{key:"GetRuntime",value:function GetRuntime(){return this._runtime;}},{key:"OnCreate",value:function OnCreate(){}},{key:"_AddObjectClass",value:function _AddObjectClass(objectClass){this._myObjectClasses.Add(objectClass);}},{key:"GetObjectClasses",value:function GetObjectClasses(){return this._myObjectClasses.GetArray();}},{key:"_AddInstance",value:function _AddInstance(inst){this._myInstances.Add(inst);}},{key:"_RemoveInstance",value:function _RemoveInstance(inst){this._myInstances.Delete(inst);}},{key:"GetInstances",value:function GetInstances(){return this._myInstances.GetArray();}},{key:"GetIBehavior",value:function GetIBehavior(){if(this._iBehavior===null){var CustomScriptClass=this._scriptInterfaceClass;if(CustomScriptClass){this._iBehavior=new CustomScriptClass(this);if(!(this._iBehavior instanceof _IBehavior))throw new TypeError("script interface class must derive from IBehavior");}else this._iBehavior=new _IBehavior(this);}return this._iBehavior;}}]);return SDKBehaviorBase;}(_C161.DefendedBase);}// sdk/sdkBehaviorTypeBase.js
{'use strict';var _C162=self.C3;_C162.SDKBehaviorTypeBase=/*#__PURE__*/function(_C162$DefendedBase){_inherits(SDKBehaviorTypeBase,_C162$DefendedBase);function SDKBehaviorTypeBase(behaviorType){var _this129;_classCallCheck(this,SDKBehaviorTypeBase);_this129=_possibleConstructorReturn(this,_getPrototypeOf(SDKBehaviorTypeBase).call(this));_this129._runtime=behaviorType.GetRuntime();_this129._behaviorType=behaviorType;_this129._objectClass=behaviorType.GetObjectClass();_this129._behavior=behaviorType.GetBehavior();_this129._behavior._AddObjectClass(_this129._objectClass);return _this129;}_createClass(SDKBehaviorTypeBase,[{key:"Release",value:function Release(){this._runtime=null;this._behaviorType=null;this._objectClass=null;this._behavior=null;}},{key:"OnCreate",value:function OnCreate(){}},{key:"GetBehaviorType",value:function GetBehaviorType(){return this._behaviorType;}},{key:"GetObjectClass",value:function GetObjectClass(){return this._objectClass;}},{key:"GetRuntime",value:function GetRuntime(){return this._runtime;}},{key:"GetBehavior",value:function GetBehavior(){return this._behavior;}}]);return SDKBehaviorTypeBase;}(_C162.DefendedBase);}// sdk/sdkBehaviorInstanceBase.js
{'use strict';var _C163=self.C3;_C163.SDKBehaviorInstanceBase=/*#__PURE__*/function(_C163$DefendedBase){_inherits(SDKBehaviorInstanceBase,_C163$DefendedBase);function SDKBehaviorInstanceBase(behInst,domComponentId){var _this130;_classCallCheck(this,SDKBehaviorInstanceBase);_this130=_possibleConstructorReturn(this,_getPrototypeOf(SDKBehaviorInstanceBase).call(this));_this130._behInst=behInst;_this130._domComponentId=domComponentId;_this130._inst=behInst.GetObjectInstance();_this130._runtime=behInst.GetRuntime();_this130._behaviorType=behInst.GetBehaviorType();_this130._sdkType=_this130._behaviorType.GetSdkType();_this130._isTicking=false;_this130._isTicking2=false;_this130._isPostTicking=false;_this130._disposables=null;return _this130;}_createClass(SDKBehaviorInstanceBase,[{key:"Release",value:function Release(){this._StopTicking();this._StopTicking2();this._StopPostTicking();if(this._disposables){this._disposables.Release();this._disposables=null;}this._behInst=null;this._inst=null;this._runtime=null;this._behaviorType=null;this._sdkType=null;}},{key:"GetBehavior",value:function GetBehavior(){return this._behaviorType.GetBehavior();}},{key:"GetBehaviorInstance",value:function GetBehaviorInstance(){return this._behInst;}},{key:"GetObjectInstance",value:function GetObjectInstance(){return this._inst;}},{key:"GetObjectClass",value:function GetObjectClass(){return this._inst.GetObjectClass();}},{key:"GetWorldInfo",value:function GetWorldInfo(){return this._inst.GetWorldInfo();}},{key:"GetRuntime",value:function GetRuntime(){return this._runtime;}},{key:"GetBehaviorType",value:function GetBehaviorType(){return this._behaviorType;}},{key:"GetSdkType",value:function GetSdkType(){return this._sdkType;}},{key:"GetScriptInterface",value:function GetScriptInterface(){return this._behInst.GetScriptInterface();}},{key:"Trigger",value:function Trigger(method){return this._runtime.Trigger(method,this._inst,this._behaviorType);}},{key:"DebugTrigger",value:function DebugTrigger(method){return this._runtime.DebugTrigger(method,this._inst,this._behaviorType);}},{key:"TriggerAsync",value:function TriggerAsync(method){return this._runtime.TriggerAsync(method,this._inst,this._behaviorType);}},{key:"PostCreate",value:function PostCreate(){}},{key:"Tick",value:function Tick(){}},{key:"Tick2",value:function Tick2(){}},{key:"PostTick",value:function PostTick(){}},{key:"_StartTicking",value:function _StartTicking(){if(this._isTicking)return;this._runtime._AddBehInstToTick(this);this._isTicking=true;}},{key:"_StopTicking",value:function _StopTicking(){if(!this._isTicking)return;this._runtime._RemoveBehInstToTick(this);this._isTicking=false;}},{key:"IsTicking",value:function IsTicking(){return this._isTicking;}},{key:"_StartTicking2",value:function _StartTicking2(){if(this._isTicking2)return;this._runtime._AddBehInstToTick2(this);this._isTicking2=true;}},{key:"_StopTicking2",value:function _StopTicking2(){if(!this._isTicking2)return;this._runtime._RemoveBehInstToTick2(this);this._isTicking2=false;}},{key:"IsTicking2",value:function IsTicking2(){return this._isTicking2;}},{key:"_StartPostTicking",value:function _StartPostTicking(){if(this._isPostTicking)return;this._runtime._AddBehInstToPostTick(this);this._isPostTicking=true;}},{key:"_StopPostTicking",value:function _StopPostTicking(){if(!this._isPostTicking)return;this._runtime._RemoveBehInstToPostTick(this);this._isPostTicking=false;}},{key:"IsPostTicking",value:function IsPostTicking(){return this._isPostTicking;}},{key:"GetDebuggerProperties",value:function GetDebuggerProperties(){return[];}},{key:"AddDOMMessageHandler",value:function AddDOMMessageHandler(handler,func){this._runtime.AddDOMComponentMessageHandler(this._domComponentId,handler,func);}},{key:"OnSpriteFrameChanged",value:function OnSpriteFrameChanged(prevFrame,nextFrame){}},{key:"SaveToJson",value:function SaveToJson(){return null;}},{key:"LoadFromJson",value:function LoadFromJson(o){}},{key:"GetPropertyValueByIndex",value:function GetPropertyValueByIndex(index){}},{key:"SetPropertyValueByIndex",value:function SetPropertyValueByIndex(index,value){}},{key:"OffsetPropertyValueByIndex",value:function OffsetPropertyValueByIndex(index,offset){if(offset===0)return;var value=this.GetPropertyValueByIndex(index);if(typeof value!=="number")throw new Error("expected number");this.SetPropertyValueByIndex(index,value+offset);}},{key:"SetPropertyColorOffsetValueByIndex",value:function SetPropertyColorOffsetValueByIndex(index,offsetR,offsetG,offsetB){}},{key:"CallAction",value:function CallAction(actMethod){for(var _len49=arguments.length,args=new Array(_len49>1?_len49-1:0),_key34=1;_key34<_len49;_key34++){args[_key34-1]=arguments[_key34];}actMethod.call.apply(actMethod,[this].concat(args));}},{key:"CallExpression",value:function CallExpression(expMethod){for(var _len50=arguments.length,args=new Array(_len50>1?_len50-1:0),_key35=1;_key35<_len50;_key35++){args[_key35-1]=arguments[_key35];}return expMethod.call.apply(expMethod,[this].concat(args));}},{key:"GetScriptInterfaceClass",value:function GetScriptInterfaceClass(){return null;}},{key:"DispatchScriptEvent",value:function DispatchScriptEvent(name,cancelable,additionalProperties){if(!this._behInst.HasScriptInterface())return;var scriptInterface=this.GetScriptInterface();var e=_C163.New(_C163.Event,name,cancelable);e.behaviorInstance=scriptInterface;e.instance=scriptInterface.instance;if(additionalProperties)Object.assign(e,additionalProperties);scriptInterface.dispatchEvent(e);}}]);return SDKBehaviorInstanceBase;}(_C163.DefendedBase);}// objects/pluginManager.js
{'use strict';var _C164=self.C3;_C164.Plugins={};_C164.Behaviors={};_C164.PluginManager=/*#__PURE__*/function(_C164$DefendedBase){_inherits(PluginManager,_C164$DefendedBase);function PluginManager(runtime,wrapperComponentIds){var _this131;_classCallCheck(this,PluginManager);_this131=_possibleConstructorReturn(this,_getPrototypeOf(PluginManager).call(this));_this131._runtime=runtime;_this131._allPlugins=[];_this131._pluginsByCtor=new Map();_this131._systemPlugin=null;_this131._allBehaviors=[];_this131._behaviorsByCtor=new Map();_this131._solidBehavior=null;_this131._jumpthruBehavior=null;_this131._wrapperComponentIds=new Set(wrapperComponentIds);return _this131;}_createClass(PluginManager,[{key:"CreatePlugin",value:function CreatePlugin(pluginData){var Ctor=this._runtime.GetObjectReference(pluginData[0]);if(!Ctor)throw new Error("missing plugin");_C164.AddCommonACEs(pluginData,Ctor);var plugin=_C164.New(Ctor,{runtime:this._runtime,isSingleGlobal:pluginData[1],isWorld:pluginData[2],isRotatable:pluginData[5],hasEffects:pluginData[8],mustPredraw:pluginData[9],supportsSceneGraph:pluginData[13],supportsMesh:pluginData[14],isHTMLElementType:pluginData[17]});plugin.OnCreate();this._allPlugins.push(plugin);this._pluginsByCtor.set(Ctor,plugin);}},{key:"CreateSystemPlugin",value:function CreateSystemPlugin(){this._systemPlugin=_C164.New(_C164.Plugins.System,{runtime:this._runtime,isSingleGlobal:true});this._systemPlugin.OnCreate();}},{key:"CreateBehavior",value:function CreateBehavior(behaviorData){var Ctor=this._runtime.GetObjectReference(behaviorData[1]);if(!Ctor)throw new Error("missing behavior");var behavior=_C164.New(Ctor,{runtime:this._runtime});behavior.OnCreate();this._allBehaviors.push(behavior);this._behaviorsByCtor.set(Ctor,behavior);if(!this._solidBehavior&&_C164.Behaviors.solid&&behavior instanceof _C164.Behaviors.solid)this._solidBehavior=behavior;else if(!this._jumpthruBehavior&&_C164.Behaviors.jumpthru&&behavior instanceof _C164.Behaviors.jumpthru)this._jumpthruBehavior=behavior;}},{key:"GetPluginByConstructorFunction",value:function GetPluginByConstructorFunction(ctor){return this._pluginsByCtor.get(ctor)||null;}},{key:"HasBehaviorByConstructorFunction",value:function HasBehaviorByConstructorFunction(ctor){return this._behaviorsByCtor.has(ctor);}},{key:"GetBehaviorByConstructorFunction",value:function GetBehaviorByConstructorFunction(ctor){return this._behaviorsByCtor.get(ctor)||null;}},{key:"GetSystemPlugin",value:function GetSystemPlugin(){return this._systemPlugin;}},{key:"GetSolidBehavior",value:function GetSolidBehavior(){return this._solidBehavior;}},{key:"GetJumpthruBehavior",value:function GetJumpthruBehavior(){return this._jumpthruBehavior;}},{key:"HasWrapperComponentId",value:function HasWrapperComponentId(id){return this._wrapperComponentIds.has(id);}}]);return PluginManager;}(_C164.DefendedBase);}// objects/imageInfo.js
{'use strict';var _C165=self.C3;var allImageInfos=new Set();_C165.ImageInfo=/*#__PURE__*/function(_C165$DefendedBase){_inherits(ImageInfo,_C165$DefendedBase);function ImageInfo(){var _this132;_classCallCheck(this,ImageInfo);_this132=_possibleConstructorReturn(this,_getPrototypeOf(ImageInfo).call(this));_this132._generation=0;_this132._url="";_this132._size=0;_this132._offsetX=0;_this132._offsetY=0;_this132._width=0;_this132._height=0;_this132._isRotated=false;_this132._hasMetaData=false;_this132._imageAsset=null;_this132._textureState="";_this132._rcTex=_C165.New(_C165.Rect);_this132._quadTex=_C165.New(_C165.Quad);_this132._blobUrl="";_this132._iImageInfo=new self.IImageInfo(_assertThisInitialized(_this132));allImageInfos.add(_assertThisInitialized(_this132));return _this132;}_createClass(ImageInfo,[{key:"Release",value:function Release(){this.ReleaseTexture();this._imageAsset=null;allImageInfos["delete"](this);this.ReleaseBlobURL();}},{key:"LoadData",value:function LoadData(imageData){this._url=imageData[0];this._size=imageData[1];this._offsetX=imageData[2];this._offsetY=imageData[3];this._width=imageData[4];this._height=imageData[5];this._isRotated=imageData[6];this._hasMetaData=true;}},{key:"LoadDynamicAsset",value:function LoadDynamicAsset(runtime,url){if(this._imageAsset)throw new Error("already loaded asset");this._url=url;var opts={};if(_C165.IsAbsoluteURL(url))opts.loadPolicy="remote";this.LoadAsset(runtime,opts);return this._imageAsset.Load();}},{key:"LoadDynamicBlobAsset",value:function LoadDynamicBlobAsset(runtime,blob){return regeneratorRuntime.async(function LoadDynamicBlobAsset$(_context157){while(1){switch(_context157.prev=_context157.next){case 0:if(!this._imageAsset){_context157.next=2;break;}throw new Error("already loaded asset");case 2:this._url="";this._size=blob.size;this._imageAsset=_C165.New(_C165.ImageAsset,runtime.GetAssetManager(),{blob:blob,size:this._size,loadPolicy:"local"});case 5:case"end":return _context157.stop();}}},null,this);}},{key:"ReplaceWith",value:function ReplaceWith(otherImageInfo){if(otherImageInfo===this)throw new Error("cannot replace with self");this._generation++;this.ReleaseTexture();this._url=otherImageInfo._url;this._size=otherImageInfo._size;this._offsetX=otherImageInfo._offsetX;this._offsetY=otherImageInfo._offsetY;this._width=otherImageInfo._width;this._height=otherImageInfo._height;this._isRotated=otherImageInfo._isRotated;this._hasMetaData=otherImageInfo._hasMetaData;this._imageAsset=otherImageInfo._imageAsset;this._textureState=otherImageInfo._textureState;this._rcTex=otherImageInfo._rcTex;this._quadTex=otherImageInfo._quadTex;this.ReleaseBlobURL();}},{key:"GetURL",value:function GetURL(){return this._url;}},{key:"GetSize",value:function GetSize(){return this._size;}},{key:"GetOffsetX",value:function GetOffsetX(){return this._offsetX;}},{key:"GetOffsetY",value:function GetOffsetY(){return this._offsetY;}},{key:"IsRotated",value:function IsRotated(){return this._isRotated;}},{key:"GetWidth",value:function GetWidth(){return this._width;}},{key:"GetHeight",value:function GetHeight(){return this._height;}},{key:"GetSheetWidth",value:function GetSheetWidth(){return this._imageAsset.GetWidth();}},{key:"GetSheetHeight",value:function GetSheetHeight(){return this._imageAsset.GetHeight();}},{key:"LoadAsset",value:function LoadAsset(runtime,opts){if(this._imageAsset)throw new Error("already got asset");opts=Object.assign({},opts,{url:this.GetURL(),size:this.GetSize()});this._imageAsset=runtime.LoadImage(opts);}},{key:"IsLoaded",value:function IsLoaded(){return this._imageAsset&&this._imageAsset.IsLoaded();}},{key:"LoadStaticTexture",value:function LoadStaticTexture(renderer,opts){var startGeneration,texture,wr,hr;return regeneratorRuntime.async(function LoadStaticTexture$(_context158){while(1){switch(_context158.prev=_context158.next){case 0:if(this._imageAsset){_context158.next=2;break;}throw new Error("no asset");case 2:if(!this._textureState){_context158.next=4;break;}throw new Error("already loaded texture");case 4:startGeneration=this._generation;this._textureState="loading";_context158.next=8;return regeneratorRuntime.awrap(this._imageAsset.LoadStaticTexture(renderer,opts));case 8:texture=_context158.sent;if(!(this._generation!==startGeneration)){_context158.next=11;break;}return _context158.abrupt("return",null);case 11:if(texture){_context158.next=14;break;}this._textureState="";return _context158.abrupt("return",null);case 14:this._textureState="loaded";if(!this._hasMetaData){this._width=texture.GetWidth();this._height=texture.GetHeight();this._hasMetaData=true;}wr=this._isRotated?this._height:this._width;hr=this._isRotated?this._width:this._height;this._rcTex.set(this._offsetX,this._offsetY,this._offsetX+wr,this._offsetY+hr);this._rcTex.divide(texture.GetWidth(),texture.GetHeight());this._quadTex.setFromRect(this._rcTex);if(this._isRotated)this._quadTex.rotatePointsAnticlockwise();return _context158.abrupt("return",texture);case 23:case"end":return _context158.stop();}}},null,this);}},{key:"ReleaseTexture",value:function ReleaseTexture(){if(!this._textureState)return;if(this._imageAsset)this._imageAsset.ReleaseTexture();this._textureState="";this._rcTex.set(0,0,0,0);this._quadTex.setFromRect(this._rcTex);}},{key:"GetTexture",value:function GetTexture(){return this._imageAsset&&this._textureState==="loaded"?this._imageAsset.GetTexture():null;}},{key:"GetTexRect",value:function GetTexRect(){return this._rcTex;}},{key:"GetTexQuad",value:function GetTexQuad(){return this._quadTex;}},{key:"GetIImageInfo",value:function GetIImageInfo(){return this._iImageInfo;}},{key:"GetImageAsset",value:function GetImageAsset(){return this._imageAsset;}},{key:"ExtractImageToCanvas",value:function ExtractImageToCanvas(drawable){var canvas,ctx;return regeneratorRuntime.async(function ExtractImageToCanvas$(_context159){while(1){switch(_context159.prev=_context159.next){case 0:if(drawable){_context159.next=4;break;}_context159.next=3;return regeneratorRuntime.awrap(this._imageAsset.LoadToDrawable());case 3:drawable=_context159.sent;case 4:canvas=_C165.CreateCanvas(this._width,this._height);ctx=canvas.getContext("2d");if(this._isRotated){ctx.rotate(Math.PI/-2);ctx.translate(-this._height,0);ctx.drawImage(drawable,this._offsetX,this._offsetY,this._height,this._width,0,0,this._height,this._width);}else ctx.drawImage(drawable,this._offsetX,this._offsetY,this._width,this._height,0,0,this._width,this._height);return _context159.abrupt("return",canvas);case 8:case"end":return _context159.stop();}}},null,this);}},{key:"ExtractImageToBlobURL",value:function ExtractImageToBlobURL(drawable){var canvas,blob;return regeneratorRuntime.async(function ExtractImageToBlobURL$(_context160){while(1){switch(_context160.prev=_context160.next){case 0:if(!this._blobUrl){_context160.next=2;break;}return _context160.abrupt("return",this._blobUrl);case 2:_context160.next=4;return regeneratorRuntime.awrap(this.ExtractImageToCanvas(drawable));case 4:canvas=_context160.sent;_context160.next=7;return regeneratorRuntime.awrap(_C165.CanvasToBlob(canvas));case 7:blob=_context160.sent;this._blobUrl=URL.createObjectURL(blob);return _context160.abrupt("return",this._blobUrl);case 10:case"end":return _context160.stop();}}},null,this);}},{key:"ReleaseBlobURL",value:function ReleaseBlobURL(){if(this._blobUrl){URL.revokeObjectURL(this._blobUrl);this._blobUrl="";}}}],[{key:"OnRendererContextLost",value:function OnRendererContextLost(){var _iteratorNormalCompletion410=true;var _didIteratorError410=false;var _iteratorError410=undefined;try{for(var _iterator410=allImageInfos[Symbol.iterator](),_step410;!(_iteratorNormalCompletion410=(_step410=_iterator410.next()).done);_iteratorNormalCompletion410=true){var imageInfo=_step410.value;imageInfo._textureState="";imageInfo._rcTex.set(0,0,0,0);imageInfo._quadTex.setFromRect(imageInfo._rcTex);}}catch(err){_didIteratorError410=true;_iteratorError410=err;}finally{try{if(!_iteratorNormalCompletion410&&_iterator410["return"]!=null){_iterator410["return"]();}}finally{if(_didIteratorError410){throw _iteratorError410;}}}}}]);return ImageInfo;}(_C165.DefendedBase);}// objects/animationInfo.js
{'use strict';var _C166=self.C3;_C166.AnimationInfo=/*#__PURE__*/function(_C166$DefendedBase){_inherits(AnimationInfo,_C166$DefendedBase);function AnimationInfo(animData){var _this133;_classCallCheck(this,AnimationInfo);_this133=_possibleConstructorReturn(this,_getPrototypeOf(AnimationInfo).call(this));_this133._name=animData[0];_this133._speed=animData[1];_this133._isLooping=!!animData[2];_this133._repeatCount=animData[3];_this133._repeatTo=animData[4];_this133._isPingPong=!!animData[5];_this133._sid=animData[6];_this133._frames=animData[7].map(function(frameData){return _C166.New(_C166.AnimationFrameInfo,frameData);});_this133._iAnimation=new self.IAnimation(_assertThisInitialized(_this133));return _this133;}_createClass(AnimationInfo,[{key:"Release",value:function Release(){var _iteratorNormalCompletion411=true;var _didIteratorError411=false;var _iteratorError411=undefined;try{for(var _iterator411=this._frames[Symbol.iterator](),_step411;!(_iteratorNormalCompletion411=(_step411=_iterator411.next()).done);_iteratorNormalCompletion411=true){var f=_step411.value;f.Release();}}catch(err){_didIteratorError411=true;_iteratorError411=err;}finally{try{if(!_iteratorNormalCompletion411&&_iterator411["return"]!=null){_iterator411["return"]();}}finally{if(_didIteratorError411){throw _iteratorError411;}}}_C166.clearArray(this._frames);}},{key:"LoadAllAssets",value:function LoadAllAssets(runtime){var _iteratorNormalCompletion412=true;var _didIteratorError412=false;var _iteratorError412=undefined;try{for(var _iterator412=this._frames[Symbol.iterator](),_step412;!(_iteratorNormalCompletion412=(_step412=_iterator412.next()).done);_iteratorNormalCompletion412=true){var f=_step412.value;f.GetImageInfo().LoadAsset(runtime);}}catch(err){_didIteratorError412=true;_iteratorError412=err;}finally{try{if(!_iteratorNormalCompletion412&&_iterator412["return"]!=null){_iterator412["return"]();}}finally{if(_didIteratorError412){throw _iteratorError412;}}}}},{key:"LoadAllTextures",value:function LoadAllTextures(renderer,opts){return Promise.all(this._frames.map(function(f){return f.GetImageInfo().LoadStaticTexture(renderer,opts);}));}},{key:"ReleaseAllTextures",value:function ReleaseAllTextures(){var _iteratorNormalCompletion413=true;var _didIteratorError413=false;var _iteratorError413=undefined;try{for(var _iterator413=this._frames[Symbol.iterator](),_step413;!(_iteratorNormalCompletion413=(_step413=_iterator413.next()).done);_iteratorNormalCompletion413=true){var f=_step413.value;f.GetImageInfo().ReleaseTexture();}}catch(err){_didIteratorError413=true;_iteratorError413=err;}finally{try{if(!_iteratorNormalCompletion413&&_iterator413["return"]!=null){_iterator413["return"]();}}finally{if(_didIteratorError413){throw _iteratorError413;}}}}},{key:"GetName",value:function GetName(){return this._name;}},{key:"GetSID",value:function GetSID(){return this._sid;}},{key:"GetFrameCount",value:function GetFrameCount(){return this._frames.length;}},{key:"GetFrames",value:function GetFrames(){return this._frames;}},{key:"GetFrameAt",value:function GetFrameAt(i){i=Math.floor(i);if(i<0||i>=this._frames.length)throw new RangeError("invalid frame");return this._frames[i];}},{key:"GetFrameIndexByTag",value:function GetFrameIndexByTag(tag){for(var i=0,len=this._frames.length;i<len;++i){if(_C166.equalsNoCase(this._frames[i].GetTag(),tag))return i;}return-1;}},{key:"GetSpeed",value:function GetSpeed(){return this._speed;}},{key:"IsLooping",value:function IsLooping(){return this._isLooping;}},{key:"GetRepeatCount",value:function GetRepeatCount(){return this._repeatCount;}},{key:"GetRepeatTo",value:function GetRepeatTo(){return this._repeatTo;}},{key:"IsPingPong",value:function IsPingPong(){return this._isPingPong;}},{key:"GetIAnimation",value:function GetIAnimation(){return this._iAnimation;}}]);return AnimationInfo;}(_C166.DefendedBase);}// objects/animationFrameInfo.js
{'use strict';var _C167=self.C3;_C167.AnimationFrameInfo=/*#__PURE__*/function(_C167$DefendedBase){_inherits(AnimationFrameInfo,_C167$DefendedBase);function AnimationFrameInfo(frameData){var _this134;_classCallCheck(this,AnimationFrameInfo);_this134=_possibleConstructorReturn(this,_getPrototypeOf(AnimationFrameInfo).call(this));_this134._imageInfo=_C167.New(_C167.ImageInfo);_this134._imageInfo.LoadData(frameData);_this134._duration=frameData[7];_this134._origin=_C167.New(_C167.Vector2,frameData[8],frameData[9]);_this134._imagePoints=frameData[10].map(function(data){return _C167.New(_C167.ImagePoint,_assertThisInitialized(_this134),data);});_this134._imagePointsByName=new Map();var _iteratorNormalCompletion414=true;var _didIteratorError414=false;var _iteratorError414=undefined;try{for(var _iterator414=_this134._imagePoints[Symbol.iterator](),_step414;!(_iteratorNormalCompletion414=(_step414=_iterator414.next()).done);_iteratorNormalCompletion414=true){var ip=_step414.value;_this134._imagePointsByName.set(ip.GetName().toLowerCase(),ip);}}catch(err){_didIteratorError414=true;_iteratorError414=err;}finally{try{if(!_iteratorNormalCompletion414&&_iterator414["return"]!=null){_iterator414["return"]();}}finally{if(_didIteratorError414){throw _iteratorError414;}}}_this134._collisionPoly=null;var polyPoints=frameData[11];if(polyPoints.length>=6)_this134._collisionPoly=_C167.New(_C167.CollisionPoly,polyPoints);_this134._tag=frameData[12]?frameData[12]:"";_this134._iAnimationFrame=new self.IAnimationFrame(_assertThisInitialized(_this134));return _this134;}_createClass(AnimationFrameInfo,[{key:"Release",value:function Release(){if(this._collisionPoly){this._collisionPoly.Release();this._collisionPoly=null;}this._imageInfo.Release();this._imageInfo=null;}},{key:"GetImageInfo",value:function GetImageInfo(){return this._imageInfo;}},{key:"GetDuration",value:function GetDuration(){return this._duration;}},{key:"GetOriginX",value:function GetOriginX(){return this._origin.getX();}},{key:"GetOriginY",value:function GetOriginY(){return this._origin.getY();}},{key:"GetCollisionPoly",value:function GetCollisionPoly(){return this._collisionPoly;}},{key:"GetImagePointByName",value:function GetImagePointByName(name){return this._imagePointsByName.get(name.toLowerCase())||null;}},{key:"GetImagePointByIndex",value:function GetImagePointByIndex(index){index=Math.floor(index);if(index<0||index>=this._imagePoints.length)return null;return this._imagePoints[index];}},{key:"GetImagePointCount",value:function GetImagePointCount(){return this._imagePoints.length;}},{key:"GetTag",value:function GetTag(){return this._tag;}},{key:"GetIAnimationFrame",value:function GetIAnimationFrame(){return this._iAnimationFrame;}}]);return AnimationFrameInfo;}(_C167.DefendedBase);}// objects/imagePoint.js
{'use strict';var _C168=self.C3;_C168.ImagePoint=/*#__PURE__*/function(_C168$DefendedBase){_inherits(ImagePoint,_C168$DefendedBase);function ImagePoint(afi,data){var _this135;_classCallCheck(this,ImagePoint);_this135=_possibleConstructorReturn(this,_getPrototypeOf(ImagePoint).call(this));_this135._afi=afi;_this135._name=data[0];_this135._pos=_C168.New(_C168.Vector2,data[1],data[2]);return _this135;}_createClass(ImagePoint,[{key:"Release",value:function Release(){}},{key:"GetName",value:function GetName(){return this._name;}},{key:"GetX",value:function GetX(){return this._pos.getX();}},{key:"GetY",value:function GetY(){return this._pos.getY();}},{key:"GetVec2",value:function GetVec2(){return this._pos;}}]);return ImagePoint;}(_C168.DefendedBase);}// objects/objectClass.js
{'use strict';var _C169=self.C3;var _C3Debugger=self.C3Debugger;var _IObjectClass=self.IObjectClass;var _assert16=self.assert;_C169.ObjectClass=/*#__PURE__*/function(_C169$DefendedBase){_inherits(ObjectClass,_C169$DefendedBase);function ObjectClass(runtime,index,data){var _this136;_classCallCheck(this,ObjectClass);_this136=_possibleConstructorReturn(this,_getPrototypeOf(ObjectClass).call(this));var PluginCtor=runtime.GetObjectReference(data[1]);_this136._runtime=runtime;_this136._plugin=runtime.GetPluginManager().GetPluginByConstructorFunction(PluginCtor);_this136._sdkType=null;_this136._instSdkCtor=PluginCtor.Instance;_this136._index=index;_this136._sid=data[11];_this136._name=data[0];_this136._jsPropName=_this136._runtime.GetJsPropName(data[14]);_this136._isGlobal=!!data[9];_this136._isFamily=!!data[2];_this136._isOnLoaderLayout=!!data[10];_this136._instVars=data[3].map(function(arr){return{sid:arr[0],type:arr[1],name:arr[2],jsPropName:runtime.GetJsPropName(arr[3])};});_this136._behaviorsCount=data[4];_this136._effectsCount=data[5];_this136._isWorldType=_this136._plugin.IsWorldType();_this136._dispatcher=_C169.New(_C169.Event.Dispatcher);_this136._effectList=null;var _runtime$GetCollision=runtime.GetCollisionEngine().GetCollisionCellSize(),_runtime$GetCollision2=_slicedToArray(_runtime$GetCollision,2),collisionCellWidth=_runtime$GetCollision2[0],collisionCellHeight=_runtime$GetCollision2[1];_this136._collisionGrid=_C169.New(_C169.SparseGrid,collisionCellWidth,collisionCellHeight);_this136._anyCollisionCellChanged=true;_this136._anyInstanceParallaxed=false;_this136._familyMembers=null;_this136._familyMembersSet=null;_this136._familyIndex=-1;_this136._families=null;_this136._familiesSet=null;_this136._familyInstVarMap=null;_this136._familyBehaviorMap=null;_this136._familyEffectMap=null;_this136._isInContainer=false;_this136._container=null;_this136._behaviorTypes=data[8].map(function(behaviorTypeData){return _C169.BehaviorType.Create(_assertThisInitialized(_this136),behaviorTypeData);});_this136._behaviorTypesIncludingInherited=[];_this136._behaviorsByName=new Map();_this136._behaviorNameToIndex=new Map();_this136._usedBehaviorCtors=new Set();_this136._customActionMap=new Map();_this136._solStack=_C169.New(_C169.SolStack,_assertThisInitialized(_this136));_this136._defaultInstanceData=null;_this136._defaultLayerIndex=0;_this136._isContained=false;_this136._container=null;_this136._imageInfo=null;_this136._animations=null;_this136._animationsByName=null;_this136._animationsBySid=null;_this136._textureRefCount=0;_this136._savedData=new Map();_this136._unsavedData=new Map();_this136._instances=[];_this136._iidsStale=true;if(_this136._plugin.HasEffects())_this136._effectList=_C169.New(_C169.EffectList,_assertThisInitialized(_this136),data[12]);if(data[6]){_this136._imageInfo=_C169.New(_C169.ImageInfo);_this136._imageInfo.LoadData(data[6]);}if(data[7]){_this136._animations=data[7].map(function(animData){return _C169.New(_C169.AnimationInfo,animData);});_this136._animationsByName=new Map();_this136._animationsBySid=new Map();var _iteratorNormalCompletion415=true;var _didIteratorError415=false;var _iteratorError415=undefined;try{for(var _iterator415=_this136._animations[Symbol.iterator](),_step415;!(_iteratorNormalCompletion415=(_step415=_iterator415.next()).done);_iteratorNormalCompletion415=true){var anim=_step415.value;_this136._animationsByName.set(anim.GetName().toLowerCase(),anim);_this136._animationsBySid.set(anim.GetSID(),anim);}}catch(err){_didIteratorError415=true;_iteratorError415=err;}finally{try{if(!_iteratorNormalCompletion415&&_iterator415["return"]!=null){_iterator415["return"]();}}finally{if(_didIteratorError415){throw _iteratorError415;}}}}if(_this136._isFamily){_this136._familyMembers=[];_this136._familyMembersSet=new Set();_this136._familyIndex=_this136._runtime._GetNextFamilyIndex();}else{_this136._families=[];_this136._familiesSet=new Set();_this136._familyInstVarMap=[];_this136._familyBehaviorMap=[];_this136._familyEffectMap=[];}_this136._sdkType=_C169.New(PluginCtor.Type,_assertThisInitialized(_this136),data[15]);_this136._iObjectClass=null;_this136._instanceUserScriptClass=null;_this136._userScriptDispatcher=_C169.New(_C169.Event.Dispatcher);var CustomScriptClass=_this136._sdkType.GetScriptInterfaceClass();if(CustomScriptClass){_this136._iObjectClass=new CustomScriptClass(_assertThisInitialized(_this136));if(!(_this136._iObjectClass instanceof _IObjectClass))throw new TypeError("script interface class must derive from IObjectClass");}else _this136._iObjectClass=new _IObjectClass(_assertThisInitialized(_this136));if(data[13]){var tilemapData=data[13];if(tilemapData){var tilePolyData=tilemapData[0];var maxTileIndex=tilemapData[1];var brushData=tilemapData[2];_this136._sdkType.LoadTilemapData(tilePolyData,maxTileIndex,brushData);}}if(!_this136._runtime.UsesLoaderLayout()||_this136._isFamily||_this136._isOnLoaderLayout||!_this136._isWorldType)_this136.OnCreate();if(_this136._plugin.IsSingleGlobal()){_this136._plugin._SetSingleGlobalObjectClass(_assertThisInitialized(_this136));_this136._CreateSingleGlobalInstance(data);}_this136._loadInstancesJson=null;return _this136;}_createClass(ObjectClass,[{key:"Release",value:function Release(){this._dispatcher.Release();this._dispatcher=null;if(this._imageInfo){this._imageInfo.Release();this._imageInfo=null;}if(this._animations){var _iteratorNormalCompletion416=true;var _didIteratorError416=false;var _iteratorError416=undefined;try{for(var _iterator416=this._animations[Symbol.iterator](),_step416;!(_iteratorNormalCompletion416=(_step416=_iterator416.next()).done);_iteratorNormalCompletion416=true){var _a10=_step416.value;_a10.Release();}}catch(err){_didIteratorError416=true;_iteratorError416=err;}finally{try{if(!_iteratorNormalCompletion416&&_iterator416["return"]!=null){_iterator416["return"]();}}finally{if(_didIteratorError416){throw _iteratorError416;}}}_C169.clearArray(this._animations);this._animationsByName.clear();this._animationsBySid.clear();}this._loadInstancesJson=null;this._solStack.Release();this._solStack=null;this._savedData.clear();this._unsavedData.clear();this._container=null;this._runtime=null;}},{key:"_LoadFamily",value:function _LoadFamily(familyData){for(var i=1,len=familyData.length;i<len;++i){var memberType=this._runtime.GetObjectClassByIndex(familyData[i]);this._familyMembers.push(memberType);this._familyMembersSet.add(memberType);memberType._families.push(this);memberType._familiesSet.add(this);}}},{key:"_SetContainer",value:function _SetContainer(container){this._isInContainer=true;this._container=container;}},{key:"IsInContainer",value:function IsInContainer(){return this._isInContainer;}},{key:"GetContainer",value:function GetContainer(){return this._container;}},{key:"_OnAfterCreate",value:function _OnAfterCreate(){var index=0;if(!this._isFamily){var _iteratorNormalCompletion417=true;var _didIteratorError417=false;var _iteratorError417=undefined;try{for(var _iterator417=this._families[Symbol.iterator](),_step417;!(_iteratorNormalCompletion417=(_step417=_iterator417.next()).done);_iteratorNormalCompletion417=true){var family=_step417.value;var _iteratorNormalCompletion418=true;var _didIteratorError418=false;var _iteratorError418=undefined;try{for(var _iterator418=family.GetBehaviorTypes()[Symbol.iterator](),_step418;!(_iteratorNormalCompletion418=(_step418=_iterator418.next()).done);_iteratorNormalCompletion418=true){var familyBehType=_step418.value;var lowerName=familyBehType.GetName().toLowerCase();this._behaviorsByName.set(lowerName,familyBehType);this._behaviorNameToIndex.set(lowerName,index);this._behaviorTypesIncludingInherited.push(familyBehType);++index;}}catch(err){_didIteratorError418=true;_iteratorError418=err;}finally{try{if(!_iteratorNormalCompletion418&&_iterator418["return"]!=null){_iterator418["return"]();}}finally{if(_didIteratorError418){throw _iteratorError418;}}}}}catch(err){_didIteratorError417=true;_iteratorError417=err;}finally{try{if(!_iteratorNormalCompletion417&&_iterator417["return"]!=null){_iterator417["return"]();}}finally{if(_didIteratorError417){throw _iteratorError417;}}}}var _iteratorNormalCompletion419=true;var _didIteratorError419=false;var _iteratorError419=undefined;try{for(var _iterator419=this.GetBehaviorTypes()[Symbol.iterator](),_step419;!(_iteratorNormalCompletion419=(_step419=_iterator419.next()).done);_iteratorNormalCompletion419=true){var behaviorType=_step419.value;var _lowerName=behaviorType.GetName().toLowerCase();this._behaviorsByName.set(_lowerName,behaviorType);this._behaviorNameToIndex.set(_lowerName,index);this._behaviorTypesIncludingInherited.push(behaviorType);++index;}}catch(err){_didIteratorError419=true;_iteratorError419=err;}finally{try{if(!_iteratorNormalCompletion419&&_iterator419["return"]!=null){_iterator419["return"]();}}finally{if(_didIteratorError419){throw _iteratorError419;}}}var _iteratorNormalCompletion420=true;var _didIteratorError420=false;var _iteratorError420=undefined;try{for(var _iterator420=this._behaviorTypesIncludingInherited[Symbol.iterator](),_step420;!(_iteratorNormalCompletion420=(_step420=_iterator420.next()).done);_iteratorNormalCompletion420=true){var _behaviorType=_step420.value;this._usedBehaviorCtors.add(_behaviorType.GetBehavior().constructor);}}catch(err){_didIteratorError420=true;_iteratorError420=err;}finally{try{if(!_iteratorNormalCompletion420&&_iterator420["return"]!=null){_iterator420["return"]();}}finally{if(_didIteratorError420){throw _iteratorError420;}}}if(!this._isFamily&&this._families.length){var familyCount=this._runtime.GetFamilyCount();_C169.extendArray(this._familyInstVarMap,familyCount,0);_C169.extendArray(this._familyBehaviorMap,familyCount,0);_C169.extendArray(this._familyEffectMap,familyCount,0);var allFx=[];var ivSum=0;var behSum=0;var fxSum=0;var _iteratorNormalCompletion421=true;var _didIteratorError421=false;var _iteratorError421=undefined;try{for(var _iterator421=this._families[Symbol.iterator](),_step421;!(_iteratorNormalCompletion421=(_step421=_iterator421.next()).done);_iteratorNormalCompletion421=true){var _family=_step421.value;var familyIndex=_family.GetFamilyIndex();this._familyInstVarMap[familyIndex]=ivSum;ivSum+=_family.GetInstanceVariablesCount();this._familyBehaviorMap[familyIndex]=behSum;behSum+=_family.GetBehaviorTypesCount();this._familyEffectMap[familyIndex]=fxSum;fxSum+=_family.GetEffectTypesCount();var familyEffectList=_family.GetEffectList();if(familyEffectList&&this._effectList){var _iteratorNormalCompletion422=true;var _didIteratorError422=false;var _iteratorError422=undefined;try{for(var _iterator422=familyEffectList.GetAllEffectTypes()[Symbol.iterator](),_step422;!(_iteratorNormalCompletion422=(_step422=_iterator422.next()).done);_iteratorNormalCompletion422=true){var effectType=_step422.value;allFx.push(effectType.Clone(this._effectList));}}catch(err){_didIteratorError422=true;_iteratorError422=err;}finally{try{if(!_iteratorNormalCompletion422&&_iterator422["return"]!=null){_iterator422["return"]();}}finally{if(_didIteratorError422){throw _iteratorError422;}}}}}}catch(err){_didIteratorError421=true;_iteratorError421=err;}finally{try{if(!_iteratorNormalCompletion421&&_iterator421["return"]!=null){_iterator421["return"]();}}finally{if(_didIteratorError421){throw _iteratorError421;}}}if(this._effectList)this._effectList.PrependEffectTypes(allFx);}}},{key:"_CreateSingleGlobalInstance",value:function _CreateSingleGlobalInstance(data){var uid=this._runtime._GetNewUID();var inst=_C169.New(_C169.Instance,{runtime:this._runtime,objectType:this,uid:uid});inst._CreateSdkInstance(data[16],[]);this._runtime._MapInstanceByUID(uid,inst);this._instances.push(inst);}},{key:"GetSdkType",value:function GetSdkType(){return this._sdkType;}},{key:"IsOnLoaderLayout",value:function IsOnLoaderLayout(){return this._isOnLoaderLayout;}},{key:"Dispatcher",value:function Dispatcher(){return this._dispatcher;}},{key:"OnCreate",value:function OnCreate(){if(!this._isFamily)this._sdkType.OnCreate();}},{key:"HasLoadedTextures",value:function HasLoadedTextures(){return this._textureRefCount>0;}},{key:"LoadTextures",value:function LoadTextures(renderer){if(this._isFamily)return Promise.resolve();this._textureRefCount++;if(this._textureRefCount===1)return this._sdkType.LoadTextures(renderer)||Promise.resolve();else return Promise.resolve();}},{key:"ReleaseTextures",value:function ReleaseTextures(){if(this._isFamily)return;this._textureRefCount--;if(this._textureRefCount<0)throw new Error("released textures too many times");if(this._textureRefCount===0)this._sdkType.ReleaseTextures();}},{key:"OnDynamicTextureLoadComplete",value:function OnDynamicTextureLoadComplete(){if(this._isFamily)throw new Error("not applicable to family");this._sdkType.OnDynamicTextureLoadComplete();}},{key:"PreloadTexturesWithInstances",value:function PreloadTexturesWithInstances(renderer){if(this._isFamily)return Promise.resolve();return this._sdkType.PreloadTexturesWithInstances(renderer);}},{key:"GetRuntime",value:function GetRuntime(){return this._runtime;}},{key:"GetPlugin",value:function GetPlugin(){return this._plugin;}},{key:"GetInstanceSdkCtor",value:function GetInstanceSdkCtor(){return this._instSdkCtor;}},{key:"GetName",value:function GetName(){return this._name;}},{key:"GetJsPropName",value:function GetJsPropName(){return this._jsPropName;}},{key:"GetIndex",value:function GetIndex(){return this._index;}},{key:"GetSID",value:function GetSID(){return this._sid;}},{key:"IsFamily",value:function IsFamily(){return this._isFamily;}},{key:"IsGlobal",value:function IsGlobal(){return this._isGlobal;}},{key:"IsWorldType",value:function IsWorldType(){return this._isWorldType;}},{key:"GetFamilyIndex",value:function GetFamilyIndex(){return this._familyIndex;}},{key:"GetBehaviorTypes",value:function GetBehaviorTypes(){return this._behaviorTypes;}},{key:"GetBehaviorTypesCount",value:function GetBehaviorTypesCount(){return this._behaviorsCount;}},{key:"UsesBehaviorByCtor",value:function UsesBehaviorByCtor(Ctor){return Ctor&&this._usedBehaviorCtors.has(Ctor);}},{key:"GetInstanceVariablesCount",value:function GetInstanceVariablesCount(){return this._instVars.length;}},{key:"GetInstanceVariableSIDs",value:function GetInstanceVariableSIDs(){return this._instVars.map(function(iv){return iv.sid;});}},{key:"GetInstanceVariableIndexBySID",value:function GetInstanceVariableIndexBySID(sid){return this._instVars.findIndex(function(iv){return iv.sid===sid;});}},{key:"GetInstanceVariableIndexByName",value:function GetInstanceVariableIndexByName(name){return this._instVars.findIndex(function(iv){return iv.name===name;});}},{key:"_GetAllInstanceVariableNames",value:function _GetAllInstanceVariableNames(){return this._instVars.map(function(iv){return iv.name;});}},{key:"_GetAllInstanceVariableJsPropNames",value:function _GetAllInstanceVariableJsPropNames(){return this._instVars.map(function(iv){return iv.jsPropName;});}},{key:"GetInstanceVariableType",value:function GetInstanceVariableType(i){i=Math.floor(i);if(i<0||i>=this._instVars.length)throw new RangeError("invalid instance variable index");return this._instVars[i].type;}},{key:"GetInstanceVariableName",value:function GetInstanceVariableName(i){i=Math.floor(i);if(i<0||i>=this._instVars.length)throw new RangeError("invalid instance variable index");return this._instVars[i].name;}},{key:"GetEffectTypesCount",value:function GetEffectTypesCount(){return this._effectsCount;}},{key:"GetBehaviorTypesIncludingInherited",value:function GetBehaviorTypesIncludingInherited(){return this._behaviorTypesIncludingInherited;}},{key:"GetBehaviorTypeByName",value:function GetBehaviorTypeByName(name){return this._behaviorsByName.get(name.toLowerCase())||null;}},{key:"GetBehaviorIndexByName",value:function GetBehaviorIndexByName(name){var ret=this._behaviorNameToIndex.get(name.toLowerCase());if(typeof ret==="undefined")return-1;else return ret;}},{key:"GetEffectList",value:function GetEffectList(){return this._effectList;}},{key:"HasEffects",value:function HasEffects(){return this._plugin.HasEffects();}},{key:"UsesEffects",value:function UsesEffects(){return this._effectList&&this._effectList.HasAnyEffectType();}},{key:"GetSolStack",value:function GetSolStack(){return this._solStack;}},{key:"GetCurrentSol",value:function GetCurrentSol(){return this._solStack.GetCurrentSol();}},{key:"GetImageInfo",value:function GetImageInfo(){return this._imageInfo;}},{key:"SetDefaultInstanceData",value:function SetDefaultInstanceData(d){this._defaultInstanceData=d;}},{key:"GetDefaultInstanceData",value:function GetDefaultInstanceData(){return this._defaultInstanceData;}},{key:"_SetDefaultLayerIndex",value:function _SetDefaultLayerIndex(i){this._defaultLayerIndex=i;}},{key:"GetDefaultLayerIndex",value:function GetDefaultLayerIndex(){return this._defaultLayerIndex;}},{key:"GetAnimations",value:function GetAnimations(){return this._animations;}},{key:"GetAnimationCount",value:function GetAnimationCount(){return this._animations.length;}},{key:"GetFamilies",value:function GetFamilies(){return this._families;}},{key:"BelongsToFamily",value:function BelongsToFamily(family){return this._familiesSet.has(family);}},{key:"GetFamilyMembers",value:function GetFamilyMembers(){return this._familyMembers;}},{key:"FamilyHasMember",value:function FamilyHasMember(objectType){return this._familyMembersSet.has(objectType);}},{key:"GetFamilyBehaviorOffset",value:function GetFamilyBehaviorOffset(familyIndex){return this._familyBehaviorMap[familyIndex];}},{key:"GetFamilyInstanceVariableOffset",value:function GetFamilyInstanceVariableOffset(familyIndex){return this._familyInstVarMap[familyIndex];}},{key:"AddCustomAction",value:function AddCustomAction(customAceBlock){this._customActionMap.set(customAceBlock.GetACEName().toLowerCase(),customAceBlock);}},{key:"HasOwnCustomActionByName",value:function HasOwnCustomActionByName(name){return!!this.GetOwnCustomActionByName(name);}},{key:"GetOwnCustomActionByName",value:function GetOwnCustomActionByName(name){var ret=this._customActionMap.get(name.toLowerCase());return ret&&ret.IsEnabled()?ret:null;}},{key:"GetAnimationByName",value:function GetAnimationByName(name){if(!this._animations)throw new Error("no animations");return this._animationsByName.get(name.toLowerCase())||null;}},{key:"GetAnimationBySID",value:function GetAnimationBySID(sid){if(!this._animations)throw new Error("no animations");return this._animationsBySid.get(sid)||null;}},{key:"GetFirstAnimationFrame",value:function GetFirstAnimationFrame(){if(!this._animations)throw new Error("no animations");return this._animations[0].GetFrameAt(0);}},{key:"GetDefaultInstanceSize",value:function GetDefaultInstanceSize(){if(this._animations){var firstFrameInfo=this.GetFirstAnimationFrame().GetImageInfo();return[firstFrameInfo.GetWidth(),firstFrameInfo.GetHeight()];}else if(this._imageInfo)return[this._imageInfo.GetWidth(),this._imageInfo.GetHeight()];else return[100,100];}},{key:"GetSingleGlobalInstance",value:function GetSingleGlobalInstance(){if(!this._plugin.IsSingleGlobal())throw new Error("not a single-global plugin");return this._instances[0];}},{key:"GetInstances",value:function GetInstances(){return this._instances;}},{key:"instances",value:/*#__PURE__*/regeneratorRuntime.mark(function instances(){return regeneratorRuntime.wrap(function instances$(_context161){while(1){switch(_context161.prev=_context161.next){case 0:return _context161.delegateYield(this._instances,"t0",1);case 1:case"end":return _context161.stop();}}},instances,this);})},{key:"instancesIncludingPendingCreate",value:/*#__PURE__*/regeneratorRuntime.mark(function instancesIncludingPendingCreate(){return regeneratorRuntime.wrap(function instancesIncludingPendingCreate$(_context162){while(1){switch(_context162.prev=_context162.next){case 0:return _context162.delegateYield(this._instances,"t0",1);case 1:return _context162.delegateYield(this._runtime.instancesPendingCreateForObjectClass(this),"t1",2);case 2:case"end":return _context162.stop();}}},instancesIncludingPendingCreate,this);})},{key:"GetInstanceCount",value:function GetInstanceCount(){return this._instances.length;}},{key:"_AddInstance",value:function _AddInstance(inst){this._instances.push(inst);}},{key:"_SetIIDsStale",value:function _SetIIDsStale(){this._iidsStale=true;}},{key:"_UpdateIIDs",value:function _UpdateIIDs(){if(!this._iidsStale||this._isFamily)return;var instances=this._instances;var i=0;for(var len=instances.length;i<len;++i){instances[i]._SetIID(i);}var instancesPendingCreate=this._runtime._GetInstancesPendingCreate();var _iteratorNormalCompletion423=true;var _didIteratorError423=false;var _iteratorError423=undefined;try{for(var _iterator423=instancesPendingCreate[Symbol.iterator](),_step423;!(_iteratorNormalCompletion423=(_step423=_iterator423.next()).done);_iteratorNormalCompletion423=true){var inst=_step423.value;if(inst.GetObjectClass()===this)inst._SetIID(i++);}}catch(err){_didIteratorError423=true;_iteratorError423=err;}finally{try{if(!_iteratorNormalCompletion423&&_iterator423["return"]!=null){_iterator423["return"]();}}finally{if(_didIteratorError423){throw _iteratorError423;}}}this._iidsStale=false;}},{key:"GetInstanceByIID",value:function GetInstanceByIID(i){var instances=this._instances;if(i<instances.length)return instances[i];i-=instances.length;var instancesPendingCreate=this._runtime._GetInstancesPendingCreate();var _iteratorNormalCompletion424=true;var _didIteratorError424=false;var _iteratorError424=undefined;try{for(var _iterator424=instancesPendingCreate[Symbol.iterator](),_step424;!(_iteratorNormalCompletion424=(_step424=_iterator424.next()).done);_iteratorNormalCompletion424=true){var inst=_step424.value;if(inst.GetObjectClass()===this){if(i===0)return inst;--i;}}}catch(err){_didIteratorError424=true;_iteratorError424=err;}finally{try{if(!_iteratorNormalCompletion424&&_iterator424["return"]!=null){_iterator424["return"]();}}finally{if(_didIteratorError424){throw _iteratorError424;}}}return null;}},{key:"GetFirstPicked",value:function GetFirstPicked(fromInst){if(fromInst&&fromInst.IsInContainer()&&fromInst.GetObjectClass()!==this){var _iteratorNormalCompletion425=true;var _didIteratorError425=false;var _iteratorError425=undefined;try{for(var _iterator425=fromInst.siblings()[Symbol.iterator](),_step425;!(_iteratorNormalCompletion425=(_step425=_iterator425.next()).done);_iteratorNormalCompletion425=true){var s=_step425.value;if(s.GetObjectClass()===this)return s;}}catch(err){_didIteratorError425=true;_iteratorError425=err;}finally{try{if(!_iteratorNormalCompletion425&&_iterator425["return"]!=null){_iterator425["return"]();}}finally{if(_didIteratorError425){throw _iteratorError425;}}}}var instances=this.GetCurrentSol().GetInstances();if(instances.length)return instances[0];else return null;}},{key:"GetPairedInstance",value:function GetPairedInstance(inst){var instances=this.GetCurrentSol().GetInstances();if(instances.length>0)return instances[inst.GetIID()%instances.length];else return null;}},{key:"allCorrespondingInstances",value:/*#__PURE__*/regeneratorRuntime.mark(function allCorrespondingInstances(inst,objectClass){var myInstances,myInstanceCount,otherSol,otherInstances,otherInstanceCount,index,divisor,remainder,startIndex,correspondCount,i,end;return regeneratorRuntime.wrap(function allCorrespondingInstances$(_context163){while(1){switch(_context163.prev=_context163.next){case 0:myInstances=this.GetCurrentSol().GetInstances();myInstanceCount=myInstances.length;otherSol=objectClass.GetCurrentSol();otherInstances=objectClass.GetCurrentSol().GetInstances();otherInstanceCount=otherInstances.length;index=inst.GetIID();if(objectClass.IsFamily()||!otherSol.IsSelectAll())index=otherInstances.indexOf(inst);divisor=Math.ceil(myInstanceCount/otherInstanceCount);remainder=myInstanceCount%otherInstanceCount;startIndex=0;correspondCount=0;if(remainder===0||index<remainder){startIndex=index*divisor;correspondCount=divisor;}else{startIndex=remainder*divisor+(index-remainder)*(divisor-1);correspondCount=divisor-1;}i=startIndex,end=startIndex+correspondCount;case 13:if(!(i<end)){_context163.next=19;break;}_context163.next=16;return myInstances[i];case 16:++i;_context163.next=13;break;case 19:case"end":return _context163.stop();}}},allCorrespondingInstances,this);})},{key:"FinishCondition",value:function FinishCondition(f){this._sdkType.FinishCondition(f);}},{key:"ApplySolToContainer",value:function ApplySolToContainer(){if(!this._isInContainer||this._isFamily)return;this._UpdateIIDs();var sol1=this.GetCurrentSol();var sol1instances=sol1._GetOwnInstances();var selectAll=sol1.IsSelectAll();var es=this._runtime.GetCurrentEventStackFrame();var isOrBlock=es&&es.GetCurrentEvent()&&es.GetCurrentEvent().IsOrBlock();var _iteratorNormalCompletion426=true;var _didIteratorError426=false;var _iteratorError426=undefined;try{for(var _iterator426=this._container.objectTypes()[Symbol.iterator](),_step426;!(_iteratorNormalCompletion426=(_step426=_iterator426.next()).done);_iteratorNormalCompletion426=true){var containerType=_step426.value;if(containerType===this)continue;containerType._UpdateIIDs();var sol2=containerType.GetCurrentSol();sol2._SetSelectAll(selectAll);if(!selectAll){var sol2instances=sol2._GetOwnInstances();_C169.clearArray(sol2instances);var _iteratorNormalCompletion427=true;var _didIteratorError427=false;var _iteratorError427=undefined;try{for(var _iterator427=sol1instances[Symbol.iterator](),_step427;!(_iteratorNormalCompletion427=(_step427=_iterator427.next()).done);_iteratorNormalCompletion427=true){var _inst11=_step427.value;sol2instances.push(containerType.GetInstanceByIID(_inst11.GetIID()));}}catch(err){_didIteratorError427=true;_iteratorError427=err;}finally{try{if(!_iteratorNormalCompletion427&&_iterator427["return"]!=null){_iterator427["return"]();}}finally{if(_didIteratorError427){throw _iteratorError427;}}}if(isOrBlock){var sol1elseInstances=sol1._GetOwnElseInstances();var sol2elseInstances=sol2._GetOwnElseInstances();_C169.clearArray(sol2elseInstances);var _iteratorNormalCompletion428=true;var _didIteratorError428=false;var _iteratorError428=undefined;try{for(var _iterator428=sol1elseInstances[Symbol.iterator](),_step428;!(_iteratorNormalCompletion428=(_step428=_iterator428.next()).done);_iteratorNormalCompletion428=true){var inst=_step428.value;sol2elseInstances.push(containerType.GetInstanceByIID(inst.GetIID()));}}catch(err){_didIteratorError428=true;_iteratorError428=err;}finally{try{if(!_iteratorNormalCompletion428&&_iterator428["return"]!=null){_iterator428["return"]();}}finally{if(_didIteratorError428){throw _iteratorError428;}}}}}}}catch(err){_didIteratorError426=true;_iteratorError426=err;}finally{try{if(!_iteratorNormalCompletion426&&_iterator426["return"]!=null){_iterator426["return"]();}}finally{if(_didIteratorError426){throw _iteratorError426;}}}}},{key:"_TruncateContainerSols",value:function _TruncateContainerSols(useElseInstances,i){var _iteratorNormalCompletion429=true;var _didIteratorError429=false;var _iteratorError429=undefined;try{for(var _iterator429=this.GetContainer().objectTypes()[Symbol.iterator](),_step429;!(_iteratorNormalCompletion429=(_step429=_iterator429.next()).done);_iteratorNormalCompletion429=true){var containerType=_step429.value;var sol=containerType.GetCurrentSol();if(useElseInstances)_C169.truncateArray(sol._GetOwnElseInstances(),i);else _C169.truncateArray(sol._GetOwnInstances(),i);}}catch(err){_didIteratorError429=true;_iteratorError429=err;}finally{try{if(!_iteratorNormalCompletion429&&_iterator429["return"]!=null){_iterator429["return"]();}}finally{if(_didIteratorError429){throw _iteratorError429;}}}}},{key:"_GetCollisionCellGrid",value:function _GetCollisionCellGrid(){return this._collisionGrid;}},{key:"_SetAnyCollisionCellChanged",value:function _SetAnyCollisionCellChanged(c){this._anyCollisionCellChanged=!!c;}},{key:"_SetAnyInstanceParallaxed",value:function _SetAnyInstanceParallaxed(p){this._anyInstanceParallaxed=!!p;}},{key:"IsAnyInstanceParallaxed",value:function IsAnyInstanceParallaxed(){return this._anyInstanceParallaxed;}},{key:"_UpdateAllCollisionCells",value:function _UpdateAllCollisionCells(){if(!this._anyCollisionCellChanged||!this._isWorldType)return;var _iteratorNormalCompletion430=true;var _didIteratorError430=false;var _iteratorError430=undefined;try{for(var _iterator430=this._instances[Symbol.iterator](),_step430;!(_iteratorNormalCompletion430=(_step430=_iterator430.next()).done);_iteratorNormalCompletion430=true){var inst=_step430.value;inst.GetWorldInfo()._UpdateCollisionCell();}}catch(err){_didIteratorError430=true;_iteratorError430=err;}finally{try{if(!_iteratorNormalCompletion430&&_iterator430["return"]!=null){_iterator430["return"]();}}finally{if(_didIteratorError430){throw _iteratorError430;}}}var _iteratorNormalCompletion431=true;var _didIteratorError431=false;var _iteratorError431=undefined;try{for(var _iterator431=this._runtime._GetInstancesPendingCreate()[Symbol.iterator](),_step431;!(_iteratorNormalCompletion431=(_step431=_iterator431.next()).done);_iteratorNormalCompletion431=true){var _inst12=_step431.value;if(_inst12.GetObjectClass()===this)_inst12.GetWorldInfo()._UpdateCollisionCell();}}catch(err){_didIteratorError431=true;_iteratorError431=err;}finally{try{if(!_iteratorNormalCompletion431&&_iterator431["return"]!=null){_iterator431["return"]();}}finally{if(_didIteratorError431){throw _iteratorError431;}}}this._anyCollisionCellChanged=false;}},{key:"GetSavedDataMap",value:function GetSavedDataMap(){if(!this._savedData)this._savedData=new Map();return this._savedData;}},{key:"GetUnsavedDataMap",value:function GetUnsavedDataMap(){if(!this._unsavedData)this._unsavedData=new Map();return this._unsavedData;}},{key:"HasSolidBehavior",value:function HasSolidBehavior(){return this.UsesBehaviorByCtor(_C169.Behaviors.solid);}},{key:"HasJumpthruBehavior",value:function HasJumpthruBehavior(){return this.UsesBehaviorByCtor(_C169.Behaviors.jumpthru);}},{key:"HasNoSaveBehavior",value:function HasNoSaveBehavior(){return this.UsesBehaviorByCtor(_C169.Behaviors.NoSave);}},{key:"HasPersistBehavior",value:function HasPersistBehavior(){return this.UsesBehaviorByCtor(_C169.Behaviors.Persist);}},{key:"_SaveToJson",value:function _SaveToJson(){var o={"instances":this._instances.map(function(inst){return inst.SaveToJson();})};if(this._savedData&&this._savedData.size)o["ex"]=_C169.ToSuperJSON(this._savedData);return o;}},{key:"_LoadFromJson",value:function _LoadFromJson(o){if(this._savedData){this._savedData.clear();this._savedData=null;}var ex=o["ex"];if(ex)this._savedData=_C169.FromSuperJSON(ex);var existingInstances=this._instances;var loadInstances=o["instances"];for(var i=0,len=Math.min(existingInstances.length,loadInstances.length);i<len;++i){existingInstances[i].LoadFromJson(loadInstances[i]);}for(var _i55=loadInstances.length,_len51=existingInstances.length;_i55<_len51;++_i55){this._runtime.DestroyInstance(existingInstances[_i55]);}for(var _i56=existingInstances.length,_len52=loadInstances.length;_i56<_len52;++_i56){var data=loadInstances[_i56];var layer=null;if(this.IsWorldType()){layer=this._runtime.GetMainRunningLayout().GetLayerBySID(data["w"]["l"]);if(!layer)continue;}var inst=this._runtime.CreateInstanceFromData(this._defaultInstanceData||this,layer,false,0,0,true);inst.LoadFromJson(data);}this._loadInstancesJson=loadInstances;this._SetIIDsStale();}},{key:"_GetLoadInstancesJson",value:function _GetLoadInstancesJson(){return this._loadInstancesJson;}},{key:"_ClearLoadInstancesJson",value:function _ClearLoadInstancesJson(){this._loadInstancesJson=null;}},{key:"_SetupSceneGraphConnectionsOnChangeOfLayout",value:function _SetupSceneGraphConnectionsOnChangeOfLayout(){for(var i=0,len=this._instances;i<len;++i){this._instances[i]._SetupSceneGraphConnectionsOnChangeOfLayout();}}},{key:"GetIObjectClass",value:function GetIObjectClass(){return this._iObjectClass;}},{key:"UserScriptDispatcher",value:function UserScriptDispatcher(){return this._userScriptDispatcher;}},{key:"_GetUserScriptInstanceClass",value:function _GetUserScriptInstanceClass(){return this._instanceUserScriptClass;}},{key:"_SetUserScriptInstanceClass",value:function _SetUserScriptInstanceClass(Class){this._instanceUserScriptClass=Class;}},{key:"DispatchUserScriptEvent",value:function DispatchUserScriptEvent(e){var runtime=this._runtime;var shouldTime=runtime.IsDebug()&&!runtime.GetEventSheetManager().IsInEventEngine();if(shouldTime)_C3Debugger.StartMeasuringScriptTime();this._userScriptDispatcher.dispatchEvent(e);if(shouldTime)_C3Debugger.AddScriptTime();}}],[{key:"Create",value:function Create(runtime,index,objectClassData){return _C169.New(_C169.ObjectClass,runtime,index,objectClassData);}}]);return ObjectClass;}(_C169.DefendedBase);}// objects/container.js
{'use strict';var _C170=self.C3;_C170.Container=/*#__PURE__*/function(_C170$DefendedBase){_inherits(Container,_C170$DefendedBase);function Container(runtime,objectTypes){var _this137;_classCallCheck(this,Container);_this137=_possibleConstructorReturn(this,_getPrototypeOf(Container).call(this));_this137._runtime=runtime;_this137._objectTypes=objectTypes;var _iteratorNormalCompletion432=true;var _didIteratorError432=false;var _iteratorError432=undefined;try{for(var _iterator432=_this137._objectTypes[Symbol.iterator](),_step432;!(_iteratorNormalCompletion432=(_step432=_iterator432.next()).done);_iteratorNormalCompletion432=true){var objectType=_step432.value;objectType._SetContainer(_assertThisInitialized(_this137));}}catch(err){_didIteratorError432=true;_iteratorError432=err;}finally{try{if(!_iteratorNormalCompletion432&&_iterator432["return"]!=null){_iterator432["return"]();}}finally{if(_didIteratorError432){throw _iteratorError432;}}}return _this137;}_createClass(Container,[{key:"Release",value:function Release(){this._runtime=null;}},{key:"GetRuntime",value:function GetRuntime(){return this._runtime;}},{key:"GetObjectTypes",value:function GetObjectTypes(){return this._objectTypes;}},{key:"objectTypes",value:function objectTypes(){return this._objectTypes;}},{key:"HasAnyWorldType",value:function HasAnyWorldType(){return this._objectTypes.some(function(o){return o.IsWorldType();});}}]);return Container;}(_C170.DefendedBase);}// objects/instance.js
{'use strict';var _C171=self.C3;var _C3Debugger2=self.C3Debugger;var _IInstance3=self.IInstance;var _EMPTY_ARRAY=[];var nextPuid=0;var savedDataMaps=new WeakMap();var unsavedDataMaps=new WeakMap();var FLAG_DESTROYED=1<<0;var FLAG_TILEMAP=1<<1;var FLAG_MUST_PREDRAW=1<<2;var FLAG_SOLID_ENABLED=1<<3;var FLAG_JUMPTHRU_ENABLED=1<<4;var FLAG_MUST_MITIGATE_Z_FIGHTING=1<<5;var FLAG_IS_DRAWING_WITH_EFFECTS=1<<6;_C171.Instance=/*#__PURE__*/function(_C171$DefendedBase){_inherits(Instance,_C171$DefendedBase);function Instance(opts){var _this138;_classCallCheck(this,Instance);_this138=_possibleConstructorReturn(this,_getPrototypeOf(Instance).call(this));_this138._runtime=opts.runtime;_this138._objectType=opts.objectType;_this138._worldInfo=null;_this138._sdkInst=null;_this138._iScriptInterface=null;_this138._iid=0;_this138._uid=opts.uid;_this138._puid=nextPuid++;_this138._flags=0;_this138._instVarValues=_EMPTY_ARRAY;_this138._behaviorInstances=_EMPTY_ARRAY;var behaviorTypes=_this138._objectType.GetBehaviorTypesIncludingInherited();if(behaviorTypes.length>0)_this138._behaviorInstances=behaviorTypes.map(function(behaviorType,index){return _C171.New(_C171.BehaviorInstance,{runtime:_this138._runtime,behaviorType:behaviorType,instance:_assertThisInitialized(_this138),index:index});});_this138._siblings=_this138._objectType.IsInContainer()?[]:null;_this138._timeScale=-1;_this138._dispatcher=null;var plugin=_this138.GetPlugin();if(plugin.MustPreDraw())_this138._flags|=FLAG_MUST_PREDRAW;if(plugin.IsWorldType()){_this138._worldInfo=_C171.New(_C171.WorldInfo,_assertThisInitialized(_this138),opts.layer);if(opts.worldData)_this138._worldInfo.Init(opts.worldData);else{_this138._worldInfo.InitNoData();var _this138$_objectType$=_this138._objectType.GetDefaultInstanceSize(),_this138$_objectType$2=_slicedToArray(_this138$_objectType$,2),width=_this138$_objectType$2[0],height=_this138$_objectType$2[1];_this138._worldInfo.SetSize(width,height);if(_this138.GetObjectClass().UsesEffects())_this138._worldInfo.GetInstanceEffectList().LoadDefaultEffectParameters();}}if(opts.instVarData)_this138._LoadInstanceVariableData(opts.instVarData);else _this138._LoadDefaultInstanceVariables();return _this138;}_createClass(Instance,[{key:"Release",value:function Release(){if(this._iScriptInterface){this._iScriptInterface._Release();this._iScriptInterface=null;}if(this._behaviorInstances.length>0){var _iteratorNormalCompletion433=true;var _didIteratorError433=false;var _iteratorError433=undefined;try{for(var _iterator433=this._behaviorInstances[Symbol.iterator](),_step433;!(_iteratorNormalCompletion433=(_step433=_iterator433.next()).done);_iteratorNormalCompletion433=true){var behInst=_step433.value;behInst.Release();}}catch(err){_didIteratorError433=true;_iteratorError433=err;}finally{try{if(!_iteratorNormalCompletion433&&_iterator433["return"]!=null){_iterator433["return"]();}}finally{if(_didIteratorError433){throw _iteratorError433;}}}_C171.clearArray(this._behaviorInstances);}this._sdkInst.Release();this._sdkInst=null;var savedData=savedDataMaps.get(this);if(savedData){savedData.clear();savedDataMaps["delete"](this);}var unsavedData=unsavedDataMaps.get(this);if(unsavedData){unsavedData.clear();unsavedDataMaps["delete"](this);}if(this._siblings)_C171.clearArray(this._siblings);if(this._dispatcher){this._dispatcher.Release();this._dispatcher=null;}this._runtime=null;this._objectType=null;if(this._instVarValues.length>0)_C171.clearArray(this._instVarValues);if(this._worldInfo){this._worldInfo.Release();this._worldInfo=null;}}},{key:"_LoadInstanceVariableData",value:function _LoadInstanceVariableData(instVarData){if(instVarData.length>0){this._instVarValues=[];_C171.shallowAssignArray(this._instVarValues,instVarData);}}},{key:"_LoadDefaultInstanceVariables",value:function _LoadDefaultInstanceVariables(){var len=this._objectType.GetInstanceVariablesCount();if(len===0)return;this._instVarValues=[];var typeToInitValue=[0,0,""];for(var i=0;i<len;++i){this._instVarValues.push(typeToInitValue[this._objectType.GetInstanceVariableType(i)]);}}},{key:"_CreateSdkInstance",value:function _CreateSdkInstance(properties,behInstProperties){if(this._sdkInst)throw new Error("already got sdk instance");for(var i=0,len=this._behaviorInstances.length;i<len;++i){var behInst=this._behaviorInstances[i];behInst._CreateSdkInstance(behInstProperties?behInstProperties[i]:null);}this._sdkInst=_C171.New(this._objectType.GetInstanceSdkCtor(),this,properties);if(!(this._sdkInst instanceof _C171.SDKInstanceBase))throw new Error("sdk type must derive from SDKInstanceBase");if(!this.GetPlugin().IsWorldType()&&this._objectType._GetUserScriptInstanceClass())this.GetInterfaceClass();for(var _i57=0,_len53=this._behaviorInstances.length;_i57<_len53;++_i57){this._behaviorInstances[_i57].PostCreate();}}},{key:"GetSdkInstance",value:function GetSdkInstance(){return this._sdkInst;}},{key:"GetWorldInfo",value:function GetWorldInfo(){return this._worldInfo;}},{key:"GetRuntime",value:function GetRuntime(){return this._runtime;}},{key:"GetTimeScale",value:function GetTimeScale(){return this._timeScale;}},{key:"GetActiveTimeScale",value:function GetActiveTimeScale(){var ts=this._timeScale;if(ts===-1)return this.GetRuntime().GetTimeScale();else return ts;}},{key:"SetTimeScale",value:function SetTimeScale(ts){ts=+ts;if(ts<0||!isFinite(ts))ts=0;this._timeScale=ts;if(this.GetObjectClass().UsesEffects())this._runtime._SetTrackingInstanceTime(this,true);}},{key:"RestoreTimeScale",value:function RestoreTimeScale(){this._timeScale=-1;if(this.GetObjectClass().UsesEffects())this._runtime._SetTrackingInstanceTime(this,false);}},{key:"GetInstanceGameTime",value:function GetInstanceGameTime(){return this._runtime._GetInstanceGameTime(this);}},{key:"Dispatcher",value:function Dispatcher(){if(!this._dispatcher)this._dispatcher=_C171.New(_C171.Event.Dispatcher);return this._dispatcher;}},{key:"Draw",value:function Draw(renderer){this._sdkInst.Draw(renderer);}},{key:"OnCreate",value:function OnCreate(properties){this._sdkInst.OnCreate(properties);}},{key:"_SetHasTilemap",value:function _SetHasTilemap(){this._flags|=FLAG_TILEMAP;}},{key:"HasTilemap",value:function HasTilemap(){return(this._flags&FLAG_TILEMAP)!==0;}},{key:"_MarkDestroyed",value:function _MarkDestroyed(){this._flags|=FLAG_DESTROYED;}},{key:"IsDestroyed",value:function IsDestroyed(){return(this._flags&FLAG_DESTROYED)!==0;}},{key:"MustPreDraw",value:function MustPreDraw(){return(this._flags&FLAG_MUST_PREDRAW)!==0;}},{key:"SetMustMitigateZFighting",value:function SetMustMitigateZFighting(){this._flags|=FLAG_MUST_MITIGATE_Z_FIGHTING;}},{key:"MustMitigateZFighting",value:function MustMitigateZFighting(){return(this._flags&FLAG_MUST_MITIGATE_Z_FIGHTING)!==0;}},{key:"_IsSolidEnabled",value:function _IsSolidEnabled(){return(this._flags&FLAG_SOLID_ENABLED)!==0;}},{key:"_SetSolidEnabled",value:function _SetSolidEnabled(e){if(e)this._flags|=FLAG_SOLID_ENABLED;else this._flags&=~FLAG_SOLID_ENABLED;}},{key:"_IsJumpthruEnabled",value:function _IsJumpthruEnabled(){return(this._flags&FLAG_JUMPTHRU_ENABLED)!==0;}},{key:"_SetJumpthruEnabled",value:function _SetJumpthruEnabled(e){if(e)this._flags|=FLAG_JUMPTHRU_ENABLED;else this._flags&=~FLAG_JUMPTHRU_ENABLED;}},{key:"_IsDrawingWithEffects",value:function _IsDrawingWithEffects(){return(this._flags&FLAG_IS_DRAWING_WITH_EFFECTS)!==0;}},{key:"_SetIsDrawingWithEffects",value:function _SetIsDrawingWithEffects(e){if(e)this._flags|=FLAG_IS_DRAWING_WITH_EFFECTS;else this._flags&=~FLAG_IS_DRAWING_WITH_EFFECTS;}},{key:"SetFlag",value:function SetFlag(bit,enable){bit<<=16;if(enable)this._flags|=bit;else this._flags&=~bit;}},{key:"GetFlag",value:function GetFlag(bit){return(this._flags&bit<<16)!==0;}},{key:"GetCurrentImageInfo",value:function GetCurrentImageInfo(){return this._sdkInst.GetCurrentImageInfo();}},{key:"GetCurrentSurfaceSize",value:function GetCurrentSurfaceSize(){return this._sdkInst.GetCurrentSurfaceSize();}},{key:"GetCurrentTexRect",value:function GetCurrentTexRect(){return this._sdkInst.GetCurrentTexRect();}},{key:"GetCurrentTexQuad",value:function GetCurrentTexQuad(){return this._sdkInst.GetCurrentTexQuad();}},{key:"IsCurrentTexRotated",value:function IsCurrentTexRotated(){return this._sdkInst.IsCurrentTexRotated();}},{key:"GetImagePoint",value:function GetImagePoint(nameOrIndex){return this._sdkInst.GetImagePoint(nameOrIndex);}},{key:"GetObjectClass",value:function GetObjectClass(){return this._objectType;}},{key:"RendersToOwnZPlane",value:function RendersToOwnZPlane(){return this._sdkInst.RendersToOwnZPlane();}},{key:"BelongsToObjectClass",value:function BelongsToObjectClass(objectClass){if(objectClass.IsFamily())return objectClass.FamilyHasMember(this.GetObjectClass());else return this.GetObjectClass()===objectClass;}},{key:"CollectInstancesToPick",value:function CollectInstancesToPick(pickMap,createdObjectClass,includeHierarchy){var addInst=function addInst(inst,objectClass_){var objectClass=objectClass_||inst.GetObjectClass();var instSet=pickMap.get(objectClass);if(instSet)instSet.add(inst);else pickMap.set(objectClass,new Set([inst]));};addInst(this,createdObjectClass);if(this.IsInContainer()){var _iteratorNormalCompletion434=true;var _didIteratorError434=false;var _iteratorError434=undefined;try{for(var _iterator434=this.siblings()[Symbol.iterator](),_step434;!(_iteratorNormalCompletion434=(_step434=_iterator434.next()).done);_iteratorNormalCompletion434=true){var s=_step434.value;addInst(s);}}catch(err){_didIteratorError434=true;_iteratorError434=err;}finally{try{if(!_iteratorNormalCompletion434&&_iterator434["return"]!=null){_iterator434["return"]();}}finally{if(_didIteratorError434){throw _iteratorError434;}}}}if(includeHierarchy){var _iteratorNormalCompletion435=true;var _didIteratorError435=false;var _iteratorError435=undefined;try{for(var _iterator435=this.allChildren()[Symbol.iterator](),_step435;!(_iteratorNormalCompletion435=(_step435=_iterator435.next()).done);_iteratorNormalCompletion435=true){var _c16=_step435.value;addInst(_c16);}}catch(err){_didIteratorError435=true;_iteratorError435=err;}finally{try{if(!_iteratorNormalCompletion435&&_iterator435["return"]!=null){_iterator435["return"]();}}finally{if(_didIteratorError435){throw _iteratorError435;}}}}}},{key:"VerifySupportsSceneGraph",value:function VerifySupportsSceneGraph(){if(!this.GetPlugin().SupportsSceneGraph())throw new Error("object does not support scene graph");}},{key:"HasParent",value:function HasParent(){return this.GetParent()!==null;}},{key:"GetParent",value:function GetParent(){var wi=this.GetWorldInfo();if(!wi)return null;var parentWi=wi.GetParent();return parentWi?parentWi.GetInstance():null;}},{key:"GetTopParent",value:function GetTopParent(){var wi=this.GetWorldInfo();if(!wi)return null;var parentWi=wi.GetTopParent();return parentWi?parentWi.GetInstance():null;}},{key:"parents",value:/*#__PURE__*/regeneratorRuntime.mark(function parents(){var wi,_iteratorNormalCompletion436,_didIteratorError436,_iteratorError436,_iterator436,_step436,parentWi;return regeneratorRuntime.wrap(function parents$(_context164){while(1){switch(_context164.prev=_context164.next){case 0:wi=this.GetWorldInfo();if(wi){_context164.next=3;break;}return _context164.abrupt("return");case 3:_iteratorNormalCompletion436=true;_didIteratorError436=false;_iteratorError436=undefined;_context164.prev=6;_iterator436=wi.parents()[Symbol.iterator]();case 8:if(_iteratorNormalCompletion436=(_step436=_iterator436.next()).done){_context164.next=15;break;}parentWi=_step436.value;_context164.next=12;return parentWi.GetInstance();case 12:_iteratorNormalCompletion436=true;_context164.next=8;break;case 15:_context164.next=21;break;case 17:_context164.prev=17;_context164.t0=_context164["catch"](6);_didIteratorError436=true;_iteratorError436=_context164.t0;case 21:_context164.prev=21;_context164.prev=22;if(!_iteratorNormalCompletion436&&_iterator436["return"]!=null){_iterator436["return"]();}case 24:_context164.prev=24;if(!_didIteratorError436){_context164.next=27;break;}throw _iteratorError436;case 27:return _context164.finish(24);case 28:return _context164.finish(21);case 29:case"end":return _context164.stop();}}},parents,this,[[6,17,21,29],[22,,24,28]]);})},{key:"HasChild",value:function HasChild(child){if(!child)return false;var _iteratorNormalCompletion437=true;var _didIteratorError437=false;var _iteratorError437=undefined;try{for(var _iterator437=this.children()[Symbol.iterator](),_step437;!(_iteratorNormalCompletion437=(_step437=_iterator437.next()).done);_iteratorNormalCompletion437=true){var _c17=_step437.value;if(_c17===child)return true;}}catch(err){_didIteratorError437=true;_iteratorError437=err;}finally{try{if(!_iteratorNormalCompletion437&&_iterator437["return"]!=null){_iterator437["return"]();}}finally{if(_didIteratorError437){throw _iteratorError437;}}}return false;}},{key:"HasChildren",value:function HasChildren(){var wi=this.GetWorldInfo();return wi?wi.HasChildren():false;}},{key:"GetChildrenOfObjectClass",value:function GetChildrenOfObjectClass(objectClass){var wi=this.GetWorldInfo();if(!wi)return[];var objectClassName=objectClass.GetName();return wi.GetChildren().map(function(wi){return wi.GetInstance();}).filter(function(i){return i.GetObjectClass().GetName()===objectClassName;});}},{key:"GetChildren",value:function GetChildren(){var wi=this.GetWorldInfo();if(!wi)return[];return wi.GetChildren().map(function(wi){return wi.GetInstance();});}},{key:"children",value:/*#__PURE__*/regeneratorRuntime.mark(function children(){var wi,_iteratorNormalCompletion438,_didIteratorError438,_iteratorError438,_iterator438,_step438,childWi;return regeneratorRuntime.wrap(function children$(_context165){while(1){switch(_context165.prev=_context165.next){case 0:wi=this.GetWorldInfo();if(wi){_context165.next=3;break;}return _context165.abrupt("return");case 3:_iteratorNormalCompletion438=true;_didIteratorError438=false;_iteratorError438=undefined;_context165.prev=6;_iterator438=wi.children()[Symbol.iterator]();case 8:if(_iteratorNormalCompletion438=(_step438=_iterator438.next()).done){_context165.next=15;break;}childWi=_step438.value;_context165.next=12;return childWi.GetInstance();case 12:_iteratorNormalCompletion438=true;_context165.next=8;break;case 15:_context165.next=21;break;case 17:_context165.prev=17;_context165.t0=_context165["catch"](6);_didIteratorError438=true;_iteratorError438=_context165.t0;case 21:_context165.prev=21;_context165.prev=22;if(!_iteratorNormalCompletion438&&_iterator438["return"]!=null){_iterator438["return"]();}case 24:_context165.prev=24;if(!_didIteratorError438){_context165.next=27;break;}throw _iteratorError438;case 27:return _context165.finish(24);case 28:return _context165.finish(21);case 29:case"end":return _context165.stop();}}},children,this,[[6,17,21,29],[22,,24,28]]);})},{key:"allChildren",value:/*#__PURE__*/regeneratorRuntime.mark(function allChildren(){var wi,_iteratorNormalCompletion439,_didIteratorError439,_iteratorError439,_iterator439,_step439,childWi;return regeneratorRuntime.wrap(function allChildren$(_context166){while(1){switch(_context166.prev=_context166.next){case 0:wi=this.GetWorldInfo();if(wi){_context166.next=3;break;}return _context166.abrupt("return");case 3:_iteratorNormalCompletion439=true;_didIteratorError439=false;_iteratorError439=undefined;_context166.prev=6;_iterator439=wi.allChildren()[Symbol.iterator]();case 8:if(_iteratorNormalCompletion439=(_step439=_iterator439.next()).done){_context166.next=15;break;}childWi=_step439.value;_context166.next=12;return childWi.GetInstance();case 12:_iteratorNormalCompletion439=true;_context166.next=8;break;case 15:_context166.next=21;break;case 17:_context166.prev=17;_context166.t0=_context166["catch"](6);_didIteratorError439=true;_iteratorError439=_context166.t0;case 21:_context166.prev=21;_context166.prev=22;if(!_iteratorNormalCompletion439&&_iterator439["return"]!=null){_iterator439["return"]();}case 24:_context166.prev=24;if(!_didIteratorError439){_context166.next=27;break;}throw _iteratorError439;case 27:return _context166.finish(24);case 28:return _context166.finish(21);case 29:case"end":return _context166.stop();}}},allChildren,this,[[6,17,21,29],[22,,24,28]]);})},{key:"GetChildCount",value:function GetChildCount(){var wi=this.GetWorldInfo();return wi?wi.GetChildCount():0;}},{key:"GetParentCount",value:function GetParentCount(){return _toConsumableArray(this.parents()).length;}},{key:"GetAllChildCount",value:function GetAllChildCount(){var wi=this.GetWorldInfo();return wi?wi.GetAllChildCount():0;}},{key:"GetChildAt",value:function GetChildAt(index){var wi=this.GetWorldInfo();if(!wi)return null;var childWi=wi.GetChildAt(index);return childWi?childWi.GetInstance():null;}},{key:"AddChild",value:function AddChild(childInst,opts){this.VerifySupportsSceneGraph();childInst.VerifySupportsSceneGraph();this.GetWorldInfo().AddChild(childInst.GetWorldInfo(),opts||{});}},{key:"RemoveChild",value:function RemoveChild(childInst){var wi=this.GetWorldInfo();if(!wi)return;wi.RemoveChild(childInst.GetWorldInfo());}},{key:"GetDestroyWithParent",value:function GetDestroyWithParent(){var wi=this.GetWorldInfo();return wi?wi.GetDestroyWithParent():false;}},{key:"SetupInitialSceneGraphConnections",value:function SetupInitialSceneGraphConnections(){var wi=this.GetWorldInfo();if(!wi)return;var childrenData=wi.GetSceneGraphChildrenExportData();if(!childrenData)return;var _iteratorNormalCompletion440=true;var _didIteratorError440=false;var _iteratorError440=undefined;try{for(var _iterator440=childrenData[Symbol.iterator](),_step440;!(_iteratorNormalCompletion440=(_step440=_iterator440.next()).done);_iteratorNormalCompletion440=true){var childData=_step440.value;var child=this._runtime.GetInstanceByUID(childData[2]);if(child){var flags=childData[3];this.AddChild(child,{transformX:!!(flags>>0&1),transformY:!!(flags>>1&1),transformWidth:!!(flags>>2&1),transformHeight:!!(flags>>3&1),transformAngle:!!(flags>>4&1),destroyWithParent:!!(flags>>5&1),transformZElevation:!!(flags>>6&1),transformOpacity:!!(flags>>7&1),transformVisibility:!!(flags>>8&1)});}}}catch(err){_didIteratorError440=true;_iteratorError440=err;}finally{try{if(!_iteratorNormalCompletion440&&_iterator440["return"]!=null){_iterator440["return"]();}}finally{if(_didIteratorError440){throw _iteratorError440;}}}}},{key:"SetupPersistedSceneGraphConnections",value:function SetupPersistedSceneGraphConnections(instanceToPersistedDataMap,persistedIndexToInstanceMap){var persistedData=instanceToPersistedDataMap.get(this);if(!persistedData)return;var _iteratorNormalCompletion441=true;var _didIteratorError441=false;var _iteratorError441=undefined;try{for(var _iterator441=persistedData["sceneGraphJson"]["children"][Symbol.iterator](),_step441;!(_iteratorNormalCompletion441=(_step441=_iterator441.next()).done);_iteratorNormalCompletion441=true){var persistedChildData=_step441.value;var child=persistedIndexToInstanceMap.get(persistedChildData["index"]);if(!child)continue;var flags=persistedChildData["flags"];this.AddChild(child,{transformX:!!(flags>>0&1),transformY:!!(flags>>1&1),transformWidth:!!(flags>>2&1),transformHeight:!!(flags>>3&1),transformAngle:!!(flags>>4&1),destroyWithParent:!!(flags>>5&1),transformZElevation:!!(flags>>6&1),transformOpacity:!!(flags>>7&1),transformVisibility:!!(flags>>8&1)});}}catch(err){_didIteratorError441=true;_iteratorError441=err;}finally{try{if(!_iteratorNormalCompletion441&&_iterator441["return"]!=null){_iterator441["return"]();}}finally{if(_didIteratorError441){throw _iteratorError441;}}}}},{key:"GetTemplateName",value:function GetTemplateName(){var templateManager=this._runtime.GetTemplateManager();return templateManager?templateManager.GetInstanceTemplateName(this):"";}},{key:"IsInContainer",value:function IsInContainer(){return this._siblings!==null;}},{key:"_AddSibling",value:function _AddSibling(inst){this._siblings.push(inst);}},{key:"GetSiblings",value:function GetSiblings(){return this._siblings;}},{key:"HasSibling",value:function HasSibling(objectClass){return!!this.GetSibling(objectClass);}},{key:"GetSibling",value:function GetSibling(objectClass){var siblings=this.siblings();if(siblings===null||siblings.length===0)return false;var _iteratorNormalCompletion442=true;var _didIteratorError442=false;var _iteratorError442=undefined;try{for(var _iterator442=siblings[Symbol.iterator](),_step442;!(_iteratorNormalCompletion442=(_step442=_iterator442.next()).done);_iteratorNormalCompletion442=true){var s=_step442.value;if(s.GetObjectClass()===objectClass)return s;}}catch(err){_didIteratorError442=true;_iteratorError442=err;}finally{try{if(!_iteratorNormalCompletion442&&_iterator442["return"]!=null){_iterator442["return"]();}}finally{if(_didIteratorError442){throw _iteratorError442;}}}return null;}},{key:"siblings",value:function siblings(){return this._siblings;}},{key:"SetSiblingsSinglePicked",value:function SetSiblingsSinglePicked(){var _iteratorNormalCompletion443=true;var _didIteratorError443=false;var _iteratorError443=undefined;try{for(var _iterator443=this.siblings()[Symbol.iterator](),_step443;!(_iteratorNormalCompletion443=(_step443=_iterator443.next()).done);_iteratorNormalCompletion443=true){var s=_step443.value;s.GetObjectClass().GetCurrentSol().SetSinglePicked(s);}}catch(err){_didIteratorError443=true;_iteratorError443=err;}finally{try{if(!_iteratorNormalCompletion443&&_iterator443["return"]!=null){_iterator443["return"]();}}finally{if(_didIteratorError443){throw _iteratorError443;}}}}},{key:"_PushSiblingsToSolInstances",value:function _PushSiblingsToSolInstances(){var _iteratorNormalCompletion444=true;var _didIteratorError444=false;var _iteratorError444=undefined;try{for(var _iterator444=this.siblings()[Symbol.iterator](),_step444;!(_iteratorNormalCompletion444=(_step444=_iterator444.next()).done);_iteratorNormalCompletion444=true){var s=_step444.value;s.GetObjectClass().GetCurrentSol()._PushInstance(s);}}catch(err){_didIteratorError444=true;_iteratorError444=err;}finally{try{if(!_iteratorNormalCompletion444&&_iterator444["return"]!=null){_iterator444["return"]();}}finally{if(_didIteratorError444){throw _iteratorError444;}}}}},{key:"_SetSiblingsToSolInstancesIndex",value:function _SetSiblingsToSolInstancesIndex(i){var _iteratorNormalCompletion445=true;var _didIteratorError445=false;var _iteratorError445=undefined;try{for(var _iterator445=this.siblings()[Symbol.iterator](),_step445;!(_iteratorNormalCompletion445=(_step445=_iterator445.next()).done);_iteratorNormalCompletion445=true){var s=_step445.value;s.GetObjectClass().GetCurrentSol()._GetOwnInstances()[i]=s;}}catch(err){_didIteratorError445=true;_iteratorError445=err;}finally{try{if(!_iteratorNormalCompletion445&&_iterator445["return"]!=null){_iterator445["return"]();}}finally{if(_didIteratorError445){throw _iteratorError445;}}}}},{key:"_PushSiblingsToSolElseInstances",value:function _PushSiblingsToSolElseInstances(){var _iteratorNormalCompletion446=true;var _didIteratorError446=false;var _iteratorError446=undefined;try{for(var _iterator446=this.siblings()[Symbol.iterator](),_step446;!(_iteratorNormalCompletion446=(_step446=_iterator446.next()).done);_iteratorNormalCompletion446=true){var s=_step446.value;s.GetObjectClass().GetCurrentSol()._PushElseInstance(s);}}catch(err){_didIteratorError446=true;_iteratorError446=err;}finally{try{if(!_iteratorNormalCompletion446&&_iterator446["return"]!=null){_iterator446["return"]();}}finally{if(_didIteratorError446){throw _iteratorError446;}}}}},{key:"_SetSiblingsToSolElseInstancesIndex",value:function _SetSiblingsToSolElseInstancesIndex(i){var _iteratorNormalCompletion447=true;var _didIteratorError447=false;var _iteratorError447=undefined;try{for(var _iterator447=this.siblings()[Symbol.iterator](),_step447;!(_iteratorNormalCompletion447=(_step447=_iterator447.next()).done);_iteratorNormalCompletion447=true){var s=_step447.value;s.GetObjectClass().GetCurrentSol()._GetOwnElseInstances()[i]=s;}}catch(err){_didIteratorError447=true;_iteratorError447=err;}finally{try{if(!_iteratorNormalCompletion447&&_iterator447["return"]!=null){_iterator447["return"]();}}finally{if(_didIteratorError447){throw _iteratorError447;}}}}},{key:"GetPlugin",value:function GetPlugin(){return this._objectType.GetPlugin();}},{key:"_SetIID",value:function _SetIID(i){this._iid=i;}},{key:"GetIID",value:function GetIID(){this._objectType._UpdateIIDs();return this._iid;}},{key:"GetUID",value:function GetUID(){return this._uid;}},{key:"GetPUID",value:function GetPUID(){return this._puid;}},{key:"GetBehaviorInstances",value:function GetBehaviorInstances(){return this._behaviorInstances;}},{key:"GetBehaviorInstanceFromCtor",value:function GetBehaviorInstanceFromCtor(ctor){if(!ctor)return null;var _iteratorNormalCompletion448=true;var _didIteratorError448=false;var _iteratorError448=undefined;try{for(var _iterator448=this._behaviorInstances[Symbol.iterator](),_step448;!(_iteratorNormalCompletion448=(_step448=_iterator448.next()).done);_iteratorNormalCompletion448=true){var behInst=_step448.value;if(behInst.GetBehavior()instanceof ctor)return behInst;}}catch(err){_didIteratorError448=true;_iteratorError448=err;}finally{try{if(!_iteratorNormalCompletion448&&_iterator448["return"]!=null){_iterator448["return"]();}}finally{if(_didIteratorError448){throw _iteratorError448;}}}return null;}},{key:"GetBehaviorSdkInstanceFromCtor",value:function GetBehaviorSdkInstanceFromCtor(ctor){if(!ctor)return null;var behInst=this.GetBehaviorInstanceFromCtor(ctor);if(behInst)return behInst.GetSdkInstance();else return null;}},{key:"GetBehaviorIndexBySID",value:function GetBehaviorIndexBySID(sid){var behaviorInstances=this._behaviorInstances;for(var i=0,len=behaviorInstances.length;i<len;++i){if(behaviorInstances[i].GetBehaviorType().GetSID()===sid)return i;}return-1;}},{key:"GetAllInstanceVariableValues",value:function GetAllInstanceVariableValues(){return this._instVarValues;}},{key:"_GetAllInstanceVariableNames",value:function _GetAllInstanceVariableNames(){return this._objectType._GetAllInstanceVariableNames();}},{key:"GetInstanceVariableCount",value:function GetInstanceVariableCount(){return this._instVarValues.length;}},{key:"GetInstanceVariableValue",value:function GetInstanceVariableValue(index){index=index|0;var instVarValues=this._instVarValues;if(index<0||index>=instVarValues.length)throw new RangeError("invalid instance variable");return instVarValues[index];}},{key:"_GetInstanceVariableValueUnchecked",value:function _GetInstanceVariableValueUnchecked(index){return this._instVarValues[index];}},{key:"_GetInstanceVariableTypedValue",value:function _GetInstanceVariableTypedValue(index){var ret=this._instVarValues[index];if(this._objectType.GetInstanceVariableType(index)===0)return!!ret;else return ret;}},{key:"SetInstanceVariableValue",value:function SetInstanceVariableValue(index,value){index=index|0;var instVarValues=this._instVarValues;if(index<0||index>=instVarValues.length)throw new RangeError("invalid instance variable");var type=this._objectType.GetInstanceVariableType(index);switch(type){case 0:instVarValues[index]=value?1:0;break;case 1:instVarValues[index]=typeof value==="number"?value:parseFloat(value);break;case 2:instVarValues[index]=typeof value==="string"?value:value.toString();break;default:throw new Error("unknown instance variable type");}}},{key:"SetInstanceVariableOffset",value:function SetInstanceVariableOffset(index,offset){if(offset===0)return;index=index|0;var instVarValues=this._instVarValues;if(index<0||index>=instVarValues.length)throw new RangeError("invalid instance variable");var lastValue=instVarValues[index];if(typeof lastValue==="number"){if(typeof offset==="number")instVarValues[index]+=offset;else instVarValues[index]+=parseFloat(offset);}else if(typeof lastValue==="boolean")throw new Error("can not set offset of boolean variable");else if(typeof lastValue==="string")throw new Error("can not set offset of string variable");else throw new Error("unknown instance variable type");}},{key:"GetSavedDataMap",value:function GetSavedDataMap(){var ret=savedDataMaps.get(this);if(ret)return ret;ret=new Map();savedDataMaps.set(this,ret);return ret;}},{key:"GetUnsavedDataMap",value:function GetUnsavedDataMap(){var ret=unsavedDataMaps.get(this);if(ret)return ret;ret=new Map();unsavedDataMaps.set(this,ret);return ret;}},{key:"_HasAnyCreateDestroyHandler",value:function _HasAnyCreateDestroyHandler(name){var objectType=this.GetObjectClass();if(objectType.UserScriptDispatcher().HasAnyHandlerFor(name))return true;var _iteratorNormalCompletion449=true;var _didIteratorError449=false;var _iteratorError449=undefined;try{for(var _iterator449=objectType.GetFamilies()[Symbol.iterator](),_step449;!(_iteratorNormalCompletion449=(_step449=_iterator449.next()).done);_iteratorNormalCompletion449=true){var family=_step449.value;if(family.UserScriptDispatcher().HasAnyHandlerFor(name))return true;}}catch(err){_didIteratorError449=true;_iteratorError449=err;}finally{try{if(!_iteratorNormalCompletion449&&_iterator449["return"]!=null){_iterator449["return"]();}}finally{if(_didIteratorError449){throw _iteratorError449;}}}if(this._runtime.UserScriptDispatcher().HasAnyHandlerFor(name))return true;return false;}},{key:"_TriggerOnCreatedOnSelfAndRelated",value:function _TriggerOnCreatedOnSelfAndRelated(){var instancesToTriggerOnCreated=new Set();instancesToTriggerOnCreated.add(this);var wi=this.GetWorldInfo();if(wi&&wi.HasChildren()){var _iteratorNormalCompletion450=true;var _didIteratorError450=false;var _iteratorError450=undefined;try{for(var _iterator450=this.allChildren()[Symbol.iterator](),_step450;!(_iteratorNormalCompletion450=(_step450=_iterator450.next()).done);_iteratorNormalCompletion450=true){var _c18=_step450.value;instancesToTriggerOnCreated.add(_c18);if(!_c18.IsInContainer())continue;var _iteratorNormalCompletion451=true;var _didIteratorError451=false;var _iteratorError451=undefined;try{for(var _iterator451=_c18.siblings()[Symbol.iterator](),_step451;!(_iteratorNormalCompletion451=(_step451=_iterator451.next()).done);_iteratorNormalCompletion451=true){var s=_step451.value;instancesToTriggerOnCreated.add(s);}}catch(err){_didIteratorError451=true;_iteratorError451=err;}finally{try{if(!_iteratorNormalCompletion451&&_iterator451["return"]!=null){_iterator451["return"]();}}finally{if(_didIteratorError451){throw _iteratorError451;}}}}}catch(err){_didIteratorError450=true;_iteratorError450=err;}finally{try{if(!_iteratorNormalCompletion450&&_iterator450["return"]!=null){_iterator450["return"]();}}finally{if(_didIteratorError450){throw _iteratorError450;}}}}if(this.IsInContainer()){var _iteratorNormalCompletion452=true;var _didIteratorError452=false;var _iteratorError452=undefined;try{for(var _iterator452=this.siblings()[Symbol.iterator](),_step452;!(_iteratorNormalCompletion452=(_step452=_iterator452.next()).done);_iteratorNormalCompletion452=true){var _s2=_step452.value;instancesToTriggerOnCreated.add(_s2);}}catch(err){_didIteratorError452=true;_iteratorError452=err;}finally{try{if(!_iteratorNormalCompletion452&&_iterator452["return"]!=null){_iterator452["return"]();}}finally{if(_didIteratorError452){throw _iteratorError452;}}}}var _iteratorNormalCompletion453=true;var _didIteratorError453=false;var _iteratorError453=undefined;try{for(var _iterator453=instancesToTriggerOnCreated.values()[Symbol.iterator](),_step453;!(_iteratorNormalCompletion453=(_step453=_iterator453.next()).done);_iteratorNormalCompletion453=true){var instance=_step453.value;instance._TriggerOnCreated();}}catch(err){_didIteratorError453=true;_iteratorError453=err;}finally{try{if(!_iteratorNormalCompletion453&&_iterator453["return"]!=null){_iterator453["return"]();}}finally{if(_didIteratorError453){throw _iteratorError453;}}}}},{key:"_TriggerOnCreated",value:function _TriggerOnCreated(){if(this._objectType._GetUserScriptInstanceClass())this.GetInterfaceClass();if(this._HasAnyCreateDestroyHandler("instancecreate")){var objectType=this.GetObjectClass();var instCreateEvent=new _C171.Event("instancecreate");instCreateEvent.instance=this.GetInterfaceClass();objectType.DispatchUserScriptEvent(instCreateEvent);var _iteratorNormalCompletion454=true;var _didIteratorError454=false;var _iteratorError454=undefined;try{for(var _iterator454=objectType.GetFamilies()[Symbol.iterator](),_step454;!(_iteratorNormalCompletion454=(_step454=_iterator454.next()).done);_iteratorNormalCompletion454=true){var family=_step454.value;family.DispatchUserScriptEvent(instCreateEvent);}}catch(err){_didIteratorError454=true;_iteratorError454=err;}finally{try{if(!_iteratorNormalCompletion454&&_iterator454["return"]!=null){_iterator454["return"]();}}finally{if(_didIteratorError454){throw _iteratorError454;}}}this._runtime.DispatchUserScriptEvent(instCreateEvent);}this._runtime.Trigger(this.GetPlugin().constructor.Cnds.OnCreated,this,null);}},{key:"_TriggerOnDestroyed",value:function _TriggerOnDestroyed(){this._runtime.Trigger(this.GetPlugin().constructor.Cnds.OnDestroyed,this,null);}},{key:"_FireDestroyedScriptEvents",value:function _FireDestroyedScriptEvents(isEndingLayout){if(this._iScriptInterface){var e=new _C171.Event("destroy");e.isEndingLayout=isEndingLayout;this.DispatchUserScriptEvent(e);}if(!this._HasAnyCreateDestroyHandler("instancedestroy"))return;var objectType=this.GetObjectClass();var instDestroyEvent=new _C171.Event("instancedestroy");instDestroyEvent.instance=this.GetInterfaceClass();instDestroyEvent.isEndingLayout=isEndingLayout;objectType.DispatchUserScriptEvent(instDestroyEvent);var _iteratorNormalCompletion455=true;var _didIteratorError455=false;var _iteratorError455=undefined;try{for(var _iterator455=objectType.GetFamilies()[Symbol.iterator](),_step455;!(_iteratorNormalCompletion455=(_step455=_iterator455.next()).done);_iteratorNormalCompletion455=true){var family=_step455.value;family.DispatchUserScriptEvent(instDestroyEvent);}}catch(err){_didIteratorError455=true;_iteratorError455=err;}finally{try{if(!_iteratorNormalCompletion455&&_iterator455["return"]!=null){_iterator455["return"]();}}finally{if(_didIteratorError455){throw _iteratorError455;}}}this._runtime.DispatchUserScriptEvent(instDestroyEvent);}},{key:"_GetDebuggerProperties",value:function _GetDebuggerProperties(){return this._sdkInst.GetDebuggerProperties();}},{key:"SaveToJson",value:function SaveToJson(){var mode=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"full";var o={};if(mode==="full")o["uid"]=this.GetUID();else o["c3"]=true;if(mode!=="visual-state"){var savedData=savedDataMaps.get(this);if(savedData&&savedData.size)o["ex"]=_C171.ToSuperJSON(savedData);if(this.GetTimeScale()!==-1)o["mts"]=this.GetTimeScale();if(this._objectType.GetInstanceVariablesCount()>0){var ivs={};var ivSids=this._objectType.GetInstanceVariableSIDs();for(var i=0,len=this._instVarValues.length;i<len;++i){ivs[ivSids[i].toString()]=this._instVarValues[i];}o["ivs"]=ivs;}if(this._behaviorInstances.length){var behs={};var _iteratorNormalCompletion456=true;var _didIteratorError456=false;var _iteratorError456=undefined;try{for(var _iterator456=this._behaviorInstances[Symbol.iterator](),_step456;!(_iteratorNormalCompletion456=(_step456=_iterator456.next()).done);_iteratorNormalCompletion456=true){var behInst=_step456.value;var data=behInst.SaveToJson();if(data)behs[behInst.GetBehaviorType().GetSID().toString()]=data;}}catch(err){_didIteratorError456=true;_iteratorError456=err;}finally{try{if(!_iteratorNormalCompletion456&&_iterator456["return"]!=null){_iterator456["return"]();}}finally{if(_didIteratorError456){throw _iteratorError456;}}}o["behs"]=behs;}}if(this._worldInfo)o["w"]=this._worldInfo._SaveToJson(mode);var ownData=this._sdkInst.SaveToJson();if(ownData)o["data"]=ownData;return o;}},{key:"_OnBeforeLoad",value:function _OnBeforeLoad(){var mode=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"full";if(this._worldInfo)this._worldInfo._OnBeforeLoad(mode);}},{key:"_OnAfterLoad",value:function _OnAfterLoad(o){var mode=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"full";var opts=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;if(this._worldInfo)this._worldInfo._OnAfterLoad(o,mode,opts);}},{key:"_OnAfterLoad2",value:function _OnAfterLoad2(o){var mode=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"full";var opts=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;if(this._worldInfo)this._worldInfo._OnAfterLoad2(o,mode,opts);}},{key:"_SetupSceneGraphConnectionsOnChangeOfLayout",value:function _SetupSceneGraphConnectionsOnChangeOfLayout(){if(!this.GetPlugin().IsWorldType())return;this._worldInfo._SetupSceneGraphConnectionsOnChangeOfLayout();}},{key:"LoadFromJson",value:function LoadFromJson(o){var mode=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"full";if(mode==="full")this._uid=o["uid"];else if(!o["c3"])return;if(mode!=="visual-state"){var savedData=savedDataMaps.get(this);if(savedData){savedData.clear();savedDataMaps["delete"](this);}var ex=o["ex"];if(ex){savedData=_C171.FromSuperJSON(ex);savedDataMaps.set(this,savedData);}this._timeScale=o.hasOwnProperty("mts")?o["mts"]:-1;var ivs=o["ivs"];if(ivs){for(var _i58=0,_Object$entries16=Object.entries(ivs);_i58<_Object$entries16.length;_i58++){var _Object$entries16$_i=_slicedToArray(_Object$entries16[_i58],2),sidStr=_Object$entries16$_i[0],value=_Object$entries16$_i[1];var sid=parseInt(sidStr,10);var _index2=this._objectType.GetInstanceVariableIndexBySID(sid);if(_index2<0||_index2>=this._instVarValues.length)continue;var v=value;if(v===null)v=NaN;this._instVarValues[_index2]=v;}}}if(this.GetPlugin().IsWorldType()){var worldData=o["w"];var layerSid=worldData["l"];if(this._worldInfo.GetLayer().GetSID()!==layerSid){var oldLayer=this._worldInfo.GetLayer();var newLayer=oldLayer.GetLayout().GetLayerBySID(layerSid);if(newLayer){this._worldInfo._SetLayer(newLayer);oldLayer._RemoveInstance(this,true);newLayer._AddInstance(this,true);newLayer.SetZIndicesChanged(this);this._worldInfo.SetBboxChanged();}else if(mode==="full")this._runtime.DestroyInstance(this);}this._worldInfo._LoadFromJson(worldData,mode);}if(mode!=="visual-state"){var behs=o["behs"];if(behs){for(var _i59=0,_Object$entries17=Object.entries(behs);_i59<_Object$entries17.length;_i59++){var _Object$entries17$_i=_slicedToArray(_Object$entries17[_i59],2),_sidStr=_Object$entries17$_i[0],data=_Object$entries17$_i[1];var _sid4=parseInt(_sidStr,10);var _index3=this.GetBehaviorIndexBySID(_sid4);if(_index3<0||_index3>=this._behaviorInstances.length)continue;this._behaviorInstances[_index3].LoadFromJson(data);}}}var ownData=o["data"];if(ownData)this._sdkInst.LoadFromJson(ownData,mode);}},{key:"GetInterfaceClass",value:function GetInterfaceClass(){return this._iScriptInterface||this._InitUserScriptInterface();}},{key:"HasScriptInterface",value:function HasScriptInterface(){return!!this._iScriptInterface;}},{key:"_InitUserScriptInterface",value:function _InitUserScriptInterface(){var DefaultScriptClass=this._worldInfo?self.IWorldInstance:_IInstance3;var SdkScriptClass=this._sdkInst.GetScriptInterfaceClass();var UserScriptClass=this._objectType._GetUserScriptInstanceClass();var ScriptInterfaceClass=UserScriptClass||SdkScriptClass||DefaultScriptClass;_IInstance3._Init(this);this._iScriptInterface=new ScriptInterfaceClass();_IInstance3._Init(null);if(SdkScriptClass&&!(this._iScriptInterface instanceof DefaultScriptClass))throw new TypeError("script interface class '".concat(SdkScriptClass.name,"' does not extend the right base class '").concat(DefaultScriptClass.name,"'"));if(UserScriptClass){var ExpectedBaseClass=SdkScriptClass||DefaultScriptClass;if(!(this._iScriptInterface instanceof ExpectedBaseClass))throw new TypeError("setInstanceClass(): class '".concat(UserScriptClass.name,"' does not extend the right base class - check it extends the right class, e.g. globalThis.InstanceType.MyObjectName"));}return this._iScriptInterface;}},{key:"_GetInstVarsScriptDescriptor",value:function _GetInstVarsScriptDescriptor(instDescriptors){if(this._instVarValues.length===0)return;var varDescriptors={};var instVarJsPropNames=this._objectType._GetAllInstanceVariableJsPropNames();for(var i=0,len=instVarJsPropNames.length;i<len;++i){varDescriptors[instVarJsPropNames[i]]={configurable:false,enumerable:true,get:_C171.Instance.prototype._GetInstanceVariableTypedValue.bind(this,i),set:_C171.Instance.prototype.SetInstanceVariableValue.bind(this,i)};}var instVarsObj=Object.create(Object.prototype,varDescriptors);instDescriptors.instVars={value:instVarsObj,writable:false};}},{key:"_GetBehaviorsScriptDescriptor",value:function _GetBehaviorsScriptDescriptor(instDescriptors){var behaviorInstances=this._behaviorInstances;if(behaviorInstances.length===0)return;var behDescriptors={};var _iteratorNormalCompletion457=true;var _didIteratorError457=false;var _iteratorError457=undefined;try{for(var _iterator457=behaviorInstances[Symbol.iterator](),_step457;!(_iteratorNormalCompletion457=(_step457=_iterator457.next()).done);_iteratorNormalCompletion457=true){var behInst=_step457.value;behDescriptors[behInst.GetBehaviorType().GetJsPropName()]={value:behInst.GetScriptInterface(),writable:false};}}catch(err){_didIteratorError457=true;_iteratorError457=err;}finally{try{if(!_iteratorNormalCompletion457&&_iterator457["return"]!=null){_iterator457["return"]();}}finally{if(_didIteratorError457){throw _iteratorError457;}}}var behaviorsObj=Object.create(Object.prototype,behDescriptors);instDescriptors.behaviors={value:behaviorsObj,writable:false};}},{key:"DispatchUserScriptEvent",value:function DispatchUserScriptEvent(e){if(!this.HasScriptInterface())return;var scriptInterface=this.GetInterfaceClass();e.instance=scriptInterface;var runtime=this._runtime;var shouldTime=runtime.IsDebug()&&!runtime.GetEventSheetManager().IsInEventEngine();if(shouldTime)_C3Debugger2.StartMeasuringScriptTime();scriptInterface.dispatchEvent(e);if(shouldTime)_C3Debugger2.AddScriptTime();}}]);return Instance;}(_C171.DefendedBase);}// objects/sceneGraphInfo.js
{'use strict';var _C172=self.C3;_C172.SceneGraphInfo=/*#__PURE__*/function(_C172$DefendedBase){_inherits(SceneGraphInfo,_C172$DefendedBase);function SceneGraphInfo(owner){var _this139;_classCallCheck(this,SceneGraphInfo);_this139=_possibleConstructorReturn(this,_getPrototypeOf(SceneGraphInfo).call(this));_this139._owner=owner;_this139._parent=null;_this139._children=[];_this139._startWidth=owner.GetWidth();_this139._startHeight=owner.GetHeight();_this139._startScaleX=1;_this139._startScaleY=1;_this139._parentStartAngle=0;_this139._ownOpacity=1;_this139._startOpacity=owner.GetOpacity();_this139._tmpSceneGraphChildren=null;_this139._tmpSceneGraphChildrenIndexes=null;return _this139;}_createClass(SceneGraphInfo,[{key:"Release",value:function Release(){this._parent=null;this._tmpSceneGraphChildren=null;this._tmpSceneGraphChildrenIndexes=null;_C172.clearArray(this._children);}},{key:"SetParent",value:function SetParent(parent){this._ownOpacity=this._owner.GetOpacity();this._startOpacity=this._ownOpacity;this._parent=parent;this._parentStartAngle=parent?parent.GetAngle():0;}},{key:"GetParent",value:function GetParent(){return this._parent;}},{key:"HasChildren",value:function HasChildren(){return this._children.length>0;}},{key:"GetChildren",value:function GetChildren(){return this._children;}},{key:"_MaybeSortChildren",value:function _MaybeSortChildren(){var _this140=this;if(!this.HasChildren())return;if(!this._tmpSceneGraphChildrenIndexes)return;if(this._children.length===1)return;this._children.sort(function(f,s){var fIndex=_this140._tmpSceneGraphChildrenIndexes.get(f.GetInstance());var sIndex=_this140._tmpSceneGraphChildrenIndexes.get(s.GetInstance());if(_C172.IsFiniteNumber(fIndex)&&_C172.IsFiniteNumber(sIndex))return fIndex-sIndex;return 0;});}},{key:"GetStartScaleX",value:function GetStartScaleX(){return this._startScaleX;}},{key:"SetStartScaleX",value:function SetStartScaleX(sx){this._startScaleX=sx;}},{key:"GetStartScaleY",value:function GetStartScaleY(){return this._startScaleY;}},{key:"SetStartScaleY",value:function SetStartScaleY(sy){this._startScaleY=sy;}},{key:"GetStartOpacity",value:function GetStartOpacity(){return this._startOpacity;}},{key:"GetOwnOpacity",value:function GetOwnOpacity(){return this._ownOpacity;}},{key:"SetOwnOpacity",value:function SetOwnOpacity(ownOpacity){this._ownOpacity=ownOpacity;}},{key:"_GetStartWidth",value:function _GetStartWidth(){if(this._startWidth===0)return Number.EPSILON;return this._startWidth;}},{key:"_GetStartHeight",value:function _GetStartHeight(){if(this._startHeight===0)return Number.EPSILON;return this._startHeight;}},{key:"GetParentScaleX",value:function GetParentScaleX(){if(this._owner.GetTransformWithParentWidth()){var p=this._parent;var cw=p.GetWidth();var sw=p._GetSceneGraphInfo()._GetStartWidth();if(cw===0)cw=Number.EPSILON;if(sw===Number.EPSILON&&cw===Number.EPSILON)return 1;if(sw===Number.EPSILON&&cw!==Number.EPSILON){var sdkIntance=p.GetInstance().GetSdkInstance();if(sdkIntance.IsOriginalSizeKnown())return 1+cw/sdkIntance.GetOriginalWidth();}return cw/sw;}return 1;}},{key:"GetParentScaleY",value:function GetParentScaleY(){if(this._owner.GetTransformWithParentHeight()){var p=this._parent;var ch=p.GetHeight();var sh=p._GetSceneGraphInfo()._GetStartHeight();if(ch===0)ch=Number.EPSILON;if(sh===Number.EPSILON&&ch===Number.EPSILON)return 1;if(sh===Number.EPSILON&&ch!==Number.EPSILON){var sdkIntance=p.GetInstance().GetSdkInstance();if(sdkIntance.IsOriginalSizeKnown())return 1+ch/sdkIntance.GetOriginalHeight();}return ch/sh;}return 1;}},{key:"GetParentStartAngle",value:function GetParentStartAngle(){return this._parentStartAngle;}},{key:"_SaveToJsonProperties",value:function _SaveToJsonProperties(){return{"sw":this._startWidth,"sh":this._startHeight,"sx":this._startScaleX,"sy":this._startScaleY,"psa":this._parentStartAngle,"oo":this._ownOpacity,"so":this._startOpacity};}},{key:"_SaveToJson",value:function _SaveToJson(mode){return Object.assign(this._SaveToJsonProperties(),{"p":this._GetParentJson(mode),"c":this._GetChildrenJson(mode)});}},{key:"_GetFlagsString",value:function _GetFlagsString(wi){var flagsStr="";if(wi.GetTransformWithParentX())flagsStr+="x";if(wi.GetTransformWithParentY())flagsStr+="y";if(wi.GetTransformWithParentWidth())flagsStr+="w";if(wi.GetTransformWithParentHeight())flagsStr+="h";if(wi.GetTransformWithParentAngle())flagsStr+="a";if(wi.GetTransformWithParentZElevation())flagsStr+="z";if(wi.GetDestroyWithParent())flagsStr+="d";if(wi.GetTransformWithParentOpacity())flagsStr+="o";if(wi.GetTransformWithParentVisibility())flagsStr+="v";return flagsStr;}},{key:"_GetParentJson",value:function _GetParentJson(mode){if(!this._parent)return null;if(!this._parent.GetInstance()||this._parent.GetInstance().IsDestroyed())return null;return this._GetInstanceJson(this._parent,this._owner,mode);}},{key:"_GetChildrenJson",value:function _GetChildrenJson(mode){var _this141=this;return this._children.map(function(c){return _this141._GetInstanceJson(c,c,mode);});}},{key:"_GetInstanceJson",value:function _GetInstanceJson(wi,flagsSource,mode){var inst=wi.GetInstance();var ret={};ret["uid"]=inst.GetUID();ret["f"]=this._GetFlagsString(flagsSource);ret["offsets"]=flagsSource._SaveSceneGraphPropertiesToJson();ret["data"]=_C172.SceneGraphInfo.GetSceneGraphInstanceDataFromInstance(inst);ret["oci"]=inst.GetObjectClass().GetIndex();if(mode==="state"){ret["inst"]=inst.SaveToJson();ret["instIndex"]=NaN;}else{ret["instIndex"]=inst.GetObjectClass().GetInstances().indexOf(inst);ret["inst"]=null;}return ret;}},{key:"_LoadFromJson",value:function _LoadFromJson(o){this._startWidth=o["sw"];this._startHeight=o["sh"];this._startScaleX=o["sx"];this._startScaleY=o["sy"];this._parentStartAngle=o["psa"];this._ownOpacity=o["oo"];this._startOpacity=o["so"];}},{key:"_SetTmpSceneGraphChildren",value:function _SetTmpSceneGraphChildren(tmpSceneGraphChildren,tmpSceneGraphChildrenIndexes){this._tmpSceneGraphChildren=tmpSceneGraphChildren;this._tmpSceneGraphChildrenIndexes=tmpSceneGraphChildrenIndexes;}},{key:"_OnAfterLoad",value:function _OnAfterLoad(o,opts){var owner=this._owner;var runtime=owner.GetRuntime();var processedExistingWis=new Set();if(o["p"]&&!this._parent){var parentUid=o["p"]["uid"];var parentInst=runtime.GetInstanceByUID(parentUid);if(opts&&!opts.ignoreMissingInstances);if(parentInst){var parentWi=parentInst.GetWorldInfo();if(parentInst.HasChild(this._owner.GetInstance()))this._parent=parentWi;else{if(opts&&opts.instancesDoingAfterLoadMap)if(opts.instancesDoingAfterLoadMap.has(parentInst))return;parentInst.AddChild(this._owner.GetInstance(),this._GetFlagsObj(o["p"]["f"]));if(!processedExistingWis.has(this._owner))this._owner._LoadSceneGraphPropertiesFromJson(o["p"]["offsets"]);processedExistingWis.add(this._owner);var pwi=parentInst.GetWorldInfo();pwi._GetSceneGraphInfo()._MaybeSortChildren();}}else if(_C172.IsFiniteNumber(o["p"]["oci"])){var objectClass=runtime.GetObjectClassByIndex(o["p"]["oci"]);var system=runtime.GetSystemPlugin();var parentInstance=runtime.CreateInstance(objectClass,owner.GetLayer(),0,0,true);if(opts&&!opts.ignoreMissingInstances);if(parentInstance){var instData=this._GetInstanceData(o["p"],runtime);parentInstance.LoadFromJson(instData);var _parentWi=parentInstance.GetWorldInfo();_parentWi.GetLayer().SortAndAddInstancesByZIndex(parentInstance);parentInstance.AddChild(owner.GetInstance(),this._GetFlagsObj(o["p"]["f"]));var _pwi=parentInstance.GetWorldInfo();_pwi._GetSceneGraphInfo()._MaybeSortChildren();}}}var childInstances=[];var _iteratorNormalCompletion458=true;var _didIteratorError458=false;var _iteratorError458=undefined;try{for(var _iterator458=o["c"][Symbol.iterator](),_step458;!(_iteratorNormalCompletion458=(_step458=_iterator458.next()).done);_iteratorNormalCompletion458=true){var childData=_step458.value;var childUid=childData["uid"];var childInst=runtime.GetInstanceByUID(childUid);if(childInst)childInstances.push(childInst);}}catch(err){_didIteratorError458=true;_iteratorError458=err;}finally{try{if(!_iteratorNormalCompletion458&&_iterator458["return"]!=null){_iterator458["return"]();}}finally{if(_didIteratorError458){throw _iteratorError458;}}}var childIndex=0;var _iteratorNormalCompletion459=true;var _didIteratorError459=false;var _iteratorError459=undefined;try{for(var _iterator459=o["c"][Symbol.iterator](),_step459;!(_iteratorNormalCompletion459=(_step459=_iterator459.next()).done);_iteratorNormalCompletion459=true){var _childData=_step459.value;var _childUid=_childData["uid"];var _childInst=runtime.GetInstanceByUID(_childUid);if(opts&&!opts.ignoreMissingInstances);if(_childInst){if(this._tmpSceneGraphChildren&&this._tmpSceneGraphChildren[childIndex]){var existingChildIntance=this._tmpSceneGraphChildren[childIndex];if(existingChildIntance.GetObjectClass()!==_childInst.GetObjectClass()){childIndex++;continue;}if(existingChildIntance.IsDestroyed()){childIndex++;continue;}var newChildData=o["c"][childIndex];this._AddAndSetChildInstance(existingChildIntance.GetWorldInfo(),newChildData,processedExistingWis,true);childIndex++;continue;}var _objectClass6=_childInst.GetObjectClass();var childrenCount=this._GetInstancesOfObjectClassCount(childInstances,_objectClass6);var childrenOfClassCount=owner.GetInstance().GetChildrenOfObjectClass(_objectClass6).length;if(childrenCount===childrenOfClassCount){var existingChild=owner.GetInstance().GetChildAt(childIndex);var existingChildWi=existingChild.GetWorldInfo();if(existingChildWi){if(!processedExistingWis.has(existingChildWi))existingChildWi._LoadSceneGraphPropertiesFromJson(_childData["offsets"]);processedExistingWis.add(existingChildWi);}childIndex++;continue;}if(_childInst.HasParent()){var childWi=this._CreateNewChildInstance(_childData,opts);this._AddAndSetChildInstance(childWi,_childData,processedExistingWis);childIndex++;continue;}this._AddAndSetChildInstance(_childInst.GetWorldInfo(),_childData,processedExistingWis);}else if(this._tmpSceneGraphChildren&&this._tmpSceneGraphChildren[childIndex]){var _existingChildIntance=this._tmpSceneGraphChildren[childIndex];var _objectClass7=runtime.GetObjectClassByIndex(this._GetObjectClassIndex(_childData));if(_existingChildIntance.GetObjectClass()!==_objectClass7){childIndex++;continue;}if(_existingChildIntance.IsDestroyed()){childIndex++;continue;}var _newChildData=o["c"][childIndex];this._AddAndSetChildInstance(_existingChildIntance.GetWorldInfo(),_newChildData,processedExistingWis);}else{var _childWi=this._CreateNewChildInstance(_childData,opts);this._AddAndSetChildInstance(_childWi,_childData,processedExistingWis);}childIndex++;}}catch(err){_didIteratorError459=true;_iteratorError459=err;}finally{try{if(!_iteratorNormalCompletion459&&_iterator459["return"]!=null){_iterator459["return"]();}}finally{if(_didIteratorError459){throw _iteratorError459;}}}}},{key:"_GetFlagsObj",value:function _GetFlagsObj(flagsString){var opts={};opts.transformX=flagsString.includes("x");opts.transformY=flagsString.includes("y");opts.transformWidth=flagsString.includes("w");opts.transformHeight=flagsString.includes("h");opts.transformAngle=flagsString.includes("a");opts.transformZElevation=flagsString.includes("z");opts.destroyWithParent=flagsString.includes("d");opts.transformOpacity=flagsString.includes("o");opts.transformVisibility=flagsString.includes("v");return opts;}},{key:"_GetObjectClassIndex",value:function _GetObjectClassIndex(childData){if(_C172.IsFiniteNumber(childData["oci"]))return childData["oci"];return childData[1];}},{key:"_CreateNewChildInstance",value:function _CreateNewChildInstance(childData,opts){if(!_C172.IsFiniteNumber(childData["oci"]))return;var owner=this._owner;var runtime=owner.GetRuntime();var childInstance;if(childData["data"])childInstance=runtime.CreateInstanceFromData(childData["data"],owner.GetLayer(),false,0,0,false,true);else{var objectClass=runtime.GetObjectClassByIndex(childData["oci"]);childInstance=runtime.CreateInstance(objectClass,owner.GetLayer(),0,0,true);}if(opts&&!opts.ignoreMissingInstances);if(!childInstance)return;var instData=this._GetInstanceData(childData,runtime);childInstance.LoadFromJson(instData);var childWi=childInstance.GetWorldInfo();childWi.GetLayer().SortAndAddInstancesByZIndex(childInstance,true);return childWi;}},{key:"_AddAndSetChildInstance",value:function _AddAndSetChildInstance(childWi,childData,processedExistingWis){var setJson=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;var owner=this._owner;var added=owner.AddChild(childWi,this._GetFlagsObj(childData["f"]));if(added&&setJson){if(!processedExistingWis.has(childWi))childWi._LoadSceneGraphPropertiesFromJson(childData["offsets"]);processedExistingWis.add(childWi);}this._MaybeSortChildren();}},{key:"_GetInstancesOfObjectClassCount",value:function _GetInstancesOfObjectClassCount(instances,objectClass){return instances.filter(function(i){return i.GetObjectClass().GetName()===objectClass.GetName();}).length;}},{key:"_GetInstanceData",value:function _GetInstanceData(json,runtime){if(_C172.IsFiniteNumber(json["instIndex"])){var objectClass=runtime.GetObjectClassByIndex(json["oci"]);var instancesJson=objectClass._GetLoadInstancesJson();return instancesJson[json["instIndex"]];}else if(_C172.IsString(json["inst"]))return JSON.parse(json["inst"]);else if(json["inst"])return json["inst"];}}],[{key:"GetSceneGraphInstanceDataFromInstance",value:function GetSceneGraphInstanceDataFromInstance(sourceInstance){var instData=sourceInstance.GetWorldInfo().GetLayer().GetInitialInstanceData(sourceInstance.GetUID());if(!instData)return null;instData=JSON.parse(JSON.stringify(instData));var newSgiData=[];for(var _i60=0,_arr4=_toConsumableArray(sourceInstance.GetChildren());_i60<_arr4.length;_i60++){var child=_arr4[_i60];var childWi=child.GetWorldInfo();newSgiData.push([childWi.GetLayout().GetSID(),childWi.GetLayer().GetIndex(),child.GetUID(),_C172.SceneGraphInfo._GetFlagsNumber(childWi),child.GetObjectClass().IsInContainer()?1:0,childWi.GetZIndex(),_C172.SceneGraphInfo.GetSceneGraphInstanceDataFromInstance(child)]);}if(_C172.IsArray(instData[0][14]))instData[0][14][1]=newSgiData;else{instData[0][14]=[];instData[0][14][0]=_C172.SceneGraphInfo._GetDefaultFlagsNumber();instData[0][14][1]=newSgiData;instData[0][14][2]=sourceInstance.GetWorldInfo().GetZIndex();}return instData;}},{key:"_GetFlagsNumber",value:function _GetFlagsNumber(wi){var flagsNumber=0;flagsNumber|=Number(wi.GetTransformWithParentVisibility())<<8;flagsNumber|=Number(wi.GetTransformWithParentOpacity())<<7;flagsNumber|=Number(wi.GetTransformWithParentZElevation())<<6;flagsNumber|=Number(wi.GetDestroyWithParent())<<5;flagsNumber|=Number(wi.GetTransformWithParentAngle())<<4;flagsNumber|=Number(wi.GetTransformWithParentHeight())<<3;flagsNumber|=Number(wi.GetTransformWithParentWidth())<<2;flagsNumber|=Number(wi.GetTransformWithParentY())<<1;flagsNumber|=Number(wi.GetTransformWithParentX())<<0;return flagsNumber;}},{key:"_GetDefaultFlagsNumber",value:function _GetDefaultFlagsNumber(wi){var flagsNumber=0;flagsNumber|=1<<8;flagsNumber|=1<<7;flagsNumber|=1<<6;flagsNumber|=1<<5;flagsNumber|=1<<4;flagsNumber|=1<<3;flagsNumber|=1<<2;flagsNumber|=1<<1;flagsNumber|=1<<0;return flagsNumber;}}]);return SceneGraphInfo;}(_C172.DefendedBase);}// objects/worldInfo.js
{'use strict';var _C173=self.C3;var _glMatrix10=self.glMatrix;var _vec11=_glMatrix10.vec3;var _vec12=_glMatrix10.vec4;var _tempRect6=_C173.New(_C173.Rect);var _tempQuad3=_C173.New(_C173.Quad);var bboxChangeEvent=_C173.New(_C173.Event,"bboxchange",false);var _tempColor6=_C173.New(_C173.Color,0,0,0,0);var tempCollisionPoly=_C173.New(_C173.CollisionPoly);var DEFAULT_COLOR=_C173.New(_C173.Color,1,1,1,1);var DEFAULT_RENDER_CELLS=_C173.New(_C173.Rect,0,0,-1,-1);var DEFAULT_COLLISION_CELLS=_C173.New(_C173.Rect,0,0,-1,-1);var VALID_SET_MESH_POINT_MODES=new Set(["absolute","relative"]);var _EMPTY_ARRAY2=[];var enableUpdateRendererStateGroup=true;var FLAG_IS_VISIBLE=1<<0;var FLAG_BBOX_CHANGED=1<<1;var FLAG_ENABLE_BBOX_CHANGED_EVENT=1<<2;var FLAG_COLLISION_ENABLED=1<<3;var FLAG_COLLISION_CELL_CHANGED=1<<4;var FLAG_SOLID_FILTER_INCLUSIVE=1<<5;var FLAG_HAS_ANY_ACTIVE_EFFECT=1<<6;var FLAG_IS_ROTATABLE=1<<7;var _FLAG_DESTROYED=1<<8;var FLAG_DESTROY_WITH_PARENT=1<<9;var FLAG_TRANSFORM_WITH_PARENT_X=1<<10;var FLAG_TRANSFORM_WITH_PARENT_Y=1<<11;var FLAG_TRANSFORM_WITH_PARENT_W=1<<12;var FLAG_TRANSFORM_WITH_PARENT_H=1<<13;var FLAG_TRANSFORM_WITH_PARENT_A=1<<14;var FLAG_TRANSFORM_WITH_PARENT_Z_ELEVATION=1<<15;var FLAG_TRANSFORM_WITH_PARENT_OPACITY=1<<22;var FLAG_TRANSFORM_WITH_PARENT_VISIBILITY=1<<23;var MASK_ALL_SCENE_GRAPH_FLAGS=FLAG_DESTROY_WITH_PARENT|FLAG_TRANSFORM_WITH_PARENT_X|FLAG_TRANSFORM_WITH_PARENT_Y|FLAG_TRANSFORM_WITH_PARENT_W|FLAG_TRANSFORM_WITH_PARENT_H|FLAG_TRANSFORM_WITH_PARENT_A|FLAG_TRANSFORM_WITH_PARENT_Z_ELEVATION|FLAG_TRANSFORM_WITH_PARENT_OPACITY|FLAG_TRANSFORM_WITH_PARENT_VISIBILITY;var FLAG_MESH_CHANGED=1<<16;var FLAG_PHYSICS_BODY_CHANGED=1<<17;var FLAG_SIN_COS_ANGLE_CHANGED=1<<18;var FLAG_USE_POINTS_SHADER_PROGRAM=1<<19;var FLAG_DRAW_BACK_FACE_ONLY=1<<20;var FLAG_DRAW_NON_BACK_FACES_ONLY=1<<21;var FLAG_BLEND_MODE_BIT_OFFSET=26;var FLAG_BLEND_MODE_MASK=31<<FLAG_BLEND_MODE_BIT_OFFSET;var sceneGraphExportDataMap=new WeakMap();var sceneGraphZIndexMap=new WeakMap();_C173.WorldInfo=/*#__PURE__*/function(_C173$DefendedBase){_inherits(WorldInfo,_C173$DefendedBase);function WorldInfo(inst,layer){var _this142;_classCallCheck(this,WorldInfo);_this142=_possibleConstructorReturn(this,_getPrototypeOf(WorldInfo).call(this));_this142._inst=inst;_this142._objectClass=inst.GetObjectClass();_this142._runtime=inst.GetRuntime();_this142._layer=layer;_this142._zIndex=-1;_this142._htmlZIndex=-1;_this142._flags=FLAG_IS_VISIBLE|FLAG_BBOX_CHANGED|FLAG_COLLISION_ENABLED|FLAG_COLLISION_CELL_CHANGED|FLAG_MESH_CHANGED|FLAG_PHYSICS_BODY_CHANGED;if(_this142._objectClass.GetPlugin().IsRotatable())_this142._flags|=FLAG_IS_ROTATABLE;_this142._x=NaN;_this142._y=NaN;_this142._zElevation=NaN;_this142._w=NaN;_this142._h=NaN;_this142._depth=NaN;_this142._a=NaN;_this142._sinA=NaN;_this142._cosA=NaN;_this142._ox=NaN;_this142._oy=NaN;_this142._boundingBox=_C173.New(_C173.Rect);_this142._boundingQuad=_C173.New(_C173.Quad);_this142._collisionCells=DEFAULT_COLLISION_CELLS;_this142._renderCells=DEFAULT_RENDER_CELLS;_this142._sourceCollisionPoly=null;_this142._transformedPolyInfo=null;_this142._solidFilterTags=null;_this142._color=DEFAULT_COLOR;_this142._colorPremultiplied=DEFAULT_COLOR;_this142._stateGroup=null;_this142._instanceEffectList=null;if(_this142._inst.GetObjectClass().UsesEffects())_this142._instanceEffectList=_C173.New(_C173.InstanceEffectList,_this142._inst,_assertThisInitialized(_this142));_this142._sceneGraphInfo=null;_this142._tmpSceneGraphChildren=null;_this142._tmpSceneGraphChildrenIndexes=null;_this142._tmpHierarchyPosition=-1;_this142._meshInfo=null;return _this142;}_createClass(WorldInfo,[{key:"_MarkDestroyed",value:function _MarkDestroyed(){this._flags|=_FLAG_DESTROYED;}},{key:"Release",value:function Release(){if(this._stateGroup){this._runtime.GetRenderer().ReleaseStateGroup(this._stateGroup);this._stateGroup=null;}this._sourceCollisionPoly=null;if(this._transformedPolyInfo){this._transformedPolyInfo.poly.Release();this._transformedPolyInfo=null;}if(this._solidFilterTags){this._solidFilterTags.clear();this._solidFilterTags=null;}this.ReleaseMesh();if(this._instanceEffectList)this._instanceEffectList.Release();if(this.HasParent())this.GetParent().RemoveChild(this);if(this.HasChildren()){var childrenToRelease=_toConsumableArray(this.GetChildren());var _iteratorNormalCompletion460=true;var _didIteratorError460=false;var _iteratorError460=undefined;try{for(var _iterator460=childrenToRelease[Symbol.iterator](),_step460;!(_iteratorNormalCompletion460=(_step460=_iterator460.next()).done);_iteratorNormalCompletion460=true){var child=_step460.value;this.RemoveChild(child);}}catch(err){_didIteratorError460=true;_iteratorError460=err;}finally{try{if(!_iteratorNormalCompletion460&&_iterator460["return"]!=null){_iterator460["return"]();}}finally{if(_didIteratorError460){throw _iteratorError460;}}}}this._ReleaseSceneGraphInfo();this._ReleaseTmpSceneGraphInfo();sceneGraphExportDataMap["delete"](this);sceneGraphZIndexMap["delete"](this);this._inst=null;this._objectClass=null;this._runtime=null;this._layer=null;}},{key:"Init",value:function Init(data){enableUpdateRendererStateGroup=false;this.SetXY(data[0],data[1]);this.SetZElevation(data[2]);this.SetSize(data[3],data[4]);this._depth=0;if(this.IsRotatable())this.SetAngle(data[6]);else this._a=0;_tempColor6.setFromJSON(data[7]);this._SetColor(_tempColor6);this.SetOriginX(data[8]);this.SetOriginY(data[9]);this.SetBlendMode(data[10]);if(this._instanceEffectList)this._instanceEffectList._LoadEffectParameters(data[12]);if(data[14])sceneGraphExportDataMap.set(this,{childrenData:data[14][1],zIndexData:data[14][2]});if(data[15]){var meshData=data[15];this.CreateMesh(meshData[0],meshData[1]);var sourceMesh=this.GetSourceMesh();var meshRows=meshData[2];for(var y=0,lenY=meshRows.length;y<lenY;++y){var rowData=meshRows[y];for(var x=0,lenX=rowData.length;x<lenX;++x){var d=rowData[x];var pt=sourceMesh.GetMeshPointAt(x,y);pt.SetX(d[0]);pt.SetY(d[1]);pt.SetZElevation(d[2]);pt.SetU(d[3]);pt.SetV(d[4]);}}}if(data[16]){var templateName=data[16][0];var sourceTemplateName=data[16][1];var isReplica=!!sourceTemplateName;var isTemplate=!isReplica;var templateManager=this._runtime.GetTemplateManager();if(isReplica&&templateManager)templateManager.MapInstanceToTemplateName(this.GetInstance(),sourceTemplateName);if(isTemplate&&templateManager)templateManager.MapInstanceToTemplateName(this.GetInstance(),templateName);}enableUpdateRendererStateGroup=true;this._UpdateRendererStateGroup();}},{key:"InitNoData",value:function InitNoData(){this._x=0;this._y=0;this._zElevation=0;this._w=0;this._h=0;this._depth=0;this._a=0;this._sinA=0;this._cosA=1;this._ox=0;this._oy=0;this._UpdateRendererStateGroup();}},{key:"GetRuntime",value:function GetRuntime(){return this._runtime;}},{key:"GetObjectClass",value:function GetObjectClass(){return this._objectClass;}},{key:"GetInstance",value:function GetInstance(){return this._inst;}},{key:"_GetParentOffsetAngle",value:function _GetParentOffsetAngle(){if(this.GetTransformWithParentAngle())return this._MaybeReflectAngleForMirrorFlip(this.GetParent()._GetAngleNoReflect()-this._sceneGraphInfo.GetParentStartAngle());return 0;}},{key:"SetX",value:function SetX(x){x=+x;if(this.GetTransformWithParentX()){var sgi=this._sceneGraphInfo;var dx=x-this.GetX();var da=-this._GetParentOffsetAngle();if(da===0)this._x+=dx/sgi.GetParentScaleX();else{this._x+=Math.cos(da)*dx/sgi.GetParentScaleX();if(this.GetTransformWithParentY())this._y+=Math.sin(da)*dx/sgi.GetParentScaleY();}}else this._x=x;}},{key:"OffsetX",value:function OffsetX(x){var transformWithSceneGraph=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;x=+x;if(transformWithSceneGraph)this._x+=x;else if(this.GetTransformWithParentX())this.SetX(this.GetX()+x);else this._x+=x;}},{key:"GetX",value:function GetX(){if(this.GetTransformWithParentX()){var x=this._x;var sgi=this._sceneGraphInfo;var parent=this.GetParent();var da=this._GetParentOffsetAngle();if(da===0)x*=sgi.GetParentScaleX();else{x=x*sgi.GetParentScaleX()*Math.cos(da);if(this.GetTransformWithParentY())x-=this._y*sgi.GetParentScaleY()*Math.sin(da);}return parent.GetX()+x;}else return this._x;}},{key:"SetY",value:function SetY(y){y=+y;if(this.GetTransformWithParentY()){var sgi=this._sceneGraphInfo;var dy=y-this.GetY();var da=-this._GetParentOffsetAngle();if(da===0)this._y+=dy/sgi.GetParentScaleY();else{if(this.GetTransformWithParentX())this._x-=Math.sin(da)*dy/sgi.GetParentScaleX();this._y+=Math.cos(da)*dy/sgi.GetParentScaleY();}}else this._y=y;}},{key:"OffsetY",value:function OffsetY(y){var transformWithSceneGraph=arguments.length>1&&arguments[1]!==undefined?arguments[1]:false;y=+y;if(transformWithSceneGraph)this._y+=y;else if(this.GetTransformWithParentY())this.SetY(this.GetY()+y);else this._y+=y;}},{key:"GetY",value:function GetY(){if(this.GetTransformWithParentY()){var y=this._y;var sgi=this._sceneGraphInfo;var parent=this.GetParent();var da=this._GetParentOffsetAngle();if(da===0)y*=sgi.GetParentScaleY();else{y=y*sgi.GetParentScaleY()*Math.cos(da);if(this.GetTransformWithParentX())y+=this._x*sgi.GetParentScaleX()*Math.sin(da);}return parent.GetY()+y;}else return this._y;}},{key:"SetXY",value:function SetXY(x,y){x=+x;y=+y;if(this.GetTransformWithParentXOrY()){var isTransformX=this.GetTransformWithParentX();var isTransformY=this.GetTransformWithParentY();var sgi=this._sceneGraphInfo;var dx=x-this.GetX();var dy=y-this.GetY();var da=-this._GetParentOffsetAngle();if(da===0){if(isTransformX)this._x+=dx/sgi.GetParentScaleX();else this._x=x;if(isTransformY)this._y+=dy/sgi.GetParentScaleY();else this._y=y;}else{var sinDa=Math.sin(da);var cosDa=Math.cos(da);if(isTransformX){if(isTransformY)this._x+=(cosDa*dx-sinDa*dy)/sgi.GetParentScaleX();else this._x+=cosDa*dx/sgi.GetParentScaleX();}else this._x=x;if(isTransformY){if(isTransformX)this._y+=(sinDa*dx+cosDa*dy)/sgi.GetParentScaleY();else this._y+=cosDa*dy/sgi.GetParentScaleY();}else this._y=y;}}else{this._x=x;this._y=y;}}},{key:"OffsetXY",value:function OffsetXY(x,y){x=+x;y=+y;if(this.GetTransformWithParentXOrY())this.SetXY(this.GetX()+x,this.GetY()+y);else{this._x+=x;this._y+=y;}}},{key:"EqualsXY",value:function EqualsXY(x,y){return this.GetX()===x&&this.GetY()===y;}},{key:"SetZElevation",value:function SetZElevation(z){z=+z;if(this.GetTransformWithParentZElevation())z-=this.GetParent().GetZElevation();if(this._zElevation===z)return;this._zElevation=z;this._UpdateZElevation();var layer=this.GetLayer();if(this._zElevation!==0)layer._SetAnyInstanceZElevated();layer.SetZIndicesChanged(this);}},{key:"_UpdateZElevation",value:function _UpdateZElevation(){this._UpdateRendererStateGroup();if(this.HasChildren()){var _children=this.GetChildren();for(var i=0,len=_children.length;i<len;i++){var child=_children[i];if(child.GetTransformWithParentZElevation())child._UpdateZElevation();}}}},{key:"OffsetZElevation",value:function OffsetZElevation(z){this.SetZElevation(this.GetZElevation()+z);}},{key:"GetZElevation",value:function GetZElevation(){if(this.GetTransformWithParentZElevation())return this.GetParent().GetZElevation()+this._zElevation;else return this._zElevation;}},{key:"GetTotalZElevation",value:function GetTotalZElevation(){return this.GetLayer().GetZElevation()+this.GetZElevation();}},{key:"SetWidth",value:function SetWidth(w){w=+w;if(this.GetTransformWithParentWidth()){var ownWidth=this.GetWidth();if(ownWidth===0)this._w=Number.EPSILON;else this._w*=w/ownWidth;}else this._w=w;this._MarkSinCosAngleChanged();}},{key:"OffsetWidth",value:function OffsetWidth(w,transformWithSceneGraph){w=+w;if(transformWithSceneGraph)this._w+=w;else if(this.GetTransformWithParentWidth())this.SetWidth(this.GetWidth()+w);else this._w+=w;this._MarkSinCosAngleChanged();}},{key:"GetWidth",value:function GetWidth(){if(this.GetTransformWithParentWidth()){var parent=this.GetParent();var pw=parent.GetWidth();var psw=parent._GetSceneGraphInfo()._GetStartWidth();if(psw===Number.EPSILON)return(this._GetSceneGraphInfo()._GetStartWidth()+pw)*this._w;return pw*this._w;}else return this._w;}},{key:"SetHeight",value:function SetHeight(h){h=+h;if(this.GetTransformWithParentHeight()){var ownHeight=this.GetHeight();if(ownHeight===0)this._h=Number.EPSILON;else this._h*=h/ownHeight;}else this._h=h;this._MarkSinCosAngleChanged();}},{key:"OffsetHeight",value:function OffsetHeight(h,transformWithSceneGraph){h=+h;if(transformWithSceneGraph)this._h+=h;else if(this.GetTransformWithParentHeight())this.SetHeight(this.GetHeight()+h);else this._h+=h;this._MarkSinCosAngleChanged();}},{key:"GetHeight",value:function GetHeight(){if(this.GetTransformWithParentHeight()){var parent=this.GetParent();var ph=parent.GetHeight();var psh=parent._GetSceneGraphInfo()._GetStartHeight();if(psh===Number.EPSILON)return(this._GetSceneGraphInfo()._GetStartHeight()+ph)*this._h;return ph*this._h;}else return this._h;}},{key:"SetSize",value:function SetSize(w,h){w=+w;h=+h;if(this.GetTransformWithParentWidth()){var ownWidth=this.GetWidth();if(ownWidth===0)this._w=Number.EPSILON;else this._w*=w/ownWidth;}else this._w=w;if(this.GetTransformWithParentHeight()){var ownHeight=this.GetHeight();if(ownHeight===0)this._h=Number.EPSILON;else this._h*=h/ownHeight;}else this._h=h;this._MarkSinCosAngleChanged();}},{key:"GetDepth",value:function GetDepth(){return this._depth;}},{key:"SetDepth",value:function SetDepth(d){if(d<0)throw new RangeError("invalid depth");this._depth=d;}},{key:"GetSceneGraphScale",value:function GetSceneGraphScale(){if(this.HasParent()){var sgi=this._sceneGraphInfo;return Math.min(sgi.GetParentScaleX(),sgi.GetParentScaleY());}else return 1;}},{key:"IsRotatable",value:function IsRotatable(){return(this._flags&FLAG_IS_ROTATABLE)!==0;}},{key:"SetAngle",value:function SetAngle(a){a=+a;if(!this.IsRotatable())return;if(this.GetTransformWithParentAngle())a-=this.GetParent().GetAngle();a=_C173.clampAngle(a);if(this._a===a)return;this._a=a;this._MarkSinCosAngleChanged();}},{key:"OffsetAngle",value:function OffsetAngle(a){a=+a;if(a===0||!this.IsRotatable())return;this._a=_C173.clampAngle(this._a+a);this._MarkSinCosAngleChanged();}},{key:"_MarkSinCosAngleChanged",value:function _MarkSinCosAngleChanged(){this._flags|=FLAG_SIN_COS_ANGLE_CHANGED;if(this.HasChildren()){var _children2=this.GetChildren();for(var i=0,len=_children2.length;i<len;i++){_children2[i]._MarkSinCosAngleChanged();}}}},{key:"GetAngle",value:function GetAngle(){if(this.GetTransformWithParentAngle()&&this.IsRotatable())return this._MaybeReflectAngleForMirrorFlip(_C173.clampAngle(this.GetParent()._GetAngleNoReflect()+this._a));else return this._a;}},{key:"_GetAngleNoReflect",value:function _GetAngleNoReflect(){if(this.GetTransformWithParentAngle()&&this.IsRotatable())return _C173.clampAngle(this.GetParent()._GetAngleNoReflect()+this._a);else return this._a;}},{key:"_MaybeReflectAngleForMirrorFlip",value:function _MaybeReflectAngleForMirrorFlip(a){if(this.GetTransformWithParentWidth()&&this.GetTopParent().GetWidth()<0)a=_C173.clampAngle(_C173.angleReflect(a,this.GetTopParent().GetAngle()+Math.PI));if(this.GetTransformWithParentHeight()&&this.GetTopParent().GetHeight()<0)a=_C173.angleReflect(a,this.GetTopParent().GetAngle());return a;}},{key:"_MaybeUpdateSinCosAngle",value:function _MaybeUpdateSinCosAngle(){var flags=this._flags;if((flags&FLAG_SIN_COS_ANGLE_CHANGED)===0)return;var a=this.GetAngle();this._sinA=Math.sin(a);this._cosA=Math.cos(a);this._flags=flags&~FLAG_SIN_COS_ANGLE_CHANGED;}},{key:"GetSinAngle",value:function GetSinAngle(){this._MaybeUpdateSinCosAngle();return this._sinA;}},{key:"GetCosAngle",value:function GetCosAngle(){this._MaybeUpdateSinCosAngle();return this._cosA;}},{key:"SetOriginX",value:function SetOriginX(x){this._ox=+x;}},{key:"OffsetOriginX",value:function OffsetOriginX(x){this._ox+=+x;}},{key:"GetOriginX",value:function GetOriginX(){return this._ox;}},{key:"SetOriginY",value:function SetOriginY(y){this._oy=+y;}},{key:"OffsetOriginY",value:function OffsetOriginY(y){this._oy+=+y;}},{key:"GetOriginY",value:function GetOriginY(){return this._oy;}},{key:"_SetColor",value:function _SetColor(c){if(this._color.equals(c))return;if(this._color===DEFAULT_COLOR){this._color=_C173.New(_C173.Color,c);this._colorPremultiplied=_C173.New(_C173.Color,c);this._colorPremultiplied.premultiply();}else if(c.equalsRgba(1,1,1,1)){this._color=DEFAULT_COLOR;this._colorPremultiplied=DEFAULT_COLOR;}else{this._color.set(c);this._colorPremultiplied.set(c);this._colorPremultiplied.premultiply();}this._UpdateRendererStateGroup();}},{key:"SetOpacity",value:function SetOpacity(o){o=_C173.clamp(+o,0,1);if(this.GetTransformWithParentOpacity()){if(this._GetSceneGraphInfo().GetOwnOpacity()===o)return;this._GetSceneGraphInfo().SetOwnOpacity(o);o=this.GetOpacity();}else if(this._color.a===o)return;this._SetColorWithOpacity(o);}},{key:"_SetOpacityOfChildren",value:function _SetOpacityOfChildren(){if(!this.HasChildren())return;var children=this.GetChildren();for(var i=0,len=children.length;i<len;i++){var child=children[i];child._SetColorWithOpacity(child.GetOpacity());}}},{key:"_SetColorWithOpacity",value:function _SetColorWithOpacity(o){_tempColor6.copyRgb(this._color);_tempColor6.a=o;this._SetColor(_tempColor6);this._SetOpacityOfChildren();}},{key:"OffsetOpacity",value:function OffsetOpacity(o){if(this.GetTransformWithParentOpacity())this.SetOpacity(this._GetSceneGraphInfo().GetOwnOpacity()+o);else this.SetOpacity(this.GetOpacity()+o);}},{key:"GetOpacity",value:function GetOpacity(){if(this.GetTransformWithParentOpacity())return this.GetParent().GetOpacity()*this._GetSceneGraphInfo().GetOwnOpacity();else return this._color.a;}},{key:"SetUnpremultipliedColor",value:function SetUnpremultipliedColor(c){if(this._color.equalsIgnoringAlpha(c))return;_tempColor6.copyRgb(c);_tempColor6.a=this.GetOpacity();this._SetColor(_tempColor6);}},{key:"SetUnpremultipliedColorRGB",value:function SetUnpremultipliedColorRGB(r,g,b){_tempColor6.setRgb(r,g,b);this.SetUnpremultipliedColor(_tempColor6);}},{key:"OffsetUnpremultipliedColorRGB",value:function OffsetUnpremultipliedColorRGB(r,g,b){if(r===0&&g===0&&b===0)return;_tempColor6.copyRgb(this._color);_tempColor6.r+=r;_tempColor6.g+=g;_tempColor6.b+=b;this.SetUnpremultipliedColor(_tempColor6);}},{key:"GetUnpremultipliedColor",value:function GetUnpremultipliedColor(){return this._color;}},{key:"GetPremultipliedColor",value:function GetPremultipliedColor(){return this._colorPremultiplied;}},{key:"GetDestroyWithParent",value:function GetDestroyWithParent(){return(this._flags&FLAG_DESTROY_WITH_PARENT)!==0;}},{key:"SetDestroyWithParent",value:function SetDestroyWithParent(d){this._SetFlag(FLAG_DESTROY_WITH_PARENT,d);}},{key:"GetTransformWithParentX",value:function GetTransformWithParentX(){return(this._flags&FLAG_TRANSFORM_WITH_PARENT_X)!==0;}},{key:"SetTransformWithParentX",value:function SetTransformWithParentX(tpx){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_X,tpx);}},{key:"GetTransformWithParentY",value:function GetTransformWithParentY(){return(this._flags&FLAG_TRANSFORM_WITH_PARENT_Y)!==0;}},{key:"GetTransformWithParentXOrY",value:function GetTransformWithParentXOrY(){return(this._flags&(FLAG_TRANSFORM_WITH_PARENT_X|FLAG_TRANSFORM_WITH_PARENT_Y))!==0;}},{key:"SetTransformWithParentY",value:function SetTransformWithParentY(tpx){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_Y,tpx);}},{key:"GetTransformWithParentWidth",value:function GetTransformWithParentWidth(){return(this._flags&FLAG_TRANSFORM_WITH_PARENT_W)!==0;}},{key:"SetTransformWithParentWidth",value:function SetTransformWithParentWidth(tpw){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_W,tpw);}},{key:"GetTransformWithParentHeight",value:function GetTransformWithParentHeight(){return(this._flags&FLAG_TRANSFORM_WITH_PARENT_H)!==0;}},{key:"SetTransformWithParentHeight",value:function SetTransformWithParentHeight(tph){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_H,tph);}},{key:"GetTransformWithParentAngle",value:function GetTransformWithParentAngle(){return(this._flags&FLAG_TRANSFORM_WITH_PARENT_A)!==0;}},{key:"SetTransformWithParentAngle",value:function SetTransformWithParentAngle(tpa){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_A,tpa);}},{key:"GetTransformWithParentZElevation",value:function GetTransformWithParentZElevation(){return(this._flags&FLAG_TRANSFORM_WITH_PARENT_Z_ELEVATION)!==0;}},{key:"SetTransformWithParentZElevation",value:function SetTransformWithParentZElevation(tpz){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_Z_ELEVATION,tpz);}},{key:"GetTransformWithParentOpacity",value:function GetTransformWithParentOpacity(){return(this._flags&FLAG_TRANSFORM_WITH_PARENT_OPACITY)!==0;}},{key:"SetTransformWithParentOpacity",value:function SetTransformWithParentOpacity(tpo){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_OPACITY,tpo);}},{key:"GetTransformWithParentVisibility",value:function GetTransformWithParentVisibility(){return(this._flags&FLAG_TRANSFORM_WITH_PARENT_VISIBILITY)!==0;}},{key:"SetTransformWithParentVisibility",value:function SetTransformWithParentVisibility(tpv){this._SetFlag(FLAG_TRANSFORM_WITH_PARENT_VISIBILITY,tpv);}},{key:"_ClearAllSceneGraphFlags",value:function _ClearAllSceneGraphFlags(){this._flags&=~MASK_ALL_SCENE_GRAPH_FLAGS;}},{key:"AddChild",value:function AddChild(child,opts){if(child===this)return false;if(child.HasParent())return false;if(this._HasChildRecursive(child))return false;if(this._HasAnyParent(child))return false;var absX=child.GetX();var absY=child.GetY();var absW=child.GetWidth();var absH=child.GetHeight();var absA=child.GetAngle();var absZElevation=child.GetZElevation();var absOpacity=child.GetOpacity();child._SetParent(this);child.SetTransformWithParentX(opts.transformX);child.SetTransformWithParentY(opts.transformY);child.SetTransformWithParentWidth(opts.transformWidth);child.SetTransformWithParentHeight(opts.transformHeight);child.SetTransformWithParentAngle(opts.transformAngle);child.SetTransformWithParentZElevation(opts.transformZElevation);child.SetTransformWithParentOpacity(opts.transformOpacity);child.SetTransformWithParentVisibility(opts.transformVisibility);child.SetDestroyWithParent(opts.destroyWithParent);if(opts.transformX){child._x=absX-this.GetX();if(opts.transformWidth)child._x/=this.GetWidth()/this._sceneGraphInfo._GetStartWidth();}if(opts.transformY){child._y=absY-this.GetY();if(opts.transformHeight)child._y/=this.GetHeight()/this._sceneGraphInfo._GetStartHeight();}if(opts.transformWidth){var pw=this.GetWidth();if(pw===0||pw===Number.EPSILON){child._w=1;child._sceneGraphInfo.SetStartScaleX(1);}else{child._w=absW/this.GetWidth();child._sceneGraphInfo.SetStartScaleX(child._w);}}if(opts.transformHeight){var ph=this.GetHeight();if(ph===0||ph===Number.EPSILON){child._h=1;child._sceneGraphInfo.SetStartScaleY(1);}else{child._h=absH/this.GetHeight();child._sceneGraphInfo.SetStartScaleY(child._h);}}if(opts.transformAngle)child._a=absA-this.GetAngle();if(opts.transformZElevation)child._zElevation=absZElevation-this.GetZElevation();if(opts.transformOpacity)child._sceneGraphInfo.SetOwnOpacity(absOpacity);if(opts.transformVisibility)child.SetVisible(this.IsVisible());this._AddChildToSceneGraphInfo(child);this.SetBboxChanged();this._SetOpacityOfChildren();return true;}},{key:"RemoveChild",value:function RemoveChild(child){if(child.GetParent()!==this)return;var absX=child.GetX();var absY=child.GetY();var absW=child.GetWidth();var absH=child.GetHeight();var absA=child.GetAngle();var absZElevation=child.GetZElevation();var absOpacity=child.GetOpacity();child._SetParent(null);child._ClearAllSceneGraphFlags();child.SetXY(absX,absY);child.SetSize(absW,absH);child.SetAngle(absA);child.SetZElevation(absZElevation);child.SetOpacity(absOpacity);this._RemoveChildFromSceneGraphInfo(child);this.SetBboxChanged();return;}},{key:"GetTmpHierarchyPosition",value:function GetTmpHierarchyPosition(){return this._tmpHierarchyPosition;}},{key:"_ResetAllSceneGraphState",value:function _ResetAllSceneGraphState(){this._BuildTmpSceneGraphData();var children=_toConsumableArray(this.children());var _iteratorNormalCompletion461=true;var _didIteratorError461=false;var _iteratorError461=undefined;try{for(var _iterator461=children[Symbol.iterator](),_step461;!(_iteratorNormalCompletion461=(_step461=_iterator461.next()).done);_iteratorNormalCompletion461=true){var _c19=_step461.value;this.RemoveChild(_c19);}}catch(err){_didIteratorError461=true;_iteratorError461=err;}finally{try{if(!_iteratorNormalCompletion461&&_iterator461["return"]!=null){_iterator461["return"]();}}finally{if(_didIteratorError461){throw _iteratorError461;}}}var parent=this.GetParent();if(parent)parent.RemoveChild(this);this._ClearAllSceneGraphFlags();}},{key:"_BuildTmpSceneGraphData",value:function _BuildTmpSceneGraphData(){this._SetTmpHierarchyPosition();if(!this._tmpSceneGraphChildren){var _children3=_toConsumableArray(this.children());if(_children3.length){this._tmpSceneGraphChildren=[];this._tmpSceneGraphChildrenIndexes=new WeakMap();}var _index4=0;var _iteratorNormalCompletion462=true;var _didIteratorError462=false;var _iteratorError462=undefined;try{for(var _iterator462=_children3[Symbol.iterator](),_step462;!(_iteratorNormalCompletion462=(_step462=_iterator462.next()).done);_iteratorNormalCompletion462=true){var _c20=_step462.value;var inst=_c20.GetInstance();this._tmpSceneGraphChildren.push(inst);this._tmpSceneGraphChildrenIndexes.set(inst,_index4);_index4++;}}catch(err){_didIteratorError462=true;_iteratorError462=err;}finally{try{if(!_iteratorNormalCompletion462&&_iterator462["return"]!=null){_iterator462["return"]();}}finally{if(_didIteratorError462){throw _iteratorError462;}}}}var parent=this.GetParent();if(parent)parent._BuildTmpSceneGraphData();}},{key:"_SetTmpHierarchyPosition",value:function _SetTmpHierarchyPosition(){if(this._tmpHierarchyPosition!==-1)return;var parents=_toConsumableArray(this.parents());this._tmpHierarchyPosition=parents.length;var _iteratorNormalCompletion463=true;var _didIteratorError463=false;var _iteratorError463=undefined;try{for(var _iterator463=parents[Symbol.iterator](),_step463;!(_iteratorNormalCompletion463=(_step463=_iterator463.next()).done);_iteratorNormalCompletion463=true){var p=_step463.value;p._SetTmpHierarchyPosition();}}catch(err){_didIteratorError463=true;_iteratorError463=err;}finally{try{if(!_iteratorNormalCompletion463&&_iterator463["return"]!=null){_iterator463["return"]();}}finally{if(_didIteratorError463){throw _iteratorError463;}}}var children=_toConsumableArray(this.children());var _iteratorNormalCompletion464=true;var _didIteratorError464=false;var _iteratorError464=undefined;try{for(var _iterator464=children[Symbol.iterator](),_step464;!(_iteratorNormalCompletion464=(_step464=_iterator464.next()).done);_iteratorNormalCompletion464=true){var _c21=_step464.value;_c21._SetTmpHierarchyPosition();}}catch(err){_didIteratorError464=true;_iteratorError464=err;}finally{try{if(!_iteratorNormalCompletion464&&_iterator464["return"]!=null){_iterator464["return"]();}}finally{if(_didIteratorError464){throw _iteratorError464;}}}}},{key:"_ReleaseTmpSceneGraphInfo",value:function _ReleaseTmpSceneGraphInfo(){if(this._tmpSceneGraphChildren)this._tmpSceneGraphChildren.length=0;this._tmpSceneGraphChildren=null;this._tmpSceneGraphChildrenIndexes=null;var parent=this.GetParent();if(parent)parent._ReleaseTmpSceneGraphInfo();this._tmpHierarchyPosition=-1;}},{key:"HasParent",value:function HasParent(){return this.GetParent()!==null;}},{key:"GetParent",value:function GetParent(){var sgi=this._sceneGraphInfo;return sgi!==null?sgi.GetParent():null;}},{key:"GetTopParent",value:function GetTopParent(){var p=this;while(p.HasParent()){p=p.GetParent();}return p;}},{key:"parents",value:/*#__PURE__*/regeneratorRuntime.mark(function parents(){var parent;return regeneratorRuntime.wrap(function parents$(_context167){while(1){switch(_context167.prev=_context167.next){case 0:parent=this.GetParent();case 1:if(!parent){_context167.next=7;break;}_context167.next=4;return parent;case 4:parent=parent.GetParent();_context167.next=1;break;case 7:case"end":return _context167.stop();}}},parents,this);})},{key:"HasChild",value:function HasChild(child){return this.GetChildren().includes(child);}},{key:"HasChildren",value:function HasChildren(){var sgi=this._sceneGraphInfo;return sgi!==null?sgi.HasChildren():false;}},{key:"GetChildren",value:function GetChildren(){var sgi=this._sceneGraphInfo;return sgi!==null?sgi.GetChildren():_EMPTY_ARRAY2;}},{key:"children",value:function children(){return this.GetChildren();}},{key:"allChildren",value:/*#__PURE__*/regeneratorRuntime.mark(function allChildren(){var _iteratorNormalCompletion465,_didIteratorError465,_iteratorError465,_iterator465,_step465,child;return regeneratorRuntime.wrap(function allChildren$(_context168){while(1){switch(_context168.prev=_context168.next){case 0:_iteratorNormalCompletion465=true;_didIteratorError465=false;_iteratorError465=undefined;_context168.prev=3;_iterator465=this.children()[Symbol.iterator]();case 5:if(_iteratorNormalCompletion465=(_step465=_iterator465.next()).done){_context168.next=13;break;}child=_step465.value;_context168.next=9;return child;case 9:return _context168.delegateYield(child.allChildren(),"t0",10);case 10:_iteratorNormalCompletion465=true;_context168.next=5;break;case 13:_context168.next=19;break;case 15:_context168.prev=15;_context168.t1=_context168["catch"](3);_didIteratorError465=true;_iteratorError465=_context168.t1;case 19:_context168.prev=19;_context168.prev=20;if(!_iteratorNormalCompletion465&&_iterator465["return"]!=null){_iterator465["return"]();}case 22:_context168.prev=22;if(!_didIteratorError465){_context168.next=25;break;}throw _iteratorError465;case 25:return _context168.finish(22);case 26:return _context168.finish(19);case 27:case"end":return _context168.stop();}}},allChildren,this,[[3,15,19,27],[20,,22,26]]);})},{key:"GetChildCount",value:function GetChildCount(){return this.GetChildren().length;}},{key:"GetAllChildCount",value:function GetAllChildCount(){return _toConsumableArray(this.allChildren()).length;}},{key:"GetChildAt",value:function GetChildAt(index){var children=this.GetChildren();index=Math.floor(+index);if(index<0||index>=children.length)return null;return children[index];}},{key:"_CreateSceneGraphInfo",value:function _CreateSceneGraphInfo(parent){if(!this._sceneGraphInfo)this._sceneGraphInfo=_C173.New(_C173.SceneGraphInfo,this);if(parent)this._sceneGraphInfo.SetParent(parent);}},{key:"_GetSceneGraphInfo",value:function _GetSceneGraphInfo(){return this._sceneGraphInfo;}},{key:"_ReleaseSceneGraphInfo",value:function _ReleaseSceneGraphInfo(){if(!this._sceneGraphInfo)return;this._sceneGraphInfo.Release();this._sceneGraphInfo=null;}},{key:"_SetParent",value:function _SetParent(parent){if(parent){parent._CreateSceneGraphInfo(null);this._CreateSceneGraphInfo(parent);}else{if(this._sceneGraphInfo)this._sceneGraphInfo.SetParent(null);if(!this.HasChildren())this._ReleaseSceneGraphInfo();}}},{key:"_HasAnyParent",value:function _HasAnyParent(child){if(!this.HasParent())return false;var parent=this.GetParent();if(parent===child)return true;return parent._HasAnyParent(child);}},{key:"_HasChildRecursive",value:function _HasChildRecursive(child){if(this.HasChild(child))return true;var _iteratorNormalCompletion466=true;var _didIteratorError466=false;var _iteratorError466=undefined;try{for(var _iterator466=this.GetChildren()[Symbol.iterator](),_step466;!(_iteratorNormalCompletion466=(_step466=_iterator466.next()).done);_iteratorNormalCompletion466=true){var _c22=_step466.value;if(_c22._HasChildRecursive(child))return true;}}catch(err){_didIteratorError466=true;_iteratorError466=err;}finally{try{if(!_iteratorNormalCompletion466&&_iterator466["return"]!=null){_iterator466["return"]();}}finally{if(_didIteratorError466){throw _iteratorError466;}}}return false;}},{key:"_AddChildToSceneGraphInfo",value:function _AddChildToSceneGraphInfo(child){this._sceneGraphInfo.GetChildren().push(child);}},{key:"_RemoveChildFromSceneGraphInfo",value:function _RemoveChildFromSceneGraphInfo(child){var children=this._sceneGraphInfo.GetChildren();var index=children.indexOf(child);if(index!==-1)children.splice(index,1);if(children.length===0&&!this.HasParent())this._ReleaseSceneGraphInfo();if(!child.HasChildren())child._ReleaseSceneGraphInfo();}},{key:"GetSceneGraphChildrenExportData",value:function GetSceneGraphChildrenExportData(){var data=sceneGraphExportDataMap.get(this);return data?data.childrenData:null;}},{key:"GetSceneGraphZIndexExportData",value:function GetSceneGraphZIndexExportData(){var data=sceneGraphExportDataMap.get(this);return data?data.zIndexData:NaN;}},{key:"GetSceneGraphZIndex",value:function GetSceneGraphZIndex(){var sceneGraphZIndex=sceneGraphZIndexMap.get(this);return _C173.IsFiniteNumber(sceneGraphZIndex)?sceneGraphZIndex:NaN;}},{key:"SetSceneGraphZIndex",value:function SetSceneGraphZIndex(z){sceneGraphZIndexMap.set(this,z);}},{key:"SetUsePointsShaderProgram",value:function SetUsePointsShaderProgram(){this._SetFlag(FLAG_USE_POINTS_SHADER_PROGRAM,true);this._UpdateRendererStateGroup();}},{key:"_UpdateRendererStateGroup",value:function _UpdateRendererStateGroup(){if(!enableUpdateRendererStateGroup)return;var renderer=this._runtime.GetRenderer();if(this._stateGroup)renderer.ReleaseStateGroup(this._stateGroup);var shaderProgram;if((this._flags&FLAG_USE_POINTS_SHADER_PROGRAM)!==0)shaderProgram=renderer.GetPointsRenderingProgram()||"<point>";else shaderProgram=renderer.GetTextureFillShaderProgram()||"<default>";this._stateGroup=renderer.AcquireStateGroup(shaderProgram,this.GetBlendMode(),this._colorPremultiplied,this.GetZElevation());}},{key:"GetRendererStateGroup",value:function GetRendererStateGroup(){return this._stateGroup;}},{key:"HasDefaultColor",value:function HasDefaultColor(){return this._color===DEFAULT_COLOR;}},{key:"SetBlendMode",value:function SetBlendMode(bm){bm=bm|0;if(bm<0||bm>31)throw new RangeError("invalid blend mode");if(this.GetBlendMode()===bm)return;this._flags=this._flags&~FLAG_BLEND_MODE_MASK|bm<<FLAG_BLEND_MODE_BIT_OFFSET;this._UpdateRendererStateGroup();}},{key:"GetBlendMode",value:function GetBlendMode(){return(this._flags&FLAG_BLEND_MODE_MASK)>>FLAG_BLEND_MODE_BIT_OFFSET;}},{key:"_SetLayer",value:function _SetLayer(layer,updateRenderCell){var doUpdateRenderCell=updateRenderCell&&this._layer!==layer;if(doUpdateRenderCell)this._RemoveFromRenderCells();this._layer=layer;if(doUpdateRenderCell)this._UpdateRenderCell();if(this.GetZElevation()!==0)this._layer._SetAnyInstanceZElevated();}},{key:"GetLayer",value:function GetLayer(){return this._layer;}},{key:"GetLayout",value:function GetLayout(){return this.GetLayer().GetLayout();}},{key:"_SetZIndex",value:function _SetZIndex(z){this._zIndex=z|0;}},{key:"GetZIndex",value:function GetZIndex(){this._layer._UpdateZIndices();return this._zIndex;}},{key:"_SetHTMLZIndex",value:function _SetHTMLZIndex(z){this._htmlZIndex=z|0;}},{key:"GetHTMLZIndex",value:function GetHTMLZIndex(){this._layer._UpdateHTMLZIndices();return this._htmlZIndex;}},{key:"_GetLastCachedZIndex",value:function _GetLastCachedZIndex(){return this._zIndex;}},{key:"_SetFlag",value:function _SetFlag(bit,enable){if(enable)this._flags|=bit;else this._flags&=~bit;}},{key:"IsVisible",value:function IsVisible(){return(this._flags&FLAG_IS_VISIBLE)!==0;}},{key:"SetVisible",value:function SetVisible(v){this._SetFlag(FLAG_IS_VISIBLE,v);if(!this.HasChildren())return;var _iteratorNormalCompletion467=true;var _didIteratorError467=false;var _iteratorError467=undefined;try{for(var _iterator467=this.GetChildren()[Symbol.iterator](),_step467;!(_iteratorNormalCompletion467=(_step467=_iterator467.next()).done);_iteratorNormalCompletion467=true){var child=_step467.value;if(child.GetTransformWithParentVisibility())child.SetVisible(v);}}catch(err){_didIteratorError467=true;_iteratorError467=err;}finally{try{if(!_iteratorNormalCompletion467&&_iterator467["return"]!=null){_iterator467["return"]();}}finally{if(_didIteratorError467){throw _iteratorError467;}}}}},{key:"IsCollisionEnabled",value:function IsCollisionEnabled(){return(this._flags&FLAG_COLLISION_ENABLED)!==0;}},{key:"SetCollisionEnabled",value:function SetCollisionEnabled(e){e=!!e;if(this.IsCollisionEnabled()===e)return;this._SetFlag(FLAG_COLLISION_ENABLED,e);if(e)this.SetBboxChanged();else this._RemoveFromCollisionCells();}},{key:"SetSolidCollisionFilter",value:function SetSolidCollisionFilter(isInclusive,tags){this._SetFlag(FLAG_SOLID_FILTER_INCLUSIVE,isInclusive);if(this._solidFilterTags)this._solidFilterTags.clear();if(!tags.trim()){this._solidFilterTags=null;return;}if(!this._solidFilterTags)this._solidFilterTags=new Set();var _iteratorNormalCompletion468=true;var _didIteratorError468=false;var _iteratorError468=undefined;try{for(var _iterator468=tags.split(" ")[Symbol.iterator](),_step468;!(_iteratorNormalCompletion468=(_step468=_iterator468.next()).done);_iteratorNormalCompletion468=true){var tag=_step468.value;if(tag)this._solidFilterTags.add(tag.toLowerCase());}}catch(err){_didIteratorError468=true;_iteratorError468=err;}finally{try{if(!_iteratorNormalCompletion468&&_iterator468["return"]!=null){_iterator468["return"]();}}finally{if(_didIteratorError468){throw _iteratorError468;}}}}},{key:"IsSolidCollisionAllowed",value:function IsSolidCollisionAllowed(solidTagSet){var isInclusive=(this._flags&FLAG_SOLID_FILTER_INCLUSIVE)!==0;var filterTags=this._solidFilterTags;if(!solidTagSet||!filterTags)return!isInclusive;var _iteratorNormalCompletion469=true;var _didIteratorError469=false;var _iteratorError469=undefined;try{for(var _iterator469=filterTags[Symbol.iterator](),_step469;!(_iteratorNormalCompletion469=(_step469=_iterator469.next()).done);_iteratorNormalCompletion469=true){var tag=_step469.value;if(solidTagSet.has(tag))return isInclusive;}}catch(err){_didIteratorError469=true;_iteratorError469=err;}finally{try{if(!_iteratorNormalCompletion469&&_iterator469["return"]!=null){_iterator469["return"]();}}finally{if(_didIteratorError469){throw _iteratorError469;}}}return!isInclusive;}},{key:"SetBboxChanged",value:function SetBboxChanged(){this._flags|=FLAG_BBOX_CHANGED|FLAG_COLLISION_CELL_CHANGED|FLAG_MESH_CHANGED;this._objectClass._SetAnyCollisionCellChanged(true);this._runtime.UpdateRender();if(this._layer.UsesRenderCells()){this.CalculateBbox(this._boundingBox,this._boundingQuad,true);this._flags&=~FLAG_BBOX_CHANGED;this._UpdateRenderCell();}if((this._flags&FLAG_ENABLE_BBOX_CHANGED_EVENT)!==0)this._inst.Dispatcher().dispatchEvent(bboxChangeEvent);if(this._sceneGraphInfo!==null){var _children4=this._sceneGraphInfo.GetChildren();for(var i=0,len=_children4.length;i<len;++i){_children4[i].SetBboxChanged();}}}},{key:"CalculateBbox",value:function CalculateBbox(bbox,bquad,includeMesh){var x=this.GetX();var y=this.GetY();var w=this.GetWidth();var h=this.GetHeight();var a=this.GetAngle();bbox.setWH(x-this._ox*w,y-this._oy*h,w,h);if(includeMesh&&this.HasMesh())this._ExpandBboxForMesh(bbox);if(a===0)bquad.setFromRect(bbox);else{bbox.offset(-x,-y);bquad.setFromRotatedRectPrecalc(bbox,this.GetSinAngle(),this.GetCosAngle());bquad.offset(x,y);bquad.getBoundingBox(bbox);}bbox.normalize();}},{key:"_UpdateBbox",value:function _UpdateBbox(){var flags=this._flags;if((flags&FLAG_BBOX_CHANGED)!==0){this.CalculateBbox(this._boundingBox,this._boundingQuad,true);this._flags=flags&~FLAG_BBOX_CHANGED;}}},{key:"GetBoundingBox",value:function GetBoundingBox(){this._UpdateBbox();return this._boundingBox;}},{key:"GetBoundingQuad",value:function GetBoundingQuad(){this._UpdateBbox();return this._boundingQuad;}},{key:"PixelRoundQuad",value:function PixelRoundQuad(quad){var x=this.GetX();var y=this.GetY();var ox=Math.round(x)-x;var oy=Math.round(y)-y;if(ox===0&&oy===0)return quad;else{_tempQuad3.copy(quad);_tempQuad3.offset(ox,oy);return _tempQuad3;}}},{key:"OverwriteBoundingBox",value:function OverwriteBoundingBox(box){this._boundingBox.copy(box);this._boundingQuad.setFromRect(this._boundingBox);this._flags&=~FLAG_BBOX_CHANGED;this._UpdateCollisionCell();this._UpdateRenderCell();}},{key:"SetBboxChangeEventEnabled",value:function SetBboxChangeEventEnabled(e){this._SetFlag(FLAG_ENABLE_BBOX_CHANGED_EVENT,e);}},{key:"IsBboxChangeEventEnabled",value:function IsBboxChangeEventEnabled(){return(this._flags&FLAG_ENABLE_BBOX_CHANGED_EVENT)!==0;}},{key:"IsInViewport",value:function IsInViewport(viewport,hasVanishingPointOutsideViewport,isOrthographic){if(hasVanishingPointOutsideViewport&&this.GetDepth()!==0)return this.IsInViewport3D(this.GetLayer()._GetViewFrustum());else return this.GetZElevation()===0||isOrthographic?viewport.intersectsRect(this.GetBoundingBox()):this._IsInViewport_ZElevated();}},{key:"_IsInViewport_ZElevated",value:function _IsInViewport_ZElevated(){var layer=this.GetLayer();var totalZElevation=this.GetTotalZElevation();if(totalZElevation>=layer.GetCameraZ())return false;layer.GetViewportForZ(totalZElevation,_tempRect6);return _tempRect6.intersectsRect(this.GetBoundingBox());}},{key:"IsInViewport3D",value:function IsInViewport3D(viewFrustum){var bbox=this.GetBoundingBox();var minX=bbox.getLeft();var maxX=bbox.getRight();var minY=bbox.getTop();var maxY=bbox.getBottom();var minZ=this.GetTotalZElevation();var maxZ=minZ+this.GetDepth();return viewFrustum.ContainsAABB(minX,minY,minZ,maxX,maxY,maxZ);}},{key:"IsInViewport2",value:function IsInViewport2(){var layer=this.GetLayer();if(layer.Has3DCamera())return this.IsInViewport3D(layer._GetViewFrustum());else{var layout=layer.GetLayout();return this.IsInViewport(layer.GetViewport(),layout.HasVanishingPointOutsideViewport(),layout.IsOrthographicProjection());}}},{key:"_SetDrawBackFaceOnly",value:function _SetDrawBackFaceOnly(e){this._SetFlag(FLAG_DRAW_BACK_FACE_ONLY,e);}},{key:"_SetDrawNonBackFacesOnly",value:function _SetDrawNonBackFacesOnly(e){this._SetFlag(FLAG_DRAW_NON_BACK_FACES_ONLY,e);}},{key:"IsDrawBackFaceOnly",value:function IsDrawBackFaceOnly(){return(this._flags&FLAG_DRAW_BACK_FACE_ONLY)!==0;}},{key:"IsDrawNonBackFacesOnly",value:function IsDrawNonBackFacesOnly(){return(this._flags&FLAG_DRAW_NON_BACK_FACES_ONLY)!==0;}},{key:"SetSourceCollisionPoly",value:function SetSourceCollisionPoly(poly){this._sourceCollisionPoly=poly;this._DiscardTransformedCollisionPoly();if(this.HasMesh())this._meshInfo.meshPoly=null;}},{key:"GetSourceCollisionPoly",value:function GetSourceCollisionPoly(){return this._sourceCollisionPoly;}},{key:"HasOwnCollisionPoly",value:function HasOwnCollisionPoly(){return this._sourceCollisionPoly!==null||this.HasMesh();}},{key:"GetTransformedCollisionPoly",value:function GetTransformedCollisionPoly(){return this._GetCustomTransformedCollisionPolyPrecalc(this.GetWidth(),this.GetHeight(),this.GetAngle(),this.GetSinAngle(),this.GetCosAngle());}},{key:"GetCustomTransformedCollisionPoly",value:function GetCustomTransformedCollisionPoly(w,h,a){var sina=0;var cosa=1;if(a!==0){sina=Math.sin(a);cosa=Math.cos(a);}return this._GetCustomTransformedCollisionPolyPrecalc(w,h,a,sina,cosa);}},{key:"_GetCustomTransformedCollisionPolyPrecalc",value:function _GetCustomTransformedCollisionPolyPrecalc(w,h,a,sinA,cosA){var tpi=this._transformedPolyInfo;if(tpi===null){tpi={poly:_C173.New(_C173.CollisionPoly),width:NaN,height:NaN,angle:NaN};this._transformedPolyInfo=tpi;}var transformedPoly=tpi.poly;if(tpi.width===w&&tpi.height===h&&tpi.angle===a)return transformedPoly;var sourcePoly=this._sourceCollisionPoly;if(this.HasMesh()){var ox=this.GetOriginX();var oy=this.GetOriginY();var sourceMesh=this.GetSourceMesh();var meshPoly=this._meshInfo.meshPoly;if(!meshPoly){if(sourcePoly){tempCollisionPoly.copy(sourcePoly);tempCollisionPoly.offset(ox,oy);}else tempCollisionPoly.setDefaultPoints();meshPoly=sourceMesh.InsertPolyMeshVertices(tempCollisionPoly);this._meshInfo.meshPoly=meshPoly;}sourceMesh.TransformCollisionPoly(meshPoly,transformedPoly);transformedPoly.offset(-ox,-oy);transformedPoly.transformPrecalc(w,h,sinA,cosA);}else if(sourcePoly){transformedPoly.copy(sourcePoly);transformedPoly.transformPrecalc(w,h,sinA,cosA);}else transformedPoly.setFromQuad(this.GetBoundingQuad(),-this.GetX(),-this.GetY());tpi.width=w;tpi.height=h;tpi.angle=a;return transformedPoly;}},{key:"_DiscardTransformedCollisionPoly",value:function _DiscardTransformedCollisionPoly(){this.SetPhysicsBodyChanged(true);var tpi=this._transformedPolyInfo;if(tpi===null)return;tpi.width=NaN;}},{key:"CreateMesh",value:function CreateMesh(hsize,vsize){hsize=Math.floor(hsize);vsize=Math.floor(vsize);if(!this.GetInstance().GetPlugin().SupportsMesh())throw new Error("object does not support mesh");this.ReleaseMesh();this._meshInfo={sourceMesh:_C173.New(_C173.Gfx.Mesh,hsize,vsize),transformedMesh:_C173.New(_C173.Gfx.Mesh,hsize,vsize),meshPoly:null};}},{key:"HasMesh",value:function HasMesh(){return this._meshInfo!==null;}},{key:"GetSourceMesh",value:function GetSourceMesh(){if(!this.HasMesh())throw new Error("no mesh");return this._meshInfo.sourceMesh;}},{key:"GetTransformedMesh",value:function GetTransformedMesh(){if(!this.HasMesh())throw new Error("no mesh");return this._meshInfo.transformedMesh;}},{key:"SetMeshChanged",value:function SetMeshChanged(e){this._SetFlag(FLAG_MESH_CHANGED,e);}},{key:"IsMeshChanged",value:function IsMeshChanged(){return(this._flags&FLAG_MESH_CHANGED)!==0;}},{key:"SetPhysicsBodyChanged",value:function SetPhysicsBodyChanged(e){this._SetFlag(FLAG_PHYSICS_BODY_CHANGED,e);}},{key:"IsPhysicsBodyChanged",value:function IsPhysicsBodyChanged(){return(this._flags&FLAG_PHYSICS_BODY_CHANGED)!==0;}},{key:"_ExpandBboxForMesh",value:function _ExpandBboxForMesh(bbox){var sourceMesh=this._meshInfo.sourceMesh;var minX=Math.min(sourceMesh.GetMinX(),0);var minY=Math.min(sourceMesh.GetMinY(),0);var maxX=Math.max(sourceMesh.GetMaxX(),1);var maxY=Math.max(sourceMesh.GetMaxY(),1);var w=bbox.width();var h=bbox.height();bbox.offsetLeft(minX*w);bbox.offsetTop(minY*h);bbox.offsetRight((maxX-1)*w);bbox.offsetBottom((maxY-1)*h);this._depth=sourceMesh.GetMaxZ();}},{key:"ReleaseMesh",value:function ReleaseMesh(){if(!this._meshInfo)return;this._meshInfo.sourceMesh.Release();this._meshInfo.transformedMesh.Release();this._meshInfo=null;this._DiscardTransformedCollisionPoly();}},{key:"SetMeshPoint",value:function SetMeshPoint(col,row,opts){col=Math.floor(col);row=Math.floor(row);var mode=opts.mode||"absolute";if(!VALID_SET_MESH_POINT_MODES.has(mode))throw new Error("invalid mode");var isRelative=mode==="relative";var posx=opts.x;var posy=opts.y;var zElevation=opts.zElevation;var texu=typeof opts.u==="number"?opts.u:isRelative?0:-1;var texv=typeof opts.v==="number"?opts.v:isRelative?0:-1;if(!this.HasMesh())return false;var sourceMesh=this.GetSourceMesh();var p=sourceMesh.GetMeshPointAt(col,row);if(p===null)return false;var ret=false;if(typeof zElevation==="number"&&p.GetZElevation()!==zElevation){p.SetZElevation(zElevation);ret=true;}if(isRelative){posx+=col/(sourceMesh.GetHSize()-1);posy+=row/(sourceMesh.GetVSize()-1);}if(texu===-1&&!isRelative)texu=p.GetU();else{if(isRelative)texu+=col/(sourceMesh.GetHSize()-1);texu=_C173.clamp(texu,0,1);}if(texv===-1&&!isRelative)texv=p.GetV();else{if(isRelative)texv+=row/(sourceMesh.GetVSize()-1);texv=_C173.clamp(texv,0,1);}if(p.GetX()===posx&&p.GetY()===posy&&p.GetU()===texu&&p.GetV()===texv)return ret;p.SetX(posx);p.SetY(posy);p.SetU(texu);p.SetV(texv);this._DiscardTransformedCollisionPoly();return true;}},{key:"HasTilemap",value:function HasTilemap(){return this._inst.HasTilemap();}},{key:"ContainsPoint",value:function ContainsPoint(x,y){if(!this.GetBoundingBox().containsPoint(x,y))return false;if(!this.GetBoundingQuad().containsPoint(x,y))return false;if(this.HasTilemap())return this._inst.GetSdkInstance().TestPointOverlapTile(x,y);if(!this.HasOwnCollisionPoly())return true;return this.GetTransformedCollisionPoly().containsPoint(x-this.GetX(),y-this.GetY());}},{key:"_IsCollisionCellChanged",value:function _IsCollisionCellChanged(){return(this._flags&FLAG_COLLISION_CELL_CHANGED)!==0;}},{key:"_UpdateCollisionCell",value:function _UpdateCollisionCell(){if(!this._IsCollisionCellChanged()||!this.IsCollisionEnabled()||(this._flags&_FLAG_DESTROYED)!==0)return;var bbox=this.GetBoundingBox();var grid=this._objectClass._GetCollisionCellGrid();var collisionCells=this._collisionCells;_tempRect6.set(grid.XToCell(bbox.getLeft()),grid.YToCell(bbox.getTop()),grid.XToCell(bbox.getRight()),grid.YToCell(bbox.getBottom()));if(collisionCells.equals(_tempRect6))return;var inst=this._inst;if(collisionCells===DEFAULT_COLLISION_CELLS){grid.Update(inst,null,_tempRect6);this._collisionCells=_C173.New(_C173.Rect,_tempRect6);}else{grid.Update(inst,collisionCells,_tempRect6);collisionCells.copy(_tempRect6);}this._flags&=~FLAG_COLLISION_CELL_CHANGED;}},{key:"_SetCollisionCellChanged",value:function _SetCollisionCellChanged(){this._flags|=FLAG_COLLISION_CELL_CHANGED;}},{key:"_RemoveFromCollisionCells",value:function _RemoveFromCollisionCells(){var collisionCells=this._collisionCells;if(collisionCells===DEFAULT_COLLISION_CELLS)return;this._objectClass._GetCollisionCellGrid().Update(this._inst,collisionCells,null);this._collisionCells=DEFAULT_COLLISION_CELLS;}},{key:"_UpdateRenderCell",value:function _UpdateRenderCell(){var layer=this.GetLayer();if(!layer.UsesRenderCells()||(this._flags&_FLAG_DESTROYED)!==0)return;var renderGrid=layer.GetRenderGrid();var bbox=this.GetBoundingBox();var renderCells=this._renderCells;_tempRect6.set(renderGrid.XToCell(bbox.getLeft()),renderGrid.YToCell(bbox.getTop()),renderGrid.XToCell(bbox.getRight()),renderGrid.YToCell(bbox.getBottom()));if(renderCells.equals(_tempRect6))return;var inst=this._inst;if(renderCells===DEFAULT_RENDER_CELLS){renderGrid.Update(inst,null,_tempRect6);this._renderCells=_C173.New(_C173.Rect,_tempRect6);}else{renderGrid.Update(inst,renderCells,_tempRect6);renderCells.copy(_tempRect6);}layer.SetRenderListStale();}},{key:"_RemoveFromRenderCells",value:function _RemoveFromRenderCells(){var renderCells=this._renderCells;if(renderCells===DEFAULT_RENDER_CELLS)return;this.GetLayer().GetRenderGrid().Update(this._inst,renderCells,null);this._renderCells=DEFAULT_RENDER_CELLS;}},{key:"GetRenderCellRange",value:function GetRenderCellRange(){return this._renderCells;}},{key:"ZOrderMoveToTop",value:function ZOrderMoveToTop(){var inst=this._inst;var layer=this._layer;var layerInstances=layer._GetInstances();if(layerInstances.length&&layerInstances.at(-1)===inst)return;layer._RemoveInstance(inst,false);layer._AddInstance(inst,false);this._runtime.UpdateRender();}},{key:"ZOrderMoveToBottom",value:function ZOrderMoveToBottom(){var inst=this._inst;var layer=this._layer;var layerInstances=layer._GetInstances();if(layerInstances.length&&layerInstances[0]===inst)return;layer._RemoveInstance(inst,false);layer._PrependInstance(inst,false);this._runtime.UpdateRender();}},{key:"ZOrderMoveToLayer",value:function ZOrderMoveToLayer(layerMove){var inst=this._inst;var curLayer=this._layer;if(curLayer.GetLayout()!==layerMove.GetLayout())throw new Error("layer from different layout");if(layerMove===curLayer)return;curLayer._RemoveInstance(inst,true);this._SetLayer(layerMove);layerMove._AddInstance(inst,true);this._runtime.UpdateRender();}},{key:"ZOrderMoveAdjacentToInstance",value:function ZOrderMoveAdjacentToInstance(otherInst,isAfter){var inst=this._inst;var didChangeLayer=false;var curLayer=this._layer;if(otherInst.GetUID()===inst.GetUID())return;var otherWi=otherInst.GetWorldInfo();if(!otherWi)throw new Error("expected world instance");var otherLayer=otherWi.GetLayer();if(curLayer.GetIndex()!==otherLayer.GetIndex()){curLayer._RemoveInstance(inst,true);this._SetLayer(otherLayer);otherLayer._AddInstance(inst,true);didChangeLayer=true;}var didChangeZOrder=otherLayer.MoveInstanceAdjacent(inst,otherInst,!!isAfter);if(didChangeLayer||didChangeZOrder)this._runtime.UpdateRender();}},{key:"GetInstanceEffectList",value:function GetInstanceEffectList(){return this._instanceEffectList;}},{key:"_SetHasAnyActiveEffect",value:function _SetHasAnyActiveEffect(e){this._SetFlag(FLAG_HAS_ANY_ACTIVE_EFFECT,e);}},{key:"HasAnyActiveEffect",value:function HasAnyActiveEffect(){return(this._flags&FLAG_HAS_ANY_ACTIVE_EFFECT)!==0;}},{key:"_SaveToJson",value:function _SaveToJson(mode){var o={"x":this.GetX(),"y":this.GetY(),"w":this.GetWidth(),"h":this.GetHeight(),"l":this.GetLayer().GetSID(),"zi":this.GetZIndex()};if(this.GetZElevation()!==0)o["ze"]=this.GetZElevation();if(this.GetAngle()!==0)o["a"]=this._GetAngleNoReflect();if(!this.HasDefaultColor())o["c"]=this._color.toJSON();if(this.GetOriginX()!==.5)o["oX"]=this.GetOriginX();if(this.GetOriginY()!==.5)o["oY"]=this.GetOriginY();if(this.GetBlendMode()!==0)o["bm"]=this.GetBlendMode();if(!this.IsVisible())o["v"]=this.IsVisible();if(!this.IsCollisionEnabled())o["ce"]=this.IsCollisionEnabled();if(this.IsBboxChangeEventEnabled())o["be"]=this.IsBboxChangeEventEnabled();if(this._instanceEffectList)o["fx"]=this._instanceEffectList._SaveToJson();var isSolidFilterInclusive=(this._flags&FLAG_SOLID_FILTER_INCLUSIVE)!==0;if(isSolidFilterInclusive)o["sfi"]=isSolidFilterInclusive;if(this._solidFilterTags)o["sft"]=_toConsumableArray(this._solidFilterTags).join(" ");if(this._sceneGraphInfo&&mode!=="visual-state"){o["sgi"]=this._sceneGraphInfo._SaveToJson(mode);if(sceneGraphExportDataMap.has(this)){o["sgcd"]=sceneGraphExportDataMap.get(this).childrenData;o["sgzid"]=sceneGraphExportDataMap.get(this).zIndexData;}}if(this.HasMesh())o["mesh"]=this.GetSourceMesh().SaveToJson();return o;}},{key:"_SaveSceneGraphPropertiesToJson",value:function _SaveSceneGraphPropertiesToJson(){return{"x":this._x,"y":this._y,"z":this._zElevation,"w":this._w,"h":this._h,"a":this._a,"sgi":this._GetSceneGraphInfo()?this._GetSceneGraphInfo()._SaveToJsonProperties():null};}},{key:"_LoadSceneGraphPropertiesFromJson",value:function _LoadSceneGraphPropertiesFromJson(o){if(!o)return;this._x=o["x"];this._y=o["y"];this._zElevation=o["z"];this._w=o["w"];this._h=o["h"];this._a=o["a"];if(o["sgi"]&&this._GetSceneGraphInfo())this._GetSceneGraphInfo()._LoadFromJson(o["sgi"]);this._MarkSinCosAngleChanged();this.SetBboxChanged();}},{key:"_SetupSceneGraphConnectionsOnChangeOfLayout",value:function _SetupSceneGraphConnectionsOnChangeOfLayout(){this._ReleaseTmpSceneGraphInfo();this._ResetAllSceneGraphState();this._CreateSceneGraphInfo(null);if(this._sceneGraphInfo)this._sceneGraphInfo._SetTmpSceneGraphChildren(this._tmpSceneGraphChildren,this._tmpSceneGraphChildrenIndexes);}},{key:"_OnBeforeLoad",value:function _OnBeforeLoad(mode){if(mode!=="visual-state")this._ResetAllSceneGraphState();}},{key:"_OnAfterLoad",value:function _OnAfterLoad(o){var mode=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"full";var opts=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;if(o.hasOwnProperty("sgi")&&mode!=="visual-state"){if((this._flags&_FLAG_DESTROYED)!==0)return;this._sceneGraphInfo._OnAfterLoad(o["sgi"],opts);}}},{key:"_OnAfterLoad2",value:function _OnAfterLoad2(o){var mode=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"full";var opts=arguments.length>2&&arguments[2]!==undefined?arguments[2]:null;if(o.hasOwnProperty("sgi")&&mode!=="visual-state"){if((this._flags&_FLAG_DESTROYED)!==0)return;this._sceneGraphInfo._SetTmpSceneGraphChildren(null,null);this._ReleaseTmpSceneGraphInfo();this.SetBboxChanged();}}},{key:"_LoadFromJson",value:function _LoadFromJson(o,mode){enableUpdateRendererStateGroup=false;this.SetX(o["x"]);this.SetY(o["y"]);this.SetWidth(o["w"]);this.SetHeight(o["h"]);this._SetZIndex(o["zi"]);this.SetZElevation(o.hasOwnProperty("ze")?o["ze"]:0);this.SetAngle(o.hasOwnProperty("a")?o["a"]:0);if(o.hasOwnProperty("c"))_tempColor6.setFromJSON(o["c"]);else if(o.hasOwnProperty("o")){_tempColor6.copyRgb(this._color);_tempColor6.a=o["o"];}else _tempColor6.setRgba(1,1,1,1);this._SetColor(_tempColor6);this.SetOriginX(o.hasOwnProperty("oX")?o["oX"]:.5);this.SetOriginY(o.hasOwnProperty("oY")?o["oY"]:.5);this.SetBlendMode(o.hasOwnProperty("bm")?o["bm"]:0);this.SetVisible(o.hasOwnProperty("v")?o["v"]:true);this.SetCollisionEnabled(o.hasOwnProperty("ce")?o["ce"]:true);this.SetBboxChangeEventEnabled(o.hasOwnProperty("be")?o["be"]:false);this.SetSolidCollisionFilter(o.hasOwnProperty("sfi")?o["sfi"]:false,o.hasOwnProperty("sft")?o["sft"]:"");if(this._instanceEffectList&&o.hasOwnProperty("fx"))this._instanceEffectList._LoadFromJson(o["fx"]);if(!o.hasOwnProperty("sgi")&&mode!=="visual-state")if(this._tmpSceneGraphChildren){var _iteratorNormalCompletion470=true;var _didIteratorError470=false;var _iteratorError470=undefined;try{for(var _iterator470=this._tmpSceneGraphChildren[Symbol.iterator](),_step470;!(_iteratorNormalCompletion470=(_step470=_iterator470.next()).done);_iteratorNormalCompletion470=true){var inst=_step470.value;if(inst.IsDestroyed())continue;this._runtime.DestroyInstance(inst);}}catch(err){_didIteratorError470=true;_iteratorError470=err;}finally{try{if(!_iteratorNormalCompletion470&&_iterator470["return"]!=null){_iterator470["return"]();}}finally{if(_didIteratorError470){throw _iteratorError470;}}}}if(o.hasOwnProperty("sgi")&&mode!=="visual-state"){this._CreateSceneGraphInfo(null);var sgi=this._sceneGraphInfo;var sgiData=o["sgi"];sgi._LoadFromJson(sgiData);sgi._SetTmpSceneGraphChildren(this._tmpSceneGraphChildren,this._tmpSceneGraphChildrenIndexes);if(o["sgcd"]&&_C173.IsFiniteNumber(o["sgzid"]))sceneGraphExportDataMap.set(this,{childrenData:o["sgcd"],zIndexData:o["sgzid"]});}if(o.hasOwnProperty("mesh")){var meshData=o["mesh"];this.CreateMesh(meshData["cols"],meshData["rows"]);this.GetSourceMesh().LoadFromJson(meshData);}else this.ReleaseMesh();this.SetBboxChanged();enableUpdateRendererStateGroup=true;this._UpdateRendererStateGroup();if(mode!=="visual-state")this._runtime.AddInstanceNeedingAfterLoad(this.GetInstance(),o);}}]);return WorldInfo;}(_C173.DefendedBase);}// objects/behaviorType.js
{'use strict';var _C174=self.C3;_C174.BehaviorType=/*#__PURE__*/function(_C174$DefendedBase){_inherits(BehaviorType,_C174$DefendedBase);function BehaviorType(objectClass,data){var _this143;_classCallCheck(this,BehaviorType);_this143=_possibleConstructorReturn(this,_getPrototypeOf(BehaviorType).call(this));var runtime=objectClass.GetRuntime();var pluginManager=runtime.GetPluginManager();var BehaviorCtor=runtime.GetObjectReference(data[1]);if(!pluginManager.HasBehaviorByConstructorFunction(BehaviorCtor))pluginManager.CreateBehavior(data);_this143._runtime=runtime;_this143._objectClass=objectClass;_this143._behavior=pluginManager.GetBehaviorByConstructorFunction(BehaviorCtor);_this143._sdkType=null;_this143._instSdkCtor=BehaviorCtor.Instance;_this143._sid=data[2];_this143._name=data[0];_this143._jsPropName=_this143._runtime.GetJsPropName(data[3]);_this143._sdkType=_C174.New(BehaviorCtor.Type,_assertThisInitialized(_this143));_this143.OnCreate();return _this143;}_createClass(BehaviorType,[{key:"Release",value:function Release(){this._runtime=null;this._behavior=null;this._sdkType.Release();this._sdkType=null;this._instSdkCtor=null;}},{key:"GetSdkType",value:function GetSdkType(){return this._sdkType;}},{key:"OnCreate",value:function OnCreate(){this._sdkType.OnCreate();}},{key:"GetRuntime",value:function GetRuntime(){return this._runtime;}},{key:"GetObjectClass",value:function GetObjectClass(){return this._objectClass;}},{key:"GetBehavior",value:function GetBehavior(){return this._behavior;}},{key:"GetInstanceSdkCtor",value:function GetInstanceSdkCtor(){return this._instSdkCtor;}},{key:"GetName",value:function GetName(){return this._name;}},{key:"GetSID",value:function GetSID(){return this._sid;}},{key:"GetJsPropName",value:function GetJsPropName(){return this._jsPropName;}}],[{key:"Create",value:function Create(objectClass,behaviorTypeData){return _C174.New(_C174.BehaviorType,objectClass,behaviorTypeData);}}]);return BehaviorType;}(_C174.DefendedBase);}// objects/behaviorInstance.js
{'use strict';var _C175=self.C3;var _IBehaviorInstance=self.IBehaviorInstance;_C175.BehaviorInstance=/*#__PURE__*/function(_C175$DefendedBase){_inherits(BehaviorInstance,_C175$DefendedBase);function BehaviorInstance(opts){var _this144;_classCallCheck(this,BehaviorInstance);_this144=_possibleConstructorReturn(this,_getPrototypeOf(BehaviorInstance).call(this));_this144._runtime=opts.runtime;_this144._behaviorType=opts.behaviorType;_this144._behavior=_this144._behaviorType.GetBehavior();_this144._inst=opts.instance;_this144._index=opts.index;_this144._sdkInst=null;_this144._iScriptInterface=null;_this144._behavior._AddInstance(_this144._inst);return _this144;}_createClass(BehaviorInstance,[{key:"Release",value:function Release(){if(this._iScriptInterface){this._iScriptInterface._Release();this._iScriptInterface=null;}this._behavior._RemoveInstance(this._inst);this._sdkInst.Release();this._sdkInst=null;this._runtime=null;this._behaviorType=null;this._behavior=null;this._inst=null;}},{key:"_CreateSdkInstance",value:function _CreateSdkInstance(properties){if(this._sdkInst)throw new Error("already got sdk instance");this._sdkInst=_C175.New(this._behaviorType.GetInstanceSdkCtor(),this,properties);}},{key:"GetSdkInstance",value:function GetSdkInstance(){return this._sdkInst;}},{key:"GetObjectInstance",value:function GetObjectInstance(){return this._inst;}},{key:"GetRuntime",value:function GetRuntime(){return this._runtime;}},{key:"GetBehaviorType",value:function GetBehaviorType(){return this._behaviorType;}},{key:"GetBehavior",value:function GetBehavior(){return this._behavior;}},{key:"_GetIndex",value:function _GetIndex(){return this._index;}},{key:"PostCreate",value:function PostCreate(){this._sdkInst.PostCreate();}},{key:"OnSpriteFrameChanged",value:function OnSpriteFrameChanged(prevFrame,nextFrame){this._sdkInst.OnSpriteFrameChanged(prevFrame,nextFrame);}},{key:"_GetDebuggerProperties",value:function _GetDebuggerProperties(){return this._sdkInst.GetDebuggerProperties();}},{key:"SaveToJson",value:function SaveToJson(){return this._sdkInst.SaveToJson();}},{key:"LoadFromJson",value:function LoadFromJson(o){return this._sdkInst.LoadFromJson(o);}},{key:"_InitScriptInterface",value:function _InitScriptInterface(){var DefaultScriptClass=_IBehaviorInstance;var SdkScriptClass=this._sdkInst.GetScriptInterfaceClass();var ScriptInterfaceClass=SdkScriptClass||DefaultScriptClass;_IBehaviorInstance._Init(this);this._iScriptInterface=new ScriptInterfaceClass();_IBehaviorInstance._Init(null);if(SdkScriptClass&&!(this._iScriptInterface instanceof DefaultScriptClass))throw new TypeError("script interface class '".concat(SdkScriptClass.name,"' does not extend the right base class '").concat(DefaultScriptClass.name,"'"));return this._iScriptInterface;}},{key:"GetScriptInterface",value:function GetScriptInterface(){return this._iScriptInterface||this._InitScriptInterface();}},{key:"HasScriptInterface",value:function HasScriptInterface(){return!!this._iScriptInterface;}}],[{key:"SortByTickSequence",value:function SortByTickSequence(a,b){var instA=a.GetObjectInstance();var instB=b.GetObjectInstance();var typeIndexA=instA.GetObjectClass().GetIndex();var typeIndexB=instB.GetObjectClass().GetIndex();if(typeIndexA!==typeIndexB)return typeIndexA-typeIndexB;var seqA=instA.GetPUID();var seqB=instB.GetPUID();if(seqA!==seqB)return seqA-seqB;return a.GetBehaviorInstance()._GetIndex()-b.GetBehaviorInstance()._GetIndex();}}]);return BehaviorInstance;}(_C175.DefendedBase);}// objects/effectList.js
{'use strict';var _C176=self.C3;_C176.EffectList=/*#__PURE__*/function(_C176$DefendedBase){_inherits(EffectList,_C176$DefendedBase);function EffectList(owner,data){var _this145;_classCallCheck(this,EffectList);_this145=_possibleConstructorReturn(this,_getPrototypeOf(EffectList).call(this));_this145._owner=owner;_this145._allEffectTypes=[];_this145._activeEffectTypes=[];_this145._effectTypesByName=new Map();_this145._effectParams=[];_this145._effectParamBuffers=[];_this145._allInstanceEffectLists=new Set();_this145._preservesOpaqueness=true;var _iteratorNormalCompletion471=true;var _didIteratorError471=false;var _iteratorError471=undefined;try{for(var _iterator471=data[Symbol.iterator](),_step471;!(_iteratorNormalCompletion471=(_step471=_iterator471.next()).done);_iteratorNormalCompletion471=true){var d=_step471.value;var et=_C176.New(_C176.EffectType,_assertThisInitialized(_this145),d,_this145._allEffectTypes.length);_this145._allEffectTypes.push(et);_this145._effectTypesByName.set(et.GetName().toLowerCase(),et);if(d.length>=3)_this145._effectParams.push(_this145._LoadSingleEffectParameters(et,d[2]));}}catch(err){_didIteratorError471=true;_iteratorError471=err;}finally{try{if(!_iteratorNormalCompletion471&&_iterator471["return"]!=null){_iterator471["return"]();}}finally{if(_didIteratorError471){throw _iteratorError471;}}}_this145.GetRuntime()._AddEffectList(_assertThisInitialized(_this145));return _this145;}_createClass(EffectList,[{key:"Release",value:function Release(){this.GetRuntime()._RemoveEffectList(this);var _iteratorNormalCompletion472=true;var _didIteratorError472=false;var _iteratorError472=undefined;try{for(var _iterator472=this._effectParamBuffers[Symbol.iterator](),_step472;!(_iteratorNormalCompletion472=(_step472=_iterator472.next()).done);_iteratorNormalCompletion472=true){var cpb=_step472.value;cpb.Release();}}catch(err){_didIteratorError472=true;_iteratorError472=err;}finally{try{if(!_iteratorNormalCompletion472&&_iterator472["return"]!=null){_iterator472["return"]();}}finally{if(_didIteratorError472){throw _iteratorError472;}}}_C176.clearArray(this._effectParamBuffers);_C176.clearArray(this._allEffectTypes);_C176.clearArray(this._activeEffectTypes);this._effectTypesByName.clear();_C176.clearArray(this._effectParams);this._owner=null;}},{key:"_AddInstanceEffectList",value:function _AddInstanceEffectList(iel){this._allInstanceEffectLists.add(iel);}},{key:"_RemoveInstanceEffectList",value:function _RemoveInstanceEffectList(iel){this._allInstanceEffectLists["delete"](iel);}},{key:"_InitRenderer",value:function _InitRenderer(renderer){if(renderer.IsWebGPU()){this._effectParamBuffers=this._allEffectTypes.map(function(et){var shaderProgram=et.GetShaderProgram();if(shaderProgram.GetCustomParametersByteSize()>0)return _C176.New(_C176.Gfx.WebGPUEffectCustomParamsBuffer,shaderProgram);else return null;});this._UpdateAllEffectParamBuffers();}var _iteratorNormalCompletion473=true;var _didIteratorError473=false;var _iteratorError473=undefined;try{for(var _iterator473=this._allInstanceEffectLists[Symbol.iterator](),_step473;!(_iteratorNormalCompletion473=(_step473=_iterator473.next()).done);_iteratorNormalCompletion473=true){var iel=_step473.value;iel._InitRenderer(renderer);}}catch(err){_didIteratorError473=true;_iteratorError473=err;}finally{try{if(!_iteratorNormalCompletion473&&_iterator473["return"]!=null){_iterator473["return"]();}}finally{if(_didIteratorError473){throw _iteratorError473;}}}}},{key:"PrependEffectTypes",value:function PrependEffectTypes(arr){if(!arr.length)return;this._allEffectTypes=arr.concat(this._allEffectTypes);var _iteratorNormalCompletion474=true;var _didIteratorError474=false;var _iteratorError474=undefined;try{for(var _iterator474=arr[Symbol.iterator](),_step474;!(_iteratorNormalCompletion474=(_step474=_iterator474.next()).done);_iteratorNormalCompletion474=true){var et=_step474.value;this._effectTypesByName.set(et.GetName().toLowerCase(),et);}}catch(err){_didIteratorError474=true;_iteratorError474=err;}finally{try{if(!_iteratorNormalCompletion474&&_iterator474["return"]!=null){_iterator474["return"]();}}finally{if(_didIteratorError474){throw _iteratorError474;}}}for(var i=0,len=this._allEffectTypes.length;i<len;++i){this._allEffectTypes[i]._SetIndex(i);}}},{key:"_LoadSingleEffectParameters",value:function _LoadSingleEffectParameters(effectType,arr){effectType.SetActive(arr[0]);var ret=arr.slice(1);for(var i=0,len=ret.length;i<len;++i){var p=ret[i];if(Array.isArray(p)){var _c23=_C176.New(_C176.Color);_c23.setFromJSON(p);ret[i]=_c23;}}return ret;}},{key:"GetOwner",value:function GetOwner(){return this._owner;}},{key:"GetRuntime",value:function GetRuntime(){return this._owner.GetRuntime();}},{key:"UpdateActiveEffects",value:function UpdateActiveEffects(){_C176.clearArray(this._activeEffectTypes);var preservesOpaqueness=true;var _iteratorNormalCompletion475=true;var _didIteratorError475=false;var _iteratorError475=undefined;try{for(var _iterator475=this._allEffectTypes[Symbol.iterator](),_step475;!(_iteratorNormalCompletion475=(_step475=_iterator475.next()).done);_iteratorNormalCompletion475=true){var et=_step475.value;if(et.IsActive()){this._activeEffectTypes.push(et);if(!et.GetShaderProgram().PreservesOpaqueness())preservesOpaqueness=false;}}}catch(err){_didIteratorError475=true;_iteratorError475=err;}finally{try{if(!_iteratorNormalCompletion475&&_iterator475["return"]!=null){_iterator475["return"]();}}finally{if(_didIteratorError475){throw _iteratorError475;}}}this._preservesOpaqueness=preservesOpaqueness;}},{key:"GetAllEffectTypes",value:function GetAllEffectTypes(){return this._allEffectTypes;}},{key:"HasAnyEffectType",value:function HasAnyEffectType(){return this._allEffectTypes.length>0;}},{key:"GetEffectTypeByName",value:function GetEffectTypeByName(name){return this._effectTypesByName.get(name.toLowerCase())||null;}},{key:"GetEffectTypeByIndex",value:function GetEffectTypeByIndex(index){index=Math.floor(+index);if(index<0||index>=this._allEffectTypes.length)throw new RangeError("invalid effect type index");return this._allEffectTypes[index];}},{key:"IsEffectIndexActive",value:function IsEffectIndexActive(index){return this.GetEffectTypeByIndex(index).IsActive();}},{key:"SetEffectIndexActive",value:function SetEffectIndexActive(index,a){this.GetEffectTypeByIndex(index).SetActive(a);}},{key:"GetActiveEffectTypes",value:function GetActiveEffectTypes(){return this._activeEffectTypes;}},{key:"HasAnyActiveEffect",value:function HasAnyActiveEffect(){return this._activeEffectTypes.length>0;}},{key:"PreservesOpaqueness",value:function PreservesOpaqueness(){return this._preservesOpaqueness;}},{key:"GetEffectParametersForIndex",value:function GetEffectParametersForIndex(index){return this._effectParams[index];}},{key:"_GetEffectChainShaderParametersForIndex",value:function _GetEffectChainShaderParametersForIndex(index){if(index<this._effectParamBuffers.length)return this._effectParamBuffers[index];else return this._effectParams[index];}},{key:"GetEffectParameter",value:function GetEffectParameter(effectIndex,paramIndex){if(effectIndex<0||effectIndex>=this._effectParams.length)return null;var effectParams=this._effectParams[effectIndex];if(paramIndex<0||paramIndex>=effectParams.length)return null;return effectParams[paramIndex];}},{key:"SetEffectParameter",value:function SetEffectParameter(effectIndex,paramIndex,value){if(effectIndex<0||effectIndex>=this._effectParams.length)return false;var effectParams=this._effectParams[effectIndex];if(paramIndex<0||paramIndex>=effectParams.length)return false;var oldValue=effectParams[paramIndex];if(oldValue instanceof _C176.Color){if(oldValue.equalsIgnoringAlpha(value))return false;oldValue.copyRgb(value);}else{if(oldValue===value)return false;effectParams[paramIndex]=value;}if(effectIndex<this._effectParamBuffers.length)this._effectParamBuffers[effectIndex].SetParameterValue(paramIndex,value);return true;}},{key:"_UpdateAllEffectParamBuffers",value:function _UpdateAllEffectParamBuffers(){var effectParams=this._effectParams;var effectParamBuffers=this._effectParamBuffers;for(var i=0,len=Math.min(effectParams.length,effectParamBuffers.length);i<len;++i){var paramsBuf=effectParamBuffers[i];var params=effectParams[i];for(var j=0,lenj=params.length;j<lenj;++j){paramsBuf.SetParameterValue(j,params[j]);}}}},{key:"SaveToJson",value:function SaveToJson(){var _this146=this;return this._allEffectTypes.map(function(et){return{"name":et.GetName(),"active":et.IsActive(),"params":_C176.EffectList.SaveFxParamsToJson(_this146._effectParams[et.GetIndex()])};});}},{key:"LoadFromJson",value:function LoadFromJson(arr){var _iteratorNormalCompletion476=true;var _didIteratorError476=false;var _iteratorError476=undefined;try{for(var _iterator476=arr[Symbol.iterator](),_step476;!(_iteratorNormalCompletion476=(_step476=_iterator476.next()).done);_iteratorNormalCompletion476=true){var o=_step476.value;var et=this.GetEffectTypeByName(o["name"]);if(!et)continue;et.SetActive(o["active"]);this._effectParams[et.GetIndex()]=_C176.EffectList.LoadFxParamsFromJson(o["params"]);}}catch(err){_didIteratorError476=true;_iteratorError476=err;}finally{try{if(!_iteratorNormalCompletion476&&_iterator476["return"]!=null){_iterator476["return"]();}}finally{if(_didIteratorError476){throw _iteratorError476;}}}this.UpdateActiveEffects();this._UpdateAllEffectParamBuffers();}}],[{key:"SaveFxParamToJson",value:function SaveFxParamToJson(param){if(param&&param instanceof _C176.Color)return{"t":"color","v":param.toJSON()};else return param;}},{key:"LoadFxParamFromJson",value:function LoadFxParamFromJson(o){if(o===null)return NaN;else if(_typeof(o)==="object"){var type=o["t"];if(type==="color"){var color=_C176.New(_C176.Color);color.setFromJSON(o["v"]);return color;}else throw new Error("invalid effect parameter type");}else return o;}},{key:"SaveFxParamsToJson",value:function SaveFxParamsToJson(params){return params.map(_C176.EffectList.SaveFxParamToJson);}},{key:"LoadFxParamsFromJson",value:function LoadFxParamsFromJson(arr){return arr.map(_C176.EffectList.LoadFxParamFromJson);}}]);return EffectList;}(_C176.DefendedBase);}// objects/effectType.js
{'use strict';var _C177=self.C3;_C177.EffectType=/*#__PURE__*/function(_C177$DefendedBase){_inherits(EffectType,_C177$DefendedBase);function EffectType(effectList,data,index){var _this147;_classCallCheck(this,EffectType);_this147=_possibleConstructorReturn(this,_getPrototypeOf(EffectType).call(this));_this147._effectList=effectList;_this147._id=data[0];_this147._name=data[1];_this147._index=index;_this147._shaderProgram=null;_this147._isActive=true;return _this147;}_createClass(EffectType,[{key:"Release",value:function Release(){this._effectList=null;this._shaderProgram=null;}},{key:"Clone",value:function Clone(effectListOwner){var ret=_C177.New(_C177.EffectType,effectListOwner,[this._id,this._name],-1);ret._shaderProgram=this._shaderProgram;ret._isActive=this._isActive;return ret;}},{key:"_InitRenderer",value:function _InitRenderer(renderer){var shaderProgram=renderer.GetShaderProgramByName(this._id);if(!shaderProgram)throw new Error("failed to find shader program '"+this._id+"'");this._shaderProgram=shaderProgram;}},{key:"GetEffectList",value:function GetEffectList(){return this._effectList;}},{key:"GetName",value:function GetName(){return this._name;}},{key:"_SetIndex",value:function _SetIndex(i){this._index=i;}},{key:"GetIndex",value:function GetIndex(){return this._index;}},{key:"GetOwner",value:function GetOwner(){return this._effectList.GetOwner();}},{key:"GetRuntime",value:function GetRuntime(){return this._effectList.GetRuntime();}},{key:"SetActive",value:function SetActive(a){this._isActive=!!a;}},{key:"IsActive",value:function IsActive(){return this._isActive;}},{key:"GetShaderProgram",value:function GetShaderProgram(){return this._shaderProgram;}},{key:"GetDefaultParameterValues",value:function GetDefaultParameterValues(){var ret=[];for(var i=0,len=this._shaderProgram.GetParameterCount();i<len;++i){var type=this._shaderProgram.GetParameterType(i);if(type==="float"||type==="percent")ret.push(0);else if(type==="color")ret.push(_C177.New(_C177.Color,1,1,1,1));else throw new TypeError("unknown effect parameter type");}return ret;}}]);return EffectType;}(_C177.DefendedBase);}// objects/instanceEffectList.js
{'use strict';var _C178=self.C3;_C178.InstanceEffectList=/*#__PURE__*/function(_C178$DefendedBase){_inherits(InstanceEffectList,_C178$DefendedBase);function InstanceEffectList(inst,wi){var _this148;_classCallCheck(this,InstanceEffectList);_this148=_possibleConstructorReturn(this,_getPrototypeOf(InstanceEffectList).call(this));_this148._inst=inst;_this148._wi=wi;_this148._effectList=inst.GetObjectClass().GetEffectList();_this148._needsRebuildSteps=true;_this148._wasDefaultColor=true;_this148._was3D=false;_this148._wasRotatedOrNegativeSize=false;_this148._wasTexRotated=false;_this148._effectChain=_C178.New(_C178.Gfx.EffectChain,inst.GetRuntime().GetCanvasManager().GetEffectChainManager(),{drawContent:function drawContent(renderer,effectChain){var inst=effectChain.GetContentObject();var wi=inst.GetWorldInfo();renderer.SetColor(wi.GetPremultipliedColor());renderer.SetCurrentZ(wi.GetTotalZElevation());inst.Draw(renderer);renderer.SetCurrentZ(0);},getSourceTextureInfo:function getSourceTextureInfo(inst){var srcTexRect=inst.GetCurrentTexRect();var _inst$GetCurrentSurfa=inst.GetCurrentSurfaceSize(),_inst$GetCurrentSurfa2=_slicedToArray(_inst$GetCurrentSurfa,2),srcWidth=_inst$GetCurrentSurfa2[0],srcHeight=_inst$GetCurrentSurfa2[1];return{srcTexRect:srcTexRect,srcWidth:srcWidth,srcHeight:srcHeight};},getShaderParameters:function getShaderParameters(index){return _this148._GetEffectChainShaderParametersForIndex(index);}});_this148._activeEffectFlags=[];_this148._activeEffectTypes=[];_this148._preservesOpaqueness=true;_this148._effectParams=[];_this148._effectParamBuffers=[];_this148._InitRenderer(inst.GetRuntime().GetRenderer());for(var i=0,len=_this148._effectList.GetAllEffectTypes().length;i<len;++i){_this148._activeEffectFlags.push(true);}_this148.UpdateActiveEffects();_this148._effectList._AddInstanceEffectList(_assertThisInitialized(_this148));return _this148;}_createClass(InstanceEffectList,[{key:"Release",value:function Release(){this._effectList._RemoveInstanceEffectList(this);var _iteratorNormalCompletion477=true;var _didIteratorError477=false;var _iteratorError477=undefined;try{for(var _iterator477=this._effectParamBuffers[Symbol.iterator](),_step477;!(_iteratorNormalCompletion477=(_step477=_iterator477.next()).done);_iteratorNormalCompletion477=true){var cpb=_step477.value;if(cpb)cpb.Release();}}catch(err){_didIteratorError477=true;_iteratorError477=err;}finally{try{if(!_iteratorNormalCompletion477&&_iterator477["return"]!=null){_iterator477["return"]();}}finally{if(_didIteratorError477){throw _iteratorError477;}}}_C178.clearArray(this._effectParamBuffers);this._effectChain.Release();this._effectChain=null;_C178.clearArray(this._activeEffectFlags);_C178.clearArray(this._activeEffectTypes);_C178.clearArray(this._effectParams);this._inst=null;this._effectList=null;}},{key:"_InitRenderer",value:function _InitRenderer(renderer){if(renderer.IsWebGPU())this._effectParamBuffers=this._effectList.GetAllEffectTypes().map(function(et){var shaderProgram=et.GetShaderProgram();if(shaderProgram.GetCustomParametersByteSize()>0)return _C178.New(_C178.Gfx.WebGPUEffectCustomParamsBuffer,shaderProgram);else return null;});}},{key:"_LoadEffectParameters",value:function _LoadEffectParameters(data){var index=0;var _iteratorNormalCompletion478=true;var _didIteratorError478=false;var _iteratorError478=undefined;try{for(var _iterator478=data[Symbol.iterator](),_step478;!(_iteratorNormalCompletion478=(_step478=_iterator478.next()).done);_iteratorNormalCompletion478=true){var e=_step478.value;this._effectParams.push(this._LoadSingleEffectParameters(index,e));++index;}}catch(err){_didIteratorError478=true;_iteratorError478=err;}finally{try{if(!_iteratorNormalCompletion478&&_iterator478["return"]!=null){_iterator478["return"]();}}finally{if(_didIteratorError478){throw _iteratorError478;}}}this._UpdateAllEffectParamBuffers();this.UpdateActiveEffects();}},{key:"_LoadSingleEffectParameters",value:function _LoadSingleEffectParameters(index,arr){this._activeEffectFlags[index]=arr[0];var ret=arr.slice(1);for(var i=0,len=ret.length;i<len;++i){var p=ret[i];if(Array.isArray(p)){var _c24=_C178.New(_C178.Color);_c24.setFromJSON(p);ret[i]=_c24;}}return ret;}},{key:"LoadDefaultEffectParameters",value:function LoadDefaultEffectParameters(){var _iteratorNormalCompletion479=true;var _didIteratorError479=false;var _iteratorError479=undefined;try{for(var _iterator479=this._effectList.GetAllEffectTypes()[Symbol.iterator](),_step479;!(_iteratorNormalCompletion479=(_step479=_iterator479.next()).done);_iteratorNormalCompletion479=true){var effectType=_step479.value;this._effectParams.push(effectType.GetDefaultParameterValues());}}catch(err){_didIteratorError479=true;_iteratorError479=err;}finally{try{if(!_iteratorNormalCompletion479&&_iterator479["return"]!=null){_iterator479["return"]();}}finally{if(_didIteratorError479){throw _iteratorError479;}}}this._UpdateAllEffectParamBuffers();}},{key:"GetOwner",value:function GetOwner(){return this._owner;}},{key:"GetEffectList",value:function GetEffectList(){return this._effectList;}},{key:"GetEffectChain",value:function GetEffectChain(){this._MaybeRebuildEffectChainSteps();return this._effectChain;}},{key:"GetRuntime",value:function GetRuntime(){return this._inst.GetRuntime();}},{key:"UpdateActiveEffects",value:function UpdateActiveEffects(){_C178.clearArray(this._activeEffectTypes);var wi=this._wi;var allEffectTypes=this._effectList.GetAllEffectTypes();var activeEffectTypes=this._activeEffectTypes;var activeEffectFlags=this._activeEffectFlags;var preservesOpaqueness=true;for(var i=0,len=allEffectTypes.length;i<len;++i){if(activeEffectFlags[i]){var et=allEffectTypes[i];activeEffectTypes.push(et);if(!et.GetShaderProgram().PreservesOpaqueness())preservesOpaqueness=false;}}this._preservesOpaqueness=preservesOpaqueness;wi._SetHasAnyActiveEffect(!!activeEffectTypes.length);this._needsRebuildSteps=true;}},{key:"_MaybeRebuildEffectChainSteps",value:function _MaybeRebuildEffectChainSteps(){var inst=this._inst;var wi=this._wi;var isDefaultColor=wi.HasDefaultColor();var is3D=wi.GetDepth()>0;var isRotatedOrNegativeSizeInstance=wi.GetAngle()!==0||wi.GetWidth()<0||wi.GetHeight()<0;var isTexRotated=inst.IsCurrentTexRotated();if(!this._needsRebuildSteps&&isDefaultColor===this._wasDefaultColor&&is3D===this._was3D&&isRotatedOrNegativeSizeInstance===this._wasRotatedOrNegativeSize&&isTexRotated===this._wasTexRotated&&!this._effectChain.NeedsRebuild())return;this._effectChain.BuildSteps(this._activeEffectTypes.map(function(e){return e.GetShaderProgram();}),{indexMap:this._activeEffectTypes.map(function(e){return e.GetIndex();}),forcePreDraw:!isDefaultColor||inst.MustPreDraw(),is3D:is3D,isSourceTextureRotated:isTexRotated,isRotatedOrNegativeSizeInstance:isRotatedOrNegativeSizeInstance});this._needsRebuildSteps=false;this._wasDefaultColor=isDefaultColor;this._was3D=is3D;this._wasRotatedOrNegativeSize=isRotatedOrNegativeSizeInstance;this._wasTexRotated=isTexRotated;}},{key:"GetActiveEffectTypes",value:function GetActiveEffectTypes(){return this._activeEffectTypes;}},{key:"GetEffectParametersForIndex",value:function GetEffectParametersForIndex(index){return this._effectParams[index];}},{key:"_GetEffectChainShaderParametersForIndex",value:function _GetEffectChainShaderParametersForIndex(index){if(index<this._effectParamBuffers.length)return this._effectParamBuffers[index];else return this._effectParams[index];}},{key:"GetEffectParameter",value:function GetEffectParameter(effectIndex,paramIndex){if(effectIndex<0||effectIndex>=this._effectParams.length)return null;var effectParams=this._effectParams[effectIndex];if(paramIndex<0||paramIndex>=effectParams.length)return null;return effectParams[paramIndex];}},{key:"SetEffectParameter",value:function SetEffectParameter(effectIndex,paramIndex,value){if(effectIndex<0||effectIndex>=this._effectParams.length)return false;var effectParams=this._effectParams[effectIndex];if(paramIndex<0||paramIndex>=effectParams.length)return false;var oldValue=effectParams[paramIndex];if(oldValue instanceof _C178.Color){if(oldValue.equalsIgnoringAlpha(value))return false;oldValue.copyRgb(value);}else{if(oldValue===value)return false;effectParams[paramIndex]=value;}if(effectIndex<this._effectParamBuffers.length)this._effectParamBuffers[effectIndex].SetParameterValue(paramIndex,value);return true;}},{key:"_UpdateAllEffectParamBuffers",value:function _UpdateAllEffectParamBuffers(){var effectParams=this._effectParams;var effectParamBuffers=this._effectParamBuffers;for(var i=0,len=effectParamBuffers.length;i<len;++i){var paramsBuf=effectParamBuffers[i];var params=effectParams[i];for(var j=0,lenj=params.length;j<lenj;++j){paramsBuf.SetParameterValue(j,params[j]);}}}},{key:"PreservesOpaqueness",value:function PreservesOpaqueness(){return this._preservesOpaqueness;}},{key:"HasAnyActiveBackgroundBlendingEffect",value:function HasAnyActiveBackgroundBlendingEffect(){return this._activeEffectTypes.some(function(et){return et.GetShaderProgram().BlendsBackground();});}},{key:"IsEffectIndexActive",value:function IsEffectIndexActive(i){return this._activeEffectFlags[i];}},{key:"SetEffectIndexActive",value:function SetEffectIndexActive(i,e){this._activeEffectFlags[i]=!!e;}},{key:"GetAllEffectTypes",value:function GetAllEffectTypes(){return this._effectList.GetAllEffectTypes();}},{key:"_SaveToJson",value:function _SaveToJson(){var _this149=this;return this._effectList.GetAllEffectTypes().map(function(et){return{"name":et.GetName(),"active":_this149._activeEffectFlags[et.GetIndex()],"params":_C178.EffectList.SaveFxParamsToJson(_this149._effectParams[et.GetIndex()])};});}},{key:"_LoadFromJson",value:function _LoadFromJson(arr){var _iteratorNormalCompletion480=true;var _didIteratorError480=false;var _iteratorError480=undefined;try{for(var _iterator480=arr[Symbol.iterator](),_step480;!(_iteratorNormalCompletion480=(_step480=_iterator480.next()).done);_iteratorNormalCompletion480=true){var o=_step480.value;var et=this._effectList.GetEffectTypeByName(o["name"]);if(!et)continue;this._activeEffectFlags[et.GetIndex()]=o["active"];this._effectParams[et.GetIndex()]=_C178.EffectList.LoadFxParamsFromJson(o["params"]);}}catch(err){_didIteratorError480=true;_iteratorError480=err;}finally{try{if(!_iteratorNormalCompletion480&&_iterator480["return"]!=null){_iterator480["return"]();}}finally{if(_didIteratorError480){throw _iteratorError480;}}}this.UpdateActiveEffects();this._UpdateAllEffectParamBuffers();}}]);return InstanceEffectList;}(_C178.DefendedBase);}// collisions/collisionEngine.js
{'use strict';var _C179=self.C3;var tempCandidates=[];var tileCollRectCandidates=[];var tempJumpthruRet=[];var tempPolyA=_C179.New(_C179.CollisionPoly);var tempPolyB=_C179.New(_C179.CollisionPoly);var _tempQuad4=_C179.New(_C179.Quad);var _tempRect7=_C179.New(_C179.Rect);var _tempRect8=_C179.New(_C179.Rect);var tempPolyC=null;var _tempRect9=null;var tempQuadB=null;_C179.CollisionEngine=/*#__PURE__*/function(_C179$DefendedBase){_inherits(CollisionEngine,_C179$DefendedBase);function CollisionEngine(runtime){var _this150;_classCallCheck(this,CollisionEngine);_this150=_possibleConstructorReturn(this,_getPrototypeOf(CollisionEngine).call(this));_this150._runtime=runtime;_this150._collisionCellWidth=0;_this150._collisionCellHeight=0;_this150._registeredCollisions=[];_this150._collisionCheckCount=0;_this150._collisionCheckSec=0;_this150._polyCheckCount=0;_this150._polyCheckSec=0;_this150._iCollisionEngine=new self.ICollisionEngine(_assertThisInitialized(_this150));return _this150;}_createClass(CollisionEngine,[{key:"Release",value:function Release(){this._runtime=null;}},{key:"GetRuntime",value:function GetRuntime(){return this._runtime;}},{key:"GetICollisionEngine",value:function GetICollisionEngine(){return this._iCollisionEngine;}},{key:"_Update1sStats",value:function _Update1sStats(){this._collisionCheckSec=this._collisionCheckCount;this._collisionCheckCount=0;this._polyCheckSec=this._polyCheckCount;this._polyCheckCount=0;}},{key:"Get1secCollisionChecks",value:function Get1secCollisionChecks(){return this._collisionCheckSec;}},{key:"Get1secPolyChecks",value:function Get1secPolyChecks(){return this._polyCheckSec;}},{key:"RegisterCollision",value:function RegisterCollision(a,b){var aw=a.GetWorldInfo();var bw=b.GetWorldInfo();if(!aw||!bw)return;if(!aw.IsCollisionEnabled()||!bw.IsCollisionEnabled())return;this._registeredCollisions.push([a,b]);}},{key:"AddRegisteredCollisionCandidates",value:function AddRegisteredCollisionCandidates(inst,otherType,arr){var _iteratorNormalCompletion481=true;var _didIteratorError481=false;var _iteratorError481=undefined;try{for(var _iterator481=this._registeredCollisions[Symbol.iterator](),_step481;!(_iteratorNormalCompletion481=(_step481=_iterator481.next()).done);_iteratorNormalCompletion481=true){var _step481$value=_slicedToArray(_step481.value,2),_a11=_step481$value[0],_b6=_step481$value[1];var otherInst=null;if(inst===_a11)otherInst=_b6;else if(inst===_b6)otherInst=_a11;else continue;if(!otherInst.BelongsToObjectClass(otherType))continue;if(!arr.includes(otherInst))arr.push(otherInst);}}catch(err){_didIteratorError481=true;_iteratorError481=err;}finally{try{if(!_iteratorNormalCompletion481&&_iterator481["return"]!=null){_iterator481["return"]();}}finally{if(_didIteratorError481){throw _iteratorError481;}}}}},{key:"CheckRegisteredCollision",value:function CheckRegisteredCollision(a,b){if(!this._registeredCollisions.length)return false;var _iteratorNormalCompletion482=true;var _didIteratorError482=false;var _iteratorError482=undefined;try{for(var _iterator482=this._registeredCollisions[Symbol.iterator](),_step482;!(_iteratorNormalCompletion482=(_step482=_iterator482.next()).done);_iteratorNormalCompletion482=true){var _step482$value=_slicedToArray(_step482.value,2),_c25=_step482$value[0],d=_step482$value[1];if(a===_c25&&b===d||a===d&&b===_c25)return true;}}catch(err){_didIteratorError482=true;_iteratorError482=err;}finally{try{if(!_iteratorNormalCompletion482&&_iterator482["return"]!=null){_iterator482["return"]();}}finally{if(_didIteratorError482){throw _iteratorError482;}}}return false;}},{key:"ClearRegisteredCollisions",value:function ClearRegisteredCollisions(){_C179.clearArray(this._registeredCollisions);}},{key:"TestOverlap",value:function TestOverlap(a,b){if(!a||!b||a===b)return false;var aw=a.GetWorldInfo();var bw=b.GetWorldInfo();if(!aw.IsCollisionEnabled()||!bw.IsCollisionEnabled())return false;this._collisionCheckCount++;var layerA=aw.GetLayer();var layerB=bw.GetLayer();var areLayerTransformsCompatible=layerA.IsTransformCompatibleWith(layerB);if(areLayerTransformsCompatible)return this._TestOverlap_SameLayers(aw,bw);else return this._TestOverlap_DifferentLayers(aw,bw);}},{key:"_TestOverlap_SameLayers",value:function _TestOverlap_SameLayers(aw,bw){if(!aw.GetBoundingBox().intersectsRect(bw.GetBoundingBox()))return false;this._polyCheckCount++;if(!aw.GetBoundingQuad().intersectsQuad(bw.GetBoundingQuad()))return false;if(aw.HasTilemap()&&bw.HasTilemap())return false;if(aw.HasTilemap())return this.TestTilemapOverlap(aw,bw);else if(bw.HasTilemap())return this.TestTilemapOverlap(bw,aw);if(!aw.HasOwnCollisionPoly()&&!bw.HasOwnCollisionPoly())return true;var polyA=aw.GetTransformedCollisionPoly();var polyB=bw.GetTransformedCollisionPoly();return polyA.intersectsPoly(polyB,bw.GetX()-aw.GetX(),bw.GetY()-aw.GetY());}},{key:"_TestOverlap_DifferentLayers",value:function _TestOverlap_DifferentLayers(aw,bw){var aIsTileMap=aw.HasTilemap();var bIsTileMap=bw.HasTilemap();if(aIsTileMap&&!bIsTileMap)return this.TestTilemapOverlapDifferentLayers(aw,bw);else if(bIsTileMap&&!aIsTileMap)return this.TestTilemapOverlapDifferentLayers(bw,aw);else if(!bIsTileMap&&!aIsTileMap){var layerA=aw.GetLayer();var layerB=bw.GetLayer();tempPolyA.copy(aw.GetTransformedCollisionPoly());tempPolyB.copy(bw.GetTransformedCollisionPoly());var ptsArrA=tempPolyA.pointsArr();for(var i=0,len=ptsArrA.length;i<len;i+=2){var j=i+1;var x=ptsArrA[i];var y=ptsArrA[j];var _layerA$LayerToCanvas=layerA.LayerToCanvasCss(x+aw.GetX(),y+aw.GetY()),_layerA$LayerToCanvas2=_slicedToArray(_layerA$LayerToCanvas,2),lx=_layerA$LayerToCanvas2[0],ly=_layerA$LayerToCanvas2[1];ptsArrA[i]=lx;ptsArrA[j]=ly;}var ptsArrB=tempPolyB.pointsArr();for(var _i61=0,_len54=ptsArrB.length;_i61<_len54;_i61+=2){var _j3=_i61+1;var _x3=ptsArrB[_i61];var _y2=ptsArrB[_j3];var _layerB$LayerToCanvas=layerB.LayerToCanvasCss(_x3+bw.GetX(),_y2+bw.GetY()),_layerB$LayerToCanvas2=_slicedToArray(_layerB$LayerToCanvas,2),_lx=_layerB$LayerToCanvas2[0],_ly=_layerB$LayerToCanvas2[1];ptsArrB[_i61]=_lx;ptsArrB[_j3]=_ly;}tempPolyA.setBboxChanged();tempPolyB.setBboxChanged();this._polyCheckCount++;return tempPolyA.intersectsPoly(tempPolyB,0,0);}else return false;}},{key:"TestTilemapOverlapDifferentLayers",value:function TestTilemapOverlapDifferentLayers(tilemapWi,nonTilemapWi){var tilemapLayer=tilemapWi.GetLayer();var nonTilemapLayer=nonTilemapWi.GetLayer();if(!tempPolyC)tempPolyC=_C179.New(_C179.CollisionPoly);if(!_tempRect9)_tempRect9=_C179.New(_C179.Rect);if(!tempQuadB)tempQuadB=_C179.New(_C179.Quad);var nonTilemapX=nonTilemapWi.GetX();var nonTilemapY=nonTilemapWi.GetY();var _nonTilemapLayer$Laye=nonTilemapLayer.LayerToCanvasCss(nonTilemapX,nonTilemapY),_nonTilemapLayer$Laye2=_slicedToArray(_nonTilemapLayer$Laye,2),lx=_nonTilemapLayer$Laye2[0],ly=_nonTilemapLayer$Laye2[1];var _tilemapLayer$CanvasC=tilemapLayer.CanvasCssToLayer(lx,ly),_tilemapLayer$CanvasC2=_slicedToArray(_tilemapLayer$CanvasC,2),nonTilemapTransformedX=_tilemapLayer$CanvasC2[0],nonTilemapTransformedY=_tilemapLayer$CanvasC2[1];var deltaX=nonTilemapTransformedX-nonTilemapX;var deltaY=nonTilemapTransformedY-nonTilemapY;_tempRect9.copy(nonTilemapWi.GetBoundingBox());_tempRect9.offset(deltaX,deltaY);if(!tilemapWi.GetBoundingBox().intersectsRect(_tempRect9))return false;tempQuadB.copy(nonTilemapWi.GetBoundingQuad());tempQuadB.offset(deltaX,deltaY);this._polyCheckCount++;if(!tilemapWi.GetBoundingQuad().intersectsQuad(tempQuadB))return false;tempPolyC.copy(nonTilemapWi.GetTransformedCollisionPoly());var ptsArrB=tempPolyC.pointsArr();for(var i=0,len=ptsArrB.length;i<len;i+=2){var j=i+1;ptsArrB[i]+=deltaX;ptsArrB[j]+=deltaY;}tempPolyC.setBboxChanged();return this.TestTilemapOverlap(tilemapWi,nonTilemapWi,nonTilemapTransformedX,nonTilemapTransformedY,tempPolyC,_tempRect9,tempQuadB);}},{key:"TestTilemapOverlap",value:function TestTilemapOverlap(tmWi,wi,transformedWiX,transformedWiY,transformedCollisionPoly,transformedBoundingBox,transformedBoundingQuad){var bbox=transformedBoundingBox!==undefined?transformedBoundingBox:wi.GetBoundingBox();var tmX=tmWi.GetX();var tmY=tmWi.GetY();var tmSdkInst=tmWi.GetInstance().GetSdkInstance();var instX=transformedWiX!==undefined?transformedWiX:wi.GetX();var instY=transformedWiY!==undefined?transformedWiY:wi.GetY();var instHasPoly=wi.HasOwnCollisionPoly();var instQuad=transformedBoundingQuad!==undefined?transformedBoundingQuad:wi.GetBoundingQuad();var collRects=tileCollRectCandidates;tmSdkInst.GetCollisionRectCandidates(bbox,collRects);for(var i=0,len=collRects.length;i<len;++i){var _c26=collRects[i];var rc=_c26.GetRect();this._collisionCheckCount++;if(bbox.intersectsRectOffset(rc,tmX,tmY)){_tempQuad4.setFromRect(rc);_tempQuad4.offset(tmX,tmY);if(_tempQuad4.intersectsQuad(instQuad))if(instHasPoly){var instPoly=transformedCollisionPoly!==undefined?transformedCollisionPoly:wi.GetTransformedCollisionPoly();var instOffX=instX;var instOffY=instY;if(transformedCollisionPoly!==undefined){instOffX=wi.GetX();instOffY=wi.GetY();}var tilePoly=_c26.GetPoly();if(tilePoly){this._polyCheckCount++;if(tilePoly.intersectsPoly(instPoly,instOffX-(tmX+rc.getLeft()),instOffY-(tmY+rc.getTop()))){_C179.clearArray(collRects);return true;}}else{tempPolyA.setFromQuad(_tempQuad4,0,0);if(tempPolyA.intersectsPoly(instPoly,instOffX,instOffY)){_C179.clearArray(collRects);return true;}}}else{var _tilePoly=_c26.GetPoly();if(_tilePoly){tempPolyA.setFromQuad(instQuad,0,0);if(_tilePoly.intersectsPoly(tempPolyA,-(tmX+rc.getLeft()),-(tmY+rc.getTop()))){_C179.clearArray(collRects);return true;}}else{_C179.clearArray(collRects);return true;}}}}_C179.clearArray(collRects);return false;}},{key:"TestAndSelectCanvasPointOverlap",value:function TestAndSelectCanvasPointOverlap(objectClass,ptx,pty,isInverted){var sol=objectClass.GetCurrentSol();var currentEvent=this._runtime.GetCurrentEvent();if(!currentEvent)throw new Error("cannot call outside event");var isOrBlock=currentEvent.IsOrBlock();var interactiveLayersCache=new Map();var isLayerInteractive=function isLayerInteractive(layer){var ret=interactiveLayersCache.get(layer);if(typeof ret==="undefined"){ret=layer.IsSelfAndParentsInteractive();interactiveLayersCache.set(layer,ret);}return ret;};if(sol.IsSelectAll()){if(!isInverted){sol._SetSelectAll(false);_C179.clearArray(sol._GetOwnInstances());}if(isOrBlock)_C179.clearArray(sol._GetOwnElseInstances());var _iteratorNormalCompletion483=true;var _didIteratorError483=false;var _iteratorError483=undefined;try{for(var _iterator483=objectClass.GetInstances()[Symbol.iterator](),_step483;!(_iteratorNormalCompletion483=(_step483=_iterator483.next()).done);_iteratorNormalCompletion483=true){var inst=_step483.value;var wi=inst.GetWorldInfo();var layer=wi.GetLayer();var containsPoint=false;if(isLayerInteractive(layer)&&wi.IsInViewport2()){var _layer$CanvasCssToLay=layer.CanvasCssToLayer(ptx,pty,wi.GetTotalZElevation()),_layer$CanvasCssToLay2=_slicedToArray(_layer$CanvasCssToLay,2),lx=_layer$CanvasCssToLay2[0],ly=_layer$CanvasCssToLay2[1];containsPoint=wi.ContainsPoint(lx,ly);}if(containsPoint){if(isInverted)return false;else sol._PushInstance(inst);}else if(isOrBlock)sol._PushElseInstance(inst);}}catch(err){_didIteratorError483=true;_iteratorError483=err;}finally{try{if(!_iteratorNormalCompletion483&&_iterator483["return"]!=null){_iterator483["return"]();}}finally{if(_didIteratorError483){throw _iteratorError483;}}}}else{var arr;var isPickingElseInstances=false;if(isOrBlock){if(this._runtime.IsCurrentConditionFirst()&&!sol._GetOwnElseInstances().length&&sol._GetOwnInstances().length)arr=sol._GetOwnInstances();else{arr=sol._GetOwnElseInstances();isPickingElseInstances=true;}}else arr=sol._GetOwnInstances();var j=0;for(var i=0,len=arr.length;i<len;++i){var _inst13=arr[i];var _wi3=_inst13.GetWorldInfo();var _layer7=_wi3.GetLayer();var _containsPoint=false;if(isLayerInteractive(_layer7)&&_wi3.IsInViewport2()){var _layer7$CanvasCssToLa=_layer7.CanvasCssToLayer(ptx,pty,_wi3.GetTotalZElevation()),_layer7$CanvasCssToLa2=_slicedToArray(_layer7$CanvasCssToLa,2),_lx2=_layer7$CanvasCssToLa2[0],_ly2=_layer7$CanvasCssToLa2[1];_containsPoint=_wi3.ContainsPoint(_lx2,_ly2);}if(_containsPoint){if(isInverted)return false;else if(isPickingElseInstances)sol._PushInstance(_inst13);else arr[j++]=_inst13;}else if(isPickingElseInstances)arr[j++]=_inst13;else if(isOrBlock)sol._PushElseInstance(_inst13);}if(!isInverted)arr.length=j;}objectClass.ApplySolToContainer();interactiveLayersCache.clear();if(isInverted)return true;else return sol.HasAnyInstances();}},{key:"GetCollisionCandidates",value:function GetCollisionCandidates(layer,rtype,bbox,candidates){var isParallaxed=layer?layer.GetParallaxX()!==1||layer.GetParallaxY()!==1:false;if(rtype.IsFamily()){var _iteratorNormalCompletion484=true;var _didIteratorError484=false;var _iteratorError484=undefined;try{for(var _iterator484=rtype.GetFamilyMembers()[Symbol.iterator](),_step484;!(_iteratorNormalCompletion484=(_step484=_iterator484.next()).done);_iteratorNormalCompletion484=true){var memberType=_step484.value;if(isParallaxed||memberType.IsAnyInstanceParallaxed())_C179.appendArray(candidates,memberType.GetInstances());else{memberType._UpdateAllCollisionCells();memberType._GetCollisionCellGrid().QueryRange(bbox,candidates);}}}catch(err){_didIteratorError484=true;_iteratorError484=err;}finally{try{if(!_iteratorNormalCompletion484&&_iterator484["return"]!=null){_iterator484["return"]();}}finally{if(_didIteratorError484){throw _iteratorError484;}}}}else if(isParallaxed||rtype.IsAnyInstanceParallaxed())_C179.appendArray(candidates,rtype.GetInstances());else{rtype._UpdateAllCollisionCells();rtype._GetCollisionCellGrid().QueryRange(bbox,candidates);}}},{key:"GetObjectClassesCollisionCandidates",value:function GetObjectClassesCollisionCandidates(layer,objectClasses,bbox,candidates){var _iteratorNormalCompletion485=true;var _didIteratorError485=false;var _iteratorError485=undefined;try{for(var _iterator485=objectClasses[Symbol.iterator](),_step485;!(_iteratorNormalCompletion485=(_step485=_iterator485.next()).done);_iteratorNormalCompletion485=true){var objectClass=_step485.value;this.GetCollisionCandidates(layer,objectClass,bbox,candidates);}}catch(err){_didIteratorError485=true;_iteratorError485=err;}finally{try{if(!_iteratorNormalCompletion485&&_iterator485["return"]!=null){_iterator485["return"]();}}finally{if(_didIteratorError485){throw _iteratorError485;}}}}},{key:"GetSolidCollisionCandidates",value:function GetSolidCollisionCandidates(layer,bbox,candidates){var solidBehavior=this._runtime.GetSolidBehavior();if(!solidBehavior)return;this.GetObjectClassesCollisionCandidates(layer,solidBehavior.GetObjectClasses(),bbox,candidates);}},{key:"GetJumpthruCollisionCandidates",value:function GetJumpthruCollisionCandidates(layer,bbox,candidates){var jumpthruBehavior=this._runtime.GetJumpthruBehavior();if(!jumpthruBehavior)return;this.GetObjectClassesCollisionCandidates(layer,jumpthruBehavior.GetObjectClasses(),bbox,candidates);}},{key:"IsSolidCollisionAllowed",value:function IsSolidCollisionAllowed(solidInst,inst){return solidInst._IsSolidEnabled()&&(!inst||inst.GetWorldInfo().IsSolidCollisionAllowed(solidInst.GetSavedDataMap().get("solidTags")));}},{key:"TestOverlapSolid",value:function TestOverlapSolid(inst){var wi=inst.GetWorldInfo();this.GetSolidCollisionCandidates(wi.GetLayer(),wi.GetBoundingBox(),tempCandidates);var _iteratorNormalCompletion486=true;var _didIteratorError486=false;var _iteratorError486=undefined;try{for(var _iterator486=tempCandidates[Symbol.iterator](),_step486;!(_iteratorNormalCompletion486=(_step486=_iterator486.next()).done);_iteratorNormalCompletion486=true){var s=_step486.value;if(!this.IsSolidCollisionAllowed(s,inst))continue;if(this.TestOverlap(inst,s)){_C179.clearArray(tempCandidates);return s;}}}catch(err){_didIteratorError486=true;_iteratorError486=err;}finally{try{if(!_iteratorNormalCompletion486&&_iterator486["return"]!=null){_iterator486["return"]();}}finally{if(_didIteratorError486){throw _iteratorError486;}}}_C179.clearArray(tempCandidates);return null;}},{key:"TestRectOverlapSolid",value:function TestRectOverlapSolid(rect,inst){this.GetSolidCollisionCandidates(null,rect,tempCandidates);var _iteratorNormalCompletion487=true;var _didIteratorError487=false;var _iteratorError487=undefined;try{for(var _iterator487=tempCandidates[Symbol.iterator](),_step487;!(_iteratorNormalCompletion487=(_step487=_iterator487.next()).done);_iteratorNormalCompletion487=true){var s=_step487.value;if(!this.IsSolidCollisionAllowed(s,inst))continue;if(this.TestRectOverlap(rect,s)){_C179.clearArray(tempCandidates);return s;}}}catch(err){_didIteratorError487=true;_iteratorError487=err;}finally{try{if(!_iteratorNormalCompletion487&&_iterator487["return"]!=null){_iterator487["return"]();}}finally{if(_didIteratorError487){throw _iteratorError487;}}}_C179.clearArray(tempCandidates);return null;}},{key:"TestOverlapJumpthru",value:function TestOverlapJumpthru(inst,all){var ret=null;if(all){ret=tempJumpthruRet;_C179.clearArray(ret);}var wi=inst.GetWorldInfo();this.GetJumpthruCollisionCandidates(wi.GetLayer(),wi.GetBoundingBox(),tempCandidates);var _iteratorNormalCompletion488=true;var _didIteratorError488=false;var _iteratorError488=undefined;try{for(var _iterator488=tempCandidates[Symbol.iterator](),_step488;!(_iteratorNormalCompletion488=(_step488=_iterator488.next()).done);_iteratorNormalCompletion488=true){var j=_step488.value;if(!j._IsJumpthruEnabled())continue;if(this.TestOverlap(inst,j))if(all)ret.push(j);else{_C179.clearArray(tempCandidates);return j;}}}catch(err){_didIteratorError488=true;_iteratorError488=err;}finally{try{if(!_iteratorNormalCompletion488&&_iterator488["return"]!=null){_iterator488["return"]();}}finally{if(_didIteratorError488){throw _iteratorError488;}}}_C179.clearArray(tempCandidates);return ret;}},{key:"PushOut",value:function PushOut(inst,xdir,ydir,dist,otherInst){dist=dist||50;var wi=inst.GetWorldInfo();var oldX=wi.GetX();var oldY=wi.GetY();for(var i=0;i<dist;++i){wi.SetXY(oldX+xdir*i,oldY+ydir*i);wi.SetBboxChanged();if(!this.TestOverlap(inst,otherInst))return true;}wi.SetXY(oldX,oldY);wi.SetBboxChanged();return false;}},{key:"PushOutSolid",value:function PushOutSolid(inst,xdir,ydir,dist,includeJumpthrus,specificJumpthru){dist=dist||50;var wi=inst.GetWorldInfo();var oldX=wi.GetX();var oldY=wi.GetY();var lastOverlapped=null;var secondLastOverlapped=null;for(var i=0;i<dist;++i){wi.SetXY(oldX+xdir*i,oldY+ydir*i);wi.SetBboxChanged();if(!this.TestOverlap(inst,lastOverlapped)){lastOverlapped=this.TestOverlapSolid(inst);if(lastOverlapped)secondLastOverlapped=lastOverlapped;else{if(includeJumpthrus){if(specificJumpthru)lastOverlapped=this.TestOverlap(inst,specificJumpthru)?specificJumpthru:null;else lastOverlapped=this.TestOverlapJumpthru(inst);if(lastOverlapped)secondLastOverlapped=lastOverlapped;}if(!lastOverlapped){if(secondLastOverlapped)this.PushInFractional(inst,xdir,ydir,secondLastOverlapped,16,true);return true;}}}}wi.SetXY(oldX,oldY);wi.SetBboxChanged();return false;}},{key:"PushOutSolidAxis",value:function PushOutSolidAxis(inst,xdir,ydir,dist){dist=dist||50;var wi=inst.GetWorldInfo();var oldX=wi.GetX();var oldY=wi.GetY();var lastOverlapped=null;var secondLastOverlapped=null;for(var i=0;i<dist;++i){for(var which=0;which<2;++which){var sign=which*2-1;wi.SetXY(oldX+xdir*i*sign,oldY+ydir*i*sign);wi.SetBboxChanged();if(!this.TestOverlap(inst,lastOverlapped)){lastOverlapped=this.TestOverlapSolid(inst);if(lastOverlapped)secondLastOverlapped=lastOverlapped;else{if(secondLastOverlapped)this.PushInFractional(inst,xdir*sign,ydir*sign,secondLastOverlapped,16,true);return true;}}}}wi.SetXY(oldX,oldY);wi.SetBboxChanged();return false;}},{key:"PushInFractional",value:function PushInFractional(inst,xdir,ydir,otherInst,limit,includeAnySolid){var divisor=2;var forward=false;var overlapping=false;var wi=inst.GetWorldInfo();var bestX=wi.GetX();var bestY=wi.GetY();while(divisor<=limit){var frac=1/divisor;divisor*=2;wi.OffsetXY(xdir*frac*(forward?1:-1),ydir*frac*(forward?1:-1));wi.SetBboxChanged();if(this.TestOverlap(inst,otherInst)||includeAnySolid&&this.TestOverlapSolid(inst)){forward=true;overlapping=true;}else{forward=false;overlapping=false;bestX=wi.GetX();bestY=wi.GetY();}}if(overlapping){wi.SetXY(bestX,bestY);wi.SetBboxChanged();}}},{key:"PushOutSolidNearest",value:function PushOutSolidNearest(inst){var maxDist=arguments.length>1&&arguments[1]!==undefined?arguments[1]:100;var dist=0;var wi=inst.GetWorldInfo();var oldX=wi.GetX();var oldY=wi.GetY();var dir=0;var lastOverlapped=this.TestOverlapSolid(inst);if(!lastOverlapped)return true;while(dist<=maxDist){var dx=0;var dy=0;switch(dir){case 0:dx=0;dy=-1;dist++;break;case 1:dx=1;dy=-1;break;case 2:dx=1;dy=0;break;case 3:dx=1;dy=1;break;case 4:dx=0;dy=1;break;case 5:dx=-1;dy=1;break;case 6:dx=-1;dy=0;break;case 7:dx=-1;dy=-1;break;}dir=(dir+1)%8;wi.SetXY(Math.floor(oldX+dx*dist),Math.floor(oldY+dy*dist));wi.SetBboxChanged();if(!this.TestOverlap(inst,lastOverlapped)){lastOverlapped=this.TestOverlapSolid(inst);if(!lastOverlapped)return true;}}wi.SetXY(oldX,oldY);wi.SetBboxChanged();return false;}},{key:"CalculateBounceAngle",value:function CalculateBounceAngle(inst,startX,startY,otherInst){var wi=inst.GetWorldInfo();var oldX=wi.GetX();var oldY=wi.GetY();var radius=Math.max(10,_C179.distanceTo(startX,startY,oldX,oldY));var startAngle=_C179.angleTo(startX,startY,oldX,oldY);var firstInst=otherInst||this.TestOverlapSolid(inst);if(!firstInst)return _C179.clampAngle(startAngle+Math.PI);var curInst=firstInst;var anticlockwiseFreeAngle=0;var clockwiseFreeAngle=0;var increment=_C179.toRadians(5);var i;for(i=1;i<36;++i){var curAngle=startAngle-i*increment;wi.SetXY(startX+Math.cos(curAngle)*radius,startY+Math.sin(curAngle)*radius);wi.SetBboxChanged();if(!this.TestOverlap(inst,curInst)){curInst=otherInst?null:this.TestOverlapSolid(inst);if(!curInst){anticlockwiseFreeAngle=curAngle;break;}}}if(i===36)anticlockwiseFreeAngle=_C179.clampAngle(startAngle+Math.PI);curInst=firstInst;for(i=1;i<36;++i){var _curAngle=startAngle+i*increment;wi.SetXY(startX+Math.cos(_curAngle)*radius,startY+Math.sin(_curAngle)*radius);wi.SetBboxChanged();if(!this.TestOverlap(inst,curInst)){curInst=otherInst?null:this.TestOverlapSolid(inst);if(!curInst){clockwiseFreeAngle=_curAngle;break;}}}if(i===36)clockwiseFreeAngle=_C179.clampAngle(startAngle+Math.PI);wi.SetXY(oldX,oldY);wi.SetBboxChanged();if(clockwiseFreeAngle===anticlockwiseFreeAngle)return clockwiseFreeAngle;var halfDiff=_C179.angleDiff(clockwiseFreeAngle,anticlockwiseFreeAngle)/2;var normal;if(_C179.angleClockwise(clockwiseFreeAngle,anticlockwiseFreeAngle))normal=_C179.clampAngle(anticlockwiseFreeAngle+halfDiff+Math.PI);else normal=_C179.clampAngle(clockwiseFreeAngle+halfDiff);var vx=Math.cos(startAngle);var vy=Math.sin(startAngle);var nx=Math.cos(normal);var ny=Math.sin(normal);var v_dot_n=vx*nx+vy*ny;var rx=vx-2*v_dot_n*nx;var ry=vy-2*v_dot_n*ny;return _C179.angleTo(0,0,rx,ry);}},{key:"TestSegmentOverlap",value:function TestSegmentOverlap(x1,y1,x2,y2,inst){if(!inst)return false;var wi=inst.GetWorldInfo();if(!wi.IsCollisionEnabled())return false;this._collisionCheckCount++;_tempRect7.set(Math.min(x1,x2),Math.min(y1,y2),Math.max(x1,x2),Math.max(y1,y2));if(!wi.GetBoundingBox().intersectsRect(_tempRect7))return false;if(inst.HasTilemap())return this._TestSegmentOverlapTilemap(x1,y1,x2,y2,inst,wi);this._polyCheckCount++;if(!wi.GetBoundingQuad().intersectsSegment(x1,y1,x2,y2))return false;if(!wi.HasOwnCollisionPoly())return true;var poly=wi.GetTransformedCollisionPoly();return poly.intersectsSegment(wi.GetX(),wi.GetY(),x1,y1,x2,y2);}},{key:"_TestSegmentOverlapTilemap",value:function _TestSegmentOverlapTilemap(x1,y1,x2,y2,inst,wi){var tmX=wi.GetX();var tmY=wi.GetY();var sdkInst=inst.GetSdkInstance();var collRects=tileCollRectCandidates;_tempRect8.set(x1,y1,x2,y2);_tempRect8.normalize();sdkInst.GetCollisionRectCandidates(_tempRect8,collRects);for(var i=0,len=collRects.length;i<len;++i){var _c27=collRects[i];var tileRc=_c27.GetRect();this._collisionCheckCount++;if(_tempRect7.intersectsRectOffset(tileRc,tmX,tmY)){_tempQuad4.setFromRect(tileRc);_tempQuad4.offset(tmX,tmY);if(_tempQuad4.intersectsSegment(x1,y1,x2,y2)){var tilePoly=_c27.GetPoly();if(tilePoly){this._polyCheckCount++;if(tilePoly.intersectsSegment(tmX+tileRc.getLeft(),tmY+tileRc.getTop(),x1,y1,x2,y2)){_C179.clearArray(collRects);return true;}}else{_C179.clearArray(collRects);return true;}}}}_C179.clearArray(collRects);return false;}},{key:"TestRectOverlap",value:function TestRectOverlap(rect,inst){if(!inst)return false;var wi=inst.GetWorldInfo();if(!wi.IsCollisionEnabled())return false;this._collisionCheckCount++;if(!wi.GetBoundingBox().intersectsRect(rect))return false;if(inst.HasTilemap())return this._TestRectOverlapTilemap(rect,inst,wi);this._polyCheckCount++;_tempQuad4.setFromRect(rect);if(!wi.GetBoundingQuad().intersectsQuad(_tempQuad4))return false;if(!wi.HasOwnCollisionPoly())return true;var polyA=tempPolyA;polyA.setFromRect(rect,wi.GetX(),wi.GetY());var polyB=wi.GetTransformedCollisionPoly();return polyA.intersectsPoly(polyB,0,0);}},{key:"_TestRectOverlapTilemap",value:function _TestRectOverlapTilemap(rect,inst,wi){var tmX=wi.GetX();var tmY=wi.GetY();var sdkInst=inst.GetSdkInstance();var collRects=tileCollRectCandidates;sdkInst.GetCollisionRectCandidates(rect,collRects);for(var i=0,len=collRects.length;i<len;++i){var _c28=collRects[i];var tileRc=_c28.GetRect();this._collisionCheckCount++;if(rect.intersectsRectOffset(tileRc,tmX,tmY)){var tilePoly=_c28.GetPoly();if(tilePoly){this._polyCheckCount++;tempPolyA.setFromRect(rect,0,0);if(tilePoly.intersectsPoly(tempPolyA,-(tmX+tileRc.getLeft()),-(tmY+tileRc.getTop()))){_C179.clearArray(collRects);return true;}}else{_C179.clearArray(collRects);return true;}}}_C179.clearArray(collRects);return false;}},{key:"TestRayIntersectsInstance",value:function TestRayIntersectsInstance(inst,ray){if(!inst)return;var wi=inst.GetWorldInfo();if(!wi.IsCollisionEnabled())return;this._collisionCheckCount++;if(!wi.GetBoundingBox().intersectsRect(ray.rect))return;if(inst.HasTilemap()){this._TestRayIntersectsTilemap(inst,wi,ray);return;}this._polyCheckCount++;if(wi.HasOwnCollisionPoly())ray.TestInstancePoly(inst,wi.GetX(),wi.GetY(),wi.GetTransformedCollisionPoly());else ray.TestInstanceQuad(inst,wi.GetBoundingQuad());}},{key:"_TestRayIntersectsTilemap",value:function _TestRayIntersectsTilemap(inst,wi,ray){var xOffset=wi.GetX();var yOffset=wi.GetY();var collRects=tileCollRectCandidates;inst.GetSdkInstance().GetCollisionRectCandidates(ray.rect,collRects);for(var i=0,l=collRects.length;i<l;i++){var _c29=collRects[i];var tileRc=_c29.GetRect();this._collisionCheckCount++;if(ray.rect.intersectsRectOffset(tileRc,xOffset,yOffset)){var tilePoly=_c29.GetPoly();this._polyCheckCount++;if(tilePoly)ray.TestInstancePoly(inst,xOffset+tileRc.getLeft(),yOffset+tileRc.getTop(),tilePoly);else ray.TestInstanceRect(inst,wi.GetX(),wi.GetY(),tileRc);}}_C179.clearArray(collRects);}},{key:"SetCollisionCellSize",value:function SetCollisionCellSize(width,height){if(width===this._collisionCellWidth&&height===this._collisionCellHeight)return;this._collisionCellWidth=width;this._collisionCellHeight=height;var allObjectClasses=this._runtime.GetAllObjectClasses();var _iteratorNormalCompletion489=true;var _didIteratorError489=false;var _iteratorError489=undefined;try{for(var _iterator489=allObjectClasses[Symbol.iterator](),_step489;!(_iteratorNormalCompletion489=(_step489=_iterator489.next()).done);_iteratorNormalCompletion489=true){var objectClass=_step489.value;if(!objectClass.IsWorldType())continue;var _iteratorNormalCompletion490=true;var _didIteratorError490=false;var _iteratorError490=undefined;try{for(var _iterator490=objectClass.instancesIncludingPendingCreate()[Symbol.iterator](),_step490;!(_iteratorNormalCompletion490=(_step490=_iterator490.next()).done);_iteratorNormalCompletion490=true){var inst=_step490.value;inst.GetWorldInfo()._RemoveFromCollisionCells();}}catch(err){_didIteratorError490=true;_iteratorError490=err;}finally{try{if(!_iteratorNormalCompletion490&&_iterator490["return"]!=null){_iterator490["return"]();}}finally{if(_didIteratorError490){throw _iteratorError490;}}}objectClass._GetCollisionCellGrid().SetCellSize(width,height);objectClass._SetAnyCollisionCellChanged();var _iteratorNormalCompletion491=true;var _didIteratorError491=false;var _iteratorError491=undefined;try{for(var _iterator491=objectClass.instancesIncludingPendingCreate()[Symbol.iterator](),_step491;!(_iteratorNormalCompletion491=(_step491=_iterator491.next()).done);_iteratorNormalCompletion491=true){var _inst14=_step491.value;var wi=_inst14.GetWorldInfo();wi._SetCollisionCellChanged();wi._UpdateCollisionCell();}}catch(err){_didIteratorError491=true;_iteratorError491=err;}finally{try{if(!_iteratorNormalCompletion491&&_iterator491["return"]!=null){_iterator491["return"]();}}finally{if(_didIteratorError491){throw _iteratorError491;}}}}}catch(err){_didIteratorError489=true;_iteratorError489=err;}finally{try{if(!_iteratorNormalCompletion489&&_iterator489["return"]!=null){_iterator489["return"]();}}finally{if(_didIteratorError489){throw _iteratorError489;}}}}},{key:"GetCollisionCellSize",value:function GetCollisionCellSize(){return[this._collisionCellWidth,this._collisionCellHeight];}},{key:"_InitCollisionCellSize",value:function _InitCollisionCellSize(width,height){this._collisionCellWidth=width;this._collisionCellHeight=height;}}]);return CollisionEngine;}(_C179.DefendedBase);}// collisions/sparseGrid.js
{'use strict';var _C180=self.C3;_C180.SparseGrid=/*#__PURE__*/function(_C180$DefendedBase){_inherits(SparseGrid,_C180$DefendedBase);function SparseGrid(cellWidth,cellHeight){var _this151;_classCallCheck(this,SparseGrid);_this151=_possibleConstructorReturn(this,_getPrototypeOf(SparseGrid).call(this));_this151._cellWidth=cellWidth;_this151._cellHeight=cellHeight;_this151._cells=_C180.New(_C180.PairMap);return _this151;}_createClass(SparseGrid,[{key:"Release",value:function Release(){this._cells.Release();this._cells=null;}},{key:"SetCellSize",value:function SetCellSize(cellWidth,cellHeight){if(!this._cells.IsEmpty())throw new Error("grid not empty");this._cellWidth=cellWidth;this._cellHeight=cellHeight;}},{key:"GetCell",value:function GetCell(x,y,createIfMissing){var ret=this._cells.Get(x,y);if(ret)return ret;else if(createIfMissing){ret=_C180.New(_C180.GridCell,this,x,y);this._cells.Set(x,y,ret);return ret;}else return null;}},{key:"XToCell",value:function XToCell(x){var ret=Math.floor(x/this._cellWidth);return isFinite(ret)?ret:0;}},{key:"YToCell",value:function YToCell(y){var ret=Math.floor(y/this._cellHeight);return isFinite(ret)?ret:0;}},{key:"Update",value:function Update(inst,oldRange,newRange){if(oldRange)for(var x=oldRange.getLeft(),lenx=oldRange.getRight();x<=lenx;++x){for(var y=oldRange.getTop(),leny=oldRange.getBottom();y<=leny;++y){if(newRange&&newRange.containsPoint(x,y))continue;var cell=this.GetCell(x,y,false);if(!cell)continue;cell.Remove(inst);if(cell.IsEmpty())this._cells.Delete(x,y);}}if(newRange)for(var _x4=newRange.getLeft(),_lenx2=newRange.getRight();_x4<=_lenx2;++_x4){for(var _y3=newRange.getTop(),_leny2=newRange.getBottom();_y3<=_leny2;++_y3){if(oldRange&&oldRange.containsPoint(_x4,_y3))continue;this.GetCell(_x4,_y3,true).Insert(inst);}}}},{key:"QueryRange",value:function QueryRange(rc,result){var x=this.XToCell(rc.getLeft());var ystart=this.YToCell(rc.getTop());var lenx=this.XToCell(rc.getRight());var leny=this.YToCell(rc.getBottom());if(!isFinite(lenx)||!isFinite(leny))return;for(;x<=lenx;++x){for(var y=ystart;y<=leny;++y){var cell=this.GetCell(x,y,false);if(!cell)continue;cell.Dump(result);}}}}]);return SparseGrid;}(_C180.DefendedBase);}// collisions/gridCell.js
{'use strict';var _C181=self.C3;_C181.GridCell=/*#__PURE__*/function(_C181$DefendedBase){_inherits(GridCell,_C181$DefendedBase);function GridCell(grid,x,y){var _this152;_classCallCheck(this,GridCell);_this152=_possibleConstructorReturn(this,_getPrototypeOf(GridCell).call(this));_this152._grid=grid;_this152._x=x;_this152._y=y;_this152._instances=_C181.New(_C181.ArraySet);return _this152;}_createClass(GridCell,[{key:"Release",value:function Release(){this._instances.Release();this._instances=null;this._grid=null;}},{key:"IsEmpty",value:function IsEmpty(){return this._instances.IsEmpty();}},{key:"Insert",value:function Insert(inst){this._instances.Add(inst);}},{key:"Remove",value:function Remove(inst){this._instances.Delete(inst);}},{key:"Dump",value:function Dump(result){_C181.appendArray(result,this._instances.GetArray());}}]);return GridCell;}(_C181.DefendedBase);}// collisions/ray.js
{'use strict';var _C182=self.C3;var _PADDING=1E-6;var _NO_HIT=2;_C182.Ray=/*#__PURE__*/function(){function Ray(){_classCallCheck(this,Ray);this.x1=0;this.y1=0;this.x2=0;this.y2=0;this.dx=0;this.dy=0;this.rect=new _C182.Rect();this.hitFraction=_NO_HIT;this.hitUid=null;this.hitNormal=0;this.hitNormalDx=0;this.hitNormalDy=0;this.hitX=0;this.hitY=0;this.distance=0;this.normalX=1;this.normalY=0;this.reflectionX=1;this.reflectionY=0;}_createClass(Ray,[{key:"DidCollide",value:function DidCollide(){return this.hitFraction<1+_PADDING;}},{key:"Reset",value:function Reset(){this.hitFraction=_NO_HIT;}},{key:"Set",value:function Set(x1,y1,x2,y2){this.x1=x1;this.y1=y1;this.x2=x2;this.y2=y2;this.dx=x2-x1;this.dy=y2-y1;this.rect.set(x1,y1,x2,y2);this.rect.normalize();this.hitFraction=_NO_HIT;this.hitUid=null;this.hitNormal=0;this.hitNormalDx=0;this.hitNormalDy=0;this.hitX=0;this.hitY=0;this.distance=0;this.normalX=1;this.normalY=0;this.reflectionX=1;this.reflectionY=0;return this;}},{key:"Complete",value:function Complete(){if(this.DidCollide()===false)return;var dx=this.dx*this.hitFraction;var dy=this.dy*this.hitFraction;var length=Math.hypot(dx,dy);var dirx=dx/length;var diry=dy/length;this.distance=length-_PADDING;this.hitX=this.x1+dirx*this.distance;this.hitY=this.y1+diry*this.distance;this.hitNormal=Math.atan2(this.hitNormalDy,this.hitNormalDx)+Math.PI/2;this.normalX=Math.cos(this.hitNormal);this.normalY=Math.sin(this.hitNormal);var dot=dirx*this.normalX+diry*this.normalY;this.reflectionX=dirx-2*this.normalX*dot;this.reflectionY=diry-2*this.normalY*dot;if(dot>0){var PI=Math.PI;this.hitNormal=_C182.clampAngle(this.hitNormal+PI);this.normalX=-this.normalX;this.normalY=-this.normalY;}}},{key:"TestInstanceSegment",value:function TestInstanceSegment(inst,sx1,sy1,sx2,sy2){var t=_C182.rayIntersect(this.x1,this.y1,this.x2,this.y2,sx1,sy1,sx2,sy2);if(t>=0&&t<this.hitFraction){this.hitFraction=t;this.hitUid=inst.GetUID();this.hitNormalDx=sx1-sx2;this.hitNormalDy=sy1-sy2;}}},{key:"TestInstanceRect",value:function TestInstanceRect(inst,offX,offY,rect){var lt=offX+rect.getLeft(),rt=offX+rect.getRight(),tp=offY+rect.getTop(),bm=offY+rect.getBottom();this.TestInstanceSegment(inst,lt,tp,rt,tp);this.TestInstanceSegment(inst,rt,tp,rt,bm);this.TestInstanceSegment(inst,rt,bm,lt,bm);this.TestInstanceSegment(inst,lt,bm,lt,tp);}},{key:"TestInstanceQuad",value:function TestInstanceQuad(inst,quad){var tlX=quad.getTlx(),tlY=quad.getTly(),trX=quad.getTrx(),trY=quad.getTry(),brX=quad.getBrx(),brY=quad.getBry(),blX=quad.getBlx(),blY=quad.getBly();this.TestInstanceSegment(inst,tlX,tlY,trX,trY);this.TestInstanceSegment(inst,trX,trY,brX,brY);this.TestInstanceSegment(inst,brX,brY,blX,blY);this.TestInstanceSegment(inst,blX,blY,tlX,tlY);}},{key:"TestInstancePoly",value:function TestInstancePoly(inst,offX,offY,poly){var points=poly.pointsArr();for(var i=0,l=points.length;i<l;i+=2){var ii=(i+2)%l;var x1=points[i]+offX;var y1=points[i+1]+offY;var x2=points[ii]+offX;var y2=points[ii+1]+offY;this.TestInstanceSegment(inst,x1,y1,x2,y2);}}}]);return Ray;}();}// canvasManager.js
{'use strict';var _C183=self.C3;var VALID_FULLSCREEN_MODES=new Set(["off","crop","scale-inner","scale-outer","letterbox-scale","letterbox-integer-scale"]);var VALID_FULLSCREEN_SCALING_QUALITIES=new Set(["high","low"]);var _glMatrix11=self.glMatrix;var _mat9=_glMatrix11.mat4;var _vec13=_glMatrix11.vec3;var tempProjection=_mat9.create();var PERCENTTEXT_WIDTH=300;var PERCENTTEXT_HEIGHT=200;var PROGRESSBAR_WIDTH=120;var PROGRESSBAR_HEIGHT=8;var _tempQuad5=_C183.New(_C183.Quad);var _tempRect10=_C183.New(_C183.Rect);var SPLASH_MIN_DISPLAY_TIME=3E3;var SPLASH_AFTER_FADEOUT_WAIT_TIME=200;var SPLASH_FADE_DURATION=300;_C183.CanvasManager=/*#__PURE__*/function(_C183$DefendedBase){_inherits(CanvasManager,_C183$DefendedBase);function CanvasManager(runtime){var _this153;_classCallCheck(this,CanvasManager);_this153=_possibleConstructorReturn(this,_getPrototypeOf(CanvasManager).call(this));_this153._runtime=runtime;_this153._canvasLayers=[];_this153._isWebGPUEnabled=false;_this153._webglRenderer=null;_this153._webgpuRenderer=null;_this153._gpuPreference="high-performance";_this153._isLimitedToWebGL1=false;_this153._windowInnerWidth=0;_this153._windowInnerHeight=0;_this153._canvasCssWidth=0;_this153._canvasCssHeight=0;_this153._canvasDeviceWidth=0;_this153._canvasDeviceHeight=0;_this153._canvasCssOffsetX=0;_this153._canvasCssOffsetY=0;_this153._zAxisScale="normalized";_this153._fieldOfView=0;_this153._zNear=1;_this153._zFar=1E4;_this153._enableMipmaps=true;_this153._textureAnisotropy=0;_this153._drawWidth=0;_this153._drawHeight=0;_this153._fullscreenMode="letterbox-scale";_this153._documentFullscreenMode="letterbox-scale";_this153._deviceTransformOffX=0;_this153._deviceTransformOffY=0;_this153._defaultProjectionMatrix=_mat9.create();_this153._wantFullscreenScalingQuality="high";_this153._fullscreenScalingQuality=_this153._wantFullscreenScalingQuality;_this153._isDocumentFullscreen=false;_this153._availableAdditionalRenderTargets=[];_this153._usedAdditionalRenderTargets=new Set();_this153._shaderData=self["C3_Shaders"];_this153._effectChainManager=_C183.New(_C183.Gfx.EffectChainManager,{getDrawSize:function getDrawSize(){return[_this153.GetDrawWidth(),_this153.GetDrawHeight()];},getRenderTarget:function getRenderTarget(){return _this153.GetEffectCompositorRenderTarget();},releaseRenderTarget:function releaseRenderTarget(rt){return _this153.ReleaseEffectCompositorRenderTarget(rt);},getTime:function getTime(){return _this153.GetRuntime().GetGameTime();},redraw:function redraw(){return _this153.GetRuntime().UpdateRender();}});_this153._gpuTimeStartFrame=0;_this153._gpuTimeEndFrame=0;_this153._gpuLastUtilisation=NaN;_this153._gpuFrameTimingsBuffer=null;_this153._layersGpuProfile=new Map();_this153._gpuCurUtilisation=NaN;_this153._webgpuFrameTimings=new Map();_this153._snapshotFormat="";_this153._snapshotQuality=1;_this153._snapshotArea=_C183.New(_C183.Rect);_this153._snapshotUrl="";_this153._snapshotPromise=null;_this153._snapshotResolve=null;_this153._isPastingToDrawingCanvas=0;_this153._loaderStartTime=0;_this153._rafId=-1;_this153._loadingProgress=0;_this153._loadingprogress_handler=function(e){return _this153._loadingProgress=e.progress;};_this153._percentText=null;_this153._splashTextures={logo:null,powered:null,website:null};_this153._splashFrameNumber=0;_this153._splashFadeInFinishTime=0;_this153._splashFadeOutStartTime=0;_this153._splashState="fade-in";_this153._splashDoneResolve=null;_this153._splashDonePromise=new Promise(function(resolve){return _this153._splashDoneResolve=resolve;});return _this153;}_createClass(CanvasManager,[{key:"_SetGPUPowerPreference",value:function _SetGPUPowerPreference(pref){this._gpuPreference=pref;}},{key:"_SetWebGPUEnabled",value:function _SetWebGPUEnabled(e){this._isWebGPUEnabled=!!e;}},{key:"_SetZAxisScale",value:function _SetZAxisScale(s){this._zAxisScale=s;}},{key:"_SetFieldOfView",value:function _SetFieldOfView(f){this._fieldOfView=f;}},{key:"_SetZDistances",value:function _SetZDistances(zNear,zFar){this._zNear=zNear;this._zFar=zFar;}},{key:"_SetLimitedToWebGL1",value:function _SetLimitedToWebGL1(l){this._isLimitedToWebGL1=!!l;}},{key:"CreateCanvas",value:function CreateCanvas(opts){var _this154=this;var mainCanvas,useWebGPU,hasMajorPerformanceCaveat,renderer;return regeneratorRuntime.async(function CreateCanvas$(_context169){while(1){switch(_context169.prev=_context169.next){case 0:mainCanvas=opts["canvas"];this._canvasLayers.push({canvas:mainCanvas,ctx:null});this._runtime.AddDOMComponentMessageHandler("runtime","window-resize",function(e){return _this154._OnWindowResize(e);});this._runtime.AddDOMComponentMessageHandler("runtime","fullscreenchange",function(e){return _this154._OnFullscreenChange(e);});this._runtime.AddDOMComponentMessageHandler("runtime","fullscreenerror",function(e){return _this154._OnFullscreenError(e);});mainCanvas.addEventListener("webglcontextlost",function(e){return _this154._OnWebGLContextLost(e);});mainCanvas.addEventListener("webglcontextrestored",function(e){return _this154._OnWebGLContextRestored(e);});this._isDocumentFullscreen=!!opts["isFullscreen"];useWebGPU=navigator["gpu"]&&this._isWebGPUEnabled;hasMajorPerformanceCaveat=false;if(!useWebGPU){_context169.next=20;break;}_context169.prev=11;_context169.next=14;return regeneratorRuntime.awrap(this._InitWebGPUContext(true));case 14:_context169.next=20;break;case 16:_context169.prev=16;_context169.t0=_context169["catch"](11);this._MaybeLogRendererError("WebGPU",_context169.t0);this._webgpuRenderer=null;case 20:if(this.GetRenderer()){_context169.next=30;break;}_context169.prev=21;_context169.next=24;return regeneratorRuntime.awrap(this._InitWebGLContext(true));case 24:_context169.next=30;break;case 26:_context169.prev=26;_context169.t1=_context169["catch"](21);this._MaybeLogRendererError("WebGL",_context169.t1);this._webglRenderer=null;case 30:if(!this.GetRenderer())hasMajorPerformanceCaveat=true;if(!(!this.GetRenderer()&&useWebGPU)){_context169.next=41;break;}_context169.prev=32;_context169.next=35;return regeneratorRuntime.awrap(this._InitWebGPUContext(false));case 35:_context169.next=41;break;case 37:_context169.prev=37;_context169.t2=_context169["catch"](32);this._MaybeLogRendererError("WebGPU",_context169.t2);this._webgpuRenderer=null;case 41:if(this.GetRenderer()){_context169.next=51;break;}_context169.prev=42;_context169.next=45;return regeneratorRuntime.awrap(this._InitWebGLContext(false));case 45:_context169.next=51;break;case 47:_context169.prev=47;_context169.t3=_context169["catch"](42);this._MaybeLogRendererError("WebGL",_context169.t3);this._webglRenderer=null;case 51:renderer=this.GetRenderer();if(renderer){_context169.next=54;break;}throw new Error("failed to acquire a renderer - check WebGL or WebGPU is supported");case 54:renderer.SetHasMajorPerformanceCaveat(hasMajorPerformanceCaveat);if(this._webgpuRenderer){this._webgpuRenderer.ondevicelost=function(){return _this154._OnWebGPUDeviceLost();};this._webgpuRenderer.ondevicerestored=function(){return _this154._OnWebGPUDeviceRestored();};}if(this._zAxisScale==="normalized")renderer.SetZAxisScaleNormalized();else{renderer.SetZAxisScaleRegular();renderer.SetFovY(this._fieldOfView);}this.SetSize(opts["windowInnerWidth"],opts["windowInnerHeight"],true);_context169.next=60;return regeneratorRuntime.awrap(this._InitRenderer());case 60:case"end":return _context169.stop();}}},null,this,[[11,16],[21,26],[32,37],[42,47]]);}},{key:"_MaybeLogRendererError",value:function _MaybeLogRendererError(rendererType,err){if(err&&typeof err.message==="string"&&err.message.startsWith("renderer-unavailable"))return;console.error("Error creating ".concat(rendererType," renderer: "),err);}},{key:"_InitWebGPUContext",value:function _InitWebGPUContext(failIfMajorPerformanceCaveat){var ctorOpts,rendererOpts;return regeneratorRuntime.async(function _InitWebGPUContext$(_context170){while(1){switch(_context170.prev=_context170.next){case 0:ctorOpts={nearZ:this._zNear,farZ:this._zFar};rendererOpts={powerPreference:this._gpuPreference,depth:this._runtime.Uses3DFeatures(),failIfMajorPerformanceCaveat:failIfMajorPerformanceCaveat,usesBackgroundBlending:this._runtime.UsesAnyBackgroundBlending(),canSampleBackbuffer:this._runtime.UsesAnyCrossSampling(),canSampleDepth:this._runtime.UsesAnyDepthSampling()};this._webgpuRenderer=_C183.New(_C183.Gfx.WebGPURenderer,ctorOpts);_context170.next=5;return regeneratorRuntime.awrap(this._webgpuRenderer.Create(this._canvasLayers[0].canvas,rendererOpts));case 5:case"end":return _context170.stop();}}},null,this);}},{key:"_InitWebGLContext",value:function _InitWebGLContext(failIfMajorPerformanceCaveat){var rendererOpts;return regeneratorRuntime.async(function _InitWebGLContext$(_context171){while(1){switch(_context171.prev=_context171.next){case 0:rendererOpts={powerPreference:this._gpuPreference,enableGpuProfiling:true,depth:this._runtime.Uses3DFeatures(),canSampleDepth:this._runtime.UsesAnyDepthSampling(),failIfMajorPerformanceCaveat:failIfMajorPerformanceCaveat,nearZ:this._zNear,farZ:this._zFar};if(this._isLimitedToWebGL1)rendererOpts.maxWebGLVersion=1;if(_C183.Platform.OS==="Android"&&_C183.Platform.BrowserEngine==="Chromium"&&_C183.Platform.BrowserVersionNumber<75){console.warn("[Construct] Disabling WebGL 2 because this device appears to be affected by crbug.com/934823. Install software updates to avoid this.");rendererOpts.maxWebGLVersion=1;}if(this._runtime.GetCompositingMode()==="standard")rendererOpts.alpha=true;else{rendererOpts.alpha=false;rendererOpts.lowLatency=true;}this._webglRenderer=_C183.New(_C183.Gfx.WebGLRenderer,this._canvasLayers[0].canvas,rendererOpts);_context171.next=7;return regeneratorRuntime.awrap(this._webglRenderer.InitState());case 7:case"end":return _context171.stop();}}},null,this);}},{key:"_InitWebGPU",value:function _InitWebGPU(){var _promises3,_i62,_Object$entries18,_Object$entries18$_i,id,data,vertexSrc;return regeneratorRuntime.async(function _InitWebGPU$(_context172){while(1){switch(_context172.prev=_context172.next){case 0:if(!this._shaderData){_context172.next=5;break;}_promises3=[];for(_i62=0,_Object$entries18=Object.entries(this._shaderData);_i62<_Object$entries18.length;_i62++){_Object$entries18$_i=_slicedToArray(_Object$entries18[_i62],2),id=_Object$entries18$_i[0],data=_Object$entries18$_i[1];data.src=data.wgsl;vertexSrc=_C183.Gfx.WebGPUShaderProgram.GetDefaultVertexShaderSource();_promises3.push(this._webgpuRenderer.CreateShaderProgram(Object.assign({vertexSrc:vertexSrc,name:id},data)));}_context172.next=5;return regeneratorRuntime.awrap(Promise.all(_promises3));case 5:case"end":return _context172.stop();}}},null,this);}},{key:"_InitWebGL",value:function _InitWebGL(){var _promises4,_i63,_Object$entries19,_Object$entries19$_i,id,data,vertexSrc;return regeneratorRuntime.async(function _InitWebGL$(_context173){while(1){switch(_context173.prev=_context173.next){case 0:if(!this._shaderData){_context173.next=23;break;}_promises4=[];_i63=0,_Object$entries19=Object.entries(this._shaderData);case 3:if(!(_i63<_Object$entries19.length)){_context173.next=19;break;}_Object$entries19$_i=_slicedToArray(_Object$entries19[_i63],2),id=_Object$entries19$_i[0],data=_Object$entries19$_i[1];vertexSrc=void 0;if(!(data.glslWebGL2&&this._webglRenderer.GetWebGLVersionNumber()>=2)){_context173.next=11;break;}data.src=data.glslWebGL2;vertexSrc=_C183.Gfx.WebGLShaderProgram.GetDefaultVertexShaderSource_WebGL2();_context173.next=15;break;case 11:if(data.glsl){_context173.next=13;break;}throw new Error("shader '".concat(id,"' does not support WebGL 1"));case 13:data.src=data.glsl;vertexSrc=_C183.Gfx.WebGLShaderProgram.GetDefaultVertexShaderSource();case 15:_promises4.push(this._webglRenderer.CreateShaderProgram(Object.assign({vertexSrc:vertexSrc,name:id},data)));case 16:_i63++;_context173.next=3;break;case 19:_context173.next=21;return regeneratorRuntime.awrap(Promise.all(_promises4));case 21:this._webglRenderer.ResetLastProgram();this._webglRenderer.SetTextureFillMode();case 23:if(this._webglRenderer.SupportsGPUProfiling())this._gpuFrameTimingsBuffer=_C183.New(_C183.Gfx.WebGLQueryResultBuffer,this._webglRenderer);case 24:case"end":return _context173.stop();}}},null,this);}},{key:"_InitRenderer",value:function _InitRenderer(){var renderer,_iteratorNormalCompletion492,_didIteratorError492,_iteratorError492,_iterator492,_step492,_effectList2,_iteratorNormalCompletion493,_didIteratorError493,_iteratorError493,_iterator493,_step493,effectType;return regeneratorRuntime.async(function _InitRenderer$(_context174){while(1){switch(_context174.prev=_context174.next){case 0:if(!this._webgpuRenderer){_context174.next=5;break;}_context174.next=3;return regeneratorRuntime.awrap(this._InitWebGPU());case 3:_context174.next=8;break;case 5:if(!this._webglRenderer){_context174.next=8;break;}_context174.next=8;return regeneratorRuntime.awrap(this._InitWebGL());case 8:renderer=this.GetRenderer();renderer.SetMipmapsEnabled(this._enableMipmaps);if(renderer.SupportsGPUProfiling())this._gpuLastUtilisation=0;_iteratorNormalCompletion492=true;_didIteratorError492=false;_iteratorError492=undefined;_context174.prev=14;_iterator492=this._runtime._GetAllEffectLists()[Symbol.iterator]();case 16:if(_iteratorNormalCompletion492=(_step492=_iterator492.next()).done){_context174.next=42;break;}_effectList2=_step492.value;_iteratorNormalCompletion493=true;_didIteratorError493=false;_iteratorError493=undefined;_context174.prev=21;for(_iterator493=_effectList2.GetAllEffectTypes()[Symbol.iterator]();!(_iteratorNormalCompletion493=(_step493=_iterator493.next()).done);_iteratorNormalCompletion493=true){effectType=_step493.value;effectType._InitRenderer(renderer);}_context174.next=29;break;case 25:_context174.prev=25;_context174.t0=_context174["catch"](21);_didIteratorError493=true;_iteratorError493=_context174.t0;case 29:_context174.prev=29;_context174.prev=30;if(!_iteratorNormalCompletion493&&_iterator493["return"]!=null){_iterator493["return"]();}case 32:_context174.prev=32;if(!_didIteratorError493){_context174.next=35;break;}throw _iteratorError493;case 35:return _context174.finish(32);case 36:return _context174.finish(29);case 37:_effectList2._InitRenderer(renderer);_effectList2.UpdateActiveEffects();case 39:_iteratorNormalCompletion492=true;_context174.next=16;break;case 42:_context174.next=48;break;case 44:_context174.prev=44;_context174.t1=_context174["catch"](14);_didIteratorError492=true;_iteratorError492=_context174.t1;case 48:_context174.prev=48;_context174.prev=49;if(!_iteratorNormalCompletion492&&_iterator492["return"]!=null){_iterator492["return"]();}case 51:_context174.prev=51;if(!_didIteratorError492){_context174.next=54;break;}throw _iteratorError492;case 54:return _context174.finish(51);case 55:return _context174.finish(48);case 56:case"end":return _context174.stop();}}},null,this,[[14,44,48,56],[21,25,29,37],[30,,32,36],[49,,51,55]]);}},{key:"Release",value:function Release(){this._runtime=null;this._webglRenderer=null;this._canvasLayers.length=0;}},{key:"IsInWorker",value:function IsInWorker(){return this._runtime.IsInWorker();}},{key:"_OnWindowResize",value:function _OnWindowResize(e){var runtime=this._runtime;if(runtime.IsExportToVideo())return;var dpr=e["devicePixelRatio"];if(this.IsInWorker())self.devicePixelRatio=dpr;runtime._SetDevicePixelRatio(dpr);this._isDocumentFullscreen=!!e["isFullscreen"];this.SetSize(e["innerWidth"],e["innerHeight"]);runtime.UpdateRender();var ev=new _C183.Event("window-resize");ev.data=e;runtime.Dispatcher().dispatchEventAndWaitAsyncSequential(ev);var ev2=new _C183.Event("resize");ev2.cssWidth=this.GetCssWidth();ev2.cssHeight=this.GetCssHeight();ev2.deviceWidth=this.GetDeviceWidth();ev2.deviceHeight=this.GetDeviceHeight();runtime.DispatchUserScriptEvent(ev2);if(runtime.IsDebug()&&(runtime.HitBreakpoint()||self.C3Debugger.IsDebuggerPaused()))runtime.Render();}},{key:"_OnFullscreenChange",value:function _OnFullscreenChange(e){this._isDocumentFullscreen=!!e["isFullscreen"];this.SetSize(e["innerWidth"],e["innerHeight"],true);this._runtime.UpdateRender();}},{key:"_OnFullscreenError",value:function _OnFullscreenError(e){this._isDocumentFullscreen=!!e["isFullscreen"];this.SetSize(e["innerWidth"],e["innerHeight"],true);this._runtime.UpdateRender();}},{key:"SetSize",value:function SetSize(availableWidth,availableHeight){var force=arguments.length>2&&arguments[2]!==undefined?arguments[2]:false;availableWidth=Math.floor(availableWidth);availableHeight=Math.floor(availableHeight);if(availableWidth<=0||availableHeight<=0)throw new Error("invalid size");if(this._windowInnerWidth===availableWidth&&this._windowInnerHeight===availableHeight&&!force)return;this._windowInnerWidth=availableWidth;this._windowInnerHeight=availableHeight;var fullscreenMode=this.GetCurrentFullscreenMode();if(fullscreenMode==="letterbox-scale")this._CalculateLetterboxScale(availableWidth,availableHeight);else if(fullscreenMode==="letterbox-integer-scale")this._CalculateLetterboxIntegerScale(availableWidth,availableHeight);else if(fullscreenMode==="off")this._CalculateFixedSizeCanvas(availableWidth,availableHeight);else this._CalculateFullsizeCanvas(availableWidth,availableHeight);this._UpdateFullscreenScalingQuality(fullscreenMode);var _iteratorNormalCompletion494=true;var _didIteratorError494=false;var _iteratorError494=undefined;try{for(var _iterator494=this._canvasLayers[Symbol.iterator](),_step494;!(_iteratorNormalCompletion494=(_step494=_iterator494.next()).done);_iteratorNormalCompletion494=true){var canvas=_step494.value.canvas;canvas.width=this._canvasDeviceWidth;canvas.height=this._canvasDeviceHeight;}}catch(err){_didIteratorError494=true;_iteratorError494=err;}finally{try{if(!_iteratorNormalCompletion494&&_iterator494["return"]!=null){_iterator494["return"]();}}finally{if(_didIteratorError494){throw _iteratorError494;}}}this._runtime.PostComponentMessageToDOM("canvas","update-size",{"marginLeft":this._canvasCssOffsetX,"marginTop":this._canvasCssOffsetY,"styleWidth":this._canvasCssWidth,"styleHeight":this._canvasCssHeight,"displayScale":this.GetDisplayScale()});var renderer=this.GetRenderer();renderer.SetSize(this._canvasDeviceWidth,this._canvasDeviceHeight,true);var _iteratorNormalCompletion495=true;var _didIteratorError495=false;var _iteratorError495=undefined;try{for(var _iterator495=this._availableAdditionalRenderTargets[Symbol.iterator](),_step495;!(_iteratorNormalCompletion495=(_step495=_iterator495.next()).done);_iteratorNormalCompletion495=true){var rt=_step495.value;renderer.DeleteRenderTarget(rt);}}catch(err){_didIteratorError495=true;_iteratorError495=err;}finally{try{if(!_iteratorNormalCompletion495&&_iterator495["return"]!=null){_iterator495["return"]();}}finally{if(_didIteratorError495){throw _iteratorError495;}}}_C183.clearArray(this._availableAdditionalRenderTargets);renderer.CalculatePerspectiveMatrix(this._defaultProjectionMatrix,this.GetDrawWidth()/this.GetDrawHeight());var layoutManager=this._runtime.GetLayoutManager();layoutManager.SetAllLayerProjectionChanged();layoutManager.SetAllLayerMVChanged();}},{key:"GetDefaultProjectionMatrix",value:function GetDefaultProjectionMatrix(){return this._defaultProjectionMatrix;}},{key:"_CalculateLetterboxScale",value:function _CalculateLetterboxScale(availableWidth,availableHeight){var dpr=this._runtime.GetDevicePixelRatio();var originalViewportWidth=this._runtime.GetOriginalViewportWidth();var originalViewportHeight=this._runtime.GetOriginalViewportHeight();var originalAspectRatio=originalViewportWidth/originalViewportHeight;var availableAspectRatio=availableWidth/availableHeight;if(availableAspectRatio>originalAspectRatio){var letterboxedWidth=availableHeight*originalAspectRatio;this._canvasCssWidth=Math.round(letterboxedWidth);this._canvasCssHeight=availableHeight;this._canvasCssOffsetX=Math.floor((availableWidth-this._canvasCssWidth)/2);this._canvasCssOffsetY=0;}else{var letterboxedHeight=availableWidth/originalAspectRatio;this._canvasCssWidth=availableWidth;this._canvasCssHeight=Math.round(letterboxedHeight);this._canvasCssOffsetX=0;this._canvasCssOffsetY=Math.floor((availableHeight-this._canvasCssHeight)/2);}this._canvasDeviceWidth=Math.round(this._canvasCssWidth*dpr);this._canvasDeviceHeight=Math.round(this._canvasCssHeight*dpr);this._runtime.SetViewportSize(originalViewportWidth,originalViewportHeight);}},{key:"_CalculateLetterboxIntegerScale",value:function _CalculateLetterboxIntegerScale(availableWidth,availableHeight){var dpr=this._runtime.GetDevicePixelRatio();if(dpr!==1){availableWidth+=1;availableHeight+=1;}var originalViewportWidth=this._runtime.GetOriginalViewportWidth();var originalViewportHeight=this._runtime.GetOriginalViewportHeight();var originalAspectRatio=originalViewportWidth/originalViewportHeight;var availableAspectRatio=availableWidth/availableHeight;var intScale;if(availableAspectRatio>originalAspectRatio){var letterboxedWidth=availableHeight*originalAspectRatio;intScale=letterboxedWidth*dpr/originalViewportWidth;}else{var letterboxedHeight=availableWidth/originalAspectRatio;intScale=letterboxedHeight*dpr/originalViewportHeight;}if(intScale>1)intScale=Math.floor(intScale);else if(intScale<1)intScale=1/Math.ceil(1/intScale);this._canvasDeviceWidth=Math.round(originalViewportWidth*intScale);this._canvasDeviceHeight=Math.round(originalViewportHeight*intScale);this._canvasCssWidth=this._canvasDeviceWidth/dpr;this._canvasCssHeight=this._canvasDeviceHeight/dpr;this._canvasCssOffsetX=Math.max(Math.floor((availableWidth-this._canvasCssWidth)/2),0);this._canvasCssOffsetY=Math.max(Math.floor((availableHeight-this._canvasCssHeight)/2),0);this._runtime.SetViewportSize(originalViewportWidth,originalViewportHeight);}},{key:"_CalculateFullsizeCanvas",value:function _CalculateFullsizeCanvas(availableWidth,availableHeight){var dpr=this._runtime.GetDevicePixelRatio();this._canvasCssWidth=availableWidth;this._canvasCssHeight=availableHeight;this._canvasDeviceWidth=Math.round(this._canvasCssWidth*dpr);this._canvasDeviceHeight=Math.round(this._canvasCssHeight*dpr);this._canvasCssOffsetX=0;this._canvasCssOffsetY=0;var displayScale=this.GetDisplayScale();this._runtime.SetViewportSize(this._canvasCssWidth/displayScale,this._canvasCssHeight/displayScale);}},{key:"_CalculateFixedSizeCanvas",value:function _CalculateFixedSizeCanvas(availableWidth,availableHeight){var dpr=this._runtime.GetDevicePixelRatio();this._canvasCssWidth=this._runtime.GetViewportWidth();this._canvasCssHeight=this._runtime.GetViewportHeight();this._canvasDeviceWidth=Math.round(this._canvasCssWidth*dpr);this._canvasDeviceHeight=Math.round(this._canvasCssHeight*dpr);if(this.IsDocumentFullscreen()){this._canvasCssOffsetX=Math.floor((availableWidth-this._canvasCssWidth)/2);this._canvasCssOffsetY=Math.floor((availableHeight-this._canvasCssHeight)/2);}else{this._canvasCssOffsetX=0;this._canvasCssOffsetY=0;}this._runtime.SetViewportSize(this._runtime.GetViewportWidth(),this._runtime.GetViewportHeight());}},{key:"_UpdateFullscreenScalingQuality",value:function _UpdateFullscreenScalingQuality(fullscreenMode){if(this._wantFullscreenScalingQuality==="high"){this._drawWidth=this._canvasDeviceWidth;this._drawHeight=this._canvasDeviceHeight;this._fullscreenScalingQuality="high";}else{var viewportWidth,viewportHeight;if(this.GetCurrentFullscreenMode()==="off"){viewportWidth=this._runtime.GetViewportWidth();viewportHeight=this._runtime.GetViewportHeight();}else{viewportWidth=this._runtime.GetOriginalViewportWidth();viewportHeight=this._runtime.GetOriginalViewportHeight();}if(this._canvasDeviceWidth<viewportWidth||this._canvasDeviceHeight<viewportHeight){this._drawWidth=this._canvasDeviceWidth;this._drawHeight=this._canvasDeviceHeight;this._fullscreenScalingQuality="high";}else{this._drawWidth=viewportWidth;this._drawHeight=viewportHeight;this._fullscreenScalingQuality="low";if(fullscreenMode==="scale-inner"){var originalAspectRatio=viewportWidth/viewportHeight;var currentAspectRatio=this._windowInnerWidth/this._windowInnerHeight;if(currentAspectRatio<originalAspectRatio)this._drawWidth=this._drawHeight*currentAspectRatio;else if(currentAspectRatio>originalAspectRatio)this._drawHeight=this._drawWidth/currentAspectRatio;}else if(fullscreenMode==="scale-outer"){var _originalAspectRatio=viewportWidth/viewportHeight;var _currentAspectRatio=this._windowInnerWidth/this._windowInnerHeight;if(_currentAspectRatio>_originalAspectRatio)this._drawWidth=this._drawHeight*_currentAspectRatio;else if(_currentAspectRatio<_originalAspectRatio)this._drawHeight=this._drawWidth/_currentAspectRatio;}}}}},{key:"GetRuntime",value:function GetRuntime(){return this._runtime;}},{key:"GetMainCanvas",value:function GetMainCanvas(){return this._canvasLayers[0].canvas;}},{key:"GetEffectChainManager",value:function GetEffectChainManager(){return this._effectChainManager;}},{key:"IsDocumentFullscreen",value:function IsDocumentFullscreen(){return this._isDocumentFullscreen;}},{key:"SetFullscreenMode",value:function SetFullscreenMode(m){if(!VALID_FULLSCREEN_MODES.has(m))throw new Error("invalid fullscreen mode");this._fullscreenMode=m;var layoutManager=this._runtime.GetLayoutManager();layoutManager.SetAllLayerProjectionChanged();layoutManager.SetAllLayerMVChanged();}},{key:"GetFullscreenMode",value:function GetFullscreenMode(){return this._fullscreenMode;}},{key:"SetDocumentFullscreenMode",value:function SetDocumentFullscreenMode(m){if(!VALID_FULLSCREEN_MODES.has(m))throw new Error("invalid fullscreen mode");this._documentFullscreenMode=m;var layoutManager=this._runtime.GetLayoutManager();layoutManager.SetAllLayerProjectionChanged();layoutManager.SetAllLayerMVChanged();}},{key:"GetDocumentFullscreenMode",value:function GetDocumentFullscreenMode(){return this._documentFullscreenMode;}},{key:"GetCurrentFullscreenMode",value:function GetCurrentFullscreenMode(){if(this.IsDocumentFullscreen())return this.GetDocumentFullscreenMode();else return this.GetFullscreenMode();}},{key:"SetFullscreenScalingQuality",value:function SetFullscreenScalingQuality(q){if(!VALID_FULLSCREEN_SCALING_QUALITIES.has(q))throw new Error("invalid fullscreen scaling quality");this._wantFullscreenScalingQuality=q;this._runtime.GetLayoutManager().SetAllLayerProjectionChanged();}},{key:"GetSetFullscreenScalingQuality",value:function GetSetFullscreenScalingQuality(){return this._wantFullscreenScalingQuality;}},{key:"GetCurrentFullscreenScalingQuality",value:function GetCurrentFullscreenScalingQuality(){return this._fullscreenScalingQuality;}},{key:"GetLastWidth",value:function GetLastWidth(){return this._windowInnerWidth;}},{key:"GetLastHeight",value:function GetLastHeight(){return this._windowInnerHeight;}},{key:"GetDrawWidth",value:function GetDrawWidth(){return this._drawWidth;}},{key:"GetDrawHeight",value:function GetDrawHeight(){return this._drawHeight;}},{key:"SetMipmapsEnabled",value:function SetMipmapsEnabled(e){this._enableMipmaps=!!e;}},{key:"_SetTextureAnisotropy",value:function _SetTextureAnisotropy(a){this._textureAnisotropy=a;}},{key:"GetTextureAnisotropy",value:function GetTextureAnisotropy(){return this._textureAnisotropy;}},{key:"IsRendererContextLost",value:function IsRendererContextLost(){return this.GetRenderer().IsContextLost();}},{key:"_OnWebGLContextLost",value:function _OnWebGLContextLost(e){console.log("[Construct] WebGL context lost");e.preventDefault();this._availableAdditionalRenderTargets=[];this._usedAdditionalRenderTargets.clear();this._effectChainManager.OnContextLost();this._webglRenderer.OnContextLost();this._runtime._OnRendererContextLost();}},{key:"_OnWebGPUDeviceLost",value:function _OnWebGPUDeviceLost(){console.log("[Construct] WebGPU device lost");this._availableAdditionalRenderTargets=[];this._usedAdditionalRenderTargets.clear();this._effectChainManager.OnContextLost();this._runtime._OnRendererContextLost();}},{key:"_OnWebGLContextRestored",value:function _OnWebGLContextRestored(e){return regeneratorRuntime.async(function _OnWebGLContextRestored$(_context175){while(1){switch(_context175.prev=_context175.next){case 0:_context175.next=2;return regeneratorRuntime.awrap(this._webglRenderer.OnContextRestored());case 2:_context175.next=4;return regeneratorRuntime.awrap(this._InitRenderer());case 4:_context175.next=6;return regeneratorRuntime.awrap(this._runtime._OnRendererContextRestored());case 6:console.log("[Construct] WebGL context restored");case 7:case"end":return _context175.stop();}}},null,this);}},{key:"_OnWebGPUDeviceRestored",value:function _OnWebGPUDeviceRestored(){return regeneratorRuntime.async(function _OnWebGPUDeviceRestored$(_context176){while(1){switch(_context176.prev=_context176.next){case 0:_context176.next=2;return regeneratorRuntime.awrap(this._InitRenderer());case 2:_context176.next=4;return regeneratorRuntime.awrap(this._runtime._OnRendererContextRestored());case 4:console.log("[Construct] WebGPU device restored");case 5:case"end":return _context176.stop();}}},null,this);}},{key:"GetWebGLRenderer",value:function GetWebGLRenderer(){return this._webglRenderer;}},{key:"GetWebGPURenderer",value:function GetWebGPURenderer(){return this._webgpuRenderer;}},{key:"GetRenderer",value:function GetRenderer(){return this._webgpuRenderer||this._webglRenderer;}},{key:"GetRenderScale",value:function GetRenderScale(){if(this._fullscreenScalingQuality==="low")return 1/this._runtime.GetDevicePixelRatio();return this.GetDisplayScale();}},{key:"GetDisplayScale",value:function GetDisplayScale(){var fullscreenMode=this.GetCurrentFullscreenMode();if(fullscreenMode==="off"||fullscreenMode==="crop")return 1;var originalViewportWidth=this._runtime.GetOriginalViewportWidth();var originalViewportHeight=this._runtime.GetOriginalViewportHeight();var originalAspectRatio=originalViewportWidth/originalViewportHeight;var currentAspectRatio=this._canvasDeviceWidth/this._canvasDeviceHeight;if(fullscreenMode!=="scale-inner"&&currentAspectRatio>originalAspectRatio||fullscreenMode==="scale-inner"&&currentAspectRatio<originalAspectRatio)return this._canvasCssHeight/originalViewportHeight;else return this._canvasCssWidth/originalViewportWidth;}},{key:"GetEffectLayerScaleParam",value:function GetEffectLayerScaleParam(){if(this.GetCurrentFullscreenScalingQuality()==="low")return 1;else return this.GetDisplayScale();}},{key:"GetEffectDevicePixelRatioParam",value:function GetEffectDevicePixelRatioParam(){if(this.GetCurrentFullscreenScalingQuality()==="low")return 1;else return this._runtime.GetDevicePixelRatio();}},{key:"SetDeviceTransformOffset",value:function SetDeviceTransformOffset(x,y){this._deviceTransformOffX=x;this._deviceTransformOffY=y;}},{key:"SetDeviceTransform",value:function SetDeviceTransform(renderer,w,h){var updateProjection=arguments.length>3&&arguments[3]!==undefined?arguments[3]:true;w=w||this._drawWidth;h=h||this._drawHeight;var scrollX=w/2+this._deviceTransformOffX;var scrollY=h/2+this._deviceTransformOffY;if(updateProjection){var projectionMatrix=this.GetDefaultProjectionMatrix();if(w!==this._drawWidth||h!==this._drawHeight){renderer.CalculatePerspectiveMatrix(tempProjection,w/h);projectionMatrix=tempProjection;}renderer.SetProjectionMatrix(projectionMatrix);}var tempMat4=renderer.CalculateLookAtModelView2(scrollX,scrollY,renderer.GetDefaultCameraZ(h),scrollX,scrollY,0,h);renderer.SetModelViewMatrix(tempMat4);}},{key:"SetCssTransform",value:function SetCssTransform(renderer){var updateProjection=arguments.length>1&&arguments[1]!==undefined?arguments[1]:true;var width=this.GetCssWidth();var height=this.GetCssHeight();var scrollX=width/2;var scrollY=height/2;if(updateProjection)renderer.SetProjectionMatrix(this.GetDefaultProjectionMatrix());var tempMat4=renderer.CalculateLookAtModelView2(scrollX,scrollY,renderer.GetDefaultCameraZ(height),scrollX,scrollY,0,height);renderer.SetModelViewMatrix(tempMat4);}},{key:"GetDeviceWidth",value:function GetDeviceWidth(){return this._canvasDeviceWidth;}},{key:"GetDeviceHeight",value:function GetDeviceHeight(){return this._canvasDeviceHeight;}},{key:"GetCssWidth",value:function GetCssWidth(){return this._canvasCssWidth;}},{key:"GetCssHeight",value:function GetCssHeight(){return this._canvasCssHeight;}},{key:"GetCanvasClientX",value:function GetCanvasClientX(){return this._canvasCssOffsetX;}},{key:"GetCanvasClientY",value:function GetCanvasClientY(){return this._canvasCssOffsetY;}},{key:"GetHTMLLayerCount",value:function GetHTMLLayerCount(){return this._canvasLayers.length;}},{key:"SetHTMLLayerCount",value:function SetHTMLLayerCount(c){var immediate,message,result,_iteratorNormalCompletion496,_didIteratorError496,_iteratorError496,_iterator496,_step496,canvas,contextName,ctx,_args188=arguments;return regeneratorRuntime.async(function SetHTMLLayerCount$(_context177){while(1){switch(_context177.prev=_context177.next){case 0:immediate=_args188.length>1&&_args188[1]!==undefined?_args188[1]:false;if(!(c<1)){_context177.next=3;break;}throw new Error("invalid HTML layer count");case 3:if(!(this._canvasLayers.length===c)){_context177.next=5;break;}return _context177.abrupt("return");case 5:message={"count":c,"immediate":immediate,"marginLeft":this._canvasCssOffsetX,"marginTop":this._canvasCssOffsetY,"styleWidth":this._canvasCssWidth,"styleHeight":this._canvasCssHeight};if(!this.IsInWorker()){_context177.next=12;break;}_context177.next=9;return regeneratorRuntime.awrap(this._runtime.PostComponentMessageToDOMAsync("canvas","set-html-layer-count",message));case 9:result=_context177.sent;_context177.next=13;break;case 12:result=self["c3_runtimeInterface"]["_OnSetHTMLLayerCount"](message);case 13:if(!(c<this._canvasLayers.length)){_context177.next=17;break;}this._canvasLayers.length=c;_context177.next=48;break;case 17:_iteratorNormalCompletion496=true;_didIteratorError496=false;_iteratorError496=undefined;_context177.prev=20;_iterator496=result["addedCanvases"][Symbol.iterator]();case 22:if(_iteratorNormalCompletion496=(_step496=_iterator496.next()).done){_context177.next=34;break;}canvas=_step496.value;canvas.width=this._canvasDeviceWidth;canvas.height=this._canvasDeviceHeight;contextName="2d";ctx=canvas.getContext(contextName);if(ctx){_context177.next=30;break;}throw new Error("failed to acquire '".concat(contextName,"' canvas context"));case 30:this._canvasLayers.push({canvas:canvas,ctx:ctx});case 31:_iteratorNormalCompletion496=true;_context177.next=22;break;case 34:_context177.next=40;break;case 36:_context177.prev=36;_context177.t0=_context177["catch"](20);_didIteratorError496=true;_iteratorError496=_context177.t0;case 40:_context177.prev=40;_context177.prev=41;if(!_iteratorNormalCompletion496&&_iterator496["return"]!=null){_iterator496["return"]();}case 43:_context177.prev=43;if(!_didIteratorError496){_context177.next=46;break;}throw _iteratorError496;case 46:return _context177.finish(43);case 47:return _context177.finish(40);case 48:this._runtime.UpdateRender();case 49:case"end":return _context177.stop();}}},null,this,[[20,36,40,48],[41,,43,47]]);}},{key:"BlitMainCanvasToHTMLLayerCanvas",value:function BlitMainCanvasToHTMLLayerCanvas(htmlIndex){if(htmlIndex>=this._canvasLayers.length)return;var mainCanvas=this.GetMainCanvas();var destCtx=this._canvasLayers[htmlIndex].ctx;destCtx.globalCompositeOperation="copy";destCtx.drawImage(mainCanvas,0,0);}},{key:"GetAdditionalRenderTarget",value:function GetAdditionalRenderTarget(opts){opts.depth=this._runtime.Uses3DFeatures();var arr=this._availableAdditionalRenderTargets;var useIndex=arr.findIndex(function(rt){return rt.IsCompatibleWithOptions(opts);});var ret;if(useIndex!==-1){ret=arr[useIndex];arr.splice(useIndex,1);}else ret=this.GetRenderer().CreateRenderTarget(opts);this._usedAdditionalRenderTargets.add(ret);return ret;}},{key:"ReleaseAdditionalRenderTarget",value:function ReleaseAdditionalRenderTarget(renderTarget){if(!this._usedAdditionalRenderTargets.has(renderTarget))throw new Error("render target not in use");this._usedAdditionalRenderTargets["delete"](renderTarget);this._availableAdditionalRenderTargets.push(renderTarget);}},{key:"GetEffectCompositorRenderTarget",value:function GetEffectCompositorRenderTarget(){var opts={sampling:this._runtime.GetSampling()};if(this.GetCurrentFullscreenScalingQuality()==="low"){opts.width=this.GetDrawWidth();opts.height=this.GetDrawHeight();}return this.GetAdditionalRenderTarget(opts);}},{key:"ReleaseEffectCompositorRenderTarget",value:function ReleaseEffectCompositorRenderTarget(renderTarget){this.ReleaseAdditionalRenderTarget(renderTarget);}},{key:"activeLayersGpuProfiles",value:/*#__PURE__*/regeneratorRuntime.mark(function activeLayersGpuProfiles(){var _iteratorNormalCompletion497,_didIteratorError497,_iteratorError497,_iterator497,_step497,layout,_iteratorNormalCompletion498,_didIteratorError498,_iteratorError498,_iterator498,_step498,layer,p;return regeneratorRuntime.wrap(function activeLayersGpuProfiles$(_context178){while(1){switch(_context178.prev=_context178.next){case 0:_iteratorNormalCompletion497=true;_didIteratorError497=false;_iteratorError497=undefined;_context178.prev=3;_iterator497=this._runtime.GetLayoutManager().runningLayouts()[Symbol.iterator]();case 5:if(_iteratorNormalCompletion497=(_step497=_iterator497.next()).done){_context178.next=38;break;}layout=_step497.value;_iteratorNormalCompletion498=true;_didIteratorError498=false;_iteratorError498=undefined;_context178.prev=10;_iterator498=layout.GetLayers()[Symbol.iterator]();case 12:if(_iteratorNormalCompletion498=(_step498=_iterator498.next()).done){_context178.next=21;break;}layer=_step498.value;p=this._layersGpuProfile.get(layer);if(!p){_context178.next=18;break;}_context178.next=18;return p;case 18:_iteratorNormalCompletion498=true;_context178.next=12;break;case 21:_context178.next=27;break;case 23:_context178.prev=23;_context178.t0=_context178["catch"](10);_didIteratorError498=true;_iteratorError498=_context178.t0;case 27:_context178.prev=27;_context178.prev=28;if(!_iteratorNormalCompletion498&&_iterator498["return"]!=null){_iterator498["return"]();}case 30:_context178.prev=30;if(!_didIteratorError498){_context178.next=33;break;}throw _iteratorError498;case 33:return _context178.finish(30);case 34:return _context178.finish(27);case 35:_iteratorNormalCompletion497=true;_context178.next=5;break;case 38:_context178.next=44;break;case 40:_context178.prev=40;_context178.t1=_context178["catch"](3);_didIteratorError497=true;_iteratorError497=_context178.t1;case 44:_context178.prev=44;_context178.prev=45;if(!_iteratorNormalCompletion497&&_iterator497["return"]!=null){_iterator497["return"]();}case 47:_context178.prev=47;if(!_didIteratorError497){_context178.next=50;break;}throw _iteratorError497;case 50:return _context178.finish(47);case 51:return _context178.finish(44);case 52:case"end":return _context178.stop();}}},activeLayersGpuProfiles,this,[[3,40,44,52],[10,23,27,35],[28,,30,34],[45,,47,51]]);})},{key:"GetLayerTimingsBuffer",value:function GetLayerTimingsBuffer(layer){if(!this.GetRenderer().SupportsGPUProfiling())return null;var p=this._layersGpuProfile.get(layer);if(!p){p={name:layer.GetName(),timingsBuffer:_C183.New(_C183.Gfx.WebGLQueryResultBuffer,this._webglRenderer),curUtilisation:0,lastUtilisation:0};this._layersGpuProfile.set(layer,p);}return p.timingsBuffer;}},{key:"_Update1sFrameRange",value:function _Update1sFrameRange(){var renderer=this.GetRenderer();if(!renderer.SupportsGPUProfiling())return;if(this._gpuTimeEndFrame===0){this._gpuTimeEndFrame=renderer.GetFrameNumber();this._gpuCurUtilisation=NaN;var _iteratorNormalCompletion499=true;var _didIteratorError499=false;var _iteratorError499=undefined;try{for(var _iterator499=this.activeLayersGpuProfiles()[Symbol.iterator](),_step499;!(_iteratorNormalCompletion499=(_step499=_iterator499.next()).done);_iteratorNormalCompletion499=true){var p=_step499.value;p.curUtilisation=NaN;}}catch(err){_didIteratorError499=true;_iteratorError499=err;}finally{try{if(!_iteratorNormalCompletion499&&_iterator499["return"]!=null){_iterator499["return"]();}}finally{if(_didIteratorError499){throw _iteratorError499;}}}}}},{key:"_UpdateTick",value:function _UpdateTick(){if(this._webglRenderer&&this._webglRenderer.SupportsGPUProfiling())this._UpdateTick_WebGL();if(this._webgpuRenderer&&this._webgpuRenderer.SupportsGPUProfiling())this._UpdateTick_WebGPU();}},{key:"_UpdateTick_WebGL",value:function _UpdateTick_WebGL(){if(!isNaN(this._gpuCurUtilisation))return;this._gpuCurUtilisation=this._gpuFrameTimingsBuffer.GetFrameRangeResultSum(this._gpuTimeStartFrame,this._gpuTimeEndFrame);if(isNaN(this._gpuCurUtilisation))return;if(this._runtime.IsDebug()){var _iteratorNormalCompletion500=true;var _didIteratorError500=false;var _iteratorError500=undefined;try{for(var _iterator500=this.activeLayersGpuProfiles()[Symbol.iterator](),_step500;!(_iteratorNormalCompletion500=(_step500=_iterator500.next()).done);_iteratorNormalCompletion500=true){var p=_step500.value;p.curUtilisation=p.timingsBuffer.GetFrameRangeResultSum(this._gpuTimeStartFrame,this._gpuTimeEndFrame);if(isNaN(p.curUtilisation))return;}}catch(err){_didIteratorError500=true;_iteratorError500=err;}finally{try{if(!_iteratorNormalCompletion500&&_iterator500["return"]!=null){_iterator500["return"]();}}finally{if(_didIteratorError500){throw _iteratorError500;}}}}this._gpuFrameTimingsBuffer.DeleteAllBeforeFrameNumber(this._gpuTimeEndFrame);this._gpuLastUtilisation=Math.min(this._gpuCurUtilisation,1);if(this._runtime.IsDebug()){var _iteratorNormalCompletion501=true;var _didIteratorError501=false;var _iteratorError501=undefined;try{for(var _iterator501=this.activeLayersGpuProfiles()[Symbol.iterator](),_step501;!(_iteratorNormalCompletion501=(_step501=_iterator501.next()).done);_iteratorNormalCompletion501=true){var _p7=_step501.value;_p7.timingsBuffer.DeleteAllBeforeFrameNumber(this._gpuTimeEndFrame);_p7.lastUtilisation=Math.min(_p7.curUtilisation,1);}}catch(err){_didIteratorError501=true;_iteratorError501=err;}finally{try{if(!_iteratorNormalCompletion501&&_iterator501["return"]!=null){_iterator501["return"]();}}finally{if(_didIteratorError501){throw _iteratorError501;}}}self.C3Debugger.UpdateGPUProfile(this._gpuLastUtilisation,_toConsumableArray(this.activeLayersGpuProfiles()));}this._gpuTimeStartFrame=this._gpuTimeEndFrame;this._gpuTimeEndFrame=0;}},{key:"GetGPUFrameTimingsBuffer",value:function GetGPUFrameTimingsBuffer(){return this._gpuFrameTimingsBuffer;}},{key:"_UpdateTick_WebGPU",value:function _UpdateTick_WebGPU(){if(this._gpuTimeEndFrame===0)return;for(var frameNumber=this._gpuTimeStartFrame;frameNumber<this._gpuTimeEndFrame;++frameNumber){var frameTiming=this._webgpuFrameTimings.get(frameNumber);if(frameTiming&&!frameTiming.HasResult())return;}var layout=this._runtime.GetMainRunningLayout();var profileResults=_C183.MakeFilledArray(layout.GetLayerCount()+1,0);for(var _frameNumber=this._gpuTimeStartFrame;_frameNumber<this._gpuTimeEndFrame;++_frameNumber){var _frameTiming=this._webgpuFrameTimings.get(_frameNumber);if(!_frameTiming)continue;var _results14=_frameTiming.GetResult();for(var i=0,len=Math.min(profileResults.length,_results14.length/2);i<len;++i){var start64=_results14[i*2];var end64=_results14[i*2+1];if(Number(start64)===0||Number(end64)===0){profileResults[i]=NaN;continue;}var diff64=end64-start64;var duration=Number(diff64)/1E9;profileResults[i]+=duration;}}this._gpuLastUtilisation=_C183.clamp(profileResults[0],0,1);if(this._runtime.IsDebug()){var layerProfiles=[];var layers=layout.GetLayers();for(var _i64=0,_len55=Math.min(layers.length,profileResults.length-1);_i64<_len55;++_i64){layerProfiles.push({name:layers[_i64].GetName(),lastUtilisation:_C183.clamp(profileResults[_i64+1],0,1)});}self.C3Debugger.UpdateGPUProfile(this._gpuLastUtilisation,layerProfiles);}for(var _frameNumber2=this._gpuTimeStartFrame;_frameNumber2<this._gpuTimeEndFrame;++_frameNumber2){this._webgpuFrameTimings["delete"](_frameNumber2);}this._gpuTimeStartFrame=this._gpuTimeEndFrame;this._gpuTimeEndFrame=0;}},{key:"_AddWebGPUFrameTiming",value:function _AddWebGPUFrameTiming(frameTiming){this._webgpuFrameTimings.set(this._webgpuRenderer.GetFrameNumber(),frameTiming);}},{key:"GetGPUUtilisation",value:function GetGPUUtilisation(){return this._gpuLastUtilisation;}},{key:"SnapshotCanvas",value:function SnapshotCanvas(format,quality,x,y,width,height){var _this155=this;this._snapshotFormat=format;this._snapshotQuality=quality;this._snapshotArea.setWH(x,y,width,height);if(this._snapshotPromise)return this._snapshotPromise;this._snapshotPromise=new Promise(function(resolve){_this155._snapshotResolve=resolve;});return this._snapshotPromise;}},{key:"_MaybeTakeSnapshot",value:function _MaybeTakeSnapshot(){var _this156=this;if(!this._snapshotFormat)return;var canvas=this.GetMainCanvas();var snapArea=this._snapshotArea;var x=_C183.clamp(Math.floor(snapArea.getLeft()),0,canvas.width);var y=_C183.clamp(Math.floor(snapArea.getTop()),0,canvas.height);var w=snapArea.width();if(w===0)w=canvas.width-x;else w=_C183.clamp(Math.floor(w),0,canvas.width-x);var h=snapArea.height();if(h===0)h=canvas.height-y;else h=_C183.clamp(Math.floor(h),0,canvas.height-y);if((x!==0||y!==0||w!==canvas.width||h!==canvas.height)&&w>0&&h>0){var cropCanvas=_C183.CreateCanvas(w,h);var ctx=cropCanvas.getContext("2d");ctx.drawImage(canvas,x,y,w,h,0,0,w,h);canvas=cropCanvas;}_C183.CanvasToBlob(canvas,this._snapshotFormat,this._snapshotQuality).then(function(blob){if(_this156._snapshotUrl)URL.revokeObjectURL(_this156._snapshotUrl);_this156._snapshotUrl=URL.createObjectURL(blob);_this156._snapshotPromise=null;_this156._snapshotResolve(_this156._snapshotUrl);});this._snapshotFormat="";this._snapshotQuality=1;}},{key:"GetCanvasSnapshotUrl",value:function GetCanvasSnapshotUrl(){return this._snapshotUrl;}},{key:"SetIsPastingToDrawingCanvas",value:function SetIsPastingToDrawingCanvas(p){if(p)this._isPastingToDrawingCanvas++;else this._isPastingToDrawingCanvas--;}},{key:"IsPastingToDrawingCanvas",value:function IsPastingToDrawingCanvas(){return this._isPastingToDrawingCanvas>0;}},{key:"InitLoadingScreen",value:function InitLoadingScreen(loaderStyle){var _this157=this;var renderer=this.GetRenderer();if(loaderStyle===2){this._percentText=_C183.New(_C183.Gfx.RendererText,this.GetRenderer());this._percentText.SetFontName("Arial");this._percentText.SetFontSize(16);this._percentText.SetHorizontalAlignment("center");this._percentText.SetVerticalAlignment("center");this._percentText.SetSize(PERCENTTEXT_WIDTH,PERCENTTEXT_HEIGHT);}else if(loaderStyle===0){var loadingLogoAsset=this._runtime.GetLoadingLogoAsset();if(loadingLogoAsset)loadingLogoAsset.LoadStaticTexture(renderer)["catch"](function(err){return console.warn("[C3 runtime] Failed to create texture for loading logo: ",err);});}else if(loaderStyle===4){this._LoadSvgSplashImage("data:image/svg+xml;base64,PD94bWwgdmVyc2lvbj0iMS4wIiBlbmNvZGluZz0idXRmLTgiPz4NCjwhLS0gR2VuZXJhdG9yOiBBZG9iZSBJbGx1c3RyYXRvciAxNi4wLjAsIFNWRyBFeHBvcnQgUGx1Zy1JbiAuIFNWRyBWZXJzaW9uOiA2LjAwIEJ1aWxkIDApICAtLT4NCjwhRE9DVFlQRSBzdmcgUFVCTElDICItLy9XM0MvL0RURCBTVkcgMS4xLy9FTiIgImh0dHA6Ly93d3cudzMub3JnL0dyYXBoaWNzL1NWRy8xLjEvRFREL3N2ZzExLmR0ZCI+DQo8c3ZnIHZlcnNpb249IjEuMSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIiB4bWxuczp4bGluaz0iaHR0cDovL3d3dy53My5vcmcvMTk5OS94bGluayIgeD0iMHB4IiB5PSIwcHgiDQoJIHdpZHRoPSIxNzAwLjc5MDA0cHgiIGhlaWdodD0iMTcwMC43OTAwNHB4IiB2aWV3Qm94PSIyODcgMzE3IDExMjUgMTEyNSINCgkgZW5hYmxlLWJhY2tncm91bmQ9Im5ldyAwIDAgMTcwMC43OTAwNCAxNzAwLjc5MDA0IiB4bWw6c3BhY2U9InByZXNlcnZlIj4NCjxnIGlkPSJsb2dvIj4NCgk8Zz4NCgkJPGc+DQoJCQk8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iI0ZGRkZGRiIgZD0iTTM1NC45Nzc1NCwxMTk1LjYyMzA1DQoJCQkJYzExLjM4NDc3LDAsMjIuMDEyNywzLjIzNzMsMzEuMDE3NTgsOC44Mzc4OWMxLjk0NjI5LDEuMjEwOTQsMi41ODQ5NiwzLjc0OTAyLDEuNDM4NDgsNS43MzQzOGwtNC45MzI2Miw4LjU0MTk5DQoJCQkJYy0zLjI3ODMyLDUuNjc5NjktMTAuMDMzMiw4LjM3Njk1LTE2LjMxNzM4LDYuNTAwOThjLTIuNzY0NjUtMC44MjUyLTUuNjkzMzYtMS4yNjg1NS04LjcyNjU2LTEuMjY4NTUNCgkJCQljLTE2LjgyOTEsMC0zMC40NzI2NiwxMy42NDM1NS0zMC40NzI2NiwzMC40NzI2NmMwLDE2LjgyODEzLDEzLjY0MzU1LDMwLjQ3MjY2LDMwLjQ3MjY2LDMwLjQ3MjY2DQoJCQkJYzMuMDMzMiwwLDUuOTYxOTEtMC40NDMzNiw4LjcyNjU2LTEuMjY4NTVjNi4yOTQ5Mi0xLjg3OTg4LDEzLjAzMzIsMC44MTE1MiwxNi4zMTczOCw2LjUwMDk4bDQuOTMxNjQsOC41NDE5OQ0KCQkJCWMxLjE0NzQ2LDEuOTg4MjgsMC41MTA3NCw0LjUyMzQ0LTEuNDM4NDgsNS43MzQzOGMtOS4wMDM5MSw1LjYwMTU2LTE5LjYzMTg0LDguODM3ODktMzEuMDE2Niw4LjgzNzg5DQoJCQkJYy0zMi40ODUzNSwwLTU4LjgxOTM0LTI2LjMzNDk2LTU4LjgxOTM0LTU4LjgxOTM0QzI5Ni4xNTgyLDEyMjEuOTU3MDMsMzIyLjQ5MjE5LDExOTUuNjIzMDUsMzU0Ljk3NzU0LDExOTUuNjIzMDUNCgkJCQlMMzU0Ljk3NzU0LDExOTUuNjIzMDV6IE03MDMuMjE0ODQsMTI1OS4xNzU3OGMtMTQuNTU5NTctOS44MTczOC0yMC4yMDMxMy0yMC4wMzIyMy0yMC4yMDMxMy0zMy4wODAwOA0KCQkJCWMwLTE4LjQ4OTI2LDE1LjcxNDg0LTI5Ljc2MzY3LDM4LjI2NjYtMjkuNzYzNjdjOS42NTcyMywwLDE4LjcyMTY4LDIuNTQyOTcsMjYuNTU5NTcsNi45OTQxNA0KCQkJCWMyLjA0OTgsMS4xNjQwNiwyLjc2MTcyLDMuNzgzMiwxLjU4MzAxLDUuODI0MjJsLTMuNDE3OTcsNS45MTk5MmMtMy4yNDcwNyw1LjYyNDAyLTkuOTA4Miw4LjMzMTA1LTE2LjE1MzMyLDYuNTQ4ODMNCgkJCQljLTIuNzIzNjMtMC43NzYzNy01LjU5ODYzLTEuMTkyMzgtOC41NzEyOS0xLjE5MjM4Yy0xMC40OTAyMywwLTExLjU5ODYzLDkuNTc2MTctNC44NTc0MiwxNC4xMjMwNWwyMy42ODY1MiwxNS45NzY1Ng0KCQkJCWM5Ljk5MDIzLDYuNzM4MjgsMTUuODk1NTEsMTcuMDY2NDEsMTUuODk1NTEsMjguNzE4NzVjMCwxOC43ODYxMy0xNS4wMDY4NCwzMy4zMDc2Mi0zOC4yNjc1OCwzMy4zMDc2Mg0KCQkJCWMtOS41MjI0NiwwLTE4LjU4Nzg5LTEuOTU3MDMtMjYuODE1NDMtNS40OTAyM2MtNy43ODEyNS0zLjMzOTg0LTEwLjkzMzU5LTEyLjc4MjIzLTYuNjk3MjctMjAuMTE4MTZsMy40ODczLTYuMDQxOTkNCgkJCQljMS4yMTM4Ny0yLjA5OTYxLDMuOTMxNjQtMi43NTk3Nyw1Ljk3NDYxLTEuNDU2MDVjNi44NTkzOCw0LjM4MjgxLDE2LjQ5MDIzLDcuNTk0NzMsMjQuNzU4NzksNy41OTQ3Mw0KCQkJCWMxMC41NDU5LDAsMTEuMzI4MTMtOS45NTg5OCwzLjc2NzU4LTE1LjA1NzYyTDcwMy4yMTQ4NCwxMjU5LjE3NTc4TDcwMy4yMTQ4NCwxMjU5LjE3NTc4eiBNOTg0LjYzMDg2LDEyMDIuMDAwOTgNCgkJCQljMC0yLjM0NzY2LDEuOTAzMzItNC4yNTE5NSw0LjI1MTk1LTQuMjUxOTVoOS45MjE4OGM3LjgyNzE1LDAsMTQuMTcyODUsNi4zNDU3LDE0LjE3Mjg1LDE0LjE3MzgzdjU3LjQwMTM3DQoJCQkJYzAsOC42MTAzNSw2Ljk4MDQ3LDE1LjU5MDgyLDE1LjU5MDgyLDE1LjU5MDgyczE1LjU5MDgyLTYuOTgwNDcsMTUuNTkwODItMTUuNTkwODJ2LTU3LjQwMTM3DQoJCQkJYzAtNy44MjgxMyw2LjM0NTctMTQuMTczODMsMTQuMTcyODUtMTQuMTczODNoOS45MjA5YzIuMzQ4NjMsMCw0LjI1MTk1LDEuOTA0Myw0LjI1MTk1LDQuMjUxOTV2NjcuMzIzMjQNCgkJCQljMCwyNC4yNjU2My0xOS42NzA5LDQzLjkzNzUtNDMuOTM2NTIsNDMuOTM3NXMtNDMuOTM3NS0xOS42NzE4OC00My45Mzc1LTQzLjkzNzVWMTIwMi4wMDA5OEw5ODQuNjMwODYsMTIwMi4wMDA5OHoNCgkJCQkgTTQ2Ni44NjkxNCwxMTk1LjYyMzA1YzMyLjQ4NDM4LDAsNTguODE4MzYsMjYuMzMzOTgsNTguODE4MzYsNTguODE5MzRjMCwzMi40ODQzOC0yNi4zMzM5OCw1OC44MTkzNC01OC44MTgzNiw1OC44MTkzNA0KCQkJCWMtMzIuNDg2MzMsMC01OC44MTkzNC0yNi4zMzQ5Ni01OC44MTkzNC01OC44MTkzNEM0MDguMDQ5OCwxMjIxLjk1NzAzLDQzNC4zODI4MSwxMTk1LjYyMzA1LDQ2Ni44NjkxNCwxMTk1LjYyMzA1DQoJCQkJTDQ2Ni44NjkxNCwxMTk1LjYyMzA1eiBNNDY2Ljg2OTE0LDEyMjUuMDMzMmMtMTYuMjQzMTYsMC0yOS40MTAxNiwxMy4xNjY5OS0yOS40MTAxNiwyOS40MDkxOA0KCQkJCXMxMy4xNjY5OSwyOS40MDgyLDI5LjQxMDE2LDI5LjQwODJjMTYuMjQxMjEsMCwyOS40MDgyLTEzLjE2NjAyLDI5LjQwODItMjkuNDA4MlM0ODMuMTEwMzUsMTIyNS4wMzMyLDQ2Ni44NjkxNCwxMjI1LjAzMzINCgkJCQlMNDY2Ljg2OTE0LDEyMjUuMDMzMnogTTU1Ni43MzI0MiwxMzExLjEzNDc3Yy0yLjM0NzY2LDAtNC4yNTE5NS0xLjkwMjM0LTQuMjUxOTUtNC4yNXYtOTQuOTYxOTENCgkJCQljMC03LjgyODEzLDYuMzQ1Ny0xNC4xNzM4MywxNC4xNzM4My0xNC4xNzM4M2gzLjk1ODk4YzQuNjI1LDAsOC45NTg5OCwyLjI1Njg0LDExLjYxMTMzLDYuMDQ1OWw0MS4xMjIwNyw1OC43NDcwN3YtNTAuNjE5MTQNCgkJCQljMC03LjgyODEzLDYuMzQ1Ny0xNC4xNzM4MywxNC4xNzI4NS0xNC4xNzM4M2g5LjkyMTg4YzIuMzQ3NjYsMCw0LjI1MTk1LDEuOTA0Myw0LjI1MTk1LDQuMjUxOTV2OTQuOTYwOTQNCgkJCQljMCw3LjgyOTEtNi4zNDU3LDE0LjE3Mjg1LTE0LjE3MzgzLDE0LjE3Mjg1aC0zLjk1ODk4Yy00LjYyNSwwLTguOTU4OTgtMi4yNTU4Ni0xMS42MTEzMy02LjA0NDkybC00MS4xMjIwNy01OC43NDYwOXY1MC42MTgxNg0KCQkJCWMwLDcuODI5MS02LjM0NTcsMTQuMTcyODUtMTQuMTcyODUsMTQuMTcyODVINTU2LjczMjQyTDU1Ni43MzI0MiwxMzExLjEzNDc3eiBNMTIxNS4wMjA1MSwxMjExLjkyMjg1DQoJCQkJYzAtNy44MjgxMyw2LjM0NTctMTQuMTczODMsMTQuMTcyODUtMTQuMTczODNoNTAuMzE1NDNjMi4zNDg2MywwLDQuMjUxOTUsMS45MDQzLDQuMjUxOTUsNC4yNTE5NXY1LjY2OTkyDQoJCQkJYzAsNy44MjcxNS02LjM0NTcsMTQuMTcyODUtMTQuMTcyODUsMTQuMTcyODVoLTYuMDI0NDF2NzUuMTE4MTZjMCw3LjgyOTEtNi4zNDU3LDE0LjE3Mjg1LTE0LjE3Mjg1LDE0LjE3Mjg1aC05LjkyMTg4DQoJCQkJYy0yLjM0ODYzLDAtNC4yNTE5NS0xLjkwMjM0LTQuMjUxOTUtNC4yNXYtODUuMDQxMDJoLTE1Ljk0NDM0Yy0yLjM0ODYzLDAtNC4yNTE5NS0xLjkwMzMyLTQuMjUxOTUtNC4yNTE5NVYxMjExLjkyMjg1DQoJCQkJTDEyMTUuMDIwNTEsMTIxMS45MjI4NXogTTc3Ni40NDkyMiwxMjExLjkyMjg1YzAtNy44MjgxMyw2LjM0NTctMTQuMTczODMsMTQuMTczODMtMTQuMTczODNoNTAuMzE0NDUNCgkJCQljMi4zNDk2MSwwLDQuMjUxOTUsMS45MDQzLDQuMjUxOTUsNC4yNTE5NXY1LjY2OTkyYzAsNy44MjcxNS02LjM0NTcsMTQuMTcyODUtMTQuMTcxODgsMTQuMTcyODVoLTYuMDI1Mzl2NzUuMTE4MTYNCgkJCQljMCw3LjgyOTEtNi4zNDU3LDE0LjE3Mjg1LTE0LjE3Mjg1LDE0LjE3Mjg1aC05LjkyMDljLTIuMzQ5NjEsMC00LjI1MTk1LTEuOTAyMzQtNC4yNTE5NS00LjI1di04NS4wNDEwMmgtMTUuOTQ1MzENCgkJCQljLTIuMzQ3NjYsMC00LjI1MTk1LTEuOTAzMzItNC4yNTE5NS00LjI1MTk1VjEyMTEuOTIyODVMNzc2LjQ0OTIyLDEyMTEuOTIyODV6IE05MjkuNjA0NDksMTI3Mi4wMjI0NmwyNi45NTgwMSwzMi4xMjc5Mw0KCQkJCWMyLjMxNDQ1LDIuNzU3ODEsMC4zNDM3NSw2Ljk4NDM4LTMuMjU2ODQsNi45ODQzOGgtMTkuNzA1MDhjLTQuMTg5NDUsMC04LjE2NTA0LTEuODUxNTYtMTAuODU3NDItNS4wNjA1NWwtMjIuNjgxNjQtMjcuMDMxMjUNCgkJCQl2MjcuODQxOGMwLDIuMzQ3NjYtMS45MDMzMiw0LjI1LTQuMjUxOTUsNC4yNWgtOS45MjA5Yy03LjgyNzE1LDAtMTQuMTcyODUtNi4zNDM3NS0xNC4xNzI4NS0xNC4xNzI4NXYtODUuMDM5MDYNCgkJCQljMC03LjgyODEzLDYuMzQ1Ny0xNC4xNzM4MywxNC4xNzI4NS0xNC4xNzM4M2gyOS43NjM2N2MyMi43MDAyLDAsNDEuMTAyNTQsMTcuMTMzNzksNDEuMTAyNTQsMzguMjY4NTUNCgkJCQlDOTU2Ljc1NDg4LDEyNTIuNTkwODIsOTQ1LjQzNjUyLDEyNjYuNzAyMTUsOTI5LjYwNDQ5LDEyNzIuMDIyNDZMOTI5LjYwNDQ5LDEyNzIuMDIyNDZ6IE05MDAuMDYxNTIsMTIyMS44NDM3NXYzMi41OTg2M2g4LjUwMzkxDQoJCQkJYzEwLjk1ODk4LDAsMTkuODQyNzctNy4yOTc4NSwxOS44NDI3Ny0xNi4yOTg4M2MwLTkuMDAxOTUtOC44ODM3OS0xNi4yOTk4LTE5Ljg0Mjc3LTE2LjI5OThIOTAwLjA2MTUyTDkwMC4wNjE1MiwxMjIxLjg0Mzc1eg0KCQkJCSBNMTE1OC4zNTkzOCwxMTk1LjYyMzA1YzExLjM4NDc3LDAsMjIuMDEyNywzLjIzNzMsMzEuMDE3NTgsOC44Mzc4OWMxLjk0NzI3LDEuMjEwOTQsMi41ODQ5NiwzLjc0OTAyLDEuNDM4NDgsNS43MzQzOA0KCQkJCWwtNC45MzI2Miw4LjU0MTk5Yy0zLjI3ODMyLDUuNjc5NjktMTAuMDMzMiw4LjM3Njk1LTE2LjMxNzM4LDYuNTAwOThjLTIuNzY0NjUtMC44MjUyLTUuNjkzMzYtMS4yNjg1NS04LjcyNTU5LTEuMjY4NTUNCgkJCQljLTE2LjgyOTEsMC0zMC40NzI2NiwxMy42NDM1NS0zMC40NzI2NiwzMC40NzI2NmMwLDE2LjgyODEzLDEzLjY0MzU1LDMwLjQ3MjY2LDMwLjQ3MjY2LDMwLjQ3MjY2DQoJCQkJYzMuMDMyMjMsMCw1Ljk2MDk0LTAuNDQzMzYsOC43MjU1OS0xLjI2ODU1YzYuMjk1OS0xLjg3OTg4LDEzLjAzMzIsMC44MTE1MiwxNi4zMTgzNiw2LjUwMDk4bDQuOTMwNjYsOC41NDE5OQ0KCQkJCWMxLjE0NzQ2LDEuOTg4MjgsMC41MTA3NCw0LjUyMzQ0LTEuNDM3NSw1LjczNDM4Yy05LjAwNDg4LDUuNjAxNTYtMTkuNjMyODEsOC44Mzc4OS0zMS4wMTc1OCw4LjgzNzg5DQoJCQkJYy0zMi40ODUzNSwwLTU4LjgxOTM0LTI2LjMzNDk2LTU4LjgxOTM0LTU4LjgxOTM0QzEwOTkuNTQwMDQsMTIyMS45NTcwMywxMTI1Ljg3NDAyLDExOTUuNjIzMDUsMTE1OC4zNTkzOCwxMTk1LjYyMzA1eiIvPg0KCQkJPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGZpbGw9IiMwMEZGREEiIGQ9Ik0xMzE4LjE5NzI3LDEyMDYuMDMyMjMNCgkJCQljMC03LjgyODEzLDYuMzQ1Ny0xNC4xNzM4MywxNC4xNzI4NS0xNC4xNzM4M2MyMC42NTYyNSwwLDQxLjMxMjUsMCw2MS45Njg3NSwwYzMuNDI5NjksMCw1LjQ1MDIsMy44ODA4NiwzLjQ4MzQsNi42OTA0Mw0KCQkJCWwtMTkuMjk2ODgsMjcuNTY3MzhjMTUuNTQyOTcsOC4zNzU5OCwyNi4xMDY0NSwyNC44MDA3OCwyNi4xMDY0NSw0My42OTUzMWMwLDI3LjM5NzQ2LTIyLjIwODk4LDQ5LjYwNjQ1LTQ5LjYwNjQ1LDQ5LjYwNjQ1DQoJCQkJYy0xNi42ODg0OCwwLTMxLjQ1MTE3LTguMjQwMjMtNDAuNDQzMzYtMjAuODc1OThjLTEuNDUwMi0yLjAzOTA2LTAuODMxMDUtNC44OTk0MSwxLjMzNTk0LTYuMTUyMzRsMTAuOTc3NTQtNi4zMzc4OQ0KCQkJCWM0Ljg4MTg0LTIuODE4MzYsMTAuOTc5NDktMi40NzU1OSwxNS41MTQ2NSwwLjg3MzA1YzMuNTI4MzIsMi42MDU0Nyw3Ljg5MTYsNC4xNDY0OCwxMi42MTUyMyw0LjE0NjQ4DQoJCQkJYzExLjc0MjE5LDAsMjEuMjU5NzctOS41MTg1NSwyMS4yNTk3Ny0yMS4yNTk3N3MtOS41MTc1OC0yMS4yNTk3Ny0yMS4yNTk3Ny0yMS4yNTk3N2gtMTUuMjE3NzcNCgkJCQljLTMuNDI5NjksMC01LjQ1MDItMy44ODA4Ni0zLjQ4NDM4LTYuNjkwNDNsMTguMTM1NzQtMjUuOTA4MmgtMzIuMDA5NzdjLTIuMzQ4NjMsMC00LjI1MTk1LTEuOTAzMzItNC4yNTE5NS00LjI1MTk1VjEyMDYuMDMyMjN6DQoJCQkJIi8+DQoJCTwvZz4NCgkJPGc+DQoJCQk8Zz4NCgkJCQk8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iI0RBRThGNyIgZD0iTTg1MC4zOTU1MSw4NTcuNTkxOA0KCQkJCQljLTUwLjM1NjQ1LDAtOTQuMzI1Mi0yNy4zNTY0NS0xMTcuODUyNTQtNjguMDIwNTFsLTgwLjAzMDI3LDQ2LjIwNDFjLTQuNjU1MjcsMi42ODk0NS02LjEzMTg0LDguNzE4NzUtMy4yNDkwMiwxMy4yNTU4Ng0KCQkJCQljNDIuMjM3Myw2Ni40ODYzMywxMTYuNTMzMiwxMTAuNjA3NDIsMjAxLjEzMTg0LDExMC42MDc0MmM4OC4xMjU5OCwwLDE2NS4wNzEyOS00Ny44NzUsMjA2LjI0MzE2LTExOS4wMzYxM2wtODAuNDg3My00Ni40Njk3Mw0KCQkJCQljLTQuMzEzNDgtMi40OTAyMy05LjgwMTc2LTEuMjA1MDgtMTIuNTcwMzEsMi45MzU1NUM5MzkuMTc1NzgsODMzLjU2MjUsODk3LjU5MTgsODU3LjU5MTgsODUwLjM5NTUxLDg1Ny41OTE4DQoJCQkJCUw4NTAuMzk1NTEsODU3LjU5MTh6IE0xMTM2LjcyMTY4LDU1Ni4yMTc3N2M0LjYxNDI2LTIuNjYzMDksNi4xMTAzNS04LjYxOTE0LDMuMzEyNS0xMy4xNTEzNw0KCQkJCQljLTU5LjkxNTA0LTk3LjAzMDI3LTE2Ny4yMjQ2MS0xNjEuNjk0MzQtMjg5LjYzODY3LTE2MS42OTQzNGMtMTI1Ljg5MzU1LDAtMjM1LjgxMzQ4LDY4LjM5MjU4LTI5NC42MzM3OSwxNzAuMDQ5OA0KCQkJCQlsODAuMzc2OTUsNDYuNDA2MjVjNC4zOTc0NiwyLjUzOTA2LDEwLjAwMTk1LDEuMTQ5NDEsMTIuNzEwOTQtMy4xNDU1MQ0KCQkJCQljNDIuMTY0MDYtNjYuODUxNTYsMTE2LjY2ODk1LTExMS4yNjM2NywyMDEuNTQ1OS0xMTEuMjYzNjdjODguMTI1OTgsMCwxNjUuMDcxMjksNDcuODc1OTgsMjA2LjI0MzE2LDExOS4wMzYxMw0KCQkJCQlMMTEzNi43MjE2OCw1NTYuMjE3Nzd6Ii8+DQoJCQkJPHBhdGggZmlsbC1ydWxlPSJldmVub2RkIiBjbGlwLXJ1bGU9ImV2ZW5vZGQiIGZpbGw9IiNBNUJBQzgiIGQ9Ik04NTAuMzk1NTEsOTU5LjYzODY3DQoJCQkJCWMtODQuNTk4NjMsMC0xNTguODk0NTMtNDQuMTIxMDktMjAxLjEzMTg0LTExMC42MDc0MmMtMi44NzY5NS00LjUzMDI3LTEuMzk5NDEtMTAuNTcwMzEsMy4yNDkwMi0xMy4yNTU4Nmw4MC4wMzAyNy00Ni4yMDQxDQoJCQkJCWMtMTEuNTgxMDUtMjAuMDE2Ni0xOC4yMDk5Ni00My4yNTQ4OC0xOC4yMDk5Ni02OC4wNDE5OWMwLTc0Ljc4NTE2LDYwLjU1NzYyLTEzNi4wNjI1LDEzNi4wNjI1LTEzNi4wNjI1DQoJCQkJCWM0Ny4xOTYyOSwwLDg4Ljc4MDI3LDI0LjAyOTMsMTEzLjE4NTU1LDYwLjUyMjQ2YzIuNzY0NjUsNC4xMzM3OSw4LjI2MzY3LDUuNDIxODgsMTIuNTcwMzEsMi45MzU1NWw4MC40ODczLTQ2LjQ2OTczDQoJCQkJCWMtNDEuMTcxODgtNzEuMTYwMTYtMTE4LjExNzE5LTExOS4wMzYxMy0yMDYuMjQzMTYtMTE5LjAzNjEzYy04NC44NzY5NSwwLTE1OS4zODE4NCw0NC40MTIxMS0yMDEuNTQ1OSwxMTEuMjYzNjcNCgkJCQkJYy0yLjcwNjA1LDQuMjkxMDItOC4zMTgzNiw1LjY4MTY0LTEyLjcxMDk0LDMuMTQ1NTFsLTgwLjM3Njk1LTQ2LjQwNjI1DQoJCQkJCWMtMjguOTUyMTUsNTAuMDQwMDQtNDUuNTIzNDQsMTA4LjEzOTY1LTQ1LjUyMzQ0LDE3MC4xMDc0MmMwLDE4Ni45NjM4NywxNTEuMzk0NTMsMzQwLjE1NzIzLDM0MC4xNTcyMywzNDAuMTU3MjMNCgkJCQkJYzEyMi40MTQwNiwwLDIyOS43MjM2My02NC42NjQwNiwyODkuNjM4NjctMTYxLjY5NTMxYzIuNzk0OTItNC41MjYzNywxLjI5NDkyLTEwLjQ5MDIzLTMuMzEyNS0xMy4xNTEzN2wtODAuMDgzMDEtNDYuMjM3Mw0KCQkJCQlDMTAxNS40NjY4LDkxMS43NjM2Nyw5MzguNTIxNDgsOTU5LjYzODY3LDg1MC4zOTU1MSw5NTkuNjM4Njd6Ii8+DQoJCQk8L2c+DQoJCQk8cGF0aCBmaWxsLXJ1bGU9ImV2ZW5vZGQiIGNsaXAtcnVsZT0iZXZlbm9kZCIgZmlsbD0iIzAwRkZEQSIgZD0iTTExMzcuMTg1NTUsNzU4LjExMzI4di03My4xNjc5N2wtNjMuMzY1MjMsMzYuNTgzOTgNCgkJCQlMMTEzNy4xODU1NSw3NTguMTEzMjhMMTEzNy4xODU1NSw3NTguMTEzMjh6IE0xMDI2LjU3NjE3LDcwNS4xNjQwNmwxMjAuMDU4NTktNjkuMzE2NDENCgkJCQljMTIuNTY4MzYtNy4yNTU4NiwyOC4zNDQ3MywxLjg1MjU0LDI4LjM0NTcsMTYuMzY2MjF2MTM4LjYzMDg2Yy0wLjAwMDk4LDE0LjUxMjctMTUuNzc3MzQsMjMuNjIyMDctMjguMzQ1NywxNi4zNjYyMQ0KCQkJCWwtMTIwLjA1ODU5LTY5LjMxNjQxQzEwMTQuMDI4MzIsNzMwLjY0OTQxLDEwMTQuMDI4MzIsNzEyLjQwOTE4LDEwMjYuNTc2MTcsNzA1LjE2NDA2eiIvPg0KCQk8L2c+DQoJPC9nPg0KPC9nPg0KPC9zdmc+DQo=").then(function(tex){if(_this157._splashState==="done")renderer.DeleteTexture(tex);else _this157._splashTextures.logo=tex;})["catch"](function(err){return console.warn("Failed to load splash image: ",err);});this._LoadBitmapSplashImage("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAABABAMAAACekdKMAAAAMFBMVEUAAAByfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYYgo7vbAAAAD3RSTlMAmd137hFVqjO7zCKIRGZ881JRAAAFY0lEQVR42u2aPW/bVhSGn1iiPizZ8D+QgSJBNglFmiboQA0NUKAD1XotYA0BOspAkZnqx24vnTrIQNCpg4QkQMcYKDoW9j9w5y6qLNqWFDlvh3tJUa6ddHBhAuS7SKBIQffhuee851CQKVOmTJkyZcqUKXmqa8O+uyNlABKsFRmdP0o5AOle2gHoWdoBzFrpBHACwPeetJNmAFSlt6kGwGH0LqUAVqRuqgHkpEaqAVRkfvOWr+Dh9Rc4j6VvwnrhPNAbgK2ezj+yx7Z6GjUuASi4Ch4lHQAGwBeRK1rROQAdUx5K0hE4NUkaAdS02ZEuoms2wkCSgvYSgFJfkn6CobkSPG0mEcAOrHnGFOxAToHNjk/MygLgO/PxL0BN9yRdQKlufMQAoCdJGi8BOJYknXTJ269cu9HtdqNb4Ni6oimUbFb0dAZQ1DmULJ+TFtT0qQHwg73mLlCMfFUMQPR5VWrbmttNHICC1KDiSZ+w3pMOwFPDhP4IYFtv4ZX0nIorbUBNmjWAiqdZg5fmNFd6jvPhJQDjAV9LI0r28IpmycsBZalNWfoRWJcuoKY9c7cCkwpOwdcIqNT1BmrSgQkNbQAvpAGOF+aHOIBpCxhKR/TVBNjVOHkAOgrg2N6aoU7sklmVidtD7bNm/fIrjaBmk+Sxea142iBnTyguAfjZZscNXLOdXFM8EgVgXRpDz/6yonTEts6AXdV1APTVoKigFSXEmj3XN0kSV01WFQwAHC8O4Mhagye8NgHS137SALzsS3dxwhtXkQ4oaw64eqomOFKXbc2xJbFLTX8DOHYnsKsJu2Gdu8IIuTqjrMB8eyM5ACIFXQo2S5t7lNMM6AdFTaCgADqahHW8EQIohBk9rzEdE+JXAtjVmHWpDTmplUAA96Ea/bJDnVKSWjgaFTSHqubgmjVDXQchgFy4wBXNcXV6LYC8RjbEypomcCAyBopRShxqAn21yenM8WawqjOoKVbmLYBFndeImsnyVwJY1RR8NW1FTRiA6UNTCsP6fKwLONQBZTXx1WVbT0KbtwygvAxg81oAZU0xe2QYxkmyrDDx2DzWBXTUZFs7dNQwHUEMwN4VAKb47wOQ1wj8Gx0+/Y8A8powVJtt7XOoxn8A8N4IqCrA8cJUmzgAl3JAUWN8tSjqDX0NwI/XbwugGLe178oBK7bBaBesm0gggOUqwLrOHe8c1jV2NAMOw/XFAFRth2dr/burANS1cSc0C8kDsB7zAZvgKCjoLTiaFqwpmvwLQC7e2b3PB4CrZj48KXkAKktOEPr6VqeAr680udzEWACluK0LreJ1ThBe6+w4HkfJAhD1AtbAu3qgPcDVX2oCK9bqxwFQ1+fRsVW7va/uBZpAWaND652TCGBoM1rHHN6VmQlsq6cdE+4mC75oLAC49prKB1zTDd6NukHIKahbIkkEsGrmAQWZbZqXNLClrg04dTP4KnjnCwBfmgkZT7WD45k94C8BmA3MPGBgeqcbfQBxwwDsRMi3N7Iqc3dzsuVhV5ofkevpJOoGKUn6Ax5L92F49USoayZCls08uQDiM0ETCWPb8k7DMmH02SICGC7ayVhnsABwEpsZQkfxUpI4ALGpsFn4xCbHcVjnwgnvAkBh0U6CbzqrXgzA1E6FB9YOJGcacgUAfl36t0Ro/SIDUDEL/D1WBcJr5q0oRoJ2LQZgZJ4LPIu2RCPJAJafDLm2Yr2OHmQ4H0vzBksA2PKl38L3fY0aLAFYejK0ZpJhelVKzkj8dlRNzkj8dpRP0DTkVjTUXroB9PVnqtefS9I05BZU8NOdAyUl5q8RtwUg6KYcwP1Up8CanpMpU6ZMmTLdgP4BRYsi23xEdOAAAAAASUVORK5CYII=").then(function(tex){if(_this157._splashState==="done")renderer.DeleteTexture(tex);else _this157._splashTextures.powered=tex;})["catch"](function(err){return console.warn("Failed to load splash image: ",err);});this._LoadBitmapSplashImage("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAgAAAABABAMAAACekdKMAAAAMFBMVEUAAAByfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYZyfYYgo7vbAAAAD3RSTlMAdxHdu4hmVZnuRMwzqiLYE4y2AAAFw0lEQVR42u2Yy+9LQRTHp6Xq0VIkXkFvwkYslAWJiGJj2a6sJJe/oF3YWGElEQmxkYi4ErFWNpatWFmIx9Lm1sJCLKgqraqv82h726l6hOuRzDf53TtnOr+ZOZ+ZOffca5ycnJycnJycnJycnJycnJz+pi7g2G9osxjvzX8qB8ABcAAcgH8XwDa85dspNOiaRDuAR4U0PnHtDuyy7IJRJS6gvVmL6TywVkp4ZxIhulUxFvlaXQTrgEHbnMDH5XRjlXCdb+uAnc2ojWgFFTYBZ8e9tzcaswAk6v/3K4sPfPNRFj87IXj+KXQUS9m2jXoH1lMuLq2DtEcAtNMBT9PjanFq7ySAhbABVEAaeDaAwkk2D7GRqctAMQJIq2sBauLnB/VxCfqKpWrbRhSC1W5SMQ9RTgBUwKpF1ccmAIQ2gCxE+20Au9nSESvDgeIDkJSBMpA9vgyXdsj0H0GORL3n2fbwPOKoSQS4Q2cBOGzSJbQYAHDbZEI+rEuBcyZRlF71fIP/x0wBuIBOw6xH3xu2GQFAP2cegmvSwHkeqBZjECzB46UXD3bg8UKJCT6QYzgDY9uiU7hC11doERq6MAZ2CPJ7ipEulOrteDcB4KOZBpBG7zrV1JGzATzmIdnrl/go3bRiBJBHlZc+6ItjuQQ+yFLz8Gka2LZFRVTFGdoQJQ0LPodHnXkS8AjlRWkBLwKQswAs0PDzGpcsAAMNuG+5WgdqxwjgEcp8qcBjN5oZdPhEvOfhU/hsbJuVloWV6WWgp2IBLxXQNEwLDfKqoMXrEQBjATiFA3qePlgAZJRl+EStdaAQjfgALOC1zfeX8ALV+7S69JdALWjxHGqztmxyMnTD6OOBWvAdGDkn60c6vrI5H4CPnOJsWQDe8G0hIU0MB8ojFx+AFAeqeitLy5FkL3w0yNNcSOx3oDxjjxaH9XxldZluY5NBfwrAQvQbRjQXAO8UqVq5dh6A7HCgWzgdFwBdgOX4lMZbTndkWWkDN07Bk+zItllLdHm1+FkLwBSADNDf8B0AnGOp5gFYgJEexwcgGQx4iyeD9ybFkWsbDZbv0+2Y8XvGtqMpWsUimpMAzA1AUrj5ALjm2wCoONKB+ACYsEeDlU04MMs4imeJQqljslSuD4xl/zgAsx6ku/8DgDwaO9AwFU56qhzOPiXpKCzCpSSdb8v+CQDmXshb99cARAPFCOA1chWaFXlP55yn2FqEgiFvOSzYtmiJzisKB7MxQPS8iO63YsD3AHDv8QPgjR92eKuf9vts1wdZjvZhN4XajD35FNDiR7ln0LYBaILY+OZT4DsA+BkTP4AUrgXkxSJcDFps+72X7EGlx6mBbU/lAbdQjvKA7hSAlSuHxdw0gORsHrAUnXkAUuj+AQAZdHGRp9bShX2ECz1JRSk4zNhRJqj5SZQJfpgCUNS2eRsAP/usTDAxPxFKA834AZgAOM1z6qGgxxpdmUDQNjP25LtAsojxu0AehSkAF6RLXWR/EkAdVYEevQtswVtpMwuAB1JGh2jbxQcgBKrig/qSxTD6o2Nm7fttSY6uUnErV+jb4CJyaArAI5luJkCDOy5HAPISSB5A3wYbhJERahvtPALAAw2EI9Vzsh2TTuk23qEceN9d4vVVv227hNroe0CRi/o9IKTZTQFIAc/M8jwGEiouG2/042u8u25uAuPvAavRH7XhzqcBpICdRpssRa+aNLFoh2JeyBzU08fih/ht20WZXghW34s+/ZQnAKhzojsSH4CC/sjARPKamLXacOfTAIwfNSkCbROLluG9Tm2gdl3PY178tu2SBIpFQ6fHH//2GAvAogCkjtGDEAFQYPsu6DdBqw11bgFIF8dNHsQGIEFRSDOe0RS9YYJk23JMrw+/Cr9bFX0VXmNsACbhA088qXhBrMYAlq8Gjhh//FX4YNSGO7cASO9n9B99AuHk5OTk5OTk5OTk5OTk5OTk5OT0VX0B7+fX+9cwWYYAAAAASUVORK5CYII=").then(function(tex){if(_this157._splashState==="done")renderer.DeleteTexture(tex);else _this157._splashTextures.website=tex;})["catch"](function(err){return console.warn("Failed to load splash image: ",err);});}}},{key:"_LoadSvgSplashImage",value:function _LoadSvgSplashImage(url){var blob,drawable;return regeneratorRuntime.async(function _LoadSvgSplashImage$(_context179){while(1){switch(_context179.prev=_context179.next){case 0:url=new URL(url,this._runtime.GetRuntimeBaseURL()).toString();_context179.next=3;return regeneratorRuntime.awrap(_C183.FetchBlob(url));case 3:blob=_context179.sent;_context179.next=6;return regeneratorRuntime.awrap(this._runtime.RasterSvgImage(blob,2048,2048));case 6:drawable=_context179.sent;_context179.next=9;return regeneratorRuntime.awrap(this.GetRenderer().CreateStaticTextureAsync(drawable,{mipMapQuality:"high"}));case 9:return _context179.abrupt("return",_context179.sent);case 10:case"end":return _context179.stop();}}},null,this);}},{key:"_LoadBitmapSplashImage",value:function _LoadBitmapSplashImage(url){var blob;return regeneratorRuntime.async(function _LoadBitmapSplashImage$(_context180){while(1){switch(_context180.prev=_context180.next){case 0:url=new URL(url,this._runtime.GetRuntimeBaseURL()).toString();_context180.next=3;return regeneratorRuntime.awrap(_C183.FetchBlob(url));case 3:blob=_context180.sent;_context180.next=6;return regeneratorRuntime.awrap(this.GetRenderer().CreateStaticTextureAsync(blob,{mipMapQuality:"high"}));case 6:return _context180.abrupt("return",_context180.sent);case 7:case"end":return _context180.stop();}}},null,this);}},{key:"HideCordovaSplashScreen",value:function HideCordovaSplashScreen(){this._runtime.PostComponentMessageToDOM("runtime","hide-cordova-splash");}},{key:"StartLoadingScreen",value:function StartLoadingScreen(){var _this158=this;this._loaderStartTime=Date.now();this._runtime.Dispatcher().addEventListener("loadingprogress",this._loadingprogress_handler);this._rafId=requestAnimationFrame(function(){return _this158._DrawLoadingScreen();});var loaderStyle=this._runtime.GetLoaderStyle();if(loaderStyle!==3)this.HideCordovaSplashScreen();}},{key:"EndLoadingScreen",value:function EndLoadingScreen(){var renderer,loaderStyle;return regeneratorRuntime.async(function EndLoadingScreen$(_context181){while(1){switch(_context181.prev=_context181.next){case 0:renderer=this.GetRenderer();this._loadingProgress=1;loaderStyle=this._runtime.GetLoaderStyle();if(!(loaderStyle===4)){_context181.next=6;break;}_context181.next=6;return regeneratorRuntime.awrap(this._splashDonePromise);case 6:this._splashDoneResolve=null;this._splashDonePromise=null;if(this._rafId!==-1){cancelAnimationFrame(this._rafId);this._rafId=-1;}this._runtime.Dispatcher().removeEventListener("loadingprogress",this._loadingprogress_handler);this._loadingprogress_handler=null;if(this._percentText){this._percentText.Release();this._percentText=null;}this._runtime.ReleaseLoadingLogoAsset();renderer.Start();if(this._splashTextures.logo){renderer.DeleteTexture(this._splashTextures.logo);this._splashTextures.logo=null;}if(this._splashTextures.powered){renderer.DeleteTexture(this._splashTextures.powered);this._splashTextures.powered=null;}if(this._splashTextures.website){renderer.DeleteTexture(this._splashTextures.website);this._splashTextures.website=null;}renderer.ClearRgba(0,0,0,0);renderer.Finish();this._splashState="done";this._gpuTimeStartFrame=renderer.GetFrameNumber();if(loaderStyle===3)this.HideCordovaSplashScreen();case 22:case"end":return _context181.stop();}}},null,this);}},{key:"_DrawLoadingScreen",value:function _DrawLoadingScreen(){var _this159=this;if(this._rafId===-1)return;var renderer=this.GetRenderer();renderer.Start();this._rafId=-1;var hasHadError=this._runtime.GetAssetManager().HasHadErrorLoading();var loaderStyle=this._runtime.GetLoaderStyle();if(loaderStyle!==3){this.SetCssTransform(renderer);renderer.ClearRgba(0,0,0,0);renderer.ResetColor();renderer.SetTextureFillMode();renderer.SetTexture(null);}if(loaderStyle===0)this._DrawProgressBarAndLogoLoadingScreen(hasHadError);else if(loaderStyle===1)this._DrawProgressBarLoadingScreen(hasHadError,PROGRESSBAR_WIDTH,0);else if(loaderStyle===2)this._DrawPercentTextLoadingScreen(hasHadError);else if(loaderStyle===3)_C183.noop();else if(loaderStyle===4)this._DrawSplashLoadingScreen(hasHadError);else throw new Error("invalid loader style");renderer.Finish();this._rafId=requestAnimationFrame(function(){return _this159._DrawLoadingScreen();});}},{key:"_DrawPercentTextLoadingScreen",value:function _DrawPercentTextLoadingScreen(hasHadError){if(hasHadError)this._percentText.SetColorRgb(1,0,0);else this._percentText.SetColorRgb(.6,.6,.6);this._percentText.SetText(Math.round(this._loadingProgress*100)+"%");var midX=this._canvasCssWidth/2;var midY=this._canvasCssHeight/2;var hw=PERCENTTEXT_WIDTH/2;var hh=PERCENTTEXT_HEIGHT/2;_tempQuad5.setRect(midX-hw,midY-hh,midX+hw,midY+hh);var renderer=this.GetRenderer();renderer.SetTexture(this._percentText.GetTexture());renderer.Quad3(_tempQuad5,this._percentText.GetTexRect());}},{key:"_DrawProgressBarLoadingScreen",value:function _DrawProgressBarLoadingScreen(hasHadError,width,yOff){var renderer=this.GetRenderer();var height=PROGRESSBAR_HEIGHT;renderer.SetColorFillMode();if(hasHadError)renderer.SetColorRgba(1,0,0,1);else renderer.SetColorRgba(.118,.565,1,1);var midX=this._canvasCssWidth/2;var midY=this._canvasCssHeight/2;var hw=width/2;var hh=height/2;_tempRect10.setWH(midX-hw,midY-hh+yOff,Math.floor(width*this._loadingProgress),height);renderer.Rect(_tempRect10);_tempRect10.setWH(midX-hw,midY-hh+yOff,width,height);_tempRect10.offset(-.5,-.5);_tempRect10.inflate(.5,.5);renderer.SetColorRgba(0,0,0,1);renderer.LineRect2(_tempRect10);_tempRect10.inflate(1,1);renderer.SetColorRgba(1,1,1,1);renderer.LineRect2(_tempRect10);}},{key:"_DrawProgressBarAndLogoLoadingScreen",value:function _DrawProgressBarAndLogoLoadingScreen(hasHadError){var renderer=this.GetRenderer();var loadingLogoAsset=this._runtime.GetLoadingLogoAsset();if(!loadingLogoAsset){this._DrawProgressBarLoadingScreen(hasHadError,PROGRESSBAR_WIDTH,0);return;}var logoTexture=loadingLogoAsset.GetTexture();if(!logoTexture){this._DrawProgressBarLoadingScreen(hasHadError,PROGRESSBAR_WIDTH,0);return;}var logoW=logoTexture.GetWidth();var logoH=logoTexture.GetHeight();var midX=this._canvasCssWidth/2;var midY=this._canvasCssHeight/2;var hw=logoW/2;var hh=logoH/2;_tempQuad5.setRect(midX-hw,midY-hh,midX+hw,midY+hh);renderer.SetTexture(logoTexture);renderer.Quad(_tempQuad5);this._DrawProgressBarLoadingScreen(hasHadError,logoW,hh+16);}},{key:"_DrawSplashLoadingScreen",value:function _DrawSplashLoadingScreen(hasHadError){var renderer=this.GetRenderer();var logoTex=this._splashTextures.logo;var poweredTex=this._splashTextures.powered;var websiteTex=this._splashTextures.website;var nowTime=Date.now();if(this._splashFrameNumber===0)this._loaderStartTime=nowTime;var allowQuickSplash=this._runtime.IsPreview()||this._runtime.IsFBInstantAvailable()&&!this._runtime.IsCordova();var splashAfterFadeOutWait=allowQuickSplash?0:SPLASH_AFTER_FADEOUT_WAIT_TIME;var splashMinDisplayTime=allowQuickSplash?0:SPLASH_MIN_DISPLAY_TIME;var a=1;if(this._splashState==="fade-in")a=Math.min((nowTime-this._loaderStartTime)/SPLASH_FADE_DURATION,1);else if(this._splashState==="fade-out")a=Math.max(1-(nowTime-this._splashFadeOutStartTime)/SPLASH_FADE_DURATION,0);renderer.SetColorFillMode();renderer.SetColorRgba(.231*a,.251*a,.271*a,a);_tempRect10.set(0,0,this._canvasCssWidth,this._canvasCssHeight);renderer.Rect(_tempRect10);var w=Math.ceil(this._canvasCssWidth);var h=Math.ceil(this._canvasCssHeight);var drawW,drawH;if(this._canvasCssHeight>256){renderer.SetColorRgba(.302*a,.334*a,.365*a,a);drawW=w;drawH=Math.max(h*.005,2);_tempRect10.setWH(0,h*.8-drawH/2,drawW,drawH);renderer.Rect(_tempRect10);if(hasHadError)renderer.SetColorRgba(a,0,0,a);else renderer.SetColorRgba(.161*a,.953*a,.816*a,a);drawW=w*this._loadingProgress;_tempRect10.setWH(w*.5-drawW/2,h*.8-drawH/2,drawW,drawH);renderer.Rect(_tempRect10);renderer.SetColorRgba(a,a,a,a);renderer.SetTextureFillMode();if(poweredTex){drawW=_C183.clamp(h*.22,105,w*.6)*1.5;drawH=drawW/8;_tempRect10.setWH(w*.5-drawW/2,h*.2-drawH/2,drawW,drawH);renderer.SetTexture(poweredTex);renderer.Rect(_tempRect10);}if(logoTex){drawW=Math.min(h*.395,w*.95);drawH=drawW;_tempRect10.setWH(w*.5-drawW/2,h*.485-drawH/2,drawW,drawH);renderer.SetTexture(logoTex);renderer.Rect(_tempRect10);}if(websiteTex){drawW=_C183.clamp(h*.22,105,w*.6)*1.5;drawH=drawW/8;_tempRect10.setWH(w*.5-drawW/2,h*.868-drawH/2,drawW,drawH);renderer.SetTexture(websiteTex);renderer.Rect(_tempRect10);}}else{renderer.SetColorRgba(.302*a,.334*a,.365*a,a);drawW=w;drawH=Math.max(h*.005,2);_tempRect10.setWH(0,h*.85-drawH/2,drawW,drawH);renderer.Rect(_tempRect10);if(hasHadError)renderer.SetColorRgba(a,0,0,a);else renderer.SetColorRgba(.161*a,.953*a,.816*a,a);drawW=w*this._loadingProgress;_tempRect10.setWH(w*.5-drawW/2,h*.85-drawH/2,drawW,drawH);renderer.Rect(_tempRect10);renderer.SetColorRgba(a,a,a,a);renderer.SetTextureFillMode();if(logoTex){drawW=h*.55;drawH=drawW;_tempRect10.setWH(w*.5-drawW/2,h*.45-drawH/2,drawW,drawH);renderer.SetTexture(logoTex);renderer.Rect(_tempRect10);}}this._splashFrameNumber++;if(this._splashState==="fade-in"&&nowTime-this._loaderStartTime>=SPLASH_FADE_DURATION&&this._splashFrameNumber>=2){this._splashState="wait";this._splashFadeInFinishTime=nowTime;}if(this._splashState==="wait"&&nowTime-this._splashFadeInFinishTime>=splashMinDisplayTime&&this._loadingProgress>=1){this._splashState="fade-out";this._splashFadeOutStartTime=nowTime;}if(this._splashState==="fade-out"&&nowTime-this._splashFadeOutStartTime>=SPLASH_FADE_DURATION+splashAfterFadeOutWait||allowQuickSplash&&this._loadingProgress>=1&&nowTime-this._loaderStartTime<500)this._splashDoneResolve();}}],[{key:"_FullscreenModeNumberToString",value:function _FullscreenModeNumberToString(n){switch(n){case 0:return"off";case 1:return"crop";case 2:return"scale-inner";case 3:return"scale-outer";case 4:return"letterbox-scale";case 5:return"letterbox-integer-scale";default:throw new Error("invalid fullscreen mode");}}}]);return CanvasManager;}(_C183.DefendedBase);}// runtime.js
{'use strict';var _C184=self.C3;var _C3Debugger3=self.C3Debugger;var _assert17=self.assert;var DEFAULT_RUNTIME_OPTS={"messagePort":null,"runtimeBaseUrl":"","headless":false,"hasDom":true,"isInWorker":false,"useAudio":true,"projectData":"","exportType":""};var ife=true;_C184.Runtime=/*#__PURE__*/function(_C184$DefendedBase){_inherits(C3Runtime,_C184$DefendedBase);function C3Runtime(opts){var _this160;_classCallCheck(this,C3Runtime);opts=Object.assign({},DEFAULT_RUNTIME_OPTS,opts);_this160=_possibleConstructorReturn(this,_getPrototypeOf(C3Runtime).call(this));_this160._messagePort=opts["messagePort"];_this160._runtimeBaseUrl=opts["runtimeBaseUrl"];_this160._previewUrl=opts["previewUrl"];_this160._isHeadless=!!opts["headless"];_this160._hasDom=!!opts["hasDom"];_this160._isInWorker=!!opts["isInWorker"];ife=opts["ife"];_this160._useAudio=!!opts["useAudio"];_this160._exportType=opts["exportType"];_this160._isiOSCordova=!!opts["isiOSCordova"];_this160._isiOSWebView=!!opts["isiOSWebView"];_this160._isWindowsWebView2=!!opts["isWindowsWebView2"];_this160._isAnyWebView2Wrapper=!!opts["isAnyWebView2Wrapper"];_this160._isFBInstantAvailable=!!opts["isFBInstantAvailable"];_this160._opusWasmScriptUrl=opts["opusWasmScriptUrl"];_this160._opusWasmBinaryUrl=opts["opusWasmBinaryUrl"];_this160._isDebug=!!(_this160._exportType==="preview"&&opts["isDebug"]);_this160._breakpointsEnabled=_this160._isDebug;_this160._isDebugging=_this160._isDebug;_this160._debuggingDisabled=0;_this160._additionalLoadPromises=[];_this160._additionalCreatePromises=[];_this160._isUsingCreatePromises=false;_this160._projectName="";_this160._projectVersion="";_this160._projectUniqueId="";_this160._appId="";_this160._originalViewportWidth=0;_this160._originalViewportHeight=0;_this160._devicePixelRatio=self.devicePixelRatio;_this160._parallaxXorigin=0;_this160._parallaxYorigin=0;_this160._viewportWidth=0;_this160._viewportHeight=0;_this160._loaderStyle=0;_this160._usesLoaderLayout=false;_this160._isLoading=true;_this160._usesAnyBackgroundBlending=false;_this160._usesAnyCrossSampling=false;_this160._usesAnyDepthSampling=false;_this160._loadingLogoAsset=null;_this160._assetManager=_C184.New(_C184.AssetManager,_assertThisInitialized(_this160),opts);_this160._layoutManager=_C184.New(_C184.LayoutManager,_assertThisInitialized(_this160));_this160._eventSheetManager=_C184.New(_C184.EventSheetManager,_assertThisInitialized(_this160));_this160._pluginManager=_C184.New(_C184.PluginManager,_assertThisInitialized(_this160),opts["wrapperComponentIds"]);_this160._collisionEngine=_C184.New(_C184.CollisionEngine,_assertThisInitialized(_this160));_this160._timelineManager=_C184.New(_C184.TimelineManager,_assertThisInitialized(_this160));_this160._transitionManager=_C184.New(_C184.TransitionManager,_assertThisInitialized(_this160));_this160._templateManager=_C184.New(_C184.TemplateManager,_assertThisInitialized(_this160));_this160._flowchartManager=_C184.New(_C184.FlowchartManager,_assertThisInitialized(_this160));_this160._textIconManager=_C184.New(_C184.TextIconManager,{getIconSetMeta:function getIconSetMeta(iconSource){return _this160._GetTextIconSetMeta(iconSource);},getIconSetContent:function getIconSetContent(iconSource){return _this160._GetTextIconSetContent(iconSource);}});_this160._iconChangeHandlers=new Map();_this160._allObjectClasses=[];_this160._objectClassesByName=new Map();_this160._objectClassesBySid=new Map();_this160._familyCount=0;_this160._allContainers=[];_this160._allEffectLists=new Set();_this160._currentLayoutStack=[];_this160._instancesPendingCreate=[];_this160._instancesPendingDestroy=new Map();_this160._hasPendingInstances=false;_this160._isFlushingPendingInstances=false;_this160._objectCount=0;_this160._nextUid=0;_this160._instancesByUid=new Map();_this160._instancesToReleaseAtEndOfTick=new Set();_this160._instancesToReleaseAffectedObjectClasses=new Set();_this160._objectReferenceTable=[];_this160._jsPropNameTable=[];_this160._canvasManager=null;_this160._uses3dFeatures=false;_this160._framerateMode="vsync";_this160._compositingMode="standard";_this160._sampling="trilinear";_this160._isPixelRoundingEnabled=false;_this160._needRender=true;_this160._pauseOnBlur=false;_this160._isPausedOnBlur=false;_this160._exportToVideo=null;_this160._tickCallbacks={normal:function normal(timestamp){_this160._rafId=-1;_this160._ruafId=-1;_this160.Tick(timestamp);},tickOnly:function tickOnly(timestamp){_this160._ruafId=-1;_this160.Tick(timestamp,false,"skip-render");},renderOnly:function renderOnly(){_this160._rafId=-1;_this160.Render();}};_this160._rafId=-1;_this160._ruafId=-1;_this160._tickCount=0;_this160._tickCountNoSave=0;_this160._hasStarted=false;_this160._isInTick=false;_this160._hasStartedTicking=false;_this160._isLayoutFirstTick=true;_this160._suspendCount=0;_this160._scheduleTriggersThrottle=new _C184.PromiseThrottle(1);_this160._randomNumberCallback=function(){return Math.random();};_this160._startTime=0;_this160._lastTickTime=0;_this160._dtRaw=0;_this160._dt1=0;_this160._dt=0;_this160._timeScale=1;_this160._minimumFramerate=30;_this160._gameTime=_C184.New(_C184.KahanSum);_this160._gameTimeRaw=_C184.New(_C184.KahanSum);_this160._wallTime=_C184.New(_C184.KahanSum);_this160._instanceTimes=new Map();_this160._fpsFrameCount=-1;_this160._fpsLastTime=0;_this160._fps=0;_this160._mainThreadTimeCounter=0;_this160._mainThreadTime=0;_this160._isLoadingState=false;_this160._saveToSlotName="";_this160._loadFromSlotName="";_this160._loadFromJson=null;_this160._lastSaveJson="";_this160._projectStorage=null;_this160._savegamesStorage=null;_this160._dispatcher=_C184.New(_C184.Event.Dispatcher);_this160._domEventHandlers=new Map();_this160._pendingResponsePromises=new Map();_this160._nextDomResponseId=0;_this160._didRequestDeviceOrientationEvent=false;_this160._didRequestDeviceMotionEvent=false;_this160._isReadyToHandleEvents=false;_this160._waitingToHandleEvents=[];_this160._eventObjects={"pretick":_C184.New(_C184.Event,"pretick",false),"tick":_C184.New(_C184.Event,"tick",false),"tick2":_C184.New(_C184.Event,"tick2",false),"instancedestroy":_C184.New(_C184.Event,"instancedestroy",false),"beforelayoutchange":_C184.New(_C184.Event,"beforelayoutchange",false),"layoutchange":_C184.New(_C184.Event,"layoutchange",false)};_this160._eventObjects["instancedestroy"].instance=null;_this160._userScriptDispatcher=_C184.New(_C184.Event.Dispatcher);_this160._userScriptEventObjects=null;_this160._behInstsToTick=_C184.New(_C184.RedBlackSet,_C184.BehaviorInstance.SortByTickSequence);_this160._behInstsToPostTick=_C184.New(_C184.RedBlackSet,_C184.BehaviorInstance.SortByTickSequence);_this160._behInstsToTick2=_C184.New(_C184.RedBlackSet,_C184.BehaviorInstance.SortByTickSequence);_this160._jobScheduler=_C184.New(_C184.JobSchedulerRuntime,_assertThisInitialized(_this160),opts["jobScheduler"]);if(opts["canvas"])_this160._canvasManager=_C184.New(_C184.CanvasManager,_assertThisInitialized(_this160));_this160._messagePort.onmessage=function(e){return _this160["_OnMessageFromDOM"](e.data);};_this160.AddDOMComponentMessageHandler("runtime","visibilitychange",function(e){return _this160._OnVisibilityChange(e);});_this160.AddDOMComponentMessageHandler("runtime","wrapper-extension-message",function(e){return _this160._OnWrapperExtensionMessage(e);});_this160.AddDOMComponentMessageHandler("runtime","opus-decode",function(e){return _this160._WasmDecodeWebMOpus(e["arrayBuffer"]);});_this160.AddDOMComponentMessageHandler("runtime","get-remote-preview-status-info",function(){return _this160._GetRemotePreviewStatusInfo();});_this160.AddDOMComponentMessageHandler("runtime","js-invoke-function",function(e){return _this160._InvokeFunctionFromJS(e);});_this160.AddDOMComponentMessageHandler("runtime","go-to-last-error-script",self["goToLastErrorScript"]);_this160.AddDOMComponentMessageHandler("runtime","offline-audio-render-completed",function(e){return _this160._OnOfflineAudioRenderCompleted(e);});_this160._dispatcher.addEventListener("window-blur",function(e){return _this160._OnWindowBlur(e);});_this160._dispatcher.addEventListener("window-focus",function(){return _this160._OnWindowFocus();});_this160._timelineManager.AddRuntimeListeners();_this160._templateManager.AddRuntimeListeners();_this160._iRuntime=null;_this160._interfaceMap=new WeakMap();_this160._commonScriptInterfaces={keyboard:null,mouse:null,touch:null};_this160._instancesNeedingAfterLoadMap=new WeakMap();_this160._instancesNeedingAfterLoadArray=[];return _this160;}_createClass(C3Runtime,[{key:"Release",value:function Release(){_C184.clearArray(this._allObjectClasses);this._objectClassesByName.clear();this._objectClassesBySid.clear();this._layoutManager.Release();this._layoutManager=null;this._eventSheetManager.Release();this._eventSheetManager=null;this._pluginManager.Release();this._pluginManager=null;this._assetManager.Release();this._assetManager=null;this._collisionEngine.Release();this._collisionEngine=null;this._timelineManager.Release();this._timelineManager=null;this._transitionManager.Release();this._transitionManager=null;this._templateManager.Release();this._templateManager=null;this._flowchartManager.Release();this._flowchartManager=null;this._textIconManager.Release();this._textIconManager=null;if(this._canvasManager){this._canvasManager.Release();this._canvasManager=null;}this._dispatcher.Release();this._dispatcher=null;this._tickEvent=null;}},{key:"_OnMessageFromDOM",value:function _OnMessageFromDOM(data){var type=data["type"];if(type==="event")this._OnEventFromDOM(data);else if(type==="result")this._OnResultFromDOM(data);else throw new Error("unknown message '".concat(type,"'"));}},{key:"_OnEventFromDOM",value:function _OnEventFromDOM(e){var _this161=this;if(!this._isReadyToHandleEvents){this._waitingToHandleEvents.push(e);return;}var component=e["component"];var handler=e["handler"];var data=e["data"];var dispatchOpts=e["dispatchOpts"];var dispatchRuntimeEvent=!!(dispatchOpts&&dispatchOpts["dispatchRuntimeEvent"]);var dispatchUserScriptEvent=!!(dispatchOpts&&dispatchOpts["dispatchUserScriptEvent"]);var responseId=e["responseId"];if(component==="runtime"){if(dispatchRuntimeEvent){var event=new _C184.Event(handler);event.data=data;this._dispatcher.dispatchEventAndWaitAsyncSequential(event);}if(dispatchUserScriptEvent){var _event=new _C184.Event(handler,true);for(var _i65=0,_Object$entries20=Object.entries(data);_i65<_Object$entries20.length;_i65++){var _Object$entries20$_i=_slicedToArray(_Object$entries20[_i65],2),key=_Object$entries20$_i[0],value=_Object$entries20$_i[1];_event[key]=value;}this.DispatchUserScriptEvent(_event);}}var handlerMap=this._domEventHandlers.get(component);if(!handlerMap){if(!dispatchRuntimeEvent&&!dispatchUserScriptEvent)console.warn("[Runtime] No DOM event handlers for component '".concat(component,"'"));return;}var func=handlerMap.get(handler);if(!func){if(!dispatchRuntimeEvent&&!dispatchUserScriptEvent)console.warn("[Runtime] No DOM handler '".concat(handler,"' for component '").concat(component,"'"));return;}var ret=null;try{ret=func(data);}catch(err){console.error("Exception in '".concat(component,"' handler '").concat(handler,"':"),err);if(responseId!==null)this._PostResultToDOM(responseId,false,""+err);return;}if(responseId!==null)if(ret&&ret.then)ret.then(function(result){return _this161._PostResultToDOM(responseId,true,result);})["catch"](function(err){console.error("Rejection from '".concat(component,"' handler '").concat(handler,"':"),err);_this161._PostResultToDOM(responseId,false,""+err);});else this._PostResultToDOM(responseId,true,ret);}},{key:"_PostResultToDOM",value:function _PostResultToDOM(responseId,isOk,result){this._messagePort.postMessage({"type":"result","responseId":responseId,"isOk":isOk,"result":result});}},{key:"_OnResultFromDOM",value:function _OnResultFromDOM(data){var responseId=data["responseId"];var isOk=data["isOk"];var result=data["result"];var pendingPromise=this._pendingResponsePromises.get(responseId);if(isOk)pendingPromise.resolve(result);else pendingPromise.reject(result);this._pendingResponsePromises["delete"](responseId);}},{key:"AddDOMComponentMessageHandler",value:function AddDOMComponentMessageHandler(component,handler,func){var handlerMap=this._domEventHandlers.get(component);if(!handlerMap){handlerMap=new Map();this._domEventHandlers.set(component,handlerMap);}if(handlerMap.has(handler))throw new Error("[Runtime] Component '".concat(component,"' already has handler '").concat(handler,"'"));handlerMap.set(handler,func);}},{key:"PostComponentMessageToDOM",value:function PostComponentMessageToDOM(component,handler,data,transfer){this._messagePort.postMessage({"type":"event","component":component,"handler":handler,"data":data,"responseId":null},transfer);}},{key:"PostComponentMessageToDOMAsync",value:function PostComponentMessageToDOMAsync(component,handler,data,transfer){var _this162=this;var responseId=this._nextDomResponseId++;var ret=new Promise(function(resolve,reject){_this162._pendingResponsePromises.set(responseId,{resolve:resolve,reject:reject});});this._messagePort.postMessage({"type":"event","component":component,"handler":handler,"data":data,"responseId":responseId},transfer);return ret;}},{key:"SendWrapperExtensionMessage",value:function SendWrapperExtensionMessage(componentId,messageId,params){var asyncId=arguments.length>3&&arguments[3]!==undefined?arguments[3]:-1;this.PostComponentMessageToDOM("runtime","send-wrapper-extension-message",{"componentId":componentId,"messageId":messageId,"params":params,"asyncId":asyncId});}},{key:"SendWrapperExtensionMessageAsync",value:function SendWrapperExtensionMessageAsync(componentId,messageId,params){var _this163=this;var responseId=this._nextDomResponseId++;var ret=new Promise(function(resolve,reject){_this163._pendingResponsePromises.set(responseId,{resolve:resolve,reject:reject});});this.SendWrapperExtensionMessage(componentId,messageId,params,responseId);return ret;}},{key:"_OnWrapperExtensionMessage",value:function _OnWrapperExtensionMessage(data){if(data["asyncId"]!==-1){var responseId=data["asyncId"];var pendingPromise=this._pendingResponsePromises.get(responseId);pendingPromise.resolve(data["params"]);this._pendingResponsePromises["delete"](responseId);}else this._OnEventFromDOM({"component":"wrapper-extension:"+data["componentId"],"handler":data["messageId"],"data":data["params"],"responseId":null});}},{key:"AddWrapperExtensionMessageHandler",value:function AddWrapperExtensionMessageHandler(componentId,messageId,func){this.AddDOMComponentMessageHandler("wrapper-extension:"+componentId,messageId,func);}},{key:"HasWrapperComponentId",value:function HasWrapperComponentId(id){return this._pluginManager.HasWrapperComponentId(id);}},{key:"PostToDebugger",value:function PostToDebugger(data){if(!this.IsDebug())throw new Error("not in debug mode");this.PostComponentMessageToDOM("runtime","post-to-debugger",data);}},{key:"Init",value:function Init(opts){var _ref10,_ref11,o,webglRenderer,_iteratorNormalCompletion502,_didIteratorError502,_iteratorError502,_iterator502,_step502,e,_iteratorNormalCompletion503,_didIteratorError503,_iteratorError503,_iterator503,_step503,f;return regeneratorRuntime.async(function Init$(_context182){while(1){switch(_context182.prev=_context182.next){case 0:if(!this.IsDebug()){_context182.next=5;break;}_context182.next=3;return regeneratorRuntime.awrap(_C3Debugger3.Init(this));case 3:_context182.next=6;break;case 5:if(self.C3Debugger)self.C3Debugger.InitPreview(this);case 6:_context182.next=8;return regeneratorRuntime.awrap(Promise.all([this._assetManager.FetchJson("data.json"),this._MaybeLoadOpusDecoder(),this._jobScheduler.Init()]));case 8:_ref10=_context182.sent;_ref11=_slicedToArray(_ref10,1);o=_ref11[0];_context182.next=13;return regeneratorRuntime.awrap(this._LoadDataJson(o));case 13:_context182.next=15;return regeneratorRuntime.awrap(this._InitialiseCanvas(opts));case 15:if(!this.IsPreview())console.info("Made with Construct, the game and app creator :: https://www.construct.net");if(this.GetWebGLRenderer()){webglRenderer=this.GetWebGLRenderer();console.info("[C3 runtime] Hosted in ".concat(this.IsInWorker()?"worker":"DOM",", rendering with WebGL ").concat(webglRenderer.GetWebGLVersionNumber()," [").concat(webglRenderer.GetUnmaskedRenderer(),"] (").concat(webglRenderer.IsDesynchronized()?"desynchronized":"standard"," compositing)"));}else if(this.GetWebGPURenderer())console.info("[C3 runtime] Hosted in ".concat(this.IsInWorker()?"worker":"DOM",", rendering with WebGPU [").concat(this.GetWebGPURenderer().GetAdapterInfoString(),"]"));if(this.GetRenderer().HasMajorPerformanceCaveat())console.warn("[C3 runtime] The renderer indicates a major performance caveat. Software rendering may be in use. This can result in significantly degraded performance.");this._isReadyToHandleEvents=true;_iteratorNormalCompletion502=true;_didIteratorError502=false;_iteratorError502=undefined;_context182.prev=22;for(_iterator502=this._waitingToHandleEvents[Symbol.iterator]();!(_iteratorNormalCompletion502=(_step502=_iterator502.next()).done);_iteratorNormalCompletion502=true){e=_step502.value;this._OnEventFromDOM(e);}_context182.next=30;break;case 26:_context182.prev=26;_context182.t0=_context182["catch"](22);_didIteratorError502=true;_iteratorError502=_context182.t0;case 30:_context182.prev=30;_context182.prev=31;if(!_iteratorNormalCompletion502&&_iterator502["return"]!=null){_iterator502["return"]();}case 33:_context182.prev=33;if(!_didIteratorError502){_context182.next=36;break;}throw _iteratorError502;case 36:return _context182.finish(33);case 37:return _context182.finish(30);case 38:_C184.clearArray(this._waitingToHandleEvents);if(this._canvasManager)this._canvasManager.StartLoadingScreen();_iteratorNormalCompletion503=true;_didIteratorError503=false;_iteratorError503=undefined;_context182.prev=43;for(_iterator503=opts["runOnStartupFunctions"][Symbol.iterator]();!(_iteratorNormalCompletion503=(_step503=_iterator503.next()).done);_iteratorNormalCompletion503=true){f=_step503.value;this._additionalLoadPromises.push(this._RunOnStartupFunction(f));}_context182.next=51;break;case 47:_context182.prev=47;_context182.t1=_context182["catch"](43);_didIteratorError503=true;_iteratorError503=_context182.t1;case 51:_context182.prev=51;_context182.prev=52;if(!_iteratorNormalCompletion503&&_iterator503["return"]!=null){_iterator503["return"]();}case 54:_context182.prev=54;if(!_didIteratorError503){_context182.next=57;break;}throw _iteratorError503;case 57:return _context182.finish(54);case 58:return _context182.finish(51);case 59:_context182.next=61;return regeneratorRuntime.awrap(Promise.all([this._assetManager.WaitForAllToLoad()].concat(_toConsumableArray(this._additionalLoadPromises))));case 61:_C184.clearArray(this._additionalLoadPromises);if(!this._assetManager.HasHadErrorLoading()){_context182.next=65;break;}if(this._canvasManager)this._canvasManager.HideCordovaSplashScreen();return _context182.abrupt("return");case 65:if(!this._canvasManager){_context182.next=68;break;}_context182.next=68;return regeneratorRuntime.awrap(this._canvasManager.EndLoadingScreen());case 68:_context182.next=70;return regeneratorRuntime.awrap(this._dispatcher.dispatchEventAndWaitAsync(new _C184.Event("beforeruntimestart")));case 70:_context182.next=72;return regeneratorRuntime.awrap(this.Start());case 72:this._messagePort.postMessage({"type":"runtime-ready"});return _context182.abrupt("return",this);case 74:case"end":return _context182.stop();}}},null,this,[[22,26,30,38],[31,,33,37],[43,47,51,59],[52,,54,58]]);}},{key:"_RunOnStartupFunction",value:function _RunOnStartupFunction(f){return regeneratorRuntime.async(function _RunOnStartupFunction$(_context183){while(1){switch(_context183.prev=_context183.next){case 0:_context183.prev=0;_context183.next=3;return regeneratorRuntime.awrap(f(this._iRuntime));case 3:_context183.next=8;break;case 5:_context183.prev=5;_context183.t0=_context183["catch"](0);console.error("[C3 runtime] Error in runOnStartup function: ",_context183.t0);case 8:case"end":return _context183.stop();}}},null,this,[[0,5]]);}},{key:"_LoadDataJson",value:function _LoadDataJson(o){var _this164=this;var projectData,loadingLogoFilename,assetManager,url,exportToVideoOpts,_iteratorNormalCompletion504,_didIteratorError504,_iteratorError504,_iterator504,_step504,pluginData,_iteratorNormalCompletion505,_didIteratorError505,_iteratorError505,_iterator505,_step505,objectClassData,objectClass,_iteratorNormalCompletion506,_didIteratorError506,_iteratorError506,_iterator506,_step506,familyData,familyType,_iteratorNormalCompletion507,_didIteratorError507,_iteratorError507,_iterator507,_step507,containerData,containerTypes,_iteratorNormalCompletion508,_didIteratorError508,_iteratorError508,_iterator508,_step508,_objectClass8,_iteratorNormalCompletion509,_didIteratorError509,_iteratorError509,_iterator509,_step509,layoutData,firstLayoutName,firstLayout,_iteratorNormalCompletion510,_didIteratorError510,_iteratorError510,_iterator510,_step510,timelineData,_iteratorNormalCompletion511,_didIteratorError511,_iteratorError511,_iterator511,_step511,transitionData,_iteratorNormalCompletion512,_didIteratorError512,_iteratorError512,_iterator512,_step512,templateInstanceData,_iteratorNormalCompletion513,_didIteratorError513,_iteratorError513,_iterator513,_step513,flowchartData,_iteratorNormalCompletion514,_didIteratorError514,_iteratorError514,_iterator514,_step514,eventSheetData,targetOrientation,orientations;return regeneratorRuntime.async(function _LoadDataJson$(_context184){while(1){switch(_context184.prev=_context184.next){case 0:projectData=o["project"];this._projectName=projectData[0];this._projectVersion=projectData[16];this._projectUniqueId=projectData[31];this._appId=projectData[38];loadingLogoFilename=projectData[39]||"loading-logo.png";this._isPixelRoundingEnabled=!!projectData[9];this._originalViewportWidth=this._viewportWidth=projectData[10];this._originalViewportHeight=this._viewportHeight=projectData[11];this._collisionEngine._InitCollisionCellSize(this._originalViewportWidth,this._originalViewportHeight);this._parallaxXorigin=this._originalViewportWidth/2;this._parallaxYorigin=this._originalViewportHeight/2;this._compositingMode=projectData[36];this._framerateMode=projectData[37];if(this._compositingMode==="low-latency"&&this.IsAndroidWebView()&&_C184.Platform.BrowserVersionNumber<=77){console.warn("[C3 runtime] Desynchronized (low-latency) compositing is enabled, but is disabled in the Android WebView <=77 due to crbug.com/1008842. Reverting to synchronized (standard) compositing.");this._compositingMode="standard";}this._uses3dFeatures=!!projectData[40];this._sampling=projectData[14];this._usesAnyBackgroundBlending=projectData[15];this._usesAnyCrossSampling=projectData[42];this._usesAnyDepthSampling=projectData[17];this._usesLoaderLayout=!!projectData[18];this._loaderStyle=projectData[19];this._nextUid=projectData[21];this._pauseOnBlur=projectData[22];assetManager=this._assetManager;assetManager._SetFileStructure(projectData[45]);assetManager._SetAudioFiles(projectData[7],projectData[25]);assetManager._SetMediaSubfolder(projectData[8]);assetManager._SetFontsSubfolder(projectData[32]);assetManager._SetIconsSubfolder(projectData[28]);assetManager._SetWebFonts(projectData[29]);if(this._loaderStyle===0){url="";if(this.IsPreview()){if(assetManager._HasLocalUrlBlob(loadingLogoFilename))url=assetManager.GetLocalUrlAsBlobUrl(loadingLogoFilename);}else if(assetManager.GetFileStructure()==="flat")url=assetManager.GetIconsSubfolder()+loadingLogoFilename;else url=loadingLogoFilename;if(url)this._loadingLogoAsset=assetManager.LoadImage({url:url});}if(this._canvasManager){this._canvasManager.SetFullscreenMode(_C184.CanvasManager._FullscreenModeNumberToString(projectData[12]));this._canvasManager.SetFullscreenScalingQuality(projectData[23]?"high":"low");this._canvasManager.SetMipmapsEnabled(projectData[24]!==0);this._canvasManager._SetGPUPowerPreference(projectData[34]);this._canvasManager._SetTextureAnisotropy(projectData[41]);this._canvasManager._SetWebGPUEnabled(projectData[13]);this._canvasManager._SetZAxisScale(projectData[30]);this._canvasManager._SetZDistances(projectData[46],projectData[47]);this._canvasManager._SetFieldOfView(projectData[26]);this._canvasManager._SetLimitedToWebGL1(projectData[48]);}exportToVideoOpts=projectData[43];if(!exportToVideoOpts){_context184.next=37;break;}_context184.next=37;return regeneratorRuntime.awrap(this._LoadExportToVideoData(exportToVideoOpts));case 37:this._pluginManager.CreateSystemPlugin();this._objectReferenceTable=self.C3_GetObjectRefTable();_iteratorNormalCompletion504=true;_didIteratorError504=false;_iteratorError504=undefined;_context184.prev=42;for(_iterator504=projectData[2][Symbol.iterator]();!(_iteratorNormalCompletion504=(_step504=_iterator504.next()).done);_iteratorNormalCompletion504=true){pluginData=_step504.value;this._pluginManager.CreatePlugin(pluginData);}_context184.next=50;break;case 46:_context184.prev=46;_context184.t0=_context184["catch"](42);_didIteratorError504=true;_iteratorError504=_context184.t0;case 50:_context184.prev=50;_context184.prev=51;if(!_iteratorNormalCompletion504&&_iterator504["return"]!=null){_iterator504["return"]();}case 53:_context184.prev=53;if(!_didIteratorError504){_context184.next=56;break;}throw _iteratorError504;case 56:return _context184.finish(53);case 57:return _context184.finish(50);case 58:this._objectReferenceTable=self.C3_GetObjectRefTable();this._LoadJsPropNameTable();_iteratorNormalCompletion505=true;_didIteratorError505=false;_iteratorError505=undefined;_context184.prev=63;for(_iterator505=projectData[3][Symbol.iterator]();!(_iteratorNormalCompletion505=(_step505=_iterator505.next()).done);_iteratorNormalCompletion505=true){objectClassData=_step505.value;objectClass=_C184.ObjectClass.Create(this,this._allObjectClasses.length,objectClassData);this._allObjectClasses.push(objectClass);this._objectClassesByName.set(objectClass.GetName().toLowerCase(),objectClass);this._objectClassesBySid.set(objectClass.GetSID(),objectClass);}_context184.next=71;break;case 67:_context184.prev=67;_context184.t1=_context184["catch"](63);_didIteratorError505=true;_iteratorError505=_context184.t1;case 71:_context184.prev=71;_context184.prev=72;if(!_iteratorNormalCompletion505&&_iterator505["return"]!=null){_iterator505["return"]();}case 74:_context184.prev=74;if(!_didIteratorError505){_context184.next=77;break;}throw _iteratorError505;case 77:return _context184.finish(74);case 78:return _context184.finish(71);case 79:_iteratorNormalCompletion506=true;_didIteratorError506=false;_iteratorError506=undefined;_context184.prev=82;for(_iterator506=projectData[4][Symbol.iterator]();!(_iteratorNormalCompletion506=(_step506=_iterator506.next()).done);_iteratorNormalCompletion506=true){familyData=_step506.value;familyType=this._allObjectClasses[familyData[0]];familyType._LoadFamily(familyData);}_context184.next=90;break;case 86:_context184.prev=86;_context184.t2=_context184["catch"](82);_didIteratorError506=true;_iteratorError506=_context184.t2;case 90:_context184.prev=90;_context184.prev=91;if(!_iteratorNormalCompletion506&&_iterator506["return"]!=null){_iterator506["return"]();}case 93:_context184.prev=93;if(!_didIteratorError506){_context184.next=96;break;}throw _iteratorError506;case 96:return _context184.finish(93);case 97:return _context184.finish(90);case 98:_iteratorNormalCompletion507=true;_didIteratorError507=false;_iteratorError507=undefined;_context184.prev=101;for(_iterator507=projectData[27][Symbol.iterator]();!(_iteratorNormalCompletion507=(_step507=_iterator507.next()).done);_iteratorNormalCompletion507=true){containerData=_step507.value;containerTypes=containerData.map(function(index){return _this164._allObjectClasses[index];});this._allContainers.push(_C184.New(_C184.Container,this,containerTypes));}_context184.next=109;break;case 105:_context184.prev=105;_context184.t3=_context184["catch"](101);_didIteratorError507=true;_iteratorError507=_context184.t3;case 109:_context184.prev=109;_context184.prev=110;if(!_iteratorNormalCompletion507&&_iterator507["return"]!=null){_iterator507["return"]();}case 112:_context184.prev=112;if(!_didIteratorError507){_context184.next=115;break;}throw _iteratorError507;case 115:return _context184.finish(112);case 116:return _context184.finish(109);case 117:_iteratorNormalCompletion508=true;_didIteratorError508=false;_iteratorError508=undefined;_context184.prev=120;for(_iterator508=this._allObjectClasses[Symbol.iterator]();!(_iteratorNormalCompletion508=(_step508=_iterator508.next()).done);_iteratorNormalCompletion508=true){_objectClass8=_step508.value;_objectClass8._OnAfterCreate();}_context184.next=128;break;case 124:_context184.prev=124;_context184.t4=_context184["catch"](120);_didIteratorError508=true;_iteratorError508=_context184.t4;case 128:_context184.prev=128;_context184.prev=129;if(!_iteratorNormalCompletion508&&_iterator508["return"]!=null){_iterator508["return"]();}case 131:_context184.prev=131;if(!_didIteratorError508){_context184.next=134;break;}throw _iteratorError508;case 134:return _context184.finish(131);case 135:return _context184.finish(128);case 136:_iteratorNormalCompletion509=true;_didIteratorError509=false;_iteratorError509=undefined;_context184.prev=139;for(_iterator509=projectData[5][Symbol.iterator]();!(_iteratorNormalCompletion509=(_step509=_iterator509.next()).done);_iteratorNormalCompletion509=true){layoutData=_step509.value;this._layoutManager.Create(layoutData);}_context184.next=147;break;case 143:_context184.prev=143;_context184.t5=_context184["catch"](139);_didIteratorError509=true;_iteratorError509=_context184.t5;case 147:_context184.prev=147;_context184.prev=148;if(!_iteratorNormalCompletion509&&_iterator509["return"]!=null){_iterator509["return"]();}case 150:_context184.prev=150;if(!_didIteratorError509){_context184.next=153;break;}throw _iteratorError509;case 153:return _context184.finish(150);case 154:return _context184.finish(147);case 155:firstLayoutName=projectData[1];if(firstLayoutName){firstLayout=this._layoutManager.GetLayoutByName(firstLayoutName);if(firstLayout)this._layoutManager.SetFirstLayout(firstLayout);}_iteratorNormalCompletion510=true;_didIteratorError510=false;_iteratorError510=undefined;_context184.prev=160;for(_iterator510=projectData[33][Symbol.iterator]();!(_iteratorNormalCompletion510=(_step510=_iterator510.next()).done);_iteratorNormalCompletion510=true){timelineData=_step510.value;this._timelineManager.Create(timelineData);}_context184.next=168;break;case 164:_context184.prev=164;_context184.t6=_context184["catch"](160);_didIteratorError510=true;_iteratorError510=_context184.t6;case 168:_context184.prev=168;_context184.prev=169;if(!_iteratorNormalCompletion510&&_iterator510["return"]!=null){_iterator510["return"]();}case 171:_context184.prev=171;if(!_didIteratorError510){_context184.next=174;break;}throw _iteratorError510;case 174:return _context184.finish(171);case 175:return _context184.finish(168);case 176:_iteratorNormalCompletion511=true;_didIteratorError511=false;_iteratorError511=undefined;_context184.prev=179;for(_iterator511=projectData[35][Symbol.iterator]();!(_iteratorNormalCompletion511=(_step511=_iterator511.next()).done);_iteratorNormalCompletion511=true){transitionData=_step511.value;this._transitionManager.Create(transitionData);}_context184.next=187;break;case 183:_context184.prev=183;_context184.t7=_context184["catch"](179);_didIteratorError511=true;_iteratorError511=_context184.t7;case 187:_context184.prev=187;_context184.prev=188;if(!_iteratorNormalCompletion511&&_iterator511["return"]!=null){_iterator511["return"]();}case 190:_context184.prev=190;if(!_didIteratorError511){_context184.next=193;break;}throw _iteratorError511;case 193:return _context184.finish(190);case 194:return _context184.finish(187);case 195:_iteratorNormalCompletion512=true;_didIteratorError512=false;_iteratorError512=undefined;_context184.prev=198;for(_iterator512=projectData[44][Symbol.iterator]();!(_iteratorNormalCompletion512=(_step512=_iterator512.next()).done);_iteratorNormalCompletion512=true){templateInstanceData=_step512.value;this._templateManager.Create(templateInstanceData);}_context184.next=206;break;case 202:_context184.prev=202;_context184.t8=_context184["catch"](198);_didIteratorError512=true;_iteratorError512=_context184.t8;case 206:_context184.prev=206;_context184.prev=207;if(!_iteratorNormalCompletion512&&_iterator512["return"]!=null){_iterator512["return"]();}case 209:_context184.prev=209;if(!_didIteratorError512){_context184.next=212;break;}throw _iteratorError512;case 212:return _context184.finish(209);case 213:return _context184.finish(206);case 214:if(!this._templateManager.HasTemplates()){this._templateManager.Release();this._templateManager=null;}_iteratorNormalCompletion513=true;_didIteratorError513=false;_iteratorError513=undefined;_context184.prev=218;for(_iterator513=projectData[49][Symbol.iterator]();!(_iteratorNormalCompletion513=(_step513=_iterator513.next()).done);_iteratorNormalCompletion513=true){flowchartData=_step513.value;this._flowchartManager.Create(flowchartData);}_context184.next=226;break;case 222:_context184.prev=222;_context184.t9=_context184["catch"](218);_didIteratorError513=true;_iteratorError513=_context184.t9;case 226:_context184.prev=226;_context184.prev=227;if(!_iteratorNormalCompletion513&&_iterator513["return"]!=null){_iterator513["return"]();}case 229:_context184.prev=229;if(!_didIteratorError513){_context184.next=232;break;}throw _iteratorError513;case 232:return _context184.finish(229);case 233:return _context184.finish(226);case 234:if(!this._flowchartManager.HasFlowcharts()){this._flowchartManager.Release();this._flowchartManager=null;}this._InitScriptInterfaces();_iteratorNormalCompletion514=true;_didIteratorError514=false;_iteratorError514=undefined;_context184.prev=239;for(_iterator514=projectData[6][Symbol.iterator]();!(_iteratorNormalCompletion514=(_step514=_iterator514.next()).done);_iteratorNormalCompletion514=true){eventSheetData=_step514.value;this._eventSheetManager.Create(eventSheetData);}_context184.next=247;break;case 243:_context184.prev=243;_context184.t10=_context184["catch"](239);_didIteratorError514=true;_iteratorError514=_context184.t10;case 247:_context184.prev=247;_context184.prev=248;if(!_iteratorNormalCompletion514&&_iterator514["return"]!=null){_iterator514["return"]();}case 250:_context184.prev=250;if(!_didIteratorError514){_context184.next=253;break;}throw _iteratorError514;case 253:return _context184.finish(250);case 254:return _context184.finish(247);case 255:this._eventSheetManager._PostInit();this._InitGlobalVariableScriptInterface();_C184.clearArray(this._objectReferenceTable);this.FlushPendingInstances();targetOrientation="any";orientations=projectData[20];if(orientations===1)targetOrientation="portrait";else if(orientations===2)targetOrientation="landscape";this.PostComponentMessageToDOM("runtime","set-target-orientation",{"targetOrientation":targetOrientation});case 263:case"end":return _context184.stop();}}},null,this,[[42,46,50,58],[51,,53,57],[63,67,71,79],[72,,74,78],[82,86,90,98],[91,,93,97],[101,105,109,117],[110,,112,116],[120,124,128,136],[129,,131,135],[139,143,147,155],[148,,150,154],[160,164,168,176],[169,,171,175],[179,183,187,195],[188,,190,194],[198,202,206,214],[207,,209,213],[218,222,226,234],[227,,229,233],[239,243,247,255],[248,,250,254]]);}},{key:"_LoadExportToVideoData",value:function _LoadExportToVideoData(exportToVideoOpts){var format;return regeneratorRuntime.async(function _LoadExportToVideoData$(_context185){while(1){switch(_context185.prev=_context185.next){case 0:format=exportToVideoOpts["format"];if(format==="image-sequence")this._exportToVideo=new self.C3ExportToImageSequence(this,exportToVideoOpts);else if(format==="image-sequence-gif")this._exportToVideo=new self.C3ExportToGIF(this,exportToVideoOpts);else if(format==="webm")this._exportToVideo=new self.C3ExportToWebMVideo(this,exportToVideoOpts);else if(format==="mp4")this._exportToVideo=new self.C3ExportToMP4Video(this,exportToVideoOpts);else;this._framerateMode="unlimited-frame";this._canvasManager.SetFullscreenMode("off");this._devicePixelRatio=1;self.devicePixelRatio=1;_context185.next=8;return regeneratorRuntime.awrap(this.PostComponentMessageToDOMAsync("runtime","set-exporting-to-video",{"message":this._exportToVideo.GetExportingMessageForPercent(0),"duration":this._exportToVideo.GetDuration()}));case 8:case"end":return _context185.stop();}}},null,this);}},{key:"GetLoaderStyle",value:function GetLoaderStyle(){return this._loaderStyle;}},{key:"IsExportToVideo",value:function IsExportToVideo(){return this._exportToVideo!==null;}},{key:"GetExportVideoDuration",value:function GetExportVideoDuration(){return this._exportToVideo.GetDuration();}},{key:"GetExportVideoFramerate",value:function GetExportVideoFramerate(){return this._exportToVideo.GetFramerate();}},{key:"_InitExportToVideo",value:function _InitExportToVideo(){return this._exportToVideo.Init({width:this._canvasManager.GetDeviceWidth(),height:this._canvasManager.GetDeviceHeight()});}},{key:"_ExportToVideoAddFrame",value:function _ExportToVideoAddFrame(){var time=this._tickCount/this.GetExportVideoFramerate();return this._exportToVideo.AddFrame(this._canvasManager.GetMainCanvas(),time);}},{key:"_ExportToVideoAddKeyframe",value:function _ExportToVideoAddKeyframe(){if(this._exportToVideo)this._exportToVideo.AddKeyframe();}},{key:"_OnOfflineAudioRenderCompleted",value:function _OnOfflineAudioRenderCompleted(e){this._exportToVideo.OnOfflineAudioRenderCompleted(e);}},{key:"_ExportToVideoFinish",value:function _ExportToVideoFinish(){return this._exportToVideo.Finish();}},{key:"IsFBInstantAvailable",value:function IsFBInstantAvailable(){return this._isFBInstantAvailable;}},{key:"IsLoading",value:function IsLoading(){return this._isLoading;}},{key:"AddLoadPromise",value:function AddLoadPromise(promise){this._additionalLoadPromises.push(promise);}},{key:"SetUsingCreatePromises",value:function SetUsingCreatePromises(e){this._isUsingCreatePromises=!!e;}},{key:"AddCreatePromise",value:function AddCreatePromise(promise){if(!this._isUsingCreatePromises)return;this._additionalCreatePromises.push(promise);}},{key:"GetCreatePromises",value:function GetCreatePromises(){return this._additionalCreatePromises;}},{key:"_GetNextFamilyIndex",value:function _GetNextFamilyIndex(){return this._familyCount++;}},{key:"GetFamilyCount",value:function GetFamilyCount(){return this._familyCount;}},{key:"_AddEffectList",value:function _AddEffectList(el){this._allEffectLists.add(el);}},{key:"_RemoveEffectList",value:function _RemoveEffectList(el){this._allEffectLists["delete"](el);}},{key:"_GetAllEffectLists",value:function _GetAllEffectLists(){return this._allEffectLists;}},{key:"_InitialiseCanvas",value:function _InitialiseCanvas(opts){return regeneratorRuntime.async(function _InitialiseCanvas$(_context186){while(1){switch(_context186.prev=_context186.next){case 0:if(this._canvasManager){_context186.next=2;break;}return _context186.abrupt("return");case 2:_context186.next=4;return regeneratorRuntime.awrap(this._canvasManager.CreateCanvas(opts));case 4:this._canvasManager.InitLoadingScreen(this._loaderStyle);case 5:case"end":return _context186.stop();}}},null,this);}},{key:"_MaybeLoadOpusDecoder",value:function _MaybeLoadOpusDecoder(){var wasmBlob,wasmBuffer;return regeneratorRuntime.async(function _MaybeLoadOpusDecoder$(_context187){while(1){switch(_context187.prev=_context187.next){case 0:if(!this._assetManager.IsAudioFormatSupported("audio/webm; codecs=opus")){_context187.next=2;break;}return _context187.abrupt("return");case 2:wasmBlob=null;wasmBuffer=null;_context187.prev=4;if(!(this.IsiOSCordova()&&this._assetManager.IsFileProtocol())){_context187.next=11;break;}_context187.next=8;return regeneratorRuntime.awrap(this._assetManager.CordovaFetchLocalFileAsArrayBuffer(this._opusWasmBinaryUrl));case 8:wasmBuffer=_context187.sent;_context187.next=14;break;case 11:_context187.next=13;return regeneratorRuntime.awrap(this._assetManager.FetchArrayBuffer(this._opusWasmBinaryUrl));case 13:wasmBuffer=_context187.sent;case 14:_context187.next=20;break;case 16:_context187.prev=16;_context187.t0=_context187["catch"](4);console.info("Failed to fetch Opus decoder WASM; assuming project has no Opus audio.",_context187.t0);return _context187.abrupt("return");case 20:if(wasmBuffer)this.AddJobWorkerBuffer(wasmBuffer,"opus-decoder-wasm");else this.AddJobWorkerBlob(wasmBlob,"opus-decoder-wasm");_context187.next=23;return regeneratorRuntime.awrap(this.AddJobWorkerScripts([this._opusWasmScriptUrl]));case 23:case"end":return _context187.stop();}}},null,this,[[4,16]]);}},{key:"_WasmDecodeWebMOpus",value:function _WasmDecodeWebMOpus(arrayBuffer){var result;return regeneratorRuntime.async(function _WasmDecodeWebMOpus$(_context188){while(1){switch(_context188.prev=_context188.next){case 0:_context188.next=2;return regeneratorRuntime.awrap(this.AddJob("OpusDecode",{"arrayBuffer":arrayBuffer},[arrayBuffer]));case 2:result=_context188.sent;return _context188.abrupt("return",result);case 4:case"end":return _context188.stop();}}},null,this);}},{key:"Start",value:function Start(){var _this165=this;var _iteratorNormalCompletion515,_didIteratorError515,_iteratorError515,_iterator515,_step515,objectClass,_iteratorNormalCompletion516,_didIteratorError516,_iteratorError516,_iterator516,_step516,layout,firstLayout,state;return regeneratorRuntime.async(function Start$(_context189){while(1){switch(_context189.prev=_context189.next){case 0:this._hasStarted=true;this._startTime=Date.now();if(!this._usesLoaderLayout){_context189.next=25;break;}_iteratorNormalCompletion515=true;_didIteratorError515=false;_iteratorError515=undefined;_context189.prev=6;for(_iterator515=this._allObjectClasses[Symbol.iterator]();!(_iteratorNormalCompletion515=(_step515=_iterator515.next()).done);_iteratorNormalCompletion515=true){objectClass=_step515.value;if(!objectClass.IsFamily()&&!objectClass.IsOnLoaderLayout()&&objectClass.IsWorldType())objectClass.OnCreate();}_context189.next=14;break;case 10:_context189.prev=10;_context189.t0=_context189["catch"](6);_didIteratorError515=true;_iteratorError515=_context189.t0;case 14:_context189.prev=14;_context189.prev=15;if(!_iteratorNormalCompletion515&&_iterator515["return"]!=null){_iterator515["return"]();}case 17:_context189.prev=17;if(!_didIteratorError515){_context189.next=20;break;}throw _iteratorError515;case 20:return _context189.finish(17);case 21:return _context189.finish(14);case 22:this._assetManager.WaitForAllToLoad().then(function(){_this165._isLoading=false;_this165._OnLoadFinished();});_context189.next=26;break;case 25:this._isLoading=false;case 26:this._assetManager.SetInitialLoadFinished();if(this.IsDebug())_C3Debugger3.RuntimeInit(ife);_iteratorNormalCompletion516=true;_didIteratorError516=false;_iteratorError516=undefined;_context189.prev=31;for(_iterator516=this._layoutManager.GetAllLayouts()[Symbol.iterator]();!(_iteratorNormalCompletion516=(_step516=_iterator516.next()).done);_iteratorNormalCompletion516=true){layout=_step516.value;layout._CreateGlobalNonWorlds();}_context189.next=39;break;case 35:_context189.prev=35;_context189.t1=_context189["catch"](31);_didIteratorError516=true;_iteratorError516=_context189.t1;case 39:_context189.prev=39;_context189.prev=40;if(!_iteratorNormalCompletion516&&_iterator516["return"]!=null){_iterator516["return"]();}case 42:_context189.prev=42;if(!_didIteratorError516){_context189.next=45;break;}throw _iteratorError516;case 45:return _context189.finish(42);case 46:return _context189.finish(39);case 47:if(!this.IsExportToVideo()){_context189.next=50;break;}_context189.next=50;return regeneratorRuntime.awrap(this._InitExportToVideo());case 50:firstLayout=this._layoutManager.GetFirstLayout();_context189.next=53;return regeneratorRuntime.awrap(firstLayout._Load(null,this.GetRenderer()));case 53:_context189.next=55;return regeneratorRuntime.awrap(firstLayout._StartRunning(true));case 55:this._fpsLastTime=performance.now();if(!this._usesLoaderLayout)this._OnLoadFinished();_context189.next=59;return regeneratorRuntime.awrap(this.PostComponentMessageToDOMAsync("runtime","before-start-ticking"));case 59:state=_context189.sent;if(state["isSuspended"]&&!this.IsExportToVideo())this._suspendCount++;else this.Tick();case 61:case"end":return _context189.stop();}}},null,this,[[6,10,14,22],[15,,17,21],[31,35,39,47],[40,,42,46]]);}},{key:"_OnLoadFinished",value:function _OnLoadFinished(){this.Trigger(_C184.Plugins.System.Cnds.OnLoadFinished,null,null);this.PostComponentMessageToDOM("runtime","register-sw");}},{key:"GetObjectReference",value:function GetObjectReference(index){index=Math.floor(index);var objRefTable=this._objectReferenceTable;if(index<0||index>=objRefTable.length)throw new Error("invalid object reference");return objRefTable[index];}},{key:"_LoadJsPropNameTable",value:function _LoadJsPropNameTable(){var _iteratorNormalCompletion517=true;var _didIteratorError517=false;var _iteratorError517=undefined;try{for(var _iterator517=self.C3_JsPropNameTable[Symbol.iterator](),_step517;!(_iteratorNormalCompletion517=(_step517=_iterator517.next()).done);_iteratorNormalCompletion517=true){var entry=_step517.value;var propName=_C184.first(Object.keys(entry));this._jsPropNameTable.push(propName);}}catch(err){_didIteratorError517=true;_iteratorError517=err;}finally{try{if(!_iteratorNormalCompletion517&&_iterator517["return"]!=null){_iterator517["return"]();}}finally{if(_didIteratorError517){throw _iteratorError517;}}}}},{key:"GetJsPropName",value:function GetJsPropName(index){index=Math.floor(index);var jsPropNameTable=this._jsPropNameTable;if(index<0||index>=jsPropNameTable.length)throw new Error("invalid prop reference");return jsPropNameTable[index];}},{key:"HasDOM",value:function HasDOM(){return this._hasDom;}},{key:"IsHeadless",value:function IsHeadless(){return this._isHeadless;}},{key:"IsInWorker",value:function IsInWorker(){return this._isInWorker;}},{key:"GetRuntimeBaseURL",value:function GetRuntimeBaseURL(){return this._runtimeBaseUrl;}},{key:"GetPreviewURL",value:function GetPreviewURL(){return this._previewUrl;}},{key:"GetEventSheetManager",value:function GetEventSheetManager(){return this._eventSheetManager;}},{key:"GetEventStack",value:function GetEventStack(){return this._eventSheetManager.GetEventStack();}},{key:"GetCurrentEventStackFrame",value:function GetCurrentEventStackFrame(){return this._eventSheetManager.GetCurrentEventStackFrame();}},{key:"GetCurrentEvent",value:function GetCurrentEvent(){return this._eventSheetManager.GetCurrentEvent();}},{key:"GetCurrentCondition",value:function GetCurrentCondition(){return this._eventSheetManager.GetCurrentCondition();}},{key:"IsCurrentConditionFirst",value:function IsCurrentConditionFirst(){return this.GetCurrentEventStackFrame().GetConditionIndex()===0;}},{key:"GetCurrentAction",value:function GetCurrentAction(){return this._eventSheetManager.GetCurrentAction();}},{key:"GetPluginManager",value:function GetPluginManager(){return this._pluginManager;}},{key:"GetSystemPlugin",value:function GetSystemPlugin(){return this._pluginManager.GetSystemPlugin();}},{key:"GetObjectClassByIndex",value:function GetObjectClassByIndex(i){i=Math.floor(i);if(i<0||i>=this._allObjectClasses.length)throw new RangeError("invalid index");return this._allObjectClasses[i];}},{key:"GetObjectClassByName",value:function GetObjectClassByName(name){return this._objectClassesByName.get(name.toLowerCase())||null;}},{key:"GetObjectClassBySID",value:function GetObjectClassBySID(sid){return this._objectClassesBySid.get(sid)||null;}},{key:"GetSingleGlobalObjectClassByCtor",value:function GetSingleGlobalObjectClassByCtor(ctor){var plugin=this._pluginManager.GetPluginByConstructorFunction(ctor);if(!plugin)return null;return plugin.GetSingleGlobalObjectClass();}},{key:"GetAllObjectClasses",value:function GetAllObjectClasses(){return this._allObjectClasses;}},{key:"allInstances",value:/*#__PURE__*/regeneratorRuntime.mark(function allInstances(){var _iteratorNormalCompletion518,_didIteratorError518,_iteratorError518,_iterator518,_step518,objectClass;return regeneratorRuntime.wrap(function allInstances$(_context190){while(1){switch(_context190.prev=_context190.next){case 0:_iteratorNormalCompletion518=true;_didIteratorError518=false;_iteratorError518=undefined;_context190.prev=3;_iterator518=this._allObjectClasses[Symbol.iterator]();case 5:if(_iteratorNormalCompletion518=(_step518=_iterator518.next()).done){_context190.next=13;break;}objectClass=_step518.value;if(!objectClass.IsFamily()){_context190.next=9;break;}return _context190.abrupt("continue",10);case 9:return _context190.delegateYield(objectClass.instances(),"t0",10);case 10:_iteratorNormalCompletion518=true;_context190.next=5;break;case 13:_context190.next=19;break;case 15:_context190.prev=15;_context190.t1=_context190["catch"](3);_didIteratorError518=true;_iteratorError518=_context190.t1;case 19:_context190.prev=19;_context190.prev=20;if(!_iteratorNormalCompletion518&&_iterator518["return"]!=null){_iterator518["return"]();}case 22:_context190.prev=22;if(!_didIteratorError518){_context190.next=25;break;}throw _iteratorError518;case 25:return _context190.finish(22);case 26:return _context190.finish(19);case 27:case"end":return _context190.stop();}}},allInstances,this,[[3,15,19,27],[20,,22,26]]);})},{key:"Dispatcher",value:function Dispatcher(){return this._dispatcher;}},{key:"UserScriptDispatcher",value:function UserScriptDispatcher(){return this._userScriptDispatcher;}},{key:"DispatchUserScriptEvent",value:function DispatchUserScriptEvent(e){e.runtime=this.GetIRuntime();var shouldTime=this.IsDebug()&&!this._eventSheetManager.IsInEventEngine();if(shouldTime)_C3Debugger3.StartMeasuringScriptTime();this._userScriptDispatcher.dispatchEvent(e);if(shouldTime)_C3Debugger3.AddScriptTime();}},{key:"DispatchUserScriptEventAsyncWait",value:function DispatchUserScriptEventAsyncWait(e){e.runtime=this.GetIRuntime();return this._userScriptDispatcher.dispatchEventAndWaitAsync(e);}},{key:"GetOriginalViewportWidth",value:function GetOriginalViewportWidth(){return this._originalViewportWidth;}},{key:"GetOriginalViewportHeight",value:function GetOriginalViewportHeight(){return this._originalViewportHeight;}},{key:"SetOriginalViewportSize",value:function SetOriginalViewportSize(w,h){if(this._originalViewportWidth===w&&this._originalViewportHeight===h)return;this._originalViewportWidth=w;this._originalViewportHeight=h;var layoutManager=this.GetLayoutManager();layoutManager.SetAllLayerProjectionChanged();layoutManager.SetAllLayerMVChanged();}},{key:"GetViewportWidth",value:function GetViewportWidth(){return this._viewportWidth;}},{key:"GetViewportHeight",value:function GetViewportHeight(){return this._viewportHeight;}},{key:"SetViewportSize",value:function SetViewportSize(w,h){if(this._viewportWidth===w&&this._viewportHeight===h)return;this._viewportWidth=w;this._viewportHeight=h;var layoutManager=this.GetLayoutManager();layoutManager.SetAllLayerProjectionChanged();layoutManager.SetAllLayerMVChanged();}},{key:"_SetDevicePixelRatio",value:function _SetDevicePixelRatio(r){if(this.IsExportToVideo())return;this._devicePixelRatio=r;}},{key:"GetDevicePixelRatio",value:function GetDevicePixelRatio(){return this._devicePixelRatio;}},{key:"GetParallaxXOrigin",value:function GetParallaxXOrigin(){return this._parallaxXorigin;}},{key:"GetParallaxYOrigin",value:function GetParallaxYOrigin(){return this._parallaxYorigin;}},{key:"GetCanvasManager",value:function GetCanvasManager(){return this._canvasManager;}},{key:"GetDrawWidth",value:function GetDrawWidth(){if(!this._canvasManager)return this._viewportWidth;return this._canvasManager.GetDrawWidth();}},{key:"GetDrawHeight",value:function GetDrawHeight(){if(!this._canvasManager)return this._viewportHeight;return this._canvasManager.GetDrawHeight();}},{key:"GetRenderScale",value:function GetRenderScale(){if(!this._canvasManager)return 1;return this._canvasManager.GetRenderScale();}},{key:"GetDisplayScale",value:function GetDisplayScale(){if(!this._canvasManager)return 1;return this._canvasManager.GetDisplayScale();}},{key:"GetEffectLayerScaleParam",value:function GetEffectLayerScaleParam(){if(!this._canvasManager)return 1;return this._canvasManager.GetEffectLayerScaleParam();}},{key:"GetEffectDevicePixelRatioParam",value:function GetEffectDevicePixelRatioParam(){if(!this._canvasManager)return 1;return this._canvasManager.GetEffectDevicePixelRatioParam();}},{key:"GetCanvasClientX",value:function GetCanvasClientX(){if(!this._canvasManager)return 0;return this._canvasManager.GetCanvasClientX();}},{key:"GetCanvasClientY",value:function GetCanvasClientY(){if(!this._canvasManager)return 0;return this._canvasManager.GetCanvasClientY();}},{key:"GetCanvasCssWidth",value:function GetCanvasCssWidth(){if(!this._canvasManager)return 0;return this._canvasManager.GetCssWidth();}},{key:"GetCanvasCssHeight",value:function GetCanvasCssHeight(){if(!this._canvasManager)return 0;return this._canvasManager.GetCssHeight();}},{key:"GetFullscreenMode",value:function GetFullscreenMode(){if(!this._canvasManager)return"off";return this._canvasManager.GetFullscreenMode();}},{key:"GetAdditionalRenderTarget",value:function GetAdditionalRenderTarget(opts){if(!this._canvasManager)return null;return this._canvasManager.GetAdditionalRenderTarget(opts);}},{key:"ReleaseAdditionalRenderTarget",value:function ReleaseAdditionalRenderTarget(renderTarget){if(!this._canvasManager)return;this._canvasManager.ReleaseAdditionalRenderTarget(renderTarget);}},{key:"UsesAnyBackgroundBlending",value:function UsesAnyBackgroundBlending(){return this._usesAnyBackgroundBlending;}},{key:"UsesAnyCrossSampling",value:function UsesAnyCrossSampling(){return this._usesAnyCrossSampling;}},{key:"UsesAnyDepthSampling",value:function UsesAnyDepthSampling(){return this._usesAnyDepthSampling;}},{key:"GetGPUUtilisation",value:function GetGPUUtilisation(){if(!this._canvasManager)return NaN;return this._canvasManager.GetGPUUtilisation();}},{key:"IsLinearSampling",value:function IsLinearSampling(){return this.GetSampling()!=="nearest";}},{key:"GetFramerateMode",value:function GetFramerateMode(){return this._framerateMode;}},{key:"GetCompositingMode",value:function GetCompositingMode(){return this._compositingMode;}},{key:"GetSampling",value:function GetSampling(){return this._sampling;}},{key:"UsesLoaderLayout",value:function UsesLoaderLayout(){return this._usesLoaderLayout;}},{key:"GetLoadingLogoAsset",value:function GetLoadingLogoAsset(){return this._loadingLogoAsset;}},{key:"ReleaseLoadingLogoAsset",value:function ReleaseLoadingLogoAsset(){if(this._loadingLogoAsset){this._loadingLogoAsset.Release();this._loadingLogoAsset=null;}}},{key:"GetLayoutManager",value:function GetLayoutManager(){return this._layoutManager;}},{key:"GetMainRunningLayout",value:function GetMainRunningLayout(){return this._layoutManager.GetMainRunningLayout();}},{key:"GetTimelineManager",value:function GetTimelineManager(){return this._timelineManager;}},{key:"GetTransitionManager",value:function GetTransitionManager(){return this._transitionManager;}},{key:"GetTemplateManager",value:function GetTemplateManager(){return this._templateManager;}},{key:"GetFlowchartManager",value:function GetFlowchartManager(){return this._flowchartManager;}},{key:"GetAssetManager",value:function GetAssetManager(){return this._assetManager;}},{key:"LoadImage",value:function LoadImage(opts){return this._assetManager.LoadImage(opts);}},{key:"CreateInstance",value:function CreateInstance(objectClass,layer,x,y,createHierarchy,templateName){if(templateName&&this._templateManager){var templateData=this._templateManager.GetTemplateData(objectClass,templateName);if(templateData){var inst=this.CreateInstanceFromData(templateData,layer,false,x,y,false,createHierarchy,undefined,createHierarchy);this._templateManager.MapInstanceToTemplateName(inst,templateName);return inst;}}return this.CreateInstanceFromData(objectClass,layer,false,x,y,false,createHierarchy,undefined,createHierarchy);}},{key:"CreateInstanceFromData",value:function CreateInstanceFromData(instData_or_objectClass,layer,isStartupInstance,x,y,skipSiblings,createHierarchy,previousInstance,creatingHierarchy){var instData=null;var objectClass=null;if(instData_or_objectClass instanceof _C184.ObjectClass){objectClass=instData_or_objectClass;if(objectClass.IsFamily()){var members=objectClass.GetFamilyMembers();var i=Math.floor(this.Random()*members.length);objectClass=members[i];}instData=objectClass.GetDefaultInstanceData();}else{instData=instData_or_objectClass;objectClass=this.GetObjectClassByIndex(instData[1]);}var isWorld=objectClass.GetPlugin().IsWorldType();if(this._isLoading&&isWorld&&!objectClass.IsOnLoaderLayout())return null;var originalLayer=layer;if(!isWorld)layer=null;var uid;if(isStartupInstance&&!skipSiblings&&instData&&!this._instancesByUid.has(instData[2]))uid=instData[2];else uid=this._nextUid++;var worldData=instData?instData[0]:null;var inst=_C184.New(_C184.Instance,{runtime:this,objectType:objectClass,layer:layer,worldData:worldData,instVarData:instData?instData[3]:null,uid:uid});this._instancesByUid.set(uid,inst);var wi=null;if(isWorld){wi=inst.GetWorldInfo();if(typeof x!=="undefined"&&typeof y!=="undefined"){wi.SetX(x);wi.SetY(y);}objectClass._SetAnyCollisionCellChanged(true);}if(layer){if(!creatingHierarchy)layer._AddInstance(inst,true);if(layer.GetParallaxX()!==1||layer.GetParallaxY()!==1)objectClass._SetAnyInstanceParallaxed(true);layer.GetLayout().MaybeLoadTexturesFor(objectClass);}this._objectCount++;var needsSiblingCreation=true;if(previousInstance){var previousObjectClass=previousInstance.GetObjectClass();if(previousObjectClass.IsInContainer()&&objectClass.IsInContainer()){var container=objectClass.GetContainer();var previousContainer=previousObjectClass.GetContainer();if(container===previousContainer)needsSiblingCreation=false;}}if(objectClass.IsInContainer()&&!isStartupInstance&&!skipSiblings&&needsSiblingCreation){var _iteratorNormalCompletion519=true;var _didIteratorError519=false;var _iteratorError519=undefined;try{for(var _iterator519=objectClass.GetContainer().objectTypes()[Symbol.iterator](),_step519;!(_iteratorNormalCompletion519=(_step519=_iterator519.next()).done);_iteratorNormalCompletion519=true){var containerType=_step519.value;if(containerType===objectClass)continue;var siblingInst=this.CreateInstanceFromData(containerType,originalLayer,false,wi?wi.GetX():x,wi?wi.GetY():y,true,false,undefined,creatingHierarchy);inst._AddSibling(siblingInst);}}catch(err){_didIteratorError519=true;_iteratorError519=err;}finally{try{if(!_iteratorNormalCompletion519&&_iterator519["return"]!=null){_iterator519["return"]();}}finally{if(_didIteratorError519){throw _iteratorError519;}}}var _iteratorNormalCompletion520=true;var _didIteratorError520=false;var _iteratorError520=undefined;try{for(var _iterator520=inst.siblings()[Symbol.iterator](),_step520;!(_iteratorNormalCompletion520=(_step520=_iterator520.next()).done);_iteratorNormalCompletion520=true){var s=_step520.value;s._AddSibling(inst);var _iteratorNormalCompletion521=true;var _didIteratorError521=false;var _iteratorError521=undefined;try{for(var _iterator521=inst.siblings()[Symbol.iterator](),_step521;!(_iteratorNormalCompletion521=(_step521=_iterator521.next()).done);_iteratorNormalCompletion521=true){var s2=_step521.value;if(s!==s2)s._AddSibling(s2);}}catch(err){_didIteratorError521=true;_iteratorError521=err;}finally{try{if(!_iteratorNormalCompletion521&&_iterator521["return"]!=null){_iterator521["return"]();}}finally{if(_didIteratorError521){throw _iteratorError521;}}}}}catch(err){_didIteratorError520=true;_iteratorError520=err;}finally{try{if(!_iteratorNormalCompletion520&&_iterator520["return"]!=null){_iterator520["return"]();}}finally{if(_didIteratorError520){throw _iteratorError520;}}}}if(isWorld&&!isStartupInstance&&!!createHierarchy)this._CreateChildInstancesFromData(inst,worldData,wi,layer,x,y,creatingHierarchy);if(objectClass.IsInContainer()&&!isStartupInstance&&!skipSiblings&&!!createHierarchy){var _iteratorNormalCompletion522=true;var _didIteratorError522=false;var _iteratorError522=undefined;try{for(var _iterator522=inst.siblings()[Symbol.iterator](),_step522;!(_iteratorNormalCompletion522=(_step522=_iterator522.next()).done);_iteratorNormalCompletion522=true){var sibling=_step522.value;var swi=sibling.GetWorldInfo();if(!swi)continue;var siblingPlugin=sibling.GetPlugin();var sWorldData=sibling.GetObjectClass().GetDefaultInstanceData()[0];if(siblingPlugin.IsWorldType())this._CreateChildInstancesFromData(sibling,sWorldData,swi,layer,swi.GetX(),swi.GetY(),creatingHierarchy);else this._CreateChildInstancesFromData(sibling,sWorldData,swi,layer,undefined,undefined,creatingHierarchy);}}catch(err){_didIteratorError522=true;_iteratorError522=err;}finally{try{if(!_iteratorNormalCompletion522&&_iterator522["return"]!=null){_iterator522["return"]();}}finally{if(_didIteratorError522){throw _iteratorError522;}}}}if(!skipSiblings&&!!createHierarchy){if(typeof x==="undefined")x=worldData[0];if(typeof y==="undefined")y=worldData[1];var pwi=wi.GetTopParent();var newX=x-wi.GetX()+pwi.GetX();var newY=y-wi.GetY()+pwi.GetY();pwi.SetXY(newX,newY);}objectClass._SetIIDsStale();var instPropertyData=instData?_C184.cloneArray(instData[5]):null;var behPropertyData=instData?instData[4].map(function(bp){return _C184.cloneArray(bp);}):null;var hasTilemap=isWorld&&worldData&&worldData[13];if(hasTilemap)inst._SetHasTilemap();inst._CreateSdkInstance(instPropertyData,behPropertyData);if(hasTilemap){var tilemapData=worldData[13];inst.GetSdkInstance().LoadTilemapData(tilemapData[2],tilemapData[0],tilemapData[1]);}this._instancesPendingCreate.push(inst);this._hasPendingInstances=true;if(this.IsDebug())_C3Debugger3.InstanceCreated(inst);return inst;}},{key:"_CreateChildInstancesFromData",value:function _CreateChildInstancesFromData(parentInstance,parentWorldData,parentWorldInfo,layer,x,y,creatingHierarchy){var parentZIndex=parentWorldInfo.GetSceneGraphZIndexExportData();var childrenData=parentWorldInfo.GetSceneGraphChildrenExportData();parentInstance.GetWorldInfo().SetSceneGraphZIndex(parentZIndex);if(!childrenData)return;if(typeof x==="undefined")x=parentWorldData[0];if(typeof y==="undefined")y=parentWorldData[1];var sceneGraphSiblings=new Set();var parentX=parentWorldData[0];var parentY=parentWorldData[1];var _iteratorNormalCompletion523=true;var _didIteratorError523=false;var _iteratorError523=undefined;try{for(var _iterator523=childrenData[Symbol.iterator](),_step523;!(_iteratorNormalCompletion523=(_step523=_iterator523.next()).done);_iteratorNormalCompletion523=true){var childData=_step523.value;var childLayoutSID=childData[0];var childLayerIndex=childData[1];var childUID=childData[2];var childFlags=childData[3];var childIsInContainer=!!childData[4];var childZIndex=childData[5];var uniqueInstanceData=childData[6];var childInstData=void 0;if(uniqueInstanceData)childInstData=uniqueInstanceData;else{var layout=this._layoutManager.GetLayoutBySID(childLayoutSID);var l=layout.GetLayer(childLayerIndex);childInstData=l.GetInitialInstanceData(childUID);}var childObjectClass=this.GetObjectClassByIndex(childInstData[1]);var hasSibling=parentInstance.HasSibling(childObjectClass);var siblingProcessed=sceneGraphSiblings.has(childObjectClass);if(hasSibling&&!siblingProcessed&&childIsInContainer){var childInst=parentInstance.GetSibling(childObjectClass);var childX=x+childInstData[0][0]-parentX;var childY=y+childInstData[0][1]-parentY;childInst.GetWorldInfo().SetXY(childX,childY);childInst.GetWorldInfo().SetSceneGraphZIndex(childZIndex);parentInstance.AddChild(childInst,{transformX:!!(childFlags>>0&1),transformY:!!(childFlags>>1&1),transformWidth:!!(childFlags>>2&1),transformHeight:!!(childFlags>>3&1),transformAngle:!!(childFlags>>4&1),destroyWithParent:!!(childFlags>>5&1),transformZElevation:!!(childFlags>>6&1),transformOpacity:!!(childFlags>>7&1),transformVisibility:!!(childFlags>>8&1)});sceneGraphSiblings.add(childObjectClass);}else{var _childX=x+childInstData[0][0]-parentX;var _childY=y+childInstData[0][1]-parentY;var _childInst2=this.CreateInstanceFromData(childInstData,layer,false,_childX,_childY,false,true,parentInstance,creatingHierarchy);_childInst2.GetWorldInfo().SetSceneGraphZIndex(childZIndex);parentInstance.AddChild(_childInst2,{transformX:!!(childFlags>>0&1),transformY:!!(childFlags>>1&1),transformWidth:!!(childFlags>>2&1),transformHeight:!!(childFlags>>3&1),transformAngle:!!(childFlags>>4&1),destroyWithParent:!!(childFlags>>5&1),transformZElevation:!!(childFlags>>6&1),transformOpacity:!!(childFlags>>7&1),transformVisibility:!!(childFlags>>8&1)});}}}catch(err){_didIteratorError523=true;_iteratorError523=err;}finally{try{if(!_iteratorNormalCompletion523&&_iterator523["return"]!=null){_iterator523["return"]();}}finally{if(_didIteratorError523){throw _iteratorError523;}}}}},{key:"DestroyInstance",value:function DestroyInstance(inst){if(this._instancesToReleaseAtEndOfTick.has(inst))return;var objectClass=inst.GetObjectClass();var s=this._instancesPendingDestroy.get(objectClass);if(s){if(s.has(inst))return;s.add(inst);}else{s=new Set();s.add(inst);this._instancesPendingDestroy.set(objectClass,s);}if(this.IsDebug())_C3Debugger3.InstanceDestroyed(inst);inst._MarkDestroyed();this._hasPendingInstances=true;if(inst.IsInContainer()){var _iteratorNormalCompletion524=true;var _didIteratorError524=false;var _iteratorError524=undefined;try{for(var _iterator524=inst.siblings()[Symbol.iterator](),_step524;!(_iteratorNormalCompletion524=(_step524=_iterator524.next()).done);_iteratorNormalCompletion524=true){var _s3=_step524.value;this.DestroyInstance(_s3);}}catch(err){_didIteratorError524=true;_iteratorError524=err;}finally{try{if(!_iteratorNormalCompletion524&&_iterator524["return"]!=null){_iterator524["return"]();}}finally{if(_didIteratorError524){throw _iteratorError524;}}}}var _iteratorNormalCompletion525=true;var _didIteratorError525=false;var _iteratorError525=undefined;try{for(var _iterator525=inst.children()[Symbol.iterator](),_step525;!(_iteratorNormalCompletion525=(_step525=_iterator525.next()).done);_iteratorNormalCompletion525=true){var _c30=_step525.value;if(_c30.GetDestroyWithParent())this.DestroyInstance(_c30);}}catch(err){_didIteratorError525=true;_iteratorError525=err;}finally{try{if(!_iteratorNormalCompletion525&&_iterator525["return"]!=null){_iterator525["return"]();}}finally{if(_didIteratorError525){throw _iteratorError525;}}}if(!this._layoutManager.IsEndingLayout()&&!this._isLoadingState){var eventSheetManager=this.GetEventSheetManager();eventSheetManager.BlockFlushingInstances(true);inst._TriggerOnDestroyed();eventSheetManager.BlockFlushingInstances(false);}inst._FireDestroyedScriptEvents(this._layoutManager.IsEndingLayout());}},{key:"FlushPendingInstances",value:function FlushPendingInstances(){if(!this._hasPendingInstances)return;this._isFlushingPendingInstances=true;this._FlushInstancesPendingCreate();this._FlushInstancesPendingDestroy();this._isFlushingPendingInstances=false;this._hasPendingInstances=false;this.UpdateRender();}},{key:"_FlushInstancesPendingCreate",value:function _FlushInstancesPendingCreate(){var _iteratorNormalCompletion526=true;var _didIteratorError526=false;var _iteratorError526=undefined;try{for(var _iterator526=this._instancesPendingCreate[Symbol.iterator](),_step526;!(_iteratorNormalCompletion526=(_step526=_iterator526.next()).done);_iteratorNormalCompletion526=true){var inst=_step526.value;var objectType=inst.GetObjectClass();objectType._AddInstance(inst);var _iteratorNormalCompletion527=true;var _didIteratorError527=false;var _iteratorError527=undefined;try{for(var _iterator527=objectType.GetFamilies()[Symbol.iterator](),_step527;!(_iteratorNormalCompletion527=(_step527=_iterator527.next()).done);_iteratorNormalCompletion527=true){var family=_step527.value;family._AddInstance(inst);family._SetIIDsStale();}}catch(err){_didIteratorError527=true;_iteratorError527=err;}finally{try{if(!_iteratorNormalCompletion527&&_iterator527["return"]!=null){_iterator527["return"]();}}finally{if(_didIteratorError527){throw _iteratorError527;}}}}}catch(err){_didIteratorError526=true;_iteratorError526=err;}finally{try{if(!_iteratorNormalCompletion526&&_iterator526["return"]!=null){_iterator526["return"]();}}finally{if(_didIteratorError526){throw _iteratorError526;}}}_C184.clearArray(this._instancesPendingCreate);}},{key:"_FlushInstancesPendingDestroy",value:function _FlushInstancesPendingDestroy(){this._dispatcher.SetDelayRemoveEventsEnabled(true);var _iteratorNormalCompletion528=true;var _didIteratorError528=false;var _iteratorError528=undefined;try{for(var _iterator528=this._instancesPendingDestroy.entries()[Symbol.iterator](),_step528;!(_iteratorNormalCompletion528=(_step528=_iterator528.next()).done);_iteratorNormalCompletion528=true){var _step528$value=_slicedToArray(_step528.value,2),objectClass=_step528$value[0],s=_step528$value[1];this._FlushInstancesPendingDestroyForObjectClass(objectClass,s);s.clear();}}catch(err){_didIteratorError528=true;_iteratorError528=err;}finally{try{if(!_iteratorNormalCompletion528&&_iterator528["return"]!=null){_iterator528["return"]();}}finally{if(_didIteratorError528){throw _iteratorError528;}}}this._instancesPendingDestroy.clear();this._dispatcher.SetDelayRemoveEventsEnabled(false);}},{key:"_FlushInstancesPendingDestroyForObjectClass",value:function _FlushInstancesPendingDestroyForObjectClass(objectClass,s){var _iteratorNormalCompletion529=true;var _didIteratorError529=false;var _iteratorError529=undefined;try{for(var _iterator529=s[Symbol.iterator](),_step529;!(_iteratorNormalCompletion529=(_step529=_iterator529.next()).done);_iteratorNormalCompletion529=true){var inst=_step529.value;var instanceDestroyEvent=this._eventObjects["instancedestroy"];instanceDestroyEvent.instance=inst;this._dispatcher.dispatchEvent(instanceDestroyEvent);this._instancesByUid["delete"](inst.GetUID());this._instanceTimes["delete"](inst);var wi=inst.GetWorldInfo();if(wi){wi._RemoveFromCollisionCells();wi._RemoveFromRenderCells();wi._MarkDestroyed();}this._instancesToReleaseAtEndOfTick.add(inst);this._objectCount--;}}catch(err){_didIteratorError529=true;_iteratorError529=err;}finally{try{if(!_iteratorNormalCompletion529&&_iterator529["return"]!=null){_iterator529["return"]();}}finally{if(_didIteratorError529){throw _iteratorError529;}}}_C184.arrayRemoveAllInSet(objectClass.GetInstances(),s);objectClass._SetIIDsStale();this._instancesToReleaseAffectedObjectClasses.add(objectClass);if(objectClass.GetInstances().length===0)objectClass._SetAnyInstanceParallaxed(false);var _iteratorNormalCompletion530=true;var _didIteratorError530=false;var _iteratorError530=undefined;try{for(var _iterator530=objectClass.GetFamilies()[Symbol.iterator](),_step530;!(_iteratorNormalCompletion530=(_step530=_iterator530.next()).done);_iteratorNormalCompletion530=true){var family=_step530.value;_C184.arrayRemoveAllInSet(family.GetInstances(),s);family._SetIIDsStale();this._instancesToReleaseAffectedObjectClasses.add(family);}}catch(err){_didIteratorError530=true;_iteratorError530=err;}finally{try{if(!_iteratorNormalCompletion530&&_iterator530["return"]!=null){_iterator530["return"]();}}finally{if(_didIteratorError530){throw _iteratorError530;}}}if(objectClass.GetPlugin().IsWorldType()){var layers=new Set(_toConsumableArray(s).map(function(i){return i.GetWorldInfo().GetLayer();}));var _iteratorNormalCompletion531=true;var _didIteratorError531=false;var _iteratorError531=undefined;try{for(var _iterator531=layers[Symbol.iterator](),_step531;!(_iteratorNormalCompletion531=(_step531=_iterator531.next()).done);_iteratorNormalCompletion531=true){var layer=_step531.value;layer._RemoveAllInstancesInSet(s);}}catch(err){_didIteratorError531=true;_iteratorError531=err;}finally{try{if(!_iteratorNormalCompletion531&&_iterator531["return"]!=null){_iterator531["return"]();}}finally{if(_didIteratorError531){throw _iteratorError531;}}}}}},{key:"_GetInstancesPendingCreate",value:function _GetInstancesPendingCreate(){return this._instancesPendingCreate;}},{key:"instancesPendingCreateForObjectClass",value:/*#__PURE__*/regeneratorRuntime.mark(function instancesPendingCreateForObjectClass(objectClass){var _iteratorNormalCompletion532,_didIteratorError532,_iteratorError532,_iterator532,_step532,inst;return regeneratorRuntime.wrap(function instancesPendingCreateForObjectClass$(_context191){while(1){switch(_context191.prev=_context191.next){case 0:_iteratorNormalCompletion532=true;_didIteratorError532=false;_iteratorError532=undefined;_context191.prev=3;_iterator532=this._GetInstancesPendingCreate()[Symbol.iterator]();case 5:if(_iteratorNormalCompletion532=(_step532=_iterator532.next()).done){_context191.next=19;break;}inst=_step532.value;if(!objectClass.IsFamily()){_context191.next=13;break;}if(!inst.GetObjectClass().BelongsToFamily(objectClass)){_context191.next=11;break;}_context191.next=11;return inst;case 11:_context191.next=16;break;case 13:if(!(inst.GetObjectClass()===objectClass)){_context191.next=16;break;}_context191.next=16;return inst;case 16:_iteratorNormalCompletion532=true;_context191.next=5;break;case 19:_context191.next=25;break;case 21:_context191.prev=21;_context191.t0=_context191["catch"](3);_didIteratorError532=true;_iteratorError532=_context191.t0;case 25:_context191.prev=25;_context191.prev=26;if(!_iteratorNormalCompletion532&&_iterator532["return"]!=null){_iterator532["return"]();}case 28:_context191.prev=28;if(!_didIteratorError532){_context191.next=31;break;}throw _iteratorError532;case 31:return _context191.finish(28);case 32:return _context191.finish(25);case 33:case"end":return _context191.stop();}}},instancesPendingCreateForObjectClass,this,[[3,21,25,33],[26,,28,32]]);})},{key:"_GetNewUID",value:function _GetNewUID(){return this._nextUid++;}},{key:"_MapInstanceByUID",value:function _MapInstanceByUID(uid,inst){this._instancesByUid.set(uid,inst);}},{key:"_OnRendererContextLost",value:function _OnRendererContextLost(){this._dispatcher.dispatchEvent(_C184.New(_C184.Event,"renderercontextlost"));this.SetSuspended(true);var _iteratorNormalCompletion533=true;var _didIteratorError533=false;var _iteratorError533=undefined;try{for(var _iterator533=this._allObjectClasses[Symbol.iterator](),_step533;!(_iteratorNormalCompletion533=(_step533=_iterator533.next()).done);_iteratorNormalCompletion533=true){var objectClass=_step533.value;if(!objectClass.IsFamily()&&objectClass.HasLoadedTextures())objectClass.ReleaseTextures();}}catch(err){_didIteratorError533=true;_iteratorError533=err;}finally{try{if(!_iteratorNormalCompletion533&&_iterator533["return"]!=null){_iterator533["return"]();}}finally{if(_didIteratorError533){throw _iteratorError533;}}}var runningLayout=this.GetMainRunningLayout();if(runningLayout)runningLayout._OnRendererContextLost();_C184.ImageInfo.OnRendererContextLost();_C184.ImageAsset.OnRendererContextLost();}},{key:"_OnRendererContextRestored",value:function _OnRendererContextRestored(){return regeneratorRuntime.async(function _OnRendererContextRestored$(_context192){while(1){switch(_context192.prev=_context192.next){case 0:_context192.next=2;return regeneratorRuntime.awrap(this.GetMainRunningLayout()._Load(null,this.GetRenderer()));case 2:this._dispatcher.dispatchEvent(_C184.New(_C184.Event,"renderercontextrestored"));this.SetSuspended(false);this.UpdateRender();case 5:case"end":return _context192.stop();}}},null,this);}},{key:"_OnVisibilityChange",value:function _OnVisibilityChange(e){var isHidden=e["hidden"];this.SetSuspended(isHidden);if(!isHidden)this.UpdateRender();}},{key:"_OnWindowBlur",value:function _OnWindowBlur(e){if(!this.IsPreview()||!this._pauseOnBlur||_C184.Platform.IsMobile)return;if(!e.data["parentHasFocus"]){this.SetSuspended(true);this._isPausedOnBlur=true;}}},{key:"_OnWindowFocus",value:function _OnWindowFocus(){if(!this._isPausedOnBlur)return;this.SetSuspended(false);this._isPausedOnBlur=false;}},{key:"_RequestAnimationFrame",value:function _RequestAnimationFrame(){var tickCallbacks=this._tickCallbacks;if(this._framerateMode==="vsync"){if(this._rafId===-1)this._rafId=self.requestAnimationFrame(tickCallbacks.normal);}else if(this._framerateMode==="unlimited-tick"){if(this._ruafId===-1)this._ruafId=_C184.RequestUnlimitedAnimationFrame(tickCallbacks.tickOnly);if(this._rafId===-1)this._rafId=self.requestAnimationFrame(tickCallbacks.renderOnly);}else if(this._ruafId===-1)this._ruafId=_C184.RequestUnlimitedAnimationFrame(tickCallbacks.normal);}},{key:"_CancelAnimationFrame",value:function _CancelAnimationFrame(){if(this._rafId!==-1){self.cancelAnimationFrame(this._rafId);this._rafId=-1;}if(this._ruafId!==-1){_C184.CancelUnlimitedAnimationFrame(this._ruafId);this._ruafId=-1;}}},{key:"IsSuspended",value:function IsSuspended(){return this._suspendCount>0;}},{key:"SetSuspended",value:function SetSuspended(s){if(this.IsExportToVideo())return;var wasSuspended=this.IsSuspended();this._suspendCount+=s?1:-1;if(this._suspendCount<0)this._suspendCount=0;var isSuspended=this.IsSuspended();if(!wasSuspended&&isSuspended){console.log("[Construct] Suspending");this._CancelAnimationFrame();this._dispatcher.dispatchEvent(_C184.New(_C184.Event,"suspend"));this.Trigger(_C184.Plugins.System.Cnds.OnSuspend,null,null);}else if(wasSuspended&&!isSuspended){console.log("[Construct] Resuming");var now=performance.now();this._lastTickTime=now;this._fpsLastTime=now;this._fpsFrameCount=0;this._fps=0;this._mainThreadTime=0;this._mainThreadTimeCounter=0;this._dispatcher.dispatchEvent(_C184.New(_C184.Event,"resume"));this.Trigger(_C184.Plugins.System.Cnds.OnResume,null,null);if(!this.HitBreakpoint())this.Tick(now);}}},{key:"_AddBehInstToTick",value:function _AddBehInstToTick(behSdkInst){this._behInstsToTick.Add(behSdkInst);}},{key:"_AddBehInstToPostTick",value:function _AddBehInstToPostTick(behSdkInst){this._behInstsToPostTick.Add(behSdkInst);}},{key:"_AddBehInstToTick2",value:function _AddBehInstToTick2(behSdkInst){this._behInstsToTick2.Add(behSdkInst);}},{key:"_RemoveBehInstToTick",value:function _RemoveBehInstToTick(behSdkInst){this._behInstsToTick.Remove(behSdkInst);}},{key:"_RemoveBehInstToPostTick",value:function _RemoveBehInstToPostTick(behSdkInst){this._behInstsToPostTick.Remove(behSdkInst);}},{key:"_RemoveBehInstToTick2",value:function _RemoveBehInstToTick2(behSdkInst){this._behInstsToTick2.Remove(behSdkInst);}},{key:"_BehaviorTick",value:function _BehaviorTick(){this._behInstsToTick.SetQueueingEnabled(true);var _iteratorNormalCompletion534=true;var _didIteratorError534=false;var _iteratorError534=undefined;try{for(var _iterator534=this._behInstsToTick[Symbol.iterator](),_step534;!(_iteratorNormalCompletion534=(_step534=_iterator534.next()).done);_iteratorNormalCompletion534=true){var bi=_step534.value;bi.Tick();}}catch(err){_didIteratorError534=true;_iteratorError534=err;}finally{try{if(!_iteratorNormalCompletion534&&_iterator534["return"]!=null){_iterator534["return"]();}}finally{if(_didIteratorError534){throw _iteratorError534;}}}this._behInstsToTick.SetQueueingEnabled(false);}},{key:"_BehaviorPostTick",value:function _BehaviorPostTick(){this._behInstsToPostTick.SetQueueingEnabled(true);var _iteratorNormalCompletion535=true;var _didIteratorError535=false;var _iteratorError535=undefined;try{for(var _iterator535=this._behInstsToPostTick[Symbol.iterator](),_step535;!(_iteratorNormalCompletion535=(_step535=_iterator535.next()).done);_iteratorNormalCompletion535=true){var bi=_step535.value;bi.PostTick();}}catch(err){_didIteratorError535=true;_iteratorError535=err;}finally{try{if(!_iteratorNormalCompletion535&&_iterator535["return"]!=null){_iterator535["return"]();}}finally{if(_didIteratorError535){throw _iteratorError535;}}}this._behInstsToPostTick.SetQueueingEnabled(false);}},{key:"_BehaviorTick2",value:function _BehaviorTick2(){this._behInstsToTick2.SetQueueingEnabled(true);var _iteratorNormalCompletion536=true;var _didIteratorError536=false;var _iteratorError536=undefined;try{for(var _iterator536=this._behInstsToTick2[Symbol.iterator](),_step536;!(_iteratorNormalCompletion536=(_step536=_iterator536.next()).done);_iteratorNormalCompletion536=true){var bi=_step536.value;bi.Tick2();}}catch(err){_didIteratorError536=true;_iteratorError536=err;}finally{try{if(!_iteratorNormalCompletion536&&_iterator536["return"]!=null){_iterator536["return"]();}}finally{if(_didIteratorError536){throw _iteratorError536;}}}this._behInstsToTick2.SetQueueingEnabled(false);}},{key:"_DebugBehaviorTick",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugBehaviorTick(){var _iteratorNormalCompletion537,_didIteratorError537,_iteratorError537,_iterator537,_step537,bi,ret;return regeneratorRuntime.wrap(function _DebugBehaviorTick$(_context193){while(1){switch(_context193.prev=_context193.next){case 0:this._behInstsToTick.SetQueueingEnabled(true);_iteratorNormalCompletion537=true;_didIteratorError537=false;_iteratorError537=undefined;_context193.prev=4;_iterator537=this._behInstsToTick[Symbol.iterator]();case 6:if(_iteratorNormalCompletion537=(_step537=_iterator537.next()).done){_context193.next=14;break;}bi=_step537.value;ret=bi.Tick();if(!_C184.IsIterator(ret)){_context193.next=11;break;}return _context193.delegateYield(ret,"t0",11);case 11:_iteratorNormalCompletion537=true;_context193.next=6;break;case 14:_context193.next=20;break;case 16:_context193.prev=16;_context193.t1=_context193["catch"](4);_didIteratorError537=true;_iteratorError537=_context193.t1;case 20:_context193.prev=20;_context193.prev=21;if(!_iteratorNormalCompletion537&&_iterator537["return"]!=null){_iterator537["return"]();}case 23:_context193.prev=23;if(!_didIteratorError537){_context193.next=26;break;}throw _iteratorError537;case 26:return _context193.finish(23);case 27:return _context193.finish(20);case 28:this._behInstsToTick.SetQueueingEnabled(false);case 29:case"end":return _context193.stop();}}},_DebugBehaviorTick,this,[[4,16,20,28],[21,,23,27]]);})},{key:"_DebugBehaviorPostTick",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugBehaviorPostTick(){var _iteratorNormalCompletion538,_didIteratorError538,_iteratorError538,_iterator538,_step538,bi,ret;return regeneratorRuntime.wrap(function _DebugBehaviorPostTick$(_context194){while(1){switch(_context194.prev=_context194.next){case 0:this._behInstsToPostTick.SetQueueingEnabled(true);_iteratorNormalCompletion538=true;_didIteratorError538=false;_iteratorError538=undefined;_context194.prev=4;_iterator538=this._behInstsToPostTick[Symbol.iterator]();case 6:if(_iteratorNormalCompletion538=(_step538=_iterator538.next()).done){_context194.next=14;break;}bi=_step538.value;ret=bi.PostTick();if(!_C184.IsIterator(ret)){_context194.next=11;break;}return _context194.delegateYield(ret,"t0",11);case 11:_iteratorNormalCompletion538=true;_context194.next=6;break;case 14:_context194.next=20;break;case 16:_context194.prev=16;_context194.t1=_context194["catch"](4);_didIteratorError538=true;_iteratorError538=_context194.t1;case 20:_context194.prev=20;_context194.prev=21;if(!_iteratorNormalCompletion538&&_iterator538["return"]!=null){_iterator538["return"]();}case 23:_context194.prev=23;if(!_didIteratorError538){_context194.next=26;break;}throw _iteratorError538;case 26:return _context194.finish(23);case 27:return _context194.finish(20);case 28:this._behInstsToPostTick.SetQueueingEnabled(false);case 29:case"end":return _context194.stop();}}},_DebugBehaviorPostTick,this,[[4,16,20,28],[21,,23,27]]);})},{key:"_DebugBehaviorTick2",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugBehaviorTick2(){var _iteratorNormalCompletion539,_didIteratorError539,_iteratorError539,_iterator539,_step539,bi,ret;return regeneratorRuntime.wrap(function _DebugBehaviorTick2$(_context195){while(1){switch(_context195.prev=_context195.next){case 0:this._behInstsToTick2.SetQueueingEnabled(true);_iteratorNormalCompletion539=true;_didIteratorError539=false;_iteratorError539=undefined;_context195.prev=4;_iterator539=this._behInstsToTick2[Symbol.iterator]();case 6:if(_iteratorNormalCompletion539=(_step539=_iterator539.next()).done){_context195.next=14;break;}bi=_step539.value;ret=bi.Tick2();if(!_C184.IsIterator(ret)){_context195.next=11;break;}return _context195.delegateYield(ret,"t0",11);case 11:_iteratorNormalCompletion539=true;_context195.next=6;break;case 14:_context195.next=20;break;case 16:_context195.prev=16;_context195.t1=_context195["catch"](4);_didIteratorError539=true;_iteratorError539=_context195.t1;case 20:_context195.prev=20;_context195.prev=21;if(!_iteratorNormalCompletion539&&_iterator539["return"]!=null){_iterator539["return"]();}case 23:_context195.prev=23;if(!_didIteratorError539){_context195.next=26;break;}throw _iteratorError539;case 26:return _context195.finish(23);case 27:return _context195.finish(20);case 28:this._behInstsToTick2.SetQueueingEnabled(false);case 29:case"end":return _context195.stop();}}},_DebugBehaviorTick2,this,[[4,16,20,28],[21,,23,27]]);})},{key:"Tick",value:function Tick(timestamp,isDebugStep,mode){var isBackgroundWake,shouldRender,layoutManager,canvasManager,startTime,beforePreTickRet,pretickRet,afterPreTickRet,runEventsRet,layout,pendingSetHTMLLayerCount,needCleanUpHTMLLayers,updatePromise;return regeneratorRuntime.async(function Tick$(_context196){while(1){switch(_context196.prev=_context196.next){case 0:this._hasStartedTicking=true;isBackgroundWake=mode==="background-wake";shouldRender=mode!=="background-wake"&&mode!=="skip-render";layoutManager=this.GetLayoutManager();canvasManager=this.GetCanvasManager();if(!(!this._hasStarted||this.IsSuspended()&&!isDebugStep&&!isBackgroundWake)){_context196.next=7;break;}return _context196.abrupt("return");case 7:startTime=performance.now();this._isInTick=true;this._MeasureDt(timestamp||0);beforePreTickRet=this.Step_BeforePreTick();if(!this.IsDebugging()){_context196.next=14;break;}_context196.next=14;return regeneratorRuntime.awrap(beforePreTickRet);case 14:pretickRet=this._dispatcher.dispatchEventAndWait_AsyncOptional(this._eventObjects["pretick"]);if(!(pretickRet instanceof Promise)){_context196.next=18;break;}_context196.next=18;return regeneratorRuntime.awrap(pretickRet);case 18:afterPreTickRet=this.Step_AfterPreTick();if(!this.IsDebugging()){_context196.next=22;break;}_context196.next=22;return regeneratorRuntime.awrap(afterPreTickRet);case 22:if(!this._NeedsHandleSaveOrLoad()){_context196.next=25;break;}_context196.next=25;return regeneratorRuntime.awrap(this._HandleSaveOrLoad());case 25:if(!layoutManager.IsPendingChangeMainLayout()){_context196.next=28;break;}_context196.next=28;return regeneratorRuntime.awrap(this._MaybeChangeLayout());case 28:runEventsRet=this.Step_RunEventsEtc();if(!this.IsDebugging()){_context196.next=32;break;}_context196.next=32;return regeneratorRuntime.awrap(runEventsRet);case 32:layout=layoutManager.GetMainRunningLayout();pendingSetHTMLLayerCount=layout._GetPendingSetHTMLLayerCount();needCleanUpHTMLLayers=false;if(!(pendingSetHTMLLayerCount!==-1)){_context196.next=43;break;}layout._ResetPendingHTMLLayerCount();if(!(canvasManager.GetHTMLLayerCount()!==pendingSetHTMLLayerCount)){_context196.next=43;break;}updatePromise=this.GetCanvasManager().SetHTMLLayerCount(pendingSetHTMLLayerCount);if(!this.IsInWorker()){_context196.next=43;break;}needCleanUpHTMLLayers=true;_context196.next=43;return regeneratorRuntime.awrap(updatePromise);case 43:if(shouldRender)this.Render();if(needCleanUpHTMLLayers)this.PostComponentMessageToDOM("canvas","cleanup-html-layers");if(!this.IsExportToVideo()){_context196.next=51;break;}_context196.next=48;return regeneratorRuntime.awrap(this._ExportToVideoAddFrame());case 48:if(!(this.GetGameTime()>=this.GetExportVideoDuration())){_context196.next=51;break;}this._ExportToVideoFinish();return _context196.abrupt("return");case 51:if(!this.IsSuspended()&&!isBackgroundWake)this._RequestAnimationFrame();this._tickCount++;this._tickCountNoSave++;this._isInTick=false;this._mainThreadTimeCounter+=performance.now()-startTime;case 56:case"end":return _context196.stop();}}},null,this);}},{key:"Step_BeforePreTick",value:function Step_BeforePreTick(){var eventSheetManager,isDebug;return regeneratorRuntime.async(function Step_BeforePreTick$(_context197){while(1){switch(_context197.prev=_context197.next){case 0:eventSheetManager=this._eventSheetManager;isDebug=this.IsDebug();this.FlushPendingInstances();eventSheetManager.BlockFlushingInstances(true);this.PushCurrentLayout(this.GetMainRunningLayout());if(isDebug)_C3Debugger3.StartMeasuringTime();if(!this.IsDebugging()){_context197.next=11;break;}_context197.next=9;return regeneratorRuntime.awrap(eventSheetManager.DebugRunScheduledWaits());case 9:_context197.next=12;break;case 11:eventSheetManager.RunScheduledWaits();case 12:if(isDebug)_C3Debugger3.AddEventsTime();this.PopCurrentLayout();eventSheetManager.BlockFlushingInstances(false);this.FlushPendingInstances();eventSheetManager.BlockFlushingInstances(true);case 17:case"end":return _context197.stop();}}},null,this);}},{key:"Step_AfterPreTick",value:function Step_AfterPreTick(){var isDebug,isDebugging,dispatcher,eventObjects,userScriptEventObjects;return regeneratorRuntime.async(function Step_AfterPreTick$(_context198){while(1){switch(_context198.prev=_context198.next){case 0:isDebug=this.IsDebug();isDebugging=this.IsDebugging();dispatcher=this._dispatcher;eventObjects=this._eventObjects;userScriptEventObjects=this._userScriptEventObjects;if(isDebug)_C3Debugger3.StartMeasuringTime();if(!isDebugging){_context198.next=11;break;}_context198.next=9;return regeneratorRuntime.awrap(this.DebugIterateAndBreak(this._DebugBehaviorTick()));case 9:_context198.next=12;break;case 11:this._BehaviorTick();case 12:if(!isDebugging){_context198.next=17;break;}_context198.next=15;return regeneratorRuntime.awrap(this.DebugIterateAndBreak(this._DebugBehaviorPostTick()));case 15:_context198.next=18;break;case 17:this._BehaviorPostTick();case 18:if(isDebug)_C3Debugger3.AddBehaviorTickTime();if(isDebug)_C3Debugger3.StartMeasuringTime();if(!isDebugging){_context198.next=25;break;}_context198.next=23;return regeneratorRuntime.awrap(this.DebugFireGeneratorEventAndBreak(eventObjects["tick"]));case 23:_context198.next=26;break;case 25:dispatcher.dispatchEvent(eventObjects["tick"]);case 26:if(isDebug)_C3Debugger3.AddPluginTickTime();this._eventSheetManager.BlockFlushingInstances(false);this.DispatchUserScriptEvent(userScriptEventObjects["tick"]);case 29:case"end":return _context198.stop();}}},null,this);}},{key:"Step_RunEventsEtc",value:function Step_RunEventsEtc(){var eventSheetManager,dispatcher,eventObjects,isDebug,isDebugging;return regeneratorRuntime.async(function Step_RunEventsEtc$(_context199){while(1){switch(_context199.prev=_context199.next){case 0:eventSheetManager=this._eventSheetManager;dispatcher=this._dispatcher;eventObjects=this._eventObjects;isDebug=this.IsDebug();isDebugging=this.IsDebugging();if(isDebug)_C3Debugger3.StartMeasuringTime();if(!isDebugging){_context199.next=11;break;}_context199.next=9;return regeneratorRuntime.awrap(eventSheetManager.DebugRunEvents(this._layoutManager));case 9:_context199.next=12;break;case 11:eventSheetManager.RunEvents(this._layoutManager);case 12:if(isDebug)_C3Debugger3.AddEventsTime();this._collisionEngine.ClearRegisteredCollisions();this._ReleaseInstancesAtEndOfTick();this._isLayoutFirstTick=false;eventSheetManager.BlockFlushingInstances(true);if(isDebug)_C3Debugger3.StartMeasuringTime();if(!isDebugging){_context199.next=23;break;}_context199.next=21;return regeneratorRuntime.awrap(this.DebugIterateAndBreak(this._DebugBehaviorTick2()));case 21:_context199.next=24;break;case 23:this._BehaviorTick2();case 24:if(isDebug)_C3Debugger3.AddBehaviorTickTime();if(isDebug)_C3Debugger3.StartMeasuringTime();if(!isDebugging){_context199.next=31;break;}_context199.next=29;return regeneratorRuntime.awrap(this.DebugFireGeneratorEventAndBreak(eventObjects["tick2"]));case 29:_context199.next=32;break;case 31:dispatcher.dispatchEvent(eventObjects["tick2"]);case 32:if(isDebug)_C3Debugger3.AddPluginTickTime();eventSheetManager.BlockFlushingInstances(false);if(!isDebugging){_context199.next=37;break;}_context199.next=37;return regeneratorRuntime.awrap(eventSheetManager.RunQueuedDebugTriggersAsync());case 37:case"end":return _context199.stop();}}},null,this);}},{key:"_ReleaseInstancesAtEndOfTick",value:function _ReleaseInstancesAtEndOfTick(){if(this._instancesToReleaseAtEndOfTick.size===0)return;var dispatcher=this._dispatcher;dispatcher.SetDelayRemoveEventsEnabled(true);var _iteratorNormalCompletion540=true;var _didIteratorError540=false;var _iteratorError540=undefined;try{for(var _iterator540=this._instancesToReleaseAffectedObjectClasses[Symbol.iterator](),_step540;!(_iteratorNormalCompletion540=(_step540=_iterator540.next()).done);_iteratorNormalCompletion540=true){var objectClass=_step540.value;objectClass.GetSolStack().RemoveInstances(this._instancesToReleaseAtEndOfTick);}}catch(err){_didIteratorError540=true;_iteratorError540=err;}finally{try{if(!_iteratorNormalCompletion540&&_iterator540["return"]!=null){_iterator540["return"]();}}finally{if(_didIteratorError540){throw _iteratorError540;}}}this._instancesToReleaseAffectedObjectClasses.clear();this._eventSheetManager.RemoveInstancesFromScheduledWaits(this._instancesToReleaseAtEndOfTick);var _iteratorNormalCompletion541=true;var _didIteratorError541=false;var _iteratorError541=undefined;try{for(var _iterator541=this._instancesToReleaseAtEndOfTick[Symbol.iterator](),_step541;!(_iteratorNormalCompletion541=(_step541=_iterator541.next()).done);_iteratorNormalCompletion541=true){var inst=_step541.value;inst.Release();}}catch(err){_didIteratorError541=true;_iteratorError541=err;}finally{try{if(!_iteratorNormalCompletion541&&_iterator541["return"]!=null){_iterator541["return"]();}}finally{if(_didIteratorError541){throw _iteratorError541;}}}this._instancesToReleaseAtEndOfTick.clear();dispatcher.SetDelayRemoveEventsEnabled(false);}},{key:"_MaybeChangeLayout",value:function _MaybeChangeLayout(){var layoutManager,i;return regeneratorRuntime.async(function _MaybeChangeLayout$(_context200){while(1){switch(_context200.prev=_context200.next){case 0:layoutManager=this.GetLayoutManager();i=0;case 2:if(!(layoutManager.IsPendingChangeMainLayout()&&i++<10)){_context200.next=7;break;}_context200.next=5;return regeneratorRuntime.awrap(this._DoChangeLayout(layoutManager.GetPendingChangeMainLayout()));case 5:_context200.next=2;break;case 7:case"end":return _context200.stop();}}},null,this);}},{key:"_MeasureDt",value:function _MeasureDt(timestamp){var dtRaw=0;if(this.IsExportToVideo()){dtRaw=1/this.GetExportVideoFramerate();this._dtRaw=dtRaw;this._dt1=dtRaw;}else if(this._lastTickTime!==0){var msDiff=Math.max(timestamp-this._lastTickTime,0);dtRaw=msDiff/1E3;if(dtRaw>.5)dtRaw=0;this._dtRaw=dtRaw;var maxDt1=1/this._minimumFramerate;this._dt1=Math.min(dtRaw,maxDt1);}this._lastTickTime=timestamp;this._dt=this._dt1*this._timeScale;this._gameTime.Add(this._dt);this._gameTimeRaw.Add(dtRaw*this._timeScale);this._wallTime.Add(this._dt1);var _iteratorNormalCompletion542=true;var _didIteratorError542=false;var _iteratorError542=undefined;try{for(var _iterator542=this._instanceTimes[Symbol.iterator](),_step542;!(_iteratorNormalCompletion542=(_step542=_iterator542.next()).done);_iteratorNormalCompletion542=true){var _step542$value=_slicedToArray(_step542.value,2),inst=_step542$value[0],instTime=_step542$value[1];instTime.Add(this._dt1*inst.GetTimeScale());}}catch(err){_didIteratorError542=true;_iteratorError542=err;}finally{try{if(!_iteratorNormalCompletion542&&_iterator542["return"]!=null){_iterator542["return"]();}}finally{if(_didIteratorError542){throw _iteratorError542;}}}if(this._canvasManager)this._canvasManager._UpdateTick();if(timestamp-this._fpsLastTime>=1E3){this._fpsLastTime+=1E3;if(timestamp-this._fpsLastTime>=1E3)this._fpsLastTime=timestamp;this._fps=this._fpsFrameCount;this._fpsFrameCount=0;this._mainThreadTime=Math.min(this._mainThreadTimeCounter/1E3,1);this._mainThreadTimeCounter=0;if(this._canvasManager)this._canvasManager._Update1sFrameRange();this._collisionEngine._Update1sStats();if(this.IsDebug())_C3Debugger3.Update1sPerfStats();}this._fpsFrameCount++;}},{key:"_SetTrackingInstanceTime",value:function _SetTrackingInstanceTime(inst,enable){if(enable){if(!this._instanceTimes.has(inst)){var instTime=_C184.New(_C184.KahanSum);instTime.Copy(this._gameTime);this._instanceTimes.set(inst,instTime);}}else this._instanceTimes["delete"](inst);}},{key:"_GetInstanceGameTime",value:function _GetInstanceGameTime(inst){var instTime=this._instanceTimes.get(inst);return instTime?instTime.Get():this.GetGameTime();}},{key:"_DoChangeLayout",value:function _DoChangeLayout(changeToLayout){var dispatcher,layoutManager,prevLayout;return regeneratorRuntime.async(function _DoChangeLayout$(_context201){while(1){switch(_context201.prev=_context201.next){case 0:dispatcher=this._dispatcher;layoutManager=this.GetLayoutManager();prevLayout=layoutManager.GetMainRunningLayout();_context201.next=5;return regeneratorRuntime.awrap(prevLayout._StopRunning());case 5:prevLayout._Unload(changeToLayout,this.GetRenderer());if(prevLayout===changeToLayout)this._eventSheetManager.ClearAllScheduledWaits();this._collisionEngine.ClearRegisteredCollisions();this._ReleaseInstancesAtEndOfTick();dispatcher.dispatchEvent(this._eventObjects["beforelayoutchange"]);_C184.Asyncify.SetHighThroughputMode(true);_context201.next=13;return regeneratorRuntime.awrap(changeToLayout._Load(prevLayout,this.GetRenderer()));case 13:_C184.Asyncify.SetHighThroughputMode(false);_context201.next=16;return regeneratorRuntime.awrap(changeToLayout._StartRunning(false));case 16:dispatcher.dispatchEvent(this._eventObjects["layoutchange"]);this.UpdateRender();this._isLayoutFirstTick=true;this.FlushPendingInstances();this._ExportToVideoAddKeyframe();case 21:case"end":return _context201.stop();}}},null,this);}},{key:"UpdateRender",value:function UpdateRender(){this._needRender=true;}},{key:"GetWebGLRenderer",value:function GetWebGLRenderer(){if(!this._canvasManager)return null;return this._canvasManager.GetWebGLRenderer();}},{key:"GetWebGPURenderer",value:function GetWebGPURenderer(){if(!this._canvasManager)return null;return this._canvasManager.GetWebGPURenderer();}},{key:"GetRenderer",value:function GetRenderer(){if(!this._canvasManager)return null;return this._canvasManager.GetRenderer();}},{key:"Render",value:function Render(){var canvasManager=this._canvasManager;if(!canvasManager||canvasManager.IsRendererContextLost())return;var renderer=this.GetRenderer();var supportsGPUProfiling=renderer.SupportsGPUProfiling();var isWebGLProfiling=supportsGPUProfiling&&renderer.IsWebGL();var isWebGPUProfiling=supportsGPUProfiling&&renderer.IsWebGPU();if(isWebGLProfiling)renderer.CheckForQueryResults();if(!this._needRender&&!this.IsExportToVideo()){renderer.IncrementFrameNumber();return;}var layout=this._layoutManager.GetMainRunningLayout();renderer.Start();var isDebug=this.IsDebug();if(isDebug)_C3Debugger3.StartMeasuringTime();this._needRender=false;var webglFrameQuery=null;if(isWebGLProfiling){webglFrameQuery=canvasManager.GetGPUFrameTimingsBuffer().AddTimeElapsedQuery();renderer.StartQuery(webglFrameQuery);}var webgpuFrameTimings=null;if(isWebGPUProfiling){webgpuFrameTimings=renderer.StartFrameTiming((1+layout.GetLayerCount())*2);renderer.WriteTimestamp(0);}if(this.Uses3DFeatures()&&canvasManager.GetCurrentFullscreenScalingQuality()==="low")renderer.SetFixedSizeDepthBuffer(canvasManager.GetDrawWidth(),canvasManager.GetDrawHeight());else renderer.SetAutoSizeDepthBuffer();this._Render(this.GetRenderer(),layout);if(webglFrameQuery)renderer.EndQuery(webglFrameQuery);if(isWebGPUProfiling){renderer.WriteTimestamp(1);this._canvasManager._AddWebGPUFrameTiming(webgpuFrameTimings);}renderer.Finish();if(isDebug){_C3Debugger3.AddDrawCallsTime();_C3Debugger3.UpdateInspectHighlight();}if(canvasManager)canvasManager._MaybeTakeSnapshot();}},{key:"_NeedsHTMLLayerCompositing",value:function _NeedsHTMLLayerCompositing(renderer){return this.GetCanvasManager().GetCurrentFullscreenScalingQuality()==="low"||renderer.IsWebGL()&&(this.UsesAnyBackgroundBlending()||this.Uses3DFeatures());}},{key:"_Render",value:function _Render(renderer,layout){renderer.SetTextureFillMode();renderer.SetAlphaBlend();renderer.SetColorRgba(1,1,1,1);renderer.SetRenderTarget(null);renderer.SetTexture(null);renderer.SetDepthEnabled(this.Uses3DFeatures());if(this._NeedsHTMLLayerCompositing(renderer))layout._MaybeStartDrawToOwnTexture(renderer);var htmlLayerCount=layout.GetHTMLLayerCount();for(var i=1;i<htmlLayerCount;++i){layout.DrawForHTMLLayerIndex(renderer,i);if(renderer.IsWebGPU())renderer.Restart();}if(!this._NeedsHTMLLayerCompositing(renderer))layout._MaybeStartDrawToOwnTexture(renderer);layout.DrawMain(renderer);}},{key:"Trigger",value:function Trigger(method,inst,behaviorType){if(!this._hasStarted)return false;var isTopLevel=!this._isInTick&&!this._eventSheetManager.IsInTrigger();var startTime=0;if(isTopLevel)startTime=performance.now();var isDebug=this.IsDebug();if(isDebug)this.SetDebuggingEnabled(false);var ret=this._eventSheetManager._Trigger(this._layoutManager,method,inst,behaviorType);if(isTopLevel){var triggerTime=performance.now()-startTime;this._mainThreadTimeCounter+=triggerTime;if(isDebug)_C3Debugger3.AddTriggersTime(triggerTime);}if(isDebug)this.SetDebuggingEnabled(true);return ret;}},{key:"DebugTrigger",value:function DebugTrigger(method,inst,behaviorType){if(!this.IsDebugging())return this.Trigger(method,inst,behaviorType);if(this.HitBreakpoint())throw new Error("called DebugTrigger() while stopped on breakpoint");if(!this._isInTick&&!this._eventSheetManager.IsInTrigger())throw new Error("called DebugTrigger() outside of event code - use TriggerAsync() instead");return this._eventSheetManager._DebugTrigger(this._layoutManager,method,inst,behaviorType);}},{key:"TriggerAsync",value:function TriggerAsync(method,inst,behaviorType){var startTime,iter,result;return regeneratorRuntime.async(function TriggerAsync$(_context202){while(1){switch(_context202.prev=_context202.next){case 0:if(this.IsDebugging()){_context202.next=2;break;}return _context202.abrupt("return",this.Trigger(method,inst,behaviorType));case 2:if(this._hasStarted){_context202.next=4;break;}return _context202.abrupt("return",false);case 4:if(!this.HitBreakpoint()){_context202.next=6;break;}return _context202.abrupt("return",this._eventSheetManager.QueueDebugTrigger(method,inst,behaviorType));case 6:if(this.GetMainRunningLayout()){_context202.next=8;break;}return _context202.abrupt("return",this._eventSheetManager.QueueTrigger(method,inst,behaviorType));case 8:startTime=performance.now();iter=this._eventSheetManager._DebugTrigger(this._layoutManager,method,inst,behaviorType);result=iter.next();case 11:if(result.done){_context202.next=17;break;}_context202.next=14;return regeneratorRuntime.awrap(this.DebugBreak(result.value));case 14:result=iter.next();_context202.next=11;break;case 17:if(!(!this.IsSuspended()&&!this._eventSheetManager.IsInTrigger())){_context202.next=21;break;}_context202.next=20;return regeneratorRuntime.awrap(this._eventSheetManager.RunQueuedDebugTriggersAsync());case 20:if(this._hasStartedTicking&&!this._isInTick)this._RequestAnimationFrame();case 21:this._mainThreadTimeCounter+=performance.now()-startTime;return _context202.abrupt("return",result.value);case 23:case"end":return _context202.stop();}}},null,this);}},{key:"FastTrigger",value:function FastTrigger(method,inst,value){var isDebug=this.IsDebug();if(isDebug)this.SetDebuggingEnabled(false);var ret=this._eventSheetManager._FastTrigger(this._layoutManager,method,inst,value);if(isDebug)this.SetDebuggingEnabled(true);return ret;}},{key:"DebugFastTrigger",value:function DebugFastTrigger(method,inst,value){return this._eventSheetManager._DebugFastTrigger(this._layoutManager,method,inst,value);}},{key:"ScheduleTriggers",value:function ScheduleTriggers(f){return this._scheduleTriggersThrottle.Add(f);}},{key:"PushCurrentLayout",value:function PushCurrentLayout(layout){this._currentLayoutStack.push(layout);}},{key:"PopCurrentLayout",value:function PopCurrentLayout(){if(!this._currentLayoutStack.length)throw new Error("layout stack empty");this._currentLayoutStack.pop();}},{key:"GetCurrentLayout",value:function GetCurrentLayout(){if(!this._currentLayoutStack.length)return this.GetMainRunningLayout();return this._currentLayoutStack.at(-1);}},{key:"GetDt",value:function GetDt(inst){if(!inst||inst.GetTimeScale()===-1)return this._dt;return this._dt1*inst.GetTimeScale();}},{key:"_GetDtFast",value:function _GetDtFast(){return this._dt;}},{key:"GetDt1",value:function GetDt1(){return this._dt1;}},{key:"GetDtRaw",value:function GetDtRaw(){return this._dtRaw;}},{key:"GetTimeScale",value:function GetTimeScale(){return this._timeScale;}},{key:"SetTimeScale",value:function SetTimeScale(ts){if(isNaN(ts)||ts<0)ts=0;this._timeScale=ts;}},{key:"SetMinimumFramerate",value:function SetMinimumFramerate(fps){this._minimumFramerate=_C184.clamp(fps,1,120);}},{key:"GetMinimumFramerate",value:function GetMinimumFramerate(){return this._minimumFramerate;}},{key:"GetFPS",value:function GetFPS(){return this._fps;}},{key:"GetMainThreadTime",value:function GetMainThreadTime(){return this._mainThreadTime;}},{key:"GetStartTime",value:function GetStartTime(){return this._startTime;}},{key:"GetGameTime",value:function GetGameTime(){return this._gameTime.Get();}},{key:"GetGameTimeRaw",value:function GetGameTimeRaw(){return this._gameTimeRaw.Get();}},{key:"GetWallTime",value:function GetWallTime(){return this._wallTime.Get();}},{key:"GetTickCount",value:function GetTickCount(){return this._tickCount;}},{key:"GetTickCountNoSave",value:function GetTickCountNoSave(){return this._tickCountNoSave;}},{key:"GetObjectCount",value:function GetObjectCount(){return this._objectCount;}},{key:"GetProjectName",value:function GetProjectName(){return this._projectName;}},{key:"GetProjectVersion",value:function GetProjectVersion(){return this._projectVersion;}},{key:"GetProjectUniqueId",value:function GetProjectUniqueId(){return this._projectUniqueId;}},{key:"GetAppId",value:function GetAppId(){return this._appId;}},{key:"GetInstanceByUID",value:function GetInstanceByUID(uid){if(this._isLoadingState)throw new Error("cannot call while loading state - wait until afterload event");return this._instancesByUid.get(uid)||null;}},{key:"_RefreshUidMap",value:function _RefreshUidMap(){this._instancesByUid.clear();var _iteratorNormalCompletion543=true;var _didIteratorError543=false;var _iteratorError543=undefined;try{for(var _iterator543=this._allObjectClasses[Symbol.iterator](),_step543;!(_iteratorNormalCompletion543=(_step543=_iterator543.next()).done);_iteratorNormalCompletion543=true){var objectClass=_step543.value;if(objectClass.IsFamily())continue;var _iteratorNormalCompletion544=true;var _didIteratorError544=false;var _iteratorError544=undefined;try{for(var _iterator544=objectClass.GetInstances()[Symbol.iterator](),_step544;!(_iteratorNormalCompletion544=(_step544=_iterator544.next()).done);_iteratorNormalCompletion544=true){var inst=_step544.value;this._instancesByUid.set(inst.GetUID(),inst);}}catch(err){_didIteratorError544=true;_iteratorError544=err;}finally{try{if(!_iteratorNormalCompletion544&&_iterator544["return"]!=null){_iterator544["return"]();}}finally{if(_didIteratorError544){throw _iteratorError544;}}}}}catch(err){_didIteratorError543=true;_iteratorError543=err;}finally{try{if(!_iteratorNormalCompletion543&&_iterator543["return"]!=null){_iterator543["return"]();}}finally{if(_didIteratorError543){throw _iteratorError543;}}}}},{key:"IsPreview",value:function IsPreview(){return this._exportType==="preview";}},{key:"IsDebug",value:function IsDebug(){return this._isDebug;}},{key:"GetExportType",value:function GetExportType(){return this._exportType;}},{key:"IsCordova",value:function IsCordova(){return this._exportType==="cordova";}},{key:"IsAndroidWebView",value:function IsAndroidWebView(){return _C184.Platform.OS==="Android"&&(this._exportType==="cordova"||this._exportType==="playable-ad"||this._exportType==="instant-games");}},{key:"IsiOSCordova",value:function IsiOSCordova(){return this._isiOSCordova;}},{key:"IsiOSWebView",value:function IsiOSWebView(){return this._isiOSWebView;}},{key:"IsWindowsWebView2",value:function IsWindowsWebView2(){return this._isWindowsWebView2;}},{key:"IsAnyWebView2Wrapper",value:function IsAnyWebView2Wrapper(){return this._isAnyWebView2Wrapper;}},{key:"GetCollisionEngine",value:function GetCollisionEngine(){return this._collisionEngine;}},{key:"GetSolidBehavior",value:function GetSolidBehavior(){return this._pluginManager.GetSolidBehavior();}},{key:"GetJumpthruBehavior",value:function GetJumpthruBehavior(){return this._pluginManager.GetJumpthruBehavior();}},{key:"Uses3DFeatures",value:function Uses3DFeatures(){return this._uses3dFeatures;}},{key:"GetZScaleFactor",value:function GetZScaleFactor(){return this.GetRenderer().GetZAxisScaleFactor(this.GetViewportHeight());}},{key:"GetDefaultCameraZ",value:function GetDefaultCameraZ(viewH){return this.GetRenderer().GetDefaultCameraZ(viewH||this.GetViewportHeight());}},{key:"IsLayoutFirstTick",value:function IsLayoutFirstTick(){return this._isLayoutFirstTick;}},{key:"SetPixelRoundingEnabled",value:function SetPixelRoundingEnabled(e){e=!!e;if(this._isPixelRoundingEnabled===e)return;this._isPixelRoundingEnabled=e;this.GetLayoutManager().SetAllLayerMVChanged();this.UpdateRender();}},{key:"IsPixelRoundingEnabled",value:function IsPixelRoundingEnabled(){return this._isPixelRoundingEnabled;}},{key:"GetTextIconSet",value:function GetTextIconSet(iconSource){var _this166=this;if(!this._iconChangeHandlers.has(iconSource)){var changeHandler=function changeHandler(){return _this166.DeleteTextIconSet(iconSource);};this._iconChangeHandlers.set(iconSource,changeHandler);iconSource.Dispatcher().addEventListener("animationframeimagechange",changeHandler);}var iconSet=this._textIconManager.GetIconSet(iconSource);if(!iconSet.HasLoaded())iconSet.LoadContent().then(function(){return _this166.UpdateRender();});return iconSet;}},{key:"DeleteTextIconSet",value:function DeleteTextIconSet(iconSource){this._textIconManager.DeleteIconSet(iconSource);}},{key:"_GetTextIconSetMeta",value:function _GetTextIconSetMeta(iconSource){var icons=[];var _iteratorNormalCompletion545=true;var _didIteratorError545=false;var _iteratorError545=undefined;try{for(var _iterator545=iconSource.GetAnimations()[Symbol.iterator](),_step545;!(_iteratorNormalCompletion545=(_step545=_iterator545.next()).done);_iteratorNormalCompletion545=true){var animation=_step545.value;var _iteratorNormalCompletion546=true;var _didIteratorError546=false;var _iteratorError546=undefined;try{for(var _iterator546=animation.GetFrames()[Symbol.iterator](),_step546;!(_iteratorNormalCompletion546=(_step546=_iterator546.next()).done);_iteratorNormalCompletion546=true){var frame=_step546.value;var imageInfo=frame.GetImageInfo();icons.push({source:frame,width:imageInfo.GetWidth(),height:imageInfo.GetHeight(),tag:frame.GetTag()});}}catch(err){_didIteratorError546=true;_iteratorError546=err;}finally{try{if(!_iteratorNormalCompletion546&&_iterator546["return"]!=null){_iterator546["return"]();}}finally{if(_didIteratorError546){throw _iteratorError546;}}}}}catch(err){_didIteratorError545=true;_iteratorError545=err;}finally{try{if(!_iteratorNormalCompletion545&&_iterator545["return"]!=null){_iterator545["return"]();}}finally{if(_didIteratorError545){throw _iteratorError545;}}}return{icons:icons};}},{key:"_GetTextIconSetContent",value:function _GetTextIconSetContent(iconSource){var promiseThrottle,assetDrawablePromises,assetDrawableMap,_iteratorNormalCompletion547,_didIteratorError547,_iteratorError547,_iterator547,_step547,animation,_iteratorNormalCompletion550,_didIteratorError550,_iteratorError550,_loop10,_iterator550,_step550,_ret8,extractPromises,_iteratorNormalCompletion548,_didIteratorError548,_iteratorError548,_iterator548,_step548,_animation,_iteratorNormalCompletion551,_didIteratorError551,_iteratorError551,_loop11,_iterator551,_step551,iconsArr,_iteratorNormalCompletion549,_didIteratorError549,_iteratorError549,_iterator549,_step549,drawable;return regeneratorRuntime.async(function _GetTextIconSetContent$(_context205){while(1){switch(_context205.prev=_context205.next){case 0:promiseThrottle=_C184.New(_C184.PromiseThrottle);assetDrawablePromises=[];assetDrawableMap=new Map();_iteratorNormalCompletion547=true;_didIteratorError547=false;_iteratorError547=undefined;_context205.prev=6;_iterator547=iconSource.GetAnimations()[Symbol.iterator]();case 8:if(_iteratorNormalCompletion547=(_step547=_iterator547.next()).done){_context205.next=40;break;}animation=_step547.value;_iteratorNormalCompletion550=true;_didIteratorError550=false;_iteratorError550=undefined;_context205.prev=13;_loop10=function _loop10(){var frame=_step550.value;var imageAsset=frame.GetImageInfo().GetImageAsset();if(assetDrawableMap.has(imageAsset))return"continue";assetDrawableMap.set(imageAsset,null);assetDrawablePromises.push(promiseThrottle.Add(function _callee12(){var drawable;return regeneratorRuntime.async(function _callee12$(_context203){while(1){switch(_context203.prev=_context203.next){case 0:_context203.next=2;return regeneratorRuntime.awrap(imageAsset.LoadToDrawable());case 2:drawable=_context203.sent;assetDrawableMap.set(imageAsset,drawable);case 4:case"end":return _context203.stop();}}});}));};_iterator550=animation.GetFrames()[Symbol.iterator]();case 16:if(_iteratorNormalCompletion550=(_step550=_iterator550.next()).done){_context205.next=23;break;}_ret8=_loop10();if(!(_ret8==="continue")){_context205.next=20;break;}return _context205.abrupt("continue",20);case 20:_iteratorNormalCompletion550=true;_context205.next=16;break;case 23:_context205.next=29;break;case 25:_context205.prev=25;_context205.t0=_context205["catch"](13);_didIteratorError550=true;_iteratorError550=_context205.t0;case 29:_context205.prev=29;_context205.prev=30;if(!_iteratorNormalCompletion550&&_iterator550["return"]!=null){_iterator550["return"]();}case 32:_context205.prev=32;if(!_didIteratorError550){_context205.next=35;break;}throw _iteratorError550;case 35:return _context205.finish(32);case 36:return _context205.finish(29);case 37:_iteratorNormalCompletion547=true;_context205.next=8;break;case 40:_context205.next=46;break;case 42:_context205.prev=42;_context205.t1=_context205["catch"](6);_didIteratorError547=true;_iteratorError547=_context205.t1;case 46:_context205.prev=46;_context205.prev=47;if(!_iteratorNormalCompletion547&&_iterator547["return"]!=null){_iterator547["return"]();}case 49:_context205.prev=49;if(!_didIteratorError547){_context205.next=52;break;}throw _iteratorError547;case 52:return _context205.finish(49);case 53:return _context205.finish(46);case 54:_context205.next=56;return regeneratorRuntime.awrap(Promise.all(assetDrawablePromises));case 56:extractPromises=[];_iteratorNormalCompletion548=true;_didIteratorError548=false;_iteratorError548=undefined;_context205.prev=60;_iterator548=iconSource.GetAnimations()[Symbol.iterator]();case 62:if(_iteratorNormalCompletion548=(_step548=_iterator548.next()).done){_context205.next=87;break;}_animation=_step548.value;_iteratorNormalCompletion551=true;_didIteratorError551=false;_iteratorError551=undefined;_context205.prev=67;_loop11=function _loop11(){var frame=_step551.value;extractPromises.push(promiseThrottle.Add(function _callee13(){var imageInfo,imageAssetDrawable,canvas,imageBitmap;return regeneratorRuntime.async(function _callee13$(_context204){while(1){switch(_context204.prev=_context204.next){case 0:imageInfo=frame.GetImageInfo();imageAssetDrawable=assetDrawableMap.get(imageInfo.GetImageAsset());_context204.next=4;return regeneratorRuntime.awrap(imageInfo.ExtractImageToCanvas(imageAssetDrawable));case 4:canvas=_context204.sent;_context204.next=7;return regeneratorRuntime.awrap(createImageBitmap(canvas));case 7:imageBitmap=_context204.sent;return _context204.abrupt("return",{drawable:imageBitmap});case 9:case"end":return _context204.stop();}}});}));};for(_iterator551=_animation.GetFrames()[Symbol.iterator]();!(_iteratorNormalCompletion551=(_step551=_iterator551.next()).done);_iteratorNormalCompletion551=true){_loop11();}_context205.next=76;break;case 72:_context205.prev=72;_context205.t2=_context205["catch"](67);_didIteratorError551=true;_iteratorError551=_context205.t2;case 76:_context205.prev=76;_context205.prev=77;if(!_iteratorNormalCompletion551&&_iterator551["return"]!=null){_iterator551["return"]();}case 79:_context205.prev=79;if(!_didIteratorError551){_context205.next=82;break;}throw _iteratorError551;case 82:return _context205.finish(79);case 83:return _context205.finish(76);case 84:_iteratorNormalCompletion548=true;_context205.next=62;break;case 87:_context205.next=93;break;case 89:_context205.prev=89;_context205.t3=_context205["catch"](60);_didIteratorError548=true;_iteratorError548=_context205.t3;case 93:_context205.prev=93;_context205.prev=94;if(!_iteratorNormalCompletion548&&_iterator548["return"]!=null){_iterator548["return"]();}case 96:_context205.prev=96;if(!_didIteratorError548){_context205.next=99;break;}throw _iteratorError548;case 99:return _context205.finish(96);case 100:return _context205.finish(93);case 101:_context205.next=103;return regeneratorRuntime.awrap(Promise.all(extractPromises));case 103:iconsArr=_context205.sent;_iteratorNormalCompletion549=true;_didIteratorError549=false;_iteratorError549=undefined;_context205.prev=107;for(_iterator549=assetDrawableMap.values()[Symbol.iterator]();!(_iteratorNormalCompletion549=(_step549=_iterator549.next()).done);_iteratorNormalCompletion549=true){drawable=_step549.value;if(drawable instanceof ImageBitmap&&drawable["close"])drawable["close"]();}_context205.next=115;break;case 111:_context205.prev=111;_context205.t4=_context205["catch"](107);_didIteratorError549=true;_iteratorError549=_context205.t4;case 115:_context205.prev=115;_context205.prev=116;if(!_iteratorNormalCompletion549&&_iterator549["return"]!=null){_iterator549["return"]();}case 118:_context205.prev=118;if(!_didIteratorError549){_context205.next=121;break;}throw _iteratorError549;case 121:return _context205.finish(118);case 122:return _context205.finish(115);case 123:return _context205.abrupt("return",{icons:iconsArr});case 124:case"end":return _context205.stop();}}},null,null,[[6,42,46,54],[13,25,29,37],[30,,32,36],[47,,49,53],[60,89,93,101],[67,72,76,84],[77,,79,83],[94,,96,100],[107,111,115,123],[116,,118,122]]);}},{key:"SaveToSlot",value:function SaveToSlot(slotName){this._saveToSlotName=slotName;}},{key:"LoadFromSlot",value:function LoadFromSlot(slotName){this._loadFromSlotName=slotName;}},{key:"LoadFromJsonString",value:function LoadFromJsonString(str){this._loadFromJson=str;}},{key:"GetLastSaveJsonString",value:function GetLastSaveJsonString(){return this._lastSaveJson;}},{key:"_NeedsHandleSaveOrLoad",value:function _NeedsHandleSaveOrLoad(){return!!(this._saveToSlotName||this._loadFromSlotName||this._loadFromJson!==null);}},{key:"_HandleSaveOrLoad",value:function _HandleSaveOrLoad(){return regeneratorRuntime.async(function _HandleSaveOrLoad$(_context206){while(1){switch(_context206.prev=_context206.next){case 0:if(!this._saveToSlotName){_context206.next=5;break;}this.FlushPendingInstances();_context206.next=4;return regeneratorRuntime.awrap(this._DoSaveToSlot(this._saveToSlotName));case 4:this._ClearSaveOrLoad();case 5:if(!this._loadFromSlotName){_context206.next=10;break;}_context206.next=8;return regeneratorRuntime.awrap(this._DoLoadFromSlot(this._loadFromSlotName));case 8:this._ClearSaveOrLoad();if(this.IsDebug())_C3Debugger3.StepIfPausedInDebugger();case 10:if(!(this._loadFromJson!==null)){_context206.next=27;break;}this.FlushPendingInstances();_context206.prev=12;_context206.next=15;return regeneratorRuntime.awrap(this._DoLoadFromJsonString(this._loadFromJson));case 15:this._lastSaveJson=this._loadFromJson;_context206.next=18;return regeneratorRuntime.awrap(this.TriggerAsync(_C184.Plugins.System.Cnds.OnLoadComplete,null));case 18:this._lastSaveJson="";_context206.next=26;break;case 21:_context206.prev=21;_context206.t0=_context206["catch"](12);console.error("[Construct] Failed to load state from JSON string: ",_context206.t0);_context206.next=26;return regeneratorRuntime.awrap(this.TriggerAsync(_C184.Plugins.System.Cnds.OnLoadFailed,null));case 26:this._ClearSaveOrLoad();case 27:case"end":return _context206.stop();}}},null,this,[[12,21]]);}},{key:"_ClearSaveOrLoad",value:function _ClearSaveOrLoad(){this._saveToSlotName="";this._loadFromSlotName="";this._loadFromJson=null;}},{key:"_GetProjectStorage",value:function _GetProjectStorage(){if(!this._projectStorage)this._projectStorage=localforage.createInstance({name:"c3-localstorage-"+this.GetProjectUniqueId(),description:this.GetProjectName()});return this._projectStorage;}},{key:"_GetSavegamesStorage",value:function _GetSavegamesStorage(){if(!this._savegamesStorage)this._savegamesStorage=localforage.createInstance({name:"c3-savegames-"+this.GetProjectUniqueId(),description:this.GetProjectName()});return this._savegamesStorage;}},{key:"_DoSaveToSlot",value:function _DoSaveToSlot(slotName){var saveJson;return regeneratorRuntime.async(function _DoSaveToSlot$(_context207){while(1){switch(_context207.prev=_context207.next){case 0:_context207.next=2;return regeneratorRuntime.awrap(this._SaveToJsonString());case 2:saveJson=_context207.sent;_context207.prev=3;_context207.next=6;return regeneratorRuntime.awrap(this._GetSavegamesStorage().setItem(slotName,saveJson));case 6:console.log("[Construct] Saved state to storage ("+saveJson.length+" chars)");this._lastSaveJson=saveJson;_context207.next=10;return regeneratorRuntime.awrap(this.TriggerAsync(_C184.Plugins.System.Cnds.OnSaveComplete,null));case 10:this._lastSaveJson="";_context207.next=18;break;case 13:_context207.prev=13;_context207.t0=_context207["catch"](3);console.error("[Construct] Failed to save state to storage: ",_context207.t0);_context207.next=18;return regeneratorRuntime.awrap(this.TriggerAsync(_C184.Plugins.System.Cnds.OnSaveFailed,null));case 18:case"end":return _context207.stop();}}},null,this,[[3,13]]);}},{key:"_DoLoadFromSlot",value:function _DoLoadFromSlot(slotName){var loadJson;return regeneratorRuntime.async(function _DoLoadFromSlot$(_context208){while(1){switch(_context208.prev=_context208.next){case 0:_context208.prev=0;_context208.next=3;return regeneratorRuntime.awrap(this._GetSavegamesStorage().getItem(slotName));case 3:loadJson=_context208.sent;if(loadJson){_context208.next=6;break;}throw new Error("empty slot");case 6:console.log("[Construct] Loaded state from storage ("+loadJson.length+" chars)");_context208.next=9;return regeneratorRuntime.awrap(this._DoLoadFromJsonString(loadJson));case 9:this._lastSaveJson=loadJson;_context208.next=12;return regeneratorRuntime.awrap(this.TriggerAsync(_C184.Plugins.System.Cnds.OnLoadComplete,null));case 12:this._lastSaveJson="";_context208.next=20;break;case 15:_context208.prev=15;_context208.t0=_context208["catch"](0);console.error("[Construct] Failed to load state from storage: ",_context208.t0);_context208.next=20;return regeneratorRuntime.awrap(this.TriggerAsync(_C184.Plugins.System.Cnds.OnLoadFailed,null));case 20:case"end":return _context208.stop();}}},null,this,[[0,15]]);}},{key:"_SaveToJsonString",value:function _SaveToJsonString(){var o,_iteratorNormalCompletion552,_didIteratorError552,_iteratorError552,_iterator552,_step552,objectClass,_iteratorNormalCompletion553,_didIteratorError553,_iteratorError553,_iterator553,_step553,layout,saveEvent;return regeneratorRuntime.async(function _SaveToJsonString$(_context209){while(1){switch(_context209.prev=_context209.next){case 0:o={"c3save":true,"version":1,"rt":{"time":this.GetGameTime(),"timeRaw":this.GetGameTimeRaw(),"walltime":this.GetWallTime(),"timescale":this.GetTimeScale(),"tickcount":this.GetTickCount(),"next_uid":this._nextUid,"running_layout":this.GetMainRunningLayout().GetSID(),"start_time_offset":Date.now()-this._startTime},"types":{},"layouts":{},"events":this._eventSheetManager._SaveToJson(),"timelines":this._timelineManager._SaveToJson(),"flowcharts":this._flowchartManager?this._flowchartManager._SaveToJson():null,"user_script_data":null};_iteratorNormalCompletion552=true;_didIteratorError552=false;_iteratorError552=undefined;_context209.prev=4;_iterator552=this._allObjectClasses[Symbol.iterator]();case 6:if(_iteratorNormalCompletion552=(_step552=_iterator552.next()).done){_context209.next=14;break;}objectClass=_step552.value;if(!(objectClass.IsFamily()||objectClass.HasNoSaveBehavior())){_context209.next=10;break;}return _context209.abrupt("continue",11);case 10:o["types"][objectClass.GetSID().toString()]=objectClass._SaveToJson();case 11:_iteratorNormalCompletion552=true;_context209.next=6;break;case 14:_context209.next=20;break;case 16:_context209.prev=16;_context209.t0=_context209["catch"](4);_didIteratorError552=true;_iteratorError552=_context209.t0;case 20:_context209.prev=20;_context209.prev=21;if(!_iteratorNormalCompletion552&&_iterator552["return"]!=null){_iterator552["return"]();}case 23:_context209.prev=23;if(!_didIteratorError552){_context209.next=26;break;}throw _iteratorError552;case 26:return _context209.finish(23);case 27:return _context209.finish(20);case 28:_iteratorNormalCompletion553=true;_didIteratorError553=false;_iteratorError553=undefined;_context209.prev=31;for(_iterator553=this._layoutManager.GetAllLayouts()[Symbol.iterator]();!(_iteratorNormalCompletion553=(_step553=_iterator553.next()).done);_iteratorNormalCompletion553=true){layout=_step553.value;o["layouts"][layout.GetSID().toString()]=layout._SaveToJson();}_context209.next=39;break;case 35:_context209.prev=35;_context209.t1=_context209["catch"](31);_didIteratorError553=true;_iteratorError553=_context209.t1;case 39:_context209.prev=39;_context209.prev=40;if(!_iteratorNormalCompletion553&&_iterator553["return"]!=null){_iterator553["return"]();}case 42:_context209.prev=42;if(!_didIteratorError553){_context209.next=45;break;}throw _iteratorError553;case 45:return _context209.finish(42);case 46:return _context209.finish(39);case 47:saveEvent=this._CreateUserScriptEvent("save");saveEvent.saveData=null;_context209.next=51;return regeneratorRuntime.awrap(this.DispatchUserScriptEventAsyncWait(saveEvent));case 51:o["user_script_data"]=saveEvent.saveData;return _context209.abrupt("return",JSON.stringify(o));case 53:case"end":return _context209.stop();}}},null,this,[[4,16,20,28],[21,,23,27],[31,35,39,47],[40,,42,46]]);}},{key:"IsLoadingState",value:function IsLoadingState(){return this._isLoadingState;}},{key:"_DoLoadFromJsonString",value:function _DoLoadFromJsonString(jsonStr){var layoutManager,o,_iteratorNormalCompletion554,_didIteratorError554,_iteratorError554,_iterator554,_step554,_inst15,_objectClass9,rt,layoutSid,changedLayout,changeToLayout,_i66,_Object$entries21,_Object$entries21$_i,_sidStr2,_data3,_sid5,layout,_i67,_Object$entries22,_Object$entries22$_i,_sidStr3,_data4,_sid6,_objectClass10,_iteratorNormalCompletion555,_didIteratorError555,_iteratorError555,_iterator555,_step555,_layout,_iteratorNormalCompletion558,_didIteratorError558,_iteratorError558,_iterator558,_step558,layer,_iteratorNormalCompletion556,_didIteratorError556,_iteratorError556,_iterator556,_step556,inst,_i68,_Object$entries23,_Object$entries23$_i,sidStr,data,sid,objectClass,_iteratorNormalCompletion557,_didIteratorError557,_iteratorError557,_iterator557,_step557,_objectClass11,_iteratorNormalCompletion559,_didIteratorError559,_iteratorError559,_iterator559,_step559,_inst16,iid,_iteratorNormalCompletion560,_didIteratorError560,_iteratorError560,_iterator560,_step560,otherType,otherInstances,_i69,_Object$entries24,_Object$entries24$_i,_sidStr4,_data5,_sid7,_objectClass12,loadEvent;return regeneratorRuntime.async(function _DoLoadFromJsonString$(_context210){while(1){switch(_context210.prev=_context210.next){case 0:layoutManager=this.GetLayoutManager();o=JSON.parse(jsonStr);if(!o["c2save"]){_context210.next=4;break;}throw new Error("C2 saves are incompatible with C3 runtime");case 4:if(o["c3save"]){_context210.next=6;break;}throw new Error("not valid C3 save data");case 6:if(!(o["version"]>1)){_context210.next=8;break;}throw new Error("C3 save data from future version");case 8:this.ClearIntancesNeedingAfterLoad();this._dispatcher.dispatchEvent(_C184.New(_C184.Event,"beforeload"));_iteratorNormalCompletion554=true;_didIteratorError554=false;_iteratorError554=undefined;_context210.prev=13;_iterator554=this.allInstances()[Symbol.iterator]();case 15:if(_iteratorNormalCompletion554=(_step554=_iterator554.next()).done){_context210.next=24;break;}_inst15=_step554.value;_objectClass9=_inst15.GetObjectClass();if(!_objectClass9.HasNoSaveBehavior()){_context210.next=20;break;}return _context210.abrupt("continue",21);case 20:_inst15._OnBeforeLoad();case 21:_iteratorNormalCompletion554=true;_context210.next=15;break;case 24:_context210.next=30;break;case 26:_context210.prev=26;_context210.t0=_context210["catch"](13);_didIteratorError554=true;_iteratorError554=_context210.t0;case 30:_context210.prev=30;_context210.prev=31;if(!_iteratorNormalCompletion554&&_iterator554["return"]!=null){_iterator554["return"]();}case 33:_context210.prev=33;if(!_didIteratorError554){_context210.next=36;break;}throw _iteratorError554;case 36:return _context210.finish(33);case 37:return _context210.finish(30);case 38:rt=o["rt"];this._gameTime.Set(rt["time"]);if(rt.hasOwnProperty("timeRaw"))this._gameTimeRaw.Set(rt["timeRaw"]);this._wallTime.Set(rt["walltime"]);this._timeScale=rt["timescale"];this._tickCount=rt["tickcount"];this._startTime=Date.now()-rt["start_time_offset"];layoutSid=rt["running_layout"];this._isLoadingState=true;changedLayout=false;if(!(layoutSid!==this.GetMainRunningLayout().GetSID())){_context210.next=57;break;}changeToLayout=layoutManager.GetLayoutBySID(layoutSid);if(!changeToLayout){_context210.next=56;break;}_context210.next=53;return regeneratorRuntime.awrap(this._DoChangeLayout(changeToLayout));case 53:changedLayout=true;_context210.next=57;break;case 56:return _context210.abrupt("return");case 57:_i66=0,_Object$entries21=Object.entries(o["layouts"]);case 58:if(!(_i66<_Object$entries21.length)){_context210.next=68;break;}_Object$entries21$_i=_slicedToArray(_Object$entries21[_i66],2),_sidStr2=_Object$entries21$_i[0],_data3=_Object$entries21$_i[1];_sid5=parseInt(_sidStr2,10);layout=layoutManager.GetLayoutBySID(_sid5);if(layout){_context210.next=64;break;}return _context210.abrupt("continue",65);case 64:layout._LoadFromJson(_data3);case 65:_i66++;_context210.next=58;break;case 68:_i67=0,_Object$entries22=Object.entries(o["types"]);case 69:if(!(_i67<_Object$entries22.length)){_context210.next=79;break;}_Object$entries22$_i=_slicedToArray(_Object$entries22[_i67],2),_sidStr3=_Object$entries22$_i[0],_data4=_Object$entries22$_i[1];_sid6=parseInt(_sidStr3,10);_objectClass10=this.GetObjectClassBySID(_sid6);if(!(!_objectClass10||_objectClass10.IsFamily()||_objectClass10.HasNoSaveBehavior())){_context210.next=75;break;}return _context210.abrupt("continue",76);case 75:_objectClass10._LoadFromJson(_data4);case 76:_i67++;_context210.next=69;break;case 79:_iteratorNormalCompletion555=true;_didIteratorError555=false;_iteratorError555=undefined;_context210.prev=82;_iterator555=this._layoutManager.GetAllLayouts()[Symbol.iterator]();case 84:if(_iteratorNormalCompletion555=(_step555=_iterator555.next()).done){_context210.next=108;break;}_layout=_step555.value;_iteratorNormalCompletion558=true;_didIteratorError558=false;_iteratorError558=undefined;_context210.prev=89;for(_iterator558=_layout.allLayers()[Symbol.iterator]();!(_iteratorNormalCompletion558=(_step558=_iterator558.next()).done);_iteratorNormalCompletion558=true){layer=_step558.value;layer._LoadFromJsonAfterInstances();}_context210.next=97;break;case 93:_context210.prev=93;_context210.t1=_context210["catch"](89);_didIteratorError558=true;_iteratorError558=_context210.t1;case 97:_context210.prev=97;_context210.prev=98;if(!_iteratorNormalCompletion558&&_iterator558["return"]!=null){_iterator558["return"]();}case 100:_context210.prev=100;if(!_didIteratorError558){_context210.next=103;break;}throw _iteratorError558;case 103:return _context210.finish(100);case 104:return _context210.finish(97);case 105:_iteratorNormalCompletion555=true;_context210.next=84;break;case 108:_context210.next=114;break;case 110:_context210.prev=110;_context210.t2=_context210["catch"](82);_didIteratorError555=true;_iteratorError555=_context210.t2;case 114:_context210.prev=114;_context210.prev=115;if(!_iteratorNormalCompletion555&&_iterator555["return"]!=null){_iterator555["return"]();}case 117:_context210.prev=117;if(!_didIteratorError555){_context210.next=120;break;}throw _iteratorError555;case 120:return _context210.finish(117);case 121:return _context210.finish(114);case 122:this.FlushPendingInstances();this._RefreshUidMap();this._isLoadingState=false;if(!changedLayout){_context210.next=156;break;}_iteratorNormalCompletion556=true;_didIteratorError556=false;_iteratorError556=undefined;_context210.prev=129;for(_iterator556=this.allInstances()[Symbol.iterator]();!(_iteratorNormalCompletion556=(_step556=_iterator556.next()).done);_iteratorNormalCompletion556=true){inst=_step556.value;inst.SetupInitialSceneGraphConnections();}_context210.next=137;break;case 133:_context210.prev=133;_context210.t3=_context210["catch"](129);_didIteratorError556=true;_iteratorError556=_context210.t3;case 137:_context210.prev=137;_context210.prev=138;if(!_iteratorNormalCompletion556&&_iterator556["return"]!=null){_iterator556["return"]();}case 140:_context210.prev=140;if(!_didIteratorError556){_context210.next=143;break;}throw _iteratorError556;case 143:return _context210.finish(140);case 144:return _context210.finish(137);case 145:_i68=0,_Object$entries23=Object.entries(o["types"]);case 146:if(!(_i68<_Object$entries23.length)){_context210.next=156;break;}_Object$entries23$_i=_slicedToArray(_Object$entries23[_i68],2),sidStr=_Object$entries23$_i[0],data=_Object$entries23$_i[1];sid=parseInt(sidStr,10);objectClass=this.GetObjectClassBySID(sid);if(!(!objectClass||objectClass.IsFamily()||objectClass.HasNoSaveBehavior())){_context210.next=152;break;}return _context210.abrupt("continue",153);case 152:objectClass._SetupSceneGraphConnectionsOnChangeOfLayout(data);case 153:_i68++;_context210.next=146;break;case 156:this._nextUid=rt["next_uid"];this._eventSheetManager._LoadFromJson(o["events"]);_iteratorNormalCompletion557=true;_didIteratorError557=false;_iteratorError557=undefined;_context210.prev=161;_iterator557=this._allObjectClasses[Symbol.iterator]();case 163:if(_iteratorNormalCompletion557=(_step557=_iterator557.next()).done){_context210.next=225;break;}_objectClass11=_step557.value;if(!(_objectClass11.IsFamily()||!_objectClass11.IsInContainer())){_context210.next=167;break;}return _context210.abrupt("continue",222);case 167:_iteratorNormalCompletion559=true;_didIteratorError559=false;_iteratorError559=undefined;_context210.prev=170;_iterator559=_objectClass11.GetInstances()[Symbol.iterator]();case 172:if(_iteratorNormalCompletion559=(_step559=_iterator559.next()).done){_context210.next=208;break;}_inst16=_step559.value;iid=_inst16.GetIID();_iteratorNormalCompletion560=true;_didIteratorError560=false;_iteratorError560=undefined;_context210.prev=178;_iterator560=_objectClass11.GetContainer().objectTypes()[Symbol.iterator]();case 180:if(_iteratorNormalCompletion560=(_step560=_iterator560.next()).done){_context210.next=191;break;}otherType=_step560.value;if(!(otherType===_objectClass11)){_context210.next=184;break;}return _context210.abrupt("continue",188);case 184:otherInstances=otherType.GetInstances();if(!(iid<0||iid>=otherInstances.length)){_context210.next=187;break;}throw new Error("missing sibling instance");case 187:_inst16._AddSibling(otherInstances[iid]);case 188:_iteratorNormalCompletion560=true;_context210.next=180;break;case 191:_context210.next=197;break;case 193:_context210.prev=193;_context210.t4=_context210["catch"](178);_didIteratorError560=true;_iteratorError560=_context210.t4;case 197:_context210.prev=197;_context210.prev=198;if(!_iteratorNormalCompletion560&&_iterator560["return"]!=null){_iterator560["return"]();}case 200:_context210.prev=200;if(!_didIteratorError560){_context210.next=203;break;}throw _iteratorError560;case 203:return _context210.finish(200);case 204:return _context210.finish(197);case 205:_iteratorNormalCompletion559=true;_context210.next=172;break;case 208:_context210.next=214;break;case 210:_context210.prev=210;_context210.t5=_context210["catch"](170);_didIteratorError559=true;_iteratorError559=_context210.t5;case 214:_context210.prev=214;_context210.prev=215;if(!_iteratorNormalCompletion559&&_iterator559["return"]!=null){_iterator559["return"]();}case 217:_context210.prev=217;if(!_didIteratorError559){_context210.next=220;break;}throw _iteratorError559;case 220:return _context210.finish(217);case 221:return _context210.finish(214);case 222:_iteratorNormalCompletion557=true;_context210.next=163;break;case 225:_context210.next=231;break;case 227:_context210.prev=227;_context210.t6=_context210["catch"](161);_didIteratorError557=true;_iteratorError557=_context210.t6;case 231:_context210.prev=231;_context210.prev=232;if(!_iteratorNormalCompletion557&&_iterator557["return"]!=null){_iterator557["return"]();}case 234:_context210.prev=234;if(!_didIteratorError557){_context210.next=237;break;}throw _iteratorError557;case 237:return _context210.finish(234);case 238:return _context210.finish(231);case 239:this._timelineManager._LoadFromJson(o["timelines"]);if(this._flowchartManager)this._flowchartManager._LoadFromJson(o["flowcharts"]);layoutManager.SetAllLayerProjectionChanged();layoutManager.SetAllLayerMVChanged();this._dispatcher.dispatchEvent(_C184.New(_C184.Event,"afterload"));this.DoAfterLoad();for(_i69=0,_Object$entries24=Object.entries(o["types"]);_i69<_Object$entries24.length;_i69++){_Object$entries24$_i=_slicedToArray(_Object$entries24[_i69],2),_sidStr4=_Object$entries24$_i[0],_data5=_Object$entries24$_i[1];_sid7=parseInt(_sidStr4,10);_objectClass12=this.GetObjectClassBySID(_sid7);if(_objectClass12)_objectClass12._ClearLoadInstancesJson();}loadEvent=this._CreateUserScriptEvent("load");loadEvent.saveData=o["user_script_data"];_context210.next=250;return regeneratorRuntime.awrap(this.DispatchUserScriptEventAsyncWait(loadEvent));case 250:this.UpdateRender();case 251:case"end":return _context210.stop();}}},null,this,[[13,26,30,38],[31,,33,37],[82,110,114,122],[89,93,97,105],[98,,100,104],[115,,117,121],[129,133,137,145],[138,,140,144],[161,227,231,239],[170,210,214,222],[178,193,197,205],[198,,200,204],[215,,217,221],[232,,234,238]]);}},{key:"SortOnTmpHierarchyPosition",value:function SortOnTmpHierarchyPosition(f,s){return f.GetWorldInfo().GetTmpHierarchyPosition()-s.GetWorldInfo().GetTmpHierarchyPosition();}},{key:"AddInstanceNeedingAfterLoad",value:function AddInstanceNeedingAfterLoad(inst,data){if(!inst.GetWorldInfo())return;this._instancesNeedingAfterLoadMap.set(inst,data);this._instancesNeedingAfterLoadArray.push(inst);}},{key:"ClearIntancesNeedingAfterLoad",value:function ClearIntancesNeedingAfterLoad(){this._instancesNeedingAfterLoadMap=new WeakMap();_C184.clearArray(this._instancesNeedingAfterLoadArray);}},{key:"DoAfterLoad",value:function DoAfterLoad(){var mode=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"full";var opts=arguments.length>1&&arguments[1]!==undefined?arguments[1]:null;this._instancesNeedingAfterLoadArray.sort(this.SortOnTmpHierarchyPosition);var _iteratorNormalCompletion561=true;var _didIteratorError561=false;var _iteratorError561=undefined;try{for(var _iterator561=this._instancesNeedingAfterLoadArray[Symbol.iterator](),_step561;!(_iteratorNormalCompletion561=(_step561=_iterator561.next()).done);_iteratorNormalCompletion561=true){var wi=_step561.value;wi._OnAfterLoad(this._instancesNeedingAfterLoadMap.get(wi),mode,opts);}}catch(err){_didIteratorError561=true;_iteratorError561=err;}finally{try{if(!_iteratorNormalCompletion561&&_iterator561["return"]!=null){_iterator561["return"]();}}finally{if(_didIteratorError561){throw _iteratorError561;}}}var _iteratorNormalCompletion562=true;var _didIteratorError562=false;var _iteratorError562=undefined;try{for(var _iterator562=this._instancesNeedingAfterLoadArray[Symbol.iterator](),_step562;!(_iteratorNormalCompletion562=(_step562=_iterator562.next()).done);_iteratorNormalCompletion562=true){var _wi4=_step562.value;_wi4._OnAfterLoad2(this._instancesNeedingAfterLoadMap.get(_wi4),mode,opts);}}catch(err){_didIteratorError562=true;_iteratorError562=err;}finally{try{if(!_iteratorNormalCompletion562&&_iterator562["return"]!=null){_iterator562["return"]();}}finally{if(_didIteratorError562){throw _iteratorError562;}}}this.ClearIntancesNeedingAfterLoad();}},{key:"AddJobWorkerScripts",value:function AddJobWorkerScripts(scripts){var _this167=this;var loadUrls;return regeneratorRuntime.async(function AddJobWorkerScripts$(_context212){while(1){switch(_context212.prev=_context212.next){case 0:_context212.next=2;return regeneratorRuntime.awrap(Promise.all(scripts.map(function _callee14(url){var isCrossOrigin,isCordovaFileProtocol,blob;return regeneratorRuntime.async(function _callee14$(_context211){while(1){switch(_context211.prev=_context211.next){case 0:isCrossOrigin=_C184.IsAbsoluteURL(url)&&new URL(url).origin!==location.origin;isCordovaFileProtocol=_this167.IsCordova()&&_this167._assetManager.IsFileProtocol();if(!(isCrossOrigin||isCordovaFileProtocol||_this167.IsPreview()||_this167.GetExportType()==="playable-ad")){_context211.next=9;break;}_context211.next=5;return regeneratorRuntime.awrap(_this167._assetManager.FetchBlob(url));case 5:blob=_context211.sent;return _context211.abrupt("return",URL.createObjectURL(blob));case 9:if(!_C184.IsRelativeURL(url)){_context211.next=13;break;}return _context211.abrupt("return",new URL(url,_this167._runtimeBaseUrl).toString());case 13:return _context211.abrupt("return",url);case 14:case"end":return _context211.stop();}}});})));case 2:loadUrls=_context212.sent;this._jobScheduler.ImportScriptsToJobWorkers(loadUrls);case 4:case"end":return _context212.stop();}}},null,this);}},{key:"AddJobWorkerBlob",value:function AddJobWorkerBlob(blob,id){this._jobScheduler.SendBlobToJobWorkers(blob,id);}},{key:"AddJobWorkerBuffer",value:function AddJobWorkerBuffer(buffer,id){this._jobScheduler.SendBufferToJobWorkers(buffer,id);}},{key:"AddJob",value:function AddJob(type,params,transferables,maxWorkerNum){return this._jobScheduler.AddJob(type,params,transferables,null,null,maxWorkerNum);}},{key:"BroadcastJob",value:function BroadcastJob(type,params,transferables,maxWorkerNum){return this._jobScheduler.BroadcastJob(type,params,transferables,maxWorkerNum);}},{key:"GetMaxNumJobWorkers",value:function GetMaxNumJobWorkers(){return this._jobScheduler.GetMaxNumWorkers();}},{key:"InvokeDownload",value:function InvokeDownload(url,filename){this.PostComponentMessageToDOM("runtime","invoke-download",{"url":url,"filename":filename});}},{key:"RasterSvgImage",value:function RasterSvgImage(blob,imageWidth,imageHeight,surfaceWidth,surfaceHeight,imageBitmapOpts){var result,canvas;return regeneratorRuntime.async(function RasterSvgImage$(_context213){while(1){switch(_context213.prev=_context213.next){case 0:surfaceWidth=surfaceWidth||imageWidth;surfaceHeight=surfaceHeight||imageHeight;if(!this.IsInWorker()){_context213.next=9;break;}_context213.next=5;return regeneratorRuntime.awrap(this.PostComponentMessageToDOMAsync("runtime","raster-svg-image",{"blob":blob,"imageWidth":imageWidth,"imageHeight":imageHeight,"surfaceWidth":surfaceWidth,"surfaceHeight":surfaceHeight,"imageBitmapOpts":imageBitmapOpts}));case 5:result=_context213.sent;return _context213.abrupt("return",result["imageBitmap"]);case 9:_context213.next=11;return regeneratorRuntime.awrap(self["C3_RasterSvgImageBlob"](blob,imageWidth,imageHeight,surfaceWidth,surfaceHeight));case 11:canvas=_context213.sent;if(!imageBitmapOpts){_context213.next=18;break;}_context213.next=15;return regeneratorRuntime.awrap(self.createImageBitmap(canvas,imageBitmapOpts));case 15:return _context213.abrupt("return",_context213.sent);case 18:return _context213.abrupt("return",canvas);case 19:case"end":return _context213.stop();}}},null,this);}},{key:"GetSvgImageSize",value:function GetSvgImageSize(blob){return regeneratorRuntime.async(function GetSvgImageSize$(_context214){while(1){switch(_context214.prev=_context214.next){case 0:if(!this.IsInWorker()){_context214.next=6;break;}_context214.next=3;return regeneratorRuntime.awrap(this.PostComponentMessageToDOMAsync("runtime","get-svg-image-size",{"blob":blob}));case 3:return _context214.abrupt("return",_context214.sent);case 6:_context214.next=8;return regeneratorRuntime.awrap(self["C3_GetSvgImageSize"](blob));case 8:return _context214.abrupt("return",_context214.sent);case 9:case"end":return _context214.stop();}}},null,this);}},{key:"RequestDeviceOrientationEvent",value:function RequestDeviceOrientationEvent(){if(this._didRequestDeviceOrientationEvent)return;this._didRequestDeviceOrientationEvent=true;this.PostComponentMessageToDOM("runtime","enable-device-orientation");}},{key:"RequestDeviceMotionEvent",value:function RequestDeviceMotionEvent(){if(this._didRequestDeviceMotionEvent)return;this._didRequestDeviceMotionEvent=true;this.PostComponentMessageToDOM("runtime","enable-device-motion");}},{key:"Random",value:function Random(){return this._randomNumberCallback();}},{key:"SetRandomNumberGeneratorCallback",value:function SetRandomNumberGeneratorCallback(f){this._randomNumberCallback=f;}},{key:"_GetRemotePreviewStatusInfo",value:function _GetRemotePreviewStatusInfo(){var renderer=this.GetRenderer();return{"fps":this.GetFPS(),"cpu":this.GetMainThreadTime(),"gpu":this.GetGPUUtilisation(),"layout":this.GetMainRunningLayout()?this.GetMainRunningLayout().GetName():"","renderer":renderer.IsWebGL()?renderer.GetUnmaskedRenderer():renderer.GetAdapterInfoString()};}},{key:"HitBreakpoint",value:function HitBreakpoint(){if(!this.IsDebug())return false;return _C3Debugger3.HitBreakpoint();}},{key:"DebugBreak",value:function DebugBreak(eventObject){if(!this.IsDebugging())return Promise.resolve();return _C3Debugger3.DebugBreak(eventObject);}},{key:"DebugBreakNext",value:function DebugBreakNext(){if(!this.IsDebugging())return false;return _C3Debugger3.BreakNext();}},{key:"SetDebugBreakpointsEnabled",value:function SetDebugBreakpointsEnabled(e){this._breakpointsEnabled=!!e;this._UpdateDebuggingFlag();}},{key:"AreDebugBreakpointsEnabled",value:function AreDebugBreakpointsEnabled(){return this._breakpointsEnabled;}},{key:"IsDebugging",value:function IsDebugging(){return this._isDebugging;}},{key:"SetDebuggingEnabled",value:function SetDebuggingEnabled(d){if(d)this._debuggingDisabled--;else this._debuggingDisabled++;this._UpdateDebuggingFlag();}},{key:"_UpdateDebuggingFlag",value:function _UpdateDebuggingFlag(){this._isDebugging=this.IsDebug()&&this._breakpointsEnabled&&this._debuggingDisabled===0;}},{key:"IsCPUProfiling",value:function IsCPUProfiling(){return this.IsDebug()&&_C3Debugger3.IsCPUProfiling();}},{key:"IsGPUProfiling",value:function IsGPUProfiling(){return this.IsDebug()&&this.GetRenderer().SupportsGPUProfiling()&&_C3Debugger3.IsGPUProfiling();}},{key:"DebugIterateAndBreak",value:function DebugIterateAndBreak(iter){var _iteratorNormalCompletion563,_didIteratorError563,_iteratorError563,_iterator563,_step563,breakEventObject;return regeneratorRuntime.async(function DebugIterateAndBreak$(_context215){while(1){switch(_context215.prev=_context215.next){case 0:if(iter){_context215.next=2;break;}return _context215.abrupt("return");case 2:_iteratorNormalCompletion563=true;_didIteratorError563=false;_iteratorError563=undefined;_context215.prev=5;_iterator563=iter[Symbol.iterator]();case 7:if(_iteratorNormalCompletion563=(_step563=_iterator563.next()).done){_context215.next=14;break;}breakEventObject=_step563.value;_context215.next=11;return regeneratorRuntime.awrap(this.DebugBreak(breakEventObject));case 11:_iteratorNormalCompletion563=true;_context215.next=7;break;case 14:_context215.next=20;break;case 16:_context215.prev=16;_context215.t0=_context215["catch"](5);_didIteratorError563=true;_iteratorError563=_context215.t0;case 20:_context215.prev=20;_context215.prev=21;if(!_iteratorNormalCompletion563&&_iterator563["return"]!=null){_iterator563["return"]();}case 23:_context215.prev=23;if(!_didIteratorError563){_context215.next=26;break;}throw _iteratorError563;case 26:return _context215.finish(23);case 27:return _context215.finish(20);case 28:case"end":return _context215.stop();}}},null,this,[[5,16,20,28],[21,,23,27]]);}},{key:"DebugFireGeneratorEventAndBreak",value:function DebugFireGeneratorEventAndBreak(event){return this.DebugIterateAndBreak(this._dispatcher.dispatchGeneratorEvent(event));}},{key:"_InvokeFunctionFromJS",value:function _InvokeFunctionFromJS(e){return this._eventSheetManager._InvokeFunctionFromJS(e["name"],e["params"]);}},{key:"GetIRuntime",value:function GetIRuntime(){return this._iRuntime;}},{key:"_CreateUserScriptEvent",value:function _CreateUserScriptEvent(name){var e=_C184.New(_C184.Event,name,false);e.runtime=this._iRuntime;return e;}},{key:"_InitScriptInterfaces",value:function _InitScriptInterfaces(){var objectDescriptors={};var _iteratorNormalCompletion564=true;var _didIteratorError564=false;var _iteratorError564=undefined;try{for(var _iterator564=this._allObjectClasses[Symbol.iterator](),_step564;!(_iteratorNormalCompletion564=(_step564=_iterator564.next()).done);_iteratorNormalCompletion564=true){var objectClass=_step564.value;objectDescriptors[objectClass.GetJsPropName()]={value:objectClass.GetIObjectClass(),enumerable:true,writable:false};}}catch(err){_didIteratorError564=true;_iteratorError564=err;}finally{try{if(!_iteratorNormalCompletion564&&_iterator564["return"]!=null){_iterator564["return"]();}}finally{if(_didIteratorError564){throw _iteratorError564;}}}var objects=Object.create(Object.prototype,objectDescriptors);this._iRuntime=new self.IRuntime(this,objects);this._userScriptEventObjects={"tick":this._CreateUserScriptEvent("tick")};}},{key:"_InitGlobalVariableScriptInterface",value:function _InitGlobalVariableScriptInterface(){var globalVarDescriptors={};var _iteratorNormalCompletion565=true;var _didIteratorError565=false;var _iteratorError565=undefined;try{for(var _iterator565=this.GetEventSheetManager().GetAllGlobalVariables()[Symbol.iterator](),_step565;!(_iteratorNormalCompletion565=(_step565=_iterator565.next()).done);_iteratorNormalCompletion565=true){var globalVar=_step565.value;globalVarDescriptors[globalVar.GetJsPropName()]=globalVar._GetScriptInterfaceDescriptor();}}catch(err){_didIteratorError565=true;_iteratorError565=err;}finally{try{if(!_iteratorNormalCompletion565&&_iterator565["return"]!=null){_iterator565["return"]();}}finally{if(_didIteratorError565){throw _iteratorError565;}}}this._iRuntime._InitGlobalVars(globalVarDescriptors);}},{key:"_GetCommonScriptInterfaces",value:function _GetCommonScriptInterfaces(){return this._commonScriptInterfaces;}},{key:"_MapScriptInterface",value:function _MapScriptInterface(interface_,class_){this._interfaceMap.set(interface_,class_);}},{key:"_UnwrapScriptInterface",value:function _UnwrapScriptInterface(interface_){return this._interfaceMap.get(interface_);}},{key:"_UnwrapIObjectClass",value:function _UnwrapIObjectClass(iObjectClass){if(!(iObjectClass instanceof self.IObjectClass))throw new TypeError("expected IObjectClass");var objectClass=this._UnwrapScriptInterface(iObjectClass);if(!objectClass||!(objectClass instanceof _C184.ObjectClass))throw new Error("invalid IObjectClass");return objectClass;}},{key:"_UnwrapIWorldInstance",value:function _UnwrapIWorldInstance(iinst){if(!(iinst instanceof self.IWorldInstance))throw new TypeError("expected IWorldInstance");var inst=this._UnwrapScriptInterface(iinst);if(!inst||!(inst instanceof _C184.Instance))throw new Error("invalid IInstance");return inst;}}],[{key:"Create",value:function Create(opts){return _C184.New(_C184.Runtime,opts);}}]);return C3Runtime;}(_C184.DefendedBase);self["C3_CreateRuntime"]=_C184.Runtime.Create;self["C3_InitRuntime"]=function(runtime,opts){return runtime.Init(opts);};}// workers/jobSchedulerRuntime.js
{'use strict';var _C185=self.C3;_C185.JobSchedulerRuntime=/*#__PURE__*/function(_C185$DefendedBase){_inherits(JobSchedulerRuntime,_C185$DefendedBase);function JobSchedulerRuntime(runtime,data){var _this168;_classCallCheck(this,JobSchedulerRuntime);_this168=_possibleConstructorReturn(this,_getPrototypeOf(JobSchedulerRuntime).call(this));_this168._runtime=runtime;_this168._jobPromises=new Map();_this168._nextJobId=0;_this168._inputPort=data["inputPort"];data["outputPort"].onmessage=function(e){return _this168._OnJobWorkerMessage(e);};_this168._maxNumWorkers=data["maxNumWorkers"];_this168._jobWorkerCount=1;_this168._isCreatingWorker=false;_this168._hadErrorCreatingWorker=false;return _this168;}_createClass(JobSchedulerRuntime,[{key:"Init",value:function Init(){return regeneratorRuntime.async(function Init$(_context216){while(1){switch(_context216.prev=_context216.next){case 0:case"end":return _context216.stop();}}});}},{key:"GetMaxNumWorkers",value:function GetMaxNumWorkers(){return this._maxNumWorkers;}},{key:"ImportScriptsToJobWorkers",value:function ImportScriptsToJobWorkers(scripts){this._inputPort.postMessage({"type":"_import_scripts","scripts":scripts});}},{key:"SendBlobToJobWorkers",value:function SendBlobToJobWorkers(blob,id){this._inputPort.postMessage({"type":"_send_blob","blob":blob,"id":id});}},{key:"SendBufferToJobWorkers",value:function SendBufferToJobWorkers(buffer,id){this._inputPort.postMessage({"type":"_send_buffer","buffer":buffer,"id":id},[buffer]);}},{key:"AddJob",value:function AddJob(type,params,transferables,progressHandler,abortDisposable,maxWorkerNum){var _this169=this;if(!transferables)transferables=[];if(typeof maxWorkerNum==="number"){maxWorkerNum=Math.floor(maxWorkerNum);if(maxWorkerNum<=0)throw new Error("invalid maxWorkerNum");}var jobId=this._nextJobId++;var job={"type":type,"isBroadcast":false,"maxWorkerNum":maxWorkerNum,"jobId":jobId,"params":params,"transferables":transferables};var promise=new Promise(function(resolve,reject){_this169._jobPromises.set(jobId,{resolve:resolve,progress:progressHandler,reject:reject,cancelled:false,maxWorkerNum:maxWorkerNum});});if(abortDisposable)abortDisposable.SetAction(function(){return _this169._CancelJob(jobId);});this._inputPort.postMessage(job,transferables);this._MaybeCreateExtraWorker();return promise;}},{key:"BroadcastJob",value:function BroadcastJob(type,params,transferables,maxWorkerNum){if(!transferables)transferables=[];if(typeof maxWorkerNum==="number"){maxWorkerNum=Math.floor(maxWorkerNum);if(maxWorkerNum<=0)throw new Error("invalid maxWorkerNum");}var jobId=this._nextJobId++;var job={"type":type,"isBroadcast":true,"maxWorkerNum":maxWorkerNum,"jobId":jobId,"params":params,"transferables":transferables};this._inputPort.postMessage(job,transferables);}},{key:"_CancelJob",value:function _CancelJob(jobId){var job=this._jobPromises.get(jobId);if(job){job.cancelled=true;job.resolve=null;job.progress=null;job.reject=null;this._inputPort.postMessage({"type":"_cancel","jobId":jobId});}}},{key:"_OnJobWorkerMessage",value:function _OnJobWorkerMessage(e){var msg=e.data;var type=msg["type"];var id=msg["jobId"];switch(type){case"result":this._OnJobResult(id,msg["result"]);break;case"progress":this._OnJobProgress(id,msg["progress"]);break;case"error":this._OnJobError(id,msg["error"]);break;case"ready":this._OnJobWorkerReady();break;default:throw new Error("unknown message from worker '".concat(type,"'"));}}},{key:"_OnJobResult",value:function _OnJobResult(jobId,result){var p=this._jobPromises.get(jobId);if(!p)throw new Error("invalid job ID");if(!p.cancelled)p.resolve(result);this._jobPromises["delete"](jobId);}},{key:"_OnJobProgress",value:function _OnJobProgress(jobId,progress){var p=this._jobPromises.get(jobId);if(!p)throw new Error("invalid job ID");if(!p.cancelled&&p.progress)p.progress(progress);}},{key:"_OnJobError",value:function _OnJobError(jobId,error){var p=this._jobPromises.get(jobId);if(!p)throw new Error("invalid job ID");if(!p.cancelled)p.reject(error);this._jobPromises["delete"](jobId);}},{key:"_OnJobWorkerReady",value:function _OnJobWorkerReady(){if(!this._isCreatingWorker)return;this._isCreatingWorker=false;this._jobWorkerCount++;if(this._jobWorkerCount<this._maxNumWorkers)this._MaybeCreateExtraWorker();else this._inputPort.postMessage({"type":"_no_more_workers"});}},{key:"_GetWorkerCountNeededForPendingJobs",value:function _GetWorkerCountNeededForPendingJobs(){var needWorkerCount=0;var sortedJobList=_toConsumableArray(this._jobPromises.values()).sort(function(a,b){var an=a.maxWorkerNum||Infinity;var bn=b.maxWorkerNum||Infinity;return an-bn;});var _iteratorNormalCompletion566=true;var _didIteratorError566=false;var _iteratorError566=undefined;try{for(var _iterator566=sortedJobList[Symbol.iterator](),_step566;!(_iteratorNormalCompletion566=(_step566=_iterator566.next()).done);_iteratorNormalCompletion566=true){var job=_step566.value;var maxWorkerNum=job.maxWorkerNum||Infinity;if(needWorkerCount<maxWorkerNum)needWorkerCount++;}}catch(err){_didIteratorError566=true;_iteratorError566=err;}finally{try{if(!_iteratorNormalCompletion566&&_iterator566["return"]!=null){_iterator566["return"]();}}finally{if(_didIteratorError566){throw _iteratorError566;}}}return needWorkerCount;}},{key:"_MaybeCreateExtraWorker",value:function _MaybeCreateExtraWorker(){var _this170=this;var result;return regeneratorRuntime.async(function _MaybeCreateExtraWorker$(_context217){while(1){switch(_context217.prev=_context217.next){case 0:if(!(this._jobWorkerCount>=this._maxNumWorkers||this._isCreatingWorker||this._hadErrorCreatingWorker||this._GetWorkerCountNeededForPendingJobs()<=this._jobWorkerCount)){_context217.next=2;break;}return _context217.abrupt("return");case 2:_context217.prev=2;this._isCreatingWorker=true;_context217.next=6;return regeneratorRuntime.awrap(this._runtime.PostComponentMessageToDOMAsync("runtime","create-job-worker"));case 6:result=_context217.sent;result["outputPort"].onmessage=function(e){return _this170._OnJobWorkerMessage(e);};_context217.next=15;break;case 10:_context217.prev=10;_context217.t0=_context217["catch"](2);this._hadErrorCreatingWorker=true;this._isCreatingWorker=false;console.error("[Construct] Failed to create job worker; stopping creating any more (created ".concat(this._jobWorkerCount," so far)"),_context217.t0);case 15:case"end":return _context217.stop();}}},null,this,[[2,10]]);}}]);return JobSchedulerRuntime;}(_C185.DefendedBase);}{self["C3_Shaders"]={};}{'use strict';{var ForEachOrdered_SortInstances=function ForEachOrdered_SortInstances(a,b){var va=a[1];var vb=b[1];if(typeof va==="number"&&typeof vb==="number")return va-vb;else{var sa=""+va;var sb=""+vb;if(sa<sb)return-1;else if(sa>sb)return 1;else return 0;}};var _C186=self.C3;var cacheRegex=null;var lastRegex="";var lastFlags="";var regexMatches=[];var lastMatchesStr="";var lastMatchesRegex="";var lastMatchesFlags="";var forEachStack=_C186.New(_C186.ArrayStack);_C186.Plugins.System=/*#__PURE__*/function(_C186$SDKPluginBase){_inherits(SystemPlugin,_C186$SDKPluginBase);function SystemPlugin(opts){var _this171;_classCallCheck(this,SystemPlugin);_this171=_possibleConstructorReturn(this,_getPrototypeOf(SystemPlugin).call(this,opts));_this171._loopStack=_this171._runtime.GetEventSheetManager().GetLoopStack();_this171._eventStack=_this171._runtime.GetEventSheetManager().GetEventStack();_this171._imagesLoadingTotal=0;_this171._imagesLoadingComplete=0;_this171._functionMaps=new Map();_this171._signalTags=[];return _this171;}_createClass(SystemPlugin,[{key:"Release",value:function Release(){_get(_getPrototypeOf(SystemPlugin.prototype),"Release",this).call(this);}},{key:"UpdateRender",value:function UpdateRender(){this._runtime.UpdateRender();}},{key:"Trigger",value:function Trigger(method){this._runtime.Trigger(method,null,null);}},{key:"GetRegex",value:function GetRegex(regex,flags){if(!cacheRegex||regex!==lastRegex||flags!==lastFlags){cacheRegex=new RegExp(regex,flags);lastRegex=regex;lastFlags=flags;}cacheRegex.lastIndex=0;return cacheRegex;}},{key:"GetRegexMatches",value:function GetRegexMatches(str,regex,flags){if(str===lastMatchesStr&&regex===lastMatchesRegex&&flags===lastMatchesFlags)return regexMatches;var cacheRegex=this.GetRegex(regex,flags);regexMatches=str.match(cacheRegex);lastMatchesStr=str;lastMatchesRegex=regex;lastMatchesFlags=flags;return regexMatches;}},{key:"_LoadTexturesForObjectClasses",value:function _LoadTexturesForObjectClasses(layout,objectClasses){var _this172=this;var promises,_iteratorNormalCompletion567,_didIteratorError567,_iteratorError567,_iterator567,_step567,oc;return regeneratorRuntime.async(function _LoadTexturesForObjectClasses$(_context218){while(1){switch(_context218.prev=_context218.next){case 0:if(objectClasses.length){_context218.next=2;break;}return _context218.abrupt("return");case 2:this._imagesLoadingTotal+=objectClasses.length;promises=[];_iteratorNormalCompletion567=true;_didIteratorError567=false;_iteratorError567=undefined;_context218.prev=7;for(_iterator567=objectClasses[Symbol.iterator]();!(_iteratorNormalCompletion567=(_step567=_iterator567.next()).done);_iteratorNormalCompletion567=true){oc=_step567.value;promises.push(layout.MaybeLoadTexturesFor(oc));}_context218.next=15;break;case 11:_context218.prev=11;_context218.t0=_context218["catch"](7);_didIteratorError567=true;_iteratorError567=_context218.t0;case 15:_context218.prev=15;_context218.prev=16;if(!_iteratorNormalCompletion567&&_iterator567["return"]!=null){_iterator567["return"]();}case 18:_context218.prev=18;if(!_didIteratorError567){_context218.next=21;break;}throw _iteratorError567;case 21:return _context218.finish(18);case 22:return _context218.finish(15);case 23:_context218.next=25;return regeneratorRuntime.awrap(_C186.PromiseAllWithProgress(promises,function(){_this172._imagesLoadingComplete++;}));case 25:this._imagesLoadingComplete++;if(this._imagesLoadingComplete===this._imagesLoadingTotal){this._imagesLoadingComplete=0;this._imagesLoadingTotal=0;this._runtime.Trigger(_C186.Plugins.System.Cnds.OnImageLoadingComplete,null,null);}case 27:case"end":return _context218.stop();}}},null,this,[[7,11,15,23],[16,,18,22]]);}},{key:"_UnloadTexturesForObjectClasses",value:function _UnloadTexturesForObjectClasses(layout,objectClasses){var _iteratorNormalCompletion568=true;var _didIteratorError568=false;var _iteratorError568=undefined;try{for(var _iterator568=objectClasses[Symbol.iterator](),_step568;!(_iteratorNormalCompletion568=(_step568=_iterator568.next()).done);_iteratorNormalCompletion568=true){var oc=_step568.value;if(oc.GetInstanceCount()===0)layout.MaybeUnloadTexturesFor(oc);}}catch(err){_didIteratorError568=true;_iteratorError568=err;}finally{try{if(!_iteratorNormalCompletion568&&_iterator568["return"]!=null){_iterator568["return"]();}}finally{if(_didIteratorError568){throw _iteratorError568;}}}}},{key:"_GetForEachStack",value:function _GetForEachStack(){return forEachStack;}},{key:"_Repeat",value:function _Repeat(count){var eventSheetManager=this._runtime.GetEventSheetManager();var eventStack=eventSheetManager.GetEventStack();var oldFrame=eventStack.GetCurrentStackFrame();var currentEvent=oldFrame.GetCurrentEvent();var solModifiers=currentEvent.GetSolModifiers();var isSolModifierAfterCnds=oldFrame.IsSolModifierAfterCnds();var newFrame=eventStack.Push(currentEvent);var loopStack=eventSheetManager.GetLoopStack();var loop=loopStack.Push();loop.SetEnd(count);if(isSolModifierAfterCnds)for(var i=0;i<count&&!loop.IsStopped();++i){eventSheetManager.PushCopySol(solModifiers);loop.SetIndex(i);currentEvent.Retrigger(oldFrame,newFrame);eventSheetManager.PopSol(solModifiers);}else for(var _i70=0;_i70<count&&!loop.IsStopped();++_i70){loop.SetIndex(_i70);currentEvent.Retrigger(oldFrame,newFrame);}eventStack.Pop();loopStack.Pop();return false;}},{key:"_DebugRepeat",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugRepeat(count){var eventSheetManager,eventStack,oldFrame,currentEvent,solModifiers,isSolModifierAfterCnds,newFrame,loopStack,loop,i,_i71;return regeneratorRuntime.wrap(function _DebugRepeat$(_context219){while(1){switch(_context219.prev=_context219.next){case 0:eventSheetManager=this._runtime.GetEventSheetManager();eventStack=eventSheetManager.GetEventStack();oldFrame=eventStack.GetCurrentStackFrame();currentEvent=oldFrame.GetCurrentEvent();solModifiers=currentEvent.GetSolModifiers();isSolModifierAfterCnds=oldFrame.IsSolModifierAfterCnds();newFrame=eventStack.Push(currentEvent);loopStack=eventSheetManager.GetLoopStack();loop=loopStack.Push();loop.SetEnd(count);if(!isSolModifierAfterCnds){_context219.next=22;break;}i=0;case 12:if(!(i<count&&!loop.IsStopped())){_context219.next=20;break;}eventSheetManager.PushCopySol(solModifiers);loop.SetIndex(i);return _context219.delegateYield(currentEvent.DebugRetrigger(oldFrame,newFrame),"t0",16);case 16:eventSheetManager.PopSol(solModifiers);case 17:++i;_context219.next=12;break;case 20:_context219.next=29;break;case 22:_i71=0;case 23:if(!(_i71<count&&!loop.IsStopped())){_context219.next=29;break;}loop.SetIndex(_i71);return _context219.delegateYield(currentEvent.DebugRetrigger(oldFrame,newFrame),"t1",26);case 26:++_i71;_context219.next=23;break;case 29:eventStack.Pop();loopStack.Pop();return _context219.abrupt("return",false);case 32:case"end":return _context219.stop();}}},_DebugRepeat,this);})},{key:"_While",value:function _While(){var eventSheetManager=this._runtime.GetEventSheetManager();var eventStack=eventSheetManager.GetEventStack();var oldFrame=eventStack.GetCurrentStackFrame();var currentEvent=oldFrame.GetCurrentEvent();var solModifiers=currentEvent.GetSolModifiers();var isSolModifierAfterCnds=oldFrame.IsSolModifierAfterCnds();var newFrame=eventStack.Push(currentEvent);var loopStack=eventSheetManager.GetLoopStack();var loop=loopStack.Push();if(isSolModifierAfterCnds)for(var i=0;!loop.IsStopped();++i){eventSheetManager.PushCopySol(solModifiers);loop.SetIndex(i);if(!currentEvent.Retrigger(oldFrame,newFrame))loop.Stop();eventSheetManager.PopSol(solModifiers);}else for(var _i72=0;!loop.IsStopped();++_i72){loop.SetIndex(_i72);if(!currentEvent.Retrigger(oldFrame,newFrame))loop.Stop();}eventStack.Pop();loopStack.Pop();return false;}},{key:"_DebugWhile",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugWhile(){var eventSheetManager,eventStack,oldFrame,currentEvent,solModifiers,isSolModifierAfterCnds,newFrame,loopStack,loop,i,ret,_i73,_ret9;return regeneratorRuntime.wrap(function _DebugWhile$(_context220){while(1){switch(_context220.prev=_context220.next){case 0:eventSheetManager=this._runtime.GetEventSheetManager();eventStack=eventSheetManager.GetEventStack();oldFrame=eventStack.GetCurrentStackFrame();currentEvent=oldFrame.GetCurrentEvent();solModifiers=currentEvent.GetSolModifiers();isSolModifierAfterCnds=oldFrame.IsSolModifierAfterCnds();newFrame=eventStack.Push(currentEvent);loopStack=eventSheetManager.GetLoopStack();loop=loopStack.Push();if(!isSolModifierAfterCnds){_context220.next=23;break;}i=0;case 11:if(loop.IsStopped()){_context220.next=21;break;}eventSheetManager.PushCopySol(solModifiers);loop.SetIndex(i);return _context220.delegateYield(currentEvent.DebugRetrigger(oldFrame,newFrame),"t0",15);case 15:ret=_context220.t0;if(!ret)loop.Stop();eventSheetManager.PopSol(solModifiers);case 18:++i;_context220.next=11;break;case 21:_context220.next=32;break;case 23:_i73=0;case 24:if(loop.IsStopped()){_context220.next=32;break;}loop.SetIndex(_i73);return _context220.delegateYield(currentEvent.DebugRetrigger(oldFrame,newFrame),"t1",27);case 27:_ret9=_context220.t1;if(!_ret9)loop.Stop();case 29:++_i73;_context220.next=24;break;case 32:eventStack.Pop();loopStack.Pop();return _context220.abrupt("return",false);case 35:case"end":return _context220.stop();}}},_DebugWhile,this);})},{key:"_For",value:function _For(name,start,end){var eventSheetManager=this._runtime.GetEventSheetManager();var eventStack=eventSheetManager.GetEventStack();var oldFrame=eventStack.GetCurrentStackFrame();var currentEvent=oldFrame.GetCurrentEvent();var solModifiers=currentEvent.GetSolModifiers();var isSolModifierAfterCnds=oldFrame.IsSolModifierAfterCnds();var newFrame=eventStack.Push(currentEvent);var loopStack=eventSheetManager.GetLoopStack();var loop=loopStack.Push();loop.SetName(name);loop.SetEnd(end);if(end<start){if(isSolModifierAfterCnds)for(var i=start;i>=end&&!loop.IsStopped();--i){eventSheetManager.PushCopySol(solModifiers);loop.SetIndex(i);currentEvent.Retrigger(oldFrame,newFrame);eventSheetManager.PopSol(solModifiers);}else for(var _i74=start;_i74>=end&&!loop.IsStopped();--_i74){loop.SetIndex(_i74);currentEvent.Retrigger(oldFrame,newFrame);}}else if(isSolModifierAfterCnds)for(var _i75=start;_i75<=end&&!loop.IsStopped();++_i75){eventSheetManager.PushCopySol(solModifiers);loop.SetIndex(_i75);currentEvent.Retrigger(oldFrame,newFrame);eventSheetManager.PopSol(solModifiers);}else for(var _i76=start;_i76<=end&&!loop.IsStopped();++_i76){loop.SetIndex(_i76);currentEvent.Retrigger(oldFrame,newFrame);}eventStack.Pop();loopStack.Pop();return false;}},{key:"_DebugFor",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugFor(name,start,end){var eventSheetManager,eventStack,oldFrame,currentEvent,solModifiers,isSolModifierAfterCnds,newFrame,loopStack,loop,i,_i77,_i78,_i79;return regeneratorRuntime.wrap(function _DebugFor$(_context221){while(1){switch(_context221.prev=_context221.next){case 0:eventSheetManager=this._runtime.GetEventSheetManager();eventStack=eventSheetManager.GetEventStack();oldFrame=eventStack.GetCurrentStackFrame();currentEvent=oldFrame.GetCurrentEvent();solModifiers=currentEvent.GetSolModifiers();isSolModifierAfterCnds=oldFrame.IsSolModifierAfterCnds();newFrame=eventStack.Push(currentEvent);loopStack=eventSheetManager.GetLoopStack();loop=loopStack.Push();loop.SetName(name);loop.SetEnd(end);if(!(end<start)){_context221.next=33;break;}if(!isSolModifierAfterCnds){_context221.next=24;break;}i=start;case 14:if(!(i>=end&&!loop.IsStopped())){_context221.next=22;break;}eventSheetManager.PushCopySol(solModifiers);loop.SetIndex(i);return _context221.delegateYield(currentEvent.DebugRetrigger(oldFrame,newFrame),"t0",18);case 18:eventSheetManager.PopSol(solModifiers);case 19:--i;_context221.next=14;break;case 22:_context221.next=31;break;case 24:_i77=start;case 25:if(!(_i77>=end&&!loop.IsStopped())){_context221.next=31;break;}loop.SetIndex(_i77);return _context221.delegateYield(currentEvent.DebugRetrigger(oldFrame,newFrame),"t1",28);case 28:--_i77;_context221.next=25;break;case 31:_context221.next=52;break;case 33:if(!isSolModifierAfterCnds){_context221.next=45;break;}_i78=start;case 35:if(!(_i78<=end&&!loop.IsStopped())){_context221.next=43;break;}eventSheetManager.PushCopySol(solModifiers);loop.SetIndex(_i78);return _context221.delegateYield(currentEvent.DebugRetrigger(oldFrame,newFrame),"t2",39);case 39:eventSheetManager.PopSol(solModifiers);case 40:++_i78;_context221.next=35;break;case 43:_context221.next=52;break;case 45:_i79=start;case 46:if(!(_i79<=end&&!loop.IsStopped())){_context221.next=52;break;}loop.SetIndex(_i79);return _context221.delegateYield(currentEvent.DebugRetrigger(oldFrame,newFrame),"t3",49);case 49:++_i79;_context221.next=46;break;case 52:eventStack.Pop();loopStack.Pop();return _context221.abrupt("return",false);case 55:case"end":return _context221.stop();}}},_DebugFor,this);})},{key:"_ForEach",value:function _ForEach(objectClass){var sol=objectClass.GetCurrentSol();var iterInstances=sol.GetInstances();if(iterInstances.length===0)return false;var eventSheetManager=this._runtime.GetEventSheetManager();var eventStack=eventSheetManager.GetEventStack();var oldFrame=eventStack.GetCurrentStackFrame();var currentEvent=oldFrame.GetCurrentEvent();var solModifiers=currentEvent.GetSolModifiers();var isSolModifierAfterCnds=oldFrame.IsSolModifierAfterCnds();var newFrame=eventStack.Push(currentEvent);var loopStack=eventSheetManager.GetLoopStack();var loop=loopStack.Push();var isInContainer=objectClass.IsInContainer();var instances=forEachStack.Push();_C186.shallowAssignArray(instances,iterInstances);loop.SetEnd(instances.length);if(isSolModifierAfterCnds)for(var i=0,len=instances.length;i<len&&!loop.IsStopped();++i){eventSheetManager.PushCopySol(solModifiers);var inst=instances[i];objectClass.GetCurrentSol().SetSinglePicked(inst);if(isInContainer)inst.SetSiblingsSinglePicked();loop.SetIndex(i);currentEvent.Retrigger(oldFrame,newFrame);eventSheetManager.PopSol(solModifiers);}else{sol._SetSelectAll(false);var solInstances=sol._GetOwnInstances();_C186.clearArray(solInstances);solInstances.push(null);for(var _i80=0,_len56=instances.length;_i80<_len56&&!loop.IsStopped();++_i80){var _inst17=instances[_i80];solInstances[0]=_inst17;if(isInContainer)_inst17.SetSiblingsSinglePicked();loop.SetIndex(_i80);currentEvent.Retrigger(oldFrame,newFrame);}}eventStack.Pop();loopStack.Pop();_C186.clearArray(instances);forEachStack.Pop();return false;}},{key:"_DebugForEach",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugForEach(objectClass){var sol,iterInstances,eventSheetManager,eventStack,oldFrame,currentEvent,solModifiers,isSolModifierAfterCnds,newFrame,loopStack,loop,isInContainer,instances,i,len,inst,solInstances,_i81,_len57,_inst18;return regeneratorRuntime.wrap(function _DebugForEach$(_context222){while(1){switch(_context222.prev=_context222.next){case 0:sol=objectClass.GetCurrentSol();iterInstances=sol.GetInstances();if(!(iterInstances.length===0)){_context222.next=4;break;}return _context222.abrupt("return",false);case 4:eventSheetManager=this._runtime.GetEventSheetManager();eventStack=eventSheetManager.GetEventStack();oldFrame=eventStack.GetCurrentStackFrame();currentEvent=oldFrame.GetCurrentEvent();solModifiers=currentEvent.GetSolModifiers();isSolModifierAfterCnds=oldFrame.IsSolModifierAfterCnds();newFrame=eventStack.Push(currentEvent);loopStack=eventSheetManager.GetLoopStack();loop=loopStack.Push();isInContainer=objectClass.IsInContainer();instances=forEachStack.Push();_C186.shallowAssignArray(instances,iterInstances);loop.SetEnd(instances.length);if(!isSolModifierAfterCnds){_context222.next=32;break;}i=0,len=instances.length;case 19:if(!(i<len&&!loop.IsStopped())){_context222.next=30;break;}eventSheetManager.PushCopySol(solModifiers);inst=instances[i];objectClass.GetCurrentSol().SetSinglePicked(inst);if(isInContainer)inst.SetSiblingsSinglePicked();loop.SetIndex(i);return _context222.delegateYield(currentEvent.DebugRetrigger(oldFrame,newFrame),"t0",26);case 26:eventSheetManager.PopSol(solModifiers);case 27:++i;_context222.next=19;break;case 30:_context222.next=46;break;case 32:sol._SetSelectAll(false);solInstances=sol._GetOwnInstances();_C186.clearArray(solInstances);solInstances.push(null);_i81=0,_len57=instances.length;case 37:if(!(_i81<_len57&&!loop.IsStopped())){_context222.next=46;break;}_inst18=instances[_i81];solInstances[0]=_inst18;if(isInContainer)_inst18.SetSiblingsSinglePicked();loop.SetIndex(_i81);return _context222.delegateYield(currentEvent.DebugRetrigger(oldFrame,newFrame),"t1",43);case 43:++_i81;_context222.next=37;break;case 46:eventStack.Pop();loopStack.Pop();_C186.clearArray(instances);forEachStack.Pop();return _context222.abrupt("return",false);case 51:case"end":return _context222.stop();}}},_DebugForEach,this);})},{key:"_ForEachOrdered",value:function _ForEachOrdered(objectClass,order){var sol=objectClass.GetCurrentSol();var iterInstances=sol.GetInstances();if(iterInstances.length===0)return false;var eventSheetManager=this._runtime.GetEventSheetManager();var eventStack=eventSheetManager.GetEventStack();var cnd=eventSheetManager.GetCurrentCondition();var oldFrame=eventStack.GetCurrentStackFrame();var currentEvent=oldFrame.GetCurrentEvent();var solModifiers=currentEvent.GetSolModifiers();var isSolModifierAfterCnds=oldFrame.IsSolModifierAfterCnds();var newFrame=eventStack.Push(currentEvent);var loopStack=eventSheetManager.GetLoopStack();var loop=loopStack.Push();var isInContainer=objectClass.IsInContainer();var instancesData=forEachStack.Push();_C186.clearArray(instancesData);loop.SetEnd(iterInstances.length);for(var i=0,len=iterInstances.length;i<len;++i){instancesData.push([iterInstances[i],cnd.ReevaluateParameter(1,i)]);}instancesData.sort(ForEachOrdered_SortInstances);if(order===1)instancesData.reverse();if(isSolModifierAfterCnds)for(var _i82=0,_len58=instancesData.length;_i82<_len58&&!loop.IsStopped();++_i82){eventSheetManager.PushCopySol(solModifiers);var inst=instancesData[_i82][0];objectClass.GetCurrentSol().SetSinglePicked(inst);if(isInContainer)inst.SetSiblingsSinglePicked();loop.SetIndex(_i82);currentEvent.Retrigger(oldFrame,newFrame);eventSheetManager.PopSol(solModifiers);}else{sol._SetSelectAll(false);var solInstances=sol._GetOwnInstances();_C186.clearArray(solInstances);solInstances.push(null);for(var _i83=0,_len59=instancesData.length;_i83<_len59&&!loop.IsStopped();++_i83){var _inst19=instancesData[_i83][0];solInstances[0]=_inst19;if(isInContainer)_inst19.SetSiblingsSinglePicked();loop.SetIndex(_i83);currentEvent.Retrigger(oldFrame,newFrame);}}eventStack.Pop();loopStack.Pop();_C186.clearArray(instancesData);forEachStack.Pop();return false;}},{key:"_DebugForEachOrdered",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugForEachOrdered(objectClass,order){var sol,iterInstances,eventSheetManager,eventStack,cnd,oldFrame,currentEvent,solModifiers,isSolModifierAfterCnds,newFrame,loopStack,loop,isInContainer,instancesData,i,len,_i84,_len60,inst,solInstances,_i85,_len61,_inst20;return regeneratorRuntime.wrap(function _DebugForEachOrdered$(_context223){while(1){switch(_context223.prev=_context223.next){case 0:sol=objectClass.GetCurrentSol();iterInstances=sol.GetInstances();if(!(iterInstances.length===0)){_context223.next=4;break;}return _context223.abrupt("return",false);case 4:eventSheetManager=this._runtime.GetEventSheetManager();eventStack=eventSheetManager.GetEventStack();cnd=eventSheetManager.GetCurrentCondition();oldFrame=eventStack.GetCurrentStackFrame();currentEvent=oldFrame.GetCurrentEvent();solModifiers=currentEvent.GetSolModifiers();isSolModifierAfterCnds=oldFrame.IsSolModifierAfterCnds();newFrame=eventStack.Push(currentEvent);loopStack=eventSheetManager.GetLoopStack();loop=loopStack.Push();isInContainer=objectClass.IsInContainer();instancesData=forEachStack.Push();_C186.clearArray(instancesData);loop.SetEnd(iterInstances.length);for(i=0,len=iterInstances.length;i<len;++i){instancesData.push([iterInstances[i],cnd.ReevaluateParameter(1,i)]);}instancesData.sort(ForEachOrdered_SortInstances);if(order===1)instancesData.reverse();if(!isSolModifierAfterCnds){_context223.next=36;break;}_i84=0,_len60=instancesData.length;case 23:if(!(_i84<_len60&&!loop.IsStopped())){_context223.next=34;break;}eventSheetManager.PushCopySol(solModifiers);inst=instancesData[_i84][0];objectClass.GetCurrentSol().SetSinglePicked(inst);if(isInContainer)inst.SetSiblingsSinglePicked();loop.SetIndex(_i84);return _context223.delegateYield(currentEvent.DebugRetrigger(oldFrame,newFrame),"t0",30);case 30:eventSheetManager.PopSol(solModifiers);case 31:++_i84;_context223.next=23;break;case 34:_context223.next=50;break;case 36:sol._SetSelectAll(false);solInstances=sol._GetOwnInstances();_C186.clearArray(solInstances);solInstances.push(null);_i85=0,_len61=instancesData.length;case 41:if(!(_i85<_len61&&!loop.IsStopped())){_context223.next=50;break;}_inst20=instancesData[_i85][0];solInstances[0]=_inst20;if(isInContainer)_inst20.SetSiblingsSinglePicked();loop.SetIndex(_i85);return _context223.delegateYield(currentEvent.DebugRetrigger(oldFrame,newFrame),"t1",47);case 47:++_i85;_context223.next=41;break;case 50:eventStack.Pop();loopStack.Pop();_C186.clearArray(instancesData);forEachStack.Pop();return _context223.abrupt("return",false);case 55:case"end":return _context223.stop();}}},_DebugForEachOrdered,this);})},{key:"_GetFunctionMap",value:function _GetFunctionMap(name,createIfMissing){var ret=this._functionMaps.get(name);if(ret)return ret;if(!createIfMissing)return null;ret={defaultFunc:null,strMap:new Map()};this._functionMaps.set(name,ret);return ret;}},{key:"_DoCallMappedFunction",value:function _DoCallMappedFunction(eventSheetManager,functionBlock,paramResults,hasAnySolModifiers,solModifiers){functionBlock.GetEventBlock().RunAsMappedFunctionCall(paramResults,functionBlock.IsCopyPicked());if(hasAnySolModifiers)eventSheetManager.PopSol(solModifiers);}},{key:"_DebugDoCallMappedFunction",value:/*#__PURE__*/regeneratorRuntime.mark(function _DebugDoCallMappedFunction(eventSheetManager,functionBlock,paramResults,hasAnySolModifiers,solModifiers){return regeneratorRuntime.wrap(function _DebugDoCallMappedFunction$(_context224){while(1){switch(_context224.prev=_context224.next){case 0:return _context224.delegateYield(functionBlock.GetEventBlock().DebugRunAsMappedFunctionCall(paramResults,functionBlock.IsCopyPicked()),"t0",1);case 1:if(hasAnySolModifiers)eventSheetManager.PopSol(solModifiers);case 2:case"end":return _context224.stop();}}},_DebugDoCallMappedFunction);})}]);return SystemPlugin;}(_C186.SDKPluginBase);}{var _C187=self.C3;_C187.Plugins.System.Type=/*#__PURE__*/function(_C187$DefendedBase){_inherits(SystemType,_C187$DefendedBase);function SystemType(objectClass){var _this173;_classCallCheck(this,SystemType);_this173=_possibleConstructorReturn(this,_getPrototypeOf(SystemType).call(this));_this173._objectClass=objectClass;_this173._runtime=objectClass.GetRuntime();_this173._plugin=objectClass.GetPlugin();return _this173;}_createClass(SystemType,[{key:"OnCreate",value:function OnCreate(){}},{key:"Release",value:function Release(){this._objectClass=null;this._runtime=null;this._plugin=null;}}]);return SystemType;}(_C187.DefendedBase);}{var _C188=self.C3;_C188.Plugins.System.Instance=/*#__PURE__*/function(_C188$DefendedBase){_inherits(SystemInstance,_C188$DefendedBase);function SystemInstance(inst,properties){var _this174;_classCallCheck(this,SystemInstance);_this174=_possibleConstructorReturn(this,_getPrototypeOf(SystemInstance).call(this));_this174._inst=inst;_this174._objectClass=_this174._inst.GetObjectClass();_this174._sdkType=_this174._objectClass.GetSdkType();_this174._runtime=_this174._inst.GetRuntime();return _this174;}_createClass(SystemInstance,[{key:"Release",value:function Release(){this._inst=null;this._objectClass=null;this._sdkType=null;this._runtime=null;}}]);return SystemInstance;}(_C188.DefendedBase);}{var _C189=self.C3;var tmpPickArray=[];_C189.Plugins.System.Cnds={EveryTick:function EveryTick(){return true;},OnLayoutStart:function OnLayoutStart(){return true;},OnLayoutEnd:function OnLayoutEnd(){return true;},OnSuspend:function OnSuspend(){return true;},OnResume:function OnResume(){return true;},IsSuspended:function IsSuspended(){return this._runtime.IsSuspended();},Else:function Else(){var frame=this._runtime.GetCurrentEventStackFrame();if(frame.GetElseBranchRan())return false;else return!frame.GetLastEventTrue();},TriggerOnce:function TriggerOnce(){var cnd=this._runtime.GetCurrentCondition();var cndSavedData=cnd.GetSavedDataMap();var lastTick=cndSavedData.get("TriggerOnce_lastTick");if(typeof lastTick==="undefined"){lastTick=-1;cndSavedData.set("TriggerOnce_lastTick",-1);}var curTick=this._runtime.GetTickCount();cndSavedData.set("TriggerOnce_lastTick",curTick);return this._runtime.IsLayoutFirstTick()||lastTick!==curTick-1;},Every:function Every(seconds){var cnd=this._runtime.GetCurrentCondition();var cndSavedData=cnd.GetSavedDataMap();var lastTime=cndSavedData.get("Every_lastTime")||0;var curTime=this._runtime.GetGameTime();if(!cndSavedData.has("Every_seconds"))cndSavedData.set("Every_seconds",seconds);var thisSeconds=cndSavedData.get("Every_seconds");if(curTime>=lastTime+thisSeconds){cndSavedData.set("Every_lastTime",lastTime+thisSeconds);if(curTime>=cndSavedData.get("Every_lastTime")+.04)cndSavedData.set("Every_lastTime",curTime);cndSavedData.set("Every_seconds",seconds);return true;}else if(curTime<lastTime-.1)cndSavedData.set("Every_lastTime",curTime);return false;},IsGroupActive:function IsGroupActive(groupName){var eventGroup=this._runtime.GetEventSheetManager().GetEventGroupByName(groupName);return eventGroup&&eventGroup.IsGroupActive();},IsPreview:function IsPreview(){return this._runtime.IsPreview();},IsMobile:function IsMobile(){return _C189.Platform.IsMobile;},OnLoadFinished:function OnLoadFinished(){return true;},OnCanvasSnapshot:function OnCanvasSnapshot(){return true;},EffectsSupported:function EffectsSupported(){return true;},OnSaveComplete:function OnSaveComplete(){return true;},OnSaveFailed:function OnSaveFailed(){return true;},OnLoadComplete:function OnLoadComplete(){return true;},OnLoadFailed:function OnLoadFailed(){return true;},ObjectUIDExists:function ObjectUIDExists(uid){return!!this._runtime.GetInstanceByUID(uid);},IsOnPlatform:function IsOnPlatform(p){switch(p){case 0:return _C189.Platform.Context==="browser";case 1:return _C189.Platform.OS==="iOS";case 2:return _C189.Platform.OS==="Android";case 8:return _C189.Platform.Context==="cordova";case 9:return this._runtime.GetExportType()==="scirra-arcade";case 10:return _C189.Platform.Context==="nwjs";case 13:return this._runtime.GetExportType()==="windows-uwp";default:return false;}},RegexTest:function RegexTest(str,regex,flags){var cacheRegex=this.GetRegex(regex,flags);return cacheRegex.test(str);},Compare:function Compare(x,cmp,y){return _C189.compare(x,cmp,y);},CompareBetween:function CompareBetween(x,a,b){return x>=a&&x<=b;},CompareVar:function CompareVar(ev,cmp,val){return _C189.compare(ev.GetValue(),cmp,val);},CompareBoolVar:function CompareBoolVar(ev){return!!ev.GetValue();},CompareTime:function CompareTime(cmp,t){var gameTime=this._runtime.GetGameTime();if(cmp===0){var cnd=this._runtime.GetCurrentCondition();var cndSavedData=cnd.GetSavedDataMap();if(!cndSavedData.get("CompareTime_executed"))if(gameTime>=t){cndSavedData.set("CompareTime_executed",true);return true;}return false;}else return _C189.compare(gameTime,cmp,t);},IsNaN:function IsNaN(n){return isNaN(n);},AngleWithin:function AngleWithin(a1,within,a2){return _C189.angleDiff(_C189.toRadians(a1),_C189.toRadians(a2))<=_C189.toRadians(within);},IsClockwiseFrom:function IsClockwiseFrom(a1,a2){return _C189.angleClockwise(_C189.toRadians(a1),_C189.toRadians(a2));},IsBetweenAngles:function IsBetweenAngles(a,la,ua){var angle=_C189.toRadians(a);var lower=_C189.toRadians(la);var upper=_C189.toRadians(ua);var obtuse=!_C189.angleClockwise(upper,lower);if(obtuse)return!(!_C189.angleClockwise(angle,lower)&&_C189.angleClockwise(angle,upper));else return _C189.angleClockwise(angle,lower)&&!_C189.angleClockwise(angle,upper);},IsValueType:function IsValueType(v,t){if(typeof v==="number")return t===0;else return t===1;},EvaluateExpression:function EvaluateExpression(v){return!!v;},OnSignal:function OnSignal(tag){return tag.toLowerCase()===this._signalTags.at(-1);},PickByComparison:function PickByComparison(objectClass,exp,cmp,val){if(!objectClass)return false;var forEachStack=this._GetForEachStack();var tempInstances=forEachStack.Push();var sol=objectClass.GetCurrentSol();_C189.shallowAssignArray(tempInstances,sol.GetInstances());if(sol.IsSelectAll())_C189.clearArray(sol._GetOwnElseInstances());var cnd=this._runtime.GetCurrentCondition();var k=0;for(var i=0,len=tempInstances.length;i<len;++i){var inst=tempInstances[i];tempInstances[k]=inst;exp=cnd.ReevaluateParameter(1,i);val=cnd.ReevaluateParameter(3,i);if(_C189.compare(exp,cmp,val))++k;else sol._PushElseInstance(inst);}_C189.truncateArray(tempInstances,k);sol.SetArrayPicked(tempInstances);var ret=!!tempInstances.length;_C189.clearArray(tempInstances);forEachStack.Pop();objectClass.ApplySolToContainer();return ret;},PickByEvaluate:function PickByEvaluate(objectClass,exp){if(!objectClass)return false;var forEachStack=this._GetForEachStack();var tempInstances=forEachStack.Push();var sol=objectClass.GetCurrentSol();_C189.shallowAssignArray(tempInstances,sol.GetInstances());if(sol.IsSelectAll())_C189.clearArray(sol._GetOwnElseInstances());var cnd=this._runtime.GetCurrentCondition();var k=0;for(var i=0,len=tempInstances.length;i<len;++i){var inst=tempInstances[i];tempInstances[k]=inst;exp=cnd.ReevaluateParameter(1,i);if(exp)++k;else sol._PushElseInstance(inst);}_C189.truncateArray(tempInstances,k);sol.SetArrayPicked(tempInstances);var ret=!!tempInstances.length;_C189.clearArray(tempInstances);forEachStack.Pop();objectClass.ApplySolToContainer();return ret;},PickNth:function PickNth(objectClass,index){if(!objectClass)return false;var sol=objectClass.GetCurrentSol();var instances=sol.GetInstances();index=Math.floor(index);if(index>=instances.length)return false;var inst=instances[index];sol.PickOne(inst);objectClass.ApplySolToContainer();return true;},PickRandom:function PickRandom(objectClass){if(!objectClass)return false;var sol=objectClass.GetCurrentSol();var instances=sol.GetInstances();var index=Math.floor(this._runtime.Random()*instances.length);if(index>=instances.length)return false;var inst=instances[index];sol.PickOne(inst);objectClass.ApplySolToContainer();return true;},PickAll:function PickAll(objectClass){if(!objectClass)return false;if(!objectClass.GetInstanceCount())return false;var sol=objectClass.GetCurrentSol();sol._SetSelectAll(true);objectClass.ApplySolToContainer();return true;},PickOverlappingPoint:function PickOverlappingPoint(objectClass,x,y){if(!objectClass)return false;var sol=objectClass.GetCurrentSol();var instances=sol.GetInstances();var currentEvent=this._runtime.GetCurrentEvent();var isOrBlock=currentEvent.IsOrBlock();var isInverted=this._runtime.GetCurrentCondition().IsInverted();if(sol.IsSelectAll()){_C189.shallowAssignArray(tmpPickArray,instances);sol.ClearArrays();sol._SetSelectAll(false);}else if(isOrBlock){_C189.shallowAssignArray(tmpPickArray,sol._GetOwnElseInstances());_C189.clearArray(sol._GetOwnElseInstances());}else{_C189.shallowAssignArray(tmpPickArray,sol._GetOwnInstances());_C189.clearArray(sol._GetOwnInstances());}for(var i=0,len=tmpPickArray.length;i<len;++i){var inst=tmpPickArray[i];if(_C189.xor(inst.GetWorldInfo().ContainsPoint(x,y),isInverted))sol._PushInstance(inst);else sol._PushElseInstance(inst);}objectClass.ApplySolToContainer();return _C189.xor(!!sol._GetOwnInstances().length,isInverted);},PickLastCreated:function PickLastCreated(objectClass){if(!objectClass)return false;var isFamily=objectClass.IsFamily();var pick=null;var instancesPendingCreate=this._runtime._GetInstancesPendingCreate();for(var i=instancesPendingCreate.length-1;i>=0;--i){var inst=instancesPendingCreate[i];if(isFamily){if(inst.GetObjectClass().BelongsToFamily(objectClass)){pick=inst;break;}}else if(inst.GetObjectClass()===objectClass){pick=inst;break;}}if(!pick){var _instances13=objectClass.GetInstances();if(_instances13.length)pick=_instances13.at(-1);}if(!pick)return false;var sol=objectClass.GetCurrentSol();sol.PickOne(pick);objectClass.ApplySolToContainer();return true;},Repeat:function Repeat(count){if(this._runtime.IsDebugging())return this._DebugRepeat(count);else return this._Repeat(count);},While:function While(){if(this._runtime.IsDebugging())return this._DebugWhile();else return this._While();},For:function For(name,start,end){if(this._runtime.IsDebugging())return this._DebugFor(name,start,end);else return this._For(name,start,end);},ForEach:function ForEach(objectClass){if(this._runtime.IsDebugging())return this._DebugForEach(objectClass);else return this._ForEach(objectClass);},ForEachOrdered:function ForEachOrdered(objectClass,expression,order){if(this._runtime.IsDebugging())return this._DebugForEachOrdered(objectClass,order);else return this._ForEachOrdered(objectClass,order);},LayerVisible:function LayerVisible(layer){return layer?layer.IsVisible():false;},LayerInteractive:function LayerInteractive(layer){return layer?layer.IsSelfAndParentsInteractive():false;},LayerIsHTML:function LayerIsHTML(layer){return layer?layer.IsHTMLElementsLayer():false;},LayerEmpty:function LayerEmpty(layer){return layer?!layer.GetInstanceCount():false;},LayerCmpOpacity:function LayerCmpOpacity(layer,cmp,o){if(!layer)return false;return _C189.compare(layer.GetOpacity()*100,cmp,o);},LayerNameExists:function LayerNameExists(nameStr){var layout=this._runtime.GetMainRunningLayout();return layout?layout.HasLayerByName(nameStr):false;},OnImageLoadingComplete:function OnImageLoadingComplete(){return true;},IsLoadingImages:function IsLoadingImages(){return this._imagesLoadingTotal>0;},TemplateExists:function TemplateExists(objectClass,template){var templateManager=this._runtime.GetTemplateManager();if(!templateManager)return false;if(!template)return false;return!!templateManager.GetTemplateData(objectClass,template);}};}{var _SortZOrderList=function _SortZOrderList(a,b){var layerA=a[0];var layerB=b[0];var diff=layerA-layerB;if(diff!==0)return diff;var indexA=a[1];var indexB=b[1];return indexA-indexB;};var SortInstancesByValue=function SortInstancesByValue(a,b){return a[1]-b[1];};var _C190=self.C3;var _tempZOrderList=[];var tempInstValues=[];var _tempRect11=_C190.New(_C190.Rect);var _tempColor7=_C190.New(_C190.Color);_C190.Plugins.System.Acts={SetVar:function SetVar(ev,x){ev.SetValue(x);},AddVar:function AddVar(ev,x){if(ev.IsNumber()&&typeof x!=="number")x=parseFloat(x);ev.SetValue(ev.GetValue()+x);},SubVar:function SubVar(ev,x){if(!ev.IsNumber())return;ev.SetValue(ev.GetValue()-x);},SetBoolVar:function SetBoolVar(ev,x){ev.SetValue(!!x);},ToggleBoolVar:function ToggleBoolVar(ev){ev.SetValue(!ev.GetValue());},ResetGlobals:function ResetGlobals(){this._runtime.GetEventSheetManager().ResetAllGlobalsToInitialValue();},CreateObject:function CreateObject(objectClass,layer,x,y,createHierarchy,template){if(!objectClass||!layer)return;var inst=this._runtime.CreateInstance(objectClass,layer,x,y,createHierarchy,template);if(!inst)return;if(createHierarchy)layer.SortAndAddInstancesByZIndex(inst);var eventSheetManager=this._runtime.GetEventSheetManager();eventSheetManager.BlockFlushingInstances(true);inst._TriggerOnCreatedOnSelfAndRelated();eventSheetManager.BlockFlushingInstances(false);var pickMap=new Map();inst.CollectInstancesToPick(pickMap,objectClass,createHierarchy);var _iteratorNormalCompletion569=true;var _didIteratorError569=false;var _iteratorError569=undefined;try{for(var _iterator569=pickMap[Symbol.iterator](),_step569;!(_iteratorNormalCompletion569=(_step569=_iterator569.next()).done);_iteratorNormalCompletion569=true){var _step569$value=_slicedToArray(_step569.value,2),pickObjectClass=_step569$value[0],instSet=_step569$value[1];pickObjectClass.GetCurrentSol().SetSetPicked(instSet);}}catch(err){_didIteratorError569=true;_iteratorError569=err;}finally{try{if(!_iteratorNormalCompletion569&&_iterator569["return"]!=null){_iterator569["return"]();}}finally{if(_didIteratorError569){throw _iteratorError569;}}}},CreateObjectByName:function CreateObjectByName(objectClassName,layer,x,y,createHierarchy,template){if(!objectClassName||!layer)return;var objectClass=this._runtime.GetObjectClassByName(objectClassName);if(!objectClass)return;_C190.Plugins.System.Acts.CreateObject.call(this,objectClass,layer,x,y,createHierarchy,template);},RecreateInitialObjects:function RecreateInitialObjects(objectClass,x1,y1,x2,y2,sourceLayoutName,sourceLayerParam,offsetX,offsetY,createHierarchy){if(!objectClass)return;var sourceLayout=this._runtime.GetCurrentLayout();if(sourceLayoutName){var lookupLayout=this._runtime.GetLayoutManager().GetLayoutByName(sourceLayoutName);if(lookupLayout)sourceLayout=lookupLayout;else return;}var sourceLayer=null;if(typeof sourceLayerParam!=="number"||sourceLayerParam>=0){sourceLayer=sourceLayout.GetLayer(sourceLayerParam);if(!sourceLayer)return;}_tempRect11.set(x1,y1,x2,y2);var allCreatedInstances=sourceLayout.RecreateInitialObjects(objectClass,_tempRect11,sourceLayer,offsetX,offsetY,createHierarchy);objectClass.GetCurrentSol().SetArrayPicked(allCreatedInstances);objectClass.ApplySolToContainer();},StopLoop:function StopLoop(){var loopStack=this._loopStack;if(!loopStack.IsInLoop())return;loopStack.GetCurrent().Stop();},SetGroupActive:function SetGroupActive(groupName,a){var group=this._runtime.GetEventSheetManager().GetEventGroupByName(groupName);if(!group)return;if(a===0)group.SetGroupActive(false);else if(a===1)group.SetGroupActive(true);else group.SetGroupActive(!group.IsGroupActive());},SetTimescale:function SetTimescale(ts){this._runtime.SetTimeScale(ts);},SetObjectTimescale:function SetObjectTimescale(objectClass,ts){if(ts<0)ts=0;if(!objectClass)return;var sol=objectClass.GetCurrentSol();var instances=sol.GetInstances();var _iteratorNormalCompletion570=true;var _didIteratorError570=false;var _iteratorError570=undefined;try{for(var _iterator570=instances[Symbol.iterator](),_step570;!(_iteratorNormalCompletion570=(_step570=_iterator570.next()).done);_iteratorNormalCompletion570=true){var inst=_step570.value;inst.SetTimeScale(ts);}}catch(err){_didIteratorError570=true;_iteratorError570=err;}finally{try{if(!_iteratorNormalCompletion570&&_iterator570["return"]!=null){_iterator570["return"]();}}finally{if(_didIteratorError570){throw _iteratorError570;}}}},RestoreObjectTimescale:function RestoreObjectTimescale(objectClass){if(!objectClass)return;var sol=objectClass.GetCurrentSol();var instances=sol.GetInstances();var _iteratorNormalCompletion571=true;var _didIteratorError571=false;var _iteratorError571=undefined;try{for(var _iterator571=instances[Symbol.iterator](),_step571;!(_iteratorNormalCompletion571=(_step571=_iterator571.next()).done);_iteratorNormalCompletion571=true){var inst=_step571.value;inst.RestoreTimeScale();}}catch(err){_didIteratorError571=true;_iteratorError571=err;}finally{try{if(!_iteratorNormalCompletion571&&_iterator571["return"]!=null){_iterator571["return"]();}}finally{if(_didIteratorError571){throw _iteratorError571;}}}},Wait:function Wait(seconds){if(seconds<0)return;this._runtime.GetEventSheetManager().AddScheduledWait().InitTimer(seconds);return true;},WaitForSignal:function WaitForSignal(tag){this._runtime.GetEventSheetManager().AddScheduledWait().InitSignal(tag);return true;},WaitForPreviousActions:function WaitForPreviousActions(){var eventSheetManager=this._runtime.GetEventSheetManager();eventSheetManager.AddScheduledWait().InitPromise(eventSheetManager.GetPromiseForAllAsyncActions());return true;},Signal:function Signal(tag){var lowerTag=tag.toLowerCase();this._signalTags.push(lowerTag);this._runtime.Trigger(_C190.Plugins.System.Cnds.OnSignal,null);this._signalTags.pop();var _iteratorNormalCompletion572=true;var _didIteratorError572=false;var _iteratorError572=undefined;try{for(var _iterator572=this._runtime.GetEventSheetManager().scheduledWaits()[Symbol.iterator](),_step572;!(_iteratorNormalCompletion572=(_step572=_iterator572.next()).done);_iteratorNormalCompletion572=true){var w=_step572.value;if(w.IsSignal()&&w.GetSignalTag()===lowerTag)w.SetSignalled();}}catch(err){_didIteratorError572=true;_iteratorError572=err;}finally{try{if(!_iteratorNormalCompletion572&&_iterator572["return"]!=null){_iterator572["return"]();}}finally{if(_didIteratorError572){throw _iteratorError572;}}}},SnapshotCanvas:function SnapshotCanvas(format,quality,x,y,width,height){var canvasManager;return regeneratorRuntime.async(function SnapshotCanvas$(_context225){while(1){switch(_context225.prev=_context225.next){case 0:canvasManager=this._runtime.GetCanvasManager();if(canvasManager){_context225.next=3;break;}return _context225.abrupt("return");case 3:this.UpdateRender();_context225.next=6;return regeneratorRuntime.awrap(canvasManager.SnapshotCanvas(format===0?"image/png":"image/jpeg",quality/100,x,y,width,height));case 6:_context225.next=8;return regeneratorRuntime.awrap(this._runtime.TriggerAsync(_C190.Plugins.System.Cnds.OnCanvasSnapshot,null));case 8:case"end":return _context225.stop();}}},null,this);},SetCanvasSize:function SetCanvasSize(w,h){if(w<=0||h<=0)return;this._runtime.SetViewportSize(w,h);this._runtime.GetCurrentLayout().BoundScrolling();var canvasManager=this._runtime.GetCanvasManager();if(!canvasManager)return;if(canvasManager.GetCurrentFullscreenMode()==="off")canvasManager.SetSize(canvasManager.GetLastWidth(),canvasManager.GetLastHeight(),true);else{this._runtime.SetOriginalViewportSize(w,h);canvasManager.SetSize(canvasManager.GetLastWidth(),canvasManager.GetLastHeight(),true);}this._runtime.UpdateRender();},SetFullscreenQuality:function SetFullscreenQuality(q){var canvasManager=this._runtime.GetCanvasManager();if(!canvasManager)return;if(canvasManager.GetCurrentFullscreenMode()==="off")return;canvasManager.SetFullscreenScalingQuality(q!==0?"high":"low");canvasManager.SetSize(canvasManager.GetLastWidth(),canvasManager.GetLastHeight(),true);},SaveState:function SaveState(slot){this._runtime.SaveToSlot(slot);},LoadState:function LoadState(slot){this._runtime.LoadFromSlot(slot);},LoadStateJSON:function LoadStateJSON(jsonStr){this._runtime.LoadFromJsonString(jsonStr);},SetHalfFramerateMode:function SetHalfFramerateMode(m){},ResetPersisted:function ResetPersisted(){var _iteratorNormalCompletion573=true;var _didIteratorError573=false;var _iteratorError573=undefined;try{for(var _iterator573=this._runtime.GetLayoutManager().GetAllLayouts()[Symbol.iterator](),_step573;!(_iteratorNormalCompletion573=(_step573=_iterator573.next()).done);_iteratorNormalCompletion573=true){var layout=_step573.value;layout.ResetPersistData();}}catch(err){_didIteratorError573=true;_iteratorError573=err;}finally{try{if(!_iteratorNormalCompletion573&&_iterator573["return"]!=null){_iterator573["return"]();}}finally{if(_didIteratorError573){throw _iteratorError573;}}}},SetPixelRounding:function SetPixelRounding(m){this._runtime.SetPixelRoundingEnabled(m!==0);},SetMinimumFramerate:function SetMinimumFramerate(fps){this._runtime.SetMinimumFramerate(fps);},SortZOrderByInstVar:function SortZOrderByInstVar(objectClass,instVar){if(!objectClass)return;var sol=objectClass.GetCurrentSol();var pickedInstances=sol.GetInstances();var zOrderList=_tempZOrderList;var instValues=tempInstValues;var layout=this._runtime.GetCurrentLayout();var isFamily=objectClass.IsFamily();var familyIndex=objectClass.GetFamilyIndex();for(var i=0,len=pickedInstances.length;i<len;++i){var inst=pickedInstances[i];var wi=inst.GetWorldInfo();if(!wi)continue;var value=void 0;if(isFamily)value=inst.GetInstanceVariableValue(instVar+inst.GetObjectClass().GetFamilyInstanceVariableOffset(familyIndex));else value=inst.GetInstanceVariableValue(instVar);zOrderList.push([wi.GetLayer().GetIndex(),wi.GetZIndex()]);instValues.push([inst,value]);}if(!zOrderList.length)return;zOrderList.sort(_SortZOrderList);instValues.sort(SortInstancesByValue);var anyChanged=false;for(var _i86=0,_len62=zOrderList.length;_i86<_len62;++_i86){var _inst21=instValues[_i86][0];var layer=layout.GetLayerByIndex(zOrderList[_i86][0]);var toZ=zOrderList[_i86][1];var layerInstances=layer._GetInstances();if(layerInstances[toZ]!==_inst21){layerInstances[toZ]=_inst21;_inst21.GetWorldInfo()._SetLayer(layer,true);layer.SetZIndicesChanged(_inst21);anyChanged=true;}}if(anyChanged)this._runtime.UpdateRender();_C190.clearArray(_tempZOrderList);_C190.clearArray(tempInstValues);},SetCollisionCellSize:function SetCollisionCellSize(width,height){width=Math.floor(width);height=Math.floor(height);if(width<=0||height<=0||!Number.isFinite(width)||!Number.isFinite(height))return;this._runtime.GetCollisionEngine().SetCollisionCellSize(width,height);},GoToLayout:function GoToLayout(layout){if(this._runtime.IsLoading())return;var layoutManager=this._runtime.GetLayoutManager();if(layoutManager.IsPendingChangeMainLayout())return;layoutManager.ChangeMainLayout(layout);},GoToLayoutByName:function GoToLayoutByName(layoutName){if(this._runtime.IsLoading())return;var layoutManager=this._runtime.GetLayoutManager();if(layoutManager.IsPendingChangeMainLayout())return;var toLayout=layoutManager.GetLayoutByName(layoutName);if(toLayout)layoutManager.ChangeMainLayout(toLayout);},NextPrevLayout:function NextPrevLayout(prev){if(this._runtime.IsLoading())return;var layoutManager=this._runtime.GetLayoutManager();if(layoutManager.IsPendingChangeMainLayout())return;var allLayouts=layoutManager.GetAllLayouts();var index=allLayouts.indexOf(layoutManager.GetMainRunningLayout());if(prev&&index===0)return;if(!prev&&index===allLayouts.length-1)return;var toLayout=allLayouts[index+(prev?-1:1)];layoutManager.ChangeMainLayout(toLayout);},RestartLayout:function RestartLayout(){if(this._runtime.IsLoading())return;var layoutManager=this._runtime.GetLayoutManager();if(layoutManager.IsPendingChangeMainLayout())return;layoutManager.ChangeMainLayout(layoutManager.GetMainRunningLayout());this._runtime.GetEventSheetManager().ResetAllGroupsInitialActivation();},SetLayerVisible:function SetLayerVisible(layer,v){if(!layer)return;layer.SetVisible(v);},SetLayerInteractive:function SetLayerInteractive(layer,i){if(!layer)return;layer.SetInteractive(i);},SetLayerHTML:function SetLayerHTML(layer,isHtml){if(!layer)return;layer.SetIsHTMLElementsLayer(isHtml);},SetLayerOpacity:function SetLayerOpacity(layer,o){if(!layer)return;layer.SetOpacity(o/100);},SetLayerScale:function SetLayerScale(layer,s){if(!layer)return;layer.SetOwnScale(s);},SetLayerScaleRate:function SetLayerScaleRate(layer,r){if(!layer)return;layer.SetScaleRate(r);},SetLayerAngle:function SetLayerAngle(layer,a){if(!layer)return;layer.SetAngle(_C190.toRadians(+a));},SetLayerScroll:function SetLayerScroll(layer,scrollX,scrollY){if(!layer)return;layer.SetOwnScrollPositionEnabled(true);layer.SetScrollX(scrollX);layer.SetScrollY(scrollY);},RestoreLayerScroll:function RestoreLayerScroll(layer){if(!layer)return;layer.SetOwnScrollPositionEnabled(false);},SetLayerParallax:function SetLayerParallax(layer,px,py){if(!layer)return;layer.SetParallax(px/100,py/100);},SetLayerZElevation:function SetLayerZElevation(layer,z){if(!layer)return;layer.SetZElevation(+z);},SetLayerBackground:function SetLayerBackground(layer,rgb){if(!layer)return;_tempColor7.setFromRgbValue(rgb);_tempColor7.clamp();var layerBgColor=layer.GetBackgroundColor();if(layerBgColor.equalsIgnoringAlpha(_tempColor7))return;layerBgColor.copyRgb(_tempColor7);this.UpdateRender();},SetLayerTransparent:function SetLayerTransparent(layer,t){if(!layer)return;layer.SetTransparent(t);},SetLayerBlendMode:function SetLayerBlendMode(layer,bm){if(!layer)return;layer.SetBlendMode(bm);},SetLayerEffectEnabled:function SetLayerEffectEnabled(layer,enabled,effectName){if(!layer)return;var effectList=layer.GetEffectList();var effectType=effectList.GetEffectTypeByName(effectName);if(!effectType)return;var e=enabled===1;if(effectType.IsActive()===e)return;effectType.SetActive(e);layer.UpdateActiveEffects();this._runtime.UpdateRender();},SetLayerEffectParam:function SetLayerEffectParam(layer,effectName,paramIndex,value){if(!layer)return;var effectList=layer.GetEffectList();var effectType=effectList.GetEffectTypeByName(effectName);if(!effectType)return;paramIndex=Math.floor(paramIndex);var paramType=effectType.GetShaderProgram().GetParameterType(paramIndex);if(!paramType)return;if(paramType==="color"){_tempColor7.setFromRgbValue(value);value=_tempColor7;}else if(paramType==="percent")value/=100;var didChange=effectList.SetEffectParameter(effectType.GetIndex(),paramIndex,value);if(didChange&&effectType.IsActive())this._runtime.UpdateRender();},SetLayerForceOwnTexture:function SetLayerForceOwnTexture(layer,f){if(!layer)return;layer.SetForceOwnTexture(f);},SetLayoutScale:function SetLayoutScale(s){this._runtime.GetCurrentLayout().SetScale(+s);},SetLayoutAngle:function SetLayoutAngle(a){this._runtime.GetCurrentLayout().SetAngle(_C190.toRadians(+a));},SetLayoutEffectEnabled:function SetLayoutEffectEnabled(enabled,effectName){var layout=this._runtime.GetCurrentLayout();var effectList=layout.GetEffectList();var effectType=effectList.GetEffectTypeByName(effectName);if(!effectType)return;var e=enabled===1;if(effectType.IsActive()===e)return;effectType.SetActive(e);layout.UpdateActiveEffects();this._runtime.UpdateRender();},SetLayoutEffectParam:function SetLayoutEffectParam(effectName,paramIndex,value){var layout=this._runtime.GetCurrentLayout();var effectList=layout.GetEffectList();var effectType=effectList.GetEffectTypeByName(effectName);if(!effectType)return;paramIndex=Math.floor(paramIndex);var paramType=effectType.GetShaderProgram().GetParameterType(paramIndex);if(!paramType)return;if(paramType==="color"){_tempColor7.setFromRgbValue(value);value=_tempColor7;}else if(paramType==="percent")value/=100;var didChange=effectList.SetEffectParameter(effectType.GetIndex(),paramIndex,value);if(didChange&&effectType.IsActive())this._runtime.UpdateRender();},SetLayoutVanishingPoint:function SetLayoutVanishingPoint(vpX,vpY){var layout=this._runtime.GetCurrentLayout();layout.SetVanishingPointXY(vpX/100,vpY/100);},SetLayoutProjection:function SetLayoutProjection(p){var layout=this._runtime.GetCurrentLayout();if(p===0)layout.SetPerspectiveProjection();else layout.SetOrthographicProjection();},ScrollX:function ScrollX(x){var layout=this._runtime.GetCurrentLayout();layout.SetScrollX(x);},ScrollY:function ScrollY(y){var layout=this._runtime.GetCurrentLayout();layout.SetScrollY(y);},Scroll:function Scroll(x,y){var layout=this._runtime.GetCurrentLayout();layout.SetScrollX(x);layout.SetScrollY(y);},ScrollToObject:function ScrollToObject(objectClass){if(!objectClass)return;var inst=objectClass.GetFirstPicked();if(!inst)return;var wi=inst.GetWorldInfo();if(!wi)return;var layout=this._runtime.GetCurrentLayout();layout.SetScrollX(wi.GetX());layout.SetScrollY(wi.GetY());},AddLayer:function AddLayer(layerName,insertBy,where){var layout=this._runtime.GetCurrentLayout();try{layout.AddLayer(layerName,insertBy,where);}catch(err){console.warn("[Construct] Cannot add layer: ",err);}},MoveLayer:function MoveLayer(layer,insertBy,where){if(!layer)return;var layout=this._runtime.GetCurrentLayout();try{layout.MoveLayer(layer,insertBy,where);}catch(err){console.warn("[Construct] Cannot move layer: ",err);}},RemoveLayer:function RemoveLayer(layer){if(!layer)return;var layout=this._runtime.GetCurrentLayout();layout.RemoveLayer(layer);},RemoveAllDynamicLayers:function RemoveAllDynamicLayers(){this._runtime.GetCurrentLayout().RemoveAllDynamicLayers();},LoadObjectTextures:function LoadObjectTextures(objectClass){var layout,objectClasses;return regeneratorRuntime.async(function LoadObjectTextures$(_context226){while(1){switch(_context226.prev=_context226.next){case 0:layout=this._runtime.GetMainRunningLayout();if(!(!layout||!objectClass||this._runtime.IsLoading())){_context226.next=3;break;}return _context226.abrupt("return");case 3:objectClasses=objectClass.IsFamily()?objectClass.GetFamilyMembers():[objectClass];_context226.next=6;return regeneratorRuntime.awrap(this._LoadTexturesForObjectClasses(layout,objectClasses));case 6:case"end":return _context226.stop();}}},null,this);},LoadObjectTexturesByName:function LoadObjectTexturesByName(objectClassName){return regeneratorRuntime.async(function LoadObjectTexturesByName$(_context227){while(1){switch(_context227.prev=_context227.next){case 0:_context227.next=2;return regeneratorRuntime.awrap(_C190.Plugins.System.Acts.LoadObjectTextures.call(this,this._runtime.GetObjectClassByName(objectClassName)));case 2:case"end":return _context227.stop();}}},null,this);},UnloadObjectTextures:function UnloadObjectTextures(objectClass){var layout=this._runtime.GetMainRunningLayout();if(!layout||!objectClass)return;var objectClasses=objectClass.IsFamily()?objectClass.GetFamilyMembers():[objectClass];this._UnloadTexturesForObjectClasses(layout,objectClasses);},UnloadObjectTexturesByName:function UnloadObjectTexturesByName(objectClassName){_C190.Plugins.System.Acts.UnloadObjectTextures.call(this,this._runtime.GetObjectClassByName(objectClassName));},UnloadUnusedTextures:function UnloadUnusedTextures(){var layout=this._runtime.GetMainRunningLayout();if(!layout)return;var objectClasses=layout._GetTextureLoadedObjectTypes();this._UnloadTexturesForObjectClasses(layout,objectClasses);},LoadLayoutTextures:function LoadLayoutTextures(loadLayout){var curLayout;return regeneratorRuntime.async(function LoadLayoutTextures$(_context228){while(1){switch(_context228.prev=_context228.next){case 0:curLayout=this._runtime.GetMainRunningLayout();if(!(!loadLayout||!curLayout||this._runtime.IsLoading())){_context228.next=3;break;}return _context228.abrupt("return");case 3:_context228.next=5;return regeneratorRuntime.awrap(this._LoadTexturesForObjectClasses(curLayout,loadLayout._GetInitialObjectClasses()));case 5:case"end":return _context228.stop();}}},null,this);},LoadLayoutTexturesByName:function LoadLayoutTexturesByName(layoutName){var curLayout,loadLayout;return regeneratorRuntime.async(function LoadLayoutTexturesByName$(_context229){while(1){switch(_context229.prev=_context229.next){case 0:curLayout=this._runtime.GetMainRunningLayout();loadLayout=this._runtime.GetLayoutManager().GetLayoutByName(layoutName);if(!(!loadLayout||!curLayout||this._runtime.IsLoading())){_context229.next=4;break;}return _context229.abrupt("return");case 4:_context229.next=6;return regeneratorRuntime.awrap(this._LoadTexturesForObjectClasses(curLayout,loadLayout._GetInitialObjectClasses()));case 6:case"end":return _context229.stop();}}},null,this);},SetFunctionReturnValue:function SetFunctionReturnValue(v){var frame=this._eventStack.GetCurrentExpFuncStackFrame();if(!frame)return;switch(frame.GetFunctionReturnType()){case 1:if(typeof v==="number")frame.SetFunctionReturnValue(v);break;case 2:if(typeof v==="string")frame.SetFunctionReturnValue(v);break;case 3:frame.SetFunctionReturnValue(v);break;}},MapFunction:function MapFunction(name,str,functionBlock){var mapEntry=this._GetFunctionMap(name.toLowerCase(),true);var strMap=mapEntry.strMap;var lowerStr=str.toLowerCase();if(strMap.has(lowerStr))console.warn("[Construct] Function map '".concat(name,"' string '").concat(str,"' already in map; overwriting entry"));var firstFunctionBlock=_C190.first(strMap.values())||mapEntry.defaultFunc;if(firstFunctionBlock){var firstReturnsValue=firstFunctionBlock.GetReturnType()!==0;var curReturnsValue=functionBlock.GetReturnType()!==0;if(firstReturnsValue!==curReturnsValue){console.error("[Construct] Function map '".concat(name,"' string '").concat(str,"' function return type not compatible with other functions in the map; entry ignored"));return;}}strMap.set(lowerStr,functionBlock);},MapFunctionDefault:function MapFunctionDefault(name,functionBlock){var mapEntry=this._GetFunctionMap(name.toLowerCase(),true);if(mapEntry.defaultFunc)console.warn("[Construct] Function map '".concat(name,"' already has a default; overwriting entry"));var firstFunctionBlock=_C190.first(mapEntry.strMap.values())||mapEntry.defaultFunc;if(firstFunctionBlock){var firstReturnsValue=firstFunctionBlock.GetReturnType()!==0;var curReturnsValue=functionBlock.GetReturnType()!==0;if(firstReturnsValue!==curReturnsValue){console.error("[Construct] Function map '".concat(name,"' default: function return type not compatible with other functions in the map; entry ignored"));return;}}mapEntry.defaultFunc=functionBlock;},CallMappedFunction:function CallMappedFunction(name,str,forwardParams){forwardParams=Math.floor(forwardParams);var mapEntry=this._GetFunctionMap(name.toLowerCase(),false);if(!mapEntry){console.warn("[Construct] Call mapped function: map name '".concat(name,"' not found; call ignored"));return;}var functionBlock=mapEntry.strMap.get(str.toLowerCase());if(!functionBlock)if(mapEntry.defaultFunc){functionBlock=mapEntry.defaultFunc;forwardParams=0;}else{console.warn("[Construct] Call mapped function: no function associated with map '".concat(name,"' string '").concat(str,"'; call ignored (consider setting a default)"));return;}if(!functionBlock.IsEnabled())return;if(functionBlock.GetReturnType()!==0){console.warn("[Construct] Call mapped function: map '".concat(name,"' string '").concat(str,"' has a return type so cannot be called"));return;}var runtime=this._runtime;var eventSheetManager=runtime.GetEventSheetManager();var currentEvent=eventSheetManager.GetCurrentEvent();var solModifiers=currentEvent.GetSolModifiersIncludingParents();var hasAnySolModifiers=solModifiers.length>0;if(hasAnySolModifiers)if(functionBlock.IsCopyPicked())eventSheetManager.PushCopySol(solModifiers);else eventSheetManager.PushCleanSol(solModifiers);var paramResults=[];var callerFunctionBlock=eventSheetManager.FindFirstFunctionBlockParent(currentEvent);if(callerFunctionBlock){var callerParameters=callerFunctionBlock.GetFunctionParameters();for(var i=forwardParams,len=callerParameters.length;i<len;++i){paramResults.push(callerParameters[i].GetValue());}}var calleeParameters=functionBlock.GetFunctionParameters();for(var _i87=paramResults.length,_len63=calleeParameters.length;_i87<_len63;++_i87){paramResults.push(calleeParameters[_i87].GetInitialValue());}if(runtime.IsDebugging())return this._DebugDoCallMappedFunction(eventSheetManager,functionBlock,paramResults,hasAnySolModifiers,solModifiers);else return this._DoCallMappedFunction(eventSheetManager,functionBlock,paramResults,hasAnySolModifiers,solModifiers);}};}{var _C191=self.C3;_C191.Plugins.System.Exps={"int":function int(x){if(typeof x==="string"){x=parseInt(x,10);if(isNaN(x))x=0;}return Math.floor(x);},"float":function float(x){if(typeof x==="string"){x=parseFloat(x);if(isNaN(x))x=0;}return x;},str:function str(x){return x.toString();},len:function len(x){if(typeof x==="string")return x.length;else return 0;},random:function random(a,b){if(typeof b==="undefined")return this._runtime.Random()*a;else return this._runtime.Random()*(b-a)+a;},choose:function choose(){for(var _len64=arguments.length,args=new Array(_len64),_key36=0;_key36<_len64;_key36++){args[_key36]=arguments[_key36];}var index=Math.floor(this._runtime.Random()*args.length);return args[index];},chooseindex:function chooseindex(index){if(typeof index!=="number")index=0;for(var _len65=arguments.length,args=new Array(_len65>1?_len65-1:0),_key37=1;_key37<_len65;_key37++){args[_key37-1]=arguments[_key37];}index=_C191.clamp(Math.floor(index),0,args.length-1);return args[index];},pi:function pi(){return Math.PI;},infinity:function infinity(){return Infinity;},sqrt:function sqrt(v){return Math.sqrt(v);},abs:function abs(v){return Math.abs(v);},round:function round(v){return Math.round(v);},roundtodp:function roundtodp(v,dp){dp=Math.max(Math.floor(dp),0);var m=Math.pow(10,dp);return Math.round((v+Number.EPSILON)*m)/m;},floor:function floor(v){return Math.floor(v);},ceil:function ceil(v){return Math.ceil(v);},sign:function sign(v){return Math.sign(v);},sin:function sin(x){return Math.sin(_C191.toRadians(x));},cos:function cos(x){return Math.cos(_C191.toRadians(x));},tan:function tan(x){return Math.tan(_C191.toRadians(x));},asin:function asin(x){return _C191.toDegrees(Math.asin(x));},acos:function acos(x){return _C191.toDegrees(Math.acos(x));},atan:function atan(x){return _C191.toDegrees(Math.atan(x));},exp:function exp(x){return Math.exp(x);},ln:function ln(x){return Math.log(x);},log10:function log10(x){return Math.log(x)/Math.LN10;},max:function max(){var ret=arguments.length<=0?undefined:arguments[0];if(typeof ret!=="number")ret=0;for(var i=1,len=arguments.length;i<len;++i){var n=i<0||arguments.length<=i?undefined:arguments[i];if(typeof n!=="number")continue;if(ret<n)ret=n;}return ret;},min:function min(){var ret=arguments.length<=0?undefined:arguments[0];if(typeof ret!=="number")ret=0;for(var i=1,len=arguments.length;i<len;++i){var n=i<0||arguments.length<=i?undefined:arguments[i];if(typeof n!=="number")continue;if(ret>n)ret=n;}return ret;},clamp:function clamp(x,l,u){return _C191.clamp(x,l,u);},distance:function distance(x1,y1,x2,y2){return _C191.distanceTo(x1,y1,x2,y2);},angle:function angle(x1,y1,x2,y2){return _C191.toDegrees(_C191.angleTo(x1,y1,x2,y2));},lerp:function lerp(a,b,x){return _C191.lerp(a,b,x);},unlerp:function unlerp(a,b,y){return _C191.unlerp(a,b,y);},qarp:function qarp(a,b,c,x){return _C191.qarp(a,b,c,x);},cubic:function cubic(a,b,c,d,x){return _C191.cubic(a,b,c,d,x);},cosp:function cosp(a,b,x){return _C191.cosp(a,b,x);},anglediff:function anglediff(a,b){return _C191.toDegrees(_C191.angleDiff(_C191.toRadians(a),_C191.toRadians(b)));},anglelerp:function anglelerp(a,b,x){return _C191.toDegrees(_C191.angleLerp(_C191.toRadians(a),_C191.toRadians(b),x));},anglerotate:function anglerotate(a,b,c){return _C191.toDegrees(_C191.angleRotate(_C191.toRadians(a),_C191.toRadians(b),_C191.toRadians(c)));},setbit:function setbit(n,b,v){n=n|0;b=b|0;v=v!==0?1:0;return n&~(1<<b)|v<<b;},togglebit:function togglebit(n,b){n=n|0;b=b|0;return n^1<<b;},getbit:function getbit(n,b){n=n|0;b=b|0;return n&1<<b?1:0;},newline:function newline(){return"\n";},uppercase:function uppercase(s){return typeof s==="string"?s.toUpperCase():"";},lowercase:function lowercase(s){return typeof s==="string"?s.toLowerCase():"";},left:function left(text,n){return typeof text==="string"?text.substr(0,n):"";},mid:function mid(text,index,count){if(typeof text!=="string")return"";if(count<0)return text.substr(index);else return text.substr(index,count);},right:function right(text,n){return typeof text==="string"?text.substr(Math.max(text.length-n,0)):"";},trim:function trim(text){return typeof text==="string"?text.trim():"";},tokenat:function tokenat(text,index,sep){if(typeof text!=="string"||typeof sep!=="string")return"";var arr=text.split(sep);index=Math.floor(index);if(index<0||index>=arr.length)return"";return arr[index];},tokencount:function tokencount(text,sep){if(typeof text!=="string"||typeof sep!=="string"||!text.length)return 0;return text.split(sep).length;},find:function find(text,searchStr){if(typeof text==="string"&&typeof searchStr==="string")return text.search(new RegExp(_C191.EscapeRegex(searchStr),"i"));else return-1;},findcase:function findcase(text,searchStr){if(typeof text==="string"&&typeof searchStr==="string")return text.search(new RegExp(_C191.EscapeRegex(searchStr),""));else return-1;},replace:function replace(text,find,_replace){if(typeof text==="string"&&typeof find==="string"&&typeof _replace==="string")return text.replace(new RegExp(_C191.EscapeRegex(find),"gi"),_replace);else return typeof text==="string"?text:"";},regexsearch:function regexsearch(text,regex,flags){var cacheRegex=this.GetRegex(regex,flags);return text?text.search(cacheRegex):-1;},regexreplace:function regexreplace(text,regex,flags,replace){var cacheRegex=this.GetRegex(regex,flags);return text?text.replace(cacheRegex,replace):"";},regexmatchcount:function regexmatchcount(text,regex,flags){var matches=this.GetRegexMatches(text.toString(),regex,flags);return matches?matches.length:0;},regexmatchat:function regexmatchat(text,regex,flags,index){index=Math.floor(index);var matches=this.GetRegexMatches(text.toString(),regex,flags);if(!matches||index<0||index>=matches.length)return"";else return matches[index];},zeropad:function zeropad(n,d){var s=n<0?"-":"";if(n<0)n=-n;var zeroes=d-n.toString().length;s+="0".repeat(Math.max(zeroes,0));return s+n.toString();},urlencode:function urlencode(s){return encodeURIComponent(s);},urldecode:function urldecode(s){return decodeURIComponent(s);},dt:function dt(){return this._runtime._GetDtFast();},timescale:function timescale(){return this._runtime.GetTimeScale();},wallclocktime:function wallclocktime(){return(Date.now()-this._runtime.GetStartTime())/1E3;},unixtime:function unixtime(){return Date.now();},time:function time(){return this._runtime.GetGameTime();},tickcount:function tickcount(){return this._runtime.GetTickCount();},objectcount:function objectcount(){return this._runtime.GetObjectCount();},fps:function fps(){return this._runtime.GetFPS();},cpuutilisation:function cpuutilisation(){return this._runtime.GetMainThreadTime();},gpuutilisation:function gpuutilisation(){return this._runtime.GetGPUUtilisation();},windowwidth:function windowwidth(){return this._runtime.GetCanvasManager().GetDeviceWidth();},windowheight:function windowheight(){return this._runtime.GetCanvasManager().GetDeviceHeight();},originalwindowwidth:function originalwindowwidth(){return this._runtime.GetOriginalViewportWidth();},originalwindowheight:function originalwindowheight(){return this._runtime.GetOriginalViewportHeight();},originalviewportwidth:function originalviewportwidth(){return this._runtime.GetOriginalViewportWidth();},originalviewportheight:function originalviewportheight(){return this._runtime.GetOriginalViewportHeight();},scrollx:function scrollx(){return this._runtime.GetCurrentLayout().GetScrollX();},scrolly:function scrolly(){return this._runtime.GetCurrentLayout().GetScrollY();},layoutname:function layoutname(){return this._runtime.GetCurrentLayout().GetName();},layoutscale:function layoutscale(){return this._runtime.GetCurrentLayout().GetScale();},layoutangle:function layoutangle(){return _C191.toDegrees(this._runtime.GetCurrentLayout().GetAngle());},layoutwidth:function layoutwidth(){return this._runtime.GetCurrentLayout().GetWidth();},layoutheight:function layoutheight(){return this._runtime.GetCurrentLayout().GetHeight();},vanishingpointx:function vanishingpointx(){return this._runtime.GetCurrentLayout().GetVanishingPointX()*100;},vanishingpointy:function vanishingpointy(){return this._runtime.GetCurrentLayout().GetVanishingPointY()*100;},viewportleft:function viewportleft(layerParam){var layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);return layer?layer.GetViewport3D().getLeft():0;},viewporttop:function viewporttop(layerParam){var layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);return layer?layer.GetViewport3D().getTop():0;},viewportright:function viewportright(layerParam){var layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);return layer?layer.GetViewport3D().getRight():0;},viewportbottom:function viewportbottom(layerParam){var layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);return layer?layer.GetViewport3D().getBottom():0;},viewportwidth:function viewportwidth(layerParam){var layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);return layer?layer.GetViewport3D().width():0;},viewportheight:function viewportheight(layerParam){var layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);return layer?layer.GetViewport3D().height():0;},viewportmidx:function viewportmidx(layerParam){var layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);if(layer){var vp=layer.GetViewport3D();return(vp.getLeft()+vp.getRight())/2;}else return 0;},viewportmidy:function viewportmidy(layerParam){var layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);if(layer){var vp=layer.GetViewport3D();return(vp.getTop()+vp.getBottom())/2;}else return 0;},canvastolayerx:function canvastolayerx(layerParam,x,y){var layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);return layer?layer.CanvasCssToLayer(x,y)[0]:0;},canvastolayery:function canvastolayery(layerParam,x,y){var layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);return layer?layer.CanvasCssToLayer(x,y)[1]:0;},layertocanvasx:function layertocanvasx(layerParam,x,y){var layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);return layer?layer.LayerToCanvasCss(x,y)[0]:0;},layertocanvasy:function layertocanvasy(layerParam,x,y){var layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);return layer?layer.LayerToCanvasCss(x,y)[1]:0;},layertolayerx:function layertolayerx(fromLayerParam,toLayerParam,x,y){var layout=this._runtime.GetCurrentLayout();var fromLayer=layout.GetLayer(fromLayerParam);var toLayer=layout.GetLayer(toLayerParam);if(!fromLayer||!toLayer||fromLayer===toLayer)return x;var _fromLayer$LayerToCan=fromLayer.LayerToCanvasCss(x,y),_fromLayer$LayerToCan2=_slicedToArray(_fromLayer$LayerToCan,2),canvasX=_fromLayer$LayerToCan2[0],canvasY=_fromLayer$LayerToCan2[1];return toLayer.CanvasCssToLayer(canvasX,canvasY)[0];},layertolayery:function layertolayery(fromLayerParam,toLayerParam,x,y){var layout=this._runtime.GetCurrentLayout();var fromLayer=layout.GetLayer(fromLayerParam);var toLayer=layout.GetLayer(toLayerParam);if(!fromLayer||!toLayer||fromLayer===toLayer)return y;var _fromLayer$LayerToCan3=fromLayer.LayerToCanvasCss(x,y),_fromLayer$LayerToCan4=_slicedToArray(_fromLayer$LayerToCan3,2),canvasX=_fromLayer$LayerToCan4[0],canvasY=_fromLayer$LayerToCan4[1];return toLayer.CanvasCssToLayer(canvasX,canvasY)[1];},layerscale:function layerscale(layerParam){var layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);return layer?layer.GetOwnScale():0;},layerangle:function layerangle(layerParam){var layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);return layer?_C191.toDegrees(layer.GetOwnAngle()):0;},layeropacity:function layeropacity(layerParam){var layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);return layer?layer.GetOpacity()*100:0;},layerscalerate:function layerscalerate(layerParam){var layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);return layer?layer.GetScaleRate():0;},layerscrollx:function layerscrollx(layerParam){var layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);return layer?layer.GetScrollX():0;},layerscrolly:function layerscrolly(layerParam){var layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);return layer?layer.GetScrollY():0;},layerparallaxx:function layerparallaxx(layerParam){var layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);return layer?layer.GetParallaxX()*100:0;},layerparallaxy:function layerparallaxy(layerParam){var layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);return layer?layer.GetParallaxY()*100:0;},layerzelevation:function layerzelevation(layerParam){var layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);return layer?layer.GetZElevation():0;},layerindex:function layerindex(layerParam){var layer=this._runtime.GetCurrentLayout().GetLayer(layerParam);return layer?layer.GetIndex():-1;},canvassnapshot:function canvassnapshot(){var canvasManager=this._runtime.GetCanvasManager();if(!canvasManager)return"";return canvasManager.GetCanvasSnapshotUrl();},loopindex:function loopindex(name){var loopStack=this._loopStack;if(!loopStack.IsInLoop())return 0;if(name){var loop=loopStack.FindByName(name);return loop?loop.GetIndex():0;}else return loopStack.GetCurrent().GetIndex();},savestatejson:function savestatejson(){return this._runtime.GetLastSaveJsonString();},callmapped:function callmapped(name,str){var mapEntry=this._GetFunctionMap(name.toLowerCase(),false);if(!mapEntry){console.warn("[Construct] Call mapped function: map name '".concat(name,"' not found; returning 0"));return 0;}var functionBlock=mapEntry.strMap.get(str.toLowerCase());if(!functionBlock)if(mapEntry.defaultFunc)functionBlock=mapEntry.defaultFunc;else{console.warn("[Construct] Call mapped function: no function associated with map '".concat(name,"' string '").concat(str,"'; returning 0 (consider setting a default)"));return 0;}var returnType=functionBlock.GetReturnType();var defaultReturnValue=functionBlock.GetDefaultReturnValue();if(returnType===0){console.warn("[Construct] Call mapped function: map '".concat(name,"' string '").concat(str,"' has no return type so cannot be called from an expression; returning 0"));return 0;}if(!functionBlock.IsEnabled())return defaultReturnValue;var runtime=this._runtime;var eventSheetManager=runtime.GetEventSheetManager();var currentEvent=eventSheetManager.GetCurrentEvent();var solModifiers=currentEvent.GetSolModifiersIncludingParents();var hasAnySolModifiers=solModifiers.length>0;if(hasAnySolModifiers)if(functionBlock.IsCopyPicked())eventSheetManager.PushCopySol(solModifiers);else eventSheetManager.PushCleanSol(solModifiers);var calleeParameters=functionBlock.GetFunctionParameters();for(var _len66=arguments.length,paramResults=new Array(_len66>2?_len66-2:0),_key38=2;_key38<_len66;_key38++){paramResults[_key38-2]=arguments[_key38];}for(var i=paramResults.length,len=calleeParameters.length;i<len;++i){paramResults.push(calleeParameters[i].GetInitialValue());}var callEventBlock=functionBlock.GetEventBlock();var returnValue=callEventBlock.RunAsExpressionFunctionCall.apply(callEventBlock,[callEventBlock.GetSolModifiersIncludingParents(),functionBlock.IsCopyPicked(),returnType,defaultReturnValue].concat(paramResults));if(hasAnySolModifiers)eventSheetManager.PopSol(solModifiers);return returnValue;},loadingprogress:function loadingprogress(){return this._runtime.GetAssetManager().GetLoadProgress();},imageloadingprogress:function imageloadingprogress(){if(this._imagesLoadingTotal===0)return 1;return this._imagesLoadingComplete/this._imagesLoadingTotal;},renderer:function renderer(){if(this._runtime.GetWebGPURenderer())return"webgpu";else return"webgl";},rendererdetail:function rendererdetail(){if(this._runtime.GetWebGPURenderer())return this._runtime.GetWebGPURenderer().GetAdapterInfoString();else return this._runtime.GetWebGLRenderer().GetUnmaskedRenderer();},imagememoryusage:function imagememoryusage(){var ret=this._runtime.GetRenderer().GetEstimatedTextureMemoryUsage();return Math.round(100*ret/(1024*1024))/100;},rgb:function rgb(r,g,b){return _C191.PackRGB(r,g,b);},rgbex:function rgbex(r,g,b){return _C191.PackRGBEx(r/100,g/100,b/100);},rgba:function rgba(r,g,b,a){return _C191.PackRGBAEx(r/100,g/100,b/100,a/100);},rgbex255:function rgbex255(r,g,b){return _C191.PackRGBEx(r/255,g/255,b/255);},rgba255:function rgba255(r,g,b,a){return _C191.PackRGBAEx(r/255,g/255,b/255,a/255);},projectname:function projectname(){return this._runtime.GetProjectName();},projectversion:function projectversion(){return this._runtime.GetProjectVersion();},currenteventsheetname:function currenteventsheetname(){return this._runtime.GetCurrentEvent().GetEventSheet().GetName();},currenteventnumber:function currenteventnumber(){return this._runtime.GetCurrentEvent().GetDisplayNumber();}};};}{'use strict';{var _C192=self.C3;_C192.Plugins.Sprite=/*#__PURE__*/function(_C192$SDKPluginBase){_inherits(SpritePlugin,_C192$SDKPluginBase);function SpritePlugin(opts){_classCallCheck(this,SpritePlugin);return _possibleConstructorReturn(this,_getPrototypeOf(SpritePlugin).call(this,opts));}_createClass(SpritePlugin,[{key:"Release",value:function Release(){_get(_getPrototypeOf(SpritePlugin.prototype),"Release",this).call(this);}}]);return SpritePlugin;}(_C192.SDKPluginBase);}{var _C193=self.C3;var spawnPickStack=[];_C193.Plugins.Sprite.Type=/*#__PURE__*/function(_C193$SDKTypeBase){_inherits(SpriteType,_C193$SDKTypeBase);function SpriteType(objectClass){var _this175;_classCallCheck(this,SpriteType);_this175=_possibleConstructorReturn(this,_getPrototypeOf(SpriteType).call(this,objectClass));_this175._animations=objectClass.GetAnimations();return _this175;}_createClass(SpriteType,[{key:"Release",value:function Release(){_C193.clearArray(this._animations);_get(_getPrototypeOf(SpriteType.prototype),"Release",this).call(this);}},{key:"OnCreate",value:function OnCreate(){var _iteratorNormalCompletion574=true;var _didIteratorError574=false;var _iteratorError574=undefined;try{for(var _iterator574=this._animations[Symbol.iterator](),_step574;!(_iteratorNormalCompletion574=(_step574=_iterator574.next()).done);_iteratorNormalCompletion574=true){var _a12=_step574.value;_a12.LoadAllAssets(this._runtime);}}catch(err){_didIteratorError574=true;_iteratorError574=err;}finally{try{if(!_iteratorNormalCompletion574&&_iterator574["return"]!=null){_iterator574["return"]();}}finally{if(_didIteratorError574){throw _iteratorError574;}}}}},{key:"LoadTextures",value:function LoadTextures(renderer){var opts={sampling:this._runtime.GetSampling()};return Promise.all(this._animations.map(function(a){return a.LoadAllTextures(renderer,opts);}));}},{key:"ReleaseTextures",value:function ReleaseTextures(){var _iteratorNormalCompletion575=true;var _didIteratorError575=false;var _iteratorError575=undefined;try{for(var _iterator575=this._animations[Symbol.iterator](),_step575;!(_iteratorNormalCompletion575=(_step575=_iterator575.next()).done);_iteratorNormalCompletion575=true){var _a13=_step575.value;_a13.ReleaseAllTextures();}}catch(err){_didIteratorError575=true;_iteratorError575=err;}finally{try{if(!_iteratorNormalCompletion575&&_iterator575["return"]!=null){_iterator575["return"]();}}finally{if(_didIteratorError575){throw _iteratorError575;}}}}},{key:"OnDynamicTextureLoadComplete",value:function OnDynamicTextureLoadComplete(){this._UpdateAllCurrentTexture();}},{key:"_UpdateAllCurrentTexture",value:function _UpdateAllCurrentTexture(){var _iteratorNormalCompletion576=true;var _didIteratorError576=false;var _iteratorError576=undefined;try{for(var _iterator576=this._objectClass.instancesIncludingPendingCreate()[Symbol.iterator](),_step576;!(_iteratorNormalCompletion576=(_step576=_iterator576.next()).done);_iteratorNormalCompletion576=true){var inst=_step576.value;inst.GetSdkInstance()._UpdateCurrentTexture();}}catch(err){_didIteratorError576=true;_iteratorError576=err;}finally{try{if(!_iteratorNormalCompletion576&&_iterator576["return"]!=null){_iterator576["return"]();}}finally{if(_didIteratorError576){throw _iteratorError576;}}}}},{key:"FinishCondition",value:function FinishCondition(doPick){_C193.Plugins.Sprite.FinishCollisionCondition(this,doPick);}},{key:"BeforeRunAction",value:function BeforeRunAction(method){spawnPickStack.push({objectClass:null,createHierarchy:false,instances:[]});}},{key:"_SpawnPickInstance",value:function _SpawnPickInstance(objectClass,inst,createHierarchy){var entry=spawnPickStack.at(-1);entry.objectClass=objectClass;entry.createHierarchy=createHierarchy;entry.instances.push(inst);}},{key:"AfterRunAction",value:function AfterRunAction(method){var entry=spawnPickStack.pop();var objectClass=entry.objectClass;var createHierarchy=entry.createHierarchy;if(!objectClass)return;var pickMap=new Map();var _iteratorNormalCompletion577=true;var _didIteratorError577=false;var _iteratorError577=undefined;try{for(var _iterator577=entry.instances[Symbol.iterator](),_step577;!(_iteratorNormalCompletion577=(_step577=_iterator577.next()).done);_iteratorNormalCompletion577=true){var inst=_step577.value;inst.CollectInstancesToPick(pickMap,objectClass,createHierarchy);}}catch(err){_didIteratorError577=true;_iteratorError577=err;}finally{try{if(!_iteratorNormalCompletion577&&_iterator577["return"]!=null){_iterator577["return"]();}}finally{if(_didIteratorError577){throw _iteratorError577;}}}var _iteratorNormalCompletion578=true;var _didIteratorError578=false;var _iteratorError578=undefined;try{for(var _iterator578=pickMap[Symbol.iterator](),_step578;!(_iteratorNormalCompletion578=(_step578=_iterator578.next()).done);_iteratorNormalCompletion578=true){var _step578$value=_slicedToArray(_step578.value,2),pickObjectClass=_step578$value[0],instSet=_step578$value[1];pickObjectClass.GetCurrentSol().SetSetPicked(instSet);}}catch(err){_didIteratorError578=true;_iteratorError578=err;}finally{try{if(!_iteratorNormalCompletion578&&_iterator578["return"]!=null){_iterator578["return"]();}}finally{if(_didIteratorError578){throw _iteratorError578;}}}}}]);return SpriteType;}(_C193.SDKTypeBase);}{var _C194=self.C3;var _C3X19=self.C3X;var INITIALLY_VISIBLE=0;var INITIAL_ANIMATION=1;var INITIAL_FRAME=2;var ENABLE_COLLISIONS=3;var _tempRect12=_C194.New(_C194.Rect);var _tempQuad6=_C194.New(_C194.Quad);var _tempVec2=_C194.New(_C194.Vector2);var FLAG_PLAYING_FORWARDS=1<<0;var FLAG_ANIMATION_PLAYING=1<<1;var FLAG_ANIMATION_TRIGGER=1<<2;_C194.Plugins.Sprite.Instance=/*#__PURE__*/function(_C194$SDKWorldInstanc){_inherits(SpriteInstance,_C194$SDKWorldInstanc);function SpriteInstance(inst,properties){var _this176;_classCallCheck(this,SpriteInstance);_this176=_possibleConstructorReturn(this,_getPrototypeOf(SpriteInstance).call(this,inst));var initiallyVisible=true;var initialAnimation="";var initialFrame=0;var collisionEnabled=true;if(properties){initiallyVisible=!!properties[INITIALLY_VISIBLE];initialAnimation=properties[INITIAL_ANIMATION];initialFrame=properties[INITIAL_FRAME];collisionEnabled=properties[ENABLE_COLLISIONS];}_this176._currentAnimation=_this176._objectClass.GetAnimationByName(initialAnimation)||_this176._objectClass.GetAnimations()[0];_this176._currentFrameIndex=_C194.clamp(initialFrame,0,_this176._currentAnimation.GetFrameCount()-1);_this176._currentAnimationFrame=_this176._currentAnimation.GetFrameAt(_this176._currentFrameIndex);var initialImageInfo=_this176._currentAnimationFrame.GetImageInfo();_this176._currentTexture=initialImageInfo.GetTexture();_this176._currentRcTex=initialImageInfo.GetTexRect();_this176._currentQuadTex=initialImageInfo.GetTexQuad();_this176.HandleRendererContextLoss();inst.SetFlag(FLAG_ANIMATION_PLAYING,true);inst.SetFlag(FLAG_PLAYING_FORWARDS,_this176._currentAnimation.GetSpeed()>=0);_this176._currentAnimationSpeed=Math.abs(_this176._currentAnimation.GetSpeed());_this176._currentAnimationRepeatTo=_this176._currentAnimation.GetRepeatTo();_this176._animationTimer=_C194.New(_C194.KahanSum);_this176._frameStartTime=0;_this176._animationRepeats=0;_this176._animTriggerName="";_this176._changeAnimFrameIndex=-1;_this176._changeAnimationName="";_this176._changeAnimationFrom=0;var wi=_this176.GetWorldInfo();_this176._bquadRef=wi.GetBoundingQuad();wi.SetVisible(initiallyVisible);wi.SetCollisionEnabled(collisionEnabled);wi.SetOriginX(_this176._currentAnimationFrame.GetOriginX());wi.SetOriginY(_this176._currentAnimationFrame.GetOriginY());wi.SetSourceCollisionPoly(_this176._currentAnimationFrame.GetCollisionPoly());wi.SetBboxChanged();if((_this176._objectClass.GetAnimationCount()!==1||_this176._objectClass.GetAnimations()[0].GetFrameCount()!==1)&&_this176._currentAnimationSpeed!==0)_this176._StartTicking();return _this176;}_createClass(SpriteInstance,[{key:"Release",value:function Release(){this._currentAnimation=null;this._currentAnimationFrame=null;this._currentTexture=null;this._animationTimer=null;_get(_getPrototypeOf(SpriteInstance.prototype),"Release",this).call(this);}},{key:"GetCurrentImageInfo",value:function GetCurrentImageInfo(){return this._currentAnimationFrame.GetImageInfo();}},{key:"IsOriginalSizeKnown",value:function IsOriginalSizeKnown(){return true;}},{key:"OnRendererContextLost",value:function OnRendererContextLost(){this._currentTexture=null;}},{key:"OnRendererContextRestored",value:function OnRendererContextRestored(){this._UpdateCurrentTexture();}},{key:"Draw",value:function Draw(renderer){var texture=this._currentTexture;if(texture===null)return;renderer.SetTexture(texture);var wi=this.GetWorldInfo();if(wi.HasMesh())this._DrawMesh(wi,renderer);else this._DrawStandard(wi,renderer);}},{key:"_DrawStandard",value:function _DrawStandard(wi,renderer){var quad=this._bquadRef;if(this._runtime.IsPixelRoundingEnabled())quad=wi.PixelRoundQuad(quad);renderer.Quad4(quad,this._currentQuadTex);}},{key:"_DrawMesh",value:function _DrawMesh(wi,renderer){var transformedMesh=wi.GetTransformedMesh();if(wi.IsMeshChanged()){wi.CalculateBbox(_tempRect12,_tempQuad6,false);var quad=_tempQuad6;if(this._runtime.IsPixelRoundingEnabled())quad=wi.PixelRoundQuad(quad);transformedMesh.CalculateTransformedMesh(wi.GetSourceMesh(),quad,this._currentQuadTex);wi.SetMeshChanged(false);}transformedMesh.Draw(renderer);}},{key:"GetAnimationTime",value:function GetAnimationTime(){return this._animationTimer.Get();}},{key:"IsAnimationPlaying",value:function IsAnimationPlaying(){return this._inst.GetFlag(FLAG_ANIMATION_PLAYING);}},{key:"SetAnimationPlaying",value:function SetAnimationPlaying(e){this._inst.SetFlag(FLAG_ANIMATION_PLAYING,e);}},{key:"IsPlayingForwards",value:function IsPlayingForwards(){return this._inst.GetFlag(FLAG_PLAYING_FORWARDS);}},{key:"SetPlayingForwards",value:function SetPlayingForwards(e){this._inst.SetFlag(FLAG_PLAYING_FORWARDS,e);}},{key:"IsInAnimationTrigger",value:function IsInAnimationTrigger(){return this._inst.GetFlag(FLAG_ANIMATION_TRIGGER);}},{key:"SetInAnimationTrigger",value:function SetInAnimationTrigger(e){this._inst.SetFlag(FLAG_ANIMATION_TRIGGER,e);}},{key:"Tick",value:function Tick(){if(this._changeAnimationName)this._DoChangeAnimation();if(this._changeAnimFrameIndex>=0)this._DoChangeAnimFrame();var currentAnimationSpeed=this._currentAnimationSpeed;if(!this.IsAnimationPlaying()||currentAnimationSpeed===0){this._StopTicking();return;}var dt=this._runtime.GetDt(this._inst);this._animationTimer.Add(dt);var now=this.GetAnimationTime();var prevFrame=this._currentAnimationFrame;var currentFrameTime=prevFrame.GetDuration()/currentAnimationSpeed;if(now<this._frameStartTime+currentFrameTime)return;var currentAnimation=this._currentAnimation;var repeatTo=this._currentAnimationRepeatTo;var frameCount=currentAnimation.GetFrameCount();var repeatCount=currentAnimation.GetRepeatCount();var isLooping=currentAnimation.IsLooping();var isPingPong=currentAnimation.IsPingPong();if(this.IsPlayingForwards())this._currentFrameIndex++;else this._currentFrameIndex--;this._frameStartTime+=currentFrameTime;if(this._currentFrameIndex>=frameCount)if(isPingPong){this.SetPlayingForwards(false);this._currentFrameIndex=frameCount-2;}else if(isLooping)this._currentFrameIndex=repeatTo;else{this._animationRepeats++;if(this._animationRepeats>=repeatCount)this._FinishAnimation(false);else this._currentFrameIndex=repeatTo;}if(this._currentFrameIndex<0)if(isPingPong){this._currentFrameIndex=1;this.SetPlayingForwards(true);if(!isLooping){this._animationRepeats++;if(this._animationRepeats>=repeatCount)this._FinishAnimation(true);}}else if(isLooping)this._currentFrameIndex=repeatTo;else{this._animationRepeats++;if(this._animationRepeats>=repeatCount)this._FinishAnimation(true);else this._currentFrameIndex=repeatTo;}this._currentFrameIndex=_C194.clamp(this._currentFrameIndex,0,frameCount-1);var nextFrame=currentAnimation.GetFrameAt(this._currentFrameIndex);if(now>this._frameStartTime+nextFrame.GetDuration()/currentAnimationSpeed)this._frameStartTime=now;this._OnFrameChanged(prevFrame,nextFrame);}},{key:"_FinishAnimation",value:function _FinishAnimation(reverse){this._currentFrameIndex=reverse?0:this._currentAnimation.GetFrameCount()-1;this.SetAnimationPlaying(false);this._animTriggerName=this._currentAnimation.GetName();this.SetInAnimationTrigger(true);this.DispatchScriptEvent("animationend",false,{animationName:this._animTriggerName});this.Trigger(_C194.Plugins.Sprite.Cnds.OnAnyAnimFinished);this.Trigger(_C194.Plugins.Sprite.Cnds.OnAnimFinished);this.SetInAnimationTrigger(false);this._animationRepeats=0;}},{key:"_OnFrameChanged",value:function _OnFrameChanged(prevFrame,nextFrame,opts){if(prevFrame===nextFrame)return;var wi=this.GetWorldInfo();var prevImage=prevFrame.GetImageInfo();var nextImage=nextFrame.GetImageInfo();var oldW=prevImage.GetWidth();var oldH=prevImage.GetHeight();var newW=nextImage.GetWidth();var newH=nextImage.GetHeight();if(opts&&opts.onFrameChange)opts.onFrameChange(wi,oldW,oldH,newW,newH);else{if(oldW!==newW)wi.SetWidth(wi.GetWidth()*(newW/oldW));if(oldH!==newH)wi.SetHeight(wi.GetHeight()*(newH/oldH));}wi.SetOriginX(nextFrame.GetOriginX());wi.SetOriginY(nextFrame.GetOriginY());wi.SetSourceCollisionPoly(nextFrame.GetCollisionPoly());wi.SetBboxChanged();this._currentAnimationFrame=nextFrame;this._currentTexture=nextImage.GetTexture();this._currentRcTex=nextImage.GetTexRect();this._currentQuadTex=nextImage.GetTexQuad();var behaviorInstances=this.GetInstance().GetBehaviorInstances();for(var i=0,len=behaviorInstances.length;i<len;++i){behaviorInstances[i].OnSpriteFrameChanged(prevFrame,nextFrame);}this.DispatchScriptEvent("framechange",false,{animationName:this._currentAnimation.GetName(),animationFrame:this._currentFrameIndex});this.Trigger(_C194.Plugins.Sprite.Cnds.OnFrameChanged);this._runtime.UpdateRender();}},{key:"_StartAnim",value:function _StartAnim(from){this.SetAnimationPlaying(true);this._frameStartTime=this.GetAnimationTime();if(from===1&&this._currentFrameIndex!==0){this._changeAnimFrameIndex=0;if(!this.IsInAnimationTrigger())this._DoChangeAnimFrame();}this._StartTicking();}},{key:"_SetAnim",value:function _SetAnim(animName,from){this._changeAnimationName=animName;this._changeAnimationFrom=from;this._StartTicking();if(!this.IsInAnimationTrigger())this._DoChangeAnimation();}},{key:"_GetCurrentAnimation",value:function _GetCurrentAnimation(){return this._currentAnimation;}},{key:"_GetCurrentAnimationName",value:function _GetCurrentAnimationName(){if(this._changeAnimationName)return this._changeAnimationName;else return this._currentAnimation.GetName();}},{key:"_SetAnimFrame",value:function _SetAnimFrame(frameNum){if(typeof frameNum==="string"){var animation=this._objectClass.GetAnimationByName(this._GetCurrentAnimationName());if(!animation)return;frameNum=animation.GetFrameIndexByTag(frameNum);if(frameNum===-1)return;}if(!isFinite(frameNum))return;this._changeAnimFrameIndex=frameNum;if(!this.IsInAnimationTrigger())this._DoChangeAnimFrame();}},{key:"_GetAnimFrame",value:function _GetAnimFrame(){return this._currentFrameIndex;}},{key:"_GetAnimFrameTag",value:function _GetAnimFrameTag(){return this._currentAnimationFrame.GetTag();}},{key:"_SetAnimSpeed",value:function _SetAnimSpeed(s){this._currentAnimationSpeed=Math.abs(s);this.SetPlayingForwards(s>=0);if(this._currentAnimationSpeed>0)this._StartTicking();}},{key:"_GetAnimSpeed",value:function _GetAnimSpeed(){return this.IsPlayingForwards()?this._currentAnimationSpeed:-this._currentAnimationSpeed;}},{key:"_SetAnimRepeatToFrame",value:function _SetAnimRepeatToFrame(f){f=_C194.clamp(Math.floor(f),0,this._currentAnimation.GetFrameCount()-1);this._currentAnimationRepeatTo=f;}},{key:"_GetAnimRepeatToFrame",value:function _GetAnimRepeatToFrame(){return this._currentAnimationRepeatTo;}},{key:"_DoChangeAnimation",value:function _DoChangeAnimation(opts){var prevFrame=this._currentAnimationFrame;var animation=this._objectClass.GetAnimationByName(this._changeAnimationName);this._changeAnimationName="";if(!animation)return;if(animation===this._currentAnimation&&this.IsAnimationPlaying())return;this._currentAnimation=animation;this.SetPlayingForwards(animation.GetSpeed()>=0);this._currentAnimationSpeed=Math.abs(animation.GetSpeed());this._currentAnimationRepeatTo=animation.GetRepeatTo();this._currentFrameIndex=_C194.clamp(this._currentFrameIndex,0,this._currentAnimation.GetFrameCount()-1);if(this._changeAnimationFrom===1)this._currentFrameIndex=0;this.SetAnimationPlaying(true);this._frameStartTime=this.GetAnimationTime();var nextFrame=this._currentAnimation.GetFrameAt(this._currentFrameIndex);this._OnFrameChanged(prevFrame,nextFrame,opts);}},{key:"_DoChangeAnimFrame",value:function _DoChangeAnimFrame(){var prevFrame=this._currentAnimationFrame;var prevFrameIndex=this._currentFrameIndex;this._currentFrameIndex=_C194.clamp(Math.floor(this._changeAnimFrameIndex),0,this._currentAnimation.GetFrameCount()-1);this._changeAnimFrameIndex=-1;if(prevFrameIndex===this._currentFrameIndex)return;var nextFrame=this._currentAnimation.GetFrameAt(this._currentFrameIndex);this._OnFrameChanged(prevFrame,nextFrame);this._frameStartTime=this.GetAnimationTime();}},{key:"_UpdateCurrentTexture",value:function _UpdateCurrentTexture(){var curImageInfo=this._currentAnimationFrame.GetImageInfo();this._currentTexture=curImageInfo.GetTexture();this._currentRcTex=curImageInfo.GetTexRect();this._currentQuadTex=curImageInfo.GetTexQuad();this.GetWorldInfo().SetMeshChanged(true);}},{key:"GetTexture",value:function GetTexture(){return this._currentTexture;}},{key:"GetTexRect",value:function GetTexRect(){return this._currentRcTex;}},{key:"GetTexQuad",value:function GetTexQuad(){return this._currentQuadTex;}},{key:"GetImagePointCount",value:function GetImagePointCount(){return this._currentAnimationFrame.GetImagePointCount();}},{key:"GetImagePoint",value:function GetImagePoint(nameOrIndex){var frame=this._currentAnimationFrame;var wi=this.GetWorldInfo();var ip=null;if(typeof nameOrIndex==="string")ip=frame.GetImagePointByName(nameOrIndex);else if(typeof nameOrIndex==="number")ip=frame.GetImagePointByIndex(nameOrIndex-1);else throw new TypeError("expected string or number");var ptZ=wi.GetTotalZElevation();if(!ip)return[wi.GetX(),wi.GetY(),ptZ];_tempVec2.copy(ip.GetVec2());if(wi.HasMesh()){var _wi$GetSourceMesh$Tra=wi.GetSourceMesh().TransformPoint(_tempVec2.getX(),_tempVec2.getY()),_wi$GetSourceMesh$Tra2=_slicedToArray(_wi$GetSourceMesh$Tra,3),tx=_wi$GetSourceMesh$Tra2[0],ty=_wi$GetSourceMesh$Tra2[1],tz=_wi$GetSourceMesh$Tra2[2];_tempVec2.set(tx,ty);ptZ+=tz;}_tempVec2.offset(-frame.GetOriginX(),-frame.GetOriginY());_tempVec2.scale(wi.GetWidth(),wi.GetHeight());_tempVec2.rotate(wi.GetAngle());_tempVec2.offset(wi.GetX(),wi.GetY());return[_tempVec2.getX(),_tempVec2.getY(),ptZ];}},{key:"GetCollisionPolyPointCount",value:function GetCollisionPolyPointCount(){return this.GetWorldInfo().GetTransformedCollisionPoly().pointCount();}},{key:"GetCollisionPolyPoint",value:function GetCollisionPolyPoint(index){index=Math.floor(index);var wi=this.GetWorldInfo();var poly=wi.GetTransformedCollisionPoly();var pointCount=poly.pointCount();if(index===pointCount)index=0;if(index<0||index>=pointCount)return[0,0];var pointsArr=poly.pointsArr();return[pointsArr[index*2+0]+wi.GetX(),pointsArr[index*2+1]+wi.GetY()];}},{key:"GetDebuggerProperties",value:function GetDebuggerProperties(){var _this177=this;var Acts=_C194.Plugins.Sprite.Acts;var prefix="plugins.sprite.debugger.animation-properties";return[{title:prefix+".title",properties:[{name:prefix+".current-animation",value:this._currentAnimation.GetName(),onedit:function onedit(v){return _this177.CallAction(Acts.SetAnim,v,0);}},{name:prefix+".current-frame",value:this._currentFrameIndex,onedit:function onedit(v){return _this177.CallAction(Acts.SetAnimFrame,v);}},{name:prefix+".is-playing",value:this.IsAnimationPlaying(),onedit:function onedit(v){return v?_this177.CallAction(Acts.StartAnim,0):_this177.CallAction(Acts.StopAnim);}},{name:prefix+".speed",value:this._currentAnimationSpeed,onedit:function onedit(v){return _this177.CallAction(Acts.SetAnimSpeed,v);}},{name:prefix+".repeats",value:this._animationRepeats,onedit:function onedit(v){return _this177._animationRepeats=v;}}]}];}},{key:"SaveToJson",value:function SaveToJson(){var o={"a":this._currentAnimation.GetSID()};if(this._frameStartTime!==0)o["fs"]=this._frameStartTime;var animTime=this.GetAnimationTime();if(animTime!==0)o["at"]=animTime;if(this._currentFrameIndex!==0)o["f"]=this._currentFrameIndex;if(this._currentAnimationSpeed!==0)o["cas"]=this._currentAnimationSpeed;if(this._animationRepeats!==1)o["ar"]=this._animationRepeats;if(this._currentAnimationRepeatTo!==0)o["rt"]=this._currentAnimationRepeatTo;if(!this.IsAnimationPlaying())o["ap"]=this.IsAnimationPlaying();if(!this.IsPlayingForwards())o["af"]=this.IsPlayingForwards();var wi=this.GetWorldInfo();if(wi.IsCollisionEnabled())o["ce"]=wi.IsCollisionEnabled();return o;}},{key:"LoadFromJson",value:function LoadFromJson(o){var anim=this.GetObjectClass().GetAnimationBySID(o["a"]);if(anim)this._currentAnimation=anim;this._frameStartTime=o.hasOwnProperty("fs")?o["fs"]:0;this._animationTimer.Set(o.hasOwnProperty("at")?o["at"]:0);var frameIndex=o.hasOwnProperty("f")?o["f"]:0;this._currentFrameIndex=_C194.clamp(frameIndex,0,this._currentAnimation.GetFrameCount()-1);this._currentAnimationSpeed=o.hasOwnProperty("cas")?o["cas"]:0;this._animationRepeats=o.hasOwnProperty("ar")?o["ar"]:1;var repeatToIndex=o.hasOwnProperty("rt")?o["rt"]:0;this._currentAnimationRepeatTo=_C194.clamp(repeatToIndex,0,this._currentAnimation.GetFrameCount()-1);this.SetAnimationPlaying(o.hasOwnProperty("ap")?!!o["ap"]:true);this.SetPlayingForwards(o.hasOwnProperty("af")?!!o["af"]:true);var nextFrame=this._currentAnimation.GetFrameAt(this._currentFrameIndex);this._currentAnimationFrame=nextFrame;this._UpdateCurrentTexture();var wi=this.GetWorldInfo();wi.SetOriginX(nextFrame.GetOriginX());wi.SetOriginY(nextFrame.GetOriginY());wi.SetSourceCollisionPoly(nextFrame.GetCollisionPoly());wi.SetCollisionEnabled(!!o["ce"]);if(this.IsAnimationPlaying())this._StartTicking();}},{key:"GetPropertyValueByIndex",value:function GetPropertyValueByIndex(index){var wi=this.GetWorldInfo();switch(index){case ENABLE_COLLISIONS:return wi.IsCollisionEnabled();case INITIAL_FRAME:return _C194.clamp(this._currentFrameIndex,0,this._currentAnimation.GetFrameCount()-1);case INITIAL_ANIMATION:return this._currentAnimation.GetName();}}},{key:"SetPropertyValueByIndex",value:function SetPropertyValueByIndex(index,value,opts){var wi=this.GetWorldInfo();switch(index){case ENABLE_COLLISIONS:{wi.SetCollisionEnabled(!!value);break;}case INITIAL_FRAME:{this.SetAnimationPlaying(false);var totalFrames=this._currentAnimation.GetFrameCount()-1;var nextIndex=value=_C194.clamp(value,0,totalFrames);var prevFrame=this._currentAnimation.GetFrameAt(this._currentFrameIndex);var nextFrame=this._currentAnimation.GetFrameAt(nextIndex);this._OnFrameChanged(prevFrame,nextFrame,opts);this._currentFrameIndex=_C194.clamp(nextIndex,0,totalFrames);break;}case INITIAL_ANIMATION:{this._changeAnimationName=value;this._DoChangeAnimation(opts);var _totalFrames=this._currentAnimation.GetFrameCount();if(_totalFrames>1&&this._currentAnimation.GetSpeed()>0)this._StartTicking();else this._StopTicking();break;}}}},{key:"GetScriptInterfaceClass",value:function GetScriptInterfaceClass(){return self.ISpriteInstance;}}]);return SpriteInstance;}(_C194.SDKWorldInstanceBase);var _map15=new WeakMap();var ANIM_FROM_MODES=new Map([["current-frame",0],["beginning",1]]);self.ISpriteInstance=/*#__PURE__*/function(_self$IWorldInstance2){_inherits(ISpriteInstance,_self$IWorldInstance2);function ISpriteInstance(){var _this178;_classCallCheck(this,ISpriteInstance);_this178=_possibleConstructorReturn(this,_getPrototypeOf(ISpriteInstance).call(this));_map15.set(_assertThisInitialized(_this178),self.IInstance._GetInitInst().GetSdkInstance());return _this178;}_createClass(ISpriteInstance,[{key:"getImagePointCount",value:function getImagePointCount(){return _map15.get(this).GetImagePointCount();}},{key:"getImagePointX",value:function getImagePointX(nameOrIndex){return this.getImagePoint(nameOrIndex)[0];}},{key:"getImagePointY",value:function getImagePointY(nameOrIndex){return this.getImagePoint(nameOrIndex)[1];}},{key:"getImagePointZ",value:function getImagePointZ(nameOrIndex){return this.getImagePoint(nameOrIndex)[2];}},{key:"getImagePoint",value:function getImagePoint(nameOrIndex){if(typeof nameOrIndex!=="string"&&typeof nameOrIndex!=="number")throw new TypeError("expected string or number");return _map15.get(this).GetImagePoint(nameOrIndex);}},{key:"getPolyPointCount",value:function getPolyPointCount(){return _map15.get(this).GetCollisionPolyPointCount();}},{key:"getPolyPointX",value:function getPolyPointX(index){_C3X19.RequireFiniteNumber(index);return _map15.get(this).GetCollisionPolyPoint(index)[0];}},{key:"getPolyPointY",value:function getPolyPointY(index){_C3X19.RequireFiniteNumber(index);return _map15.get(this).GetCollisionPolyPoint(index)[1];}},{key:"getPolyPoint",value:function getPolyPoint(index){_C3X19.RequireFiniteNumber(index);return _map15.get(this).GetCollisionPolyPoint(index);}},{key:"stopAnimation",value:function stopAnimation(){_map15.get(this).SetAnimationPlaying(false);}},{key:"startAnimation",value:function startAnimation(){var from=arguments.length>0&&arguments[0]!==undefined?arguments[0]:"current-frame";_C3X19.RequireString(from);var f=ANIM_FROM_MODES.get(from);if(typeof f==="undefined")throw new Error("invalid mode");_map15.get(this)._StartAnim(f);}},{key:"setAnimation",value:function setAnimation(name){var from=arguments.length>1&&arguments[1]!==undefined?arguments[1]:"beginning";_C3X19.RequireString(name);_C3X19.RequireString(from);var f=ANIM_FROM_MODES.get(from);if(typeof f==="undefined")throw new Error("invalid mode");var inst=_map15.get(this);if(!inst.GetObjectClass().GetAnimationByName(name))throw new Error("animation name \"".concat(name,"\" does not exist"));inst._SetAnim(name,f);}},{key:"getAnimation",value:function getAnimation(name){_C3X19.RequireString(name);var a=_map15.get(this).GetObjectClass().GetAnimationByName(name);return a?a.GetIAnimation():null;}},{key:"getImageSize",value:function getImageSize(){var imageInfo=_map15.get(this).GetCurrentImageInfo();return[imageInfo.GetWidth(),imageInfo.GetHeight()];}},{key:"replaceCurrentAnimationFrame",value:function replaceCurrentAnimationFrame(blob){var sdkInst,runtime,curImageInfo,imageInfo,sdkType;return regeneratorRuntime.async(function replaceCurrentAnimationFrame$(_context230){while(1){switch(_context230.prev=_context230.next){case 0:_C3X19.RequireInstanceOf(blob,Blob);sdkInst=_map15.get(this);runtime=sdkInst.GetRuntime();curImageInfo=sdkInst.GetCurrentImageInfo();imageInfo=_C194.New(_C194.ImageInfo);imageInfo.LoadDynamicBlobAsset(runtime,blob);_context230.next=8;return regeneratorRuntime.awrap(imageInfo.LoadStaticTexture(runtime.GetRenderer(),{sampling:runtime.GetSampling()}));case 8:if(!sdkInst.WasReleased()){_context230.next=11;break;}imageInfo.Release();return _context230.abrupt("return");case 11:curImageInfo.ReplaceWith(imageInfo);sdkType=sdkInst.GetSdkType();sdkType._UpdateAllCurrentTexture();sdkType.GetObjectClass().Dispatcher().dispatchEvent(new _C194.Event("animationframeimagechange"));runtime.UpdateRender();case 16:case"end":return _context230.stop();}}},null,this);}},{key:"setSolidCollisionFilter",value:function setSolidCollisionFilter(isInclusive,tags){_C3X19.RequireString(tags);_map15.get(this).GetWorldInfo().SetSolidCollisionFilter(!!isInclusive,tags);}},{key:"animation",get:function get(){return _map15.get(this)._GetCurrentAnimation().GetIAnimation();}},{key:"animationName",get:function get(){return _map15.get(this)._GetCurrentAnimationName();}},{key:"animationFrame",set:function set(frameIndex){_C3X19.RequireFiniteNumber(frameIndex);_map15.get(this)._SetAnimFrame(frameIndex);},get:function get(){return _map15.get(this)._GetAnimFrame();}},{key:"animationFrameTag",set:function set(frameTag){_C3X19.RequireString(frameTag);_map15.get(this)._SetAnimFrame(frameTag);},get:function get(){return _map15.get(this)._GetAnimFrameTag();}},{key:"animationSpeed",set:function set(s){_C3X19.RequireFiniteNumber(s);_map15.get(this)._SetAnimSpeed(s);},get:function get(){return _map15.get(this)._GetAnimSpeed();}},{key:"animationRepeatToFrame",set:function set(f){_C3X19.RequireFiniteNumber(f);_map15.get(this)._SetAnimRepeatToFrame(f);},get:function get(){return _map15.get(this)._GetAnimRepeatToFrame();}},{key:"imageWidth",get:function get(){return _map15.get(this).GetCurrentImageInfo().GetWidth();}},{key:"imageHeight",get:function get(){return _map15.get(this).GetCurrentImageInfo().GetHeight();}}]);return ISpriteInstance;}(self.IWorldInstance);}{var _C195=self.C3;_C195.Plugins.Sprite.Cnds={IsAnimPlaying:function IsAnimPlaying(animName){return _C195.equalsNoCase(this._GetCurrentAnimationName(),animName);},CompareFrame:function CompareFrame(cmp,frameNum){return _C195.compare(this._currentFrameIndex,cmp,frameNum);},CompareFrameTag:function CompareFrameTag(cmp,frameTag){var selfTag=this._currentAnimationFrame.GetTag();return _C195.compare(selfTag.toLowerCase(),cmp,frameTag.toLowerCase());},CompareAnimSpeed:function CompareAnimSpeed(cmp,x){return _C195.compare(this._GetAnimSpeed(),cmp,x);},OnAnimFinished:function OnAnimFinished(animName){return _C195.equalsNoCase(this._animTriggerName,animName);},OnAnyAnimFinished:function OnAnyAnimFinished(){return true;},OnFrameChanged:function OnFrameChanged(){return true;},IsMirrored:function IsMirrored(){return this.GetWorldInfo().GetWidth()<0;},IsFlipped:function IsFlipped(){return this.GetWorldInfo().GetHeight()<0;},OnURLLoaded:function OnURLLoaded(){return true;},OnURLFailed:function OnURLFailed(){return true;},IsCollisionEnabled:function IsCollisionEnabled(){return this.GetWorldInfo().IsCollisionEnabled();}};}{var _C196=self.C3;_C196.Plugins.Sprite.Acts={Spawn:function Spawn(objectClass,layer,imgPt,createHierarchy){if(!objectClass||!layer)return;var _this$GetImagePoint=this.GetImagePoint(imgPt),_this$GetImagePoint2=_slicedToArray(_this$GetImagePoint,2),imgPtX=_this$GetImagePoint2[0],imgPtY=_this$GetImagePoint2[1];var inst=this._runtime.CreateInstance(objectClass,layer,imgPtX,imgPtY,createHierarchy);if(!inst)return;if(createHierarchy)layer.SortAndAddInstancesByZIndex(inst);if(objectClass.GetPlugin().IsRotatable()){var instWi=inst.GetWorldInfo();instWi.SetAngle(this.GetWorldInfo().GetAngle());instWi.SetBboxChanged();}var eventSheetManager=this._runtime.GetEventSheetManager();eventSheetManager.BlockFlushingInstances(true);inst._TriggerOnCreatedOnSelfAndRelated();eventSheetManager.BlockFlushingInstances(false);if(objectClass!==this._runtime.GetCurrentAction().GetObjectClass())this._sdkType._SpawnPickInstance(objectClass,inst,createHierarchy);},StopAnim:function StopAnim(){this.SetAnimationPlaying(false);},StartAnim:function StartAnim(from){this._StartAnim(from);},SetAnim:function SetAnim(animName,from){this._SetAnim(animName,from);},SetAnimFrame:function SetAnimFrame(frameNum){this._SetAnimFrame(frameNum);},SetAnimSpeed:function SetAnimSpeed(s){this._SetAnimSpeed(s);},SetAnimRepeatToFrame:function SetAnimRepeatToFrame(f){this._SetAnimRepeatToFrame(f);},SetMirrored:function SetMirrored(m){var wi=this.GetWorldInfo();var oldW=wi.GetWidth();var newW=Math.abs(oldW)*(m===0?-1:1);if(oldW===newW)return;wi.SetWidth(newW);wi.SetBboxChanged();},SetFlipped:function SetFlipped(f){var wi=this.GetWorldInfo();var oldH=wi.GetHeight();var newH=Math.abs(oldH)*(f===0?-1:1);if(oldH===newH)return;wi.SetHeight(newH);wi.SetBboxChanged();},SetScale:function SetScale(s){var frame=this._currentAnimationFrame;var imageInfo=frame.GetImageInfo();var wi=this.GetWorldInfo();var mirrorFactor=wi.GetWidth()<0?-1:1;var flipFactor=wi.GetHeight()<0?-1:1;var newWidth=imageInfo.GetWidth()*s*mirrorFactor;var newHeight=imageInfo.GetHeight()*s*flipFactor;if(wi.GetWidth()!==newWidth||wi.GetHeight()!==newHeight){wi.SetSize(newWidth,newHeight);wi.SetBboxChanged();}},LoadURL:function LoadURL(url,resize,crossOrigin){var curAnimFrame,curImageInfo,wi,runtime,sdkType,imageInfo;return regeneratorRuntime.async(function LoadURL$(_context231){while(1){switch(_context231.prev=_context231.next){case 0:curAnimFrame=this._currentAnimationFrame;curImageInfo=curAnimFrame.GetImageInfo();wi=this.GetWorldInfo();runtime=this._runtime;sdkType=this._sdkType;if(!(curImageInfo.GetURL()===url)){_context231.next=9;break;}if(resize===0){wi.SetSize(curImageInfo.GetWidth(),curImageInfo.GetHeight());wi.SetBboxChanged();}this.Trigger(_C196.Plugins.Sprite.Cnds.OnURLLoaded);return _context231.abrupt("return");case 9:imageInfo=_C196.New(_C196.ImageInfo);_context231.prev=10;_context231.next=13;return regeneratorRuntime.awrap(imageInfo.LoadDynamicAsset(runtime,url));case 13:if(imageInfo.IsLoaded()){_context231.next=15;break;}throw new Error("image failed to load");case 15:if(!this.WasReleased()){_context231.next=18;break;}imageInfo.Release();return _context231.abrupt("return");case 18:_context231.next=20;return regeneratorRuntime.awrap(imageInfo.LoadStaticTexture(runtime.GetRenderer(),{sampling:runtime.GetSampling()}));case 20:_context231.next=27;break;case 22:_context231.prev=22;_context231.t0=_context231["catch"](10);console.error("Load image from URL failed: ",_context231.t0);if(!this.WasReleased())this.Trigger(_C196.Plugins.Sprite.Cnds.OnURLFailed);return _context231.abrupt("return");case 27:if(!this.WasReleased()){_context231.next=30;break;}imageInfo.Release();return _context231.abrupt("return");case 30:curImageInfo.ReplaceWith(imageInfo);sdkType._UpdateAllCurrentTexture();sdkType.GetObjectClass().Dispatcher().dispatchEvent(new _C196.Event("animationframeimagechange"));runtime.UpdateRender();if(resize===0){wi.SetSize(curImageInfo.GetWidth(),curImageInfo.GetHeight());wi.SetBboxChanged();}_context231.next=37;return regeneratorRuntime.awrap(this.TriggerAsync(_C196.Plugins.Sprite.Cnds.OnURLLoaded));case 37:case"end":return _context231.stop();}}},null,this,[[10,22]]);},SetCollisions:function SetCollisions(e){this.GetWorldInfo().SetCollisionEnabled(e);},SetSolidCollisionFilter:function SetSolidCollisionFilter(mode,tags){this.GetWorldInfo().SetSolidCollisionFilter(mode===0,tags);},SetEffect:function SetEffect(effect){this.GetWorldInfo().SetBlendMode(effect);this._runtime.UpdateRender();}};}{var _C197=self.C3;_C197.Plugins.Sprite.Exps={AnimationFrame:function AnimationFrame(){return this._GetAnimFrame();},AnimationFrameTag:function AnimationFrameTag(){return this._GetAnimFrameTag();},AnimationFrameCount:function AnimationFrameCount(){return this._currentAnimation.GetFrameCount();},AnimationName:function AnimationName(){return this._currentAnimation.GetName();},AnimationSpeed:function AnimationSpeed(){return this._GetAnimSpeed();},OriginalAnimationSpeed:function OriginalAnimationSpeed(){return this._currentAnimation.GetSpeed();},ImagePointX:function ImagePointX(imgpt){return this.GetImagePoint(imgpt)[0];},ImagePointY:function ImagePointY(imgpt){return this.GetImagePoint(imgpt)[1];},ImagePointZ:function ImagePointZ(imgpt){return this.GetImagePoint(imgpt)[2];},ImagePointCount:function ImagePointCount(){return this.GetImagePointCount();},ImageWidth:function ImageWidth(){return this.GetCurrentImageInfo().GetWidth();},ImageHeight:function ImageHeight(){return this.GetCurrentImageInfo().GetHeight();},PolyPointXAt:function PolyPointXAt(i){return this.GetCollisionPolyPoint(i)[0];},PolyPointYAt:function PolyPointYAt(i){return this.GetCollisionPolyPoint(i)[1];},PolyPointCount:function PolyPointCount(){return this.GetCollisionPolyPointCount();}};};}{'use strict';{var _C198=self.C3;_C198.Plugins.Keyboard=/*#__PURE__*/function(_C198$SDKPluginBase){_inherits(KeyboardPlugin,_C198$SDKPluginBase);function KeyboardPlugin(opts){_classCallCheck(this,KeyboardPlugin);return _possibleConstructorReturn(this,_getPrototypeOf(KeyboardPlugin).call(this,opts));}_createClass(KeyboardPlugin,[{key:"Release",value:function Release(){_get(_getPrototypeOf(KeyboardPlugin.prototype),"Release",this).call(this);}}]);return KeyboardPlugin;}(_C198.SDKPluginBase);}{var GetKeyboardSdkInstance=function GetKeyboardSdkInstance(){return keyboardObjectType.GetSingleGlobalInstance().GetSdkInstance();};var _C199=self.C3;var _C3X20=self.C3X;_C199.Plugins.Keyboard.Type=/*#__PURE__*/function(_C199$SDKTypeBase){_inherits(KeyboardType,_C199$SDKTypeBase);function KeyboardType(objectClass){_classCallCheck(this,KeyboardType);return _possibleConstructorReturn(this,_getPrototypeOf(KeyboardType).call(this,objectClass));}_createClass(KeyboardType,[{key:"Release",value:function Release(){_get(_getPrototypeOf(KeyboardType.prototype),"Release",this).call(this);}},{key:"OnCreate",value:function OnCreate(){}},{key:"GetScriptInterfaceClass",value:function GetScriptInterfaceClass(){return self.IKeyboardObjectType;}}]);return KeyboardType;}(_C199.SDKTypeBase);var keyboardObjectType=null;self.IKeyboardObjectType=/*#__PURE__*/function(_self$IObjectClass){_inherits(IKeyboardObjectType,_self$IObjectClass);function IKeyboardObjectType(objectType){var _this179;_classCallCheck(this,IKeyboardObjectType);_this179=_possibleConstructorReturn(this,_getPrototypeOf(IKeyboardObjectType).call(this,objectType));keyboardObjectType=objectType;objectType.GetRuntime()._GetCommonScriptInterfaces().keyboard=_assertThisInitialized(_this179);return _this179;}_createClass(IKeyboardObjectType,[{key:"isKeyDown",value:function isKeyDown(keyOrCode){var keyboardInst=GetKeyboardSdkInstance();if(typeof keyOrCode==="string")return keyboardInst.IsKeyDown(keyOrCode);else if(typeof keyOrCode==="number")return keyboardInst.IsKeyCodeDown(keyOrCode);else throw new TypeError("expected string or number");}}]);return IKeyboardObjectType;}(self.IObjectClass);}{var _C200=self.C3;_C200.Plugins.Keyboard.Instance=/*#__PURE__*/function(_C200$SDKInstanceBase){_inherits(KeyboardInstance,_C200$SDKInstanceBase);function KeyboardInstance(inst,properties){var _this180;_classCallCheck(this,KeyboardInstance);_this180=_possibleConstructorReturn(this,_getPrototypeOf(KeyboardInstance).call(this,inst));_this180._keysDownByString=new Set();_this180._keysDownByWhich=new Set();_this180._triggerWhich=0;_this180._triggerString="";_this180._triggerTypedKey="";var rt=_this180.GetRuntime().Dispatcher();_this180._disposables=new _C200.CompositeDisposable(_C200.Disposable.From(rt,"keydown",function(e){return _this180._OnKeyDown(e.data);}),_C200.Disposable.From(rt,"keyup",function(e){return _this180._OnKeyUp(e.data);}),_C200.Disposable.From(rt,"window-blur",function(){return _this180._OnWindowOrKeyboardBlur();}),_C200.Disposable.From(rt,"keyboard-blur",function(){return _this180._OnWindowOrKeyboardBlur();}));return _this180;}_createClass(KeyboardInstance,[{key:"Release",value:function Release(){_get(_getPrototypeOf(KeyboardInstance.prototype),"Release",this).call(this);}},{key:"_OnKeyDown",value:function _OnKeyDown(e){var which=e["which"];var keyString=e["code"]||which.toString();var typedKey=e["key"];if(this._keysDownByString.has(keyString))return;this._keysDownByString.add(keyString);this._keysDownByWhich.add(which);this._triggerString=keyString;this._triggerWhich=which;this._triggerTypedKey=typedKey;this.Trigger(_C200.Plugins.Keyboard.Cnds.OnAnyKey);this.Trigger(_C200.Plugins.Keyboard.Cnds.OnKey);this.Trigger(_C200.Plugins.Keyboard.Cnds.OnLeftRightKeyPressed);this.Trigger(_C200.Plugins.Keyboard.Cnds.OnKeyCode);}},{key:"_OnKeyUp",value:function _OnKeyUp(e){var which=e["which"];var keyString=e["code"]||which.toString();var typedKey=e["key"];this._keysDownByString["delete"](keyString);this._keysDownByWhich["delete"](which);this._triggerString=keyString;this._triggerWhich=which;this._triggerTypedKey=typedKey;this.Trigger(_C200.Plugins.Keyboard.Cnds.OnAnyKeyReleased);this.Trigger(_C200.Plugins.Keyboard.Cnds.OnKeyReleased);this.Trigger(_C200.Plugins.Keyboard.Cnds.OnLeftRightKeyReleased);this.Trigger(_C200.Plugins.Keyboard.Cnds.OnKeyCodeReleased);}},{key:"_OnWindowOrKeyboardBlur",value:function _OnWindowOrKeyboardBlur(){var _iteratorNormalCompletion579=true;var _didIteratorError579=false;var _iteratorError579=undefined;try{for(var _iterator579=this._keysDownByWhich[Symbol.iterator](),_step579;!(_iteratorNormalCompletion579=(_step579=_iterator579.next()).done);_iteratorNormalCompletion579=true){var which=_step579.value;this._keysDownByWhich["delete"](which);this._triggerWhich=which;this.Trigger(_C200.Plugins.Keyboard.Cnds.OnAnyKeyReleased);this.Trigger(_C200.Plugins.Keyboard.Cnds.OnKeyReleased);this.Trigger(_C200.Plugins.Keyboard.Cnds.OnKeyCodeReleased);}}catch(err){_didIteratorError579=true;_iteratorError579=err;}finally{try{if(!_iteratorNormalCompletion579&&_iterator579["return"]!=null){_iterator579["return"]();}}finally{if(_didIteratorError579){throw _iteratorError579;}}}this._keysDownByString.clear();}},{key:"IsKeyDown",value:function IsKeyDown(str){return this._keysDownByString.has(str);}},{key:"IsKeyCodeDown",value:function IsKeyCodeDown(which){return this._keysDownByWhich.has(which);}},{key:"SaveToJson",value:function SaveToJson(){return{"tk":this._triggerWhich,"tkk":this._triggerTypedKey};}},{key:"LoadFromJson",value:function LoadFromJson(o){this._triggerWhich=o["tk"];if(o.hasOwnProperty("tkk"))this._triggerTypedKey=o["tkk"];}},{key:"GetDebuggerProperties",value:function GetDebuggerProperties(){var prefix="plugins.keyboard";return[{title:prefix+".name",properties:[{name:prefix+".debugger.last-key-code",value:this._triggerWhich},{name:prefix+".debugger.last-key-string",value:_C200.Plugins.Keyboard.Exps.StringFromKeyCode(this._triggerWhich)},{name:prefix+".debugger.last-typed-key",value:this._triggerTypedKey}]}];}}]);return KeyboardInstance;}(_C200.SDKInstanceBase);}{var _C201=self.C3;var LEFTRIGHT_KEY_STRINGS=["ShiftLeft","ShiftRight","ControlLeft","ControlRight","AltLeft","AltRight","MetaLeft","MetaRight"];_C201.Plugins.Keyboard.Cnds={IsKeyDown:function IsKeyDown(which){return this._keysDownByWhich.has(which);},OnKey:function OnKey(which){return this._triggerWhich===which;},OnAnyKey:function OnAnyKey(){return true;},OnAnyKeyReleased:function OnAnyKeyReleased(){return true;},OnKeyReleased:function OnKeyReleased(which){return this._triggerWhich===which;},IsKeyCodeDown:function IsKeyCodeDown(which){which=Math.floor(which);return this._keysDownByWhich.has(which);},OnKeyCode:function OnKeyCode(which){return this._triggerWhich===which;},OnKeyCodeReleased:function OnKeyCodeReleased(which){return this._triggerWhich===which;},OnLeftRightKeyPressed:function OnLeftRightKeyPressed(index){var keyString=LEFTRIGHT_KEY_STRINGS[index];return this._triggerString===keyString;},OnLeftRightKeyReleased:function OnLeftRightKeyReleased(index){var keyString=LEFTRIGHT_KEY_STRINGS[index];return this._triggerString===keyString;},IsLeftRightKeyDown:function IsLeftRightKeyDown(index){var keyString=LEFTRIGHT_KEY_STRINGS[index];return this._keysDownByString.has(keyString);}};}{var _C202=self.C3;_C202.Plugins.Keyboard.Acts={};}{var StringFromCharCode=function StringFromCharCode(kc){kc=Math.floor(kc);switch(kc){case 8:return"backspace";case 9:return"tab";case 13:return"enter";case 16:return"shift";case 17:return"control";case 18:return"alt";case 19:return"pause";case 20:return"capslock";case 27:return"esc";case 33:return"pageup";case 34:return"pagedown";case 35:return"end";case 36:return"home";case 37:return"\u2190";case 38:return"\u2191";case 39:return"\u2192";case 40:return"\u2193";case 45:return"insert";case 46:return"del";case 91:return"left window key";case 92:return"right window key";case 93:return"select";case 96:return"numpad 0";case 97:return"numpad 1";case 98:return"numpad 2";case 99:return"numpad 3";case 100:return"numpad 4";case 101:return"numpad 5";case 102:return"numpad 6";case 103:return"numpad 7";case 104:return"numpad 8";case 105:return"numpad 9";case 106:return"numpad *";case 107:return"numpad +";case 109:return"numpad -";case 110:return"numpad .";case 111:return"numpad /";case 112:return"F1";case 113:return"F2";case 114:return"F3";case 115:return"F4";case 116:return"F5";case 117:return"F6";case 118:return"F7";case 119:return"F8";case 120:return"F9";case 121:return"F10";case 122:return"F11";case 123:return"F12";case 144:return"numlock";case 145:return"scroll lock";case 186:return";";case 187:return"=";case 188:return",";case 189:return"-";case 190:return".";case 191:return"/";case 192:return"'";case 219:return"[";case 220:return"\\";case 221:return"]";case 222:return"#";case 223:return"`";default:return String.fromCharCode(kc);}};var _C203=self.C3;_C203.Plugins.Keyboard.Exps={LastKeyCode:function LastKeyCode(){return this._triggerWhich;},StringFromKeyCode:function StringFromKeyCode(kc){return StringFromCharCode(kc);},TypedKey:function TypedKey(){return this._triggerTypedKey;}};};}{'use strict';{var _C204=self.C3;_C204.Plugins.Text=/*#__PURE__*/function(_C204$SDKPluginBase){_inherits(TextPlugin,_C204$SDKPluginBase);function TextPlugin(opts){_classCallCheck(this,TextPlugin);return _possibleConstructorReturn(this,_getPrototypeOf(TextPlugin).call(this,opts));}_createClass(TextPlugin,[{key:"Release",value:function Release(){_get(_getPrototypeOf(TextPlugin.prototype),"Release",this).call(this);}}]);return TextPlugin;}(_C204.SDKPluginBase);}{var _C205=self.C3;_C205.Plugins.Text.Type=/*#__PURE__*/function(_C205$SDKTypeBase){_inherits(TextType,_C205$SDKTypeBase);function TextType(objectClass){_classCallCheck(this,TextType);return _possibleConstructorReturn(this,_getPrototypeOf(TextType).call(this,objectClass));}_createClass(TextType,[{key:"Release",value:function Release(){_get(_getPrototypeOf(TextType.prototype),"Release",this).call(this);}},{key:"OnCreate",value:function OnCreate(){}},{key:"LoadTextures",value:function LoadTextures(renderer){}},{key:"ReleaseTextures",value:function ReleaseTextures(){}}]);return TextType;}(_C205.SDKTypeBase);}{var _C206=self.C3;var _C3X21=self.C3X;var _TEMP_COLOR_ARRAY=[0,0,0];var TEXT=0;var ENABLE_BBCODE=1;var FONT=2;var SIZE=3;var LINE_HEIGHT=4;var BOLD=5;var ITALIC=6;var COLOR=7;var HORIZONTAL_ALIGNMENT=8;var VERTICAL_ALIGNMENT=9;var WRAPPING=10;var TEXT_DIRECTION=11;var ICON_SET=12;var _INITIALLY_VISIBLE=13;var ORIGIN=14;var READ_ALOUD=15;var HORIZONTAL_ALIGNMENTS=["left","center","right"];var VERTICAL_ALIGNMENTS=["top","center","bottom"];var TEXT_DIRECTIONS=["ltr","rtl"];var WORD_WRAP=0;var CHARACTER_WRAP=1;var _tempRect13=new _C206.Rect();var _tempQuad7=new _C206.Quad();var _tempColor8=new _C206.Color();var _tempVec3=_C206.New(_C206.Vector2);var BBCODE_TAG_TO_HTML=new Map([["b","strong"],["i","em"],["s","s"],["u","u"],["iconoffsety",null]]);_C206.Plugins.Text.Instance=/*#__PURE__*/function(_C206$SDKWorldInstanc){_inherits(TextInstance,_C206$SDKWorldInstanc);function TextInstance(inst,properties){var _this181;_classCallCheck(this,TextInstance);_this181=_possibleConstructorReturn(this,_getPrototypeOf(TextInstance).call(this,inst));_this181._text="";_this181._enableBBcode=true;_this181._faceName="Arial";_this181._ptSize=12;_this181._lineHeightOffset=0;_this181._isBold=false;_this181._isItalic=false;_this181._color=_C206.New(_C206.Color);_this181._horizontalAlign=0;_this181._verticalAlign=0;_this181._wrapByWord=true;_this181._textDirection=0;_this181._iconObjectClass=null;_this181._htmlString="";_this181._isHtmlStringUpToDate=false;_this181._readAloud=false;_this181._screenReaderText=null;_this181._typewriterStartTime=-1;_this181._typewriterEndTime=-1;_this181._typewriterLength=0;_this181._rendererText=_C206.New(_C206.Gfx.RendererText,_this181._runtime.GetRenderer(),{timeout:5});_this181._rendererText.ontextureupdate=function(){return _this181._runtime.UpdateRender();};_this181._animationframeimagechange_handler=function(){return _this181._OnIconObjectClassImageChanged();};_this181._pendingUpdateIconSet=false;if(properties){_this181._text=properties[TEXT];_this181._enableBBcode=!!properties[ENABLE_BBCODE];_this181._faceName=properties[FONT];_this181._ptSize=properties[SIZE];_this181._lineHeightOffset=properties[LINE_HEIGHT];_this181._isBold=!!properties[BOLD];_this181._isItalic=!!properties[ITALIC];_this181._horizontalAlign=properties[HORIZONTAL_ALIGNMENT];_this181._verticalAlign=properties[VERTICAL_ALIGNMENT];_this181._wrapByWord=properties[WRAPPING]===WORD_WRAP;_this181._textDirection=properties[TEXT_DIRECTION];_this181._SetIconObjectClass(_this181._runtime.GetObjectClassBySID(properties[ICON_SET]));var v=properties[COLOR];_this181._color.setRgb(v[0],v[1],v[2]);_this181.GetWorldInfo().SetVisible(properties[_INITIALLY_VISIBLE]);_this181._readAloud=!!properties[READ_ALOUD];}_this181._UpdateTextSettings();_this181._UpdateScreenReaderText();return _this181;}_createClass(TextInstance,[{key:"Release",value:function Release(){this._SetIconObjectClass(null);this._CancelTypewriter();if(this._screenReaderText){this._screenReaderText.Release();this._screenReaderText=null;}this._rendererText.Release();this._rendererText=null;_get(_getPrototypeOf(TextInstance.prototype),"Release",this).call(this);}},{key:"_UpdateTextSettings",value:function _UpdateTextSettings(){var rendererText=this._rendererText;rendererText.SetText(this._text);rendererText.SetBBCodeEnabled(this._enableBBcode);if(this._rendererText.IsBBCodeEnabled()&&this._iconObjectClass)this._rendererText.SetIconSet(this.GetRuntime().GetTextIconSet(this._iconObjectClass));else this._rendererText.SetIconSet(null);rendererText.SetIconSmoothing(this._runtime.GetSampling()!=="nearest");rendererText.SetFontName(this._faceName);rendererText.SetLineHeight(this._lineHeightOffset);rendererText.SetBold(this._isBold);rendererText.SetItalic(this._isItalic);rendererText.SetColor(this._color);rendererText.SetHorizontalAlignment(HORIZONTAL_ALIGNMENTS[this._horizontalAlign]);rendererText.SetVerticalAlignment(VERTICAL_ALIGNMENTS[this._verticalAlign]);rendererText.SetWordWrapMode(this._wrapByWord?"word":"character");rendererText.SetTextDirection(TEXT_DIRECTIONS[this._textDirection]);}},{key:"_UpdateTextSize",value:function _UpdateTextSize(){var wi=this.GetWorldInfo();this._rendererText.SetFontSize(this._ptSize);this._rendererText.SetFontSizeScale(wi.GetSceneGraphScale());var layer=wi.GetLayer();var textZoom=layer.GetRenderScale()*layer.Get2DScaleFactorToZ(wi.GetTotalZElevation());if(wi.HasMesh()&&textZoom!==this._rendererText.GetZoom())wi.SetMeshChanged(true);this._rendererText.SetSize(wi.GetWidth(),wi.GetHeight(),textZoom);}},{key:"_SetIconObjectClass",value:function _SetIconObjectClass(objectClass){if(objectClass&&(objectClass.IsFamily()||objectClass.GetPlugin().constructor!==_C206.Plugins.Sprite))return;if(objectClass===this._iconObjectClass)return;if(this._iconObjectClass)this._iconObjectClass.Dispatcher().removeEventListener("animationframeimagechange",this._animationframeimagechange_handler);this._iconObjectClass=objectClass;if(this._iconObjectClass)this._iconObjectClass.Dispatcher().addEventListener("animationframeimagechange",this._animationframeimagechange_handler);this._UpdateTextSettings();this._isHtmlStringUpToDate=false;this._runtime.UpdateRender();}},{key:"_OnIconObjectClassImageChanged",value:function _OnIconObjectClassImageChanged(){this._runtime.DeleteTextIconSet(this._iconObjectClass);this._runtime.UpdateRender();this._pendingUpdateIconSet=true;}},{key:"_UpdateScreenReaderText",value:function _UpdateScreenReaderText(){if(this._readAloud){var text=this._text;if(this._enableBBcode)text=_C206.BBString.StripAnyTags(text);if(this._screenReaderText)this._screenReaderText.SetText(text);else this._screenReaderText=_C206.New(_C206.ScreenReaderText,this._runtime,text);}else if(this._screenReaderText){this._screenReaderText.Release();this._screenReaderText=null;}}},{key:"Draw",value:function Draw(renderer){var wi=this.GetWorldInfo();this._UpdateTextSize();if(this._pendingUpdateIconSet){this._pendingUpdateIconSet=false;if(this._rendererText.IsBBCodeEnabled()&&this._iconObjectClass)this._rendererText.SetIconSet(this.GetRuntime().GetTextIconSet(this._iconObjectClass));}var texture=this._rendererText.GetTexture();if(!texture)return;var layer=wi.GetLayer();if(wi.GetAngle()===0&&layer.GetAngle()===0&&wi.GetTotalZElevation()===0&&!wi.HasMesh()&&layer.RendersIn2DMode()){var quad=wi.GetBoundingQuad();var _layer$LayerToDrawSur=layer.LayerToDrawSurface(quad.getTlx(),quad.getTly()),_layer$LayerToDrawSur2=_slicedToArray(_layer$LayerToDrawSur,2),dl=_layer$LayerToDrawSur2[0],dt=_layer$LayerToDrawSur2[1];var _layer$LayerToDrawSur3=layer.LayerToDrawSurface(quad.getBrx(),quad.getBry()),_layer$LayerToDrawSur4=_slicedToArray(_layer$LayerToDrawSur3,2),dr=_layer$LayerToDrawSur4[0],db=_layer$LayerToDrawSur4[1];var offX=dl-Math.round(dl);var offY=dt-Math.round(dt);_tempRect13.set(dl,dt,dr,db);_tempRect13.offset(-offX,-offY);_tempQuad7.setFromRect(_tempRect13);var _renderer$GetRenderTa5=renderer.GetRenderTargetSize(renderer.GetRenderTarget()),_renderer$GetRenderTa6=_slicedToArray(_renderer$GetRenderTa5,2),rtWidth=_renderer$GetRenderTa6[0],rtHeight=_renderer$GetRenderTa6[1];this._runtime.GetCanvasManager().SetDeviceTransform(renderer,rtWidth,rtHeight);renderer.SetTexture(texture);renderer.Quad3(_tempQuad7,this._rendererText.GetTexRect());layer._SetTransform(renderer);}else{renderer.SetTexture(texture);if(wi.HasMesh())this._DrawMesh(wi,renderer);else this._DrawStandard(wi,renderer);}}},{key:"_DrawStandard",value:function _DrawStandard(wi,renderer){var quad=wi.GetBoundingQuad();if(this._runtime.IsPixelRoundingEnabled())quad=this._PixelRoundQuad(quad);renderer.Quad3(quad,this._rendererText.GetTexRect());}},{key:"_DrawMesh",value:function _DrawMesh(wi,renderer){var transformedMesh=wi.GetTransformedMesh();if(wi.IsMeshChanged()){wi.CalculateBbox(_tempRect13,_tempQuad7,false);var quad=_tempQuad7;if(this._runtime.IsPixelRoundingEnabled())quad=this._PixelRoundQuad(quad);transformedMesh.CalculateTransformedMesh(wi.GetSourceMesh(),quad,this._rendererText.GetTexRect());wi.SetMeshChanged(false);}transformedMesh.Draw(renderer);}},{key:"_PixelRoundQuad",value:function _PixelRoundQuad(quad){var offX=quad.getTlx()-Math.round(quad.getTlx());var offY=quad.getTly()-Math.round(quad.getTly());if(offX===0&&offY===0)return quad;else{_tempQuad7.copy(quad);_tempQuad7.offset(-offX,-offY);return _tempQuad7;}}},{key:"GetCurrentSurfaceSize",value:function GetCurrentSurfaceSize(){var texture=this._rendererText.GetTexture();if(texture)return[texture.GetWidth(),texture.GetHeight()];else return[100,100];}},{key:"GetCurrentTexRect",value:function GetCurrentTexRect(){return this._rendererText.GetTexRect();}},{key:"IsCurrentTexRotated",value:function IsCurrentTexRotated(){return false;}},{key:"SaveToJson",value:function SaveToJson(){var o={"t":this._text,"c":this._color.toJSON(),"fn":this._faceName,"ps":this._ptSize};if(this._enableBBcode)o["bbc"]=this._enableBBcode;if(this._horizontalAlign!==0)o["ha"]=this._horizontalAlign;if(this._verticalAlign!==0)o["va"]=this._verticalAlign;if(!this._wrapByWord)o["wr"]=this._wrapByWord;if(this._lineHeightOffset!==0)o["lho"]=this._lineHeightOffset;if(this._isBold)o["b"]=this._isBold;if(this._isItalic)o["i"]=this._isItalic;if(this._typewriterEndTime!==-1)o["tw"]={"st":this._typewriterStartTime,"en":this._typewriterEndTime,"l":this._typewriterLength};if(this._iconObjectClass)o["ioc"]=this._iconObjectClass.GetSID();return o;}},{key:"LoadFromJson",value:function LoadFromJson(o){this._CancelTypewriter();this._text=o["t"],this._color.setFromJSON(o["c"]);this._faceName=o["fn"],this._ptSize=o["ps"];this._enableBBcode=o.hasOwnProperty("bbc")?o["bbc"]:false;this._horizontalAlign=o.hasOwnProperty("ha")?o["ha"]:0;this._verticalAlign=o.hasOwnProperty("va")?o["va"]:0;this._wrapByWord=o.hasOwnProperty("wr")?o["wr"]:true;this._lineHeightOffset=o.hasOwnProperty("lho")?o["lho"]:0;this._isBold=o.hasOwnProperty("b")?o["b"]:false;this._isItalic=o.hasOwnProperty("i")?o["i"]:false;if(o.hasOwnProperty("tw")){var tw=o["tw"];this._typewriterStartTime=tw["st"];this._typewriterEndTime=tw["en"];this._typewriterLength=tw["l"];}if(o.hasOwnProperty("ioc")){var objectClass=this.GetRuntime().GetObjectClassBySID(o["ioc"]);if(objectClass)this._SetIconObjectClass(objectClass);}else this._SetIconObjectClass(null);this._UpdateTextSettings();this._UpdateScreenReaderText();this._isHtmlStringUpToDate=false;if(this._typewriterEndTime!==-1)this._StartTicking();}},{key:"GetPropertyValueByIndex",value:function GetPropertyValueByIndex(index){switch(index){case TEXT:return this.GetText();case ENABLE_BBCODE:return this._enableBBcode;case FONT:return this._GetFontFace();case SIZE:return this._GetFontSize();case LINE_HEIGHT:return this._GetLineHeight();case BOLD:return this._IsBold();case ITALIC:return this._IsItalic();case COLOR:_TEMP_COLOR_ARRAY[0]=this._color.getR();_TEMP_COLOR_ARRAY[1]=this._color.getG();_TEMP_COLOR_ARRAY[2]=this._color.getB();return _TEMP_COLOR_ARRAY;case HORIZONTAL_ALIGNMENT:return this._GetHAlign();case VERTICAL_ALIGNMENT:return this._GetVAlign();case WRAPPING:return this._IsWrapByWord()?CHARACTER_WRAP:WORD_WRAP;case READ_ALOUD:return this._IsReadAloud();}}},{key:"SetPropertyValueByIndex",value:function SetPropertyValueByIndex(index,value){switch(index){case TEXT:this._SetText(value);break;case ENABLE_BBCODE:if(this._enableBBcode===!!value)return;this._enableBBcode=!!value;this._UpdateTextSettings();break;case FONT:this._SetFontFace(value);break;case SIZE:this._SetFontSize(value);break;case LINE_HEIGHT:this._SetLineHeight(value);break;case BOLD:this._SetBold(value);break;case ITALIC:this._SetItalic(value);break;case COLOR:var _c31=this._color;var v=value;if(_c31.getR()===v[0]&&_c31.getG()===v[1]&&_c31.getB()===v[2])return;this._color.setRgb(v[0],v[1],v[2]);this._UpdateTextSettings();break;case HORIZONTAL_ALIGNMENT:this._SetHAlign(value);break;case VERTICAL_ALIGNMENT:this._SetVAlign(value);break;case WRAPPING:this._SetWrapByWord(value===WORD_WRAP);break;}}},{key:"SetPropertyColorOffsetValueByIndex",value:function SetPropertyColorOffsetValueByIndex(index,r,g,b){if(r===0&&g===0&&b===0)return;switch(index){case COLOR:this._color.addRgb(r,g,b);this._UpdateTextSettings();break;}}},{key:"_SetText",value:function _SetText(text){if(this._text===text)return;this._text=text;this._rendererText.SetText(text);this._UpdateScreenReaderText();this._isHtmlStringUpToDate=false;this._runtime.UpdateRender();}},{key:"GetText",value:function GetText(){return this._text;}},{key:"_StartTypewriter",value:function _StartTypewriter(text,duration){this._UpdateTextSize();this._SetText(text);this._typewriterStartTime=this._runtime.GetWallTime();this._typewriterEndTime=this._typewriterStartTime+duration/this.GetInstance().GetActiveTimeScale();this._typewriterLength=this._rendererText.GetLengthInGraphemes();this._rendererText.SetDrawMaxCharacterCount(0);this._StartTicking();}},{key:"_CancelTypewriter",value:function _CancelTypewriter(){this._typewriterStartTime=-1;this._typewriterEndTime=-1;this._typewriterLength=0;this._rendererText.SetDrawMaxCharacterCount(-1);this._StopTicking();}},{key:"_FinishTypewriter",value:function _FinishTypewriter(){if(this._typewriterEndTime===-1)return;this._CancelTypewriter();this.Trigger(_C206.Plugins.Text.Cnds.OnTypewriterTextFinished);this._runtime.UpdateRender();}},{key:"_SetFontFace",value:function _SetFontFace(face){if(this._faceName===face)return;this._faceName=face;this._rendererText.SetFontName(face);this._runtime.UpdateRender();}},{key:"_GetFontFace",value:function _GetFontFace(){return this._faceName;}},{key:"_SetBold",value:function _SetBold(b){b=!!b;if(this._isBold===b)return;this._isBold=b;this._rendererText.SetBold(b);this._runtime.UpdateRender();}},{key:"_IsBold",value:function _IsBold(){return this._isBold;}},{key:"_SetItalic",value:function _SetItalic(i){i=!!i;if(this._isItalic===i)return;this._isItalic=i;this._rendererText.SetItalic(i);this._runtime.UpdateRender();}},{key:"_IsItalic",value:function _IsItalic(){return this._isItalic;}},{key:"_SetFontSize",value:function _SetFontSize(size){if(this._ptSize===size)return;this._ptSize=size;this._runtime.UpdateRender();}},{key:"_GetFontSize",value:function _GetFontSize(){return this._ptSize;}},{key:"_SetFontColor",value:function _SetFontColor(color){if(this._color.equalsIgnoringAlpha(color))return;this._color.copyRgb(color);this._rendererText.SetColor(this._color);this._runtime.UpdateRender();}},{key:"_GetFontColor",value:function _GetFontColor(){return this._color;}},{key:"_SetLineHeight",value:function _SetLineHeight(lho){if(this._lineHeightOffset===lho)return;this._lineHeightOffset=lho;this._UpdateTextSettings();this._runtime.UpdateRender();}},{key:"_GetLineHeight",value:function _GetLineHeight(){return this._lineHeightOffset;}},{key:"_SetHAlign",value:function _SetHAlign(h){if(this._horizontalAlign===h)return;this._horizontalAlign=h;this._UpdateTextSettings();this._runtime.UpdateRender();}},{key:"_GetHAlign",value:function _GetHAlign(){return this._horizontalAlign;}},{key:"_SetVAlign",value:function _SetVAlign(v){if(this._verticalAlign===v)return;this._verticalAlign=v;this._UpdateTextSettings();this._runtime.UpdateRender();}},{key:"_GetVAlign",value:function _GetVAlign(){return this._verticalAlign;}},{key:"_SetWrapByWord",value:function _SetWrapByWord(w){w=!!w;if(this._wrapByWord===w)return;this._wrapByWord=w;this._UpdateTextSettings();this._runtime.UpdateRender();}},{key:"_IsWrapByWord",value:function _IsWrapByWord(){return this._wrapByWord;}},{key:"_SetTextDirection",value:function _SetTextDirection(d){if(this._textDirection===d)return;this._textDirection=d;this._UpdateTextSettings();this._runtime.UpdateRender();}},{key:"_GetTextDirection",value:function _GetTextDirection(){return this._textDirection;}},{key:"_SetReadAloud",value:function _SetReadAloud(r){this._readAloud=!!r;this._UpdateScreenReaderText();}},{key:"_IsReadAloud",value:function _IsReadAloud(){return this._readAloud;}},{key:"_GetTextWidth",value:function _GetTextWidth(){this._UpdateTextSize();return this._rendererText.GetTextWidth();}},{key:"_GetTextHeight",value:function _GetTextHeight(){this._UpdateTextSize();return this._rendererText.GetTextHeight();}},{key:"_GetTagAtPosition",value:function _GetTagAtPosition(x,y){this._UpdateTextSize();var wi=this.GetWorldInfo();_tempVec3.set(x-wi.GetX(),y-wi.GetY());_tempVec3.rotate(-wi.GetAngle());_tempVec3.offset(wi.GetWidth()*wi.GetOriginX(),wi.GetHeight()*wi.GetOriginY());_tempVec3.divide(wi.GetWidth(),wi.GetHeight());_tempVec3.scale(this._rendererText.GetWidth(),this._rendererText.GetHeight());var frag=this._rendererText.HitTestFragment(_tempVec3.getX(),_tempVec3.getY());if(frag){var fragTagStyle=frag.GetStyleTag("tag");if(fragTagStyle)return fragTagStyle.param;}return"";}},{key:"_HasTagAtPosition",value:function _HasTagAtPosition(tag,x,y){var hitTag=this._GetTagAtPosition(x,y);return hitTag&&_C206.equalsNoCase(tag,hitTag);}},{key:"_GetTagPosition",value:function _GetTagPosition(tag,index){this._UpdateTextSize();index=Math.floor(index);var frag=this._rendererText.FindFragmentWithTag(tag,index);if(!frag)return null;var wi=this.GetWorldInfo();var scale=this._rendererText.GetDrawScale();var posX=frag.GetPosX();var posY=frag.GetPosY()-(frag.GetHeight()-frag.GetFontBoundingBoxDescent())*scale;var width=frag.GetWidth()*scale/this._rendererText.GetWidth()*wi.GetWidth();var height=frag.GetHeight()*scale/this._rendererText.GetHeight()*wi.GetHeight();_tempVec3.set(posX,posY);_tempVec3.divide(this._rendererText.GetWidth(),this._rendererText.GetHeight());_tempVec3.scale(wi.GetWidth(),wi.GetHeight());_tempVec3.offset(-wi.GetWidth()*wi.GetOriginX(),-wi.GetHeight()*wi.GetOriginY());_tempVec3.rotate(wi.GetAngle());_tempVec3.offset(wi.GetX(),wi.GetY());return{x:_tempVec3.getX(),y:_tempVec3.getY(),width:width,height:height};}},{key:"_GetTagCount",value:function _GetTagCount(tag){this._UpdateTextSize();return this._rendererText.CountFragmentsWithTag(tag);}},{key:"_GetHTMLCloseTag",value:function _GetHTMLCloseTag(bbTag){var htmlTag=BBCODE_TAG_TO_HTML.get(bbTag);if(htmlTag===null)return"";else if(!htmlTag)htmlTag="span";return"</".concat(htmlTag||"span",">");}},{key:"_GetHTMLOpenTag",value:function _GetHTMLOpenTag(bbTag,param){var htmlTag=BBCODE_TAG_TO_HTML.get(bbTag);if(htmlTag===null)return"";else if(!htmlTag)htmlTag="span";switch(bbTag){case"color":return"<".concat(htmlTag," style=\"color: ").concat(param,"\">");case"font":return"<".concat(htmlTag," style=\"font-family: '").concat(param,"'\">");case"opacity":return"<".concat(htmlTag," style=\"opacity: ").concat(param,"%\">");case"size":return"<".concat(htmlTag," style=\"font-size: ").concat(param,"pt\">");case"background":return"<".concat(htmlTag," style=\"background-color: ").concat(param,"\">");case"hide":return"<".concat(htmlTag," style=\"visibility: hidden\">");case"class":return"<".concat(htmlTag," class=\"").concat(param,"\">");case"tag":return"<".concat(htmlTag," data-tag=\"").concat(param,"\">");default:return"<".concat(htmlTag,">");}}},{key:"_UpdateHTMLString",value:function _UpdateHTMLString(){var fragList,iconBlobUrls,htmlStr,styles,textIconSet,openTags,_iteratorNormalCompletion583,_didIteratorError583,_iteratorError583,_iterator583,_step583,frag,fragTags,_revKeys,_iteratorNormalCompletion585,_didIteratorError585,_iteratorError585,_iterator585,_step585,bbTag,_iteratorNormalCompletion586,_didIteratorError586,_iteratorError586,_iterator586,_step586,_step586$value,_bbTag,_param7,textIcon,blobUrl,_styles,topStyle,iconOffsetYStyle,param,revKeys,_iteratorNormalCompletion584,_didIteratorError584,_iteratorError584,_iterator584,_step584,tag;return regeneratorRuntime.async(function _UpdateHTMLString$(_context235){while(1){switch(_context235.prev=_context235.next){case 0:if(!this._isHtmlStringUpToDate){_context235.next=2;break;}return _context235.abrupt("return",this._htmlString);case 2:fragList=new _C206.BBString(this._text,{noEscape:true}).toFragmentList();iconBlobUrls=new Map();htmlStr="<span class=\"c3-text\"";styles=[];styles.push("font-family: '".concat(this._GetFontFace(),"';"));if(this._IsBold())styles.push("font-weight: bold;");if(this._IsItalic())styles.push("font-style: italic;");if(!this._IsWrapByWord())styles.push("word-break: break-all;");htmlStr+=" style=\"".concat(styles.join(" "),"\">");textIconSet=this._iconObjectClass?this.GetRuntime().GetTextIconSet(this._iconObjectClass):null;if(!this._iconObjectClass){_context235.next=15;break;}_context235.next=15;return regeneratorRuntime.awrap(function _callee17(){var promiseThrottle,assetDrawablePromises,assetDrawableMap,_iteratorNormalCompletion580,_didIteratorError580,_iteratorError580,_iterator580,_step580,frag,textIcon,_ret10,blobUrlPromises,_iteratorNormalCompletion581,_didIteratorError581,_iteratorError581,_iterator581,_step581,_frag,_iteratorNormalCompletion582,_didIteratorError582,_iteratorError582,_iterator582,_step582,drawable;return regeneratorRuntime.async(function _callee17$(_context234){while(1){switch(_context234.prev=_context234.next){case 0:promiseThrottle=_C206.New(_C206.PromiseThrottle);assetDrawablePromises=[];assetDrawableMap=new Map();_iteratorNormalCompletion580=true;_didIteratorError580=false;_iteratorError580=undefined;_context234.prev=6;_iterator580=fragList[Symbol.iterator]();case 8:if(_iteratorNormalCompletion580=(_step580=_iterator580.next()).done){_context234.next=19;break;}frag=_step580.value;if(!frag.IsIcon()){_context234.next=16;break;}textIcon=frag.GetTextIcon(textIconSet);if(!textIcon){_context234.next=16;break;}_ret10=function(){var frame=textIcon.GetSource();var imageAsset=frame.GetImageInfo().GetImageAsset();if(assetDrawableMap.has(imageAsset))return"continue";assetDrawableMap.set(imageAsset,null);assetDrawablePromises.push(promiseThrottle.Add(function _callee15(){var drawable;return regeneratorRuntime.async(function _callee15$(_context232){while(1){switch(_context232.prev=_context232.next){case 0:_context232.next=2;return regeneratorRuntime.awrap(imageAsset.LoadToDrawable());case 2:drawable=_context232.sent;assetDrawableMap.set(imageAsset,drawable);case 4:case"end":return _context232.stop();}}});}));}();if(!(_ret10==="continue")){_context234.next=16;break;}return _context234.abrupt("continue",16);case 16:_iteratorNormalCompletion580=true;_context234.next=8;break;case 19:_context234.next=25;break;case 21:_context234.prev=21;_context234.t0=_context234["catch"](6);_didIteratorError580=true;_iteratorError580=_context234.t0;case 25:_context234.prev=25;_context234.prev=26;if(!_iteratorNormalCompletion580&&_iterator580["return"]!=null){_iterator580["return"]();}case 28:_context234.prev=28;if(!_didIteratorError580){_context234.next=31;break;}throw _iteratorError580;case 31:return _context234.finish(28);case 32:return _context234.finish(25);case 33:_context234.next=35;return regeneratorRuntime.awrap(Promise.all(assetDrawablePromises));case 35:blobUrlPromises=[];_iteratorNormalCompletion581=true;_didIteratorError581=false;_iteratorError581=undefined;_context234.prev=39;for(_iterator581=fragList[Symbol.iterator]();!(_iteratorNormalCompletion581=(_step581=_iterator581.next()).done);_iteratorNormalCompletion581=true){_frag=_step581.value;if(_frag.IsIcon()){(function(){var textIcon=_frag.GetTextIcon(textIconSet);if(textIcon){var frame=textIcon.GetSource();var imageAsset=frame.GetImageInfo().GetImageAsset();blobUrlPromises.push(promiseThrottle.Add(function _callee16(){var blobUrl;return regeneratorRuntime.async(function _callee16$(_context233){while(1){switch(_context233.prev=_context233.next){case 0:_context233.next=2;return regeneratorRuntime.awrap(frame.GetImageInfo().ExtractImageToBlobURL(assetDrawableMap.get(imageAsset)));case 2:blobUrl=_context233.sent;iconBlobUrls.set(textIcon,blobUrl);case 4:case"end":return _context233.stop();}}});}));}})();}}_context234.next=47;break;case 43:_context234.prev=43;_context234.t1=_context234["catch"](39);_didIteratorError581=true;_iteratorError581=_context234.t1;case 47:_context234.prev=47;_context234.prev=48;if(!_iteratorNormalCompletion581&&_iterator581["return"]!=null){_iterator581["return"]();}case 50:_context234.prev=50;if(!_didIteratorError581){_context234.next=53;break;}throw _iteratorError581;case 53:return _context234.finish(50);case 54:return _context234.finish(47);case 55:_context234.next=57;return regeneratorRuntime.awrap(Promise.all(blobUrlPromises));case 57:_iteratorNormalCompletion582=true;_didIteratorError582=false;_iteratorError582=undefined;_context234.prev=60;for(_iterator582=assetDrawableMap.values()[Symbol.iterator]();!(_iteratorNormalCompletion582=(_step582=_iterator582.next()).done);_iteratorNormalCompletion582=true){drawable=_step582.value;if(drawable instanceof ImageBitmap&&drawable["close"])drawable["close"]();}_context234.next=68;break;case 64:_context234.prev=64;_context234.t2=_context234["catch"](60);_didIteratorError582=true;_iteratorError582=_context234.t2;case 68:_context234.prev=68;_context234.prev=69;if(!_iteratorNormalCompletion582&&_iterator582["return"]!=null){_iterator582["return"]();}case 71:_context234.prev=71;if(!_didIteratorError582){_context234.next=74;break;}throw _iteratorError582;case 74:return _context234.finish(71);case 75:return _context234.finish(68);case 76:case"end":return _context234.stop();}}},null,null,[[6,21,25,33],[26,,28,32],[39,43,47,55],[48,,50,54],[60,64,68,76],[69,,71,75]]);}());case 15:openTags=new Map();_iteratorNormalCompletion583=true;_didIteratorError583=false;_iteratorError583=undefined;_context235.prev=19;_iterator583=fragList[Symbol.iterator]();case 21:if(_iteratorNormalCompletion583=(_step583=_iterator583.next()).done){_context235.next=69;break;}frag=_step583.value;fragTags=frag.GetStyleMap();_revKeys=_toConsumableArray(openTags.keys());_revKeys.reverse();_iteratorNormalCompletion585=true;_didIteratorError585=false;_iteratorError585=undefined;_context235.prev=29;for(_iterator585=_revKeys[Symbol.iterator]();!(_iteratorNormalCompletion585=(_step585=_iterator585.next()).done);_iteratorNormalCompletion585=true){bbTag=_step585.value;if(!fragTags.has(bbTag)||fragTags.get(bbTag)!==openTags.get(bbTag)){openTags["delete"](bbTag);htmlStr+=this._GetHTMLCloseTag(bbTag);}}_context235.next=37;break;case 33:_context235.prev=33;_context235.t0=_context235["catch"](29);_didIteratorError585=true;_iteratorError585=_context235.t0;case 37:_context235.prev=37;_context235.prev=38;if(!_iteratorNormalCompletion585&&_iterator585["return"]!=null){_iterator585["return"]();}case 40:_context235.prev=40;if(!_didIteratorError585){_context235.next=43;break;}throw _iteratorError585;case 43:return _context235.finish(40);case 44:return _context235.finish(37);case 45:_iteratorNormalCompletion586=true;_didIteratorError586=false;_iteratorError586=undefined;_context235.prev=48;for(_iterator586=fragTags[Symbol.iterator]();!(_iteratorNormalCompletion586=(_step586=_iterator586.next()).done);_iteratorNormalCompletion586=true){_step586$value=_slicedToArray(_step586.value,2),_bbTag=_step586$value[0],_param7=_step586$value[1];if(!openTags.has(_bbTag)){openTags.set(_bbTag,_param7);htmlStr+=this._GetHTMLOpenTag(_bbTag,_param7);}}_context235.next=56;break;case 52:_context235.prev=52;_context235.t1=_context235["catch"](48);_didIteratorError586=true;_iteratorError586=_context235.t1;case 56:_context235.prev=56;_context235.prev=57;if(!_iteratorNormalCompletion586&&_iterator586["return"]!=null){_iterator586["return"]();}case 59:_context235.prev=59;if(!_didIteratorError586){_context235.next=62;break;}throw _iteratorError586;case 62:return _context235.finish(59);case 63:return _context235.finish(56);case 64:if(frag.IsText())htmlStr+=_C206.ReplaceAll(_C206.EscapeHTML(frag.GetCharacterArray().join("")),"\n","<br>");if(frag.IsIcon()&&textIconSet){textIcon=frag.GetTextIcon(textIconSet);if(textIcon){blobUrl=iconBlobUrls.get(textIcon);if(blobUrl){_styles=[];topStyle="0.2em";iconOffsetYStyle=fragTags.get("iconoffsety");if(iconOffsetYStyle){param=iconOffsetYStyle.trim();if(param.endsWith("%"))topStyle=parseFloat(param)/100+"em";else topStyle=param+"px";}_styles.push("top: ".concat(topStyle));if(this._runtime.GetSampling()==="nearest")_styles.push("image-rendering: pixelated");htmlStr+="<img class=\"c3-text-icon\" data-icon=\"".concat(frag.GetIconParameter(),"\" width=\"").concat(textIcon.GetWidth(),"\" height=\"").concat(textIcon.GetHeight(),"\" style=\"").concat(_styles.join(";"),"\" src=\"").concat(blobUrl,"\">");}}}case 66:_iteratorNormalCompletion583=true;_context235.next=21;break;case 69:_context235.next=75;break;case 71:_context235.prev=71;_context235.t2=_context235["catch"](19);_didIteratorError583=true;_iteratorError583=_context235.t2;case 75:_context235.prev=75;_context235.prev=76;if(!_iteratorNormalCompletion583&&_iterator583["return"]!=null){_iterator583["return"]();}case 78:_context235.prev=78;if(!_didIteratorError583){_context235.next=81;break;}throw _iteratorError583;case 81:return _context235.finish(78);case 82:return _context235.finish(75);case 83:revKeys=_toConsumableArray(openTags.keys());revKeys.reverse();_iteratorNormalCompletion584=true;_didIteratorError584=false;_iteratorError584=undefined;_context235.prev=88;for(_iterator584=revKeys[Symbol.iterator]();!(_iteratorNormalCompletion584=(_step584=_iterator584.next()).done);_iteratorNormalCompletion584=true){tag=_step584.value;htmlStr+=this._GetHTMLCloseTag(tag);}_context235.next=96;break;case 92:_context235.prev=92;_context235.t3=_context235["catch"](88);_didIteratorError584=true;_iteratorError584=_context235.t3;case 96:_context235.prev=96;_context235.prev=97;if(!_iteratorNormalCompletion584&&_iterator584["return"]!=null){_iterator584["return"]();}case 99:_context235.prev=99;if(!_didIteratorError584){_context235.next=102;break;}throw _iteratorError584;case 102:return _context235.finish(99);case 103:return _context235.finish(96);case 104:htmlStr+="</span>";this._htmlString=htmlStr;this._isHtmlStringUpToDate=true;return _context235.abrupt("return",this._htmlString);case 108:case"end":return _context235.stop();}}},null,this,[[19,71,75,83],[29,33,37,45],[38,,40,44],[48,52,56,64],[57,,59,63],[76,,78,82],[88,92,96,104],[97,,99,103]]);}},{key:"Tick",value:function Tick(){var wallTime=this._runtime.GetWallTime();if(wallTime>=this._typewriterEndTime){this._CancelTypewriter();this.Trigger(_C206.Plugins.Text.Cnds.OnTypewriterTextFinished);this._runtime.UpdateRender();}else{var displayLength=_C206.relerp(this._typewriterStartTime,this._typewriterEndTime,wallTime,0,this._typewriterLength);displayLength=Math.floor(displayLength);if(displayLength!==this._rendererText.GetDrawMaxCharacterCount()){this._rendererText.SetDrawMaxCharacterCount(displayLength);this._runtime.UpdateRender();}}}},{key:"GetDebuggerProperties",value:function GetDebuggerProperties(){var _this182=this;var prefix="plugins.text";return[{title:prefix+".name",properties:[{name:prefix+".properties.text.name",value:this.GetText(),onedit:function onedit(v){return _this182._SetText(v);}},{name:prefix+".properties.font.name",value:this._GetFontFace(),onedit:function onedit(v){return _this182._SetFontFace(v);}},{name:prefix+".properties.size.name",value:this._GetFontSize(),onedit:function onedit(v){return _this182._SetFontSize(v);}},{name:prefix+".properties.line-height.name",value:this._GetLineHeight(),onedit:function onedit(v){return _this182._SetLineHeight(v);}},{name:prefix+".properties.bold.name",value:this._IsBold(),onedit:function onedit(v){return _this182._SetBold(v);}},{name:prefix+".properties.italic.name",value:this._IsItalic(),onedit:function onedit(v){return _this182._SetItalic(v);}}]}];}},{key:"GetScriptInterfaceClass",value:function GetScriptInterfaceClass(){return self.ITextInstance;}}]);return TextInstance;}(_C206.SDKWorldInstanceBase);var _map16=new WeakMap();var SCRIPT_HORIZONTAL_ALIGNMENTS=new Map([["left",0],["center",1],["right",2]]);var SCRIPT_VERTICAL_ALIGNMENTS=new Map([["top",0],["center",1],["bottom",2]]);var SCRIPT_WRAP_MODES=new Map([["word",true],["character",false]]);var SCRIPT_TEXT_DIRECTIONS=["ltr","rtl"];self.ITextInstance=/*#__PURE__*/function(_self$IWorldInstance3){_inherits(ITextInstance,_self$IWorldInstance3);function ITextInstance(){var _this183;_classCallCheck(this,ITextInstance);_this183=_possibleConstructorReturn(this,_getPrototypeOf(ITextInstance).call(this));_map16.set(_assertThisInitialized(_this183),self.IInstance._GetInitInst().GetSdkInstance());return _this183;}_createClass(ITextInstance,[{key:"typewriterText",value:function typewriterText(str,duration){_C3X21.RequireString(str);_C3X21.RequireFiniteNumber(duration);var inst=_map16.get(this);inst._CancelTypewriter();inst._StartTypewriter(str,duration);}},{key:"typewriterFinish",value:function typewriterFinish(){_map16.get(this)._FinishTypewriter();}},{key:"getTextSize",value:function getTextSize(){var inst=_map16.get(this);return[inst._GetTextWidth(),inst._GetTextHeight()];}},{key:"hasTagAtPosition",value:function hasTagAtPosition(tag,x,y){_C3X21.RequireString(tag);_C3X21.RequireFiniteNumber(x);_C3X21.RequireFiniteNumber(y);return _map16.get(this)._HasTagAtPosition(tag,x,y);}},{key:"getTagAtPosition",value:function getTagAtPosition(x,y){_C3X21.RequireFiniteNumber(x);_C3X21.RequireFiniteNumber(y);return _map16.get(this)._GetTagAtPosition(x,y);}},{key:"getTagPositionAndSize",value:function getTagPositionAndSize(tag){var index=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;_C3X21.RequireString(tag);_C3X21.RequireFiniteNumber(index);return _map16.get(this)._GetTagPosition(tag,index);}},{key:"getTagCount",value:function getTagCount(tag){_C3X21.RequireString(tag);return _map16.get(this)._GetTagCount(tag);}},{key:"changeIconSet",value:function changeIconSet(iObjectClass){var sdkInst=_map16.get(this);var objectClass=sdkInst.GetRuntime()._UnwrapIObjectClass(iObjectClass);sdkInst._SetIconObjectClass(objectClass);}},{key:"getAsHtmlString",value:function getAsHtmlString(){return _map16.get(this)._UpdateHTMLString();}},{key:"text",get:function get(){return _map16.get(this).GetText();},set:function set(str){_C3X21.RequireString(str);var inst=_map16.get(this);inst._CancelTypewriter();inst._SetText(str);}},{key:"fontFace",set:function set(str){_C3X21.RequireString(str);_map16.get(this)._SetFontFace(str);},get:function get(){return _map16.get(this)._GetFontFace();}},{key:"isBold",set:function set(b){_map16.get(this)._SetBold(b);},get:function get(){return _map16.get(this)._IsBold();}},{key:"isItalic",set:function set(i){_map16.get(this)._SetItalic(i);},get:function get(){return _map16.get(this)._IsItalic();}},{key:"sizePt",set:function set(pt){_C3X21.RequireFiniteNumber(pt);_map16.get(this)._SetFontSize(pt);},get:function get(){return _map16.get(this)._GetFontSize();}},{key:"fontColor",set:function set(arr){_C3X21.RequireArray(arr);if(arr.length<3)throw new Error("expected 3 elements");_tempColor8.setRgb(arr[0],arr[1],arr[2]);_map16.get(this)._SetFontColor(_tempColor8);},get:function get(){var c=_map16.get(this)._GetFontColor();return[c.getR(),c.getG(),c.getB()];}},{key:"lineHeight",set:function set(lho){_C3X21.RequireFiniteNumber(lho);_map16.get(this)._SetLineHeight(lho);},get:function get(){return _map16.get(this)._GetLineHeight();}},{key:"horizontalAlign",set:function set(str){_C3X21.RequireString(str);var h=SCRIPT_HORIZONTAL_ALIGNMENTS.get(str);if(typeof h==="undefined")throw new Error("invalid mode");_map16.get(this)._SetHAlign(h);},get:function get(){return HORIZONTAL_ALIGNMENTS[_map16.get(this)._GetHAlign()];}},{key:"verticalAlign",set:function set(str){_C3X21.RequireString(str);var v=SCRIPT_VERTICAL_ALIGNMENTS.get(str);if(typeof v==="undefined")throw new Error("invalid mode");_map16.get(this)._SetVAlign(v);},get:function get(){return VERTICAL_ALIGNMENTS[_map16.get(this)._GetVAlign()];}},{key:"wordWrapMode",set:function set(str){_C3X21.RequireString(str);var isWrapByWord=SCRIPT_WRAP_MODES.get(str);if(typeof isWrapByWord==="undefined")throw new Error("invalid mode");_map16.get(this)._SetWrapByWord(isWrapByWord);},get:function get(){return _map16.get(this)._IsWrapByWord()?"word":"character";}},{key:"textDirection",set:function set(ds){_C3X21.RequireString(ds);var d=SCRIPT_TEXT_DIRECTIONS.indexOf(ds);if(d===-1)throw new Error("invalid text direction");_map16.get(this)._SetTextDirection(d);},get:function get(){return SCRIPT_TEXT_DIRECTIONS[_map16.get(this)._GetTextDirection()];}},{key:"readAloud",set:function set(r){_map16.get(this)._SetReadAloud(!!r);},get:function get(){return _map16.get(this)._IsReadAloud();}},{key:"textWidth",get:function get(){return _map16.get(this)._GetTextWidth();}},{key:"textHeight",get:function get(){return _map16.get(this)._GetTextHeight();}}]);return ITextInstance;}(self.IWorldInstance);}{var _C207=self.C3;_C207.Plugins.Text.Cnds={CompareText:function CompareText(str,caseSensitive){if(caseSensitive)return this._text===str;else return _C207.equalsNoCase(this._text,str);},IsRunningTypewriterText:function IsRunningTypewriterText(){return this._typewriterEndTime!==-1;},OnTypewriterTextFinished:function OnTypewriterTextFinished(){return true;},HasTagAtPosition:function HasTagAtPosition(tag,x,y){return this._HasTagAtPosition(tag,x,y);}};}{var _C208=self.C3;var _tempColor9=_C208.New(_C208.Color);_C208.Plugins.Text.Acts={SetText:function SetText(param){this._CancelTypewriter();if(typeof param==="number"&&param<1E9)param=Math.round(param*1E10)/1E10;this._SetText(param.toString());},AppendText:function AppendText(param){this._CancelTypewriter();if(typeof param==="number"&&param<1E9)param=Math.round(param*1E10)/1E10;param=param.toString();if(!param)return;this._SetText(this._text+param);},TypewriterText:function TypewriterText(param,duration){this._CancelTypewriter();if(typeof param==="number"&&param<1E9)param=Math.round(param*1E10)/1E10;this._StartTypewriter(param.toString(),duration);},SetFontFace:function SetFontFace(face,style){var bold=false;var italic=false;switch(style){case 1:bold=true;break;case 2:italic=true;break;case 3:bold=true;italic=true;break;}if(face===this._faceName&&bold===this._isBold&&italic===this._isItalic)return;this._SetFontFace(face);this._SetBold(bold);this._SetItalic(italic);},SetFontSize:function SetFontSize(size){this._SetFontSize(size);},SetFontColor:function SetFontColor(rgb){_tempColor9.setFromRgbValue(rgb);_tempColor9.clamp();this._SetFontColor(_tempColor9);},SetWebFont:function SetWebFont(familyName,cssUrl){console.warn("[Text] 'Set web font' action is deprecated and no longer has any effect");},SetEffect:function SetEffect(effect){this.GetWorldInfo().SetBlendMode(effect);this._runtime.UpdateRender();},TypewriterFinish:function TypewriterFinish(){this._FinishTypewriter();},SetLineHeight:function SetLineHeight(lho){this._SetLineHeight(lho);},SetHAlign:function SetHAlign(h){this._SetHAlign(h);},SetVAlign:function SetVAlign(v){this._SetVAlign(v);},SetWrapping:function SetWrapping(w){this._SetWrapByWord(w===0);},SetTextDirection:function SetTextDirection(d){this._SetTextDirection(d);},ChangeIconSet:function ChangeIconSet(objectClass){this._SetIconObjectClass(objectClass);},UpdateHTML:function UpdateHTML(){return this._UpdateHTMLString();},SetReadAloud:function SetReadAloud(r){this._SetReadAloud(r);}};}{var _C209=self.C3;_C209.Plugins.Text.Exps={Text:function Text(){return this._text;},PlainText:function PlainText(){if(this._enableBBcode)return _C209.BBString.StripAnyTags(this._text);else return this._text;},FaceName:function FaceName(){return this._faceName;},FaceSize:function FaceSize(){return this._ptSize;},TextWidth:function TextWidth(){return this._GetTextWidth();},TextHeight:function TextHeight(){return this._GetTextHeight();},LineHeight:function LineHeight(){return this._lineHeightOffset;},TagAtPosition:function TagAtPosition(x,y){return this._GetTagAtPosition(x,y);},TagCount:function TagCount(tag){return this._GetTagCount(tag);},TagX:function TagX(tag,index){var ret=this._GetTagPosition(tag,index);return ret?ret.x:0;},TagY:function TagY(tag,index){var ret=this._GetTagPosition(tag,index);return ret?ret.y:0;},TagWidth:function TagWidth(tag,index){var ret=this._GetTagPosition(tag,index);return ret?ret.width:0;},TagHeight:function TagHeight(tag,index){var ret=this._GetTagPosition(tag,index);return ret?ret.height:0;},AsHTML:function AsHTML(){return this._htmlString;}};};}{'use strict';{var _C210=self.C3;var actionPromises=[];_C210.Plugins.Audio=/*#__PURE__*/function(_C210$SDKPluginBase){_inherits(AudioPlugin,_C210$SDKPluginBase);function AudioPlugin(opts){_classCallCheck(this,AudioPlugin);return _possibleConstructorReturn(this,_getPrototypeOf(AudioPlugin).call(this,opts));}_createClass(AudioPlugin,[{key:"_AddActionPromise",value:function _AddActionPromise(promise){actionPromises.push(promise);}},{key:"Release",value:function Release(){_get(_getPrototypeOf(AudioPlugin.prototype),"Release",this).call(this);}}],[{key:"WaitForAllActionPromises",value:function WaitForAllActionPromises(){return regeneratorRuntime.async(function WaitForAllActionPromises$(_context236){while(1){switch(_context236.prev=_context236.next){case 0:_context236.next=2;return regeneratorRuntime.awrap(Promise.all(actionPromises));case 2:_C210.clearArray(actionPromises);case 3:case"end":return _context236.stop();}}});}}]);return AudioPlugin;}(_C210.SDKPluginBase);}{var GetAudioDOMInterface=function GetAudioDOMInterface(){if(self["C3Audio_DOMInterface"])return self["C3Audio_DOMInterface"];else throw new Error("audio scripting API cannot be used here - make sure the project is using DOM mode, not worker mode");};var _C211=self.C3;var _C3X22=self.C3X;_C211.Plugins.Audio.Type=/*#__PURE__*/function(_C211$SDKTypeBase){_inherits(AudioType,_C211$SDKTypeBase);function AudioType(objectClass){_classCallCheck(this,AudioType);return _possibleConstructorReturn(this,_getPrototypeOf(AudioType).call(this,objectClass));}_createClass(AudioType,[{key:"Release",value:function Release(){_get(_getPrototypeOf(AudioType.prototype),"Release",this).call(this);}},{key:"OnCreate",value:function OnCreate(){}},{key:"GetScriptInterfaceClass",value:function GetScriptInterfaceClass(){return self.IAudioObjectType;}}]);return AudioType;}(_C211.SDKTypeBase);self.IAudioObjectType=/*#__PURE__*/function(_self$IObjectClass2){_inherits(IAudioObjectType,_self$IObjectClass2);function IAudioObjectType(objectType){_classCallCheck(this,IAudioObjectType);return _possibleConstructorReturn(this,_getPrototypeOf(IAudioObjectType).call(this,objectType));}_createClass(IAudioObjectType,[{key:"audioContext",get:function get(){return GetAudioDOMInterface()["GetAudioContextExtern"]();}},{key:"destinationNode",get:function get(){return GetAudioDOMInterface()["GetDestinationNodeExtern"]();}}]);return IAudioObjectType;}(self.IObjectClass);}{var _C212=self.C3;var DOM_COMPONENT_ID="audio";var LATENCY_HINTS=["interactive","balanced","playback"];_C212.Plugins.Audio.Instance=/*#__PURE__*/function(_C212$SDKInstanceBase){_inherits(AudioInstance,_C212$SDKInstanceBase);function AudioInstance(inst,properties){var _this184;_classCallCheck(this,AudioInstance);_this184=_possibleConstructorReturn(this,_getPrototypeOf(AudioInstance).call(this,inst,DOM_COMPONENT_ID));_this184._nextPlayTime=0;_this184._triggerTags=[];_this184._enableMultiTags=true;_this184._timeScaleMode=0;_this184._saveLoadMode=0;_this184._playInBackground=false;_this184._panningModel=1;_this184._distanceModel=1;_this184._listenerPos=[_this184._runtime.GetViewportWidth()/2,_this184._runtime.GetViewportHeight()/2,600];_this184._listenerForwardVec=[0,0,-1];_this184._listenerUpVec=[0,1,0];_this184._referenceDistance=600;_this184._maxDistance=1E4;_this184._rolloffFactor=1;_this184._listenerInst=null;_this184._loadListenerUid=-1;_this184._masterVolume=1;_this184._isSilent=false;_this184._sampleRate=0;_this184._audioContextState="suspended";_this184._outputLatency=0;_this184._effectCount=new Map();_this184._preloadTotal=0;_this184._preloadCount=0;_this184._bufferMetadata=new Map();_this184._remoteUrls=new Map();var latencyHint="interactive";if(properties){_this184._timeScaleMode=properties[0];_this184._saveLoadMode=properties[1];_this184._playInBackground=properties[2];latencyHint=LATENCY_HINTS[properties[3]];_this184._enableMultiTags=properties[4];_this184._panningModel=properties[5];_this184._distanceModel=properties[6];_this184._listenerPos[2]=properties[7];_this184._referenceDistance=properties[8];_this184._maxDistance=properties[9];_this184._rolloffFactor=properties[10];}_this184._lastAIState=[];_this184._lastFxState=[];_this184._lastAnalysersData=[];_this184.AddDOMMessageHandlers([["state",function(e){return _this184._OnUpdateState(e);}],["audiocontext-state",function(e){return _this184._OnAudioContextStateChanged(e);}],["fxstate",function(e){return _this184._OnUpdateFxState(e);}],["trigger",function(e){return _this184._OnTrigger(e);}],["buffer-metadata",function(e){return _this184._OnBufferMetadata(e);}]]);var rt=_this184.GetRuntime().Dispatcher();_this184._disposables=new _C212.CompositeDisposable(_C212.Disposable.From(rt,"instancedestroy",function(e){return _this184._OnInstanceDestroyed(e.instance);}),_C212.Disposable.From(rt,"afterload",function(){return _this184._OnAfterLoad();}),_C212.Disposable.From(rt,"suspend",function(){return _this184._OnSuspend();}),_C212.Disposable.From(rt,"resume",function(){return _this184._OnResume();}));_this184._runtime.AddLoadPromise(_this184.PostToDOMAsync("create-audio-context",{"preloadList":_this184._runtime.GetAssetManager().GetAudioToPreload().map(function(o){return{"originalUrl":o.originalUrl,"url":o.url,"type":o.type,"fileSize":o.fileSize};}),"isiOSCordova":_this184._runtime.IsiOSCordova(),"isSafari":_C212.Platform.Browser==="Safari","timeScaleMode":_this184._timeScaleMode,"latencyHint":latencyHint,"panningModel":_this184._panningModel,"distanceModel":_this184._distanceModel,"refDistance":_this184._referenceDistance,"maxDistance":_this184._maxDistance,"rolloffFactor":_this184._rolloffFactor,"listenerPos":_this184._listenerPos}).then(function(info){_this184._sampleRate=info["sampleRate"];_this184._audioContextState=info["audioContextState"];_this184._outputLatency=info["outputLatency"];}));_this184._StartTicking();return _this184;}_createClass(AudioInstance,[{key:"Release",value:function Release(){this._listenerInst=null;_get(_getPrototypeOf(AudioInstance.prototype),"Release",this).call(this);}},{key:"_SplitTags",value:function _SplitTags(tagStr){if(this._enableMultiTags)return tagStr.split(" ").filter(function(s){return!!s;});else return tagStr?[tagStr]:[];}},{key:"_MatchTagLists",value:function _MatchTagLists(tagArr1,tagArr2){var _iteratorNormalCompletion587=true;var _didIteratorError587=false;var _iteratorError587=undefined;try{for(var _iterator587=tagArr2[Symbol.iterator](),_step587;!(_iteratorNormalCompletion587=(_step587=_iterator587.next()).done);_iteratorNormalCompletion587=true){var t2=_step587.value;var found=false;var _iteratorNormalCompletion588=true;var _didIteratorError588=false;var _iteratorError588=undefined;try{for(var _iterator588=tagArr1[Symbol.iterator](),_step588;!(_iteratorNormalCompletion588=(_step588=_iterator588.next()).done);_iteratorNormalCompletion588=true){var t1=_step588.value;if(_C212.equalsNoCase(t1,t2)){found=true;break;}}}catch(err){_didIteratorError588=true;_iteratorError588=err;}finally{try{if(!_iteratorNormalCompletion588&&_iterator588["return"]!=null){_iterator588["return"]();}}finally{if(_didIteratorError588){throw _iteratorError588;}}}if(!found)return false;}}catch(err){_didIteratorError587=true;_iteratorError587=err;}finally{try{if(!_iteratorNormalCompletion587&&_iterator587["return"]!=null){_iterator587["return"]();}}finally{if(_didIteratorError587){throw _iteratorError587;}}}return true;}},{key:"_MatchTagListToStr",value:function _MatchTagListToStr(tagArr,tagStr){return this._MatchTagLists(tagArr,this._SplitTags(tagStr));}},{key:"_AddActionPromise",value:function _AddActionPromise(promise){this.GetPlugin()._AddActionPromise(promise);}},{key:"_OnInstanceDestroyed",value:function _OnInstanceDestroyed(inst){if(this._listenerInst===inst)this._listenerInst=null;}},{key:"DbToLinearNoCap",value:function DbToLinearNoCap(x){return Math.pow(10,x/20);}},{key:"DbToLinear",value:function DbToLinear(x){var v=this.DbToLinearNoCap(x);if(!isFinite(v))return 0;return Math.max(Math.min(v,1),0);}},{key:"LinearToDbNoCap",value:function LinearToDbNoCap(x){return Math.log(x)/Math.log(10)*20;}},{key:"LinearToDb",value:function LinearToDb(x){return this.LinearToDbNoCap(Math.max(Math.min(x,1),0));}},{key:"_OnSuspend",value:function _OnSuspend(){if(this._playInBackground)return;this.PostToDOM("set-suspended",{"isSuspended":true});}},{key:"_OnResume",value:function _OnResume(){if(this._playInBackground)return;this.PostToDOM("set-suspended",{"isSuspended":false});}},{key:"_OnUpdateState",value:function _OnUpdateState(e){var tickCount=e["tickCount"];this._outputLatency=e["outputLatency"];var preservePlaceholders=this._lastAIState.filter(function(ai){return ai.hasOwnProperty("placeholder")&&(ai["placeholder"]>tickCount||ai["placeholder"]===-1);});this._lastAIState=e["audioInstances"];this._lastAnalysersData=e["analysers"];if(preservePlaceholders.length>0)_C212.appendArray(this._lastAIState,preservePlaceholders);}},{key:"_OnBufferMetadata",value:function _OnBufferMetadata(e){this._bufferMetadata.set(e["originalUrl"],{duration:e["duration"]});}},{key:"_OnAudioContextStateChanged",value:function _OnAudioContextStateChanged(e){this._audioContextState=e["audioContextState"];}},{key:"GetAudioContextState",value:function GetAudioContextState(){if(this._runtime.IsExportToVideo())return"running";else return this._audioContextState;}},{key:"_OnUpdateFxState",value:function _OnUpdateFxState(e){this._lastFxState=e["fxstate"];}},{key:"_GetFirstAudioStateByTags",value:function _GetFirstAudioStateByTags(tagStr){var tagArr=this._SplitTags(tagStr);var _iteratorNormalCompletion589=true;var _didIteratorError589=false;var _iteratorError589=undefined;try{for(var _iterator589=this._lastAIState[Symbol.iterator](),_step589;!(_iteratorNormalCompletion589=(_step589=_iterator589.next()).done);_iteratorNormalCompletion589=true){var _a14=_step589.value;if(this._MatchTagLists(_a14["tags"],tagArr))return _a14;}}catch(err){_didIteratorError589=true;_iteratorError589=err;}finally{try{if(!_iteratorNormalCompletion589&&_iterator589["return"]!=null){_iterator589["return"]();}}finally{if(_didIteratorError589){throw _iteratorError589;}}}return null;}},{key:"_IsTagPlaying",value:function _IsTagPlaying(tagStr){var _this185=this;var tagArr=this._SplitTags(tagStr);return this._lastAIState.some(function(ai){return _this185._MatchTagLists(ai["tags"],tagArr)&&ai["isPlaying"];});}},{key:"_MaybeMarkAsPlaying",value:function _MaybeMarkAsPlaying(originalUrl,tagStr,isMusic,isLooping,vol){if(this._IsTagPlaying(tagStr))return null;var bufferMeta=this._bufferMetadata.get(originalUrl);var state={"tags":this._SplitTags(tagStr),"duration":bufferMeta?bufferMeta.duration:0,"volume":vol,"isPlaying":true,"playbackTime":0,"playbackRate":1,"uid":-1,"bufferOriginalUrl":originalUrl,"bufferUrl":"","bufferType":"","isMusic":isMusic,"isLooping":isLooping,"isMuted":false,"resumePosition":0,"pan":null,"placeholder":-1};this._lastAIState.push(state);return state;}},{key:"_OnTrigger",value:function _OnTrigger(e){var type,aiId,_iteratorNormalCompletion590,_didIteratorError590,_iteratorError590,_iterator590,_step590,aiState;return regeneratorRuntime.async(function _OnTrigger$(_context237){while(1){switch(_context237.prev=_context237.next){case 0:type=e["type"];this._triggerTags=e["tags"];aiId=e["aiid"];if(!(type==="ended")){_context237.next=35;break;}_iteratorNormalCompletion590=true;_didIteratorError590=false;_iteratorError590=undefined;_context237.prev=7;_iterator590=this._lastAIState[Symbol.iterator]();case 9:if(_iteratorNormalCompletion590=(_step590=_iterator590.next()).done){_context237.next=17;break;}aiState=_step590.value;if(!(aiState["aiid"]===aiId)){_context237.next=14;break;}aiState["isPlaying"]=false;return _context237.abrupt("break",17);case 14:_iteratorNormalCompletion590=true;_context237.next=9;break;case 17:_context237.next=23;break;case 19:_context237.prev=19;_context237.t0=_context237["catch"](7);_didIteratorError590=true;_iteratorError590=_context237.t0;case 23:_context237.prev=23;_context237.prev=24;if(!_iteratorNormalCompletion590&&_iterator590["return"]!=null){_iterator590["return"]();}case 26:_context237.prev=26;if(!_didIteratorError590){_context237.next=29;break;}throw _iteratorError590;case 29:return _context237.finish(26);case 30:return _context237.finish(23);case 31:_context237.next=33;return regeneratorRuntime.awrap(this.TriggerAsync(_C212.Plugins.Audio.Cnds.OnEnded));case 33:_context237.next=38;break;case 35:if(!(type==="fade-ended")){_context237.next=38;break;}_context237.next=38;return regeneratorRuntime.awrap(this.TriggerAsync(_C212.Plugins.Audio.Cnds.OnFadeEnded));case 38:case"end":return _context237.stop();}}},null,this,[[7,19,23,31],[24,,26,30]]);}},{key:"_MatchTriggerTag",value:function _MatchTriggerTag(tagStr){return this._MatchTagListToStr(this._triggerTags,tagStr);}},{key:"Tick",value:function Tick(){var o={"timeScale":this._runtime.GetTimeScale(),"gameTime":this._runtime.GetGameTimeRaw(),"instPans":this.GetInstancePans(),"tickCount":this._runtime.GetTickCountNoSave()};if(this._listenerInst){var wi=this._listenerInst.GetWorldInfo();this._listenerPos[0]=wi.GetX();this._listenerPos[1]=wi.GetY();o["listenerPos"]=this._listenerPos;o["listenerOrientation"]=[].concat(_toConsumableArray(this._listenerForwardVec),_toConsumableArray(this._listenerUpVec));}this.PostToDOM("tick",o);}},{key:"rotatePtAround",value:function rotatePtAround(px,py,a,ox,oy){if(a===0)return[px,py];var sin_a=Math.sin(a);var cos_a=Math.cos(a);px-=ox;py-=oy;var left_sin_a=px*sin_a;var top_sin_a=py*sin_a;var left_cos_a=px*cos_a;var top_cos_a=py*cos_a;px=left_cos_a-top_sin_a;py=top_cos_a+left_sin_a;px+=ox;py+=oy;return[px,py];}},{key:"GetInstancePans",value:function GetInstancePans(){var _this186=this;return this._lastAIState.filter(function(ai){return ai["uid"]!==-1;}).map(function(ai){return _this186._runtime.GetInstanceByUID(ai["uid"]);}).filter(function(inst){return inst;}).map(function(inst){var wi=inst.GetWorldInfo();var layerAngle=wi.GetLayer().GetAngle();var _this186$rotatePtArou=_this186.rotatePtAround(wi.GetX(),wi.GetY(),-layerAngle,_this186._listenerPos[0],_this186._listenerPos[1]),_this186$rotatePtArou2=_slicedToArray(_this186$rotatePtArou,2),x=_this186$rotatePtArou2[0],y=_this186$rotatePtArou2[1];return{"uid":inst.GetUID(),"x":x,"y":y,"z":wi.GetTotalZElevation(),"angle":wi.GetAngle()-layerAngle};});}},{key:"GetAnalyserData",value:function GetAnalyserData(tagStr,index){var _iteratorNormalCompletion591=true;var _didIteratorError591=false;var _iteratorError591=undefined;try{for(var _iterator591=this._lastAnalysersData[Symbol.iterator](),_step591;!(_iteratorNormalCompletion591=(_step591=_iterator591.next()).done);_iteratorNormalCompletion591=true){var o=_step591.value;if(o.index===index&&_C212.equalsNoCase(o["tag"],tagStr))return o;}}catch(err){_didIteratorError591=true;_iteratorError591=err;}finally{try{if(!_iteratorNormalCompletion591&&_iterator591["return"]!=null){_iterator591["return"]();}}finally{if(_didIteratorError591){throw _iteratorError591;}}}return null;}},{key:"_IncrementEffectCount",value:function _IncrementEffectCount(tagStr){var _iteratorNormalCompletion592=true;var _didIteratorError592=false;var _iteratorError592=undefined;try{for(var _iterator592=this._SplitTags(tagStr)[Symbol.iterator](),_step592;!(_iteratorNormalCompletion592=(_step592=_iterator592.next()).done);_iteratorNormalCompletion592=true){var tag=_step592.value;var lowerTag=tag.toLowerCase();this._effectCount.set(lowerTag,(this._effectCount.get(lowerTag)||0)+1);}}catch(err){_didIteratorError592=true;_iteratorError592=err;}finally{try{if(!_iteratorNormalCompletion592&&_iterator592["return"]!=null){_iterator592["return"]();}}finally{if(_didIteratorError592){throw _iteratorError592;}}}}},{key:"_ShouldSave",value:function _ShouldSave(ai){if(ai.hasOwnProperty("placeholder"))return false;if(this._saveLoadMode===3)return false;else if(ai["isMusic"]&&this._saveLoadMode===1)return false;else if(!ai["isMusic"]&&this._saveLoadMode===2)return false;else return true;}},{key:"SaveToJson",value:function SaveToJson(){var _this187=this;return{"isSilent":this._isSilent,"masterVolume":this._masterVolume,"listenerZ":this._listenerPos[2],"listenerForwardVec":this._listenerForwardVec,"listenerUpVec":this._listenerUpVec,"listenerUid":this._listenerInst?this._listenerInst.GetUID():-1,"remoteUrls":_toConsumableArray(this._remoteUrls.entries()),"playing":this._lastAIState.filter(function(ai){return _this187._ShouldSave(ai);}),"effects":this._lastFxState,"analysers":this._lastAnalysersData};}},{key:"LoadFromJson",value:function LoadFromJson(o){this._isSilent=o["isSilent"];this._masterVolume=o["masterVolume"];this._listenerPos[2]=o["listenerZ"];this._listenerInst=null;this._loadListenerUid=o["listenerUid"];if(o.hasOwnProperty("listenerForwardVec"))this._listenerForwardVec=o["listenerForwardVec"];else this._listenerForwardVec=[0,0,-1];if(o.hasOwnProperty("listenerUpVec"))this._listenerUpVec=o["listenerUpVec"];else this._listenerUpVec=[0,1,0];this._remoteUrls.clear();if(o["remoteUrls"]){var _iteratorNormalCompletion593=true;var _didIteratorError593=false;var _iteratorError593=undefined;try{for(var _iterator593=o["remoteUrls"][Symbol.iterator](),_step593;!(_iteratorNormalCompletion593=(_step593=_iterator593.next()).done);_iteratorNormalCompletion593=true){var _step593$value=_slicedToArray(_step593.value,2),k=_step593$value[0],v=_step593$value[1];this._remoteUrls.set(k,v);}}catch(err){_didIteratorError593=true;_iteratorError593=err;}finally{try{if(!_iteratorNormalCompletion593&&_iterator593["return"]!=null){_iterator593["return"]();}}finally{if(_didIteratorError593){throw _iteratorError593;}}}}this._lastAIState=o["playing"];var _iteratorNormalCompletion594=true;var _didIteratorError594=false;var _iteratorError594=undefined;try{for(var _iterator594=this._lastAIState[Symbol.iterator](),_step594;!(_iteratorNormalCompletion594=(_step594=_iterator594.next()).done);_iteratorNormalCompletion594=true){var _a15=_step594.value;if(_a15.hasOwnProperty("tag")&&!_a15.hasOwnProperty("tags"))_a15["tags"]=[_a15["tag"]].filter(function(s){return!!s;});}}catch(err){_didIteratorError594=true;_iteratorError594=err;}finally{try{if(!_iteratorNormalCompletion594&&_iterator594["return"]!=null){_iterator594["return"]();}}finally{if(_didIteratorError594){throw _iteratorError594;}}}this._lastFxState=o["effects"];this._lastAnalysersData=o["analysers"];}},{key:"_OnAfterLoad",value:function _OnAfterLoad(){if(this._loadListenerUid!==-1){this._listenerInst=this._runtime.GetInstanceByUID(this._loadListenerUid);this._loadListenerUid=-1;if(this._listenerInst){var wi=this._listenerInst.GetWorldInfo();this._listenerPos[0]=wi.GetX();this._listenerPos[1]=wi.GetY();}}var _iteratorNormalCompletion595=true;var _didIteratorError595=false;var _iteratorError595=undefined;try{for(var _iterator595=this._lastAIState[Symbol.iterator](),_step595;!(_iteratorNormalCompletion595=(_step595=_iterator595.next()).done);_iteratorNormalCompletion595=true){var ai=_step595.value;var info=this._runtime.GetAssetManager().GetProjectAudioFileUrl(ai["bufferOriginalUrl"]);if(info){ai["bufferUrl"]=info.url;ai["bufferType"]=info.type;}else ai["bufferUrl"]=null;}}catch(err){_didIteratorError595=true;_iteratorError595=err;}finally{try{if(!_iteratorNormalCompletion595&&_iterator595["return"]!=null){_iterator595["return"]();}}finally{if(_didIteratorError595){throw _iteratorError595;}}}for(var _i88=0,_Object$values=Object.values(this._lastFxState);_i88<_Object$values.length;_i88++){var fxChainData=_Object$values[_i88];var _iteratorNormalCompletion596=true;var _didIteratorError596=false;var _iteratorError596=undefined;try{for(var _iterator596=fxChainData[Symbol.iterator](),_step596;!(_iteratorNormalCompletion596=(_step596=_iterator596.next()).done);_iteratorNormalCompletion596=true){var fxData=_step596.value;if(fxData.hasOwnProperty("bufferOriginalUrl")){var _info=this._runtime.GetAssetManager().GetProjectAudioFileUrl(fxData["bufferOriginalUrl"]);if(_info){fxData["bufferUrl"]=_info.url;fxData["bufferType"]=_info.type;}}}}catch(err){_didIteratorError596=true;_iteratorError596=err;}finally{try{if(!_iteratorNormalCompletion596&&_iterator596["return"]!=null){_iterator596["return"]();}}finally{if(_didIteratorError596){throw _iteratorError596;}}}}this.PostToDOM("load-state",{"saveLoadMode":this._saveLoadMode,"timeScale":this._runtime.GetTimeScale(),"gameTime":this._runtime.GetGameTimeRaw(),"listenerPos":this._listenerPos,"listenerOrientation":[].concat(_toConsumableArray(this._listenerForwardVec),_toConsumableArray(this._listenerUpVec)),"isSilent":this._isSilent,"masterVolume":this._masterVolume,"playing":this._lastAIState.filter(function(ai){return ai["bufferUrl"]!==null;}),"effects":this._lastFxState});}},{key:"GetDebuggerProperties",value:function GetDebuggerProperties(){var fxProps=[];for(var _i89=0,_Object$entries25=Object.entries(this._lastFxState);_i89<_Object$entries25.length;_i89++){var _Object$entries25$_i=_slicedToArray(_Object$entries25[_i89],2),tag=_Object$entries25$_i[0],fxChainData=_Object$entries25$_i[1];fxProps.push({name:"$"+tag,value:fxChainData.map(function(d){return d["type"];}).join(", ")});}var prefix="plugins.audio.debugger";return[{title:prefix+".tag-effects",properties:fxProps},{title:prefix+".currently-playing",properties:[{name:prefix+".currently-playing-count",value:this._lastAIState.length}].concat(_toConsumableArray(this._lastAIState.map(function(s,index){return{name:"$#"+index,value:"".concat(s["bufferOriginalUrl"]," (\"").concat(s["tags"],"\") ").concat(Math.round(s["playbackTime"]*10)/10," / ").concat(Math.round(s["duration"]*10)/10)};})))}];}}]);return AudioInstance;}(_C212.SDKInstanceBase);}{var _C213=self.C3;_C213.Plugins.Audio.Cnds={OnEnded:function OnEnded(tagStr){return this._MatchTriggerTag(tagStr);},OnFadeEnded:function OnFadeEnded(tagStr){return this._MatchTriggerTag(tagStr);},PreloadsComplete:function PreloadsComplete(){return this._preloadCount===this._preloadTotal;},AdvancedAudioSupported:function AdvancedAudioSupported(){return true;},IsSilent:function IsSilent(){return this._isSilent;},IsAnyPlaying:function IsAnyPlaying(){var _iteratorNormalCompletion597=true;var _didIteratorError597=false;var _iteratorError597=undefined;try{for(var _iterator597=this._lastAIState[Symbol.iterator](),_step597;!(_iteratorNormalCompletion597=(_step597=_iterator597.next()).done);_iteratorNormalCompletion597=true){var ai=_step597.value;if(ai["isPlaying"])return true;}}catch(err){_didIteratorError597=true;_iteratorError597=err;}finally{try{if(!_iteratorNormalCompletion597&&_iterator597["return"]!=null){_iterator597["return"]();}}finally{if(_didIteratorError597){throw _iteratorError597;}}}return false;},IsTagPlaying:function IsTagPlaying(tagStr){return this._IsTagPlaying(tagStr);}};}{var _C214=self.C3;var FILTER_TYPES=["lowpass","highpass","bandpass","lowshelf","highshelf","peaking","notch","allpass"];_C214.Plugins.Audio.Acts={Play:function Play(file,looping,vol,stereoPan,tagStr){var ret=_C214.Plugins.Audio.Acts._DoPlay.call(this,file,looping,vol,stereoPan,tagStr);this._AddActionPromise(ret);return ret;},PlayFromTimeline:function PlayFromTimeline(file,vol,tagStr,startOffset){_C214.Plugins.Audio.Acts._DoPlay.call(this,file,0,vol,0,tagStr,startOffset);},_DoPlay:function _DoPlay(file,looping,vol,stereoPan,tagStr,startOffset){var isMusic,info,nextPlayTime,state;return regeneratorRuntime.async(function _DoPlay$(_context238){while(1){switch(_context238.prev=_context238.next){case 0:if(!this._isSilent){_context238.next=2;break;}return _context238.abrupt("return");case 2:isMusic=file[1];info=this._runtime.GetAssetManager().GetProjectAudioFileUrl(file[0]);if(info){_context238.next=6;break;}return _context238.abrupt("return");case 6:nextPlayTime=this._nextPlayTime;this._nextPlayTime=0;state=this._MaybeMarkAsPlaying(file[0],tagStr,isMusic,looping!==0,this.DbToLinear(vol));_context238.prev=9;_context238.next=12;return regeneratorRuntime.awrap(this.PostToDOMAsync("play",{"originalUrl":file[0],"url":info.url,"type":info.type,"isMusic":isMusic,"tags":this._SplitTags(tagStr),"isLooping":looping!==0,"vol":this.DbToLinear(vol),"stereoPan":_C214.clamp(stereoPan/100,-1,1),"pos":startOffset||0,"off":nextPlayTime,"trueClock":!!self["C3_GetAudioContextCurrentTime"]}));case 12:_context238.prev=12;if(state)state["placeholder"]=this._runtime.GetTickCountNoSave();return _context238.finish(12);case 15:case"end":return _context238.stop();}}},null,this,[[9,,12,15]]);},PlayAtPosition:function PlayAtPosition(file,looping,vol,x,y,z,angle,innerAngle,outerAngle,outerGain,tagStr){var isMusic,info,nextPlayTime,state;return regeneratorRuntime.async(function PlayAtPosition$(_context239){while(1){switch(_context239.prev=_context239.next){case 0:if(!this._isSilent){_context239.next=2;break;}return _context239.abrupt("return");case 2:isMusic=file[1];info=this._runtime.GetAssetManager().GetProjectAudioFileUrl(file[0]);if(info){_context239.next=6;break;}return _context239.abrupt("return");case 6:nextPlayTime=this._nextPlayTime;this._nextPlayTime=0;state=this._MaybeMarkAsPlaying(file[0],tagStr,isMusic,looping!==0,this.DbToLinear(vol));_context239.prev=9;_context239.next=12;return regeneratorRuntime.awrap(this.PostToDOMAsync("play",{"originalUrl":file[0],"url":info.url,"type":info.type,"isMusic":isMusic,"tags":this._SplitTags(tagStr),"isLooping":looping!==0,"vol":this.DbToLinear(vol),"pos":0,"off":nextPlayTime,"trueClock":!!self["C3_GetAudioContextCurrentTime"],"panning":{"x":x,"y":y,"z":z,"angle":_C214.toRadians(angle),"innerAngle":_C214.toRadians(innerAngle),"outerAngle":_C214.toRadians(outerAngle),"outerGain":this.DbToLinear(outerGain)}}));case 12:_context239.prev=12;if(state)state["placeholder"]=this._runtime.GetTickCountNoSave();return _context239.finish(12);case 15:case"end":return _context239.stop();}}},null,this,[[9,,12,15]]);},PlayAtObject:function PlayAtObject(file,looping,vol,objectClass,innerAngle,outerAngle,outerGain,tagStr){var inst,wi,layerAngle,_this$rotatePtAround,_this$rotatePtAround2,x,y,isMusic,info,nextPlayTime,state;return regeneratorRuntime.async(function PlayAtObject$(_context240){while(1){switch(_context240.prev=_context240.next){case 0:if(!this._isSilent){_context240.next=2;break;}return _context240.abrupt("return");case 2:if(objectClass){_context240.next=4;break;}return _context240.abrupt("return");case 4:inst=objectClass.GetFirstPicked();if(!(!inst||!inst.GetWorldInfo())){_context240.next=7;break;}return _context240.abrupt("return");case 7:wi=inst.GetWorldInfo();layerAngle=wi.GetLayer().GetAngle();_this$rotatePtAround=this.rotatePtAround(wi.GetX(),wi.GetY(),-layerAngle,this._listenerPos[0],this._listenerPos[1]),_this$rotatePtAround2=_slicedToArray(_this$rotatePtAround,2),x=_this$rotatePtAround2[0],y=_this$rotatePtAround2[1];isMusic=file[1];info=this._runtime.GetAssetManager().GetProjectAudioFileUrl(file[0]);if(info){_context240.next=14;break;}return _context240.abrupt("return");case 14:nextPlayTime=this._nextPlayTime;this._nextPlayTime=0;state=this._MaybeMarkAsPlaying(file[0],tagStr,isMusic,looping!==0,this.DbToLinear(vol));_context240.prev=17;_context240.next=20;return regeneratorRuntime.awrap(this.PostToDOMAsync("play",{"originalUrl":file[0],"url":info.url,"type":info.type,"isMusic":isMusic,"tags":this._SplitTags(tagStr),"isLooping":looping!==0,"vol":this.DbToLinear(vol),"pos":0,"off":nextPlayTime,"trueClock":!!self["C3_GetAudioContextCurrentTime"],"panning":{"x":x,"y":y,"z":wi.GetTotalZElevation(),"angle":wi.GetAngle()-layerAngle,"innerAngle":_C214.toRadians(innerAngle),"outerAngle":_C214.toRadians(outerAngle),"outerGain":this.DbToLinear(outerGain),"uid":inst.GetUID()}}));case 20:_context240.prev=20;if(state)state["placeholder"]=this._runtime.GetTickCountNoSave();return _context240.finish(20);case 23:case"end":return _context240.stop();}}},null,this,[[17,,20,23]]);},PlayByName:function PlayByName(folder,filename,looping,vol,stereoPan,tagStr){var isMusic,info,nextPlayTime,state;return regeneratorRuntime.async(function PlayByName$(_context241){while(1){switch(_context241.prev=_context241.next){case 0:if(!this._isSilent){_context241.next=2;break;}return _context241.abrupt("return");case 2:isMusic=folder===1;info=this._runtime.GetAssetManager().GetProjectAudioFileUrl(filename)||this._remoteUrls.get(filename.toLowerCase());if(info){_context241.next=6;break;}return _context241.abrupt("return");case 6:nextPlayTime=this._nextPlayTime;this._nextPlayTime=0;state=this._MaybeMarkAsPlaying(filename,tagStr,isMusic,looping!==0,this.DbToLinear(vol));_context241.prev=9;_context241.next=12;return regeneratorRuntime.awrap(this.PostToDOMAsync("play",{"originalUrl":filename,"url":info.url,"type":info.type,"isMusic":isMusic,"tags":this._SplitTags(tagStr),"isLooping":looping!==0,"vol":this.DbToLinear(vol),"stereoPan":_C214.clamp(stereoPan/100,-1,1),"pos":0,"off":nextPlayTime,"trueClock":!!self["C3_GetAudioContextCurrentTime"]}));case 12:_context241.prev=12;if(state)state["placeholder"]=this._runtime.GetTickCountNoSave();return _context241.finish(12);case 15:case"end":return _context241.stop();}}},null,this,[[9,,12,15]]);},PlayAtPositionByName:function PlayAtPositionByName(folder,filename,looping,vol,x,y,z,angle,innerAngle,outerAngle,outerGain,tagStr){var isMusic,info,nextPlayTime,state;return regeneratorRuntime.async(function PlayAtPositionByName$(_context242){while(1){switch(_context242.prev=_context242.next){case 0:if(!this._isSilent){_context242.next=2;break;}return _context242.abrupt("return");case 2:isMusic=folder===1;info=this._runtime.GetAssetManager().GetProjectAudioFileUrl(filename)||this._remoteUrls.get(filename.toLowerCase());if(info){_context242.next=6;break;}return _context242.abrupt("return");case 6:nextPlayTime=this._nextPlayTime;this._nextPlayTime=0;state=this._MaybeMarkAsPlaying(filename,tagStr,isMusic,looping!==0,this.DbToLinear(vol));_context242.prev=9;_context242.next=12;return regeneratorRuntime.awrap(this.PostToDOMAsync("play",{"originalUrl":filename,"url":info.url,"type":info.type,"isMusic":isMusic,"tags":this._SplitTags(tagStr),"isLooping":looping!==0,"vol":this.DbToLinear(vol),"pos":0,"off":nextPlayTime,"trueClock":!!self["C3_GetAudioContextCurrentTime"],"panning":{"x":x,"y":y,"z":z,"angle":_C214.toRadians(angle),"innerAngle":_C214.toRadians(innerAngle),"outerAngle":_C214.toRadians(outerAngle),"outerGain":this.DbToLinear(outerGain)}}));case 12:_context242.prev=12;if(state)state["placeholder"]=this._runtime.GetTickCountNoSave();return _context242.finish(12);case 15:case"end":return _context242.stop();}}},null,this,[[9,,12,15]]);},PlayAtObjectByName:function PlayAtObjectByName(folder,filename,looping,vol,objectClass,innerAngle,outerAngle,outerGain,tagStr){var inst,wi,layerAngle,_this$rotatePtAround3,_this$rotatePtAround4,x,y,isMusic,info,nextPlayTime,state;return regeneratorRuntime.async(function PlayAtObjectByName$(_context243){while(1){switch(_context243.prev=_context243.next){case 0:if(!this._isSilent){_context243.next=2;break;}return _context243.abrupt("return");case 2:if(!this._isSilent){_context243.next=4;break;}return _context243.abrupt("return");case 4:if(objectClass){_context243.next=6;break;}return _context243.abrupt("return");case 6:inst=objectClass.GetFirstPicked();if(!(!inst||!inst.GetWorldInfo())){_context243.next=9;break;}return _context243.abrupt("return");case 9:wi=inst.GetWorldInfo();layerAngle=wi.GetLayer().GetAngle();_this$rotatePtAround3=this.rotatePtAround(wi.GetX(),wi.GetY(),-layerAngle,this._listenerPos[0],this._listenerPos[1]),_this$rotatePtAround4=_slicedToArray(_this$rotatePtAround3,2),x=_this$rotatePtAround4[0],y=_this$rotatePtAround4[1];isMusic=folder===1;info=this._runtime.GetAssetManager().GetProjectAudioFileUrl(filename)||this._remoteUrls.get(filename.toLowerCase());if(info){_context243.next=16;break;}return _context243.abrupt("return");case 16:nextPlayTime=this._nextPlayTime;this._nextPlayTime=0;state=this._MaybeMarkAsPlaying(filename,tagStr,isMusic,looping!==0,this.DbToLinear(vol));_context243.prev=19;_context243.next=22;return regeneratorRuntime.awrap(this.PostToDOMAsync("play",{"originalUrl":filename,"url":info.url,"type":info.type,"isMusic":isMusic,"tags":this._SplitTags(tagStr),"isLooping":looping!==0,"vol":this.DbToLinear(vol),"pos":0,"off":nextPlayTime,"trueClock":!!self["C3_GetAudioContextCurrentTime"],"panning":{"x":x,"y":y,"z":wi.GetTotalZElevation(),"angle":wi.GetAngle()-layerAngle,"innerAngle":_C214.toRadians(innerAngle),"outerAngle":_C214.toRadians(outerAngle),"outerGain":this.DbToLinear(outerGain),"uid":inst.GetUID()}}));case 22:_context243.prev=22;if(state)state["placeholder"]=this._runtime.GetTickCountNoSave();return _context243.finish(22);case 25:case"end":return _context243.stop();}}},null,this,[[19,,22,25]]);},SetLooping:function SetLooping(tagStr,looping){this.PostToDOM("set-looping",{"tags":this._SplitTags(tagStr),"isLooping":looping===0});},SetMuted:function SetMuted(tagStr,muted){this.PostToDOM("set-muted",{"tags":this._SplitTags(tagStr),"isMuted":muted===0});},SetVolume:function SetVolume(tagStr,vol){this.PostToDOM("set-volume",{"tags":this._SplitTags(tagStr),"vol":this.DbToLinear(vol)});},FadeVolume:function FadeVolume(tagStr,vol,duration,ending){this.PostToDOM("fade-volume",{"tags":this._SplitTags(tagStr),"vol":this.DbToLinear(vol),"duration":duration,"stopOnEnd":ending===0});},SetStereoPan:function SetStereoPan(tagStr,p){this.PostToDOM("set-stereo-pan",{"tags":this._SplitTags(tagStr),"p":_C214.clamp(p/100,-1,1)});},Preload:function Preload(file){var isMusic,info;return regeneratorRuntime.async(function Preload$(_context244){while(1){switch(_context244.prev=_context244.next){case 0:isMusic=file[1];info=this._runtime.GetAssetManager().GetProjectAudioFileUrl(file[0]);if(info){_context244.next=4;break;}return _context244.abrupt("return");case 4:this._preloadTotal++;_context244.next=7;return regeneratorRuntime.awrap(this.PostToDOMAsync("preload",{"originalUrl":file[0],"url":info.url,"type":info.type,"isMusic":isMusic}));case 7:this._preloadCount++;case 8:case"end":return _context244.stop();}}},null,this);},PreloadByName:function PreloadByName(folder,filename){var isMusic,info;return regeneratorRuntime.async(function PreloadByName$(_context245){while(1){switch(_context245.prev=_context245.next){case 0:isMusic=folder===1;info=this._runtime.GetAssetManager().GetProjectAudioFileUrl(filename)||this._remoteUrls.get(filename.toLowerCase());if(info){_context245.next=4;break;}return _context245.abrupt("return");case 4:this._preloadTotal++;_context245.next=7;return regeneratorRuntime.awrap(this.PostToDOMAsync("preload",{"originalUrl":filename,"url":info.url,"type":info.type,"isMusic":isMusic}));case 7:this._preloadCount++;case 8:case"end":return _context245.stop();}}},null,this);},SetPlaybackRate:function SetPlaybackRate(tagStr,rate){this.PostToDOM("set-playback-rate",{"tags":this._SplitTags(tagStr),"rate":Math.max(rate,0)});},Stop:function Stop(tagStr){this.PostToDOM("stop",{"tags":this._SplitTags(tagStr)});},StopAll:function StopAll(){this.PostToDOM("stop-all");},SetPaused:function SetPaused(tagStr,state){this.PostToDOM("set-paused",{"tags":this._SplitTags(tagStr),"paused":state===0});},Seek:function Seek(tagStr,pos){this.PostToDOM("seek",{"tags":this._SplitTags(tagStr),"pos":pos});},SetSilent:function SetSilent(s){if(s===2)s=this._isSilent?1:0;s=s===0;if(this._isSilent===s)return;this._isSilent=s;this.PostToDOM("set-silent",{"isSilent":s});},SetMasterVolume:function SetMasterVolume(vol){var mv=this.DbToLinear(vol);if(this._masterVolume===mv)return;this._masterVolume=mv;this.PostToDOM("set-master-volume",{"vol":mv});},AddFilterEffect:function AddFilterEffect(tagStr,type,freq,detune,q,gain,mix){var typeStr=FILTER_TYPES[type];this._IncrementEffectCount(tagStr);this.PostToDOM("add-effect",{"type":"filter","tags":this._SplitTags(tagStr),"params":[typeStr,freq,detune,q,gain,_C214.clamp(mix/100,0,1)]});},AddDelayEffect:function AddDelayEffect(tagStr,delay,gain,mix){this._IncrementEffectCount(tagStr);this.PostToDOM("add-effect",{"type":"delay","tags":this._SplitTags(tagStr),"params":[delay,this.DbToLinear(gain),_C214.clamp(mix/100,0,1)]});},AddFlangerEffect:function AddFlangerEffect(tagStr,delay,modulation,freq,feedback,mix){this._IncrementEffectCount(tagStr);this.PostToDOM("add-effect",{"type":"flanger","tags":this._SplitTags(tagStr),"params":[delay/1E3,modulation/1E3,freq,feedback/100,_C214.clamp(mix/100,0,1)]});},AddPhaserEffect:function AddPhaserEffect(tagStr,freq,detune,q,mod,modfreq,mix){this._IncrementEffectCount(tagStr);this.PostToDOM("add-effect",{"type":"phaser","tags":this._SplitTags(tagStr),"params":[freq,detune,q,mod,modfreq,_C214.clamp(mix/100,0,1)]});},AddConvolutionEffect:function AddConvolutionEffect(tagStr,file,norm,mix){var info=this._runtime.GetAssetManager().GetProjectAudioFileUrl(file[0]);if(!info)return;this._IncrementEffectCount(tagStr);this.PostToDOM("add-effect",{"type":"convolution","tags":this._SplitTags(tagStr),"bufferOriginalUrl":file[0],"bufferUrl":info.url,"bufferType":info.type,"params":[norm===0,_C214.clamp(mix/100,0,1)]});},AddGainEffect:function AddGainEffect(tagStr,g){this._IncrementEffectCount(tagStr);this.PostToDOM("add-effect",{"type":"gain","tags":this._SplitTags(tagStr),"params":[this.DbToLinear(g)]});},AddStereoPanEffect:function AddStereoPanEffect(tagStr,g){this._IncrementEffectCount(tagStr);this.PostToDOM("add-effect",{"type":"stereopan","tags":this._SplitTags(tagStr),"params":[_C214.clamp(g/100,-1,1)]});},AddMuteEffect:function AddMuteEffect(tagStr){this._IncrementEffectCount(tagStr);this.PostToDOM("add-effect",{"type":"gain","tags":this._SplitTags(tagStr),"params":[0]});},AddTremoloEffect:function AddTremoloEffect(tagStr,freq,mix){this._IncrementEffectCount(tagStr);this.PostToDOM("add-effect",{"type":"tremolo","tags":this._SplitTags(tagStr),"params":[freq,_C214.clamp(mix/100,0,1)]});},AddRingModEffect:function AddRingModEffect(tagStr,freq,mix){this._IncrementEffectCount(tagStr);this.PostToDOM("add-effect",{"type":"ringmod","tags":this._SplitTags(tagStr),"params":[freq,_C214.clamp(mix/100,0,1)]});},AddDistortionEffect:function AddDistortionEffect(tagStr,threshold,headroom,drive,makeupgain,mix){this._IncrementEffectCount(tagStr);this.PostToDOM("add-effect",{"type":"distortion","tags":this._SplitTags(tagStr),"params":[this.DbToLinearNoCap(threshold),this.DbToLinearNoCap(headroom),drive,this.DbToLinearNoCap(makeupgain),_C214.clamp(mix/100,0,1)]});},AddCompressorEffect:function AddCompressorEffect(tagStr,threshold,knee,ratio,attack,release){this._IncrementEffectCount(tagStr);this.PostToDOM("add-effect",{"type":"compressor","tags":this._SplitTags(tagStr),"params":[threshold,knee,ratio,attack/1E3,release/1E3]});},AddAnalyserEffect:function AddAnalyserEffect(tagStr,fftSize,smoothing){this._IncrementEffectCount(tagStr);this.PostToDOM("add-effect",{"type":"analyser","tags":this._SplitTags(tagStr),"params":[fftSize,smoothing]});},RemoveEffects:function RemoveEffects(tagStr){var tagArr=this._SplitTags(tagStr);var _iteratorNormalCompletion598=true;var _didIteratorError598=false;var _iteratorError598=undefined;try{for(var _iterator598=tagArr[Symbol.iterator](),_step598;!(_iteratorNormalCompletion598=(_step598=_iterator598.next()).done);_iteratorNormalCompletion598=true){var tag=_step598.value;this._effectCount.set(tag.toLowerCase(),0);}}catch(err){_didIteratorError598=true;_iteratorError598=err;}finally{try{if(!_iteratorNormalCompletion598&&_iterator598["return"]!=null){_iterator598["return"]();}}finally{if(_didIteratorError598){throw _iteratorError598;}}}this.PostToDOM("remove-effects",{"tags":tagArr});this._lastFxState={};},SetEffectParameter:function SetEffectParameter(tagStr,index,param,value,ramp,time){this.PostToDOM("set-effect-param",{"tags":this._SplitTags(tagStr),"index":Math.floor(index),"param":param,"value":value,"ramp":ramp,"time":time});},SetListenerObject:function SetListenerObject(objectClass){if(!objectClass)return;var inst=objectClass.GetFirstPicked();if(!inst||!inst.GetWorldInfo())return;this._listenerInst=inst;},SetListenerZ:function SetListenerZ(z){this._listenerPos[2]=z;},SetListenerOrientation:function SetListenerOrientation(fx,fy,fz,ux,uy,uz){this._listenerForwardVec[0]=fx;this._listenerForwardVec[1]=fy;this._listenerForwardVec[2]=-fz;this._listenerUpVec[0]=ux;this._listenerUpVec[1]=uy;this._listenerUpVec[2]=-uz;},ScheduleNextPlay:function ScheduleNextPlay(t){this._nextPlayTime=Math.max(t,0);},UnloadAudio:function UnloadAudio(file){var isMusic=file[1];var info=this._runtime.GetAssetManager().GetProjectAudioFileUrl(file[0]);if(!info)return;this.PostToDOM("unload",{"url":info.url,"type":info.type,"isMusic":isMusic});},UnloadAudioByName:function UnloadAudioByName(folder,filename){var isMusic=folder===1;var info=this._runtime.GetAssetManager().GetProjectAudioFileUrl(filename)||this._remoteUrls.get(filename.toLowerCase());if(!info)return;this.PostToDOM("unload",{"url":info.url,"type":info.type,"isMusic":isMusic});},UnloadAll:function UnloadAll(){this.PostToDOM("unload-all");},AddRemoteURL:function AddRemoteURL(url,type,name){this._remoteUrls.set(name.toLowerCase(),{url:url,type:type});}};}{var _C215=self.C3;_C215.Plugins.Audio.Exps={Duration:function Duration(tagStr){var a=this._GetFirstAudioStateByTags(tagStr);return a?a["duration"]:0;},PlaybackTime:function PlaybackTime(tagStr){var a=this._GetFirstAudioStateByTags(tagStr);return a?a["playbackTime"]:0;},PlaybackRate:function PlaybackRate(tagStr){var a=this._GetFirstAudioStateByTags(tagStr);return a?a["playbackRate"]:0;},Volume:function Volume(tagStr){var a=this._GetFirstAudioStateByTags(tagStr);return a?this.LinearToDb(a["volume"]):0;},MasterVolume:function MasterVolume(){return this.LinearToDb(this._masterVolume);},EffectCount:function EffectCount(tag){return this._effectCount.get(tag.toLowerCase())||0;},AnalyserFreqBinCount:function AnalyserFreqBinCount(tagStr,index){var o=this.GetAnalyserData(tagStr,Math.floor(index));return o?o["binCount"]:0;},AnalyserFreqBinAt:function AnalyserFreqBinAt(tagStr,index,bin){var o=this.GetAnalyserData(tagStr,Math.floor(index));if(!o)return 0;bin=Math.floor(bin);if(bin<0||bin>=o["binCount"])return 0;return o["freqBins"][bin];},AnalyserPeakLevel:function AnalyserPeakLevel(tagStr,index){var o=this.GetAnalyserData(tagStr,Math.floor(index));return o?o["peak"]:0;},AnalyserRMSLevel:function AnalyserRMSLevel(tagStr,index){var o=this.GetAnalyserData(tagStr,Math.floor(index));return o?o["rms"]:0;},SampleRate:function SampleRate(){return this._sampleRate;},CurrentTime:function CurrentTime(){if(self["C3_GetAudioContextCurrentTime"])return self["C3_GetAudioContextCurrentTime"]();else return performance.now()/1E3;},OutputLatency:function OutputLatency(){return this._outputLatency;}};};}{'use strict';{var _C216=self.C3;var _DOM_COMPONENT_ID="user-media";_C216.Plugins.UserMedia=/*#__PURE__*/function(_C216$SDKDOMPluginBas){_inherits(UserMediaPlugin,_C216$SDKDOMPluginBas);function UserMediaPlugin(opts){var _this188;_classCallCheck(this,UserMediaPlugin);_this188=_possibleConstructorReturn(this,_getPrototypeOf(UserMediaPlugin).call(this,opts,_DOM_COMPONENT_ID));_this188._lastStateSequenceNumber=-1;_this188._videoState=new Map();_this188.AddElementMessageHandler("video-ready",function(sdkInst,e){return sdkInst._OnVideoReady(e);});_this188._runtime.AddDOMComponentMessageHandler(_DOM_COMPONENT_ID,"state",function(e){return _this188._OnUpdateState(e);});return _this188;}_createClass(UserMediaPlugin,[{key:"Release",value:function Release(){_get(_getPrototypeOf(UserMediaPlugin.prototype),"Release",this).call(this);}},{key:"_OnUpdateState",value:function _OnUpdateState(stateData){var sequenceNumber=stateData["sequenceNumber"];if(sequenceNumber<=this._lastStateSequenceNumber)return;this._lastStateSequenceNumber=sequenceNumber;this._videoState.clear();for(var _i90=0,_Object$entries26=Object.entries(stateData["videoData"]);_i90<_Object$entries26.length;_i90++){var _Object$entries26$_i=_slicedToArray(_Object$entries26[_i90],2),idStr=_Object$entries26$_i[0],o=_Object$entries26$_i[1];this._videoState.set(parseInt(idStr,10),o);}}},{key:"_DeleteVideoState",value:function _DeleteVideoState(elementId){this._videoState["delete"](elementId);}},{key:"GetVideoState",value:function GetVideoState(elementId){return this._videoState.get(elementId)||null;}}]);return UserMediaPlugin;}(_C216.SDKDOMPluginBase);}{var _C217=self.C3;_C217.Plugins.UserMedia.Type=/*#__PURE__*/function(_C217$SDKTypeBase){_inherits(UserMediaType,_C217$SDKTypeBase);function UserMediaType(objectClass){_classCallCheck(this,UserMediaType);return _possibleConstructorReturn(this,_getPrototypeOf(UserMediaType).call(this,objectClass));}_createClass(UserMediaType,[{key:"Release",value:function Release(){_get(_getPrototypeOf(UserMediaType.prototype),"Release",this).call(this);}},{key:"OnCreate",value:function OnCreate(){}}]);return UserMediaType;}(_C217.SDKTypeBase);}{var _C218=self.C3;var _DOM_COMPONENT_ID2="user-media";var _tempRect14=_C218.New(_C218.Rect);var _tempQuad8=_C218.New(_C218.Quad);_C218.Plugins.UserMedia.Instance=/*#__PURE__*/function(_C218$SDKDOMInstanceB){_inherits(UserMediaInstance,_C218$SDKDOMInstanceB);function UserMediaInstance(inst,properties){var _this189;_classCallCheck(this,UserMediaInstance);_this189=_possibleConstructorReturn(this,_getPrototypeOf(UserMediaInstance).call(this,inst,_DOM_COMPONENT_ID2));_this189._videoSources=[];_this189._audioSources=[];_this189._isRequesting=false;_this189._isVideoReady=false;_this189._isVideoActive=false;_this189._videoWidth=0;_this189._videoHeight=0;_this189._snapshotUrl="";var rt=_this189._runtime.Dispatcher();_this189._disposables=new _C218.CompositeDisposable(_C218.Disposable.From(rt,"renderercontextlost",function(){return _this189._OnRendererContextLost();}));_this189.CreateElement();_this189._StartTicking();return _this189;}_createClass(UserMediaInstance,[{key:"Release",value:function Release(){this.GetPlugin()._DeleteVideoState(this.GetElementId());this._ReleaseTexture();_get(_getPrototypeOf(UserMediaInstance.prototype),"Release",this).call(this);}},{key:"_MaybeCreateTexture",value:function _MaybeCreateTexture(renderer,w,h){if(this._webGLTexture)if(this._webGLTexture.GetWidth()===w||this._webGLTexture.GetHeight()===h)return;else this._ReleaseTexture();this._webGLTexture=renderer.CreateDynamicTexture(w,h,{sampling:this._runtime.GetSampling(),mipMap:false});}},{key:"_ReleaseTexture",value:function _ReleaseTexture(){if(!this._webGLTexture)return;this._runtime.GetRenderer().DeleteTexture(this._webGLTexture);this._webGLTexture=null;}},{key:"GetElementState",value:function GetElementState(){return{};}},{key:"_OnRendererContextLost",value:function _OnRendererContextLost(){this._webGLTexture=null;}},{key:"_OnVideoReady",value:function _OnVideoReady(e){if(this._isVideoActive){this._isVideoReady=true;this._videoWidth=e["width"];this._videoHeight=e["height"];}}},{key:"Draw",value:function Draw(renderer){var wi=this.GetWorldInfo();renderer.SetColorFillMode();renderer.SetColorRgba(0,0,0,1);renderer.Quad(wi.GetBoundingQuad());renderer.SetTextureFillMode();renderer.ResetColor();if(!this._isVideoActive||!this._isVideoReady)return;var videoWidth=0;var videoHeight=0;var textureData=null;if(this._runtime.IsInWorker()){var state=this.GetMyState();if(!state)return;var imageBitmap=state["imageBitmap"];if(!imageBitmap)return;videoWidth=imageBitmap.width;videoHeight=imageBitmap.height;textureData=imageBitmap;}else{var videoElem=self["C3UserMedia_GetVideoElement"](this.GetElementId());if(!videoElem)return;videoWidth=videoElem.videoWidth;videoHeight=videoElem.videoHeight;if(videoWidth<=0||videoHeight<=0)return;textureData=videoElem;}this._MaybeCreateTexture(renderer,videoWidth,videoHeight);renderer.UpdateTexture(textureData,this._webGLTexture);var videoAspect=videoWidth/videoHeight;var dispWidth=wi.GetWidth();var dispHeight=wi.GetHeight();var dispAspect=dispWidth/dispHeight;var offX=0;var offY=0;var drawWidth=0;var drawHeight=0;if(dispAspect>videoAspect){drawWidth=dispHeight*videoAspect;drawHeight=dispHeight;offX=Math.max(Math.floor((dispWidth-drawWidth)/2),0);}else{drawWidth=dispWidth;drawHeight=dispWidth/videoAspect;offY=Math.max(Math.floor((dispHeight-drawHeight)/2),0);}renderer.SetTexture(this._webGLTexture);_tempRect14.setWH(wi.GetX()+offX,wi.GetY()+offY,drawWidth,drawHeight);_tempQuad8.setFromRect(_tempRect14);renderer.Quad(_tempQuad8);}},{key:"Tick",value:function Tick(){if(this._isVideoActive&&this._isVideoReady){this._runtime.UpdateRender();var state=this.GetMyState();if(state){this._videoWidth=state["width"];this._videoHeight=state["height"];}}}},{key:"GetMyState",value:function GetMyState(){return this.GetPlugin().GetVideoState(this.GetElementId());}}]);return UserMediaInstance;}(_C218.SDKDOMInstanceBase);}{var _C219=self.C3;_C219.Plugins.UserMedia.Cnds={OnApproved:function OnApproved(){return true;},OnDeclined:function OnDeclined(){return true;},OnMediaSources:function OnMediaSources(){return true;},OnSnapshot:function OnSnapshot(){return true;},SupportsUserMedia:function SupportsUserMedia(){return true;},SupportsSpeechRecognition:function SupportsSpeechRecognition(){return false;},OnSpeechRecognitionStart:function OnSpeechRecognitionStart(){return true;},OnSpeechRecognitionEnd:function OnSpeechRecognitionEnd(){return true;},OnSpeechRecognitionError:function OnSpeechRecognitionError(){return true;},OnSpeechRecognitionResult:function OnSpeechRecognitionResult(){return true;},IsRecognisingSpeech:function IsRecognisingSpeech(){return false;},OnDeviceLight:function OnDeviceLight(){return true;},SupportsSpeechSynthesis:function SupportsSpeechSynthesis(){return false;},IsSpeaking:function IsSpeaking(){return false;},OnCanvasRecordingReady:function OnCanvasRecordingReady(){return true;},SupportsCanvasRecording:function SupportsCanvasRecording(){return false;},IsCanvasRecordFormatSupported:function IsCanvasRecordFormatSupported(){return false;}};}{var _C220=self.C3;_C220.Plugins.UserMedia.Acts={RequestCamera:function RequestCamera(sourceIndex,preferredDirection,preferredWidth,preferredHeight,includeMic,micSourceIndex){var constraints,videoDeviceId,audioDeviceId,result;return regeneratorRuntime.async(function RequestCamera$(_context246){while(1){switch(_context246.prev=_context246.next){case 0:if(!this._isRequesting){_context246.next=2;break;}return _context246.abrupt("return");case 2:this._isRequesting=true;sourceIndex=Math.floor(sourceIndex);preferredWidth=Math.floor(preferredWidth);preferredHeight=Math.floor(preferredHeight);constraints={"video":{}};if(sourceIndex>=0&&sourceIndex<this._videoSources.length){videoDeviceId=this._videoSources[sourceIndex]["deviceId"];if(videoDeviceId)constraints["video"]["deviceId"]={"exact":videoDeviceId};}if(preferredDirection>0)constraints["video"]["facingMode"]={"ideal":preferredDirection===1?"user":"environment"};if(preferredWidth>0&&preferredHeight>0){constraints["video"]["width"]=preferredWidth;constraints["video"]["height"]=preferredHeight;}if(includeMic){constraints["audio"]={};if(micSourceIndex>=0&&micSourceIndex<this._audioSources.length){audioDeviceId=this._audioSources[micSourceIndex]["deviceId"];if(audioDeviceId)constraints["audio"]["deviceId"]={"exact":audioDeviceId};}}_context246.next=13;return regeneratorRuntime.awrap(this.PostToDOMElementAsync("request-camera",{"constraints":constraints}));case 13:result=_context246.sent;this._isRequesting=false;if(!result["ok"]){_context246.next=22;break;}this._isVideoActive=true;this._isVideoReady=false;_context246.next=20;return regeneratorRuntime.awrap(this.TriggerAsync(_C220.Plugins.UserMedia.Cnds.OnApproved));case 20:_context246.next=24;break;case 22:_context246.next=24;return regeneratorRuntime.awrap(this.TriggerAsync(_C220.Plugins.UserMedia.Cnds.OnDeclined));case 24:case"end":return _context246.stop();}}},null,this);},RequestMic:function RequestMic(tag,sourceIndex){var constraints,audioDeviceId,result;return regeneratorRuntime.async(function RequestMic$(_context247){while(1){switch(_context247.prev=_context247.next){case 0:if(!this._isRequesting){_context247.next=2;break;}return _context247.abrupt("return");case 2:this._isRequesting=true;sourceIndex=Math.floor(sourceIndex);constraints={"audio":{}};if(sourceIndex>=0&&sourceIndex<this._audioSources.length){audioDeviceId=this._audioSources[sourceIndex]["deviceId"];if(audioDeviceId)constraints["audio"]["deviceId"]={"exact":audioDeviceId};}_context247.next=8;return regeneratorRuntime.awrap(this.PostToDOMElementAsync("request-microphone",{"constraints":constraints,"tag":tag}));case 8:result=_context247.sent;this._isRequesting=false;if(!result["ok"]){_context247.next=15;break;}_context247.next=13;return regeneratorRuntime.awrap(this.TriggerAsync(_C220.Plugins.UserMedia.Cnds.OnApproved));case 13:_context247.next=17;break;case 15:_context247.next=17;return regeneratorRuntime.awrap(this.TriggerAsync(_C220.Plugins.UserMedia.Cnds.OnDeclined));case 17:case"end":return _context247.stop();}}},null,this);},Stop:function Stop(){this._isVideoActive=false;this._isVideoReady=false;this._videoWidth=0;this._videoHeight=0;this.PostToDOMElement("stop");this._runtime.UpdateRender();},Snapshot:function Snapshot(format,quality){var result;return regeneratorRuntime.async(function Snapshot$(_context248){while(1){switch(_context248.prev=_context248.next){case 0:_context248.next=2;return regeneratorRuntime.awrap(this.PostToDOMElementAsync("snapshot",{"format":format===0?"image/png":"image.jpeg","quality":quality/100}));case 2:result=_context248.sent;if(this._snapshotUrl)URL.revokeObjectURL(this._snapshotUrl);this._snapshotUrl=result["snapshotUrl"];_context248.next=7;return regeneratorRuntime.awrap(this.TriggerAsync(_C220.Plugins.UserMedia.Cnds.OnSnapshot));case 7:case"end":return _context248.stop();}}},null,this);},GetMediaSources:function GetMediaSources(){var result;return regeneratorRuntime.async(function GetMediaSources$(_context249){while(1){switch(_context249.prev=_context249.next){case 0:_context249.next=2;return regeneratorRuntime.awrap(this.PostToDOMAsync("get-media-sources"));case 2:result=_context249.sent;this._videoSources=result["videoSources"];this._audioSources=result["audioSources"];_context249.next=7;return regeneratorRuntime.awrap(this.TriggerAsync(_C220.Plugins.UserMedia.Cnds.OnMediaSources));case 7:case"end":return _context249.stop();}}},null,this);},RequestSpeechRecognition:function RequestSpeechRecognition(lang,mode,results){},StepSpeechRecognition:function StepSpeechRecognition(){},SpeakText:function SpeakText(text,lang,uri,vol,rate,pitch){},StopSpeaking:function StopSpeaking(){},PauseSpeaking:function PauseSpeaking(){},ResumeSpeaking:function ResumeSpeaking(){},StartRecordingCanvas:function StartRecordingCanvas(){},StopRecordingCanvas:function StopRecordingCanvas(){}};}{var _C221=self.C3;_C221.Plugins.UserMedia.Exps={VideoWidth:function VideoWidth(){return this._videoWidth;},VideoHeight:function VideoHeight(){return this._videoHeight;},SnapshotURL:function SnapshotURL(){return this._snapshotUrl;},AudioSourceCount:function AudioSourceCount(){return this._audioSources.length;},AudioSourceLabelAt:function AudioSourceLabelAt(i){i=Math.floor(i);if(i<0||i>=this._audioSources.length)return"";return this._audioSources[i]["label"];},CameraSourceCount:function CameraSourceCount(){return this._videoSources.length;},CameraSourceLabelAt:function CameraSourceLabelAt(i){i=Math.floor(i);if(i<0||i>=this._videoSources.length)return"";return this._videoSources[i]["label"];},CameraSourceFacingAt:function CameraSourceFacingAt(i){i=Math.floor(i);if(i<0||i>=this._videoSources.length)return"";return this._videoSources[i]["facing"];},FinalTranscript:function FinalTranscript(){return"";},InterimTranscript:function InterimTranscript(){return"";},SpeechError:function SpeechError(){return"";},AmbientLux:function AmbientLux(){return 0;},VoiceCount:function VoiceCount(){return 0;},VoiceNameAt:function VoiceNameAt(){return"";},VoiceLangAt:function VoiceLangAt(){return"";},VoiceURIAt:function VoiceURIAt(){return"";},CanvasRecordingURL:function CanvasRecordingURL(){return"";}};};}{'use strict';{var _C222=self.C3;_C222.Plugins.TiledBg=/*#__PURE__*/function(_C222$SDKPluginBase){_inherits(TiledBgPlugin,_C222$SDKPluginBase);function TiledBgPlugin(opts){_classCallCheck(this,TiledBgPlugin);return _possibleConstructorReturn(this,_getPrototypeOf(TiledBgPlugin).call(this,opts));}_createClass(TiledBgPlugin,[{key:"Release",value:function Release(){_get(_getPrototypeOf(TiledBgPlugin.prototype),"Release",this).call(this);}}]);return TiledBgPlugin;}(_C222.SDKPluginBase);}{var WrapModeToStr=function WrapModeToStr(wrapMode){switch(wrapMode){case 0:return"clamp-to-edge";case 1:return"repeat";case 2:return"mirror-repeat";}return"repeat";};var _C223=self.C3;_C223.Plugins.TiledBg.Type=/*#__PURE__*/function(_C223$SDKTypeBase){_inherits(TiledBgType,_C223$SDKTypeBase);function TiledBgType(objectClass,exportData){var _this190;_classCallCheck(this,TiledBgType);_this190=_possibleConstructorReturn(this,_getPrototypeOf(TiledBgType).call(this,objectClass));_this190._wrapX="repeat";_this190._wrapY="repeat";if(exportData){_this190._wrapX=WrapModeToStr(exportData[0]);_this190._wrapY=WrapModeToStr(exportData[1]);}return _this190;}_createClass(TiledBgType,[{key:"Release",value:function Release(){_get(_getPrototypeOf(TiledBgType.prototype),"Release",this).call(this);}},{key:"OnCreate",value:function OnCreate(){this.GetImageInfo().LoadAsset(this._runtime);}},{key:"LoadTextures",value:function LoadTextures(renderer){return this.GetImageInfo().LoadStaticTexture(renderer,{sampling:this._runtime.GetSampling(),wrapX:this._wrapX,wrapY:this._wrapY});}},{key:"ReleaseTextures",value:function ReleaseTextures(){this.GetImageInfo().ReleaseTexture();}}]);return TiledBgType;}(_C223.SDKTypeBase);}{var _C224=self.C3;var _C3X23=self.C3X;var _INITIALLY_VISIBLE2=0;var _ORIGIN=1;var IMAGE_OFFSET_X=4;var IMAGE_OFFSET_Y=5;var IMAGE_SCALE_X=6;var IMAGE_SCALE_Y=7;var IMAGE_ANGLE=8;var ENABLE_TILE_RANDOMIZATION=9;var TILE_XRANDOM=10;var TILE_YRANDOM=11;var TILE_ANGLERANDOM=12;var TILE_BLENDMARGINX=13;var TILE_BLENDMARGINY=14;var _tempRect15=_C224.New(_C224.Rect);var _tempQuad9=_C224.New(_C224.Quad);var rcTex=_C224.New(_C224.Rect);var qTex=_C224.New(_C224.Quad);_C224.Plugins.TiledBg.Instance=/*#__PURE__*/function(_C224$SDKWorldInstanc){_inherits(TiledBgInstance,_C224$SDKWorldInstanc);function TiledBgInstance(inst,properties){var _this191;_classCallCheck(this,TiledBgInstance);_this191=_possibleConstructorReturn(this,_getPrototypeOf(TiledBgInstance).call(this,inst));_this191._imageOffsetX=0;_this191._imageOffsetY=0;_this191._imageScaleX=1;_this191._imageScaleY=1;_this191._imageAngle=0;_this191._enableTileRandomization=false;_this191._tileXRandom=0;_this191._tileYRandom=0;_this191._tileAngleRandom=0;_this191._tileBlendMarginX=0;_this191._tileBlendMarginY=0;_this191._ownImageInfo=null;if(properties){_this191.GetWorldInfo().SetVisible(!!properties[_INITIALLY_VISIBLE2]);_this191._imageOffsetX=properties[IMAGE_OFFSET_X];_this191._imageOffsetY=properties[IMAGE_OFFSET_Y];_this191._imageScaleX=properties[IMAGE_SCALE_X];_this191._imageScaleY=properties[IMAGE_SCALE_Y];_this191._imageAngle=_C224.toRadians(properties[IMAGE_ANGLE]);_this191._enableTileRandomization=!!properties[ENABLE_TILE_RANDOMIZATION];_this191._tileXRandom=properties[TILE_XRANDOM];_this191._tileYRandom=properties[TILE_YRANDOM];_this191._tileAngleRandom=properties[TILE_ANGLERANDOM];_this191._tileBlendMarginX=properties[TILE_BLENDMARGINX];_this191._tileBlendMarginY=properties[TILE_BLENDMARGINY];}return _this191;}_createClass(TiledBgInstance,[{key:"Release",value:function Release(){this._ReleaseOwnImage();_get(_getPrototypeOf(TiledBgInstance.prototype),"Release",this).call(this);}},{key:"_ReleaseOwnImage",value:function _ReleaseOwnImage(){if(this._ownImageInfo){this._ownImageInfo.Release();this._ownImageInfo=null;}}},{key:"CalculateTextureCoordsFor3DFace",value:function CalculateTextureCoordsFor3DFace(areaWidth,areaHeight,outQuad){var imageInfo=this.GetCurrentImageInfo();var imageWidth=imageInfo.GetWidth();var imageHeight=imageInfo.GetHeight();var imageOffsetX=this._imageOffsetX/imageWidth;var imageOffsetY=this._imageOffsetY/imageHeight;var imageAngle=this._imageAngle;rcTex.set(0,0,areaWidth/(imageWidth*this._imageScaleX),areaHeight/(imageHeight*this._imageScaleY));rcTex.offset(-imageOffsetX,-imageOffsetY);if(imageAngle===0)outQuad.setFromRect(rcTex);else outQuad.setFromRotatedRect(rcTex,-imageAngle);}},{key:"SetTilingShaderProgram",value:function SetTilingShaderProgram(renderer){if(this._enableTileRandomization){var imageInfo=this.GetCurrentImageInfo();renderer.SetTileRandomizationMode();renderer.SetTileRandomizationInfo(imageInfo.GetWidth()*this._imageScaleX,imageInfo.GetHeight()*this._imageScaleY,this._tileXRandom,this._tileYRandom,this._tileAngleRandom,this._tileBlendMarginX,this._tileBlendMarginY);}else renderer.SetTextureFillMode();}},{key:"Draw",value:function Draw(renderer){var imageInfo=this.GetCurrentImageInfo();var texture=imageInfo.GetTexture();if(texture===null)return;this.SetTilingShaderProgram(renderer);renderer.SetTexture(texture);var imageWidth=imageInfo.GetWidth();var imageHeight=imageInfo.GetHeight();var imageOffsetX=this._imageOffsetX/imageWidth;var imageOffsetY=this._imageOffsetY/imageHeight;var wi=this.GetWorldInfo();rcTex.set(0,0,wi.GetWidth()/(imageWidth*this._imageScaleX),wi.GetHeight()/(imageHeight*this._imageScaleY));rcTex.offset(-imageOffsetX,-imageOffsetY);if(wi.HasMesh())this._DrawMesh(wi,renderer);else this._DrawStandard(wi,renderer);}},{key:"_DrawStandard",value:function _DrawStandard(wi,renderer){var quad=wi.GetBoundingQuad();if(this._runtime.IsPixelRoundingEnabled())quad=wi.PixelRoundQuad(quad);if(this._imageAngle===0)renderer.Quad3(quad,rcTex);else{qTex.setFromRotatedRect(rcTex,-this._imageAngle);renderer.Quad4(quad,qTex);}}},{key:"_DrawMesh",value:function _DrawMesh(wi,renderer){var transformedMesh=wi.GetTransformedMesh();if(wi.IsMeshChanged()){wi.CalculateBbox(_tempRect15,_tempQuad9,false);var quad=_tempQuad9;if(this._runtime.IsPixelRoundingEnabled())quad=wi.PixelRoundQuad(quad);var texCoords=rcTex;if(this._imageAngle!==0){qTex.setFromRotatedRect(rcTex,-this._imageAngle);texCoords=qTex;}transformedMesh.CalculateTransformedMesh(wi.GetSourceMesh(),quad,texCoords);wi.SetMeshChanged(false);}transformedMesh.Draw(renderer);}},{key:"GetCurrentImageInfo",value:function GetCurrentImageInfo(){return this._ownImageInfo||this._objectClass.GetImageInfo();}},{key:"IsOriginalSizeKnown",value:function IsOriginalSizeKnown(){return true;}},{key:"GetTexture",value:function GetTexture(){return this.GetCurrentImageInfo().GetTexture();}},{key:"_SetMeshChanged",value:function _SetMeshChanged(){this.GetWorldInfo().SetMeshChanged(true);}},{key:"_SetImageOffsetX",value:function _SetImageOffsetX(x){if(this._imageOffsetX===x)return;this._imageOffsetX=x;this._runtime.UpdateRender();this._SetMeshChanged();}},{key:"_GetImageOffsetX",value:function _GetImageOffsetX(){return this._imageOffsetX;}},{key:"_SetImageOffsetY",value:function _SetImageOffsetY(y){if(this._imageOffsetY===y)return;this._imageOffsetY=y;this._runtime.UpdateRender();this._SetMeshChanged();}},{key:"_GetImageOffsetY",value:function _GetImageOffsetY(){return this._imageOffsetY;}},{key:"_SetImageScaleX",value:function _SetImageScaleX(x){if(this._imageScaleX===x)return;this._imageScaleX=x;this._runtime.UpdateRender();this._SetMeshChanged();}},{key:"_GetImageScaleX",value:function _GetImageScaleX(){return this._imageScaleX;}},{key:"_SetImageScaleY",value:function _SetImageScaleY(y){if(this._imageScaleY===y)return;this._imageScaleY=y;this._runtime.UpdateRender();this._SetMeshChanged();}},{key:"_GetImageScaleY",value:function _GetImageScaleY(){return this._imageScaleY;}},{key:"_SetImageAngle",value:function _SetImageAngle(a){if(this._imageAngle===a)return;this._imageAngle=a;this._runtime.UpdateRender();this._SetMeshChanged();}},{key:"_GetImageAngle",value:function _GetImageAngle(){return this._imageAngle;}},{key:"_SetTileRandomizationEnabled",value:function _SetTileRandomizationEnabled(e){e=!!e;if(this._enableTileRandomization===e)return;this._enableTileRandomization=e;this._runtime.UpdateRender();}},{key:"_IsTileRandomizationEnabled",value:function _IsTileRandomizationEnabled(){return this._enableTileRandomization;}},{key:"_SetTileXRandom",value:function _SetTileXRandom(x){if(this._tileXRandom===x)return;this._tileXRandom=x;if(this._IsTileRandomizationEnabled())this._runtime.UpdateRender();}},{key:"_GetTileXRandom",value:function _GetTileXRandom(){return this._tileXRandom;}},{key:"_SetTileYRandom",value:function _SetTileYRandom(y){if(this._tileYRandom===y)return;this._tileYRandom=y;if(this._IsTileRandomizationEnabled())this._runtime.UpdateRender();}},{key:"_GetTileYRandom",value:function _GetTileYRandom(){return this._tileYRandom;}},{key:"_SetTileAngleRandom",value:function _SetTileAngleRandom(a){if(this._tileAngleRandom===a)return;this._tileAngleRandom=a;if(this._IsTileRandomizationEnabled())this._runtime.UpdateRender();}},{key:"_GetTileAngleRandom",value:function _GetTileAngleRandom(){return this._tileAngleRandom;}},{key:"_SetTileBlendMarginX",value:function _SetTileBlendMarginX(x){if(this._tileBlendMarginX===x)return;this._tileBlendMarginX=x;if(this._IsTileRandomizationEnabled())this._runtime.UpdateRender();}},{key:"_GetTileBlendMarginX",value:function _GetTileBlendMarginX(){return this._tileBlendMarginX;}},{key:"_SetTileBlendMarginY",value:function _SetTileBlendMarginY(y){if(this._tileBlendMarginY===y)return;this._tileBlendMarginY=y;if(this._IsTileRandomizationEnabled())this._runtime.UpdateRender();}},{key:"_GetTileBlendMarginY",value:function _GetTileBlendMarginY(){return this._tileBlendMarginY;}},{key:"GetDebuggerProperties",value:function GetDebuggerProperties(){var _this192=this;var propsPrefix="plugins.tiledbg.properties";return[{title:propsPrefix+".image-transform.name",properties:[{name:propsPrefix+".image-offset-x.name",value:this._GetImageOffsetX(),onedit:function onedit(v){return _this192._SetImageOffsetX(v);}},{name:propsPrefix+".image-offset-y.name",value:this._GetImageOffsetY(),onedit:function onedit(v){return _this192._SetImageOffsetY(v);}},{name:propsPrefix+".image-scale-x.name",value:this._GetImageScaleX()*100,onedit:function onedit(v){return _this192._SetImageScaleX(v/100);}},{name:propsPrefix+".image-scale-y.name",value:this._GetImageScaleY()*100,onedit:function onedit(v){return _this192._SetImageScaleY(v/100);}},{name:propsPrefix+".image-angle.name",value:_C224.toDegrees(this._GetImageAngle()),onedit:function onedit(v){return _this192._SetImageAngle(_C224.toRadians(v));}}]},{title:propsPrefix+".tile-randomization.name",properties:[{name:propsPrefix+".enable-tile-randomization.name",value:this._IsTileRandomizationEnabled(),onedit:function onedit(v){return _this192._SetTileRandomizationEnabled(v);}},{name:propsPrefix+".x-random.name",value:this._GetTileXRandom()*100,onedit:function onedit(v){return _this192._SetTileXRandom(v/100);}},{name:propsPrefix+".y-random.name",value:this._GetTileYRandom()*100,onedit:function onedit(v){return _this192._SetTileYRandom(v/100);}},{name:propsPrefix+".angle-random.name",value:this._GetTileAngleRandom()*100,onedit:function onedit(v){return _this192._SetTileAngleRandom(v/100);}},{name:propsPrefix+".blend-margin-x.name",value:this._GetTileBlendMarginX()*100,onedit:function onedit(v){return _this192._SetTileBlendMarginX(v/100);}},{name:propsPrefix+".blend-margin-y.name",value:this._GetTileBlendMarginY()*100,onedit:function onedit(v){return _this192._SetTileBlendMarginY(v/100);}}]}];}},{key:"GetPropertyValueByIndex",value:function GetPropertyValueByIndex(index){switch(index){case IMAGE_OFFSET_X:return this._GetImageOffsetX();case IMAGE_OFFSET_Y:return this._GetImageOffsetY();case IMAGE_SCALE_X:return this._GetImageScaleX();case IMAGE_SCALE_Y:return this._GetImageScaleY();case IMAGE_ANGLE:return this._GetImageAngle();case ENABLE_TILE_RANDOMIZATION:return this._IsTileRandomizationEnabled();case TILE_XRANDOM:return this._GetTileXRandom();case TILE_YRANDOM:return this._GetTileYRandom();case TILE_ANGLERANDOM:return this._GetTileAngleRandom();case TILE_BLENDMARGINX:return this._GetTileBlendMarginX();case TILE_BLENDMARGINY:return this._GetTileBlendMarginY();}}},{key:"SetPropertyValueByIndex",value:function SetPropertyValueByIndex(index,value){switch(index){case IMAGE_OFFSET_X:this._SetImageOffsetX(value);break;case IMAGE_OFFSET_Y:this._SetImageOffsetY(value);break;case IMAGE_SCALE_X:this._SetImageScaleX(value);break;case IMAGE_SCALE_Y:this._SetImageScaleY(value);break;case IMAGE_ANGLE:this._SetImageAngle(value);break;case ENABLE_TILE_RANDOMIZATION:this._SetTileRandomizationEnabled(!!value);break;case TILE_XRANDOM:this._SetTileXRandom(value);break;case TILE_YRANDOM:this._SetTileYRandom(value);break;case TILE_ANGLERANDOM:this._SetTileAngleRandom(value);break;case TILE_BLENDMARGINX:this._SetTileBlendMarginX(value);break;case TILE_BLENDMARGINY:this._SetTileBlendMarginY(value);break;}}},{key:"GetScriptInterfaceClass",value:function GetScriptInterfaceClass(){return self.ITiledBackgroundInstance;}}]);return TiledBgInstance;}(_C224.SDKWorldInstanceBase);var _map17=new WeakMap();self.ITiledBackgroundInstance=/*#__PURE__*/function(_self$IWorldInstance4){_inherits(ITiledBackgroundInstance,_self$IWorldInstance4);function ITiledBackgroundInstance(){var _this193;_classCallCheck(this,ITiledBackgroundInstance);_this193=_possibleConstructorReturn(this,_getPrototypeOf(ITiledBackgroundInstance).call(this));_map17.set(_assertThisInitialized(_this193),self.IInstance._GetInitInst().GetSdkInstance());return _this193;}_createClass(ITiledBackgroundInstance,[{key:"setImageOffset",value:function setImageOffset(x,y){_C3X23.RequireFiniteNumber(x);_C3X23.RequireFiniteNumber(y);var inst=_map17.get(this);inst._SetImageOffsetX(x);inst._SetImageOffsetY(y);}},{key:"getImageOffset",value:function getImageOffset(){var inst=_map17.get(this);return[inst._GetImageOffsetX(),inst._GetImageOffsetY()];}},{key:"setImageScale",value:function setImageScale(x,y){_C3X23.RequireFiniteNumber(x);_C3X23.RequireFiniteNumber(y);var inst=_map17.get(this);inst._SetImageScaleX(x);inst._SetImageScaleY(y);}},{key:"getImageScale",value:function getImageScale(){var inst=_map17.get(this);return[inst._GetImageScaleX(),inst._GetImageScaleY()];}},{key:"getImageSize",value:function getImageSize(){var imageInfo=_map17.get(this).GetCurrentImageInfo();return[imageInfo.GetWidth(),imageInfo.GetHeight()];}},{key:"setTileRandom",value:function setTileRandom(x,y){_C3X23.RequireFiniteNumber(x);_C3X23.RequireFiniteNumber(y);var inst=_map17.get(this);inst._SetTileXRandom(x);inst._SetTileYRandom(y);}},{key:"getTileRandom",value:function getTileRandom(){var inst=_map17.get(this);return[inst._GetTileXRandom(),inst._GetTileYRandom()];}},{key:"setTileBlendMargin",value:function setTileBlendMargin(x,y){_C3X23.RequireFiniteNumber(x);_C3X23.RequireFiniteNumber(y);var inst=_map17.get(this);inst._SetTileBlendMarginX(x);inst._SetTileBlendMarginY(y);}},{key:"getTileBlendMargin",value:function getTileBlendMargin(){var inst=_map17.get(this);return[inst._GetTileBlendMarginX(),inst._GetTileBlendMarginY()];}},{key:"replaceImage",value:function replaceImage(blob){var sdkInst,runtime,imageInfo;return regeneratorRuntime.async(function replaceImage$(_context250){while(1){switch(_context250.prev=_context250.next){case 0:_C3X23.RequireInstanceOf(blob,Blob);sdkInst=_map17.get(this);runtime=sdkInst.GetRuntime();imageInfo=_C224.New(_C224.ImageInfo);imageInfo.LoadDynamicBlobAsset(runtime,blob);_context250.next=7;return regeneratorRuntime.awrap(imageInfo.LoadStaticTexture(runtime.GetRenderer(),{sampling:runtime.GetSampling(),wrapX:"repeat",wrapY:"repeat"}));case 7:if(!sdkInst.WasReleased()){_context250.next=10;break;}imageInfo.Release();return _context250.abrupt("return");case 10:sdkInst._ReleaseOwnImage();sdkInst._ownImageInfo=imageInfo;runtime.UpdateRender();case 13:case"end":return _context250.stop();}}},null,this);}},{key:"imageOffsetX",set:function set(x){_C3X23.RequireFiniteNumber(x);_map17.get(this)._SetImageOffsetX(x);},get:function get(){return _map17.get(this)._GetImageOffsetX();}},{key:"imageOffsetY",set:function set(y){_C3X23.RequireFiniteNumber(y);_map17.get(this)._SetImageOffsetY(y);},get:function get(){return _map17.get(this)._GetImageOffsetY();}},{key:"imageScaleX",set:function set(x){_C3X23.RequireFiniteNumber(x);_map17.get(this)._SetImageScaleX(x);},get:function get(){return _map17.get(this)._GetImageScaleX();}},{key:"imageScaleY",set:function set(y){_C3X23.RequireFiniteNumber(y);_map17.get(this)._SetImageScaleY(y);},get:function get(){return _map17.get(this)._GetImageScaleY();}},{key:"imageAngle",set:function set(a){_C3X23.RequireFiniteNumber(a);_map17.get(this)._SetImageAngle(a);},get:function get(){return _map17.get(this)._GetImageAngle();}},{key:"imageAngleDegrees",set:function set(a){_C3X23.RequireFiniteNumber(a);_map17.get(this)._SetImageAngle(_C224.toRadians(a));},get:function get(){return _C224.toDegrees(_map17.get(this)._GetImageAngle());}},{key:"imageWidth",get:function get(){return _map17.get(this).GetCurrentImageInfo().GetWidth();}},{key:"imageHeight",get:function get(){return _map17.get(this).GetCurrentImageInfo().GetHeight();}},{key:"enableTileRandomization",set:function set(e){_map17.get(this)._SetTileRandomizationEnabled(!!e);},get:function get(){return _map17.get(this)._IsTileRandomizationEnabled();}},{key:"tileXRandom",set:function set(x){_C3X23.RequireFiniteNumber(x);_map17.get(this)._SetTileXRandom(x);},get:function get(){return _map17.get(this)._GetTileXRandom();}},{key:"tileYRandom",set:function set(y){_C3X23.RequireFiniteNumber(y);_map17.get(this)._SetTileYRandom(y);},get:function get(){return _map17.get(this)._GetTileYRandom();}},{key:"tileAngleRandom",set:function set(a){_C3X23.RequireFiniteNumber(a);_map17.get(this)._SetTileAngleRandom(a);},get:function get(){return _map17.get(this)._GetTileAngleRandom();}},{key:"tileBlendMarginX",set:function set(x){_C3X23.RequireFiniteNumber(x);_map17.get(this)._SetTileBlendMarginX(x);},get:function get(){return _map17.get(this)._GetTileBlendMarginX();}},{key:"tileBlendMarginY",set:function set(y){_C3X23.RequireFiniteNumber(y);_map17.get(this)._SetTileBlendMarginY(y);},get:function get(){return _map17.get(this)._GetTileBlendMarginY();}}]);return ITiledBackgroundInstance;}(self.IWorldInstance);}{var _C225=self.C3;_C225.Plugins.TiledBg.Cnds={OnURLLoaded:function OnURLLoaded(){return true;},OnURLFailed:function OnURLFailed(){return true;},IsTileRandomizationEnabled:function IsTileRandomizationEnabled(){return this._IsTileRandomizationEnabled();}};}{var _C226=self.C3;_C226.Plugins.TiledBg.Acts={SetImageOffsetX:function SetImageOffsetX(x){this._SetImageOffsetX(x);},SetImageOffsetY:function SetImageOffsetY(y){this._SetImageOffsetY(y);},SetImageScaleX:function SetImageScaleX(x){this._SetImageScaleX(x/100);},SetImageScaleY:function SetImageScaleY(y){this._SetImageScaleY(y/100);},SetImageAngle:function SetImageAngle(a){this._SetImageAngle(_C226.toRadians(a));},SetTileRandomizationEnabled:function SetTileRandomizationEnabled(e){this._SetTileRandomizationEnabled(e);},SetTilePosRandom:function SetTilePosRandom(x,y){this._SetTileXRandom(x/100);this._SetTileYRandom(y/100);},SetTileAngleRandom:function SetTileAngleRandom(a){this._SetTileAngleRandom(a/100);},SetTileBlendMargin:function SetTileBlendMargin(x,y){this._SetTileBlendMarginX(x/100);this._SetTileBlendMarginY(y/100);},SetEffect:function SetEffect(effect){this.GetWorldInfo().SetBlendMode(effect);this._runtime.UpdateRender();},LoadURL:function LoadURL(url,crossOrigin){var runtime,imageInfo,texture;return regeneratorRuntime.async(function LoadURL$(_context251){while(1){switch(_context251.prev=_context251.next){case 0:if(!(this._ownImageInfo&&this._ownImageInfo.GetURL()===url)){_context251.next=2;break;}return _context251.abrupt("return");case 2:runtime=this._runtime;imageInfo=_C226.New(_C226.ImageInfo);_context251.prev=4;_context251.next=7;return regeneratorRuntime.awrap(imageInfo.LoadDynamicAsset(runtime,url));case 7:if(imageInfo.IsLoaded()){_context251.next=9;break;}throw new Error("image failed to load");case 9:if(!this.WasReleased()){_context251.next=12;break;}imageInfo.Release();return _context251.abrupt("return",null);case 12:_context251.next=14;return regeneratorRuntime.awrap(imageInfo.LoadStaticTexture(runtime.GetRenderer(),{sampling:runtime.GetSampling(),wrapX:"repeat",wrapY:"repeat"}));case 14:texture=_context251.sent;if(texture){_context251.next=17;break;}return _context251.abrupt("return");case 17:_context251.next=24;break;case 19:_context251.prev=19;_context251.t0=_context251["catch"](4);console.error("Load image from URL failed: ",_context251.t0);if(!this.WasReleased())this.Trigger(_C226.Plugins.TiledBg.Cnds.OnURLFailed);return _context251.abrupt("return");case 24:if(!this.WasReleased()){_context251.next=27;break;}imageInfo.Release();return _context251.abrupt("return");case 27:this._ReleaseOwnImage();this._ownImageInfo=imageInfo;runtime.UpdateRender();_context251.next=32;return regeneratorRuntime.awrap(this.TriggerAsync(_C226.Plugins.TiledBg.Cnds.OnURLLoaded));case 32:case"end":return _context251.stop();}}},null,this,[[4,19]]);}};}{var _C227=self.C3;_C227.Plugins.TiledBg.Exps={ImageWidth:function ImageWidth(){return this.GetCurrentImageInfo().GetWidth();},ImageHeight:function ImageHeight(){return this.GetCurrentImageInfo().GetHeight();},ImageOffsetX:function ImageOffsetX(){return this._imageOffsetX;},ImageOffsetY:function ImageOffsetY(){return this._imageOffsetY;},ImageScaleX:function ImageScaleX(){return this._imageScaleX*100;},ImageScaleY:function ImageScaleY(){return this._imageScaleY*100;},ImageAngle:function ImageAngle(){return _C227.toDegrees(this._imageAngle);},TileXRandom:function TileXRandom(){return this._GetTileXRandom()*100;},TileYRandom:function TileYRandom(){return this._GetTileYRandom()*100;},TileAngleRandom:function TileAngleRandom(){return this._GetTileAngleRandom()*100;},TileBlendMarginX:function TileBlendMarginX(){return this._GetTileBlendMarginX()*100;},TileBlendMarginY:function TileBlendMarginY(){return this._GetTileBlendMarginY()*100;}};};}{'use strict';{var _C228=self.C3;_C228.Plugins.Touch=/*#__PURE__*/function(_C228$SDKPluginBase){_inherits(TouchPlugin,_C228$SDKPluginBase);function TouchPlugin(opts){_classCallCheck(this,TouchPlugin);return _possibleConstructorReturn(this,_getPrototypeOf(TouchPlugin).call(this,opts));}_createClass(TouchPlugin,[{key:"Release",value:function Release(){_get(_getPrototypeOf(TouchPlugin.prototype),"Release",this).call(this);}}]);return TouchPlugin;}(_C228.SDKPluginBase);}{var GetTouchSdkInstance=function GetTouchSdkInstance(){return touchObjectType.GetSingleGlobalInstance().GetSdkInstance();};var _C229=self.C3;var _C3X24=self.C3X;_C229.Plugins.Touch.Type=/*#__PURE__*/function(_C229$SDKTypeBase){_inherits(TouchType,_C229$SDKTypeBase);function TouchType(objectClass){_classCallCheck(this,TouchType);return _possibleConstructorReturn(this,_getPrototypeOf(TouchType).call(this,objectClass));}_createClass(TouchType,[{key:"Release",value:function Release(){_get(_getPrototypeOf(TouchType.prototype),"Release",this).call(this);}},{key:"OnCreate",value:function OnCreate(){}},{key:"GetScriptInterfaceClass",value:function GetScriptInterfaceClass(){return self.ITouchObjectType;}}]);return TouchType;}(_C229.SDKTypeBase);var touchObjectType=null;self.ITouchObjectType=/*#__PURE__*/function(_self$IObjectClass3){_inherits(ITouchObjectType,_self$IObjectClass3);function ITouchObjectType(objectType){var _this194;_classCallCheck(this,ITouchObjectType);_this194=_possibleConstructorReturn(this,_getPrototypeOf(ITouchObjectType).call(this,objectType));touchObjectType=objectType;objectType.GetRuntime()._GetCommonScriptInterfaces().touch=_assertThisInitialized(_this194);return _this194;}_createClass(ITouchObjectType,[{key:"requestPermission",value:function requestPermission(type){_C3X24.RequireString(type);var touchInst=GetTouchSdkInstance();if(type==="orientation")return touchInst._RequestPermission(0);else if(type==="motion")return touchInst._RequestPermission(1);else throw new Error("invalid type");}}]);return ITouchObjectType;}(self.IObjectClass);}{var _C230=self.C3;var _DOM_COMPONENT_ID3="touch";_C230.Plugins.Touch.Instance=/*#__PURE__*/function(_C230$SDKInstanceBase){_inherits(TouchInstance,_C230$SDKInstanceBase);function TouchInstance(inst,properties){var _this195;_classCallCheck(this,TouchInstance);_this195=_possibleConstructorReturn(this,_getPrototypeOf(TouchInstance).call(this,inst,_DOM_COMPONENT_ID3));_this195._touches=new Map();_this195._useMouseInput=false;_this195._isMouseDown=false;_this195._orientCompassHeading=0;_this195._orientAlpha=0;_this195._orientBeta=0;_this195._orientGamma=0;_this195._accX=0;_this195._accY=0;_this195._accZ=0;_this195._accWithGX=0;_this195._accWithGY=0;_this195._accWithGZ=0;_this195._triggerIndex=0;_this195._triggerId=0;_this195._triggerPermission=0;_this195._curTouchX=0;_this195._curTouchY=0;_this195._getTouchIndex=0;_this195._permissionPromises=[];if(properties)_this195._useMouseInput=properties[0];_this195.AddDOMMessageHandler("permission-result",function(e){return _this195._OnPermissionResult(e);});var rt=_this195.GetRuntime().Dispatcher();_this195._disposables=new _C230.CompositeDisposable(_C230.Disposable.From(rt,"pointerdown",function(e){return _this195._OnPointerDown(e.data);}),_C230.Disposable.From(rt,"pointermove",function(e){return _this195._OnPointerMove(e.data);}),_C230.Disposable.From(rt,"pointerup",function(e){return _this195._OnPointerUp(e.data,false);}),_C230.Disposable.From(rt,"pointercancel",function(e){return _this195._OnPointerUp(e.data,true);}),_C230.Disposable.From(rt,"deviceorientation",function(e){return _this195._OnDeviceOrientation(e.data);}),_C230.Disposable.From(rt,"deviceorientationabsolute",function(e){return _this195._OnDeviceOrientationAbsolute(e.data);}),_C230.Disposable.From(rt,"devicemotion",function(e){return _this195._OnDeviceMotion(e.data);}),_C230.Disposable.From(rt,"tick2",function(e){return _this195._OnTick2();}));return _this195;}_createClass(TouchInstance,[{key:"Release",value:function Release(){this._touches.clear();_get(_getPrototypeOf(TouchInstance.prototype),"Release",this).call(this);}},{key:"_OnPointerDown",value:function _OnPointerDown(e){if(e["pointerType"]==="mouse")if(this._useMouseInput)this._isMouseDown=true;else return;var pointerId=e["pointerId"];if(this._touches.has(pointerId))return;var x=e["pageX"]-this._runtime.GetCanvasClientX();var y=e["pageY"]-this._runtime.GetCanvasClientY();var nowTime=performance.now();var index=this._touches.size;this._triggerIndex=index;this._triggerId=pointerId;var touchInfo=_C230.New(_C230.Plugins.Touch.TouchInfo);touchInfo.Init(nowTime,x,y,pointerId,index);this._touches.set(pointerId,touchInfo);this.Trigger(_C230.Plugins.Touch.Cnds.OnNthTouchStart);this.Trigger(_C230.Plugins.Touch.Cnds.OnTouchStart);this._curTouchX=x;this._curTouchY=y;this.Trigger(_C230.Plugins.Touch.Cnds.OnTouchObject);}},{key:"_OnPointerMove",value:function _OnPointerMove(e){if(e["pointerType"]==="mouse"&&!this._isMouseDown)return;var touchInfo=this._touches.get(e["pointerId"]);if(!touchInfo)return;var nowTime=performance.now();if(nowTime-touchInfo.GetTime()<2)return;var x=e["pageX"]-this._runtime.GetCanvasClientX();var y=e["pageY"]-this._runtime.GetCanvasClientY();touchInfo.Update(nowTime,x,y,e["width"],e["height"],e["pressure"]);}},{key:"_OnPointerUp",value:function _OnPointerUp(e,isCancel){if(e["pointerType"]==="mouse")if(this._isMouseDown)this._isMouseDown=false;else return;var nowTime=performance.now();var pointerId=e["pointerId"];var touchInfo=this._touches.get(pointerId);if(!touchInfo)return;this._triggerIndex=touchInfo.GetStartIndex();this._triggerId=touchInfo.GetId();this.Trigger(_C230.Plugins.Touch.Cnds.OnNthTouchEnd);this.Trigger(_C230.Plugins.Touch.Cnds.OnTouchEnd);if(!isCancel){var tap=touchInfo.ShouldTriggerTap(nowTime);if(tap==="single-tap"){this.Trigger(_C230.Plugins.Touch.Cnds.OnTapGesture);this._curTouchX=touchInfo.GetX();this._curTouchY=touchInfo.GetY();this.Trigger(_C230.Plugins.Touch.Cnds.OnTapGestureObject);}else if(tap==="double-tap"){this.Trigger(_C230.Plugins.Touch.Cnds.OnDoubleTapGesture);this._curTouchX=touchInfo.GetX();this._curTouchY=touchInfo.GetY();this.Trigger(_C230.Plugins.Touch.Cnds.OnDoubleTapGestureObject);}}touchInfo.Release();this._touches["delete"](pointerId);}},{key:"_RequestPermission",value:function _RequestPermission(type){var _this196=this;this._PostToDOMMaybeSync("request-permission",{"type":type});return new Promise(function(resolve,reject){_this196._permissionPromises.push({type:type,resolve:resolve,reject:reject});});}},{key:"_OnPermissionResult",value:function _OnPermissionResult(e){var isGranted=e["result"];var type=e["type"];this._triggerPermission=type;var toResolve=this._permissionPromises.filter(function(o){return o.type===type;});var _iteratorNormalCompletion599=true;var _didIteratorError599=false;var _iteratorError599=undefined;try{for(var _iterator599=toResolve[Symbol.iterator](),_step599;!(_iteratorNormalCompletion599=(_step599=_iterator599.next()).done);_iteratorNormalCompletion599=true){var o=_step599.value;o.resolve(isGranted?"granted":"denied");}}catch(err){_didIteratorError599=true;_iteratorError599=err;}finally{try{if(!_iteratorNormalCompletion599&&_iterator599["return"]!=null){_iterator599["return"]();}}finally{if(_didIteratorError599){throw _iteratorError599;}}}this._permissionPromises=this._permissionPromises.filter(function(o){return o.type!==type;});if(isGranted){this.Trigger(_C230.Plugins.Touch.Cnds.OnPermissionGranted);if(type===0)this._runtime.RequestDeviceOrientationEvent();else this._runtime.RequestDeviceMotionEvent();}else this.Trigger(_C230.Plugins.Touch.Cnds.OnPermissionDenied);}},{key:"_OnDeviceOrientation",value:function _OnDeviceOrientation(e){if(typeof e["webkitCompassHeading"]==="number")this._orientCompassHeading=e["webkitCompassHeading"];else if(e["absolute"])this._orientCompassHeading=e["alpha"];this._orientAlpha=e["alpha"];this._orientBeta=e["beta"];this._orientGamma=e["gamma"];}},{key:"_OnDeviceOrientationAbsolute",value:function _OnDeviceOrientationAbsolute(e){this._orientCompassHeading=e["alpha"];}},{key:"_OnDeviceMotion",value:function _OnDeviceMotion(e){var acc=e["acceleration"];if(acc){this._accX=acc["x"];this._accY=acc["y"];this._accZ=acc["z"];}var withG=e["accelerationIncludingGravity"];if(withG){this._accWithGX=withG["x"];this._accWithGY=withG["y"];this._accWithGZ=withG["z"];}}},{key:"_OnTick2",value:function _OnTick2(){var nowTime=performance.now();var index=0;var _iteratorNormalCompletion600=true;var _didIteratorError600=false;var _iteratorError600=undefined;try{for(var _iterator600=this._touches.values()[Symbol.iterator](),_step600;!(_iteratorNormalCompletion600=(_step600=_iterator600.next()).done);_iteratorNormalCompletion600=true){var touchInfo=_step600.value;if(touchInfo.GetTime()<=nowTime-50)touchInfo._SetLastTime(nowTime);if(touchInfo.ShouldTriggerHold(nowTime)){this._triggerIndex=touchInfo.GetStartIndex();this._triggerId=touchInfo.GetId();this._getTouchIndex=index;this.Trigger(_C230.Plugins.Touch.Cnds.OnHoldGesture);this._curTouchX=touchInfo.GetX();this._curTouchY=touchInfo.GetY();this.Trigger(_C230.Plugins.Touch.Cnds.OnHoldGestureObject);this._getTouchIndex=0;}++index;}}catch(err){_didIteratorError600=true;_iteratorError600=err;}finally{try{if(!_iteratorNormalCompletion600&&_iterator600["return"]!=null){_iterator600["return"]();}}finally{if(_didIteratorError600){throw _iteratorError600;}}}}},{key:"_GetTouchByIndex",value:function _GetTouchByIndex(index){index=Math.floor(index);var _iteratorNormalCompletion601=true;var _didIteratorError601=false;var _iteratorError601=undefined;try{for(var _iterator601=this._touches.values()[Symbol.iterator](),_step601;!(_iteratorNormalCompletion601=(_step601=_iterator601.next()).done);_iteratorNormalCompletion601=true){var touchInfo=_step601.value;if(index===0)return touchInfo;--index;}}catch(err){_didIteratorError601=true;_iteratorError601=err;}finally{try{if(!_iteratorNormalCompletion601&&_iterator601["return"]!=null){_iterator601["return"]();}}finally{if(_didIteratorError601){throw _iteratorError601;}}}return null;}},{key:"_IsClientPosOnCanvas",value:function _IsClientPosOnCanvas(touchX,touchY){return touchX>=0&&touchY>=0&&touchX<this._runtime.GetCanvasCssWidth()&&touchY<this._runtime.GetCanvasCssHeight();}},{key:"GetDebuggerProperties",value:function GetDebuggerProperties(){var prefix="plugins.touch.debugger";return[{title:prefix+".touches",properties:_toConsumableArray(this._touches.values()).map(function(ti){return{name:"$"+ti.GetId(),value:ti.GetX()+", "+ti.GetY()};})}];}}]);return TouchInstance;}(_C230.SDKInstanceBase);}{var _C231=self.C3;var tempArr=[];_C231.Plugins.Touch.Cnds={OnTouchStart:function OnTouchStart(){return true;},OnTouchEnd:function OnTouchEnd(){return true;},IsInTouch:function IsInTouch(){return this._touches.size>0;},OnTouchObject:function OnTouchObject(objectClass){if(!objectClass)return false;if(!this._IsClientPosOnCanvas(this._curTouchX,this._curTouchY))return false;return this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(objectClass,this._curTouchX,this._curTouchY,false);},IsTouchingObject:function IsTouchingObject(objectClass){if(!objectClass)return false;var interactiveLayersCache=new Map();var isLayerInteractive=function isLayerInteractive(layer){var ret=interactiveLayersCache.get(layer);if(typeof ret==="undefined"){ret=layer.IsSelfAndParentsInteractive();interactiveLayersCache.set(layer,ret);}return ret;};var sol=objectClass.GetCurrentSol();var instances=sol.GetInstances();var _iteratorNormalCompletion602=true;var _didIteratorError602=false;var _iteratorError602=undefined;try{for(var _iterator602=instances[Symbol.iterator](),_step602;!(_iteratorNormalCompletion602=(_step602=_iterator602.next()).done);_iteratorNormalCompletion602=true){var inst=_step602.value;var wi=inst.GetWorldInfo();var layer=wi.GetLayer();if(!isLayerInteractive(layer)||!wi.IsInViewport2())continue;var _iteratorNormalCompletion603=true;var _didIteratorError603=false;var _iteratorError603=undefined;try{for(var _iterator603=this._touches.values()[Symbol.iterator](),_step603;!(_iteratorNormalCompletion603=(_step603=_iterator603.next()).done);_iteratorNormalCompletion603=true){var touchInfo=_step603.value;if(!this._IsClientPosOnCanvas(touchInfo.GetX(),touchInfo.GetY()))continue;var _layer$CanvasCssToLay3=layer.CanvasCssToLayer(touchInfo.GetX(),touchInfo.GetY(),wi.GetTotalZElevation()),_layer$CanvasCssToLay4=_slicedToArray(_layer$CanvasCssToLay3,2),px=_layer$CanvasCssToLay4[0],py=_layer$CanvasCssToLay4[1];if(wi.ContainsPoint(px,py)){tempArr.push(inst);break;}}}catch(err){_didIteratorError603=true;_iteratorError603=err;}finally{try{if(!_iteratorNormalCompletion603&&_iterator603["return"]!=null){_iterator603["return"]();}}finally{if(_didIteratorError603){throw _iteratorError603;}}}}}catch(err){_didIteratorError602=true;_iteratorError602=err;}finally{try{if(!_iteratorNormalCompletion602&&_iterator602["return"]!=null){_iterator602["return"]();}}finally{if(_didIteratorError602){throw _iteratorError602;}}}interactiveLayersCache.clear();if(tempArr.length){sol.SetArrayPicked(tempArr);objectClass.ApplySolToContainer();_C231.clearArray(tempArr);return true;}else return false;},CompareTouchSpeed:function CompareTouchSpeed(index,cmp,s){var touchInfo=this._GetTouchByIndex(index);if(!touchInfo)return false;return _C231.compare(touchInfo.GetSpeed(),cmp,s);},OrientationSupported:function OrientationSupported(){return true;},MotionSupported:function MotionSupported(){return true;},CompareOrientation:function CompareOrientation(orientation,cmp,a){this._runtime.RequestDeviceOrientationEvent();var v=0;if(orientation===0)v=this._orientAlpha;else if(orientation===1)v=this._orientBeta;else v=this._orientGamma;return _C231.compare(v,cmp,a);},CompareAcceleration:function CompareAcceleration(a,cmp,x){this._runtime.RequestDeviceMotionEvent();var v=0;if(a===0)v=this._accWithGX;else if(a===1)v=this._accWithGY;else if(a===2)v=this._accWithGZ;else if(a===3)v=this._accX;else if(a===4)v=this._accY;else v=this._accZ;return _C231.compare(v,cmp,x);},OnNthTouchStart:function OnNthTouchStart(index){index=Math.floor(index);return index===this._triggerIndex;},OnNthTouchEnd:function OnNthTouchEnd(index){index=Math.floor(index);return index===this._triggerIndex;},HasNthTouch:function HasNthTouch(index){index=Math.floor(index);return this._touches.size>=index+1;},OnHoldGesture:function OnHoldGesture(){return true;},OnTapGesture:function OnTapGesture(){return true;},OnDoubleTapGesture:function OnDoubleTapGesture(){return true;},OnHoldGestureObject:function OnHoldGestureObject(objectClass){if(!objectClass)return false;if(!this._IsClientPosOnCanvas(this._curTouchX,this._curTouchY))return false;return this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(objectClass,this._curTouchX,this._curTouchY,false);},OnTapGestureObject:function OnTapGestureObject(objectClass){if(!objectClass)return false;if(!this._IsClientPosOnCanvas(this._curTouchX,this._curTouchY))return false;return this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(objectClass,this._curTouchX,this._curTouchY,false);},OnDoubleTapGestureObject:function OnDoubleTapGestureObject(objectClass){if(!objectClass)return false;if(!this._IsClientPosOnCanvas(this._curTouchX,this._curTouchY))return false;return this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(objectClass,this._curTouchX,this._curTouchY,false);},OnPermissionGranted:function OnPermissionGranted(type){return this._triggerPermission===type;},OnPermissionDenied:function OnPermissionDenied(type){return this._triggerPermission===type;}};}{var _C232=self.C3;_C232.Plugins.Touch.Acts={RequestPermission:function RequestPermission(type){this._RequestPermission(type);}};}{var _C233=self.C3;_C233.Plugins.Touch.Exps={TouchCount:function TouchCount(){return this._touches.size;},X:function X(layerParam){var touchInfo=this._GetTouchByIndex(this._getTouchIndex);if(!touchInfo)return 0;return touchInfo.GetPositionForLayer(this._runtime.GetCurrentLayout(),layerParam,true);},Y:function Y(layerParam){var touchInfo=this._GetTouchByIndex(this._getTouchIndex);if(!touchInfo)return 0;return touchInfo.GetPositionForLayer(this._runtime.GetCurrentLayout(),layerParam,false);},XAt:function XAt(index,layerParam){var touchInfo=this._GetTouchByIndex(index);if(!touchInfo)return 0;return touchInfo.GetPositionForLayer(this._runtime.GetCurrentLayout(),layerParam,true);},YAt:function YAt(index,layerParam){var touchInfo=this._GetTouchByIndex(index);if(!touchInfo)return 0;return touchInfo.GetPositionForLayer(this._runtime.GetCurrentLayout(),layerParam,false);},XForID:function XForID(id,layerParam){var touchInfo=this._touches.get(id);if(!touchInfo)return 0;return touchInfo.GetPositionForLayer(this._runtime.GetCurrentLayout(),layerParam,true);},YForID:function YForID(id,layerParam){var touchInfo=this._touches.get(id);if(!touchInfo)return 0;return touchInfo.GetPositionForLayer(this._runtime.GetCurrentLayout(),layerParam,false);},AbsoluteX:function AbsoluteX(){var touchInfo=this._GetTouchByIndex(0);if(touchInfo)return touchInfo.GetX();else return 0;},AbsoluteY:function AbsoluteY(){var touchInfo=this._GetTouchByIndex(0);if(touchInfo)return touchInfo.GetY();else return 0;},AbsoluteXAt:function AbsoluteXAt(index){var touchInfo=this._GetTouchByIndex(index);if(touchInfo)return touchInfo.GetX();else return 0;},AbsoluteYAt:function AbsoluteYAt(index){var touchInfo=this._GetTouchByIndex(index);if(touchInfo)return touchInfo.GetY();else return 0;},AbsoluteXForID:function AbsoluteXForID(id){var touchInfo=this._touches.get(id);if(touchInfo)return touchInfo.GetX();else return 0;},AbsoluteYForID:function AbsoluteYForID(id){var touchInfo=this._touches.get(id);if(touchInfo)return touchInfo.GetY();else return 0;},SpeedAt:function SpeedAt(index){var touchInfo=this._GetTouchByIndex(index);if(touchInfo)return touchInfo.GetSpeed();else return 0;},SpeedForID:function SpeedForID(id){var touchInfo=this._touches.get(id);if(touchInfo)return touchInfo.GetSpeed();else return 0;},AngleAt:function AngleAt(index){var touchInfo=this._GetTouchByIndex(index);if(touchInfo)return _C233.toDegrees(touchInfo.GetAngle());else return 0;},AngleForID:function AngleForID(id){var touchInfo=this._touches.get(id);if(touchInfo)return _C233.toDegrees(touchInfo.GetAngle());else return 0;},CompassHeading:function CompassHeading(){this._runtime.RequestDeviceOrientationEvent();return this._orientCompassHeading;},Alpha:function Alpha(){this._runtime.RequestDeviceOrientationEvent();return this._orientAlpha;},Beta:function Beta(){this._runtime.RequestDeviceOrientationEvent();return this._orientBeta;},Gamma:function Gamma(){this._runtime.RequestDeviceOrientationEvent();return this._orientGamma;},AccelerationXWithG:function AccelerationXWithG(){this._runtime.RequestDeviceMotionEvent();return this._accWithGX;},AccelerationYWithG:function AccelerationYWithG(){this._runtime.RequestDeviceMotionEvent();return this._accWithGY;},AccelerationZWithG:function AccelerationZWithG(){this._runtime.RequestDeviceMotionEvent();return this._accWithGZ;},AccelerationX:function AccelerationX(){this._runtime.RequestDeviceMotionEvent();return this._accX;},AccelerationY:function AccelerationY(){this._runtime.RequestDeviceMotionEvent();return this._accY;},AccelerationZ:function AccelerationZ(){this._runtime.RequestDeviceMotionEvent();return this._accZ;},TouchIndex:function TouchIndex(){return this._triggerIndex;},TouchID:function TouchID(){return this._triggerId;},WidthForID:function WidthForID(id){var touchInfo=this._touches.get(id);if(touchInfo)return touchInfo.GetWidth();else return 0;},HeightForID:function HeightForID(id){var touchInfo=this._touches.get(id);if(touchInfo)return touchInfo.GetHeight();else return 0;},PressureForID:function PressureForID(id){var touchInfo=this._touches.get(id);if(touchInfo)return touchInfo.GetPressure();else return 0;}};};}{'use strict';var _C234=self.C3;var GESTURE_HOLD_THRESHOLD=15;var GESTURE_HOLD_TIMEOUT=500;var GESTURE_TAP_TIMEOUT=333;var GESTURE_DOUBLETAP_THRESHOLD=25;var lastTapX=-1E3;var lastTapY=-1E3;var lastTapTime=-1E4;_C234.Plugins.Touch.TouchInfo=/*#__PURE__*/function(_C234$DefendedBase){_inherits(TouchInfo,_C234$DefendedBase);function TouchInfo(){var _this197;_classCallCheck(this,TouchInfo);_this197=_possibleConstructorReturn(this,_getPrototypeOf(TouchInfo).call(this));_this197._pointerId=0;_this197._startIndex=0;_this197._startTime=0;_this197._time=0;_this197._lastTime=0;_this197._startX=0;_this197._startY=0;_this197._x=0;_this197._y=0;_this197._lastX=0;_this197._lastY=0;_this197._width=0;_this197._height=0;_this197._pressure=0;_this197._hasTriggeredHold=false;_this197._isTooFarForHold=false;return _this197;}_createClass(TouchInfo,[{key:"Release",value:function Release(){}},{key:"Init",value:function Init(nowTime,x,y,id,index){this._pointerId=id;this._startIndex=index;this._time=nowTime;this._lastTime=nowTime;this._startTime=nowTime;this._startX=x;this._startY=y;this._x=x;this._y=y;this._lastX=x;this._lastY=y;}},{key:"Update",value:function Update(nowTime,x,y,width,height,pressure){this._lastTime=this._time;this._time=nowTime;this._lastX=this._x;this._lastY=this._y;this._x=x;this._y=y;this._width=width;this._height=height;this._pressure=pressure;if(!this._isTooFarForHold&&_C234.distanceTo(this._startX,this._startY,this._x,this._y)>=GESTURE_HOLD_THRESHOLD)this._isTooFarForHold=true;}},{key:"GetId",value:function GetId(){return this._pointerId;}},{key:"GetStartIndex",value:function GetStartIndex(){return this._startIndex;}},{key:"GetTime",value:function GetTime(){return this._time;}},{key:"_SetLastTime",value:function _SetLastTime(t){this._lastTime=t;}},{key:"GetX",value:function GetX(){return this._x;}},{key:"GetY",value:function GetY(){return this._y;}},{key:"GetSpeed",value:function GetSpeed(){var dist=_C234.distanceTo(this._x,this._y,this._lastX,this._lastY);var dt=(this._time-this._lastTime)/1E3;if(dt>0)return dist/dt;else return 0;}},{key:"GetAngle",value:function GetAngle(){return _C234.angleTo(this._lastX,this._lastY,this._x,this._y);}},{key:"GetWidth",value:function GetWidth(){return this._width;}},{key:"GetHeight",value:function GetHeight(){return this._height;}},{key:"GetPressure",value:function GetPressure(){return this._pressure;}},{key:"ShouldTriggerHold",value:function ShouldTriggerHold(nowTime){if(this._hasTriggeredHold)return false;if(nowTime-this._startTime>=GESTURE_HOLD_TIMEOUT&&!this._isTooFarForHold&&_C234.distanceTo(this._startX,this._startY,this._x,this._y)<GESTURE_HOLD_THRESHOLD){this._hasTriggeredHold=true;return true;}return false;}},{key:"ShouldTriggerTap",value:function ShouldTriggerTap(nowTime){if(this._hasTriggeredHold)return"";if(nowTime-this._startTime<=GESTURE_TAP_TIMEOUT&&!this._isTooFarForHold&&_C234.distanceTo(this._startX,this._startY,this._x,this._y)<GESTURE_HOLD_THRESHOLD)if(nowTime-lastTapTime<=GESTURE_TAP_TIMEOUT*2&&_C234.distanceTo(lastTapX,lastTapY,this._x,this._y)<GESTURE_DOUBLETAP_THRESHOLD){lastTapX=-1E3;lastTapY=-1E3;lastTapTime=-1E4;return"double-tap";}else{lastTapX=this._x;lastTapY=this._y;lastTapTime=nowTime;return"single-tap";}return"";}},{key:"GetPositionForLayer",value:function GetPositionForLayer(layout,layerNameOrNumber,getx){if(typeof layerNameOrNumber==="undefined"){var layer=layout.GetLayerByIndex(0);return layer.CanvasCssToLayer_DefaultTransform(this._x,this._y)[getx?0:1];}else{var _layer8=layout.GetLayer(layerNameOrNumber);if(_layer8)return _layer8.CanvasCssToLayer(this._x,this._y)[getx?0:1];else return 0;}}}]);return TouchInfo;}(_C234.DefendedBase);}{'use strict';{var _C235=self.C3;_C235.Plugins.Mouse=/*#__PURE__*/function(_C235$SDKPluginBase){_inherits(MousePlugin,_C235$SDKPluginBase);function MousePlugin(opts){_classCallCheck(this,MousePlugin);return _possibleConstructorReturn(this,_getPrototypeOf(MousePlugin).call(this,opts));}_createClass(MousePlugin,[{key:"Release",value:function Release(){_get(_getPrototypeOf(MousePlugin.prototype),"Release",this).call(this);}}]);return MousePlugin;}(_C235.SDKPluginBase);}{var GetMouseSdkInstance=function GetMouseSdkInstance(){return mouseObjectType.GetSingleGlobalInstance().GetSdkInstance();};var _C236=self.C3;var _C3X25=self.C3X;_C236.Plugins.Mouse.Type=/*#__PURE__*/function(_C236$SDKTypeBase){_inherits(MouseType,_C236$SDKTypeBase);function MouseType(objectClass){_classCallCheck(this,MouseType);return _possibleConstructorReturn(this,_getPrototypeOf(MouseType).call(this,objectClass));}_createClass(MouseType,[{key:"Release",value:function Release(){_get(_getPrototypeOf(MouseType.prototype),"Release",this).call(this);}},{key:"OnCreate",value:function OnCreate(){}},{key:"GetScriptInterfaceClass",value:function GetScriptInterfaceClass(){return self.IMouseObjectType;}}]);return MouseType;}(_C236.SDKTypeBase);var mouseObjectType=null;self.IMouseObjectType=/*#__PURE__*/function(_self$IObjectClass4){_inherits(IMouseObjectType,_self$IObjectClass4);function IMouseObjectType(objectType){var _this198;_classCallCheck(this,IMouseObjectType);_this198=_possibleConstructorReturn(this,_getPrototypeOf(IMouseObjectType).call(this,objectType));mouseObjectType=objectType;objectType.GetRuntime()._GetCommonScriptInterfaces().mouse=_assertThisInitialized(_this198);return _this198;}_createClass(IMouseObjectType,[{key:"getMouseX",value:function getMouseX(layerNameOrNumber){return GetMouseSdkInstance().GetMousePositionForLayer(layerNameOrNumber)[0];}},{key:"getMouseY",value:function getMouseY(layerNameOrNumber){return GetMouseSdkInstance().GetMousePositionForLayer(layerNameOrNumber)[1];}},{key:"getMousePosition",value:function getMousePosition(layerNameOrNumber){return GetMouseSdkInstance().GetMousePositionForLayer(layerNameOrNumber);}},{key:"isMouseButtonDown",value:function isMouseButtonDown(button){return GetMouseSdkInstance().IsMouseButtonDown(button);}},{key:"setCursorStyle",value:function setCursorStyle(cursorStyle){_C3X25.RequireString(cursorStyle);GetMouseSdkInstance().SetCursorStyle(cursorStyle);}},{key:"setCursorObjectClass",value:function setCursorObjectClass(iObjectClass){var sdkInst=GetMouseSdkInstance();var runtime=sdkInst.GetRuntime();var objectClass=runtime._UnwrapIObjectClass(iObjectClass);sdkInst.SetCursorObjectClass(objectClass);}}]);return IMouseObjectType;}(self.IObjectClass);}{var _C237=self.C3;var _DOM_COMPONENT_ID4="mouse";var lastSetCursor=null;_C237.Plugins.Mouse.Instance=/*#__PURE__*/function(_C237$SDKInstanceBase){_inherits(MouseInstance,_C237$SDKInstanceBase);function MouseInstance(inst,properties){var _this199;_classCallCheck(this,MouseInstance);_this199=_possibleConstructorReturn(this,_getPrototypeOf(MouseInstance).call(this,inst,_DOM_COMPONENT_ID4));_this199._buttonMap=[false,false,false];_this199._mouseXcanvas=0;_this199._mouseYcanvas=0;_this199._triggerButton=0;_this199._triggerType=0;_this199._triggerDir=0;_this199._wheelDeltaX=0;_this199._wheelDeltaY=0;_this199._wheelDeltaZ=0;_this199._hasPointerLock=false;_this199._movementX=0;_this199._movementY=0;_this199.AddDOMMessageHandlers([["pointer-lock-change",function(e){return _this199._OnPointerLockChange(e);}],["pointer-lock-error",function(e){return _this199._OnPointerLockError(e);}]]);var rt=_this199.GetRuntime().Dispatcher();_this199._disposables=new _C237.CompositeDisposable(_C237.Disposable.From(rt,"pointermove",function(e){return _this199._OnPointerMove(e.data);}),_C237.Disposable.From(rt,"pointerdown",function(e){return _this199._OnPointerDown(e.data);}),_C237.Disposable.From(rt,"pointerup",function(e){return _this199._OnPointerUp(e.data);}),_C237.Disposable.From(rt,"dblclick",function(e){return _this199._OnDoubleClick(e.data);}),_C237.Disposable.From(rt,"wheel",function(e){return _this199._OnMouseWheel(e.data);}),_C237.Disposable.From(rt,"window-blur",function(){return _this199._OnWindowBlur();}));return _this199;}_createClass(MouseInstance,[{key:"Release",value:function Release(){_get(_getPrototypeOf(MouseInstance.prototype),"Release",this).call(this);}},{key:"_OnPointerDown",value:function _OnPointerDown(e){if(e["pointerType"]!=="mouse")return;this._mouseXcanvas=e["pageX"]-this._runtime.GetCanvasClientX();this._mouseYcanvas=e["pageY"]-this._runtime.GetCanvasClientY();this._CheckButtonChanges(e["lastButtons"],e["buttons"]);}},{key:"_OnPointerMove",value:function _OnPointerMove(e){this._movementX=e["movementX"];this._movementY=e["movementY"];this.Trigger(_C237.Plugins.Mouse.Cnds.OnMovement);this._movementX=0;this._movementY=0;if(e["pointerType"]!=="mouse")return;this._mouseXcanvas=e["pageX"]-this._runtime.GetCanvasClientX();this._mouseYcanvas=e["pageY"]-this._runtime.GetCanvasClientY();this._CheckButtonChanges(e["lastButtons"],e["buttons"]);}},{key:"_OnPointerUp",value:function _OnPointerUp(e){if(e["pointerType"]!=="mouse")return;this._CheckButtonChanges(e["lastButtons"],e["buttons"]);}},{key:"_CheckButtonChanges",value:function _CheckButtonChanges(lastButtons,buttons){this._CheckButtonChange(lastButtons,buttons,1,0);this._CheckButtonChange(lastButtons,buttons,4,1);this._CheckButtonChange(lastButtons,buttons,2,2);}},{key:"_CheckButtonChange",value:function _CheckButtonChange(lastButtons,buttons,checkButtonFlag,resultButton){if(!(lastButtons&checkButtonFlag)&&buttons&checkButtonFlag)this._OnMouseDown(resultButton);else if(lastButtons&checkButtonFlag&&!(buttons&checkButtonFlag))this._OnMouseUp(resultButton);}},{key:"_OnMouseDown",value:function _OnMouseDown(button){this._buttonMap[button]=true;this.Trigger(_C237.Plugins.Mouse.Cnds.OnAnyClick);this._triggerButton=button;this._triggerType=0;this.Trigger(_C237.Plugins.Mouse.Cnds.OnClick);this.Trigger(_C237.Plugins.Mouse.Cnds.OnObjectClicked);}},{key:"_OnMouseUp",value:function _OnMouseUp(button){if(!this._buttonMap[button])return;this._buttonMap[button]=false;this._triggerButton=button;this.Trigger(_C237.Plugins.Mouse.Cnds.OnRelease);}},{key:"_OnDoubleClick",value:function _OnDoubleClick(e){this._triggerButton=e["button"];this._triggerType=1;this.Trigger(_C237.Plugins.Mouse.Cnds.OnClick);this.Trigger(_C237.Plugins.Mouse.Cnds.OnObjectClicked);}},{key:"_OnMouseWheel",value:function _OnMouseWheel(e){this._triggerDir=e["deltaY"]<0?1:0;this._wheelDeltaX=e["deltaX"];this._wheelDeltaY=e["deltaY"];this._wheelDeltaZ=e["deltaZ"];this.Trigger(_C237.Plugins.Mouse.Cnds.OnWheel);}},{key:"_OnWindowBlur",value:function _OnWindowBlur(){for(var i=0,len=this._buttonMap.length;i<len;++i){if(!this._buttonMap[i])return;this._buttonMap[i]=false;this._triggerButton=i;this.Trigger(_C237.Plugins.Mouse.Cnds.OnRelease);}}},{key:"GetMousePositionForLayer",value:function GetMousePositionForLayer(layerNameOrNumber){var layout=this._runtime.GetMainRunningLayout();var x=this._mouseXcanvas;var y=this._mouseYcanvas;if(typeof layerNameOrNumber==="undefined"){var layer=layout.GetLayerByIndex(0);return layer.CanvasCssToLayer_DefaultTransform(x,y);}else{var _layer9=layout.GetLayer(layerNameOrNumber);if(_layer9)return _layer9.CanvasCssToLayer(x,y);else return[0,0];}}},{key:"IsMouseButtonDown",value:function IsMouseButtonDown(button){button=Math.floor(button);return!!this._buttonMap[button];}},{key:"_IsMouseOverCanvas",value:function _IsMouseOverCanvas(){return this._mouseXcanvas>=0&&this._mouseYcanvas>=0&&this._mouseXcanvas<this._runtime.GetCanvasCssWidth()&&this._mouseYcanvas<this._runtime.GetCanvasCssHeight();}},{key:"SetCursorStyle",value:function SetCursorStyle(cursorStyle){if(lastSetCursor===cursorStyle)return;lastSetCursor=cursorStyle;this.PostToDOM("cursor",cursorStyle);}},{key:"SetCursorObjectClass",value:function SetCursorObjectClass(objectClass){var inst,wi,imageInfo,blobUrl,cursorStyle;return regeneratorRuntime.async(function SetCursorObjectClass$(_context252){while(1){switch(_context252.prev=_context252.next){case 0:if(!(_C237.Platform.IsMobile||!objectClass)){_context252.next=2;break;}return _context252.abrupt("return");case 2:inst=objectClass.GetFirstPicked();if(inst){_context252.next=5;break;}return _context252.abrupt("return");case 5:wi=inst.GetWorldInfo();imageInfo=inst.GetCurrentImageInfo();if(!(!wi||!imageInfo)){_context252.next=9;break;}return _context252.abrupt("return");case 9:if(!(lastSetCursor===imageInfo)){_context252.next=11;break;}return _context252.abrupt("return");case 11:lastSetCursor=imageInfo;_context252.next=14;return regeneratorRuntime.awrap(imageInfo.ExtractImageToBlobURL());case 14:blobUrl=_context252.sent;cursorStyle="url(".concat(blobUrl,") ").concat(Math.round(wi.GetOriginX()*imageInfo.GetWidth())," ").concat(Math.round(wi.GetOriginY()*imageInfo.GetHeight()),", auto");this.PostToDOM("cursor",cursorStyle);case 17:case"end":return _context252.stop();}}},null,this);}},{key:"_OnPointerLockChange",value:function _OnPointerLockChange(e){this._UpdatePointerLockState(e["has-pointer-lock"]);}},{key:"_OnPointerLockError",value:function _OnPointerLockError(e){this._UpdatePointerLockState(e["has-pointer-lock"]);this.Trigger(_C237.Plugins.Mouse.Cnds.OnPointerLockError);}},{key:"_UpdatePointerLockState",value:function _UpdatePointerLockState(hasPointerLock){if(this._hasPointerLock===hasPointerLock)return;this._hasPointerLock=hasPointerLock;if(this._hasPointerLock)this.Trigger(_C237.Plugins.Mouse.Cnds.OnPointerLocked);else this.Trigger(_C237.Plugins.Mouse.Cnds.OnPointerUnlocked);}},{key:"GetDebuggerProperties",value:function GetDebuggerProperties(){var _this200=this;var prefix="plugins.mouse";return[{title:prefix+".name",properties:[{name:prefix+".debugger.absolute-position",value:this._mouseXcanvas+","+this._mouseYcanvas},{name:prefix+".debugger.left-button",value:this._buttonMap[0]},{name:prefix+".debugger.middle-button",value:this._buttonMap[1]},{name:prefix+".debugger.right-button",value:this._buttonMap[2]}]},{title:prefix+".debugger.position-on-each-layer",properties:this._runtime.GetMainRunningLayout().GetLayers().map(function(layer){return{name:"$"+layer.GetName(),value:layer.CanvasCssToLayer(_this200._mouseXcanvas,_this200._mouseYcanvas).join(", ")};})}];}}]);return MouseInstance;}(_C237.SDKInstanceBase);}{var _C238=self.C3;_C238.Plugins.Mouse.Cnds={OnClick:function OnClick(button,type){return this._triggerButton===button&&this._triggerType===type;},OnAnyClick:function OnAnyClick(){return true;},IsButtonDown:function IsButtonDown(button){return this._buttonMap[button];},OnRelease:function OnRelease(button){return this._triggerButton===button;},IsOverObject:function IsOverObject(objectClass){if(!this._IsMouseOverCanvas())return false;var cnd=this._runtime.GetCurrentCondition();var isInverted=cnd.IsInverted();var mx=this._mouseXcanvas;var my=this._mouseYcanvas;return _C238.xor(this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(objectClass,mx,my,isInverted),isInverted);},OnObjectClicked:function OnObjectClicked(button,type,objectClass){if(button!==this._triggerButton||type!==this._triggerType)return false;if(!this._IsMouseOverCanvas())return false;var mx=this._mouseXcanvas;var my=this._mouseYcanvas;return this._runtime.GetCollisionEngine().TestAndSelectCanvasPointOverlap(objectClass,mx,my,false);},OnWheel:function OnWheel(dir){return dir===2||this._triggerDir===dir;},OnPointerLocked:function OnPointerLocked(){return true;},OnPointerUnlocked:function OnPointerUnlocked(){return true;},OnPointerLockError:function OnPointerLockError(){return true;},HasPointerLock:function HasPointerLock(){return this._hasPointerLock;},OnMovement:function OnMovement(){return true;}};}{var _C239=self.C3;var CURSOR_STYLES=["auto","pointer","text","crosshair","move","help","wait","none"];_C239.Plugins.Mouse.Acts={SetCursor:function SetCursor(c){this.SetCursorStyle(CURSOR_STYLES[c]);},SetCursorSprite:function SetCursorSprite(objectClass){this.SetCursorObjectClass(objectClass);},RequestPointerLock:function RequestPointerLock(){this._PostToDOMMaybeSync("request-pointer-lock");},ReleasePointerLock:function ReleasePointerLock(){this.PostToDOM("release-pointer-lock");}};}{var _C240=self.C3;_C240.Plugins.Mouse.Exps={X:function X(layerParam){return this.GetMousePositionForLayer(layerParam)[0];},Y:function Y(layerParam){return this.GetMousePositionForLayer(layerParam)[1];},AbsoluteX:function AbsoluteX(){return this._mouseXcanvas;},AbsoluteY:function AbsoluteY(){return this._mouseYcanvas;},MovementX:function MovementX(){return this._movementX;},MovementY:function MovementY(){return this._movementY;},WheelDeltaX:function WheelDeltaX(){return this._wheelDeltaX;},WheelDeltaY:function WheelDeltaY(){return this._wheelDeltaY;},WheelDeltaZ:function WheelDeltaZ(){return this._wheelDeltaZ;}};};}{'use strict';{var _C241=self.C3;_C241.Behaviors.Platform=/*#__PURE__*/function(_C241$SDKBehaviorBase){_inherits(PlatformBehavior,_C241$SDKBehaviorBase);function PlatformBehavior(opts){_classCallCheck(this,PlatformBehavior);return _possibleConstructorReturn(this,_getPrototypeOf(PlatformBehavior).call(this,opts));}_createClass(PlatformBehavior,[{key:"Release",value:function Release(){_get(_getPrototypeOf(PlatformBehavior.prototype),"Release",this).call(this);}}]);return PlatformBehavior;}(_C241.SDKBehaviorBase);}{var _C242=self.C3;_C242.Behaviors.Platform.Type=/*#__PURE__*/function(_C242$SDKBehaviorType){_inherits(PlatformType,_C242$SDKBehaviorType);function PlatformType(behaviorType){_classCallCheck(this,PlatformType);return _possibleConstructorReturn(this,_getPrototypeOf(PlatformType).call(this,behaviorType));}_createClass(PlatformType,[{key:"Release",value:function Release(){_get(_getPrototypeOf(PlatformType.prototype),"Release",this).call(this);}},{key:"OnCreate",value:function OnCreate(){}}]);return PlatformType;}(_C242.SDKBehaviorTypeBase);}{var accelerate=function accelerate(velocity,min_speed,max_speed,acceleration,dt){var min=min_speed*dt;var max=max_speed*dt;return _C243.clamp(velocity*dt+.5*acceleration*dt*dt,min,max);};var _C243=self.C3;var _C3X26=self.C3X;var _IBehaviorInstance2=self.IBehaviorInstance;var MAX_SPEED=0;var ACCELERATION=1;var DECELERATION=2;var JUMP_STRENGTH=3;var GRAVITY=4;var MAX_FALL_SPEED=5;var DOUBLE_JUMP=6;var JUMP_SUSTAIN=7;var DEFAULT_CONTROLS=8;var _ENABLE2=9;var FALLTHROUGH_TIMEOUT=.05;_C243.Behaviors.Platform.Instance=/*#__PURE__*/function(_C243$SDKBehaviorInst){_inherits(PlatformInstance,_C243$SDKBehaviorInst);function PlatformInstance(behInst,properties){var _this201;_classCallCheck(this,PlatformInstance);_this201=_possibleConstructorReturn(this,_getPrototypeOf(PlatformInstance).call(this,behInst));_this201._keyboardDisposables=null;_this201._leftKey=false;_this201._rightKey=false;_this201._jumpKey=false;_this201._jumped=false;_this201._doubleJumped=false;_this201._canDoubleJump=false;_this201._ignoreInput=false;_this201._simLeft=false;_this201._simRight=false;_this201._simJump=false;_this201._lastFloorObject=null;_this201._loadFloorUid=-1;_this201._lastFloorX=0;_this201._lastFloorY=0;_this201._floorIsJumpthru=false;_this201._wasOnFloor=false;_this201._wasOverJumpthru=_this201._runtime.GetCollisionEngine().TestOverlapJumpthru(_this201._inst);_this201._loadJumpthruUid=-1;_this201._animMode="stopped";_this201._fallThroughTime=-1;_this201._isFirstTick=true;_this201._dx=0;_this201._dy=0;_this201._downX=0;_this201._downY=0;_this201._rightX=0;_this201._rightY=0;_this201._g=1500;_this201._g1=1500;_this201._ga=_C243.toRadians(90);_this201._maxSpeed=330;_this201._acc=1500;_this201._dec=1500;_this201._jumpStrength=650;_this201._maxFall=1E3;_this201._enableDoubleJump=false;_this201._jumpSustain=0;_this201._sustainTime=0;_this201._defaultControls=true;_this201._ceilingCollisionMode=0;_this201._isEnabled=true;if(properties){_this201._maxSpeed=properties[MAX_SPEED];_this201._acc=properties[ACCELERATION];_this201._dec=properties[DECELERATION];_this201._jumpStrength=properties[JUMP_STRENGTH];_this201._g=properties[GRAVITY];_this201._maxFall=properties[MAX_FALL_SPEED];_this201._enableDoubleJump=!!properties[DOUBLE_JUMP];_this201._jumpSustain=properties[JUMP_SUSTAIN]/1E3;_this201._defaultControls=!!properties[DEFAULT_CONTROLS];_this201._isEnabled=!!properties[_ENABLE2];}var rt=_this201._runtime.Dispatcher();_this201._disposables=new _C243.CompositeDisposable(_C243.Disposable.From(rt,"instancedestroy",function(e){return _this201._OnInstanceDestroyed(e.instance);}),_C243.Disposable.From(rt,"afterload",function(e){return _this201._OnAfterLoad();}));if(_this201._defaultControls)_this201._BindEvents();if(_this201._isEnabled)_this201._StartPostTicking();_this201._UpdateGravity();_this201._inst.GetUnsavedDataMap().set("isPlatformBehavior",true);return _this201;}_createClass(PlatformInstance,[{key:"Release",value:function Release(){if(this._keyboardDisposables){this._keyboardDisposables.Release();this._keyboardDisposables=null;}this._lastFloorObject=null;this._wasOverJumpthru=null;_get(_getPrototypeOf(PlatformInstance.prototype),"Release",this).call(this);}},{key:"_BindEvents",value:function _BindEvents(){var _this202=this;if(this._keyboardDisposables)return;var rt=this._runtime.Dispatcher();this._keyboardDisposables=new _C243.CompositeDisposable(_C243.Disposable.From(rt,"keydown",function(e){return _this202._OnKeyDown(e.data);}),_C243.Disposable.From(rt,"keyup",function(e){return _this202._OnKeyUp(e.data);}),_C243.Disposable.From(rt,"window-blur",function(){return _this202._OnWindowOrKeyboardBlur();}),_C243.Disposable.From(rt,"keyboard-blur",function(){return _this202._OnWindowOrKeyboardBlur();}));}},{key:"_UnBindEvents",value:function _UnBindEvents(){if(!this._keyboardDisposables)return;this._keyboardDisposables.Release();this._keyboardDisposables=null;}},{key:"_OnInstanceDestroyed",value:function _OnInstanceDestroyed(inst){if(this._lastFloorObject===inst)this._lastFloorObject=null;if(this._wasOverJumpthru===inst)this._wasOverJumpthru=null;}},{key:"_OnKeyDown",value:function _OnKeyDown(data){switch(data["key"]){case"ArrowLeft":this._leftKey=true;break;case"ArrowRight":this._rightKey=true;break;case"ArrowUp":this._jumpKey=true;break;}}},{key:"_OnKeyUp",value:function _OnKeyUp(data){switch(data["key"]){case"ArrowLeft":this._leftKey=false;break;case"ArrowRight":this._rightKey=false;break;case"ArrowUp":this._jumpKey=false;this._jumped=false;break;}}},{key:"_OnWindowOrKeyboardBlur",value:function _OnWindowOrKeyboardBlur(){this._leftKey=false;this._rightKey=false;this._jumpKey=false;this._jumped=false;}},{key:"SaveToJson",value:function SaveToJson(){return{"ii":this._ignoreInput,"lfx":this._lastFloorX,"lfy":this._lastFloorY,"lfo":this._lastFloorObject?this._lastFloorObject.GetUID():-1,"am":this._animMode,"en":this._isEnabled,"fallt":this._fallThroughTime,"ft":this._isFirstTick,"dx":this._dx,"dy":this._dy,"ms":this._maxSpeed,"acc":this._acc,"dec":this._dec,"js":this._jumpStrength,"g":this._g,"g1":this._g1,"mf":this._maxFall,"wof":this._wasOnFloor,"woj":this._wasOverJumpthru?this._wasOverJumpthru.GetUID():-1,"ga":this._ga,"edj":this._enableDoubleJump,"cdj":this._canDoubleJump,"dj":this._doubleJumped,"sus":this._jumpSustain,"dc":this._defaultControls,"cc":this._ceilingCollisionMode};}},{key:"LoadFromJson",value:function LoadFromJson(o){this._ignoreInput=o["ii"];this._lastFloorX=o["lfx"];this._lastFloorY=o["lfy"];this._loadFloorUid=o["lfo"];this._animMode=o["am"];var isEnabled=o["en"];this._fallThroughTime=o["fallt"]||-1;this._isFirstTick=o["ft"];this._dx=o["dx"];this._dy=o["dy"];this._maxSpeed=o["ms"];this._acc=o["acc"];this._dec=o["dec"];this._jumpStrength=o["js"];this._g=o["g"];this._g1=o["g1"];this._maxFall=o["mf"];this._wasOnFloor=o["wof"];this._loadJumpthruUid=o["woj"];this._ga=o["ga"];this._enableDoubleJump=o["edj"];this._canDoubleJump=o["cdj"];this._doubleJumped=o["dj"];this._jumpSustain=o["sus"];this._defaultControls=o["dc"];this._ceilingCollisionMode=o["cc"]||0;this._leftKey=false;this._rightKey=false;this._jumpKey=false;this._jumped=false;this._simLeft=false;this._simRight=false;this._simJump=false;this._sustainTime=0;if(this._defaultControls)this._BindEvents();else this._UnBindEvents();this._SetEnabled(isEnabled);this._UpdateGravity();}},{key:"_OnAfterLoad",value:function _OnAfterLoad(){if(this._loadFloorUid===-1)this._lastFloorObject=null;else this._lastFloorObject=this._runtime.GetInstanceByUID(this._loadFloorUid);if(this._loadJumpthruUid===-1)this._wasOverJumpthru=null;else this._wasOverJumpthru=this._runtime.GetInstanceByUID(this._loadJumpthruUid);}},{key:"_SetLastFloorObject",value:function _SetLastFloorObject(floor){this._lastFloorObject=floor;if(floor){var floorWi=floor.GetWorldInfo();this._lastFloorX=floorWi.GetX();this._lastFloorY=floorWi.GetY();}}},{key:"_IsFallThroughEnabled",value:function _IsFallThroughEnabled(){return this._runtime.GetGameTime()>this._fallThroughTime+FALLTHROUGH_TIMEOUT;}},{key:"_UpdateGravity",value:function _UpdateGravity(){this._downX=Math.cos(this._ga);this._downY=Math.sin(this._ga);this._rightX=Math.cos(this._ga-Math.PI/2);this._rightY=Math.sin(this._ga-Math.PI/2);this._downX=_C243.roundToDp(this._downX,6);this._downY=_C243.roundToDp(this._downY,6);this._rightX=_C243.roundToDp(this._rightX,6);this._rightY=_C243.roundToDp(this._rightY,6);this._g1=this._g;if(this._g<0){this._downX*=-1;this._downY*=-1;this._g=Math.abs(this._g);}}},{key:"_GetGDir",value:function _GetGDir(){if(this._g<0)return-1;else return 1;}},{key:"_IsOnFloor",value:function _IsOnFloor(){var wi=this._inst.GetWorldInfo();var collisionEngine=this._runtime.GetCollisionEngine();var inst=this._inst;var lfo=this._lastFloorObject;var oldX=wi.GetX();var oldY=wi.GetY();wi.OffsetXY(this._downX,this._downY);wi.SetBboxChanged();if(lfo&&collisionEngine.TestOverlap(inst,lfo)&&(!lfo.GetObjectClass().HasSolidBehavior()||collisionEngine.IsSolidCollisionAllowed(lfo,inst))&&(!lfo.GetObjectClass().HasJumpthruBehavior()||lfo._IsJumpthruEnabled())){wi.SetXY(oldX,oldY);wi.SetBboxChanged();return lfo;}else{var ret=collisionEngine.TestOverlapSolid(inst);var ret2=null;if(!ret&&this._IsFallThroughEnabled())ret2=collisionEngine.TestOverlapJumpthru(inst,true);wi.SetXY(oldX,oldY);wi.SetBboxChanged();if(ret)if(collisionEngine.TestOverlap(inst,ret))return null;else{this._floorIsJumpthru=false;return ret;}if(ret2&&ret2.length){var j=0;for(var i=0,len=ret2.length;i<len;++i){ret2[j]=ret2[i];if(!collisionEngine.TestOverlap(inst,ret2[i]))++j;}if(j>=1){this._floorIsJumpthru=true;return ret2[0];}}return null;}}},{key:"PostTick",value:function PostTick(){if(!this._isEnabled)return;var dt=this._runtime.GetDt(this._inst);if(!this._jumpKey&&!this._simJump)this._jumped=false;var left=this._leftKey||this._simLeft;var right=this._rightKey||this._simRight;var jumpkey=this._jumpKey||this._simJump;var jump=jumpkey&&!this._jumped;this._simLeft=false;this._simRight=false;this._simJump=false;if(this._ignoreInput){left=false;right=false;jumpkey=false;jump=false;}if(!jumpkey)this._sustainTime=0;this._HandleFirstTick();var _this$_TrackMovingPla=this._TrackMovingPlatform(),_this$_TrackMovingPla2=_slicedToArray(_this$_TrackMovingPla,3),mx=_this$_TrackMovingPla2[0],my=_this$_TrackMovingPla2[1],floorMoved=_this$_TrackMovingPla2[2];var floor=this._IsOnFloor();var didJustLandOnFloor=floor&&!this._wasOnFloor;var isStuck=false;var _this$_MaybePushOutSo=this._MaybePushOutSolid(floor);var _this$_MaybePushOutSo2=_slicedToArray(_this$_MaybePushOutSo,2);isStuck=_this$_MaybePushOutSo2[0];floor=_this$_MaybePushOutSo2[1];if(isStuck)return;this._TrackFloor(floor,floorMoved,mx,jumpkey);jump=this._HandleJump(floor,jump,jumpkey);if(!floor)this._HandleAirTime(jump,jumpkey,dt);this._wasOnFloor=!!floor;var hacc=this._CalculateHorizontalAcceleration(left,right);var landed=false;var downMagnitude=0;if(this._dx!==0){var _this$_HandleHorizont=this._HandleHorizontalMovement(dt,hacc,floor,jump);var _this$_HandleHorizont2=_slicedToArray(_this$_HandleHorizont,2);landed=_this$_HandleHorizont2[0];floor=_this$_HandleHorizont2[1];}if(this._dy!==0){var _this$_HandleVertical=this._HandleVerticalMovement(dt,floor),_this$_HandleVertical2=_slicedToArray(_this$_HandleVertical,2),l=_this$_HandleVertical2[0],dm=_this$_HandleVertical2[1];landed=landed||l;downMagnitude=dm;}if(!landed&&didJustLandOnFloor&&this._dy<0&&downMagnitude>0){this._dy=0;landed=true;}this._ApplyHorizontalAcceleration(left,right,hacc,dt);if((!floor||jump)&&!landed)this._dy=Math.min(this._dy+this._g*dt,this._maxFall);this._HandleAnimationTriggers(floor,landed,jump);this._wasOverJumpthru=this._runtime.GetCollisionEngine().TestOverlapJumpthru(this._inst);}},{key:"_HandleFirstTick",value:function _HandleFirstTick(){if(!this._isFirstTick)return;var inst=this._inst;var collisionEngine=this._runtime.GetCollisionEngine();if(collisionEngine.TestOverlapSolid(inst)||collisionEngine.TestOverlapJumpthru(inst))collisionEngine.PushOutSolid(inst,-this._downX,-this._downY,4,true);this._isFirstTick=false;}},{key:"_TrackMovingPlatform",value:function _TrackMovingPlatform(){var lastFloor=this._lastFloorObject;var lastFloorWi=lastFloor?lastFloor.GetWorldInfo():null;var mx=0;var my=0;var floorMoved=false;if(lastFloor&&this._dy===0&&(lastFloorWi.GetY()!==this._lastFloorY||lastFloorWi.GetX()!==this._lastFloorX)){var inst=this._inst;var wi=inst.GetWorldInfo();var _collisionEngine=this._runtime.GetCollisionEngine();var lfx=lastFloorWi.GetX();var lfy=lastFloorWi.GetY();mx=lfx-this._lastFloorX;my=lfy-this._lastFloorY;wi.OffsetXY(mx,my);wi.SetBboxChanged();this._lastFloorX=lfx;this._lastFloorY=lfy;floorMoved=true;var collInst=_collisionEngine.TestOverlapSolid(inst);if(collInst){_collisionEngine.RegisterCollision(inst,collInst);_collisionEngine.PushOutSolid(inst,-mx,-my,Math.hypot(mx,my)*2.5);}}return[mx,my,floorMoved];}},{key:"_MaybePushOutSolid",value:function _MaybePushOutSolid(floor){var isStuck=false;var inst=this._inst;var wi=inst.GetWorldInfo();var collisionEngine=this._runtime.GetCollisionEngine();var collInst=collisionEngine.TestOverlapSolid(inst);if(!collInst)return[false,floor];var instWidth=Math.abs(wi.GetWidth());var instHeight=Math.abs(wi.GetHeight());if(inst.GetSavedDataMap().get("inputPredicted"))collisionEngine.PushOutSolid(inst,-this._downX,-this._downY,10,false);else if(collisionEngine.PushOutSolid(inst,-this._downX,-this._downY,instHeight/8)){collisionEngine.RegisterCollision(inst,collInst);floor=collInst;this._SetLastFloorObject(collInst);this._floorIsJumpthru=false;this._dy=0;}else if(collisionEngine.PushOutSolidAxis(inst,this._rightX,this._rightY,instWidth/2)||collisionEngine.PushOutSolidAxis(inst,this._downX,this._downY,instHeight/2)||collisionEngine.PushOutSolidNearest(inst,Math.max(instWidth,instHeight)/2))collisionEngine.RegisterCollision(inst,collInst);else isStuck=true;return[isStuck,floor];}},{key:"_TrackFloor",value:function _TrackFloor(floor,floorMoved,mx,jumpkey){var inst=this._inst;var collisionEngine=this._runtime.GetCollisionEngine();if(floor){var downX=this._downX;var downY=this._downY;var rightX=this._rightX;var rightY=this._rightY;this._doubleJumped=false;this._canDoubleJump=false;if(this._dy>0){if(!this._wasOnFloor){collisionEngine.PushInFractional(inst,-downX,-downY,floor,16);this._wasOnFloor=true;}this._dy=0;}if(this._lastFloorObject!==floor){this._SetLastFloorObject(floor);collisionEngine.RegisterCollision(inst,floor);}else if(floorMoved){var collInst=collisionEngine.TestOverlapSolid(inst);if(collInst){collisionEngine.RegisterCollision(inst,collInst);if(mx!==0)if(mx>0)collisionEngine.PushOutSolid(inst,-rightX,-rightY);else collisionEngine.PushOutSolid(inst,rightX,rightY);collisionEngine.PushOutSolid(inst,-downX,-downY);}}}else if(!jumpkey)this._canDoubleJump=true;}},{key:"_HandleJump",value:function _HandleJump(floor,jump,jumpkey){if(floor&&jump||!floor&&this._enableDoubleJump&&jumpkey&&this._canDoubleJump&&!this._doubleJumped){var inst=this._inst;var wi=inst.GetWorldInfo();var _collisionEngine2=this._runtime.GetCollisionEngine();var oldX=wi.GetX();var oldY=wi.GetY();wi.OffsetXY(-this._downX,-this._downY);wi.SetBboxChanged();if(!_collisionEngine2.TestOverlapSolid(inst)){this._sustainTime=this._jumpSustain;this.Trigger(_C243.Behaviors.Platform.Cnds.OnJump);this._animMode="jumping";this._dy=-this._jumpStrength;jump=true;if(floor)this._jumped=true;else this._doubleJumped=true;}else jump=false;wi.SetXY(oldX,oldY);wi.SetBboxChanged();}return jump;}},{key:"_HandleAirTime",value:function _HandleAirTime(jump,jumpkey,dt){if(jumpkey&&this._sustainTime>0){this._dy=-this._jumpStrength;this._sustainTime-=dt;}else this._lastFloorObject=null;if(jump)this._jumped=true;}},{key:"_CalculateHorizontalAcceleration",value:function _CalculateHorizontalAcceleration(left,right){var hacc=0;var acc=this._acc;var dec=this._dec;if(left&&!right)if(this._dx>0)hacc=-(acc+dec);else hacc=-acc;if(right&&!left)if(this._dx<0)hacc=acc+dec;else hacc=acc;return hacc;}},{key:"_ApplyHorizontalAcceleration",value:function _ApplyHorizontalAcceleration(left,right,hacc,dt){var dec=this._dec;if(left===right)if(this._dx<0)this._dx=Math.min(this._dx+dec*dt,0);else if(this._dx>0)this._dx=Math.max(this._dx-dec*dt,0);this._dx=_C243.clamp(this._dx+hacc*dt,-this._maxSpeed,this._maxSpeed);var collisionEngine=this._runtime.GetCollisionEngine();var wallLeft=this._dx<0?this._GetWallObstacle(0,1,1):null;if(wallLeft){this._dx=0;collisionEngine.RegisterCollision(this._inst,wallLeft);}else{var wallRight=this._dx>0?this._GetWallObstacle(1,1,1):null;if(wallRight){this._dx=0;collisionEngine.RegisterCollision(this._inst,wallRight);}}}},{key:"_HandleHorizontalMovement",value:function _HandleHorizontalMovement(dt,hacc,floor,jump){var inst=this._inst;var wi=inst.GetWorldInfo();var collisionEngine=this._runtime.GetCollisionEngine();var downX=this._downX;var downY=this._downY;var rightX=this._rightX;var rightY=this._rightY;var maxSpeed=this._maxSpeed;var landed=false;var initJumpThruOverlaps=new Set(collisionEngine.TestOverlapJumpthru(inst,true));var oldX=wi.GetX();var oldY=wi.GetY();var mx=accelerate(this._dx,-maxSpeed,maxSpeed,hacc,dt)*rightX;var my=accelerate(this._dx,-maxSpeed,maxSpeed,hacc,dt)*rightY;wi.OffsetXY(rightX*(this._dx>1?1:-1)-downX,rightY*(this._dx>1?1:-1)-downY);wi.SetBboxChanged();var isJumpthru=false;var slopeTooSteep=collisionEngine.TestOverlapSolid(inst);wi.SetXY(oldX+mx,oldY+my);wi.SetBboxChanged();var obstacle=collisionEngine.TestOverlapSolid(inst);if(!obstacle&&floor&&this._floorIsJumpthru){obstacle=collisionEngine.TestOverlapJumpthru(inst);if(initJumpThruOverlaps.has(obstacle))obstacle=null;else isJumpthru=true;}if(obstacle){var pushDist=Math.abs(this._dx*dt)+2;if(slopeTooSteep||!collisionEngine.PushOutSolid(inst,-downX,-downY,pushDist,isJumpthru,obstacle)){collisionEngine.RegisterCollision(inst,obstacle);pushDist=Math.max(Math.abs(this._dx*dt*2.5),Math.floor(wi.GetWidth()));if(!collisionEngine.PushOutSolid(inst,rightX*(this._dx<0?1:-1),rightY*(this._dx<0?1:-1),pushDist,false)){wi.SetXY(oldX,oldY);wi.SetBboxChanged();}else if(floor&&!isJumpthru&&!this._floorIsJumpthru){oldX=wi.GetX();oldY=wi.GetY();wi.OffsetXY(downX,downY);if(collisionEngine.TestOverlapSolid(inst)){if(!collisionEngine.PushOutSolid(inst,-downX,-downY,3,false)){wi.SetXY(oldX,oldY);wi.SetBboxChanged();}}else{wi.SetXY(oldX,oldY);wi.SetBboxChanged();}}if(!isJumpthru)this._dx=0;}else if(!slopeTooSteep&&!jump&&Math.abs(this._dy)<Math.abs(this._jumpStrength/4)){this._dy=0;if(!floor)landed=true;}}else{var newFloor=this._IsOnFloor();if(floor&&!newFloor){var mag=Math.ceil(Math.abs(this._dx*dt))+2;oldX=wi.GetX();oldY=wi.GetY();wi.OffsetXY(downX*mag,downY*mag);wi.SetBboxChanged();var overlapJumpthru=collisionEngine.TestOverlapJumpthru(inst);var didLandOnJumpthru=false;if(overlapJumpthru&&!initJumpThruOverlaps.has(overlapJumpthru))if(collisionEngine.PushOutSolid(inst,-downX,-downY,mag+2,true,overlapJumpthru)){floor=overlapJumpthru;this._SetLastFloorObject(overlapJumpthru);this._floorIsJumpthru=true;didLandOnJumpthru=true;}if(!didLandOnJumpthru)if(collisionEngine.TestOverlapSolid(inst))collisionEngine.PushOutSolid(inst,-downX,-downY,mag+2,false);else{wi.SetXY(oldX,oldY);wi.SetBboxChanged();}}else if(newFloor){if(!floor&&this._floorIsJumpthru){this._SetLastFloorObject(newFloor);this._dy=0;landed=true;}if(this._dy===0)collisionEngine.PushInFractional(inst,-downX,-downY,newFloor,16);}}return[landed,floor];}},{key:"_HandleVerticalMovement",value:function _HandleVerticalMovement(dt,floor){var inst=this._inst;var wi=inst.GetWorldInfo();var collisionEngine=this._runtime.GetCollisionEngine();var downX=this._downX;var downY=this._downY;var landed=false;var oldX=wi.GetX();var oldY=wi.GetY();var downMagnitude=accelerate(this._dy,-Infinity,this._maxFall,this._g,dt);wi.OffsetXY(downMagnitude*downX,downMagnitude*downY);var newX=wi.GetX();var newY=wi.GetY();wi.SetBboxChanged();var collInst=collisionEngine.TestOverlapSolid(inst);var fellOnJumpthru=false;if(!collInst&&this._dy>0&&!floor){var allOver=this._IsFallThroughEnabled()?collisionEngine.TestOverlapJumpthru(inst,true):null;if(allOver&&allOver.length){if(this._wasOverJumpthru){wi.SetXY(oldX,oldY);wi.SetBboxChanged();var j=0;for(var i=0,len=allOver.length;i<len;++i){allOver[j]=allOver[i];if(!collisionEngine.TestOverlap(inst,allOver[i]))++j;}_C243.truncateArray(allOver,j);wi.SetXY(newX,newY);wi.SetBboxChanged();}if(allOver.length>=1)collInst=allOver[0];}fellOnJumpthru=!!collInst;}if(collInst){collisionEngine.RegisterCollision(inst,collInst);this._sustainTime=0;var multiplier=1.1;if(fellOnJumpthru&&!this._wasOverJumpthru)multiplier=2;var pushDist=Math.max(Math.abs(this._dy*dt*multiplier),2);if(!collisionEngine.PushOutSolid(inst,downX*(this._dy<0?1:-1),downY*(this._dy<0?1:-1),pushDist,fellOnJumpthru,collInst)){wi.SetXY(oldX,oldY);wi.SetBboxChanged();this._wasOnFloor=true;if(!fellOnJumpthru)this._dy=0;}else{this._SetLastFloorObject(collInst);this._floorIsJumpthru=fellOnJumpthru;if(this._dy>0)landed=true;if(this._dy>0||this._ceilingCollisionMode===0)this._dy=0;if(this._dy<0&&this._ceilingCollisionMode===1)collisionEngine.PushInFractional(inst,downX,downY,collInst,32);}}return[landed,downMagnitude];}},{key:"_HandleAnimationTriggers",value:function _HandleAnimationTriggers(floor,landed,jump){if(this._animMode!=="falling"&&this._dy>0&&!floor){this.Trigger(_C243.Behaviors.Platform.Cnds.OnFall);this._animMode="falling";}if((floor||landed)&&this._dy>=0)if(this._animMode==="falling"||landed||jump&&this._dy===0){this.Trigger(_C243.Behaviors.Platform.Cnds.OnLand);if(this._dx===0&&this._dy===0)this._animMode="stopped";else this._animMode="moving";}else{if(this._animMode!=="stopped"&&this._dx===0&&this._dy===0){this.Trigger(_C243.Behaviors.Platform.Cnds.OnStop);this._animMode="stopped";}if(this._animMode!=="moving"&&(this._dx!==0||this._dy!==0)&&!jump){this.Trigger(_C243.Behaviors.Platform.Cnds.OnMove);this._animMode="moving";}}}},{key:"_IsMoving",value:function _IsMoving(){return this._GetVectorX()!==0||this._GetVectorY()!==0;}},{key:"_CheckIfStandingOnFloor",value:function _CheckIfStandingOnFloor(){if(this._dy!==0)return false;var inst=this._inst;var wi=this.GetWorldInfo();var collisionEngine=this._runtime.GetCollisionEngine();var oldX=wi.GetX();var oldY=wi.GetY();wi.OffsetXY(this._downX,this._downY);wi.SetBboxChanged();var ret=collisionEngine.TestOverlapSolid(inst);var ret2=null;if(!ret&&this._IsFallThroughEnabled())ret2=collisionEngine.TestOverlapJumpthru(inst,true);wi.SetXY(oldX,oldY);wi.SetBboxChanged();if(ret)return!collisionEngine.TestOverlap(inst,ret);if(ret2&&ret2.length){var j=0;for(var i=0,len=ret2.length;i<len;++i){ret2[j]=ret2[i];if(!collisionEngine.TestOverlap(inst,ret2[i]))j++;}if(j>=1)return true;}return false;}},{key:"_IsByWall",value:function _IsByWall(side){var hdist=arguments.length>1&&arguments[1]!==undefined?arguments[1]:2;var vdist=arguments.length>2&&arguments[2]!==undefined?arguments[2]:3;return!!this._GetWallObstacle(side,hdist,vdist);}},{key:"_GetWallObstacle",value:function _GetWallObstacle(side){var hdist=arguments.length>1&&arguments[1]!==undefined?arguments[1]:2;var vdist=arguments.length>2&&arguments[2]!==undefined?arguments[2]:3;var inst=this._inst;var wi=this.GetWorldInfo();var collisionEngine=this._runtime.GetCollisionEngine();var oldX=wi.GetX();var oldY=wi.GetY();if(side===0)wi.OffsetXY(-this._rightX*hdist,-this._rightY*hdist);else wi.OffsetXY(this._rightX*hdist,this._rightY*hdist);wi.SetBboxChanged();if(!collisionEngine.TestOverlapSolid(inst)){wi.SetXY(oldX,oldY);wi.SetBboxChanged();return null;}wi.OffsetXY(-this._downX*vdist,-this._downY*vdist);wi.SetBboxChanged();var ret=collisionEngine.TestOverlapSolid(inst);wi.SetXY(oldX,oldY);wi.SetBboxChanged();return ret;}},{key:"_FallThroughJumpThru",value:function _FallThroughJumpThru(){var wi=this.GetWorldInfo();var oldX=wi.GetX();var oldY=wi.GetY();wi.OffsetXY(this._downX,this._downY);wi.SetBboxChanged();var overlaps=this._runtime.GetCollisionEngine().TestOverlapJumpthru(this._inst,false);wi.SetXY(oldX,oldY);wi.SetBboxChanged();if(!overlaps)return;this._fallThroughTime=this._runtime.GetGameTime();this._lastFloorObject=null;}},{key:"_ResetDoubleJump",value:function _ResetDoubleJump(d){this._doubleJumped=!d;}},{key:"_GetSpeed",value:function _GetSpeed(){return Math.hypot(this._dx,this._dy);}},{key:"_GetMovingAngle",value:function _GetMovingAngle(){return Math.atan2(this._dy,this._dx);}},{key:"_IsJumping",value:function _IsJumping(){return this._dy<0;}},{key:"_IsFalling",value:function _IsFalling(){return this._dy>0;}},{key:"_SetMaxSpeed",value:function _SetMaxSpeed(ms){this._maxSpeed=Math.max(ms,0);}},{key:"_GetMaxSpeed",value:function _GetMaxSpeed(){return this._maxSpeed;}},{key:"_SetAcceleration",value:function _SetAcceleration(acc){this._acc=Math.max(acc,0);}},{key:"_GetAcceleration",value:function _GetAcceleration(){return this._acc;}},{key:"_SetDeceleration",value:function _SetDeceleration(dec){this._dec=Math.max(dec,0);}},{key:"_GetDeceleration",value:function _GetDeceleration(){return this._dec;}},{key:"_SetJumpStrength",value:function _SetJumpStrength(js){this._jumpStrength=Math.max(js,0);}},{key:"_GetJumpStrength",value:function _GetJumpStrength(){return this._jumpStrength;}},{key:"_SetMaxFallSpeed",value:function _SetMaxFallSpeed(mfs){this._maxFall=Math.max(mfs,0);}},{key:"_GetMaxFallSpeed",value:function _GetMaxFallSpeed(){return this._maxFall;}},{key:"_SetGravity",value:function _SetGravity(grav){if(this._g1===grav)return;this._g=grav;this._UpdateGravity();var collisionEngine=this._runtime.GetCollisionEngine();var wi=this.GetWorldInfo();if(collisionEngine.TestOverlapSolid(this._inst)){collisionEngine.PushOutSolid(this._inst,this._downX,this._downY,10);wi.OffsetXY(this._downX*2,this._downY*2);wi.SetBboxChanged();}this._lastFloorObject=null;}},{key:"_GetGravity",value:function _GetGravity(){return this._g;}},{key:"_SetGravityAngle",value:function _SetGravityAngle(a){a=_C243.clampAngle(a);if(this._ga===a)return;this._ga=a;this._UpdateGravity();this._lastFloorObject=null;}},{key:"_GetGravityAngle",value:function _GetGravityAngle(){return this._ga;}},{key:"_SetDoubleJumpEnabled",value:function _SetDoubleJumpEnabled(e){this._enableDoubleJump=!!e;}},{key:"_IsDoubleJumpEnabled",value:function _IsDoubleJumpEnabled(){return this._enableDoubleJump;}},{key:"_SetJumpSustain",value:function _SetJumpSustain(s){this._jumpSustain=s;}},{key:"_GetJumpSustain",value:function _GetJumpSustain(){return this._jumpSustain;}},{key:"_SetCeilingCollisionMode",value:function _SetCeilingCollisionMode(m){this._ceilingCollisionMode=m;}},{key:"_GetCeilingCollisionMode",value:function _GetCeilingCollisionMode(){return this._ceilingCollisionMode;}},{key:"_SetVectorX",value:function _SetVectorX(x){this._dx=x;}},{key:"_GetVectorX",value:function _GetVectorX(){return this._dx;}},{key:"_SetVectorY",value:function _SetVectorY(y){this._dy=y;}},{key:"_GetVectorY",value:function _GetVectorY(){return this._dy;}},{key:"_SimulateControl",value:function _SimulateControl(ctrl){if(!this._isEnabled)return;switch(ctrl){case 0:this._simLeft=true;break;case 1:this._simRight=true;break;case 2:this._simJump=true;break;}}},{key:"_SetDefaultControls",value:function _SetDefaultControls(d){d=!!d;if(this._defaultControls===d)return;this._defaultControls=d;if(this._defaultControls)this._BindEvents();else{this._UnBindEvents();this._OnWindowOrKeyboardBlur();}}},{key:"_IsDefaultControls",value:function _IsDefaultControls(){return this._defaultControls;}},{key:"_SetIgnoreInput",value:function _SetIgnoreInput(i){this._ignoreInput=!!i;}},{key:"_IsIgnoreInput",value:function _IsIgnoreInput(){return this._ignoreInput;}},{key:"_SetEnabled",value:function _SetEnabled(e){e=!!e;if(this._isEnabled===e)return;this._isEnabled=e;if(this._isEnabled)this._StartPostTicking();else{this._StopPostTicking();this._lastFloorObject=null;this._simLeft=false;this._simRight=false;this._simJump=false;}}},{key:"_IsEnabled",value:function _IsEnabled(){return this._isEnabled;}},{key:"GetPropertyValueByIndex",value:function GetPropertyValueByIndex(index){switch(index){case MAX_SPEED:return this._GetMaxSpeed();case ACCELERATION:return this._GetAcceleration();case DECELERATION:return this._GetDeceleration();case JUMP_STRENGTH:return this._GetJumpStrength();case GRAVITY:return this._GetGravity();case MAX_FALL_SPEED:return this._GetMaxFallSpeed();case DOUBLE_JUMP:return this._IsDoubleJumpEnabled();case JUMP_SUSTAIN:return this._GetJumpSustain()*1E3;case DEFAULT_CONTROLS:return this._IsDefaultControls();case _ENABLE2:return this._IsEnabled();}}},{key:"SetPropertyValueByIndex",value:function SetPropertyValueByIndex(index,value){switch(index){case MAX_SPEED:this._SetMaxSpeed(value);break;case ACCELERATION:this._SetAcceleration(value);break;case DECELERATION:this._SetDeceleration(value);break;case JUMP_STRENGTH:this._SetJumpStrength(value);break;case GRAVITY:this._SetGravity(value);break;case MAX_FALL_SPEED:this._SetMaxFallSpeed(value);break;case DOUBLE_JUMP:this._SetDoubleJumpEnabled(!!value);break;case JUMP_SUSTAIN:this._SetJumpSustain(value/1E3);break;case DEFAULT_CONTROLS:this._SetDefaultControls(!!value);break;case _ENABLE2:this._SetEnabled(!!value);break;}}},{key:"GetDebuggerProperties",value:function GetDebuggerProperties(){var _this203=this;var prefix="behaviors.platform";return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:prefix+".debugger.vector-x",value:this._GetVectorX(),onedit:function onedit(v){return _this203._SetVectorX(v);}},{name:prefix+".debugger.vector-y",value:this._GetVectorY(),onedit:function onedit(v){return _this203._SetVectorY(v);}},{name:prefix+".properties.max-speed.name",value:this._GetMaxSpeed(),onedit:function onedit(v){return _this203._SetMaxSpeed(v);}},{name:prefix+".properties.acceleration.name",value:this._GetAcceleration(),onedit:function onedit(v){return _this203._SetAcceleration(v);}},{name:prefix+".properties.deceleration.name",value:this._GetDeceleration(),onedit:function onedit(v){return _this203._SetDeceleration(v);}},{name:prefix+".properties.jump-strength.name",value:this._GetJumpStrength(),onedit:function onedit(v){return _this203._SetJumpStrength(v);}},{name:prefix+".properties.gravity.name",value:this._GetGravity(),onedit:function onedit(v){return _this203._SetGravity(v);}},{name:prefix+".debugger.gravity-angle",value:_C243.toDegrees(this._GetGravityAngle()),onedit:function onedit(v){return _this203._SetGravityAngle(_C243.toRadians(v));}},{name:prefix+".properties.max-fall-speed.name",value:this._GetMaxFallSpeed(),onedit:function onedit(v){return _this203._SetMaxFallSpeed(v);}},{name:prefix+".properties.double-jump.name",value:this._IsDoubleJumpEnabled(),onedit:function onedit(v){return _this203._SetDoubleJumpEnabled(v);}},{name:prefix+".properties.jump-sustain.name",value:this._GetJumpSustain()*1E3,onedit:function onedit(v){return _this203._SetJumpSustain(v/1E3);}},{name:prefix+".debugger.animation-mode",value:[prefix+".debugger.anim-"+this._animMode]},{name:prefix+".properties.enabled.name",value:this._IsEnabled(),onedit:function onedit(v){return _this203._SetEnabled(v);}}]}];}},{key:"GetScriptInterfaceClass",value:function GetScriptInterfaceClass(){return self.IPlatformBehaviorInstance;}}]);return PlatformInstance;}(_C243.SDKBehaviorInstanceBase);var _map18=new WeakMap();var SIMULATE_CONTROL_MAP=new Map([["left",0],["right",1],["jump",2]]);self.IPlatformBehaviorInstance=/*#__PURE__*/function(_IBehaviorInstance3){_inherits(IPlatformBehaviorInstance,_IBehaviorInstance3);function IPlatformBehaviorInstance(){var _this204;_classCallCheck(this,IPlatformBehaviorInstance);_this204=_possibleConstructorReturn(this,_getPrototypeOf(IPlatformBehaviorInstance).call(this));_map18.set(_assertThisInitialized(_this204),_IBehaviorInstance2._GetInitInst().GetSdkInstance());return _this204;}_createClass(IPlatformBehaviorInstance,[{key:"fallThrough",value:function fallThrough(){_map18.get(this)._FallThroughJumpThru();}},{key:"resetDoubleJump",value:function resetDoubleJump(d){_map18.get(this)._ResetDoubleJump(!!d);}},{key:"simulateControl",value:function simulateControl(ctrl){_C3X26.RequireString(ctrl);var index=SIMULATE_CONTROL_MAP.get(ctrl);if(typeof index!=="number")throw new Error("invalid control");_map18.get(this)._SimulateControl(index);}},{key:"isByWall",value:function isByWall(side){_C3X26.RequireString(side);var bi=_map18.get(this);if(side==="left")return bi._IsByWall(0);else if(side==="right")return bi._IsByWall(1);else throw new Error("invalid side");}},{key:"setVector",value:function setVector(x,y){_C3X26.RequireFiniteNumber(x);_C3X26.RequireFiniteNumber(y);var binst=_map18.get(this);binst._SetVectorX(x);binst._SetVectorY(y);}},{key:"getVector",value:function getVector(){var binst=_map18.get(this);return[binst._GetVectorX(),binst._GetVectorY()];}},{key:"speed",get:function get(){return _map18.get(this)._GetSpeed();}},{key:"maxSpeed",get:function get(){return _map18.get(this)._GetMaxSpeed();},set:function set(s){_C3X26.RequireFiniteNumber(s);_map18.get(this)._SetMaxSpeed(s);}},{key:"acceleration",get:function get(){return _map18.get(this)._GetAcceleration();},set:function set(a){_C3X26.RequireFiniteNumber(a);_map18.get(this)._SetAcceleration(a);}},{key:"deceleration",get:function get(){return _map18.get(this)._GetDeceleration();},set:function set(d){_C3X26.RequireFiniteNumber(d);_map18.get(this)._SetDeceleration(d);}},{key:"jumpStrength",get:function get(){return _map18.get(this)._GetJumpStrength();},set:function set(js){_C3X26.RequireFiniteNumber(js);_map18.get(this)._SetJumpStrength(js);}},{key:"maxFallSpeed",get:function get(){return _map18.get(this)._GetMaxFallSpeed();},set:function set(mfs){_C3X26.RequireFiniteNumber(mfs);_map18.get(this)._SetMaxFallSpeed(mfs);}},{key:"gravity",get:function get(){return _map18.get(this)._GetGravity();},set:function set(g){_C3X26.RequireFiniteNumber(g);_map18.get(this)._SetGravity(g);}},{key:"gravityAngle",get:function get(){return _map18.get(this)._GetGravityAngle();},set:function set(ga){_C3X26.RequireFiniteNumber(ga);_map18.get(this)._SetGravityAngle(ga);}},{key:"isDoubleJumpEnabled",get:function get(){return _map18.get(this)._IsDoubleJumpEnabled();},set:function set(e){_map18.get(this)._SetDoubleJumpEnabled(!!e);}},{key:"jumpSustain",get:function get(){return _map18.get(this)._GetJumpSustain();},set:function set(js){_C3X26.RequireFiniteNumber(js);_map18.get(this)._SetJumpSustain(js);}},{key:"ceilingCollisionMode",get:function get(){var ccm=_map18.get(this)._GetCeilingCollisionMode();return ccm===0?"stop":"preserve-momentum";},set:function set(ccm){_C3X26.RequireString(ccm);var bi=_map18.get(this);if(ccm==="stop")bi._SetCeilingCollisionMode(0);else if(ccm==="preserve-momentum")bi._SetCeilingCollisionMode(1);else throw new Error("invalid mode");}},{key:"isOnFloor",get:function get(){return _map18.get(this)._CheckIfStandingOnFloor();}},{key:"isMoving",get:function get(){return _map18.get(this)._IsMoving();}},{key:"isJumping",get:function get(){return _map18.get(this)._IsJumping();}},{key:"isFalling",get:function get(){return _map18.get(this)._IsFalling();}},{key:"vectorX",get:function get(){return _map18.get(this)._GetVectorX();},set:function set(x){_C3X26.RequireFiniteNumber(x);_map18.get(this)._SetVectorX(x);}},{key:"vectorY",get:function get(){return _map18.get(this)._GetVectorY();},set:function set(y){_C3X26.RequireFiniteNumber(y);_map18.get(this)._SetVectorY(y);}},{key:"isDefaultControls",get:function get(){return _map18.get(this)._IsDefaultControls();},set:function set(d){_map18.get(this)._SetDefaultControls(!!d);}},{key:"isIgnoringInput",get:function get(){return _map18.get(this)._IsIgnoreInput();},set:function set(e){_map18.get(this)._SetIgnoreInput(!!e);}},{key:"isEnabled",get:function get(){return _map18.get(this)._IsEnabled();},set:function set(e){_map18.get(this)._SetEnabled(!!e);}}]);return IPlatformBehaviorInstance;}(_IBehaviorInstance2);}{var _C244=self.C3;_C244.Behaviors.Platform.Cnds={IsMoving:function IsMoving(){return this._IsMoving();},CompareSpeed:function CompareSpeed(cmp,s){return _C244.compare(this._GetSpeed(),cmp,s);},IsOnFloor:function IsOnFloor(){return this._CheckIfStandingOnFloor();},IsByWall:function IsByWall(side){return this._IsByWall(side);},IsJumping:function IsJumping(){return this._IsJumping();},IsFalling:function IsFalling(){return this._IsFalling();},IsDoubleJumpEnabled:function IsDoubleJumpEnabled(){return this._IsDoubleJumpEnabled();},OnJump:function OnJump(){return true;},OnFall:function OnFall(){return true;},OnStop:function OnStop(){return true;},OnMove:function OnMove(){return true;},OnLand:function OnLand(){return true;},IsEnabled:function IsEnabled(){return this._IsEnabled();}};}{var _C245=self.C3;_C245.Behaviors.Platform.Acts={SetMaxSpeed:function SetMaxSpeed(ms){this._SetMaxSpeed(ms);},SetAcceleration:function SetAcceleration(acc){this._SetAcceleration(acc);},SetDeceleration:function SetDeceleration(dec){this._SetDeceleration(dec);},SetJumpStrength:function SetJumpStrength(js){this._SetJumpStrength(js);},SetMaxFallSpeed:function SetMaxFallSpeed(mfs){this._SetMaxFallSpeed(mfs);},SetGravity:function SetGravity(grav){this._SetGravity(grav);},SimulateControl:function SimulateControl(ctrl){this._SimulateControl(ctrl);},SetIgnoreInput:function SetIgnoreInput(i){this._SetIgnoreInput(!!i);},SetVectorX:function SetVectorX(x){this._SetVectorX(x);},SetVectorY:function SetVectorY(y){this._SetVectorY(y);},SetGravityAngle:function SetGravityAngle(a){this._SetGravityAngle(_C245.toRadians(a));},SetEnabled:function SetEnabled(en){this._SetEnabled(en!==0);},FallThrough:function FallThrough(){this._FallThroughJumpThru();},SetDoubleJumpEnabled:function SetDoubleJumpEnabled(e){this._SetDoubleJumpEnabled(e!==0);},SetJumpSustain:function SetJumpSustain(s){this._SetJumpSustain(s/1E3);},SetCeilingCollision:function SetCeilingCollision(m){this._SetCeilingCollisionMode(m);},SetDefaultControls:function SetDefaultControls(d){this._SetDefaultControls(d);},ResetDoubleJump:function ResetDoubleJump(d){this._ResetDoubleJump(d);}};}{var _C246=self.C3;_C246.Behaviors.Platform.Exps={Speed:function Speed(){return this._GetSpeed();},MaxSpeed:function MaxSpeed(){return this._GetMaxSpeed();},Acceleration:function Acceleration(){return this._GetAcceleration();},Deceleration:function Deceleration(){return this._GetDeceleration();},JumpStrength:function JumpStrength(){return this._GetJumpStrength();},Gravity:function Gravity(){return this._GetGravity();},GravityAngle:function GravityAngle(){return _C246.toDegrees(this._GetGravityAngle());},MaxFallSpeed:function MaxFallSpeed(){return this._GetMaxFallSpeed();},MovingAngle:function MovingAngle(){return _C246.toDegrees(this._GetMovingAngle());},VectorX:function VectorX(){return this._GetVectorX();},VectorY:function VectorY(){return this._GetVectorY();},JumpSustain:function JumpSustain(){return this._GetJumpSustain()*1E3;}};};}{'use strict';{var _C247=self.C3;_C247.Behaviors.bound=/*#__PURE__*/function(_C247$SDKBehaviorBase){_inherits(BoundBehavior,_C247$SDKBehaviorBase);function BoundBehavior(opts){_classCallCheck(this,BoundBehavior);return _possibleConstructorReturn(this,_getPrototypeOf(BoundBehavior).call(this,opts));}_createClass(BoundBehavior,[{key:"Release",value:function Release(){_get(_getPrototypeOf(BoundBehavior.prototype),"Release",this).call(this);}}]);return BoundBehavior;}(_C247.SDKBehaviorBase);}{var _C248=self.C3;_C248.Behaviors.bound.Type=/*#__PURE__*/function(_C248$SDKBehaviorType){_inherits(BoundType,_C248$SDKBehaviorType);function BoundType(behaviorType){_classCallCheck(this,BoundType);return _possibleConstructorReturn(this,_getPrototypeOf(BoundType).call(this,behaviorType));}_createClass(BoundType,[{key:"Release",value:function Release(){_get(_getPrototypeOf(BoundType.prototype),"Release",this).call(this);}},{key:"OnCreate",value:function OnCreate(){}}]);return BoundType;}(_C248.SDKBehaviorTypeBase);}{var _C249=self.C3;var MODE=0;_C249.Behaviors.bound.Instance=/*#__PURE__*/function(_C249$SDKBehaviorInst){_inherits(BoundInstance,_C249$SDKBehaviorInst);function BoundInstance(behInst,properties){var _this205;_classCallCheck(this,BoundInstance);_this205=_possibleConstructorReturn(this,_getPrototypeOf(BoundInstance).call(this,behInst));_this205._mode=0;if(properties)_this205._mode=properties[MODE];_this205._StartTicking2();return _this205;}_createClass(BoundInstance,[{key:"Release",value:function Release(){_get(_getPrototypeOf(BoundInstance.prototype),"Release",this).call(this);}},{key:"SaveToJson",value:function SaveToJson(){return{"m":this._mode};}},{key:"LoadFromJson",value:function LoadFromJson(o){this._mode=o["m"];}},{key:"Tick2",value:function Tick2(){var wi=this._inst.GetWorldInfo();var bbox=wi.GetBoundingBox();var layout=wi.GetLayout();var isChanged=false;if(this._mode===0){if(wi.GetX()<0){wi.SetX(0);isChanged=true;}if(wi.GetY()<0){wi.SetY(0);isChanged=true;}if(wi.GetX()>layout.GetWidth()){wi.SetX(layout.GetWidth());isChanged=true;}if(wi.GetY()>layout.GetHeight()){wi.SetY(layout.GetHeight());isChanged=true;}}else{if(bbox.getLeft()<0){wi.OffsetX(-bbox.getLeft());isChanged=true;}if(bbox.getTop()<0){wi.OffsetY(-bbox.getTop());isChanged=true;}if(bbox.getRight()>layout.GetWidth()){wi.OffsetX(-(bbox.getRight()-layout.GetWidth()));isChanged=true;}if(bbox.getBottom()>layout.GetHeight()){wi.OffsetY(-(bbox.getBottom()-layout.GetHeight()));isChanged=true;}}if(isChanged)wi.SetBboxChanged();}},{key:"GetPropertyValueByIndex",value:function GetPropertyValueByIndex(index){switch(index){case MODE:return this._mode;}}},{key:"SetPropertyValueByIndex",value:function SetPropertyValueByIndex(index,value){switch(index){case MODE:this._mode=value;break;}}}]);return BoundInstance;}(_C249.SDKBehaviorInstanceBase);}{var _C250=self.C3;_C250.Behaviors.bound.Cnds={};}{var _C251=self.C3;_C251.Behaviors.bound.Acts={};}{var _C252=self.C3;_C252.Behaviors.bound.Exps={};};}{'use strict';{var _C253=self.C3;_C253.Behaviors.MoveTo=/*#__PURE__*/function(_C253$SDKBehaviorBase){_inherits(MoveToBehavior,_C253$SDKBehaviorBase);function MoveToBehavior(opts){_classCallCheck(this,MoveToBehavior);return _possibleConstructorReturn(this,_getPrototypeOf(MoveToBehavior).call(this,opts));}_createClass(MoveToBehavior,[{key:"Release",value:function Release(){_get(_getPrototypeOf(MoveToBehavior.prototype),"Release",this).call(this);}}]);return MoveToBehavior;}(_C253.SDKBehaviorBase);}{var _C254=self.C3;_C254.Behaviors.MoveTo.Type=/*#__PURE__*/function(_C254$SDKBehaviorType){_inherits(MoveToType,_C254$SDKBehaviorType);function MoveToType(behaviorType){_classCallCheck(this,MoveToType);return _possibleConstructorReturn(this,_getPrototypeOf(MoveToType).call(this,behaviorType));}_createClass(MoveToType,[{key:"Release",value:function Release(){_get(_getPrototypeOf(MoveToType.prototype),"Release",this).call(this);}},{key:"OnCreate",value:function OnCreate(){}}]);return MoveToType;}(_C254.SDKBehaviorTypeBase);}{var _C255=self.C3;var _C3X27=self.C3X;var _IBehaviorInstance4=self.IBehaviorInstance;var PROP_MAX_SPEED=0;var PROP_ACCELERATION=1;var PROP_DECELERATION=2;var PROP_ROTATE_SPEED=3;var PROP_SET_ANGLE=4;var PROP_STOP_ON_SOLIDS=5;var PROP_ENABLED=6;_C255.Behaviors.MoveTo.Instance=/*#__PURE__*/function(_C255$SDKBehaviorInst){_inherits(MoveToInstance,_C255$SDKBehaviorInst);function MoveToInstance(behInst,properties){var _this206;_classCallCheck(this,MoveToInstance);_this206=_possibleConstructorReturn(this,_getPrototypeOf(MoveToInstance).call(this,behInst));_this206._maxSpeed=200;_this206._acc=600;_this206._dec=600;_this206._rotateSpeed=0;_this206._setAngle=true;_this206._stopOnSolids=false;_this206._isEnabled=true;_this206._speed=0;_this206._movingAngle=_this206.GetWorldInfo().GetAngle();_this206._waypoints=[];if(properties){_this206._maxSpeed=properties[PROP_MAX_SPEED];_this206._acc=properties[PROP_ACCELERATION];_this206._dec=properties[PROP_DECELERATION];_this206._rotateSpeed=_C255.toRadians(properties[PROP_ROTATE_SPEED]);_this206._setAngle=properties[PROP_SET_ANGLE];_this206._stopOnSolids=properties[PROP_STOP_ON_SOLIDS];_this206._isEnabled=properties[PROP_ENABLED];}_this206._timelineInfo=null;_this206._lastBezierPosition=NaN;_this206._lastBezierSegment=NaN;return _this206;}_createClass(MoveToInstance,[{key:"Release",value:function Release(){if(this._timelineInfo){this._timelineInfo.Release();this._timelineInfo=null;}this._lastBezierPosition=NaN;this._lastBezierSegment=NaN;_get(_getPrototypeOf(MoveToInstance.prototype),"Release",this).call(this);}},{key:"SaveToJson",value:function SaveToJson(){return{"ms":this._maxSpeed,"acc":this._acc,"dec":this._dec,"rs":this._rotateSpeed,"sa":this._setAngle,"sos":this._stopOnSolids,"s":this._speed,"ma":this._movingAngle,"wp":this._waypoints.map(function(p){return{"x":p.x,"y":p.y};}),"e":this._isEnabled};}},{key:"LoadFromJson",value:function LoadFromJson(o){this._maxSpeed=o["ms"];this._acc=o["acc"];this._dec=o["dec"];this._rotateSpeed=o["rs"];this._setAngle=o["sa"];this._stopOnSolids=o["sos"];this._speed=o["s"];this._movingAngle=o["ma"];this._waypoints=o["wp"].map(function(p){return{x:p["x"],y:p["y"]};});this._SetEnabled(o["e"]);if(this._isEnabled&&this._waypoints.length>0)this._StartTicking();}},{key:"_AddWaypoint",value:function _AddWaypoint(x,y,isDirect,opts){if(isDirect)_C255.clearArray(this._waypoints);this._waypoints.push({x:x,y:y,opts:opts});if(this._isEnabled)this._StartTicking();}},{key:"_GetWaypointCount",value:function _GetWaypointCount(){return this._waypoints.length;}},{key:"_GetWaypointXAt",value:function _GetWaypointXAt(i){i=Math.floor(i);if(i<0||i>=this._waypoints.length)return 0;return this._waypoints[i].x;}},{key:"_GetWaypointYAt",value:function _GetWaypointYAt(i){i=Math.floor(i);if(i<0||i>=this._waypoints.length)return 0;return this._waypoints[i].y;}},{key:"_IsMoving",value:function _IsMoving(){return this._waypoints.length>0;}},{key:"_Stop",value:function _Stop(){_C255.clearArray(this._waypoints);this._speed=0;this._StopTicking();}},{key:"_GetTargetX",value:function _GetTargetX(){if(this._waypoints.length>0)return this._waypoints[0].x;else return 0;}},{key:"_GetTargetY",value:function _GetTargetY(){if(this._waypoints.length>0)return this._waypoints[0].y;else return 0;}},{key:"_GetTargetIsBezier",value:function _GetTargetIsBezier(){if(this._waypoints.length>0){var waypoint=this._waypoints[0];if(waypoint.opts)return waypoint.opts.isBezier;}return false;}},{key:"_GetTargetIsBezierFirst",value:function _GetTargetIsBezierFirst(){if(this._waypoints.length>0){var waypoint=this._waypoints[0];if(waypoint.opts)return waypoint.opts.isBezier&&waypoint.opts.isFirst;}return false;}},{key:"_GetTargetBezierPosition",value:function _GetTargetBezierPosition(){if(this._waypoints.length>0){var waypoint=this._waypoints[0];if(waypoint.opts)return waypoint.opts.bezierPosition;}return false;}},{key:"_GetTargetBezierSegment",value:function _GetTargetBezierSegment(){if(this._waypoints.length>0){var waypoint=this._waypoints[0];if(waypoint.opts)return waypoint.opts.bezierSegment;}return false;}},{key:"_SetSpeed",value:function _SetSpeed(s){if(!this._IsMoving())return;this._speed=Math.min(s,this._maxSpeed);}},{key:"_GetSpeed",value:function _GetSpeed(){return this._speed;}},{key:"_SetMaxSpeed",value:function _SetMaxSpeed(ms){this._maxSpeed=Math.max(ms,0);this._SetSpeed(this._speed);}},{key:"_GetMaxSpeed",value:function _GetMaxSpeed(){return this._maxSpeed;}},{key:"_IsRotationEnabled",value:function _IsRotationEnabled(){if(this._isEnabled&&this._IsMoving())if(this._GetTargetIsBezier()){if(this._GetTargetIsBezierFirst())return true;return false;}return this._rotateSpeed!==0;}},{key:"Tick",value:function Tick(){if(!this._isEnabled||!this._IsMoving())return;var dt=this._runtime.GetDt(this._inst);var wi=this._inst.GetWorldInfo();var startX=wi.GetX();var startY=wi.GetY();var startAngle=wi.GetAngle();var curSpeed=this._speed;var maxSpeed=this._maxSpeed;var acc=this._acc;var dec=this._dec;var targetX=this._GetTargetX();var targetY=this._GetTargetY();var angleToTarget=_C255.angleTo(startX,startY,targetX,targetY);var isWithinStoppingDistance=false;if(dec>0&&this._waypoints.length===1){var stoppingDist=.5*curSpeed*curSpeed/dec*1.0001;isWithinStoppingDistance=_C255.distanceSquared(startX,startY,targetX,targetY)<=stoppingDist*stoppingDist;if(isWithinStoppingDistance){var remainingDist=_C255.distanceTo(startX,startY,targetX,targetY);curSpeed=Math.sqrt(2*dec*remainingDist);maxSpeed=curSpeed;this._speed=curSpeed;}}if(this._IsRotationEnabled()){var da=_C255.angleDiff(this._movingAngle,angleToTarget);if(da>Number.EPSILON){var t=da/this._rotateSpeed;var dist=_C255.distanceTo(wi.GetX(),wi.GetY(),targetX,targetY);var r=dist/(2*Math.sin(da));var curveDist=r*da;maxSpeed=Math.min(maxSpeed,_C255.clamp(curveDist/t,0,this._maxSpeed));}}var curAcc=isWithinStoppingDistance?-dec:acc;var stepDist=Math.min(curSpeed*dt+.5*curAcc*dt*dt,maxSpeed*dt);if(isWithinStoppingDistance){if(dec>0){this._speed=Math.max(this._speed-dec*dt,0);if(this._speed===0){this._OnArrived(wi,targetX,targetY);return;}}}else if(acc===0)this._speed=maxSpeed;else this._speed=Math.min(this._speed+acc*dt,maxSpeed);if(_C255.distanceSquared(wi.GetX(),wi.GetY(),targetX,targetY)<=stepDist*stepDist){this._OnArrived(wi,targetX,targetY);return;}if(this._IsRotationEnabled())this._movingAngle=_C255.angleRotate(this._movingAngle,angleToTarget,this._rotateSpeed*dt);else this._movingAngle=angleToTarget;wi.OffsetXY(Math.cos(this._movingAngle)*stepDist,Math.sin(this._movingAngle)*stepDist);if(this._setAngle){var targetIsBezier=this._GetTargetIsBezier();var targetIsBezierFirst=this._GetTargetIsBezierFirst();if(targetIsBezier&&!targetIsBezierFirst){var bezierSegment=this._GetTargetBezierSegment();var bezierPosition=this._GetTargetBezierPosition();var x=wi.GetX();var y=wi.GetY();if(self.isNaN(this._lastBezierSegment))this._lastBezierSegment=0;var projection;if(this._lastBezierSegment===bezierSegment)projection=this._timelineInfo.Project(x,y,{tRange:[this._lastBezierPosition,bezierPosition]});else projection=this._timelineInfo.Project(x,y);var angle=this._timelineInfo.TangentAngle(x,y,projection[2],projection[4]);wi.SetAngle(angle);}else{wi.SetAngle(this._movingAngle);this._lastBezierPosition=NaN;this._lastBezierSegment=NaN;}}wi.SetBboxChanged();this._CheckSolidCollision(startX,startY,startAngle);}},{key:"_OnArrived",value:function _OnArrived(wi,targetX,targetY){wi.SetXY(targetX,targetY);wi.SetBboxChanged();var waypoint=this._waypoints[0];if(waypoint.opts&&waypoint.opts.isBezier){this._lastBezierPosition=waypoint.opts.bezierPosition;this._lastBezierSegment=waypoint.opts.bezierSegment;}else{this._lastBezierPosition=NaN;this._lastBezierSegment=NaN;}this._waypoints.shift();if(this._waypoints.length===0){if(this._timelineInfo){this._timelineInfo.Release();this._timelineInfo=null;this._lastBezierPosition=NaN;this._lastBezierSegment=NaN;}this._speed=0;this._StopTicking();}this.DispatchScriptEvent("arrived");this.Trigger(_C255.Behaviors.MoveTo.Cnds.OnArrived);}},{key:"_CheckSolidCollision",value:function _CheckSolidCollision(startX,startY,startAngle){var collisionEngine=this._runtime.GetCollisionEngine();if(this._stopOnSolids&&collisionEngine.TestOverlapSolid(this._inst)){this._Stop();var wi=this._inst.GetWorldInfo();var x=wi.GetX();var y=wi.GetY();var _a16=_C255.angleTo(x,y,startX,startY);var dist=_C255.distanceTo(x,y,startX,startY);if(!collisionEngine.PushOutSolid(this._inst,Math.cos(_a16),Math.sin(_a16),Math.max(dist,1))){wi.SetXY(startX,startY);wi.SetAngle(startAngle);wi.SetBboxChanged();}this.DispatchScriptEvent("hitsolid");this.Trigger(_C255.Behaviors.MoveTo.Cnds.OnHitSolid);}}},{key:"_IsSetAngle",value:function _IsSetAngle(){return this._setAngle;}},{key:"_SetSetAngle",value:function _SetSetAngle(a){this._setAngle=!!a;}},{key:"_SetAngleOfMotion",value:function _SetAngleOfMotion(a){this._movingAngle=a;if(this._isEnabled&&this._setAngle&&!this._IsMoving()){var wi=this.GetWorldInfo();wi.SetAngle(this._movingAngle);wi.SetBboxChanged();}}},{key:"_GetAngleOfMotion",value:function _GetAngleOfMotion(){return this._movingAngle;}},{key:"_SetAcceleration",value:function _SetAcceleration(a){this._acc=Math.max(a,0);}},{key:"_GetAcceleration",value:function _GetAcceleration(){return this._acc;}},{key:"_SetDeceleration",value:function _SetDeceleration(d){this._dec=Math.max(d,0);}},{key:"_GetDeceleration",value:function _GetDeceleration(){return this._dec;}},{key:"_SetRotateSpeed",value:function _SetRotateSpeed(r){this._rotateSpeed=Math.max(r,0);}},{key:"_GetRotateSpeed",value:function _GetRotateSpeed(){return this._rotateSpeed;}},{key:"_SetStopOnSolids",value:function _SetStopOnSolids(e){this._stopOnSolids=!!e;}},{key:"_IsStopOnSolids",value:function _IsStopOnSolids(){return this._stopOnSolids;}},{key:"_SetEnabled",value:function _SetEnabled(e){e=!!e;if(this._isEnabled===e)return;this._isEnabled=e;if(this._isEnabled&&this._IsMoving())this._StartTicking();else this._StopTicking();}},{key:"_IsEnabled",value:function _IsEnabled(){return this._isEnabled;}},{key:"GetPropertyValueByIndex",value:function GetPropertyValueByIndex(index){switch(index){case PROP_MAX_SPEED:return this._GetMaxSpeed();case PROP_ACCELERATION:return this._GetAcceleration();case PROP_DECELERATION:return this._GetDeceleration();case PROP_ROTATE_SPEED:return _C255.toDegrees(this._GetRotateSpeed());case PROP_SET_ANGLE:return this._IsSetAngle();case PROP_STOP_ON_SOLIDS:return this._IsStopOnSolids();case PROP_ENABLED:return this._IsEnabled();}}},{key:"SetPropertyValueByIndex",value:function SetPropertyValueByIndex(index,value){switch(index){case PROP_MAX_SPEED:this._SetMaxSpeed(value);break;case PROP_ACCELERATION:this._SetAcceleration(value);break;case PROP_DECELERATION:this._SetDeceleration(value);break;case PROP_ROTATE_SPEED:this._SetRotateSpeed(_C255.toRadians(value));break;case PROP_SET_ANGLE:this._SetSetAngle(value);break;case PROP_STOP_ON_SOLIDS:this._SetStopOnSolids(value);break;case PROP_ENABLED:this._SetEnabled(value);break;}}},{key:"GetDebuggerProperties",value:function GetDebuggerProperties(){var _this207=this;var prefix="behaviors.moveto";return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:prefix+".debugger.speed",value:this._GetSpeed(),onedit:function onedit(v){return _this207._SetSpeed(v);}},{name:prefix+".debugger.angle-of-motion",value:_C255.toDegrees(this._GetAngleOfMotion()),onedit:function onedit(v){return _this207._movingAngle=_C255.toRadians(v);}},{name:prefix+".debugger.target-x",value:this._GetTargetX()},{name:prefix+".debugger.target-y",value:this._GetTargetY()},{name:prefix+".debugger.waypoint-count",value:this._GetWaypointCount()},{name:prefix+".properties.max-speed.name",value:this._GetMaxSpeed(),onedit:function onedit(v){return _this207._SetMaxSpeed(v);}},{name:prefix+".properties.acceleration.name",value:this._GetAcceleration(),onedit:function onedit(v){return _this207._SetAcceleration(v);}},{name:prefix+".properties.deceleration.name",value:this._GetDeceleration(),onedit:function onedit(v){return _this207._SetDeceleration(v);}},{name:prefix+".properties.rotate-speed.name",value:_C255.toDegrees(this._GetRotateSpeed()),onedit:function onedit(v){return _this207._SetRotateSpeed(_C255.toRadians(v));}},{name:prefix+".properties.enabled.name",value:this._IsEnabled(),onedit:function onedit(v){return _this207._SetEnabled(v);}}]}];}},{key:"GetScriptInterfaceClass",value:function GetScriptInterfaceClass(){return self.IMoveToBehaviorInstance;}}]);return MoveToInstance;}(_C255.SDKBehaviorInstanceBase);var _map19=new WeakMap();self.IMoveToBehaviorInstance=/*#__PURE__*/function(_IBehaviorInstance5){_inherits(IMoveToBehaviorInstance,_IBehaviorInstance5);function IMoveToBehaviorInstance(){var _this208;_classCallCheck(this,IMoveToBehaviorInstance);_this208=_possibleConstructorReturn(this,_getPrototypeOf(IMoveToBehaviorInstance).call(this));_map19.set(_assertThisInitialized(_this208),_IBehaviorInstance4._GetInitInst().GetSdkInstance());return _this208;}_createClass(IMoveToBehaviorInstance,[{key:"moveToPosition",value:function moveToPosition(x,y){var isDirect=arguments.length>2&&arguments[2]!==undefined?arguments[2]:true;_C3X27.RequireFiniteNumber(x);_C3X27.RequireFiniteNumber(y);_map19.get(this)._AddWaypoint(x,y,!!isDirect);}},{key:"getTargetX",value:function getTargetX(){return _map19.get(this)._GetTargetX();}},{key:"getTargetY",value:function getTargetY(){return _map19.get(this)._GetTargetY();}},{key:"getTargetPosition",value:function getTargetPosition(){var b=_map19.get(this);return[b._GetTargetX(),b._GetTargetY()];}},{key:"getWaypointCount",value:function getWaypointCount(){return _map19.get(this)._GetWaypointCount();}},{key:"getWaypointX",value:function getWaypointX(i){_C3X27.RequireFiniteNumber(i);return _map19.get(this)._GetWaypointXAt(i);}},{key:"getWaypointY",value:function getWaypointY(i){_C3X27.RequireFiniteNumber(i);return _map19.get(this)._GetWaypointYAt(i);}},{key:"getWaypoint",value:function getWaypoint(i){_C3X27.RequireFiniteNumber(i);var b=_map19.get(this);return[b._GetWaypointXAt(i),b._GetWaypointYAt(i)];}},{key:"stop",value:function stop(){_map19.get(this)._Stop();}},{key:"isMoving",get:function get(){return _map19.get(this)._IsMoving();}},{key:"speed",get:function get(){return _map19.get(this)._GetSpeed();},set:function set(s){_C3X27.RequireFiniteNumber(s);_map19.get(this)._SetSpeed(s);}},{key:"maxSpeed",get:function get(){return _map19.get(this)._GetMaxSpeed();},set:function set(ms){_C3X27.RequireFiniteNumber(ms);_map19.get(this)._SetMaxSpeed(ms);}},{key:"acceleration",get:function get(){return _map19.get(this)._GetAcceleration();},set:function set(a){_C3X27.RequireFiniteNumber(a);_map19.get(this)._SetAcceleration(a);}},{key:"deceleration",get:function get(){return _map19.get(this)._GetDeceleration();},set:function set(d){_C3X27.RequireFiniteNumber(d);_map19.get(this)._SetDeceleration(d);}},{key:"angleOfMotion",get:function get(){return _map19.get(this)._GetAngleOfMotion();},set:function set(a){_C3X27.RequireFiniteNumber(a);_map19.get(this)._SetAngleOfMotion(a);}},{key:"rotateSpeed",get:function get(){return _map19.get(this)._GetRotateSpeed();},set:function set(r){_C3X27.RequireFiniteNumber(r);_map19.get(this)._SetRotateSpeed(r);}},{key:"isStopOnSolids",get:function get(){return _map19.get(this)._IsStopOnSolids();},set:function set(e){_map19.get(this)._SetStopOnSolids(e);}},{key:"isEnabled",get:function get(){return _map19.get(this)._IsEnabled();},set:function set(e){_map19.get(this)._SetEnabled(e);}}]);return IMoveToBehaviorInstance;}(_IBehaviorInstance4);}{var _C256=self.C3;_C256.Behaviors.MoveTo.Cnds={IsMoving:function IsMoving(){return this._IsMoving();},CompareSpeed:function CompareSpeed(cmp,s){return _C256.compare(this._GetSpeed(),cmp,s);},IsEnabled:function IsEnabled(){return this._IsEnabled();},OnArrived:function OnArrived(){return true;},OnHitSolid:function OnHitSolid(){return true;}};}{var _C257=self.C3;_C257.Behaviors.MoveTo.Acts={MoveToPosition:function MoveToPosition(x,y,mode){this._AddWaypoint(x,y,mode===0);},MoveToObject:function MoveToObject(objectClass,imgPt,mode){if(!objectClass)return;var inst=objectClass.GetPairedInstance(this._inst);if(!inst||!inst.GetWorldInfo())return;var _inst$GetImagePoint3=inst.GetImagePoint(imgPt),_inst$GetImagePoint4=_slicedToArray(_inst$GetImagePoint3,2),x=_inst$GetImagePoint4[0],y=_inst$GetImagePoint4[1];this._AddWaypoint(x,y,mode===0);},MoveAlongPathfindingPath:function MoveAlongPathfindingPath(mode){var behInst=this._inst.GetBehaviorSdkInstanceFromCtor(_C257.Behaviors.Pathfinding);if(!behInst)return;var path=behInst._GetPath();if(path.length===0)return;for(var i=0,len=path.length;i<len;++i){var n=path[i];this._AddWaypoint(n.x,n.y,i===0&&mode===0);}},MoveAlongTimeline:function MoveAlongTimeline(timeline,trackId,mode){var timelineInfo=_C257.New(_C257.TimelineInfo,timeline,trackId);if(!timelineInfo.WasInitialized()){timelineInfo.Release();return;}timelineInfo.SetOrigin(this._inst.GetWorldInfo());var first=true;var _iteratorNormalCompletion604=true;var _didIteratorError604=false;var _iteratorError604=undefined;try{for(var _iterator604=timelineInfo.segments()[Symbol.iterator](),_step604;!(_iteratorNormalCompletion604=(_step604=_iterator604.next()).done);_iteratorNormalCompletion604=true){var segment=_step604.value;switch(segment.GetType()){case"line":{var x=segment.GetX();var y=segment.GetY();this._AddWaypoint(x,y,first&&mode===0);first=false;break;}case"cubic-bezier":{for(var i=0;i<=segment.GetStepCount();i++){var step=i*segment.GetStepIncrement();var p=segment.Map(step);var _x5=p[0];var _y4=p[1];this._AddWaypoint(_x5,_y4,first&&mode===0,{isBezier:true,isFirst:first,bezierPosition:segment._Map(step),bezierSegment:segment.GetIndex()});first=false;}break;}}}}catch(err){_didIteratorError604=true;_iteratorError604=err;}finally{try{if(!_iteratorNormalCompletion604&&_iterator604["return"]!=null){_iterator604["return"]();}}finally{if(_didIteratorError604){throw _iteratorError604;}}}this._timelineInfo=timelineInfo;},MoveAlongTimelineByName:function MoveAlongTimelineByName(timelineName,trackId,mode){var timeline=this._runtime.GetTimelineManager().GetTimelineByName(timelineName);if(!timeline)return;_C257.Behaviors.MoveTo.Acts.MoveAlongTimeline.call(this,timeline,trackId,mode);},Stop:function Stop(){this._Stop();},SetMovingAngle:function SetMovingAngle(a){this._SetAngleOfMotion(_C257.toRadians(a));},SetSpeed:function SetSpeed(s){this._SetSpeed(s);},SetMaxSpeed:function SetMaxSpeed(ms){this._SetMaxSpeed(ms);},SetAcceleration:function SetAcceleration(a){this._SetAcceleration(a);},SetDeceleration:function SetDeceleration(d){this._SetDeceleration(d);},SetRotateSpeed:function SetRotateSpeed(r){this._SetRotateSpeed(_C257.toRadians(r));},SetStopOnSolids:function SetStopOnSolids(e){this._SetStopOnSolids(e);},SetEnabled:function SetEnabled(e){this._SetEnabled(e);}};}{var _C258=self.C3;_C258.Behaviors.MoveTo.Exps={Speed:function Speed(){return this._GetSpeed();},MaxSpeed:function MaxSpeed(){return this._GetMaxSpeed();},Acceleration:function Acceleration(){return this._GetAcceleration();},Deceleration:function Deceleration(){return this._GetDeceleration();},MovingAngle:function MovingAngle(){return _C258.toDegrees(this._GetAngleOfMotion());},RotateSpeed:function RotateSpeed(){return _C258.toDegrees(this._GetRotateSpeed());},TargetX:function TargetX(){return this._GetTargetX();},TargetY:function TargetY(){return this._GetTargetY();},WaypointCount:function WaypointCount(){return this._GetWaypointCount();},WaypointXAt:function WaypointXAt(i){return this._GetWaypointXAt(i);},WaypointYAt:function WaypointYAt(i){return this._GetWaypointYAt(i);}};};}{'use strict';{var _C259=self.C3;_C259.Behaviors.scrollto=/*#__PURE__*/function(_C259$SDKBehaviorBase){_inherits(ScrollToBehavior,_C259$SDKBehaviorBase);function ScrollToBehavior(opts){var _this209;_classCallCheck(this,ScrollToBehavior);_this209=_possibleConstructorReturn(this,_getPrototypeOf(ScrollToBehavior).call(this,opts));_this209._shakeMag=0;_this209._shakeStart=0;_this209._shakeEnd=0;_this209._shakeMode=0;return _this209;}_createClass(ScrollToBehavior,[{key:"Release",value:function Release(){_get(_getPrototypeOf(ScrollToBehavior.prototype),"Release",this).call(this);}},{key:"SetShakeMagnitude",value:function SetShakeMagnitude(m){this._shakeMag=m;}},{key:"GetShakeMagnitude",value:function GetShakeMagnitude(){return this._shakeMag;}},{key:"SetShakeStart",value:function SetShakeStart(s){this._shakeStart=s;}},{key:"GetShakeStart",value:function GetShakeStart(){return this._shakeStart;}},{key:"SetShakeEnd",value:function SetShakeEnd(s){this._shakeEnd=s;}},{key:"GetShakeEnd",value:function GetShakeEnd(){return this._shakeEnd;}},{key:"SetShakeMode",value:function SetShakeMode(m){this._shakeMode=m;}},{key:"GetShakeMode",value:function GetShakeMode(){return this._shakeMode;}}]);return ScrollToBehavior;}(_C259.SDKBehaviorBase);}{var _C260=self.C3;_C260.Behaviors.scrollto.Type=/*#__PURE__*/function(_C260$SDKBehaviorType){_inherits(ScrollToType,_C260$SDKBehaviorType);function ScrollToType(objectClass){_classCallCheck(this,ScrollToType);return _possibleConstructorReturn(this,_getPrototypeOf(ScrollToType).call(this,objectClass));}_createClass(ScrollToType,[{key:"Release",value:function Release(){_get(_getPrototypeOf(ScrollToType.prototype),"Release",this).call(this);}},{key:"OnCreate",value:function OnCreate(){}}]);return ScrollToType;}(_C260.SDKBehaviorTypeBase);}{var _C261=self.C3;var _ENABLE3=0;_C261.Behaviors.scrollto.Instance=/*#__PURE__*/function(_C261$SDKBehaviorInst){_inherits(ScrollToInstance,_C261$SDKBehaviorInst);function ScrollToInstance(inst,properties){var _this210;_classCallCheck(this,ScrollToInstance);_this210=_possibleConstructorReturn(this,_getPrototypeOf(ScrollToInstance).call(this,inst));_this210._isEnabled=true;if(properties)_this210._isEnabled=properties[_ENABLE3];if(_this210._isEnabled)_this210._StartTicking2();return _this210;}_createClass(ScrollToInstance,[{key:"Release",value:function Release(){_get(_getPrototypeOf(ScrollToInstance.prototype),"Release",this).call(this);}},{key:"SaveToJson",value:function SaveToJson(){var behavior=this.GetBehavior();return{"e":this._isEnabled,"smg":behavior.GetShakeMagnitude(),"ss":behavior.GetShakeStart(),"se":behavior.GetShakeEnd(),"smd":behavior.GetShakeMode()};}},{key:"LoadFromJson",value:function LoadFromJson(o){var behavior=this.GetBehavior();behavior.SetShakeMagnitude(o["smg"]);behavior.SetShakeStart(o["ss"]);behavior.SetShakeEnd(o["se"]);behavior.SetShakeMode(o["smd"]);this._isEnabled=o["e"];if(this._isEnabled)this._StartTicking2();else this._StopTicking2();}},{key:"_SetEnabled",value:function _SetEnabled(e){this._isEnabled=!!e;if(this._isEnabled)this._StartTicking2();else this._StopTicking2();}},{key:"IsEnabled",value:function IsEnabled(){return this._isEnabled;}},{key:"Tick2",value:function Tick2(){if(!this.IsEnabled())return;var dt=this._runtime.GetDt(this._inst);var behavior=this.GetBehavior();var allInstances=behavior.GetInstances();var sumX=0;var sumY=0;var count=0;var _iteratorNormalCompletion605=true;var _didIteratorError605=false;var _iteratorError605=undefined;try{for(var _iterator605=allInstances[Symbol.iterator](),_step605;!(_iteratorNormalCompletion605=(_step605=_iterator605.next()).done);_iteratorNormalCompletion605=true){var inst=_step605.value;var behInst=inst.GetBehaviorInstanceFromCtor(_C261.Behaviors.scrollto);if(!behInst||!behInst.GetSdkInstance().IsEnabled())continue;var wi=inst.GetWorldInfo();sumX+=wi.GetX();sumY+=wi.GetY();++count;}}catch(err){_didIteratorError605=true;_iteratorError605=err;}finally{try{if(!_iteratorNormalCompletion605&&_iterator605["return"]!=null){_iterator605["return"]();}}finally{if(_didIteratorError605){throw _iteratorError605;}}}var layout=this._inst.GetWorldInfo().GetLayout();var now=this._runtime.GetGameTime();var offX=0;var offY=0;if(now>=behavior.GetShakeStart()&&now<behavior.GetShakeEnd()){var mag=behavior.GetShakeMagnitude()*Math.min(this._runtime.GetTimeScale(),1);if(behavior.GetShakeMode()===0)mag*=1-(now-behavior.GetShakeStart())/(behavior.GetShakeEnd()-behavior.GetShakeStart());var _a17=this._runtime.Random()*Math.PI*2;var d=this._runtime.Random()*mag;offX=Math.cos(_a17)*d;offY=Math.sin(_a17)*d;}layout.SetScrollX(sumX/count+offX);layout.SetScrollY(sumY/count+offY);}},{key:"GetPropertyValueByIndex",value:function GetPropertyValueByIndex(index){switch(index){case _ENABLE3:return this._isEnabled;}}},{key:"SetPropertyValueByIndex",value:function SetPropertyValueByIndex(index,value){switch(index){case _ENABLE3:this._isEnabled=!!value;this._isEnabled?this._StartTicking2():this._StopTicking2();break;}}},{key:"GetDebuggerProperties",value:function GetDebuggerProperties(){var _this211=this;var prefix="behaviors.scrollto";return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:prefix+".properties.enabled.name",value:this.IsEnabled(),onedit:function onedit(v){return _this211._SetEnabled(v);}}]}];}}]);return ScrollToInstance;}(_C261.SDKBehaviorInstanceBase);}{var _C262=self.C3;_C262.Behaviors.scrollto.Cnds={IsEnabled:function IsEnabled(){return this.IsEnabled();}};}{var _C263=self.C3;_C263.Behaviors.scrollto.Acts={Shake:function Shake(mag,dur,mode){var behavior=this.GetBehavior();behavior.SetShakeMagnitude(mag);behavior.SetShakeStart(this._runtime.GetGameTime());behavior.SetShakeEnd(this._runtime.GetGameTime()+dur);behavior.SetShakeMode(mode);},SetEnabled:function SetEnabled(e){this._SetEnabled(e!==0);}};}{var _C264=self.C3;_C264.Behaviors.scrollto.Exps={};};}{'use strict';{var _C265=self.C3;_C265.Behaviors.Bullet=/*#__PURE__*/function(_C265$SDKBehaviorBase){_inherits(BulletBehavior,_C265$SDKBehaviorBase);function BulletBehavior(opts){_classCallCheck(this,BulletBehavior);return _possibleConstructorReturn(this,_getPrototypeOf(BulletBehavior).call(this,opts));}_createClass(BulletBehavior,[{key:"Release",value:function Release(){_get(_getPrototypeOf(BulletBehavior.prototype),"Release",this).call(this);}}]);return BulletBehavior;}(_C265.SDKBehaviorBase);}{var _C266=self.C3;_C266.Behaviors.Bullet.Type=/*#__PURE__*/function(_C266$SDKBehaviorType){_inherits(BulletType,_C266$SDKBehaviorType);function BulletType(behaviorType){_classCallCheck(this,BulletType);return _possibleConstructorReturn(this,_getPrototypeOf(BulletType).call(this,behaviorType));}_createClass(BulletType,[{key:"Release",value:function Release(){_get(_getPrototypeOf(BulletType.prototype),"Release",this).call(this);}},{key:"OnCreate",value:function OnCreate(){}}]);return BulletType;}(_C266.SDKBehaviorTypeBase);}{var _C267=self.C3;var _C3X28=self.C3X;var _IBehaviorInstance6=self.IBehaviorInstance;var SPEED=0;var _ACCELERATION=1;var _GRAVITY=2;var BOUNCE_OFF_SOLIDS=3;var SET_ANGLE=4;var STEPPING=5;var _ENABLE4=6;_C267.Behaviors.Bullet.Instance=/*#__PURE__*/function(_C267$SDKBehaviorInst){_inherits(BulletInstance,_C267$SDKBehaviorInst);function BulletInstance(behInst,properties){var _this212;_classCallCheck(this,BulletInstance);_this212=_possibleConstructorReturn(this,_getPrototypeOf(BulletInstance).call(this,behInst));var wi=_this212.GetWorldInfo();_this212._speed=0;_this212._acc=0;_this212._g=0;_this212._bounceOffSolid=false;_this212._setAngle=false;_this212._isStepping=false;_this212._isEnabled=true;_this212._dx=0;_this212._dy=0;_this212._lastX=wi.GetX();_this212._lastY=wi.GetY();_this212._lastKnownAngle=wi.GetAngle();_this212._travelled=0;_this212._stepSize=Math.min(Math.abs(wi.GetWidth()),Math.abs(wi.GetHeight())/2);_this212._stopStepping=false;if(properties){_this212._speed=properties[SPEED];_this212._acc=properties[_ACCELERATION];_this212._g=properties[_GRAVITY];_this212._bounceOffSolid=!!properties[BOUNCE_OFF_SOLIDS];_this212._setAngle=!!properties[SET_ANGLE];_this212._isStepping=!!properties[STEPPING];_this212._isEnabled=!!properties[_ENABLE4];}var a=wi.GetAngle();_this212._dx=Math.cos(a)*_this212._speed;_this212._dy=Math.sin(a)*_this212._speed;if(_this212._isEnabled){_this212._StartTicking();if(_this212._bounceOffSolid)_this212._StartPostTicking();}return _this212;}_createClass(BulletInstance,[{key:"Release",value:function Release(){_get(_getPrototypeOf(BulletInstance.prototype),"Release",this).call(this);}},{key:"SaveToJson",value:function SaveToJson(){var o={"dx":this._dx,"dy":this._dy,"lx":this._lastX,"ly":this._lastY,"lka":this._lastKnownAngle,"t":this._travelled};if(this._acc!==0)o["acc"]=this._acc;if(this._g!==0)o["g"]=this._g;if(this._isStepping)o["st"]=this._isStepping;if(!this._isEnabled)o["e"]=this._isEnabled;if(this._bounceOffSolid)o["bos"]=this._bounceOffSolid;if(this._setAngle)o["sa"]=this._setAngle;return o;}},{key:"LoadFromJson",value:function LoadFromJson(o){this._dx=o["dx"];this._dy=o["dy"];this._lastX=o["lx"];this._lastY=o["ly"];this._lastKnownAngle=o["lka"];this._travelled=o["t"];this._acc=o.hasOwnProperty("acc")?o["acc"]:0;this._g=o.hasOwnProperty("g")?o["g"]:0;this._isStepping=o.hasOwnProperty("st")?o["st"]:false;this._bounceOffSolid=o.hasOwnProperty("bos")?o["bos"]:false;this._setAngle=o.hasOwnProperty("sa")?o["sa"]:false;this._SetEnabled(o.hasOwnProperty("e")?o["e"]:true);}},{key:"Tick",value:function Tick(){if(!this._isEnabled)return;var dt=this._runtime.GetDt(this._inst);var wi=this._inst.GetWorldInfo();if(wi.GetAngle()!==this._lastKnownAngle){var angle=wi.GetAngle();if(this._setAngle){var s=_C267.distanceTo(0,0,this._dx,this._dy);this._dx=Math.cos(angle)*s;this._dy=Math.sin(angle)*s;}this._lastKnownAngle=angle;}var xacc=0;var yacc=0;if(this._acc!==0){var _s4=_C267.distanceTo(0,0,this._dx,this._dy);var _a18=0;if(this._dx===0&&this._dy===0)_a18=wi.GetAngle();else _a18=_C267.angleTo(0,0,this._dx,this._dy);_s4+=this._acc*dt;xacc=Math.cos(_a18)*this._acc;yacc=Math.sin(_a18)*this._acc;if(_s4<0){_s4=0;xacc=0;yacc=0;}this._dx=Math.cos(_a18)*_s4;this._dy=Math.sin(_a18)*_s4;}if(this._g!==0){this._dy+=this._g*dt;yacc+=this._g;}this._lastX=wi.GetX();this._lastY=wi.GetY();if(this._dx!==0||this._dy!==0){var mx=this._dx*dt+.5*xacc*dt*dt;var my=this._dy*dt+.5*yacc*dt*dt;var stepDist=_C267.distanceTo(0,0,mx,my);this._MoveBy(mx,my,stepDist);this._travelled+=stepDist;if(this._setAngle&&(mx!==0||my!==0)){var _a19=_C267.angleTo(0,0,mx,my);wi.SetAngle(_a19);this._lastKnownAngle=wi.GetAngle();}wi.SetBboxChanged();}}},{key:"_MoveBy",value:function _MoveBy(mx,my,stepDist){var wi=this.GetWorldInfo();if(!this._isStepping||stepDist<=this._stepSize){wi.OffsetXY(mx,my);wi.SetBboxChanged();if(this._isStepping)this.Trigger(_C267.Behaviors.Bullet.Cnds.OnStep);return;}this._stopStepping=false;var startX=wi.GetX();var startY=wi.GetY();var endX=startX+mx;var endY=startY+my;var a=_C267.angleTo(0,0,mx,my);var stepX=Math.cos(a)*this._stepSize;var stepY=Math.sin(a)*this._stepSize;var stepCount=Math.floor(stepDist/this._stepSize);for(var i=1;i<=stepCount;++i){wi.SetXY(startX+stepX*i,startY+stepY*i);wi.SetBboxChanged();this.Trigger(_C267.Behaviors.Bullet.Cnds.OnStep);if(this._inst.IsDestroyed()||this._stopStepping)return;}wi.SetXY(endX,endY);wi.SetBboxChanged();this.Trigger(_C267.Behaviors.Bullet.Cnds.OnStep);}},{key:"PostTick",value:function PostTick(){if(!this._isEnabled||!this._bounceOffSolid||this._dx===0&&this._dy===0)return;var dt=this._runtime.GetDt(this._inst);var wi=this._inst.GetWorldInfo();var collisionEngine=this._runtime.GetCollisionEngine();var bounceSolid=collisionEngine.TestOverlapSolid(this._inst);if(bounceSolid){collisionEngine.RegisterCollision(this._inst,bounceSolid);var s=_C267.distanceTo(0,0,this._dx,this._dy);var bounceAngle=collisionEngine.CalculateBounceAngle(this._inst,this._lastX,this._lastY);this._dx=Math.cos(bounceAngle)*s;this._dy=Math.sin(bounceAngle)*s;wi.OffsetXY(this._dx*dt,this._dy*dt);wi.SetBboxChanged();if(this._setAngle){wi.SetAngle(bounceAngle);this._lastKnownAngle=wi.GetAngle();wi.SetBboxChanged();}if(!collisionEngine.PushOutSolid(this._inst,this._dx/s,this._dy/s,Math.max(s*2.5*dt,30)))collisionEngine.PushOutSolidNearest(this._inst,100);}}},{key:"GetPropertyValueByIndex",value:function GetPropertyValueByIndex(index){switch(index){case SPEED:return this._GetSpeed();case _ACCELERATION:return this._GetAcceleration();case _GRAVITY:return this._GetGravity();case SET_ANGLE:return this._setAngle;case STEPPING:return this._isStepping;case _ENABLE4:return this._IsEnabled();}}},{key:"SetPropertyValueByIndex",value:function SetPropertyValueByIndex(index,value){switch(index){case SPEED:this._SetSpeed(value);break;case _ACCELERATION:this._acc=value;break;case _GRAVITY:this._g=value;break;case SET_ANGLE:this._setAngle=!!value;break;case STEPPING:this._isStepping=!!value;break;case _ENABLE4:this._SetEnabled(!!value);break;}}},{key:"_SetSpeed",value:function _SetSpeed(s){var a=_C267.angleTo(0,0,this._dx,this._dy);this._dx=Math.cos(a)*s;this._dy=Math.sin(a)*s;}},{key:"_GetSpeed",value:function _GetSpeed(){return _C267.roundToDp(_C267.distanceTo(0,0,this._dx,this._dy),6);}},{key:"_SetAcceleration",value:function _SetAcceleration(a){this._acc=a;}},{key:"_GetAcceleration",value:function _GetAcceleration(){return this._acc;}},{key:"_SetGravity",value:function _SetGravity(g){this._g=g;}},{key:"_GetGravity",value:function _GetGravity(){return this._g;}},{key:"_SetAngleOfMotion",value:function _SetAngleOfMotion(a){var s=_C267.distanceTo(0,0,this._dx,this._dy);this._dx=Math.cos(a)*s;this._dy=Math.sin(a)*s;}},{key:"_GetAngleOfMotion",value:function _GetAngleOfMotion(){return _C267.angleTo(0,0,this._dx,this._dy);}},{key:"_SetBounceOffSolids",value:function _SetBounceOffSolids(b){b=!!b;if(this._bounceOffSolid===b)return;this._bounceOffSolid=b;if(this._isEnabled)if(this._bounceOffSolid)this._StartPostTicking();else this._StopPostTicking();}},{key:"_IsBounceOffSolids",value:function _IsBounceOffSolids(){return this._bounceOffSolid;}},{key:"_SetDistanceTravelled",value:function _SetDistanceTravelled(d){this._travelled=d;}},{key:"_GetDistanceTravelled",value:function _GetDistanceTravelled(){return this._travelled;}},{key:"_SetEnabled",value:function _SetEnabled(e){this._isEnabled=!!e;if(this._isEnabled){this._StartTicking();if(this._bounceOffSolid)this._StartPostTicking();}else{this._StopTicking();this._StopPostTicking();}}},{key:"_IsEnabled",value:function _IsEnabled(){return this._isEnabled;}},{key:"GetDebuggerProperties",value:function GetDebuggerProperties(){var _this213=this;var prefix="behaviors.bullet";return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:prefix+".debugger.vector-x",value:this._dx,onedit:function onedit(v){return _this213._dx=v;}},{name:prefix+".debugger.vector-y",value:this._dy,onedit:function onedit(v){return _this213._dy=v;}},{name:prefix+".properties.speed.name",value:this._GetSpeed(),onedit:function onedit(v){return _this213._SetSpeed(v);}},{name:prefix+".debugger.angle-of-motion",value:_C267.toDegrees(this._GetAngleOfMotion())},{name:prefix+".properties.gravity.name",value:this._GetGravity(),onedit:function onedit(v){return _this213._SetGravity(v);}},{name:prefix+".properties.acceleration.name",value:this._GetAcceleration(),onedit:function onedit(v){return _this213._SetAcceleration(v);}},{name:prefix+".debugger.distance-travelled",value:this._GetDistanceTravelled()},{name:prefix+".properties.enabled.name",value:this._IsEnabled(),onedit:function onedit(v){return _this213._SetEnabled(v);}}]}];}},{key:"GetScriptInterfaceClass",value:function GetScriptInterfaceClass(){return self.IBulletBehaviorInstance;}}]);return BulletInstance;}(_C267.SDKBehaviorInstanceBase);var _map20=new WeakMap();self.IBulletBehaviorInstance=/*#__PURE__*/function(_IBehaviorInstance7){_inherits(IBulletBehaviorInstance,_IBehaviorInstance7);function IBulletBehaviorInstance(){var _this214;_classCallCheck(this,IBulletBehaviorInstance);_this214=_possibleConstructorReturn(this,_getPrototypeOf(IBulletBehaviorInstance).call(this));_map20.set(_assertThisInitialized(_this214),_IBehaviorInstance6._GetInitInst().GetSdkInstance());return _this214;}_createClass(IBulletBehaviorInstance,[{key:"speed",get:function get(){return _map20.get(this)._GetSpeed();},set:function set(s){_C3X28.RequireFiniteNumber(s);_map20.get(this)._SetSpeed(s);}},{key:"acceleration",get:function get(){return _map20.get(this)._GetAcceleration();},set:function set(a){_C3X28.RequireFiniteNumber(a);_map20.get(this)._SetAcceleration(a);}},{key:"gravity",get:function get(){return _map20.get(this)._GetGravity();},set:function set(g){_C3X28.RequireFiniteNumber(g);_map20.get(this)._SetGravity(g);}},{key:"angleOfMotion",get:function get(){return _map20.get(this)._GetAngleOfMotion();},set:function set(a){_C3X28.RequireFiniteNumber(a);_map20.get(this)._SetAngleOfMotion(a);}},{key:"bounceOffSolids",get:function get(){return _map20.get(this)._IsBounceOffSolids();},set:function set(b){_map20.get(this)._SetBounceOffSolids(!!b);}},{key:"distanceTravelled",get:function get(){return _map20.get(this)._GetDistanceTravelled();},set:function set(d){_C3X28.RequireFiniteNumber(d);_map20.get(this)._SetDistanceTravelled(d);}},{key:"isEnabled",get:function get(){return _map20.get(this)._IsEnabled();},set:function set(e){_map20.get(this)._SetEnabled(e);}}]);return IBulletBehaviorInstance;}(_IBehaviorInstance6);}{var _C268=self.C3;_C268.Behaviors.Bullet.Cnds={CompareSpeed:function CompareSpeed(cmp,s){var speed=Math.hypot(this._dx,this._dy);return _C268.compare(speed,cmp,s);},CompareTravelled:function CompareTravelled(cmp,d){return _C268.compare(this._GetDistanceTravelled(),cmp,d);},OnStep:function OnStep(){return true;},IsEnabled:function IsEnabled(){return this._IsEnabled();}};}{var _C269=self.C3;_C269.Behaviors.Bullet.Acts={SetSpeed:function SetSpeed(s){this._SetSpeed(s);},SetAcceleration:function SetAcceleration(a){this._SetAcceleration(a);},SetGravity:function SetGravity(g){this._SetGravity(g);},SetAngleOfMotion:function SetAngleOfMotion(a){this._SetAngleOfMotion(_C269.toRadians(a));},Bounce:function Bounce(objectClass){if(!objectClass)return;var otherInst=objectClass.GetFirstPicked(this._inst);if(!otherInst)return;var wi=this._inst.GetWorldInfo();var collisionEngine=this._runtime.GetCollisionEngine();var dt=this._runtime.GetDt(this._inst);var s=_C269.distanceTo(0,0,this._dx,this._dy);var bounceAngle=collisionEngine.CalculateBounceAngle(this._inst,this._lastX,this._lastY,otherInst);this._dx=Math.cos(bounceAngle)*s;this._dy=Math.sin(bounceAngle)*s;wi.OffsetXY(this._dx*dt,this._dy*dt);wi.SetBboxChanged();if(this._setAngle){wi.SetAngle(bounceAngle);this._lastKnownAngle=wi.GetAngle();wi.SetBboxChanged();}if(s!==0)if(this._bounceOffSolid){if(!collisionEngine.PushOutSolid(this._inst,this._dx/s,this._dy/s,Math.max(s*2.5*dt,30)))collisionEngine.PushOutSolidNearest(this._inst,100);}else collisionEngine.PushOut(this._inst,this._dx/s,this._dy/s,Math.max(s*2.5*dt,30),otherInst);},SetBounceOffSolids:function SetBounceOffSolids(b){this._SetBounceOffSolids(b);},SetDistanceTravelled:function SetDistanceTravelled(d){this._SetDistanceTravelled(d);},SetEnabled:function SetEnabled(e){this._SetEnabled(e);},StopStepping:function StopStepping(){this._stopStepping=true;}};}{var _C270=self.C3;_C270.Behaviors.Bullet.Exps={Speed:function Speed(){return this._GetSpeed();},Acceleration:function Acceleration(){return this._GetAcceleration();},AngleOfMotion:function AngleOfMotion(){return _C270.toDegrees(this._GetAngleOfMotion());},DistanceTravelled:function DistanceTravelled(){return this._GetDistanceTravelled();},Gravity:function Gravity(){return this._GetGravity();}};};}{'use strict';{var _C271=self.C3;_C271.Behaviors.solid=/*#__PURE__*/function(_C271$SDKBehaviorBase){_inherits(SolidBehavior,_C271$SDKBehaviorBase);function SolidBehavior(opts){_classCallCheck(this,SolidBehavior);return _possibleConstructorReturn(this,_getPrototypeOf(SolidBehavior).call(this,opts));}_createClass(SolidBehavior,[{key:"Release",value:function Release(){_get(_getPrototypeOf(SolidBehavior.prototype),"Release",this).call(this);}}]);return SolidBehavior;}(_C271.SDKBehaviorBase);}{var _C272=self.C3;_C272.Behaviors.solid.Type=/*#__PURE__*/function(_C272$SDKBehaviorType){_inherits(SolidType,_C272$SDKBehaviorType);function SolidType(behaviorType){_classCallCheck(this,SolidType);return _possibleConstructorReturn(this,_getPrototypeOf(SolidType).call(this,behaviorType));}_createClass(SolidType,[{key:"Release",value:function Release(){_get(_getPrototypeOf(SolidType.prototype),"Release",this).call(this);}},{key:"OnCreate",value:function OnCreate(){}}]);return SolidType;}(_C272.SDKBehaviorTypeBase);}{var _C273=self.C3;var _C3X29=self.C3X;var _IBehaviorInstance8=self.IBehaviorInstance;var _ENABLE5=0;var _TAGS=1;var EMPTY_SET=new Set();_C273.Behaviors.solid.Instance=/*#__PURE__*/function(_C273$SDKBehaviorInst){_inherits(SolidInstance,_C273$SDKBehaviorInst);function SolidInstance(behInst,properties){var _this215;_classCallCheck(this,SolidInstance);_this215=_possibleConstructorReturn(this,_getPrototypeOf(SolidInstance).call(this,behInst));_this215.SetEnabled(true);if(properties){_this215.SetEnabled(properties[_ENABLE5]);_this215.SetTags(properties[_TAGS]);}return _this215;}_createClass(SolidInstance,[{key:"Release",value:function Release(){_get(_getPrototypeOf(SolidInstance.prototype),"Release",this).call(this);}},{key:"SetEnabled",value:function SetEnabled(e){this._inst._SetSolidEnabled(!!e);}},{key:"IsEnabled",value:function IsEnabled(){return this._inst._IsSolidEnabled();}},{key:"SetTags",value:function SetTags(tagList){var savedDataMap=this._inst.GetSavedDataMap();if(!tagList.trim()){savedDataMap["delete"]("solidTags");return;}var solidTags=savedDataMap.get("solidTags");if(!solidTags){solidTags=new Set();savedDataMap.set("solidTags",solidTags);}solidTags.clear();var _iteratorNormalCompletion606=true;var _didIteratorError606=false;var _iteratorError606=undefined;try{for(var _iterator606=tagList.split(" ")[Symbol.iterator](),_step606;!(_iteratorNormalCompletion606=(_step606=_iterator606.next()).done);_iteratorNormalCompletion606=true){var tag=_step606.value;if(tag)solidTags.add(tag.toLowerCase());}}catch(err){_didIteratorError606=true;_iteratorError606=err;}finally{try{if(!_iteratorNormalCompletion606&&_iterator606["return"]!=null){_iterator606["return"]();}}finally{if(_didIteratorError606){throw _iteratorError606;}}}}},{key:"GetTags",value:function GetTags(){return this._inst.GetSavedDataMap().get("solidTags")||EMPTY_SET;}},{key:"_GetTagsString",value:function _GetTagsString(){return _toConsumableArray(this.GetTags()).join(" ");}},{key:"SaveToJson",value:function SaveToJson(){return{"e":this.IsEnabled()};}},{key:"LoadFromJson",value:function LoadFromJson(o){this.SetEnabled(o["e"]);}},{key:"GetPropertyValueByIndex",value:function GetPropertyValueByIndex(index){switch(index){case _ENABLE5:return this.IsEnabled();}}},{key:"SetPropertyValueByIndex",value:function SetPropertyValueByIndex(index,value){switch(index){case _ENABLE5:this.SetEnabled(value);break;}}},{key:"GetDebuggerProperties",value:function GetDebuggerProperties(){var _this216=this;return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:"behaviors.solid.properties.enabled.name",value:this.IsEnabled(),onedit:function onedit(v){return _this216.SetEnabled(v);}},{name:"behaviors.solid.properties.tags.name",value:this._GetTagsString(),onedit:function onedit(v){return _this216.SetTags(v);}}]}];}},{key:"GetScriptInterfaceClass",value:function GetScriptInterfaceClass(){return self.ISolidBehaviorInstance;}}]);return SolidInstance;}(_C273.SDKBehaviorInstanceBase);var _map21=new WeakMap();self.ISolidBehaviorInstance=/*#__PURE__*/function(_IBehaviorInstance9){_inherits(ISolidBehaviorInstance,_IBehaviorInstance9);function ISolidBehaviorInstance(){var _this217;_classCallCheck(this,ISolidBehaviorInstance);_this217=_possibleConstructorReturn(this,_getPrototypeOf(ISolidBehaviorInstance).call(this));_map21.set(_assertThisInitialized(_this217),_IBehaviorInstance8._GetInitInst().GetSdkInstance());return _this217;}_createClass(ISolidBehaviorInstance,[{key:"isEnabled",set:function set(e){_map21.get(this).SetEnabled(!!e);},get:function get(){return _map21.get(this).IsEnabled();}},{key:"tags",set:function set(str){_C3X29.RequireString(str);_map21.get(this).SetTags(str);},get:function get(){return _map21.get(this)._GetTagsString();}}]);return ISolidBehaviorInstance;}(_IBehaviorInstance8);}{var _C274=self.C3;_C274.Behaviors.solid.Cnds={IsEnabled:function IsEnabled(){return this.IsEnabled();}};}{var _C275=self.C3;_C275.Behaviors.solid.Acts={SetEnabled:function SetEnabled(e){this.SetEnabled(e);},SetTags:function SetTags(tagList){this.SetTags(tagList);}};}{var _C276=self.C3;_C276.Behaviors.solid.Exps={};};}{'use strict';{var _C277=self.C3;_C277.Behaviors.Pin=/*#__PURE__*/function(_C277$SDKBehaviorBase){_inherits(PinBehavior,_C277$SDKBehaviorBase);function PinBehavior(opts){_classCallCheck(this,PinBehavior);return _possibleConstructorReturn(this,_getPrototypeOf(PinBehavior).call(this,opts));}_createClass(PinBehavior,[{key:"Release",value:function Release(){_get(_getPrototypeOf(PinBehavior.prototype),"Release",this).call(this);}}]);return PinBehavior;}(_C277.SDKBehaviorBase);}{var _C278=self.C3;_C278.Behaviors.Pin.Type=/*#__PURE__*/function(_C278$SDKBehaviorType){_inherits(PinType,_C278$SDKBehaviorType);function PinType(behaviorType){_classCallCheck(this,PinType);return _possibleConstructorReturn(this,_getPrototypeOf(PinType).call(this,behaviorType));}_createClass(PinType,[{key:"Release",value:function Release(){_get(_getPrototypeOf(PinType.prototype),"Release",this).call(this);}},{key:"OnCreate",value:function OnCreate(){}}]);return PinType;}(_C278.SDKBehaviorTypeBase);}{var _C279=self.C3;_C279.Behaviors.Pin.Instance=/*#__PURE__*/function(_C279$SDKBehaviorInst){_inherits(PinInstance,_C279$SDKBehaviorInst);function PinInstance(behInst,properties){var _this218;_classCallCheck(this,PinInstance);_this218=_possibleConstructorReturn(this,_getPrototypeOf(PinInstance).call(this,behInst));_this218._pinInst=null;_this218._pinUid=-1;_this218._mode="";_this218._propSet=new Set();_this218._pinDist=0;_this218._pinAngle=0;_this218._pinImagePoint=0;_this218._dx=0;_this218._dy=0;_this218._dWidth=0;_this218._dHeight=0;_this218._dAngle=0;_this218._dz=0;_this218._lastKnownAngle=0;_this218._destroy=false;if(properties)_this218._destroy=properties[0];var rt=_this218._runtime.Dispatcher();_this218._disposables=new _C279.CompositeDisposable(_C279.Disposable.From(rt,"instancedestroy",function(e){return _this218._OnInstanceDestroyed(e.instance);}),_C279.Disposable.From(rt,"afterload",function(e){return _this218._OnAfterLoad();}));return _this218;}_createClass(PinInstance,[{key:"Release",value:function Release(){this._pinInst=null;_get(_getPrototypeOf(PinInstance.prototype),"Release",this).call(this);}},{key:"_SetPinInst",value:function _SetPinInst(inst){if(inst){this._pinInst=inst;this._StartTicking2();}else{this._pinInst=null;this._StopTicking2();}}},{key:"_Pin",value:function _Pin(objectClass,mode,propList){if(!objectClass)return;var otherInst=objectClass.GetFirstPicked(this._inst);if(!otherInst)return;this._mode=mode;this._SetPinInst(otherInst);var myWi=this._inst.GetWorldInfo();var otherWi=otherInst.GetWorldInfo();if(this._mode==="properties"){var propSet=this._propSet;propSet.clear();var _iteratorNormalCompletion607=true;var _didIteratorError607=false;var _iteratorError607=undefined;try{for(var _iterator607=propList[Symbol.iterator](),_step607;!(_iteratorNormalCompletion607=(_step607=_iterator607.next()).done);_iteratorNormalCompletion607=true){var p=_step607.value;propSet.add(p);}}catch(err){_didIteratorError607=true;_iteratorError607=err;}finally{try{if(!_iteratorNormalCompletion607&&_iterator607["return"]!=null){_iterator607["return"]();}}finally{if(_didIteratorError607){throw _iteratorError607;}}}this._dx=myWi.GetX()-otherWi.GetX();this._dy=myWi.GetY()-otherWi.GetY();this._dAngle=myWi.GetAngle()-otherWi.GetAngle();this._lastKnownAngle=myWi.GetAngle();this._dz=myWi.GetZElevation()-otherWi.GetZElevation();if(propSet.has("x")&&propSet.has("y")){this._pinAngle=_C279.angleTo(otherWi.GetX(),otherWi.GetY(),myWi.GetX(),myWi.GetY())-otherWi.GetAngle();this._pinDist=_C279.distanceTo(otherWi.GetX(),otherWi.GetY(),myWi.GetX(),myWi.GetY());}if(propSet.has("width-abs"))this._dWidth=myWi.GetWidth()-otherWi.GetWidth();else if(propSet.has("width-scale"))this._dWidth=myWi.GetWidth()/otherWi.GetWidth();if(propSet.has("height-abs"))this._dHeight=myWi.GetHeight()-otherWi.GetHeight();else if(propSet.has("height-scale"))this._dHeight=myWi.GetHeight()/otherWi.GetHeight();}else this._pinDist=_C279.distanceTo(otherWi.GetX(),otherWi.GetY(),myWi.GetX(),myWi.GetY());}},{key:"SaveToJson",value:function SaveToJson(){var propSet=this._propSet;var mode=this._mode;var ret={"uid":this._pinInst?this._pinInst.GetUID():-1,"m":mode,"d":this._destroy};if(mode==="rope"||mode==="bar")ret["pd"]=this._pinDist;else if(mode==="properties"){ret["ps"]=_toConsumableArray(this._propSet);if(propSet.has("imagepoint"))ret["ip"]=this._pinImagePoint;else if(propSet.has("x")&&propSet.has("y")){ret["pa"]=this._pinAngle;ret["pd"]=this._pinDist;}else{if(propSet.has("x"))ret["dx"]=this._dx;if(propSet.has("y"))ret["dy"]=this._dy;}if(propSet.has("angle")){ret["da"]=this._dAngle;ret["lka"]=this._lastKnownAngle;}if(propSet.has("width-abs")||propSet.has("width-scale"))ret["dw"]=this._dWidth;if(propSet.has("height-abs")||propSet.has("height-scale"))ret["dh"]=this._dHeight;if(propSet.has("z"))ret["dz"]=this._dz;}return ret;}},{key:"LoadFromJson",value:function LoadFromJson(o){var mode=o["m"];var propSet=this._propSet;propSet.clear();this._pinUid=o["uid"];if(typeof mode==="number"){this._LoadFromJson_Legacy(o);return;}this._mode=mode;if(o.hasOwnProperty("d"))this._destroy=!!o["d"];if(mode==="rope"||mode==="bar")this._pinDist=o["pd"];else if(mode==="properties"){var _iteratorNormalCompletion608=true;var _didIteratorError608=false;var _iteratorError608=undefined;try{for(var _iterator608=o["ps"][Symbol.iterator](),_step608;!(_iteratorNormalCompletion608=(_step608=_iterator608.next()).done);_iteratorNormalCompletion608=true){var p=_step608.value;propSet.add(p);}}catch(err){_didIteratorError608=true;_iteratorError608=err;}finally{try{if(!_iteratorNormalCompletion608&&_iterator608["return"]!=null){_iterator608["return"]();}}finally{if(_didIteratorError608){throw _iteratorError608;}}}if(propSet.has("imagepoint"))this._pinImagePoint=o["ip"];else if(propSet.has("x")&&propSet.has("y")){this._pinAngle=o["pa"];this._pinDist=o["pd"];}else{if(propSet.has("x"))this._dx=o["dx"];if(propSet.has("y"))this._dy=o["dy"];}if(propSet.has("angle")){this._dAngle=o["da"];this._lastKnownAngle=o["lka"]||0;}if(propSet.has("width-abs")||propSet.has("width-scale"))this._dWidth=o["dw"];if(propSet.has("height-abs")||propSet.has("height-scale"))this._dHeight=o["dh"];if(propSet.has("z"))this._dz=o["dz"];}}},{key:"_LoadFromJson_Legacy",value:function _LoadFromJson_Legacy(o){var propSet=this._propSet;var myStartAngle=o["msa"];var theirStartAngle=o["tsa"];var pinAngle=o["pa"];var pinDist=o["pd"];var mode=o["m"];switch(mode){case 0:this._mode="properties";propSet.add("x").add("y").add("angle");this._pinAngle=pinAngle;this._pinDist=pinDist;this._dAngle=myStartAngle-theirStartAngle;this._lastKnownAngle=o["lka"];break;case 1:this._mode="properties";propSet.add("x").add("y");this._pinAngle=pinAngle;this._pinDist=pinDist;break;case 2:this._mode="properties";propSet.add("angle");this._dAngle=myStartAngle-theirStartAngle;this._lastKnownAngle=o["lka"];break;case 3:this._mode="rope";this._pinDist=o["pd"];break;case 4:this._mode="bar";this._pinDist=o["pd"];break;}}},{key:"_OnAfterLoad",value:function _OnAfterLoad(){if(this._pinUid===-1)this._SetPinInst(null);else{this._SetPinInst(this._runtime.GetInstanceByUID(this._pinUid));this._pinUid=-1;}}},{key:"_OnInstanceDestroyed",value:function _OnInstanceDestroyed(inst){if(this._pinInst===inst){this._SetPinInst(null);if(this._destroy)this._runtime.DestroyInstance(this._inst);}}},{key:"Tick2",value:function Tick2(){var pinInst=this._pinInst;if(!pinInst)return;var pinWi=pinInst.GetWorldInfo();var myInst=this._inst;var myWi=myInst.GetWorldInfo();var mode=this._mode;var bboxChanged=false;if(mode==="rope"||mode==="bar"){var dist=_C279.distanceTo(myWi.GetX(),myWi.GetY(),pinWi.GetX(),pinWi.GetY());if(dist>this._pinDist||mode==="bar"&&dist<this._pinDist){var _a20=_C279.angleTo(pinWi.GetX(),pinWi.GetY(),myWi.GetX(),myWi.GetY());myWi.SetXY(pinWi.GetX()+Math.cos(_a20)*this._pinDist,pinWi.GetY()+Math.sin(_a20)*this._pinDist);bboxChanged=true;}}else{var propSet=this._propSet;var v=0;if(propSet.has("imagepoint")){var _pinInst$GetImagePoin=pinInst.GetImagePoint(this._pinImagePoint),_pinInst$GetImagePoin2=_slicedToArray(_pinInst$GetImagePoin,2),newX=_pinInst$GetImagePoin2[0],newY=_pinInst$GetImagePoin2[1];if(!myWi.EqualsXY(newX,newY)){myWi.SetXY(newX,newY);bboxChanged=true;}}else if(propSet.has("x")&&propSet.has("y")){var _newX=pinWi.GetX()+Math.cos(pinWi.GetAngle()+this._pinAngle)*this._pinDist;var _newY=pinWi.GetY()+Math.sin(pinWi.GetAngle()+this._pinAngle)*this._pinDist;if(!myWi.EqualsXY(_newX,_newY)){myWi.SetXY(_newX,_newY);bboxChanged=true;}}else{v=pinWi.GetX()+this._dx;if(propSet.has("x")&&v!==myWi.GetX()){myWi.SetX(v);bboxChanged=true;}v=pinWi.GetY()+this._dy;if(propSet.has("y")&&v!==myWi.GetY()){myWi.SetY(v);bboxChanged=true;}}if(propSet.has("angle")){if(this._lastKnownAngle!==myWi.GetAngle())this._dAngle=_C279.clampAngle(this._dAngle+(myWi.GetAngle()-this._lastKnownAngle));v=_C279.clampAngle(pinWi.GetAngle()+this._dAngle);if(v!==myWi.GetAngle()){myWi.SetAngle(v);bboxChanged=true;}this._lastKnownAngle=myWi.GetAngle();}if(propSet.has("width-abs")){v=pinWi.GetWidth()+this._dWidth;if(v!==myWi.GetWidth()){myWi.SetWidth(v);bboxChanged=true;}}if(propSet.has("width-scale")){v=pinWi.GetWidth()*this._dWidth;if(v!==myWi.GetWidth()){myWi.SetWidth(v);bboxChanged=true;}}if(propSet.has("height-abs")){v=pinWi.GetHeight()+this._dHeight;if(v!==myWi.GetHeight()){myWi.SetHeight(v);bboxChanged=true;}}if(propSet.has("height-scale")){v=pinWi.GetHeight()*this._dHeight;if(v!==myWi.GetHeight()){myWi.SetHeight(v);bboxChanged=true;}}if(propSet.has("z")){v=pinWi.GetZElevation()+this._dz;if(v!==myWi.GetZElevation()){myWi.SetZElevation(v);this._runtime.UpdateRender();}}}if(bboxChanged)myWi.SetBboxChanged();}},{key:"GetDebuggerProperties",value:function GetDebuggerProperties(){var prefix="behaviors.pin.debugger";return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:prefix+".is-pinned",value:!!this._pinInst},{name:prefix+".pinned-uid",value:this._pinInst?this._pinInst.GetUID():0}]}];}}]);return PinInstance;}(_C279.SDKBehaviorInstanceBase);}{var _C280=self.C3;_C280.Behaviors.Pin.Cnds={IsPinned:function IsPinned(){return!!this._pinInst;},WillDestroy:function WillDestroy(){return this._destroy;}};}{var _C281=self.C3;_C281.Behaviors.Pin.Acts={PinByDistance:function PinByDistance(objectClass,mode){this._Pin(objectClass,mode===0?"rope":"bar");},PinByProperties:function PinByProperties(objectClass,ex,ey,ea,ew,eh,ez){var propList=[];if(ex)propList.push("x");if(ey)propList.push("y");if(ea)propList.push("angle");if(ez)propList.push("z");if(ew===1)propList.push("width-abs");else if(ew===2)propList.push("width-scale");if(eh===1)propList.push("height-abs");else if(eh===2)propList.push("height-scale");if(propList.length===0)return;this._Pin(objectClass,"properties",propList);},PinByImagePoint:function PinByImagePoint(objectClass,imgPt,ea,ew,eh,ez){var propList=["imagepoint"];if(ea)propList.push("angle");if(ez)propList.push("z");if(ew===1)propList.push("width-abs");else if(ew===2)propList.push("width-scale");if(eh===1)propList.push("height-abs");else if(eh===2)propList.push("height-scale");this._pinImagePoint=imgPt;this._Pin(objectClass,"properties",propList);},SetPinDistance:function SetPinDistance(d){if(this._mode==="rope"||this._mode==="bar")this._pinDist=Math.max(d,0);},SetDestroy:function SetDestroy(d){this._destroy=d;},Unpin:function Unpin(){this._SetPinInst(null);this._mode="";this._propSet.clear();this._pinImagePoint="";},Pin:function Pin(objectClass,mode){switch(mode){case 0:this._Pin(objectClass,"properties",["x","y","angle"]);break;case 1:this._Pin(objectClass,"properties",["x","y"]);break;case 2:this._Pin(objectClass,"properties",["angle"]);break;case 3:this._Pin(objectClass,"rope");break;case 4:this._Pin(objectClass,"bar");break;}}};}{var _C282=self.C3;_C282.Behaviors.Pin.Exps={PinnedUID:function PinnedUID(){return this._pinInst?this._pinInst.GetUID():-1;}};};}{'use strict';{var _C283=self.C3;_C283.Behaviors.wrap=/*#__PURE__*/function(_C283$SDKBehaviorBase){_inherits(WrapBehavior,_C283$SDKBehaviorBase);function WrapBehavior(opts){_classCallCheck(this,WrapBehavior);return _possibleConstructorReturn(this,_getPrototypeOf(WrapBehavior).call(this,opts));}_createClass(WrapBehavior,[{key:"Release",value:function Release(){_get(_getPrototypeOf(WrapBehavior.prototype),"Release",this).call(this);}}]);return WrapBehavior;}(_C283.SDKBehaviorBase);}{var _C284=self.C3;_C284.Behaviors.wrap.Type=/*#__PURE__*/function(_C284$SDKBehaviorType){_inherits(WrapType,_C284$SDKBehaviorType);function WrapType(behaviorType){_classCallCheck(this,WrapType);return _possibleConstructorReturn(this,_getPrototypeOf(WrapType).call(this,behaviorType));}_createClass(WrapType,[{key:"Release",value:function Release(){_get(_getPrototypeOf(WrapType.prototype),"Release",this).call(this);}},{key:"OnCreate",value:function OnCreate(){}}]);return WrapType;}(_C284.SDKBehaviorTypeBase);}{var _C285=self.C3;var _MODE=0;var bound=new _C285.Rect();_C285.Behaviors.wrap.Instance=/*#__PURE__*/function(_C285$SDKBehaviorInst){_inherits(WrapInstance,_C285$SDKBehaviorInst);function WrapInstance(behInst,properties){var _this219;_classCallCheck(this,WrapInstance);_this219=_possibleConstructorReturn(this,_getPrototypeOf(WrapInstance).call(this,behInst));_this219._mode=0;if(properties)_this219._mode=properties[_MODE];_this219._StartTicking();return _this219;}_createClass(WrapInstance,[{key:"Release",value:function Release(){_get(_getPrototypeOf(WrapInstance.prototype),"Release",this).call(this);}},{key:"SaveToJson",value:function SaveToJson(){return{"m":this._mode};}},{key:"LoadFromJson",value:function LoadFromJson(o){this._mode=o["m"];}},{key:"Tick",value:function Tick(){var wi=this._inst.GetWorldInfo();var layer=wi.GetLayer();var layout=layer.GetLayout();var bbox=wi.GetBoundingBox();if(this._mode===0)bound.set(0,0,layout.GetWidth(),layout.GetHeight());else bound.copy(layer.GetViewport());if(bbox.getRight()<bound.getLeft()){wi.SetX(bound.getRight()-1+(wi.GetX()-bbox.getLeft()));wi.SetBboxChanged();}else if(bbox.getLeft()>bound.getRight()){wi.SetX(bound.getLeft()+1-(bbox.getRight()-wi.GetX()));wi.SetBboxChanged();}else if(bbox.getBottom()<bound.getTop()){wi.SetY(bound.getBottom()-1+(wi.GetY()-bbox.getTop()));wi.SetBboxChanged();}else if(bbox.getTop()>bound.getBottom()){wi.SetY(bound.getTop()+1-(bbox.getBottom()-wi.GetY()));wi.SetBboxChanged();}}},{key:"GetPropertyValueByIndex",value:function GetPropertyValueByIndex(index){switch(index){case _MODE:return this._mode;}}},{key:"SetPropertyValueByIndex",value:function SetPropertyValueByIndex(index,value){switch(index){case _MODE:this._mode=value;break;}}}]);return WrapInstance;}(_C285.SDKBehaviorInstanceBase);}{var _C286=self.C3;_C286.Behaviors.wrap.Cnds={};}{var _C287=self.C3;_C287.Behaviors.wrap.Acts={};}{var _C288=self.C3;_C288.Behaviors.wrap.Exps={};};}{'use strict';{var _C289=self.C3;_C289.Behaviors.Anchor=/*#__PURE__*/function(_C289$SDKBehaviorBase){_inherits(AnchorBehavior,_C289$SDKBehaviorBase);function AnchorBehavior(opts){_classCallCheck(this,AnchorBehavior);return _possibleConstructorReturn(this,_getPrototypeOf(AnchorBehavior).call(this,opts));}_createClass(AnchorBehavior,[{key:"Release",value:function Release(){_get(_getPrototypeOf(AnchorBehavior.prototype),"Release",this).call(this);}}]);return AnchorBehavior;}(_C289.SDKBehaviorBase);}{var _C290=self.C3;_C290.Behaviors.Anchor.Type=/*#__PURE__*/function(_C290$SDKBehaviorType){_inherits(AnchorType,_C290$SDKBehaviorType);function AnchorType(behaviorType){_classCallCheck(this,AnchorType);return _possibleConstructorReturn(this,_getPrototypeOf(AnchorType).call(this,behaviorType));}_createClass(AnchorType,[{key:"Release",value:function Release(){_get(_getPrototypeOf(AnchorType.prototype),"Release",this).call(this);}},{key:"OnCreate",value:function OnCreate(){}}]);return AnchorType;}(_C290.SDKBehaviorTypeBase);}{var _C291=self.C3;var _C3X30=self.C3X;var _IBehaviorInstance10=self.IBehaviorInstance;var ANCHOR_LEFT=0;var ANCHOR_TOP=1;var ANCHOR_RIGHT=2;var ANCHOR_BOTTOM=3;var _ENABLE6=4;_C291.Behaviors.Anchor.Instance=/*#__PURE__*/function(_C291$SDKBehaviorInst){_inherits(AnchorInstance,_C291$SDKBehaviorInst);function AnchorInstance(behInst,properties){var _this220;_classCallCheck(this,AnchorInstance);_this220=_possibleConstructorReturn(this,_getPrototypeOf(AnchorInstance).call(this,behInst));_this220._anchorLeft=2;_this220._anchorTop=2;_this220._anchorRight=0;_this220._anchorBottom=0;_this220._isEnabled=true;var bbox=_this220._inst.GetWorldInfo().GetBoundingBox();_this220._xLeft=bbox.getLeft();_this220._yTop=bbox.getTop();_this220._xRight=_this220._runtime.GetOriginalViewportWidth()-bbox.getLeft();_this220._yBottom=_this220._runtime.GetOriginalViewportHeight()-bbox.getTop();_this220._rDiff=_this220._runtime.GetOriginalViewportWidth()-bbox.getRight();_this220._bDiff=_this220._runtime.GetOriginalViewportHeight()-bbox.getBottom();if(properties){_this220._anchorLeft=properties[ANCHOR_LEFT];_this220._anchorTop=properties[ANCHOR_TOP];_this220._anchorRight=properties[ANCHOR_RIGHT];_this220._anchorBottom=properties[ANCHOR_BOTTOM];_this220._isEnabled=!!properties[_ENABLE6];}var rt=_this220._runtime.Dispatcher();_this220._disposables=new _C291.CompositeDisposable(_C291.Disposable.From(rt,"layoutchange",function(){return _this220._OnLayoutChange();}));if(_this220._isEnabled)_this220._StartTicking();return _this220;}_createClass(AnchorInstance,[{key:"Release",value:function Release(){_get(_getPrototypeOf(AnchorInstance.prototype),"Release",this).call(this);}},{key:"SaveToJson",value:function SaveToJson(){return{"xl":this._xLeft,"yt":this._yTop,"xr":this._xRight,"yb":this._yBottom,"rd":this._rDiff,"bd":this._bDiff,"al":this._anchorLeft,"at":this._anchorTop,"ar":this._anchorRight,"ab":this._anchorBottom,"e":this._isEnabled};}},{key:"LoadFromJson",value:function LoadFromJson(o){this._xLeft=o["xl"];this._yTop=o["yt"];this._xRight=o["xr"];this._yBottom=o["yb"];this._rDiff=o["rd"];this._bDiff=o["bd"];this._anchorLeft=o["al"];this._anchorTop=o["at"];this._anchorRight=o["ar"];this._anchorBottom=o["ab"];this._isEnabled=o["e"];if(this._isEnabled)this._StartTicking();else this._StopTicking();}},{key:"_SetEnabled",value:function _SetEnabled(e){if(this._isEnabled&&!e){this._isEnabled=false;this._StopTicking();}else if(!this._isEnabled&&e){var bbox=this._inst.GetWorldInfo().GetBoundingBox();this._xLeft=bbox.getLeft();this._yTop=bbox.getTop();this._xRight=this._runtime.GetOriginalViewportWidth()-bbox.getLeft();this._yBottom=this._runtime.GetOriginalViewportHeight()-bbox.getTop();this._rDiff=this._runtime.GetOriginalViewportWidth()-bbox.getRight();this._bDiff=this._runtime.GetOriginalViewportHeight()-bbox.getBottom();this._isEnabled=true;this._StartTicking();}}},{key:"_IsEnabled",value:function _IsEnabled(){return this._isEnabled;}},{key:"_UpdatePosition",value:function _UpdatePosition(){if(!this._isEnabled)return;var wi=this._inst.GetWorldInfo();var viewport=wi.GetLayer().GetViewport();if(this._anchorLeft===0){var n=viewport.getLeft()+this._xLeft-wi.GetBoundingBox().getLeft();if(n!==0){wi.OffsetX(n);wi.SetBboxChanged();}}else if(this._anchorLeft===1){var _n3=viewport.getRight()-this._xRight-wi.GetBoundingBox().getLeft();if(_n3!==0){wi.OffsetX(_n3);wi.SetBboxChanged();}}if(this._anchorTop===0){var _n4=viewport.getTop()+this._yTop-wi.GetBoundingBox().getTop();if(_n4!==0){wi.OffsetY(_n4);wi.SetBboxChanged();}}else if(this._anchorTop===1){var _n5=viewport.getBottom()-this._yBottom-wi.GetBoundingBox().getTop();if(_n5!==0){wi.OffsetY(_n5);wi.SetBboxChanged();}}if(this._anchorRight===1){var _n6=viewport.getRight()-this._rDiff-wi.GetBoundingBox().getRight();if(_n6!==0){wi.OffsetX(wi.GetOriginX()*_n6);wi.SetWidth(Math.max(wi.GetWidth()+_n6),0);wi.SetBboxChanged();this._rDiff=viewport.getRight()-wi.GetBoundingBox().getRight();}}if(this._anchorBottom===1){var _n7=viewport.getBottom()-this._bDiff-wi.GetBoundingBox().getBottom();if(_n7!==0){wi.OffsetY(wi.GetOriginY()*_n7);wi.SetHeight(Math.max(wi.GetHeight()+_n7,0));wi.SetBboxChanged();this._bDiff=viewport.getBottom()-wi.GetBoundingBox().getBottom();}}}},{key:"Tick",value:function Tick(){this._UpdatePosition();}},{key:"_OnLayoutChange",value:function _OnLayoutChange(){this._UpdatePosition();}},{key:"GetPropertyValueByIndex",value:function GetPropertyValueByIndex(index){switch(index){case ANCHOR_LEFT:return this._anchorLeft;case ANCHOR_TOP:return this._anchorTop;case ANCHOR_RIGHT:return this._anchorRight;case ANCHOR_BOTTOM:return this._anchorBottom;case _ENABLE6:return this._isEnabled;}}},{key:"SetPropertyValueByIndex",value:function SetPropertyValueByIndex(index,value){switch(index){case ANCHOR_LEFT:this._anchorLeft=value;break;case ANCHOR_TOP:this._anchorTop=value;break;case ANCHOR_RIGHT:this._anchorRight=value;break;case ANCHOR_BOTTOM:this._anchorBottom=value;break;case _ENABLE6:this._isEnabled=!!value;if(this._isEnabled)this._StartTicking();else this._StopTicking();break;}}},{key:"GetDebuggerProperties",value:function GetDebuggerProperties(){var _this221=this;var prefix="behaviors.anchor";return[{title:"$"+this.GetBehaviorType().GetName(),properties:[{name:prefix+".properties.enabled.name",value:this._IsEnabled(),onedit:function onedit(v){return _this221._SetEnabled(v);}}]}];}},{key:"GetScriptInterfaceClass",value:function GetScriptInterfaceClass(){return self.IAnchorBehaviorInstance;}}]);return AnchorInstance;}(_C291.SDKBehaviorInstanceBase);var _map22=new WeakMap();self.IAnchorBehaviorInstance=/*#__PURE__*/function(_IBehaviorInstance11){_inherits(IAnchorBehaviorInstance,_IBehaviorInstance11);function IAnchorBehaviorInstance(){var _this222;_classCallCheck(this,IAnchorBehaviorInstance);_this222=_possibleConstructorReturn(this,_getPrototypeOf(IAnchorBehaviorInstance).call(this));_map22.set(_assertThisInitialized(_this222),_IBehaviorInstance10._GetInitInst().GetSdkInstance());return _this222;}_createClass(IAnchorBehaviorInstance,[{key:"isEnabled",get:function get(){return _map22.get(this)._IsEnabled();},set:function set(e){_map22.get(this)._SetEnabled(e);}}]);return IAnchorBehaviorInstance;}(_IBehaviorInstance10);}{var _C292=self.C3;_C292.Behaviors.Anchor.Cnds={IsEnabled:function IsEnabled(){return this._IsEnabled();}};}{var _C293=self.C3;_C293.Behaviors.Anchor.Acts={SetEnabled:function SetEnabled(e){this._SetEnabled(e!==0);}};}{var _C294=self.C3;_C294.Behaviors.Anchor.Exps={};};}{var _C295=self.C3;self.C3_GetObjectRefTable=function(){return[_C295.Plugins.Sprite,_C295.Behaviors.Platform,_C295.Behaviors.bound,_C295.Behaviors.MoveTo,_C295.Behaviors.scrollto,_C295.Behaviors.Bullet,_C295.Plugins.Keyboard,_C295.Behaviors.solid,_C295.Behaviors.Pin,_C295.Behaviors.wrap,_C295.Plugins.Text,_C295.Plugins.Audio,_C295.Plugins.UserMedia,_C295.Behaviors.Anchor,_C295.Plugins.TiledBg,_C295.Plugins.Touch,_C295.Plugins.Mouse,_C295.Plugins.Keyboard.Cnds.OnKey,_C295.Plugins.Sprite.Acts.SetMirrored,_C295.Plugins.Sprite.Acts.StartAnim,_C295.Plugins.Audio.Acts.Play,_C295.Plugins.Sprite.Cnds.OnCollision,_C295.Plugins.Sprite.Acts.Destroy,_C295.Behaviors.Platform.Acts.SetDoubleJumpEnabled,_C295.Behaviors.Platform.Acts.SetJumpStrength,_C295.Plugins.Sprite.Acts.SetSize,_C295.Plugins.System.Acts.SubVar,_C295.Plugins.System.Cnds.OnLayoutStart,_C295.Behaviors.Pin.Acts.PinByProperties,_C295.Plugins.System.Acts.GoToLayout,_C295.Plugins.Audio.Acts.StopAll,_C295.Plugins.System.Cnds.EveryTick,_C295.Plugins.Sprite.Acts.SetAnimFrame,_C295.Plugins.System.Cnds.Every,_C295.Plugins.Sprite.Acts.SetOpacity,_C295.Plugins.System.Cnds.CompareVar,_C295.Behaviors.Platform.Acts.SimulateControl,_C295.Plugins.System.Cnds.IsGroupActive,_C295.Plugins.Touch.Cnds.OnTapGestureObject,_C295.Plugins.Mouse.Cnds.IsOverObject,_C295.Plugins.Sprite.Acts.SetDefaultColor,_C295.Plugins.System.Acts.ResetGlobals];};self.C3_JsPropNameTable=[{fundoPrincipal:0},{Plataforma:0},{RestritoAoLayout:0},{MoverPara:0},{ScrollTo:0},{player:0},{Bullet:0},{ave:0},{obstaculo1:0},{cristalVerm:0},{cristalAzul:0},{cristalAmar:0},{Teclado:0},{Sólido:0},{obstaculo2:0},{Solid:0},{Sprite:0},{Pin:0},{camera:0},{Sprite3:0},{Sprite4:0},{Wrap:0},{nuvem:0},{Sprite2:0},{Sprite5:0},{Sprite6:0},{gota:0},{pontos:0},{Atrelar:0},{pontuação:0},{portal:0},{gameOver:0},{fim:0},{Sprite9:0},{Audio:0},{UserMedia:0},{venenoso:0},{Âncora:0},{vidas:0},{PlanoDeFundoEmBlocos:0},{PlanoDeFundoEmBlocos2:0},{fundoInicio:0},{Toque:0},{Mouse:0},{botãoPlay:0},{play:0},{Sprite10:0}];self.InstanceType={fundoPrincipal:/*#__PURE__*/function(_self$ISpriteInstance){_inherits(fundoPrincipal,_self$ISpriteInstance);function fundoPrincipal(){_classCallCheck(this,fundoPrincipal);return _possibleConstructorReturn(this,_getPrototypeOf(fundoPrincipal).apply(this,arguments));}return fundoPrincipal;}(self.ISpriteInstance),player:/*#__PURE__*/function(_self$ISpriteInstance2){_inherits(player,_self$ISpriteInstance2);function player(){_classCallCheck(this,player);return _possibleConstructorReturn(this,_getPrototypeOf(player).apply(this,arguments));}return player;}(self.ISpriteInstance),ave:/*#__PURE__*/function(_self$ISpriteInstance3){_inherits(ave,_self$ISpriteInstance3);function ave(){_classCallCheck(this,ave);return _possibleConstructorReturn(this,_getPrototypeOf(ave).apply(this,arguments));}return ave;}(self.ISpriteInstance),obstaculo1:/*#__PURE__*/function(_self$ISpriteInstance4){_inherits(obstaculo1,_self$ISpriteInstance4);function obstaculo1(){_classCallCheck(this,obstaculo1);return _possibleConstructorReturn(this,_getPrototypeOf(obstaculo1).apply(this,arguments));}return obstaculo1;}(self.ISpriteInstance),cristalVerm:/*#__PURE__*/function(_self$ISpriteInstance5){_inherits(cristalVerm,_self$ISpriteInstance5);function cristalVerm(){_classCallCheck(this,cristalVerm);return _possibleConstructorReturn(this,_getPrototypeOf(cristalVerm).apply(this,arguments));}return cristalVerm;}(self.ISpriteInstance),cristalAzul:/*#__PURE__*/function(_self$ISpriteInstance6){_inherits(cristalAzul,_self$ISpriteInstance6);function cristalAzul(){_classCallCheck(this,cristalAzul);return _possibleConstructorReturn(this,_getPrototypeOf(cristalAzul).apply(this,arguments));}return cristalAzul;}(self.ISpriteInstance),cristalAmar:/*#__PURE__*/function(_self$ISpriteInstance7){_inherits(cristalAmar,_self$ISpriteInstance7);function cristalAmar(){_classCallCheck(this,cristalAmar);return _possibleConstructorReturn(this,_getPrototypeOf(cristalAmar).apply(this,arguments));}return cristalAmar;}(self.ISpriteInstance),Teclado:/*#__PURE__*/function(_self$IInstance){_inherits(Teclado,_self$IInstance);function Teclado(){_classCallCheck(this,Teclado);return _possibleConstructorReturn(this,_getPrototypeOf(Teclado).apply(this,arguments));}return Teclado;}(self.IInstance),obstaculo2:/*#__PURE__*/function(_self$ISpriteInstance8){_inherits(obstaculo2,_self$ISpriteInstance8);function obstaculo2(){_classCallCheck(this,obstaculo2);return _possibleConstructorReturn(this,_getPrototypeOf(obstaculo2).apply(this,arguments));}return obstaculo2;}(self.ISpriteInstance),Sprite:/*#__PURE__*/function(_self$ISpriteInstance9){_inherits(Sprite,_self$ISpriteInstance9);function Sprite(){_classCallCheck(this,Sprite);return _possibleConstructorReturn(this,_getPrototypeOf(Sprite).apply(this,arguments));}return Sprite;}(self.ISpriteInstance),camera:/*#__PURE__*/function(_self$ISpriteInstance10){_inherits(camera,_self$ISpriteInstance10);function camera(){_classCallCheck(this,camera);return _possibleConstructorReturn(this,_getPrototypeOf(camera).apply(this,arguments));}return camera;}(self.ISpriteInstance),Sprite3:/*#__PURE__*/function(_self$ISpriteInstance11){_inherits(Sprite3,_self$ISpriteInstance11);function Sprite3(){_classCallCheck(this,Sprite3);return _possibleConstructorReturn(this,_getPrototypeOf(Sprite3).apply(this,arguments));}return Sprite3;}(self.ISpriteInstance),Sprite4:/*#__PURE__*/function(_self$ISpriteInstance12){_inherits(Sprite4,_self$ISpriteInstance12);function Sprite4(){_classCallCheck(this,Sprite4);return _possibleConstructorReturn(this,_getPrototypeOf(Sprite4).apply(this,arguments));}return Sprite4;}(self.ISpriteInstance),nuvem:/*#__PURE__*/function(_self$ISpriteInstance13){_inherits(nuvem,_self$ISpriteInstance13);function nuvem(){_classCallCheck(this,nuvem);return _possibleConstructorReturn(this,_getPrototypeOf(nuvem).apply(this,arguments));}return nuvem;}(self.ISpriteInstance),Sprite2:/*#__PURE__*/function(_self$ISpriteInstance14){_inherits(Sprite2,_self$ISpriteInstance14);function Sprite2(){_classCallCheck(this,Sprite2);return _possibleConstructorReturn(this,_getPrototypeOf(Sprite2).apply(this,arguments));}return Sprite2;}(self.ISpriteInstance),Sprite5:/*#__PURE__*/function(_self$ISpriteInstance15){_inherits(Sprite5,_self$ISpriteInstance15);function Sprite5(){_classCallCheck(this,Sprite5);return _possibleConstructorReturn(this,_getPrototypeOf(Sprite5).apply(this,arguments));}return Sprite5;}(self.ISpriteInstance),Sprite6:/*#__PURE__*/function(_self$ISpriteInstance16){_inherits(Sprite6,_self$ISpriteInstance16);function Sprite6(){_classCallCheck(this,Sprite6);return _possibleConstructorReturn(this,_getPrototypeOf(Sprite6).apply(this,arguments));}return Sprite6;}(self.ISpriteInstance),gota:/*#__PURE__*/function(_self$ISpriteInstance17){_inherits(gota,_self$ISpriteInstance17);function gota(){_classCallCheck(this,gota);return _possibleConstructorReturn(this,_getPrototypeOf(gota).apply(this,arguments));}return gota;}(self.ISpriteInstance),pontos:/*#__PURE__*/function(_self$ITextInstance){_inherits(pontos,_self$ITextInstance);function pontos(){_classCallCheck(this,pontos);return _possibleConstructorReturn(this,_getPrototypeOf(pontos).apply(this,arguments));}return pontos;}(self.ITextInstance),pontuação:/*#__PURE__*/function(_self$ITextInstance2){_inherits(pontuaO,_self$ITextInstance2);function pontuaO(){_classCallCheck(this,pontuaO);return _possibleConstructorReturn(this,_getPrototypeOf(pontuaO).apply(this,arguments));}return pontuaO;}(self.ITextInstance),portal:/*#__PURE__*/function(_self$ISpriteInstance18){_inherits(portal,_self$ISpriteInstance18);function portal(){_classCallCheck(this,portal);return _possibleConstructorReturn(this,_getPrototypeOf(portal).apply(this,arguments));}return portal;}(self.ISpriteInstance),gameOver:/*#__PURE__*/function(_self$ISpriteInstance19){_inherits(gameOver,_self$ISpriteInstance19);function gameOver(){_classCallCheck(this,gameOver);return _possibleConstructorReturn(this,_getPrototypeOf(gameOver).apply(this,arguments));}return gameOver;}(self.ISpriteInstance),fim:/*#__PURE__*/function(_self$ISpriteInstance20){_inherits(fim,_self$ISpriteInstance20);function fim(){_classCallCheck(this,fim);return _possibleConstructorReturn(this,_getPrototypeOf(fim).apply(this,arguments));}return fim;}(self.ISpriteInstance),Sprite9:/*#__PURE__*/function(_self$ISpriteInstance21){_inherits(Sprite9,_self$ISpriteInstance21);function Sprite9(){_classCallCheck(this,Sprite9);return _possibleConstructorReturn(this,_getPrototypeOf(Sprite9).apply(this,arguments));}return Sprite9;}(self.ISpriteInstance),Audio:/*#__PURE__*/function(_self$IInstance2){_inherits(Audio,_self$IInstance2);function Audio(){_classCallCheck(this,Audio);return _possibleConstructorReturn(this,_getPrototypeOf(Audio).apply(this,arguments));}return Audio;}(self.IInstance),UserMedia:/*#__PURE__*/function(_self$IWorldInstance5){_inherits(UserMedia,_self$IWorldInstance5);function UserMedia(){_classCallCheck(this,UserMedia);return _possibleConstructorReturn(this,_getPrototypeOf(UserMedia).apply(this,arguments));}return UserMedia;}(self.IWorldInstance),venenoso:/*#__PURE__*/function(_self$ISpriteInstance22){_inherits(venenoso,_self$ISpriteInstance22);function venenoso(){_classCallCheck(this,venenoso);return _possibleConstructorReturn(this,_getPrototypeOf(venenoso).apply(this,arguments));}return venenoso;}(self.ISpriteInstance),vidas:/*#__PURE__*/function(_self$ISpriteInstance23){_inherits(vidas,_self$ISpriteInstance23);function vidas(){_classCallCheck(this,vidas);return _possibleConstructorReturn(this,_getPrototypeOf(vidas).apply(this,arguments));}return vidas;}(self.ISpriteInstance),PlanoDeFundoEmBlocos:/*#__PURE__*/function(_self$ITiledBackgroun){_inherits(PlanoDeFundoEmBlocos,_self$ITiledBackgroun);function PlanoDeFundoEmBlocos(){_classCallCheck(this,PlanoDeFundoEmBlocos);return _possibleConstructorReturn(this,_getPrototypeOf(PlanoDeFundoEmBlocos).apply(this,arguments));}return PlanoDeFundoEmBlocos;}(self.ITiledBackgroundInstance),PlanoDeFundoEmBlocos2:/*#__PURE__*/function(_self$ITiledBackgroun2){_inherits(PlanoDeFundoEmBlocos2,_self$ITiledBackgroun2);function PlanoDeFundoEmBlocos2(){_classCallCheck(this,PlanoDeFundoEmBlocos2);return _possibleConstructorReturn(this,_getPrototypeOf(PlanoDeFundoEmBlocos2).apply(this,arguments));}return PlanoDeFundoEmBlocos2;}(self.ITiledBackgroundInstance),fundoInicio:/*#__PURE__*/function(_self$ISpriteInstance24){_inherits(fundoInicio,_self$ISpriteInstance24);function fundoInicio(){_classCallCheck(this,fundoInicio);return _possibleConstructorReturn(this,_getPrototypeOf(fundoInicio).apply(this,arguments));}return fundoInicio;}(self.ISpriteInstance),Toque:/*#__PURE__*/function(_self$IInstance3){_inherits(Toque,_self$IInstance3);function Toque(){_classCallCheck(this,Toque);return _possibleConstructorReturn(this,_getPrototypeOf(Toque).apply(this,arguments));}return Toque;}(self.IInstance),Mouse:/*#__PURE__*/function(_self$IInstance4){_inherits(Mouse,_self$IInstance4);function Mouse(){_classCallCheck(this,Mouse);return _possibleConstructorReturn(this,_getPrototypeOf(Mouse).apply(this,arguments));}return Mouse;}(self.IInstance),botãoPlay:/*#__PURE__*/function(_self$ISpriteInstance25){_inherits(botOPlay,_self$ISpriteInstance25);function botOPlay(){_classCallCheck(this,botOPlay);return _possibleConstructorReturn(this,_getPrototypeOf(botOPlay).apply(this,arguments));}return botOPlay;}(self.ISpriteInstance),play:/*#__PURE__*/function(_self$ITextInstance3){_inherits(play,_self$ITextInstance3);function play(){_classCallCheck(this,play);return _possibleConstructorReturn(this,_getPrototypeOf(play).apply(this,arguments));}return play;}(self.ITextInstance),Sprite10:/*#__PURE__*/function(_self$ISpriteInstance26){_inherits(Sprite10,_self$ISpriteInstance26);function Sprite10(){_classCallCheck(this,Sprite10);return _possibleConstructorReturn(this,_getPrototypeOf(Sprite10).apply(this,arguments));}return Sprite10;}(self.ISpriteInstance)};}{var unaryminus=function unaryminus(n){return typeof n==="number"?-n:n;};var bothNumbers=function bothNumbers(a,b){return typeof a==="number"&&typeof b==="number";};var _add=function _add(l,r){if(bothNumbers(l,r))return l+r;else return l;};var subtract=function subtract(l,r){if(bothNumbers(l,r))return l-r;else return l;};var multiply=function multiply(l,r){if(bothNumbers(l,r))return l*r;else return l;};var divide=function divide(l,r){if(bothNumbers(l,r))return l/r;else return l;};var mod=function mod(l,r){if(bothNumbers(l,r))return l%r;else return l;};var pow=function pow(l,r){if(bothNumbers(l,r))return Math.pow(l,r);else return l;};var and=function and(l,r){if(typeof l==="string"||typeof r==="string"){// & with either side string does string concatenation
var lstr,rstr;if(typeof l==="number")lstr=(Math.round(l*1e10)/1e10).toString();else lstr=l;if(typeof r==="number")rstr=(Math.round(r*1e10)/1e10).toString();else rstr=r;return lstr+rstr;}else{// & with neither side a string does logical AND
return l&&r?1:0;}};var or=function or(l,r){if(bothNumbers(l,r))return l||r?1:0;else return l;};var _C296=self.C3;self.C3_ExpressionFuncs=[function(){return 0;},function(){return"";},function(){return 1500;},function(){return 200;},function(){return 169;},function(){return 1;},function(){return 2;},function(){return-5;},function(p){var v0=p._GetNode(0).GetVar();return function(){return v0.GetValue();};},function(){return 4;},function(){return 5;},function(){return"fim";},function(){return-15;},function(){return"inicio]";},function(){return-301021373787135;}];}